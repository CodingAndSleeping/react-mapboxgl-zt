!(function(){var Ix=Object.defineProperty;var Py=Object.getOwnPropertySymbols;var Mx=Object.prototype.hasOwnProperty,Ax=Object.prototype.propertyIsEnumerable;var lh=Math.pow,Cx=(ir,Yn,Tt)=>Yn in ir?Ix(ir,Yn,{enumerable:!0,configurable:!0,writable:!0,value:Tt}):ir[Yn]=Tt;var rm=(ir,Yn)=>{var Tt={};for(var xe in ir)Mx.call(ir,xe)&&Yn.indexOf(xe)<0&&(Tt[xe]=ir[xe]);if(ir!=null&&Py)for(var xe of Py(ir))Yn.indexOf(xe)<0&&Ax.call(ir,xe)&&(Tt[xe]=ir[xe]);return Tt};var Ur=(ir,Yn,Tt)=>Cx(ir,typeof Yn!="symbol"?Yn+"":Yn,Tt);(self.webpackChunkreact_mapboxgl_zt=self.webpackChunkreact_mapboxgl_zt||[]).push([[374],{12398:function(ir,Yn,Tt){var xe=Tt(1129);ir.exports.geometry=Pi,ir.exports.ring=s;function Pi(tn){var ti=0,$t;switch(tn.type){case"Polygon":return hn(tn.coordinates);case"MultiPolygon":for($t=0;$t<tn.coordinates.length;$t++)ti+=hn(tn.coordinates[$t]);return ti;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for($t=0;$t<tn.geometries.length;$t++)ti+=Pi(tn.geometries[$t]);return ti}}function hn(tn){var ti=0;if(tn&&tn.length>0){ti+=Math.abs(s(tn[0]));for(var $t=1;$t<tn.length;$t++)ti-=Math.abs(s(tn[$t]))}return ti}function s(tn){var ti,$t,et,yi,ct,Qt,Ii,Yi=0,We=tn.length;if(We>2){for(Ii=0;Ii<We;Ii++)Ii===We-2?(yi=We-2,ct=We-1,Qt=0):Ii===We-1?(yi=We-1,ct=0,Qt=1):(yi=Ii,ct=Ii+1,Qt=Ii+2),ti=tn[yi],$t=tn[ct],et=tn[Qt],Yi+=(xn(et[0])-xn(ti[0]))*Math.sin(xn($t[1]));Yi=Yi*xe.RADIUS*xe.RADIUS/2}return Yi}function xn(tn){return tn*Math.PI/180}},74444:function(ir){ir.exports=Tt;var Yn={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function Tt(xe){if(!xe||!xe.type)return null;var Pi=Yn[xe.type];if(!Pi)return null;if(Pi==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:xe}]};if(Pi==="feature")return{type:"FeatureCollection",features:[xe]};if(Pi==="featurecollection")return xe}},31054:function(ir){(function(Yn,Tt){ir.exports=Tt()})(this,function(){"use strict";function Yn(v,c){(c==null||c>v.length)&&(c=v.length);for(var f=0,y=Array(c);f<c;f++)y[f]=v[f];return y}function Tt(v,c,f){return c=ti(c),function(y,P){if(P&&(typeof P=="object"||typeof P=="function"))return P;if(P!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(F){if(F===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F}(y)}(v,et()?Reflect.construct(c,f||[],ti(v).constructor):c.apply(v,f))}function xe(v,c){if(!(v instanceof c))throw new TypeError("Cannot call a class as a function")}function Pi(v,c,f){if(et())return Reflect.construct.apply(null,arguments);var y=[null];y.push.apply(y,c);var P=new(v.bind.apply(v,y));return f&&yi(P,f.prototype),P}function hn(v,c){for(var f=0;f<c.length;f++){var y=c[f];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,Ii(y.key),y)}}function s(v,c,f){return c&&hn(v.prototype,c),f&&hn(v,f),Object.defineProperty(v,"prototype",{writable:!1}),v}function xn(v,c){var f=typeof Symbol!="undefined"&&v[Symbol.iterator]||v["@@iterator"];if(!f){if(Array.isArray(v)||(f=Yi(v))||c){f&&(v=f);var y=0,P=function(){};return{s:P,n:function(){return y>=v.length?{done:!0}:{done:!1,value:v[y++]}},e:function(Te){throw Te},f:P}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var F,Z=!0,re=!1;return{s:function(){f=f.call(v)},n:function(){var Te=f.next();return Z=Te.done,Te},e:function(Te){re=!0,F=Te},f:function(){try{Z||f.return==null||f.return()}finally{if(re)throw F}}}}function tn(){return tn=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(v,c,f){var y=function(F,Z){for(;!{}.hasOwnProperty.call(F,Z)&&(F=ti(F))!==null;);return F}(v,c);if(y){var P=Object.getOwnPropertyDescriptor(y,c);return P.get?P.get.call(arguments.length<3?v:f):P.value}},tn.apply(null,arguments)}function ti(v){return ti=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)},ti(v)}function $t(v,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");v.prototype=Object.create(c&&c.prototype,{constructor:{value:v,writable:!0,configurable:!0}}),Object.defineProperty(v,"prototype",{writable:!1}),c&&yi(v,c)}function et(){try{var v=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(c){}return(et=function(){return!!v})()}function yi(v,c){return yi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,y){return f.__proto__=y,f},yi(v,c)}function ct(v,c,f,y){var P=tn(ti(1&y?v.prototype:v),c,f);return 2&y&&typeof P=="function"?function(F){return P.apply(f,F)}:P}function Qt(v){return function(c){if(Array.isArray(c))return Yn(c)}(v)||function(c){if(typeof Symbol!="undefined"&&c[Symbol.iterator]!=null||c["@@iterator"]!=null)return Array.from(c)}(v)||Yi(v)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ii(v){var c=function(f,y){if(typeof f!="object"||!f)return f;var P=f[Symbol.toPrimitive];if(P!==void 0){var F=P.call(f,y);if(typeof F!="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(f)}(v,"string");return typeof c=="symbol"?c:c+""}function Yi(v,c){if(v){if(typeof v=="string")return Yn(v,c);var f={}.toString.call(v).slice(8,-1);return f==="Object"&&v.constructor&&(f=v.constructor.name),f==="Map"||f==="Set"?Array.from(v):f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f)?Yn(v,c):void 0}}function We(v){var c=typeof Map=="function"?new Map:void 0;return We=function(f){if(f===null||!function(P){try{return Function.toString.call(P).indexOf("[native code]")!==-1}catch(F){return typeof P=="function"}}(f))return f;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(f))return c.get(f);c.set(f,y)}function y(){return Pi(f,arguments,ti(this).constructor)}return y.prototype=Object.create(f.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),yi(y,f)},We(v)}var ot=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(c){this._quadrantSegments=c,this._quadrantSegments===0&&(this._joinStyle=v.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=v.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),c<=0&&(this._quadrantSegments=1),this._joinStyle!==v.JOIN_ROUND&&(this._quadrantSegments=v.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(c){this._joinStyle=c}},{key:"setSimplifyFactor",value:function(c){this._simplifyFactor=c<0?0:c}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(c){this._endCapStyle=c}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(c){this._mitreLimit=c}},{key:"setSingleSided",value:function(c){this._isSingleSided=c}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=v.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=v.CAP_ROUND,this._joinStyle=v.JOIN_ROUND,this._mitreLimit=v.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=v.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var c=arguments[0];this.setQuadrantSegments(c)}else if(arguments.length===2){var f=arguments[0],y=arguments[1];this.setQuadrantSegments(f),this.setEndCapStyle(y)}else if(arguments.length===4){var P=arguments[0],F=arguments[1],Z=arguments[2],re=arguments[3];this.setQuadrantSegments(P),this.setEndCapStyle(F),this.setJoinStyle(Z),this.setMitreLimit(re)}}}},{key:"bufferDistanceError",value:function(c){var f=Math.PI/2/c;return 1-Math.cos(f/2)}}])}();ot.CAP_ROUND=1,ot.CAP_FLAT=2,ot.CAP_SQUARE=3,ot.JOIN_ROUND=1,ot.JOIN_MITRE=2,ot.JOIN_BEVEL=3,ot.DEFAULT_QUADRANT_SEGMENTS=8,ot.DEFAULT_MITRE_LIMIT=5,ot.DEFAULT_SIMPLIFY_FACTOR=.01;var dt=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c,[f])).name=Object.keys({Exception:c})[0],y}return $t(c,v),s(c,[{key:"toString",value:function(){return this.message}}])}(We(Error)),vt=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c,[f])).name=Object.keys({IllegalArgumentException:c})[0],y}return $t(c,v),s(c)}(dt),Be=function(){return s(function v(){xe(this,v)},[{key:"filter",value:function(v){}}])}();function Ie(){}function Ue(){}function qe(){}var De,je,Pt,ki,bi,ji,hr,Xn,rn=function(){return s(function v(){xe(this,v)},null,[{key:"equalsWithTolerance",value:function(v,c,f){return Math.abs(v-c)<=f}}])}(),Ot=function(){return s(function v(c,f){xe(this,v),this.low=f||0,this.high=c||0},null,[{key:"toBinaryString",value:function(v){var c,f="";for(c=2147483648;c>0;c>>>=1)f+=(v.high&c)===c?"1":"0";for(c=2147483648;c>0;c>>>=1)f+=(v.low&c)===c?"1":"0";return f}}])}();function at(){}function Ht(){}at.NaN=NaN,at.isNaN=function(v){return Number.isNaN(v)},at.isInfinite=function(v){return!Number.isFinite(v)},at.MAX_VALUE=Number.MAX_VALUE,at.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,at.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(ji=2146435072,hr=new Float64Array(1),Xn=new Int32Array(hr.buffer),at.doubleToLongBits=function(v){hr[0]=v;var c=0|Xn[0],f=0|Xn[1];return(f&ji)===ji&&1048575&f&&c!==0&&(c=0,f=2146959360),new Ot(f,c)},at.longBitsToDouble=function(v){return Xn[0]=v.low,Xn[1]=v.high,hr[0]}):(De=1023,je=Math.log2,Pt=Math.floor,ki=Math.pow,bi=function(){for(var v=53;v>0;v--){var c=ki(2,v)-1;if(Pt(je(c))+1===v)return c}return 0}(),at.doubleToLongBits=function(v){var c,f,y,P,F,Z,re,Te,Xe;if(v<0||1/v===Number.NEGATIVE_INFINITY?(Z=1<<31,v=-v):Z=0,v===0)return new Ot(Te=Z,Xe=0);if(v===1/0)return new Ot(Te=2146435072|Z,Xe=0);if(v!=v)return new Ot(Te=2146959360,Xe=0);if(P=0,Xe=0,(c=Pt(v))>1)if(c<=bi)(P=Pt(je(c)))<=20?(Xe=0,Te=c<<20-P&1048575):(Xe=c%(f=ki(2,y=P-20))<<32-y,Te=c/f&1048575);else for(y=c,Xe=0;(y=Pt(f=y/2))!==0;)P++,Xe>>>=1,Xe|=(1&Te)<<31,Te>>>=1,f!==y&&(Te|=524288);if(re=P+De,F=c===0,c=v-c,P<52&&c!==0)for(y=0;;){if((f=2*c)>=1?(c=f-1,F?(re--,F=!1):(y<<=1,y|=1,P++)):(c=f,F?--re==0&&(P++,F=!1):(y<<=1,P++)),P===20)Te|=y,y=0;else if(P===52){Xe|=y;break}if(f===1){P<20?Te|=y<<20-P:P<52&&(Xe|=y<<52-P);break}}return Te|=re<<20,new Ot(Te|=Z,Xe)},at.longBitsToDouble=function(v){var c,f,y,P,F=v.high,Z=v.low,re=F&1<<31?-1:1;for(y=((2146435072&F)>>20)-De,P=0,f=1<<19,c=1;c<=20;c++)F&f&&(P+=ki(2,-c)),f>>>=1;for(f=1<<31,c=21;c<=52;c++)Z&f&&(P+=ki(2,-c)),f>>>=1;if(y===-1023){if(P===0)return 0*re;y=-1022}else{if(y===1024)return P===0?re/0:NaN;P+=1}return re*P*ki(2,y)});var Qi=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c,[f])).name=Object.keys({RuntimeException:c})[0],y}return $t(c,v),s(c)}(dt),vi=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,null,[{key:"constructor_",value:function(){if(arguments.length===0)Qi.constructor_.call(this);else if(arguments.length===1){var f=arguments[0];Qi.constructor_.call(this,f)}}}])}(Qi),Mn=function(){function v(){xe(this,v)}return s(v,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)v.shouldNeverReachHere(null);else if(arguments.length===1){var c=arguments[0];throw new vi("Should never reach here"+(c!==null?": "+c:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var c=arguments[0];v.isTrue(c,null)}else if(arguments.length===2){var f=arguments[1];if(!arguments[0])throw f===null?new vi:new vi(f)}}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],f=arguments[1];v.equals(c,f,null)}else if(arguments.length===3){var y=arguments[0],P=arguments[1],F=arguments[2];if(!P.equals(y))throw new vi("Expected "+y+" but encountered "+P+(F!==null?": "+F:""))}}}])}(),gr=new ArrayBuffer(8),Hn=new Float64Array(gr),kr=new Int32Array(gr),Dt=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getM",value:function(){return at.NaN}},{key:"setOrdinate",value:function(c,f){switch(c){case v.X:this.x=f;break;case v.Y:this.y=f;break;case v.Z:this.setZ(f);break;default:throw new vt("Invalid ordinate index: "+c)}}},{key:"equals2D",value:function(){if(arguments.length===1){var c=arguments[0];return this.x===c.x&&this.y===c.y}if(arguments.length===2){var f=arguments[0],y=arguments[1];return!!rn.equalsWithTolerance(this.x,f.x,y)&&!!rn.equalsWithTolerance(this.y,f.y,y)}}},{key:"setM",value:function(c){throw new vt("Invalid ordinate index: "+v.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(c){switch(c){case v.X:return this.x;case v.Y:return this.y;case v.Z:return this.getZ()}throw new vt("Invalid ordinate index: "+c)}},{key:"equals3D",value:function(c){return this.x===c.x&&this.y===c.y&&(this.getZ()===c.getZ()||at.isNaN(this.getZ())&&at.isNaN(c.getZ()))}},{key:"equals",value:function(c){return c instanceof v&&this.equals2D(c)}},{key:"equalInZ",value:function(c,f){return rn.equalsWithTolerance(this.getZ(),c.getZ(),f)}},{key:"setX",value:function(c){this.x=c}},{key:"compareTo",value:function(c){var f=c;return this.x<f.x?-1:this.x>f.x?1:this.y<f.y?-1:this.y>f.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(c){this.z=c}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return Mn.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw c}}},{key:"copy",value:function(){return new v(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(c){var f=this.x-c.x,y=this.y-c.y,P=this.getZ()-c.getZ();return Math.sqrt(f*f+y*y+P*P)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(c){this.y=c}},{key:"distance",value:function(c){var f=this.x-c.x,y=this.y-c.y;return Math.sqrt(f*f+y*y)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*c+v.hashCode(this.x))+v.hashCode(this.y)}},{key:"setCoordinate",value:function(c){this.x=c.x,this.y=c.y,this.z=c.getZ()}},{key:"interfaces_",get:function(){return[Ie,Ue,qe]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)v.constructor_.call(this,0,0);else if(arguments.length===1){var c=arguments[0];v.constructor_.call(this,c.x,c.y,c.getZ())}else if(arguments.length===2){var f=arguments[0],y=arguments[1];v.constructor_.call(this,f,y,v.NULL_ORDINATE)}else if(arguments.length===3){var P=arguments[0],F=arguments[1],Z=arguments[2];this.x=P,this.y=F,this.z=Z}}},{key:"hashCode",value:function(c){return Hn[0]=c,kr[0]^kr[1]}}])}(),Ls=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"compare",value:function(c,f){var y=v.compare(c.x,f.x);if(y!==0)return y;var P=v.compare(c.y,f.y);return P!==0?P:this._dimensionsToTest<=2?0:v.compare(c.getZ(),f.getZ())}},{key:"interfaces_",get:function(){return[Ht]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)v.constructor_.call(this,2);else if(arguments.length===1){var c=arguments[0];if(c!==2&&c!==3)throw new vt("only 2 or 3 dimensions may be specified");this._dimensionsToTest=c}}},{key:"compare",value:function(c,f){return c<f?-1:c>f?1:at.isNaN(c)?at.isNaN(f)?0:-1:at.isNaN(f)?1:0}}])}();Dt.DimensionalComparator=Ls,Dt.NULL_ORDINATE=at.NaN,Dt.X=0,Dt.Y=1,Dt.Z=2,Dt.M=3;var Pe=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(c){if(!(c instanceof v))return!1;var f=c;return this.isNull()?f.isNull():this._maxx===f.getMaxX()&&this._maxy===f.getMaxY()&&this._minx===f.getMinX()&&this._miny===f.getMinY()}},{key:"intersection",value:function(c){if(this.isNull()||c.isNull()||!this.intersects(c))return new v;var f=this._minx>c._minx?this._minx:c._minx,y=this._miny>c._miny?this._miny:c._miny;return new v(f,this._maxx<c._maxx?this._maxx:c._maxx,y,this._maxy<c._maxy?this._maxy:c._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var c=arguments[0];return this.covers(c.x,c.y)}if(arguments[0]instanceof v){var f=arguments[0];return!this.isNull()&&!f.isNull()&&f.getMinX()>=this._minx&&f.getMaxX()<=this._maxx&&f.getMinY()>=this._miny&&f.getMaxY()<=this._maxy}}else if(arguments.length===2){var y=arguments[0],P=arguments[1];return!this.isNull()&&y>=this._minx&&y<=this._maxx&&P>=this._miny&&P<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return!this.isNull()&&!c.isNull()&&!(c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny)}if(arguments[0]instanceof Dt){var f=arguments[0];return this.intersects(f.x,f.y)}}else if(arguments.length===2){if(arguments[0]instanceof Dt&&arguments[1]instanceof Dt){var y=arguments[0],P=arguments[1];return!this.isNull()&&!((y.x<P.x?y.x:P.x)>this._maxx)&&!((y.x>P.x?y.x:P.x)<this._minx)&&!((y.y<P.y?y.y:P.y)>this._maxy)&&!((y.y>P.y?y.y:P.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var F=arguments[0],Z=arguments[1];return!this.isNull()&&!(F>this._maxx||F<this._minx||Z>this._maxy||Z<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var c=this.getWidth(),f=this.getHeight();return Math.sqrt(c*c+f*f)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var c=arguments[0];this.expandToInclude(c.x,c.y)}else if(arguments[0]instanceof v){var f=arguments[0];if(f.isNull())return null;this.isNull()?(this._minx=f.getMinX(),this._maxx=f.getMaxX(),this._miny=f.getMinY(),this._maxy=f.getMaxY()):(f._minx<this._minx&&(this._minx=f._minx),f._maxx>this._maxx&&(this._maxx=f._maxx),f._miny<this._miny&&(this._miny=f._miny),f._maxy>this._maxy&&(this._maxy=f._maxy))}}else if(arguments.length===2){var y=arguments[0],P=arguments[1];this.isNull()?(this._minx=y,this._maxx=y,this._miny=P,this._maxy=P):(y<this._minx&&(this._minx=y),y>this._maxx&&(this._maxx=y),P<this._miny&&(this._miny=P),P>this._maxy&&(this._maxy=P))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),f=this.getHeight();return c<f?c:f}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(c){var f=c;return this.isNull()?f.isNull()?0:-1:f.isNull()?1:this._minx<f._minx?-1:this._minx>f._minx?1:this._miny<f._miny?-1:this._miny>f._miny?1:this._maxx<f._maxx?-1:this._maxx>f._maxx?1:this._maxy<f._maxy?-1:this._maxy>f._maxy?1:0}},{key:"translate",value:function(c,f){if(this.isNull())return null;this.init(this.getMinX()+c,this.getMaxX()+c,this.getMinY()+f,this.getMaxY()+f)}},{key:"copy",value:function(){return new v(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(c){return!(!this.isNull()&&!c.isNull())||c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),f=this.getHeight();return c>f?c:f}},{key:"expandBy",value:function(){if(arguments.length===1){var c=arguments[0];this.expandBy(c,c)}else if(arguments.length===2){var f=arguments[0],y=arguments[1];if(this.isNull())return null;this._minx-=f,this._maxx+=f,this._miny-=y,this._maxy+=y,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return this.covers(c)}if(arguments[0]instanceof Dt){var f=arguments[0];return this.covers(f)}}else if(arguments.length===2){var y=arguments[0],P=arguments[1];return this.covers(y,P)}}},{key:"centre",value:function(){return this.isNull()?null:new Dt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Dt){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof v){var f=arguments[0];this._minx=f._minx,this._maxx=f._maxx,this._miny=f._miny,this._maxy=f._maxy}}else if(arguments.length===2){var y=arguments[0],P=arguments[1];this.init(y.x,P.x,y.y,P.y)}else if(arguments.length===4){var F=arguments[0],Z=arguments[1],re=arguments[2],Te=arguments[3];F<Z?(this._minx=F,this._maxx=Z):(this._minx=Z,this._maxx=F),re<Te?(this._miny=re,this._maxy=Te):(this._miny=Te,this._maxy=re)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(c){if(this.intersects(c))return 0;var f=0;this._maxx<c._minx?f=c._minx-this._maxx:this._minx>c._maxx&&(f=this._minx-c._maxx);var y=0;return this._maxy<c._miny?y=c._miny-this._maxy:this._miny>c._maxy&&(y=this._miny-c._maxy),f===0?y:y===0?f:Math.sqrt(f*f+y*y)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*(c=37*(c=37*c+Dt.hashCode(this._minx))+Dt.hashCode(this._maxx))+Dt.hashCode(this._miny))+Dt.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[Ie,qe]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Dt){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof v){var f=arguments[0];this.init(f)}}else if(arguments.length===2){var y=arguments[0],P=arguments[1];this.init(y.x,P.x,y.y,P.y)}else if(arguments.length===4){var F=arguments[0],Z=arguments[1],re=arguments[2],Te=arguments[3];this.init(F,Z,re,Te)}}},{key:"intersects",value:function(){if(arguments.length===3){var c=arguments[0],f=arguments[1],y=arguments[2];return y.x>=(c.x<f.x?c.x:f.x)&&y.x<=(c.x>f.x?c.x:f.x)&&y.y>=(c.y<f.y?c.y:f.y)&&y.y<=(c.y>f.y?c.y:f.y)}if(arguments.length===4){var P=arguments[0],F=arguments[1],Z=arguments[2],re=arguments[3],Te=Math.min(Z.x,re.x),Xe=Math.max(Z.x,re.x),Yt=Math.min(P.x,F.x),Si=Math.max(P.x,F.x);return!(Yt>Xe)&&!(Si<Te)&&(Te=Math.min(Z.y,re.y),Xe=Math.max(Z.y,re.y),Yt=Math.min(P.y,F.y),Si=Math.max(P.y,F.y),!(Yt>Xe)&&!(Si<Te))}}}])}(),$n=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===v.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(c){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(c){return this===c||this.equalsExact(c,0)}},{key:"geometryChanged",value:function(){this.apply(v.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(c){return c!==null&&this.norm().equalsExact(c.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var c;if(arguments.length===1){var f=arguments[0];return c=f,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(f)}if(arguments.length===2){var y=arguments[0],P=arguments[1];return c=y,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(y,P)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(c){if(c.getTypeCode()===v.TYPECODE_GEOMETRYCOLLECTION)throw new vt("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(c,f,y){return y===0?c.equals(f):c.distance(f)<=y}},{key:"norm",value:function(){var c=this.copy();return c.normalize(),c}},{key:"reverse",value:function(){var c=this.reverseInternal();return this.envelope!=null&&(c.envelope=this.envelope.copy()),c.setSRID(this.getSRID()),c}},{key:"copy",value:function(){var c=this.copyInternal();return c.envelope=this._envelope==null?null:this._envelope.copy(),c._SRID=this._SRID,c._userData=this._userData,c}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Pe(this._envelope)}},{key:"setSRID",value:function(c){this._SRID=c}},{key:"setUserData",value:function(c){this._userData=c}},{key:"compare",value:function(c,f){for(var y=c.iterator(),P=f.iterator();y.hasNext()&&P.hasNext();){var F=y.next(),Z=P.next(),re=F.compareTo(Z);if(re!==0)return re}return y.hasNext()?1:P.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(c){return this.getClass()===c.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===v.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===v.TYPECODE_MULTIPOINT||this.getTypeCode()===v.TYPECODE_MULTILINESTRING||this.getTypeCode()===v.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Ue,Ie,qe]}},{key:"getClass",value:function(){return v}}],[{key:"hasNonEmptyElements",value:function(c){for(var f=0;f<c.length;f++)if(!c[f].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(c){for(var f=0;f<c.length;f++)if(c[f]===null)return!0;return!1}}])}();$n.constructor_=function(v){v&&(this._envelope=null,this._userData=null,this._factory=v,this._SRID=v.getSRID())},$n.TYPECODE_POINT=0,$n.TYPECODE_MULTIPOINT=1,$n.TYPECODE_LINESTRING=2,$n.TYPECODE_LINEARRING=3,$n.TYPECODE_MULTILINESTRING=4,$n.TYPECODE_POLYGON=5,$n.TYPECODE_MULTIPOLYGON=6,$n.TYPECODE_GEOMETRYCOLLECTION=7,$n.TYPENAME_POINT="Point",$n.TYPENAME_MULTIPOINT="MultiPoint",$n.TYPENAME_LINESTRING="LineString",$n.TYPENAME_LINEARRING="LinearRing",$n.TYPENAME_MULTILINESTRING="MultiLineString",$n.TYPENAME_POLYGON="Polygon",$n.TYPENAME_MULTIPOLYGON="MultiPolygon",$n.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",$n.geometryChangedFilter={get interfaces_(){return[Be]},filter:function(v){v.geometryChangedAction()}};var lt=function(){function v(){xe(this,v)}return s(v,null,[{key:"toLocationSymbol",value:function(c){switch(c){case v.EXTERIOR:return"e";case v.BOUNDARY:return"b";case v.INTERIOR:return"i";case v.NONE:return"-"}throw new vt("Unknown location value: "+c)}}])}();lt.INTERIOR=0,lt.BOUNDARY=1,lt.EXTERIOR=2,lt.NONE=-1;var cs=function(){return s(function v(){xe(this,v)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])}(),Xi=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c,[f])).name=Object.keys({NoSuchElementException:c})[0],y}return $t(c,v),s(c)}(dt),vs=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c,[f])).name=Object.keys({UnsupportedOperationException:c})[0],y}return $t(c,v),s(c)}(dt),Bs=function(v){function c(){return xe(this,c),Tt(this,c,arguments)}return $t(c,v),s(c,[{key:"contains",value:function(){}}])}(cs),Xs=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c)).map=new Map,f instanceof cs&&y.addAll(f),y}return $t(c,v),s(c,[{key:"contains",value:function(f){var y=f.hashCode?f.hashCode():f;return!!this.map.has(y)}},{key:"add",value:function(f){var y=f.hashCode?f.hashCode():f;return!this.map.has(y)&&!!this.map.set(y,f)}},{key:"addAll",value:function(f){var y,P=xn(f);try{for(P.s();!(y=P.n()).done;){var F=y.value;this.add(F)}}catch(Z){P.e(Z)}finally{P.f()}return!0}},{key:"remove",value:function(){throw new vs}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Sr(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(Bs),Sr=function(){return s(function v(c){xe(this,v),this.iterator=c.values();var f=this.iterator.next(),y=f.done,P=f.value;this.done=y,this.value=P},[{key:"next",value:function(){if(this.done)throw new Xi;var v=this.value,c=this.iterator.next(),f=c.done,y=c.value;return this.done=f,this.value=y,v}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new vs}}])}(),un=function(){function v(){xe(this,v)}return s(v,null,[{key:"opposite",value:function(c){return c===v.LEFT?v.RIGHT:c===v.RIGHT?v.LEFT:c}}])}();un.ON=0,un.LEFT=1,un.RIGHT=2;var ys=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c,[f])).name=Object.keys({EmptyStackException:c})[0],y}return $t(c,v),s(c)}(dt),Hs=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c,[f])).name=Object.keys({IndexOutOfBoundsException:c})[0],y}return $t(c,v),s(c)}(dt),ls=function(v){function c(){return xe(this,c),Tt(this,c,arguments)}return $t(c,v),s(c,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(cs),Rs=function(v){function c(){var f;return xe(this,c),(f=Tt(this,c)).array=[],f}return $t(c,v),s(c,[{key:"add",value:function(f){return this.array.push(f),!0}},{key:"get",value:function(f){if(f<0||f>=this.size())throw new Hs;return this.array[f]}},{key:"push",value:function(f){return this.array.push(f),f}},{key:"pop",value:function(){if(this.array.length===0)throw new ys;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new ys;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(f){return this.array.indexOf(f)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}(ls);function cn(v,c){return v.interfaces_&&v.interfaces_.indexOf(c)>-1}var Jr=function(){return s(function v(c){xe(this,v),this.str=c},[{key:"append",value:function(v){this.str+=v}},{key:"setCharAt",value:function(v,c){this.str=this.str.substr(0,v)+c+this.str.substr(v+1)}},{key:"toString",value:function(){return this.str}}])}(),Pr=function(){function v(c){xe(this,v),this.value=c}return s(v,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(c){return this.value<c?-1:this.value>c?1:0}}],[{key:"compare",value:function(c,f){return c<f?-1:c>f?1:0}},{key:"isNan",value:function(c){return Number.isNaN(c)}},{key:"valueOf",value:function(c){return new v(c)}}])}(),Ts=function(){return s(function v(){xe(this,v)},null,[{key:"isWhitespace",value:function(v){return v<=32&&v>=0||v===127}},{key:"toUpperCase",value:function(v){return v.toUpperCase()}}])}(),Dn=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"le",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<=c._lo}},{key:"extractSignificantDigits",value:function(c,f){var y=this.abs(),P=v.magnitude(y._hi),F=v.TEN.pow(P);(y=y.divide(F)).gt(v.TEN)?(y=y.divide(v.TEN),P+=1):y.lt(v.ONE)&&(y=y.multiply(v.TEN),P-=1);for(var Z=P+1,re=new Jr,Te=v.MAX_PRINT_DIGITS-1,Xe=0;Xe<=Te;Xe++){c&&Xe===Z&&re.append(".");var Yt=Math.trunc(y._hi);if(Yt<0)break;var Si=!1,bn=0;Yt>9?(Si=!0,bn="9"):bn="0"+Yt,re.append(bn),y=y.subtract(v.valueOf(Yt)).multiply(v.TEN),Si&&y.selfAdd(v.TEN);var Jn=!0,br=v.magnitude(y._hi);if(br<0&&Math.abs(br)>=Te-Xe&&(Jn=!1),!Jn)break}return f[0]=P,re.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return this.add(c.negate())}if(typeof arguments[0]=="number"){var f=arguments[0];return this.add(-f)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof v){var c=arguments[0];return this._hi===c._hi&&this._lo===c._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return this.isNaN()?this:this.selfAdd(-c._hi,-c._lo)}if(typeof arguments[0]=="number"){var f=arguments[0];return this.isNaN()?this:this.selfAdd(-f,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(c){return this.le(c)?this:c}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return this.selfDivide(c._hi,c._lo)}if(typeof arguments[0]=="number"){var f=arguments[0];return this.selfDivide(f,0)}}else if(arguments.length===2){var y,P,F,Z,re=arguments[0],Te=arguments[1],Xe=null,Yt=null,Si=null,bn=null;return F=this._hi/re,bn=(Xe=(Si=v.SPLIT*F)-(Xe=Si-F))*(Yt=(bn=v.SPLIT*re)-(Yt=bn-re))-(Z=F*re)+Xe*(P=re-Yt)+(y=F-Xe)*Yt+y*P,bn=F+(Si=(this._hi-Z-bn+this._lo-F*Te)/re),this._hi=bn,this._lo=F-bn+Si,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof v){var c,f,y,P,F=arguments[0],Z=null,re=null,Te=null,Xe=null;return c=(y=this._hi/F._hi)-(Z=(Te=v.SPLIT*y)-(Z=Te-y)),Xe=Z*(re=(Xe=v.SPLIT*F._hi)-(re=Xe-F._hi))-(P=y*F._hi)+Z*(f=F._hi-re)+c*re+c*f,new v(Xe=y+(Te=(this._hi-P-Xe+this._lo-y*F._lo)/F._hi),y-Xe+Te)}if(typeof arguments[0]=="number"){var Yt=arguments[0];return at.isNaN(Yt)?v.createNaN():v.copy(this).selfDivide(Yt,0)}}},{key:"ge",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>=c._lo}},{key:"pow",value:function(c){if(c===0)return v.valueOf(1);var f=new v(this),y=v.valueOf(1),P=Math.abs(c);if(P>1)for(;P>0;)P%2==1&&y.selfMultiply(f),(P/=2)>0&&(f=f.sqr());else y=f;return c<0?y.reciprocal():y}},{key:"ceil",value:function(){if(this.isNaN())return v.NaN;var c=Math.ceil(this._hi),f=0;return c===this._hi&&(f=Math.ceil(this._lo)),new v(c,f)}},{key:"compareTo",value:function(c){var f=c;return this._hi<f._hi?-1:this._hi>f._hi?1:this._lo<f._lo?-1:this._lo>f._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return this.init(c),this}if(typeof arguments[0]=="number"){var f=arguments[0];return this.init(f),this}}},{key:"max",value:function(c){return this.ge(c)?this:c}},{key:"sqrt",value:function(){if(this.isZero())return v.valueOf(0);if(this.isNegative())return v.NaN;var c=1/Math.sqrt(this._hi),f=this._hi*c,y=v.valueOf(f),P=this.subtract(y.sqr())._hi*(.5*c);return y.add(P)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return this.selfAdd(c._hi,c._lo)}if(typeof arguments[0]=="number"){var f,y,P,F,Z,re=arguments[0],Te=null;return Te=(P=this._hi+re)-(F=P-this._hi),y=(Z=(Te=re-F+(this._hi-Te))+this._lo)+(P-(f=P+Z)),this._hi=f+y,this._lo=y+(f-this._hi),this}}else if(arguments.length===2){var Xe,Yt,Si,bn,Jn=arguments[0],br=arguments[1],Dr=null,ts=null,os=null;Si=this._hi+Jn,Yt=this._lo+br,ts=Si-(os=Si-this._hi),Dr=Yt-(bn=Yt-this._lo);var Ds=(Xe=Si+(os=(ts=Jn-os+(this._hi-ts))+Yt))+(os=(Dr=br-bn+(this._lo-Dr))+(os+(Si-Xe))),mo=os+(Xe-Ds);return this._hi=Ds,this._lo=mo,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return this.selfMultiply(c._hi,c._lo)}if(typeof arguments[0]=="number"){var f=arguments[0];return this.selfMultiply(f,0)}}else if(arguments.length===2){var y,P,F=arguments[0],Z=arguments[1],re=null,Te=null,Xe=null,Yt=null;re=(Xe=v.SPLIT*this._hi)-this._hi,Yt=v.SPLIT*F,re=Xe-re,y=this._hi-re,Te=Yt-F;var Si=(Xe=this._hi*F)+(Yt=re*(Te=Yt-Te)-Xe+re*(P=F-Te)+y*Te+y*P+(this._hi*Z+this._lo*F)),bn=Yt+(re=Xe-Si);return this._hi=Si,this._lo=bn,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return v.NaN;var c=Math.floor(this._hi),f=0;return c===this._hi&&(f=Math.floor(this._lo)),new v(c,f)}},{key:"negate",value:function(){return this.isNaN()?this:new v(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return null;throw c}}},{key:"multiply",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return c.isNaN()?v.createNaN():v.copy(this).selfMultiply(c)}if(typeof arguments[0]=="number"){var f=arguments[0];return at.isNaN(f)?v.createNaN():v.copy(this).selfMultiply(f,0)}}},{key:"isNaN",value:function(){return at.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var c=v.magnitude(this._hi);return c>=-3&&c<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var c=this.getSpecialNumberString();if(c!==null)return c;var f=new Array(1).fill(null),y=this.extractSignificantDigits(!0,f),P=f[0]+1,F=y;if(y.charAt(0)===".")F="0"+y;else if(P<0)F="0."+v.stringOfChar("0",-P)+y;else if(y.indexOf(".")===-1){var Z=P-y.length;F=y+v.stringOfChar("0",Z)+".0"}return this.isNegative()?"-"+F:F}},{key:"reciprocal",value:function(){var c,f,y,P,F=null,Z=null,re=null,Te=null;c=(y=1/this._hi)-(F=(re=v.SPLIT*y)-(F=re-y)),Z=(Te=v.SPLIT*this._hi)-this._hi;var Xe=y+(re=(1-(P=y*this._hi)-(Te=F*(Z=Te-Z)-P+F*(f=this._hi-Z)+c*Z+c*f)-y*this._lo)/this._hi);return new v(Xe,y-Xe+re)}},{key:"toSciNotation",value:function(){if(this.isZero())return v.SCI_NOT_ZERO;var c=this.getSpecialNumberString();if(c!==null)return c;var f=new Array(1).fill(null),y=this.extractSignificantDigits(!1,f),P=v.SCI_NOT_EXPONENT_CHAR+f[0];if(y.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+y);var F="";y.length>1&&(F=y.substring(1));var Z=y.charAt(0)+"."+F;return this.isNegative()?"-"+Z+P:Z+P}},{key:"abs",value:function(){return this.isNaN()?v.NaN:this.isNegative()?this.negate():new v(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<c._lo}},{key:"add",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return v.copy(this).selfAdd(c)}if(typeof arguments[0]=="number"){var f=arguments[0];return v.copy(this).selfAdd(f)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this._hi=c,this._lo=0}else if(arguments[0]instanceof v){var f=arguments[0];this._hi=f._hi,this._lo=f._lo}}else if(arguments.length===2){var y=arguments[0],P=arguments[1];this._hi=y,this._lo=P}}},{key:"gt",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>c._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?v.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[qe,Ie,Ue]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this.init(c)}else if(arguments[0]instanceof v){var f=arguments[0];this.init(f)}else if(typeof arguments[0]=="string"){var y=arguments[0];v.constructor_.call(this,v.parse(y))}}else if(arguments.length===2){var P=arguments[0],F=arguments[1];this.init(P,F)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],f=arguments[1],y=arguments[2],P=arguments[3];return v.determinant(v.valueOf(c),v.valueOf(f),v.valueOf(y),v.valueOf(P))}if(arguments[3]instanceof v&&arguments[2]instanceof v&&arguments[0]instanceof v&&arguments[1]instanceof v){var F=arguments[1],Z=arguments[2],re=arguments[3];return arguments[0].multiply(re).selfSubtract(F.multiply(Z))}}},{key:"sqr",value:function(c){return v.valueOf(c).selfMultiply(c)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var c=arguments[0];return v.parse(c)}if(typeof arguments[0]=="number")return new v(arguments[0])}},{key:"sqrt",value:function(c){return v.valueOf(c).sqrt()}},{key:"parse",value:function(c){for(var f=0,y=c.length;Ts.isWhitespace(c.charAt(f));)f++;var P=!1;if(f<y){var F=c.charAt(f);F!=="-"&&F!=="+"||(f++,F==="-"&&(P=!0))}for(var Z=new v,re=0,Te=0,Xe=0,Yt=!1;!(f>=y);){var Si=c.charAt(f);if(f++,Ts.isDigit(Si)){var bn=Si-"0";Z.selfMultiply(v.TEN),Z.selfAdd(bn),re++}else{if(Si!=="."){if(Si==="e"||Si==="E"){var Jn=c.substring(f);try{Xe=Pr.parseInt(Jn)}catch(Ds){throw Ds instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Jn+" in string "+c):Ds}break}throw new NumberFormatException("Unexpected character '"+Si+"' at position "+f+" in string "+c)}Te=re,Yt=!0}}var br=Z;Yt||(Te=re);var Dr=re-Te-Xe;if(Dr===0)br=Z;else if(Dr>0){var ts=v.TEN.pow(Dr);br=Z.divide(ts)}else if(Dr<0){var os=v.TEN.pow(-Dr);br=Z.multiply(os)}return P?br.negate():br}},{key:"createNaN",value:function(){return new v(at.NaN,at.NaN)}},{key:"copy",value:function(c){return new v(c)}},{key:"magnitude",value:function(c){var f=Math.abs(c),y=Math.log(f)/Math.log(10),P=Math.trunc(Math.floor(y));return 10*Math.pow(10,P)<=f&&(P+=1),P}},{key:"stringOfChar",value:function(c,f){for(var y=new Jr,P=0;P<f;P++)y.append(c);return y.toString()}}])}();Dn.PI=new Dn(3.141592653589793,12246467991473532e-32),Dn.TWO_PI=new Dn(6.283185307179586,24492935982947064e-32),Dn.PI_2=new Dn(1.5707963267948966,6123233995736766e-32),Dn.E=new Dn(2.718281828459045,14456468917292502e-32),Dn.NaN=new Dn(at.NaN,at.NaN),Dn.EPS=123259516440783e-46,Dn.SPLIT=134217729,Dn.MAX_PRINT_DIGITS=32,Dn.TEN=Dn.valueOf(10),Dn.ONE=Dn.valueOf(1),Dn.SCI_NOT_EXPONENT_CHAR="E",Dn.SCI_NOT_ZERO="0.0E0";var xs=function(){function v(){xe(this,v)}return s(v,null,[{key:"orientationIndex",value:function(c,f,y){var P=v.orientationIndexFilter(c,f,y);if(P<=1)return P;var F=Dn.valueOf(f.x).selfAdd(-c.x),Z=Dn.valueOf(f.y).selfAdd(-c.y),re=Dn.valueOf(y.x).selfAdd(-f.x),Te=Dn.valueOf(y.y).selfAdd(-f.y);return F.selfMultiply(Te).selfSubtract(Z.selfMultiply(re)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof Dn&&arguments[2]instanceof Dn&&arguments[0]instanceof Dn&&arguments[1]instanceof Dn){var c=arguments[1],f=arguments[2],y=arguments[3];return arguments[0].multiply(y).selfSubtract(c.multiply(f)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var P=arguments[0],F=arguments[1],Z=arguments[2],re=arguments[3],Te=Dn.valueOf(P),Xe=Dn.valueOf(F),Yt=Dn.valueOf(Z),Si=Dn.valueOf(re);return Te.multiply(Si).selfSubtract(Xe.multiply(Yt)).signum()}}},{key:"intersection",value:function(c,f,y,P){var F=new Dn(c.y).selfSubtract(f.y),Z=new Dn(f.x).selfSubtract(c.x),re=new Dn(c.x).selfMultiply(f.y).selfSubtract(new Dn(f.x).selfMultiply(c.y)),Te=new Dn(y.y).selfSubtract(P.y),Xe=new Dn(P.x).selfSubtract(y.x),Yt=new Dn(y.x).selfMultiply(P.y).selfSubtract(new Dn(P.x).selfMultiply(y.y)),Si=Z.multiply(Yt).selfSubtract(Xe.multiply(re)),bn=Te.multiply(re).selfSubtract(F.multiply(Yt)),Jn=F.multiply(Xe).selfSubtract(Te.multiply(Z)),br=Si.selfDivide(Jn).doubleValue(),Dr=bn.selfDivide(Jn).doubleValue();return at.isNaN(br)||at.isInfinite(br)||at.isNaN(Dr)||at.isInfinite(Dr)?null:new Dt(br,Dr)}},{key:"orientationIndexFilter",value:function(c,f,y){var P=null,F=(c.x-y.x)*(f.y-y.y),Z=(c.y-y.y)*(f.x-y.x),re=F-Z;if(F>0){if(Z<=0)return v.signum(re);P=F+Z}else{if(!(F<0)||Z>=0)return v.signum(re);P=-F-Z}var Te=v.DP_SAFE_EPSILON*P;return re>=Te||-re>=Te?v.signum(re):2}},{key:"signum",value:function(c){return c>0?1:c<0?-1:0}}])}();xs.DP_SAFE_EPSILON=1e-15;var Gn=function(){return s(function v(){xe(this,v)},[{key:"getM",value:function(v){if(this.hasM()){var c=this.getDimension()-this.getMeasures();return this.getOrdinate(v,c)}return at.NaN}},{key:"setOrdinate",value:function(v,c,f){}},{key:"getZ",value:function(v){return this.hasZ()?this.getOrdinate(v,2):at.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(v,c){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(v){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(v){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(v){}},{key:"copy",value:function(){}},{key:"getY",value:function(v){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[Ue]}}])}();Gn.X=0,Gn.Y=1,Gn.Z=2,Gn.M=3;var Ir=function(){function v(){xe(this,v)}return s(v,null,[{key:"index",value:function(c,f,y){return xs.orientationIndex(c,f,y)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var c=arguments[0],f=c.length-1;if(f<3)throw new vt("Ring has fewer than 4 points, so orientation cannot be determined");for(var y=c[0],P=0,F=1;F<=f;F++){var Z=c[F];Z.y>y.y&&(y=Z,P=F)}var re=P;do(re-=1)<0&&(re=f);while(c[re].equals2D(y)&&re!==P);var Te=P;do Te=(Te+1)%f;while(c[Te].equals2D(y)&&Te!==P);var Xe=c[re],Yt=c[Te];if(Xe.equals2D(y)||Yt.equals2D(y)||Xe.equals2D(Yt))return!1;var Si=v.index(Xe,y,Yt);return Si===0?Xe.x>Yt.x:Si>0}if(cn(arguments[0],Gn)){var bn=arguments[0],Jn=bn.size()-1;if(Jn<3)throw new vt("Ring has fewer than 4 points, so orientation cannot be determined");for(var br=bn.getCoordinate(0),Dr=0,ts=1;ts<=Jn;ts++){var os=bn.getCoordinate(ts);os.y>br.y&&(br=os,Dr=ts)}var Ds=null,mo=Dr;do(mo-=1)<0&&(mo=Jn),Ds=bn.getCoordinate(mo);while(Ds.equals2D(br)&&mo!==Dr);var uo=null,ta=Dr;do ta=(ta+1)%Jn,uo=bn.getCoordinate(ta);while(uo.equals2D(br)&&ta!==Dr);if(Ds.equals2D(br)||uo.equals2D(br)||Ds.equals2D(uo))return!1;var ga=v.index(Ds,br,uo);return ga===0?Ds.x>uo.x:ga>0}}}])}();Ir.CLOCKWISE=-1,Ir.RIGHT=Ir.CLOCKWISE,Ir.COUNTERCLOCKWISE=1,Ir.LEFT=Ir.COUNTERCLOCKWISE,Ir.COLLINEAR=0,Ir.STRAIGHT=Ir.COLLINEAR;var fo=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(v,c){var f=this.getRightmostSideOfSegment(v,c);return f<0&&(f=this.getRightmostSideOfSegment(v,c-1)),f<0&&(this._minCoord=null,this.checkForRightmostCoordinate(v)),f}},{key:"findRightmostEdgeAtVertex",value:function(){var v=this._minDe.getEdge().getCoordinates();Mn.isTrue(this._minIndex>0&&this._minIndex<v.length,"rightmost point expected to be interior vertex of edge");var c=v[this._minIndex-1],f=v[this._minIndex+1],y=Ir.index(this._minCoord,f,c),P=!1;(c.y<this._minCoord.y&&f.y<this._minCoord.y&&y===Ir.COUNTERCLOCKWISE||c.y>this._minCoord.y&&f.y>this._minCoord.y&&y===Ir.CLOCKWISE)&&(P=!0),P&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(v,c){var f=v.getEdge().getCoordinates();if(c<0||c+1>=f.length||f[c].y===f[c+1].y)return-1;var y=un.LEFT;return f[c].y<f[c+1].y&&(y=un.RIGHT),y}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(v){for(var c=v.getEdge().getCoordinates(),f=0;f<c.length-1;f++)(this._minCoord===null||c[f].x>this._minCoord.x)&&(this._minDe=v,this._minIndex=f,this._minCoord=c[f])}},{key:"findRightmostEdgeAtNode",value:function(){var v=this._minDe.getNode().getEdges();this._minDe=v.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(v){for(var c=v.iterator();c.hasNext();){var f=c.next();f.isForward()&&this.checkForRightmostCoordinate(f)}Mn.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===un.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])}(),ms=function(v){function c(f,y){var P;return xe(this,c),(P=Tt(this,c,[y?f+" [ "+y+" ]":f])).pt=y?new Dt(y):void 0,P.name=Object.keys({TopologyException:c})[0],P}return $t(c,v),s(c,[{key:"getCoordinate",value:function(){return this.pt}}])}(Qi),Co=function(){return s(function v(){xe(this,v),this.array=[]},[{key:"addLast",value:function(v){this.array.push(v)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])}(),mr=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c)).array=[],f instanceof cs&&y.addAll(f),y}return $t(c,v),s(c,[{key:"interfaces_",get:function(){return[ls,cs]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(f){return arguments.length===1?this.array.push(f):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(f){var y,P=xn(f);try{for(P.s();!(y=P.n()).done;){var F=y.value;this.array.push(F)}}catch(Z){P.e(Z)}finally{P.f()}}},{key:"set",value:function(f,y){var P=this.array[f];return this.array[f]=y,P}},{key:"iterator",value:function(){return new Ss(this)}},{key:"get",value:function(f){if(f<0||f>=this.size())throw new Hs;return this.array[f]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(f){f?this.array.sort(function(y,P){return f.compare(y,P)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(f){for(var y=0,P=this.array.length;y<P;y++)if(this.array[y]===f)return!!this.array.splice(y,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}(ls),Ss=function(){return s(function v(c){xe(this,v),this.arrayList=c,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Xi;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(v){return this.arrayList.set(this.position-1,v)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])}(),ks=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var v=this._dirEdgeList.iterator();v.hasNext();)v.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(v){for(var c=null,f=v.getEdges().iterator();f.hasNext();){var y=f.next();if(y.isVisited()||y.getSym().isVisited()){c=y;break}}if(c===null)throw new ms("unable to find edge to compute depths at "+v.getCoordinate());v.getEdges().computeDepths(c);for(var P=v.getEdges().iterator();P.hasNext();){var F=P.next();F.setVisited(!0),this.copySymDepths(F)}}},{key:"computeDepth",value:function(v){this.clearVisitedEdges();var c=this._finder.getEdge();c.getNode(),c.getLabel(),c.setEdgeDepths(un.RIGHT,v),this.copySymDepths(c),this.computeDepths(c)}},{key:"create",value:function(v){this.addReachable(v),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var v=this._dirEdgeList.iterator();v.hasNext();){var c=v.next();c.getDepth(un.RIGHT)>=1&&c.getDepth(un.LEFT)<=0&&!c.isInteriorAreaEdge()&&c.setInResult(!0)}}},{key:"computeDepths",value:function(v){var c=new Xs,f=new Co,y=v.getNode();for(f.addLast(y),c.add(y),v.setVisited(!0);!f.isEmpty();){var P=f.removeFirst();c.add(P),this.computeNodeDepth(P);for(var F=P.getEdges().iterator();F.hasNext();){var Z=F.next().getSym();if(!Z.isVisited()){var re=Z.getNode();c.contains(re)||(f.addLast(re),c.add(re))}}}}},{key:"compareTo",value:function(v){var c=v;return this._rightMostCoord.x<c._rightMostCoord.x?-1:this._rightMostCoord.x>c._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var v=new Pe,c=this._dirEdgeList.iterator();c.hasNext();)for(var f=c.next().getEdge().getCoordinates(),y=0;y<f.length-1;y++)v.expandToInclude(f[y]);this._env=v}return this._env}},{key:"addReachable",value:function(v){var c=new Rs;for(c.add(v);!c.empty();){var f=c.pop();this.add(f,c)}}},{key:"copySymDepths",value:function(v){var c=v.getSym();c.setDepth(un.LEFT,v.getDepth(un.RIGHT)),c.setDepth(un.RIGHT,v.getDepth(un.LEFT))}},{key:"add",value:function(v,c){v.setVisited(!0),this._nodes.add(v);for(var f=v.getEdges().iterator();f.hasNext();){var y=f.next();this._dirEdgeList.add(y);var P=y.getSym().getNode();P.isVisited()||c.push(P)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[Ie]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new mr,this._nodes=new mr,this._rightMostCoord=null,this._env=null,this._finder=new fo}}])}(),ur=function(){return s(function v(){xe(this,v)},null,[{key:"intersection",value:function(v,c,f,y){var P=v.x<c.x?v.x:c.x,F=v.y<c.y?v.y:c.y,Z=v.x>c.x?v.x:c.x,re=v.y>c.y?v.y:c.y,Te=f.x<y.x?f.x:y.x,Xe=f.y<y.y?f.y:y.y,Yt=f.x>y.x?f.x:y.x,Si=f.y>y.y?f.y:y.y,bn=((P>Te?P:Te)+(Z<Yt?Z:Yt))/2,Jn=((F>Xe?F:Xe)+(re<Si?re:Si))/2,br=v.x-bn,Dr=v.y-Jn,ts=c.x-bn,os=c.y-Jn,Ds=f.x-bn,mo=f.y-Jn,uo=y.x-bn,ta=y.y-Jn,ga=Dr-os,ja=ts-br,al=br*os-ts*Dr,Ya=mo-ta,Ra=uo-Ds,ka=Ds*ta-uo*mo,jr=ga*Ra-Ya*ja,ll=(ja*ka-Ra*al)/jr,Oa=(Ya*al-ga*ka)/jr;return at.isNaN(ll)||at.isInfinite(ll)||at.isNaN(Oa)||at.isInfinite(Oa)?null:new Dt(ll+bn,Oa+Jn)}}])}(),_e=function(){return s(function v(){xe(this,v)},null,[{key:"arraycopy",value:function(v,c,f,y,P){for(var F=0,Z=c;Z<c+P;Z++)f[y+F]=v[Z],F++}},{key:"getProperty",value:function(v){return{"line.separator":`
`}[v]}}])}(),he=function(){function v(){xe(this,v)}return s(v,null,[{key:"log10",value:function(c){var f=Math.log(c);return at.isInfinite(f)||at.isNaN(f)?f:f/v.LOG_10}},{key:"min",value:function(c,f,y,P){var F=c;return f<F&&(F=f),y<F&&(F=y),P<F&&(F=P),F}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],f=arguments[1],y=arguments[2];return c<f?f:c>y?y:c}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var P=arguments[0],F=arguments[1],Z=arguments[2];return P<F?F:P>Z?Z:P}}},{key:"wrap",value:function(c,f){return c<0?f- -c%f:c%f}},{key:"max",value:function(){if(arguments.length===3){var c=arguments[1],f=arguments[2],y=arguments[0];return c>y&&(y=c),f>y&&(y=f),y}if(arguments.length===4){var P=arguments[1],F=arguments[2],Z=arguments[3],re=arguments[0];return P>re&&(re=P),F>re&&(re=F),Z>re&&(re=Z),re}}},{key:"average",value:function(c,f){return(c+f)/2}}])}();he.LOG_10=Math.log(10);var pe=function(){function v(){xe(this,v)}return s(v,null,[{key:"segmentToSegment",value:function(c,f,y,P){if(c.equals(f))return v.pointToSegment(c,y,P);if(y.equals(P))return v.pointToSegment(P,c,f);var F=!1;if(Pe.intersects(c,f,y,P)){var Z=(f.x-c.x)*(P.y-y.y)-(f.y-c.y)*(P.x-y.x);if(Z===0)F=!0;else{var re=(c.y-y.y)*(P.x-y.x)-(c.x-y.x)*(P.y-y.y),Te=((c.y-y.y)*(f.x-c.x)-(c.x-y.x)*(f.y-c.y))/Z,Xe=re/Z;(Xe<0||Xe>1||Te<0||Te>1)&&(F=!0)}}else F=!0;return F?he.min(v.pointToSegment(c,y,P),v.pointToSegment(f,y,P),v.pointToSegment(y,c,f),v.pointToSegment(P,c,f)):0}},{key:"pointToSegment",value:function(c,f,y){if(f.x===y.x&&f.y===y.y)return c.distance(f);var P=(y.x-f.x)*(y.x-f.x)+(y.y-f.y)*(y.y-f.y),F=((c.x-f.x)*(y.x-f.x)+(c.y-f.y)*(y.y-f.y))/P;if(F<=0)return c.distance(f);if(F>=1)return c.distance(y);var Z=((f.y-c.y)*(y.x-f.x)-(f.x-c.x)*(y.y-f.y))/P;return Math.abs(Z)*Math.sqrt(P)}},{key:"pointToLinePerpendicular",value:function(c,f,y){var P=(y.x-f.x)*(y.x-f.x)+(y.y-f.y)*(y.y-f.y),F=((f.y-c.y)*(y.x-f.x)-(f.x-c.x)*(y.y-f.y))/P;return Math.abs(F)*Math.sqrt(P)}},{key:"pointToSegmentString",value:function(c,f){if(f.length===0)throw new vt("Line array must contain at least one vertex");for(var y=c.distance(f[0]),P=0;P<f.length-1;P++){var F=v.pointToSegment(c,f[P],f[P+1]);F<y&&(y=F)}return y}}])}(),Re=function(){return s(function v(){xe(this,v)},[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||cn(arguments[0],Gn);else if(arguments.length!==2){if(arguments.length===3){var v=arguments[0],c=arguments[1];return this.create(v,c)}}}}])}(),ke=function(){return s(function v(){xe(this,v)},[{key:"filter",value:function(v){}}])}(),ui=function(){return s(function v(){xe(this,v)},null,[{key:"ofLine",value:function(v){var c=v.size();if(c<=1)return 0;var f=0,y=new Dt;v.getCoordinate(0,y);for(var P=y.x,F=y.y,Z=1;Z<c;Z++){v.getCoordinate(Z,y);var re=y.x,Te=y.y,Xe=re-P,Yt=Te-F;f+=Math.sqrt(Xe*Xe+Yt*Yt),P=re,F=Te}return f}}])}(),Vt=s(function v(){xe(this,v)}),fi=function(){function v(){xe(this,v)}return s(v,null,[{key:"copyCoord",value:function(c,f,y,P){for(var F=Math.min(c.getDimension(),y.getDimension()),Z=0;Z<F;Z++)y.setOrdinate(P,Z,c.getOrdinate(f,Z))}},{key:"isRing",value:function(c){var f=c.size();return f===0||!(f<=3)&&c.getOrdinate(0,Gn.X)===c.getOrdinate(f-1,Gn.X)&&c.getOrdinate(0,Gn.Y)===c.getOrdinate(f-1,Gn.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(cn(arguments[0],Gn)&&Number.isInteger(arguments[1])){var c=arguments[0],f=arguments[1];v.scroll(c,f,v.isRing(c))}else if(cn(arguments[0],Gn)&&arguments[1]instanceof Dt){var y=arguments[0],P=arguments[1],F=v.indexOf(P,y);if(F<=0)return null;v.scroll(y,F)}}else if(arguments.length===3){var Z=arguments[0],re=arguments[1],Te=arguments[2];if(re<=0)return null;for(var Xe=Z.copy(),Yt=Te?Z.size()-1:Z.size(),Si=0;Si<Yt;Si++)for(var bn=0;bn<Z.getDimension();bn++)Z.setOrdinate(Si,bn,Xe.getOrdinate((re+Si)%Yt,bn));if(Te)for(var Jn=0;Jn<Z.getDimension();Jn++)Z.setOrdinate(Yt,Jn,Z.getOrdinate(0,Jn))}}},{key:"isEqual",value:function(c,f){var y=c.size();if(y!==f.size())return!1;for(var P=Math.min(c.getDimension(),f.getDimension()),F=0;F<y;F++)for(var Z=0;Z<P;Z++){var re=c.getOrdinate(F,Z),Te=f.getOrdinate(F,Z);if(c.getOrdinate(F,Z)!==f.getOrdinate(F,Z)&&(!at.isNaN(re)||!at.isNaN(Te)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var c=arguments[0];return v.minCoordinateIndex(c,0,c.size()-1)}if(arguments.length===3){for(var f=arguments[0],y=arguments[2],P=-1,F=null,Z=arguments[1];Z<=y;Z++){var re=f.getCoordinate(Z);(F===null||F.compareTo(re)>0)&&(F=re,P=Z)}return P}}},{key:"extend",value:function(c,f,y){var P=c.create(y,f.getDimension()),F=f.size();if(v.copy(f,0,P,0,F),F>0)for(var Z=F;Z<y;Z++)v.copy(f,F-1,P,Z,1);return P}},{key:"reverse",value:function(c){for(var f=c.size()-1,y=Math.trunc(f/2),P=0;P<=y;P++)v.swap(c,P,f-P)}},{key:"swap",value:function(c,f,y){if(f===y)return null;for(var P=0;P<c.getDimension();P++){var F=c.getOrdinate(f,P);c.setOrdinate(f,P,c.getOrdinate(y,P)),c.setOrdinate(y,P,F)}}},{key:"copy",value:function(c,f,y,P,F){for(var Z=0;Z<F;Z++)v.copyCoord(c,f+Z,y,P+Z)}},{key:"ensureValidRing",value:function(c,f){var y=f.size();return y===0?f:y<=3?v.createClosedRing(c,f,4):f.getOrdinate(0,Gn.X)===f.getOrdinate(y-1,Gn.X)&&f.getOrdinate(0,Gn.Y)===f.getOrdinate(y-1,Gn.Y)?f:v.createClosedRing(c,f,y+1)}},{key:"indexOf",value:function(c,f){for(var y=0;y<f.size();y++)if(c.x===f.getOrdinate(y,Gn.X)&&c.y===f.getOrdinate(y,Gn.Y))return y;return-1}},{key:"createClosedRing",value:function(c,f,y){var P=c.create(y,f.getDimension()),F=f.size();v.copy(f,0,P,0,F);for(var Z=F;Z<y;Z++)v.copy(f,0,P,Z,1);return P}},{key:"minCoordinate",value:function(c){for(var f=null,y=0;y<c.size();y++){var P=c.getCoordinate(y);(f===null||f.compareTo(P)>0)&&(f=P)}return f}}])}(),Zt=function(){function v(){xe(this,v)}return s(v,null,[{key:"toDimensionSymbol",value:function(c){switch(c){case v.FALSE:return v.SYM_FALSE;case v.TRUE:return v.SYM_TRUE;case v.DONTCARE:return v.SYM_DONTCARE;case v.P:return v.SYM_P;case v.L:return v.SYM_L;case v.A:return v.SYM_A}throw new vt("Unknown dimension value: "+c)}},{key:"toDimensionValue",value:function(c){switch(Ts.toUpperCase(c)){case v.SYM_FALSE:return v.FALSE;case v.SYM_TRUE:return v.TRUE;case v.SYM_DONTCARE:return v.DONTCARE;case v.SYM_P:return v.P;case v.SYM_L:return v.L;case v.SYM_A:return v.A}throw new vt("Unknown dimension symbol: "+c)}}])}();Zt.P=0,Zt.L=1,Zt.A=2,Zt.FALSE=-1,Zt.TRUE=-2,Zt.DONTCARE=-3,Zt.SYM_FALSE="F",Zt.SYM_TRUE="T",Zt.SYM_DONTCARE="*",Zt.SYM_P="0",Zt.SYM_L="1",Zt.SYM_A="2";var en=function(){return s(function v(){xe(this,v)},[{key:"filter",value:function(v){}}])}(),Un=function(){return s(function v(){xe(this,v)},[{key:"filter",value:function(v,c){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])}(),Bn=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Pe:this._points.expandEnvelope(new Pe)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new c(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof $n){var f=arguments[0],y=arguments[1];if(!this.isEquivalentClass(f))return!1;var P=f;if(this._points.size()!==P._points.size())return!1;for(var F=0;F<this._points.size();F++)if(!this.equal(this._points.getCoordinate(F),P._points.getCoordinate(F),y))return!1;return!0}return ct(c,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var f=0;f<Math.trunc(this._points.size()/2);f++){var y=this._points.size()-1-f;if(!this._points.getCoordinate(f).equals(this._points.getCoordinate(y))){if(this._points.getCoordinate(f).compareTo(this._points.getCoordinate(y))>0){var P=this._points.copy();fi.reverse(P),this._points=P}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Zt.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var f=this._points.copy();return fi.reverse(f),this.getFactory().createLineString(f)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return $n.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return ui.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var f=arguments[0],y=0,P=0;y<this._points.size()&&P<f._points.size();){var F=this._points.getCoordinate(y).compareTo(f._points.getCoordinate(P));if(F!==0)return F;y++,P++}return y<this._points.size()?1:P<f._points.size()?-1:0}if(arguments.length===2){var Z=arguments[0];return arguments[1].compare(this._points,Z._points)}}},{key:"apply",value:function(){if(cn(arguments[0],ke))for(var f=arguments[0],y=0;y<this._points.size();y++)f.filter(this._points.getCoordinate(y));else if(cn(arguments[0],Un)){var P=arguments[0];if(this._points.size()===0)return null;for(var F=0;F<this._points.size()&&(P.filter(this._points,F),!P.isDone());F++);P.isGeometryChanged()&&this.geometryChanged()}else cn(arguments[0],en)?arguments[0].filter(this):cn(arguments[0],Be)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new vs}},{key:"isEquivalentClass",value:function(f){return f instanceof c}},{key:"getCoordinateN",value:function(f){return this._points.getCoordinate(f)}},{key:"getGeometryType",value:function(){return $n.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(f){if(f===null&&(f=this.getFactory().getCoordinateSequenceFactory().create([])),f.size()===1)throw new vt("Invalid number of points in LineString (found "+f.size()+" - must be 0 or >= 2)");this._points=f}},{key:"isCoordinate",value:function(f){for(var y=0;y<this._points.size();y++)if(this._points.getCoordinate(y).equals(f))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(f){return this.getFactory().createPoint(this._points.getCoordinate(f))}},{key:"interfaces_",get:function(){return[Vt]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var f=arguments[0],y=arguments[1];$n.constructor_.call(this,y),this.init(f)}}}}])}($n),Or=s(function v(){xe(this,v)}),hs=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Pe;var f=new Pe;return f.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),f}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new c(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof $n){var f=arguments[0],y=arguments[1];return!!this.isEquivalentClass(f)&&(!(!this.isEmpty()||!f.isEmpty())||this.isEmpty()===f.isEmpty()&&this.equal(f.getCoordinate(),this.getCoordinate(),y))}return ct(c,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return Zt.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return $n.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var f=arguments[0];return this.getCoordinate().compareTo(f.getCoordinate())}if(arguments.length===2){var y=arguments[0];return arguments[1].compare(this._coordinates,y._coordinates)}}},{key:"apply",value:function(){if(cn(arguments[0],ke)){var f=arguments[0];if(this.isEmpty())return null;f.filter(this.getCoordinate())}else if(cn(arguments[0],Un)){var y=arguments[0];if(this.isEmpty())return null;y.filter(this._coordinates,0),y.isGeometryChanged()&&this.geometryChanged()}else cn(arguments[0],en)?arguments[0].filter(this):cn(arguments[0],Be)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return $n.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(f){f===null&&(f=this.getFactory().getCoordinateSequenceFactory().create([])),Mn.isTrue(f.size()<=1),this._coordinates=f}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Or]}}],[{key:"constructor_",value:function(){this._coordinates=null;var f=arguments[0],y=arguments[1];$n.constructor_.call(this,y),this.init(f)}}])}($n),Vs=function(){function v(){xe(this,v)}return s(v,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];return Math.abs(v.ofRingSigned(c))}if(cn(arguments[0],Gn)){var f=arguments[0];return Math.abs(v.ofRingSigned(f))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];if(c.length<3)return 0;for(var f=0,y=c[0].x,P=1;P<c.length-1;P++){var F=c[P].x-y,Z=c[P+1].y;f+=F*(c[P-1].y-Z)}return f/2}if(cn(arguments[0],Gn)){var re=arguments[0],Te=re.size();if(Te<3)return 0;var Xe=new Dt,Yt=new Dt,Si=new Dt;re.getCoordinate(0,Yt),re.getCoordinate(1,Si);var bn=Yt.x;Si.x-=bn;for(var Jn=0,br=1;br<Te-1;br++)Xe.y=Yt.y,Yt.x=Si.x,Yt.y=Si.y,re.getCoordinate(br+1,Si),Si.x-=bn,Jn+=Yt.x*(Xe.y-Si.y);return Jn/2}}}])}(),qr=function(){return s(function v(){xe(this,v)},null,[{key:"sort",value:function(){var v=arguments,c=arguments[0];if(arguments.length===1)c.sort(function(bn,Jn){return bn.compareTo(Jn)});else if(arguments.length===2)c.sort(function(bn,Jn){return v[1].compare(bn,Jn)});else if(arguments.length===3){var f=c.slice(arguments[1],arguments[2]);f.sort();var y=c.slice(0,arguments[1]).concat(f,c.slice(arguments[2],c.length));c.splice(0,c.length);var P,F=xn(y);try{for(F.s();!(P=F.n()).done;){var Z=P.value;c.push(Z)}}catch(bn){F.e(bn)}finally{F.f()}}else if(arguments.length===4){var re=c.slice(arguments[1],arguments[2]);re.sort(function(bn,Jn){return v[3].compare(bn,Jn)});var Te=c.slice(0,arguments[1]).concat(re,c.slice(arguments[2],c.length));c.splice(0,c.length);var Xe,Yt=xn(Te);try{for(Yt.s();!(Xe=Yt.n()).done;){var Si=Xe.value;c.push(Si)}}catch(bn){Yt.e(bn)}finally{Yt.f()}}}},{key:"asList",value:function(v){var c,f=new mr,y=xn(v);try{for(y.s();!(c=y.n()).done;){var P=c.value;f.add(P)}}catch(F){y.e(F)}finally{y.f()}return f}},{key:"copyOf",value:function(v,c){return v.slice(0,c)}}])}(),ds=s(function v(){xe(this,v)}),gt=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var f=new Array(this.getNumPoints()).fill(null),y=-1,P=this._shell.getCoordinates(),F=0;F<P.length;F++)f[++y]=P[F];for(var Z=0;Z<this._holes.length;Z++)for(var re=this._holes[Z].getCoordinates(),Te=0;Te<re.length;Te++)f[++y]=re[Te];return f}},{key:"getArea",value:function(){var f=0;f+=Vs.ofRing(this._shell.getCoordinateSequence());for(var y=0;y<this._holes.length;y++)f-=Vs.ofRing(this._holes[y].getCoordinateSequence());return f}},{key:"copyInternal",value:function(){for(var f=this._shell.copy(),y=new Array(this._holes.length).fill(null),P=0;P<this._holes.length;P++)y[P]=this._holes[P].copy();return new c(f,y,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var f=this._shell.getCoordinateSequence(),y=this.getEnvelopeInternal(),P=0;P<5;P++){var F=f.getX(P);if(F!==y.getMinX()&&F!==y.getMaxX())return!1;var Z=f.getY(P);if(Z!==y.getMinY()&&Z!==y.getMaxY())return!1}for(var re=f.getX(0),Te=f.getY(0),Xe=1;Xe<=4;Xe++){var Yt=f.getX(Xe),Si=f.getY(Xe);if(Yt!==re==(Si!==Te))return!1;re=Yt,Te=Si}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof $n){var f=arguments[0],y=arguments[1];if(!this.isEquivalentClass(f))return!1;var P=f,F=this._shell,Z=P._shell;if(!F.equalsExact(Z,y)||this._holes.length!==P._holes.length)return!1;for(var re=0;re<this._holes.length;re++)if(!this._holes[re].equalsExact(P._holes[re],y))return!1;return!0}return ct(c,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var f=0;f<this._holes.length;f++)this._holes[f]=this.normalized(this._holes[f],!1);qr.sort(this._holes)}else if(arguments.length===2){var y=arguments[0],P=arguments[1];if(y.isEmpty())return null;var F=y.getCoordinateSequence(),Z=fi.minCoordinateIndex(F,0,F.size()-2);fi.scroll(F,Z,!0),Ir.isCCW(F)===P&&fi.reverse(F)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var f=this.getExteriorRing().reverse(),y=new Array(this.getNumInteriorRing()).fill(null),P=0;P<y.length;P++)y[P]=this.getInteriorRingN(P).reverse();return this.getFactory().createPolygon(f,y)}},{key:"getTypeCode",value:function(){return $n.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var f=0;f+=this._shell.getLength();for(var y=0;y<this._holes.length;y++)f+=this._holes[y].getLength();return f}},{key:"getNumPoints",value:function(){for(var f=this._shell.getNumPoints(),y=0;y<this._holes.length;y++)f+=this._holes[y].getNumPoints();return f}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(f,y){var P=f.copy();return this.normalize(P,y),P}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var f=arguments[0],y=this._shell,P=f._shell;return y.compareToSameClass(P)}if(arguments.length===2){var F=arguments[1],Z=arguments[0],re=this._shell,Te=Z._shell,Xe=re.compareToSameClass(Te,F);if(Xe!==0)return Xe;for(var Yt=this.getNumInteriorRing(),Si=Z.getNumInteriorRing(),bn=0;bn<Yt&&bn<Si;){var Jn=this.getInteriorRingN(bn),br=Z.getInteriorRingN(bn),Dr=Jn.compareToSameClass(br,F);if(Dr!==0)return Dr;bn++}return bn<Yt?1:bn<Si?-1:0}}},{key:"apply",value:function(){if(cn(arguments[0],ke)){var f=arguments[0];this._shell.apply(f);for(var y=0;y<this._holes.length;y++)this._holes[y].apply(f)}else if(cn(arguments[0],Un)){var P=arguments[0];if(this._shell.apply(P),!P.isDone())for(var F=0;F<this._holes.length&&(this._holes[F].apply(P),!P.isDone());F++);P.isGeometryChanged()&&this.geometryChanged()}else if(cn(arguments[0],en))arguments[0].filter(this);else if(cn(arguments[0],Be)){var Z=arguments[0];Z.filter(this),this._shell.apply(Z);for(var re=0;re<this._holes.length;re++)this._holes[re].apply(Z)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var f=new Array(this._holes.length+1).fill(null);f[0]=this._shell;for(var y=0;y<this._holes.length;y++)f[y+1]=this._holes[y];return f.length<=1?this.getFactory().createLinearRing(f[0].getCoordinateSequence()):this.getFactory().createMultiLineString(f)}},{key:"getGeometryType",value:function(){return $n.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(f){return this._holes[f]}},{key:"interfaces_",get:function(){return[ds]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var f=arguments[0],y=arguments[1],P=arguments[2];if($n.constructor_.call(this,P),f===null&&(f=this.getFactory().createLinearRing()),y===null&&(y=[]),$n.hasNullElements(y))throw new vt("holes must not contain null elements");if(f.isEmpty()&&$n.hasNonEmptyElements(y))throw new vt("shell is empty but holes are not");this._shell=f,this._holes=y}}])}($n),q=function(v){function c(){return xe(this,c),Tt(this,c,arguments)}return $t(c,v),s(c)}(Bs),ee=function(v){function c(f){var y;return xe(this,c),(y=Tt(this,c)).array=[],f instanceof cs&&y.addAll(f),y}return $t(c,v),s(c,[{key:"contains",value:function(f){var y,P=xn(this.array);try{for(P.s();!(y=P.n()).done;)if(y.value.compareTo(f)===0)return!0}catch(F){P.e(F)}finally{P.f()}return!1}},{key:"add",value:function(f){if(this.contains(f))return!1;for(var y=0,P=this.array.length;y<P;y++)if(this.array[y].compareTo(f)===1)return!!this.array.splice(y,0,f);return this.array.push(f),!0}},{key:"addAll",value:function(f){var y,P=xn(f);try{for(P.s();!(y=P.n()).done;){var F=y.value;this.add(F)}}catch(Z){P.e(Z)}finally{P.f()}return!0}},{key:"remove",value:function(){throw new vs}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new oe(this.array)}}])}(q),oe=function(){return s(function v(c){xe(this,v),this.array=c,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new Xi;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new vs}}])}(),Ee=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"computeEnvelopeInternal",value:function(){for(var f=new Pe,y=0;y<this._geometries.length;y++)f.expandToInclude(this._geometries[y].getEnvelopeInternal());return f}},{key:"getGeometryN",value:function(f){return this._geometries[f]}},{key:"getCoordinates",value:function(){for(var f=new Array(this.getNumPoints()).fill(null),y=-1,P=0;P<this._geometries.length;P++)for(var F=this._geometries[P].getCoordinates(),Z=0;Z<F.length;Z++)f[++y]=F[Z];return f}},{key:"getArea",value:function(){for(var f=0,y=0;y<this._geometries.length;y++)f+=this._geometries[y].getArea();return f}},{key:"copyInternal",value:function(){for(var f=new Array(this._geometries.length).fill(null),y=0;y<f.length;y++)f[y]=this._geometries[y].copy();return new c(f,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof $n){var f=arguments[0],y=arguments[1];if(!this.isEquivalentClass(f))return!1;var P=f;if(this._geometries.length!==P._geometries.length)return!1;for(var F=0;F<this._geometries.length;F++)if(!this._geometries[F].equalsExact(P._geometries[F],y))return!1;return!0}return ct(c,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var f=0;f<this._geometries.length;f++)this._geometries[f].normalize();qr.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var f=Zt.FALSE,y=0;y<this._geometries.length;y++)f=Math.max(f,this._geometries[y].getBoundaryDimension());return f}},{key:"reverseInternal",value:function(){for(var f=this._geometries.length,y=new mr(f),P=0;P<f;P++)y.add(this._geometries[P].reverse());return this.getFactory().buildGeometry(y)}},{key:"getTypeCode",value:function(){return $n.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var f=Zt.FALSE,y=0;y<this._geometries.length;y++)f=Math.max(f,this._geometries[y].getDimension());return f}},{key:"getLength",value:function(){for(var f=0,y=0;y<this._geometries.length;y++)f+=this._geometries[y].getLength();return f}},{key:"getNumPoints",value:function(){for(var f=0,y=0;y<this._geometries.length;y++)f+=this._geometries[y].getNumPoints();return f}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var f=arguments[0],y=new ee(qr.asList(this._geometries)),P=new ee(qr.asList(f._geometries));return this.compare(y,P)}if(arguments.length===2){for(var F=arguments[1],Z=arguments[0],re=this.getNumGeometries(),Te=Z.getNumGeometries(),Xe=0;Xe<re&&Xe<Te;){var Yt=this.getGeometryN(Xe),Si=Z.getGeometryN(Xe),bn=Yt.compareToSameClass(Si,F);if(bn!==0)return bn;Xe++}return Xe<re?1:Xe<Te?-1:0}}},{key:"apply",value:function(){if(cn(arguments[0],ke))for(var f=arguments[0],y=0;y<this._geometries.length;y++)this._geometries[y].apply(f);else if(cn(arguments[0],Un)){var P=arguments[0];if(this._geometries.length===0)return null;for(var F=0;F<this._geometries.length&&(this._geometries[F].apply(P),!P.isDone());F++);P.isGeometryChanged()&&this.geometryChanged()}else if(cn(arguments[0],en)){var Z=arguments[0];Z.filter(this);for(var re=0;re<this._geometries.length;re++)this._geometries[re].apply(Z)}else if(cn(arguments[0],Be)){var Te=arguments[0];Te.filter(this);for(var Xe=0;Xe<this._geometries.length;Xe++)this._geometries[Xe].apply(Te)}}},{key:"getBoundary",value:function(){return $n.checkNotGeometryCollection(this),Mn.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return $n.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var f=0;f<this._geometries.length;f++)if(!this._geometries[f].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var f=arguments[0],y=arguments[1];if($n.constructor_.call(this,y),f===null&&(f=[]),$n.hasNullElements(f))throw new vt("geometries must not contain null elements");this._geometries=f}}}}])}($n),be=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"copyInternal",value:function(){for(var f=new Array(this._geometries.length).fill(null),y=0;y<f.length;y++)f[y]=this._geometries[y].copy();return new c(f,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof $n){var f=arguments[0],y=arguments[1];return!!this.isEquivalentClass(f)&&ct(c,"equalsExact",this,1).call(this,f,y)}return ct(c,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var f=arguments[0];return this._geometries[f].getCoordinate()}return ct(c,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return Zt.FALSE}},{key:"getTypeCode",value:function(){return $n.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return $n.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Or]}}],[{key:"constructor_",value:function(){var f=arguments[0],y=arguments[1];Ee.constructor_.call(this,f,y)}}])}(Ee),Ce=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"copyInternal",value:function(){return new c(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return Zt.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||ct(c,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var f=this._points.copy();return fi.reverse(f),this.getFactory().createLinearRing(f)}},{key:"getTypeCode",value:function(){return $n.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!ct(c,"isClosed",this,1).call(this))throw new vt("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<c.MINIMUM_VALID_SIZE)throw new vt("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return $n.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var f=arguments[0],y=arguments[1];Bn.constructor_.call(this,f,y),this.validateConstruction()}}])}(Bn);Ce.MINIMUM_VALID_SIZE=4;var Y=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"setOrdinate",value:function(f,y){switch(f){case c.X:this.x=y;break;case c.Y:this.y=y;break;default:throw new vt("Invalid ordinate index: "+f)}}},{key:"getZ",value:function(){return Dt.NULL_ORDINATE}},{key:"getOrdinate",value:function(f){switch(f){case c.X:return this.x;case c.Y:return this.y}throw new vt("Invalid ordinate index: "+f)}},{key:"setZ",value:function(f){throw new vt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new c(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(f){this.x=f.x,this.y=f.y,this.z=f.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Dt.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof c){var f=arguments[0];Dt.constructor_.call(this,f.x,f.y)}else if(arguments[0]instanceof Dt){var y=arguments[0];Dt.constructor_.call(this,y.x,y.y)}}else if(arguments.length===2){var P=arguments[0],F=arguments[1];Dt.constructor_.call(this,P,F,Dt.NULL_ORDINATE)}}}])}(Dt);Y.X=0,Y.Y=1,Y.Z=-1,Y.M=-1;var K=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(f,y){switch(f){case c.X:this.x=y;break;case c.Y:this.y=y;break;case c.M:this._m=y;break;default:throw new vt("Invalid ordinate index: "+f)}}},{key:"setM",value:function(f){this._m=f}},{key:"getZ",value:function(){return Dt.NULL_ORDINATE}},{key:"getOrdinate",value:function(f){switch(f){case c.X:return this.x;case c.Y:return this.y;case c.M:return this._m}throw new vt("Invalid ordinate index: "+f)}},{key:"setZ",value:function(f){throw new vt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new c(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(f){this.x=f.x,this.y=f.y,this.z=f.getZ(),this._m=f.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Dt.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof c){var f=arguments[0];Dt.constructor_.call(this,f.x,f.y),this._m=f._m}else if(arguments[0]instanceof Dt){var y=arguments[0];Dt.constructor_.call(this,y.x,y.y),this._m=this.getM()}}else if(arguments.length===3){var P=arguments[0],F=arguments[1],Z=arguments[2];Dt.constructor_.call(this,P,F,Dt.NULL_ORDINATE),this._m=Z}}}])}(Dt);K.X=0,K.Y=1,K.Z=-1,K.M=2;var se=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(f,y){switch(f){case Dt.X:this.x=y;break;case Dt.Y:this.y=y;break;case Dt.Z:this.z=y;break;case Dt.M:this._m=y;break;default:throw new vt("Invalid ordinate index: "+f)}}},{key:"setM",value:function(f){this._m=f}},{key:"getOrdinate",value:function(f){switch(f){case Dt.X:return this.x;case Dt.Y:return this.y;case Dt.Z:return this.getZ();case Dt.M:return this.getM()}throw new vt("Invalid ordinate index: "+f)}},{key:"copy",value:function(){return new c(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(f){this.x=f.x,this.y=f.y,this.z=f.getZ(),this._m=f.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Dt.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof c){var f=arguments[0];Dt.constructor_.call(this,f),this._m=f._m}else if(arguments[0]instanceof Dt){var y=arguments[0];Dt.constructor_.call(this,y),this._m=this.getM()}}else if(arguments.length===4){var P=arguments[0],F=arguments[1],Z=arguments[2],re=arguments[3];Dt.constructor_.call(this,P,F,Z),this._m=re}}}])}(Dt),fe=function(){function v(){xe(this,v)}return s(v,null,[{key:"measures",value:function(c){return c instanceof Y?0:c instanceof K||c instanceof se?1:0}},{key:"dimension",value:function(c){return c instanceof Y?2:c instanceof K?3:c instanceof se?4:3}},{key:"create",value:function(){if(arguments.length===1){var c=arguments[0];return v.create(c,0)}if(arguments.length===2){var f=arguments[0],y=arguments[1];return f===2?new Y:f===3&&y===0?new Dt:f===3&&y===1?new K:f===4&&y===1?new se:new Dt}}}])}(),ce=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"getCoordinate",value:function(f){return this.get(f)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&cn(arguments[0],cs)){for(var f=arguments[1],y=!1,P=arguments[0].iterator();P.hasNext();)this.add(P.next(),f),y=!0;return y}return ct(c,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var f=ct(c,"clone",this,1).call(this),y=0;y<this.size();y++)f.add(y,this.get(y).clone());return f}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(c.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(c.coordArrayType);for(var f=this.size(),y=new Array(f).fill(null),P=0;P<f;P++)y[P]=this.get(f-P-1);return y}}},{key:"add",value:function(){if(arguments.length===1){var f=arguments[0];return ct(c,"add",this,1).call(this,f)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var y=arguments[0],P=arguments[1];return this.add(y,P,!0),!0}if(arguments[0]instanceof Dt&&typeof arguments[1]=="boolean"){var F=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(F))return null;ct(c,"add",this,1).call(this,F)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var Z=arguments[0],re=arguments[1];return this.add(Z,re),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var Te=arguments[0],Xe=arguments[1];if(arguments[2])for(var Yt=0;Yt<Te.length;Yt++)this.add(Te[Yt],Xe);else for(var Si=Te.length-1;Si>=0;Si--)this.add(Te[Si],Xe);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Dt){var bn=arguments[0],Jn=arguments[1];if(!arguments[2]){var br=this.size();if(br>0&&(bn>0&&this.get(bn-1).equals2D(Jn)||bn<br&&this.get(bn).equals2D(Jn)))return null}ct(c,"add",this,1).call(this,bn,Jn)}}else if(arguments.length===4){var Dr=arguments[0],ts=arguments[1],os=arguments[2],Ds=arguments[3],mo=1;os>Ds&&(mo=-1);for(var uo=os;uo!==Ds;uo+=mo)this.add(Dr[uo],ts);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var f=this.get(0).copy();this.add(f,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var f=arguments[0];this.ensureCapacity(f.length),this.add(f,!0)}else if(arguments.length===2){var y=arguments[0],P=arguments[1];this.ensureCapacity(y.length),this.add(y,P)}}}}])}(mr);ce.coordArrayType=new Array(0).fill(null);var Se=function(){function v(){xe(this,v)}return s(v,null,[{key:"isRing",value:function(c){return!(c.length<4)&&!!c[0].equals2D(c[c.length-1])}},{key:"ptNotInList",value:function(c,f){for(var y=0;y<c.length;y++){var P=c[y];if(v.indexOf(P,f)<0)return P}return null}},{key:"scroll",value:function(c,f){var y=v.indexOf(f,c);if(y<0)return null;var P=new Array(c.length).fill(null);_e.arraycopy(c,y,P,0,c.length-y),_e.arraycopy(c,0,P,c.length-y,y),_e.arraycopy(P,0,c,0,c.length)}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],f=arguments[1];if(c===f)return!0;if(c===null||f===null||c.length!==f.length)return!1;for(var y=0;y<c.length;y++)if(!c[y].equals(f[y]))return!1;return!0}if(arguments.length===3){var P=arguments[0],F=arguments[1],Z=arguments[2];if(P===F)return!0;if(P===null||F===null||P.length!==F.length)return!1;for(var re=0;re<P.length;re++)if(Z.compare(P[re],F[re])!==0)return!1;return!0}}},{key:"intersection",value:function(c,f){for(var y=new ce,P=0;P<c.length;P++)f.intersects(c[P])&&y.add(c[P],!0);return y.toCoordinateArray()}},{key:"measures",value:function(c){if(c===null||c.length===0)return 0;var f,y=0,P=xn(c);try{for(P.s();!(f=P.n()).done;){var F=f.value;y=Math.max(y,fe.measures(F))}}catch(Z){P.e(Z)}finally{P.f()}return y}},{key:"hasRepeatedPoints",value:function(c){for(var f=1;f<c.length;f++)if(c[f-1].equals(c[f]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(c){return v.hasRepeatedPoints(c)?new ce(c,!1).toCoordinateArray():c}},{key:"reverse",value:function(c){for(var f=c.length-1,y=Math.trunc(f/2),P=0;P<=y;P++){var F=c[P];c[P]=c[f-P],c[f-P]=F}}},{key:"removeNull",value:function(c){for(var f=0,y=0;y<c.length;y++)c[y]!==null&&f++;var P=new Array(f).fill(null);if(f===0)return P;for(var F=0,Z=0;Z<c.length;Z++)c[Z]!==null&&(P[F++]=c[Z]);return P}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var c=arguments[0],f=new Array(c.length).fill(null),y=0;y<c.length;y++)f[y]=c[y].copy();return f}if(arguments.length===5)for(var P=arguments[0],F=arguments[1],Z=arguments[2],re=arguments[3],Te=arguments[4],Xe=0;Xe<Te;Xe++)Z[re+Xe]=P[F+Xe].copy()}},{key:"isEqualReversed",value:function(c,f){for(var y=0;y<c.length;y++){var P=c[y],F=f[c.length-y-1];if(P.compareTo(F)!==0)return!1}return!0}},{key:"envelope",value:function(c){for(var f=new Pe,y=0;y<c.length;y++)f.expandToInclude(c[y]);return f}},{key:"toCoordinateArray",value:function(c){return c.toArray(v.coordArrayType)}},{key:"dimension",value:function(c){if(c===null||c.length===0)return 3;var f,y=0,P=xn(c);try{for(P.s();!(f=P.n()).done;){var F=f.value;y=Math.max(y,fe.dimension(F))}}catch(Z){P.e(Z)}finally{P.f()}return y}},{key:"atLeastNCoordinatesOrNothing",value:function(c,f){return f.length>=c?f:[]}},{key:"indexOf",value:function(c,f){for(var y=0;y<f.length;y++)if(c.equals(f[y]))return y;return-1}},{key:"increasingDirection",value:function(c){for(var f=0;f<Math.trunc(c.length/2);f++){var y=c.length-1-f,P=c[f].compareTo(c[y]);if(P!==0)return P}return 1}},{key:"compare",value:function(c,f){for(var y=0;y<c.length&&y<f.length;){var P=c[y].compareTo(f[y]);if(P!==0)return P;y++}return y<f.length?-1:y<c.length?1:0}},{key:"minCoordinate",value:function(c){for(var f=null,y=0;y<c.length;y++)(f===null||f.compareTo(c[y])>0)&&(f=c[y]);return f}},{key:"extract",value:function(c,f,y){f=he.clamp(f,0,c.length);var P=(y=he.clamp(y,-1,c.length))-f+1;y<0&&(P=0),f>=c.length&&(P=0),y<f&&(P=0);var F=new Array(P).fill(null);if(P===0)return F;for(var Z=0,re=f;re<=y;re++)F[Z++]=c[re];return F}}])}(),it=function(){return s(function v(){xe(this,v)},[{key:"compare",value:function(v,c){var f=v,y=c;return Se.compare(f,y)}},{key:"interfaces_",get:function(){return[Ht]}}])}(),Ne=function(){return s(function v(){xe(this,v)},[{key:"compare",value:function(v,c){var f=v,y=c;if(f.length<y.length)return-1;if(f.length>y.length)return 1;if(f.length===0)return 0;var P=Se.compare(f,y);return Se.isEqualReversed(f,y)?0:P}},{key:"OLDcompare",value:function(v,c){var f=v,y=c;if(f.length<y.length)return-1;if(f.length>y.length)return 1;if(f.length===0)return 0;for(var P=Se.increasingDirection(f),F=Se.increasingDirection(y),Z=P>0?0:f.length-1,re=F>0?0:f.length-1,Te=0;Te<f.length;Te++){var Xe=f[Z].compareTo(y[re]);if(Xe!==0)return Xe;Z+=P,re+=F}return 0}},{key:"interfaces_",get:function(){return[Ht]}}])}();Se.ForwardComparator=it,Se.BidirectionalComparator=Ne,Se.coordArrayType=new Array(0).fill(null);var ut=function(){return s(function v(c){xe(this,v),this.str=c},[{key:"append",value:function(v){this.str+=v}},{key:"setCharAt",value:function(v,c){this.str=this.str.substr(0,v)+c+this.str.substr(v+1)}},{key:"toString",value:function(){return this.str}}])}(),Et=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getM",value:function(c){return this.hasM()?this._coordinates[c].getM():at.NaN}},{key:"setOrdinate",value:function(c,f,y){switch(f){case Gn.X:this._coordinates[c].x=y;break;case Gn.Y:this._coordinates[c].y=y;break;default:this._coordinates[c].setOrdinate(f,y)}}},{key:"getZ",value:function(c){return this.hasZ()?this._coordinates[c].getZ():at.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(c,f){switch(f){case Gn.X:return this._coordinates[c].x;case Gn.Y:return this._coordinates[c].y;default:return this._coordinates[c].getOrdinate(f)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var c=arguments[0];return this._coordinates[c]}if(arguments.length===2){var f=arguments[0];arguments[1].setCoordinate(this._coordinates[f])}}},{key:"getCoordinateCopy",value:function(c){var f=this.createCoordinate();return f.setCoordinate(this._coordinates[c]),f}},{key:"createCoordinate",value:function(){return fe.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(c){return this._coordinates[c].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(c){for(var f=0;f<this._coordinates.length;f++)c.expandToInclude(this._coordinates[f]);return c}},{key:"copy",value:function(){for(var c=new Array(this.size()).fill(null),f=0;f<this._coordinates.length;f++){var y=this.createCoordinate();y.setCoordinate(this._coordinates[f]),c[f]=y}return new v(c,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var c=new ut(17*this._coordinates.length);c.append("("),c.append(this._coordinates[0]);for(var f=1;f<this._coordinates.length;f++)c.append(", "),c.append(this._coordinates[f]);return c.append(")"),c.toString()}return"()"}},{key:"getY",value:function(c){return this._coordinates[c].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[Gn,qe]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];v.constructor_.call(this,c,Se.dimension(c),Se.measures(c))}else if(Number.isInteger(arguments[0])){var f=arguments[0];this._coordinates=new Array(f).fill(null);for(var y=0;y<f;y++)this._coordinates[y]=new Dt}else if(cn(arguments[0],Gn)){var P=arguments[0];if(P===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=P.getDimension(),this._measures=P.getMeasures(),this._coordinates=new Array(P.size()).fill(null);for(var F=0;F<this._coordinates.length;F++)this._coordinates[F]=P.getCoordinateCopy(F)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var Z=arguments[0],re=arguments[1];v.constructor_.call(this,Z,re,Se.measures(Z))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Te=arguments[0],Xe=arguments[1];this._coordinates=new Array(Te).fill(null),this._dimension=Xe;for(var Yt=0;Yt<Te;Yt++)this._coordinates[Yt]=fe.create(Xe)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var Si=arguments[0],bn=arguments[1],Jn=arguments[2];this._dimension=bn,this._measures=Jn,this._coordinates=Si===null?new Array(0).fill(null):Si}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var br=arguments[0],Dr=arguments[1],ts=arguments[2];this._coordinates=new Array(br).fill(null),this._dimension=Dr,this._measures=ts;for(var os=0;os<br;os++)this._coordinates[os]=this.createCoordinate()}}}}])}(),xt=function(){function v(){xe(this,v)}return s(v,[{key:"readResolve",value:function(){return v.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new Et(arguments[0]);if(cn(arguments[0],Gn))return new Et(arguments[0])}else{if(arguments.length===2){var c=arguments[1];return c>3&&(c=3),c<2&&(c=2),new Et(arguments[0],c)}if(arguments.length===3){var f=arguments[2],y=arguments[1]-f;return f>1&&(f=1),y>3&&(y=3),y<2&&(y=2),new Et(arguments[0],y+f,f)}}}},{key:"interfaces_",get:function(){return[Re,qe]}}],[{key:"instance",value:function(){return v.instanceObject}}])}();xt.instanceObject=new xt;var Xt=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"copyInternal",value:function(){for(var f=new Array(this._geometries.length).fill(null),y=0;y<f.length;y++)f[y]=this._geometries[y].copy();return new c(f,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof $n){var f=arguments[0],y=arguments[1];return!!this.isEquivalentClass(f)&&ct(c,"equalsExact",this,1).call(this,f,y)}return ct(c,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return $n.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var f=new mr,y=0;y<this._geometries.length;y++)for(var P=this._geometries[y].getBoundary(),F=0;F<P.getNumGeometries();F++)f.add(P.getGeometryN(F));var Z=new Array(f.size()).fill(null);return this.getFactory().createMultiLineString(f.toArray(Z))}},{key:"getGeometryType",value:function(){return $n.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[ds]}}],[{key:"constructor_",value:function(){var f=arguments[0],y=arguments[1];Ee.constructor_.call(this,f,y)}}])}(Ee),vn=function(){return s(function v(){xe(this,v)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])}(),nn=function(v){function c(){var f;return xe(this,c),(f=Tt(this,c)).map=new Map,f}return $t(c,v),s(c,[{key:"get",value:function(f){return this.map.get(f)||null}},{key:"put",value:function(f,y){return this.map.set(f,y),y}},{key:"values",value:function(){for(var f=new mr,y=this.map.values(),P=y.next();!P.done;)f.add(P.value),P=y.next();return f}},{key:"entrySet",value:function(){var f=new Xs;return this.map.entries().forEach(function(y){return f.add(y)}),f}},{key:"size",value:function(){return this.map.size()}}])}(vn),Tn=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"equals",value:function(c){if(!(c instanceof v))return!1;var f=c;return this._modelType===f._modelType&&this._scale===f._scale}},{key:"compareTo",value:function(c){var f=c,y=this.getMaximumSignificantDigits(),P=f.getMaximumSignificantDigits();return Pr.compare(y,P)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===v.FLOATING||this._modelType===v.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var c="UNKNOWN";return this._modelType===v.FLOATING?c="Floating":this._modelType===v.FLOATING_SINGLE?c="Floating-Single":this._modelType===v.FIXED&&(c="Fixed (Scale="+this.getScale()+")"),c}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var c=arguments[0];return at.isNaN(c)||this._modelType===v.FLOATING_SINGLE?c:this._modelType===v.FIXED?Math.round(c*this._scale)/this._scale:c}if(arguments[0]instanceof Dt){var f=arguments[0];if(this._modelType===v.FLOATING)return null;f.x=this.makePrecise(f.x),f.y=this.makePrecise(f.y)}}},{key:"getMaximumSignificantDigits",value:function(){var c=16;return this._modelType===v.FLOATING?c=16:this._modelType===v.FLOATING_SINGLE?c=6:this._modelType===v.FIXED&&(c=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),c}},{key:"setScale",value:function(c){this._scale=Math.abs(c)}},{key:"interfaces_",get:function(){return[qe,Ie]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=v.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Kn){var c=arguments[0];this._modelType=c,c===v.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var f=arguments[0];this._modelType=v.FIXED,this.setScale(f)}else if(arguments[0]instanceof v){var y=arguments[0];this._modelType=y._modelType,this._scale=y._scale}}}},{key:"mostPrecise",value:function(c,f){return c.compareTo(f)>=0?c:f}}])}(),Kn=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"readResolve",value:function(){return v.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[qe]}}],[{key:"constructor_",value:function(){this._name=null;var c=arguments[0];this._name=c,v.nameToTypeMap.put(c,this)}}])}();Kn.nameToTypeMap=new nn,Tn.Type=Kn,Tn.FIXED=new Kn("FIXED"),Tn.FLOATING=new Kn("FLOATING"),Tn.FLOATING_SINGLE=new Kn("FLOATING SINGLE"),Tn.maximumPreciseValue=9007199254740992;var dr=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"copyInternal",value:function(){for(var f=new Array(this._geometries.length).fill(null),y=0;y<f.length;y++)f[y]=this._geometries[y].copy();return new c(f,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof $n){var f=arguments[0],y=arguments[1];return!!this.isEquivalentClass(f)&&ct(c,"equalsExact",this,1).call(this,f,y)}return ct(c,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Zt.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var f=0;f<this._geometries.length;f++)if(!this._geometries[f].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return $n.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new vs}},{key:"getGeometryType",value:function(){return $n.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Vt]}}],[{key:"constructor_",value:function(){var f=arguments[0],y=arguments[1];Ee.constructor_.call(this,f,y)}}])}(Ee),Vn=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"createEmpty",value:function(c){switch(c){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new vt("Invalid dimension: "+c)}}},{key:"toGeometry",value:function(c){return c.isNull()?this.createPoint():c.getMinX()===c.getMaxX()&&c.getMinY()===c.getMaxY()?this.createPoint(new Dt(c.getMinX(),c.getMinY())):c.getMinX()===c.getMaxX()||c.getMinY()===c.getMaxY()?this.createLineString([new Dt(c.getMinX(),c.getMinY()),new Dt(c.getMaxX(),c.getMaxY())]):this.createPolygon(this.createLinearRing([new Dt(c.getMinX(),c.getMinY()),new Dt(c.getMinX(),c.getMaxY()),new Dt(c.getMaxX(),c.getMaxY()),new Dt(c.getMaxX(),c.getMinY()),new Dt(c.getMinX(),c.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLineString(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(cn(arguments[0],Gn))return new Bn(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new dr(null,this):arguments.length===1?new dr(arguments[0],this):void 0}},{key:"buildGeometry",value:function(c){for(var f=null,y=!1,P=!1,F=c.iterator();F.hasNext();){var Z=F.next(),re=Z.getTypeCode();f===null&&(f=re),re!==f&&(y=!0),Z instanceof Ee&&(P=!0)}if(f===null)return this.createGeometryCollection();if(y||P)return this.createGeometryCollection(v.toGeometryArray(c));var Te=c.iterator().next();if(c.size()>1){if(Te instanceof gt)return this.createMultiPolygon(v.toPolygonArray(c));if(Te instanceof Bn)return this.createMultiLineString(v.toLineStringArray(c));if(Te instanceof hs)return this.createMultiPoint(v.toPointArray(c));Mn.shouldNeverReachHere("Unhandled geometry type: "+Te.getGeometryType())}return Te}},{key:"createMultiPointFromCoords",value:function(c){return this.createMultiPoint(c!==null?this.getCoordinateSequenceFactory().create(c):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Dt){var c=arguments[0];return this.createPoint(c!==null?this.getCoordinateSequenceFactory().create([c]):null)}if(cn(arguments[0],Gn))return new hs(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(cn(arguments[0],Gn)){var c=arguments[0];return this.createPolygon(this.createLinearRing(c))}if(arguments[0]instanceof Array){var f=arguments[0];return this.createPolygon(this.createLinearRing(f))}if(arguments[0]instanceof Ce){var y=arguments[0];return this.createPolygon(y,null)}}else if(arguments.length===2)return new gt(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new Ee(null,this):arguments.length===1?new Ee(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLinearRing(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(cn(arguments[0],Gn))return new Ce(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new Xt(null,this):arguments.length===1?new Xt(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new be(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new be(arguments[0],this);if(cn(arguments[0],Gn)){var c=arguments[0];if(c===null)return this.createMultiPoint(new Array(0).fill(null));for(var f=new Array(c.size()).fill(null),y=0;y<c.size();y++){var P=this.getCoordinateSequenceFactory().create(1,c.getDimension(),c.getMeasures());fi.copy(c,y,P,0,1),f[y]=this.createPoint(P)}return this.createMultiPoint(f)}}}},{key:"interfaces_",get:function(){return[qe]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)v.constructor_.call(this,new Tn,0);else if(arguments.length===1){if(cn(arguments[0],Re)){var c=arguments[0];v.constructor_.call(this,new Tn,0,c)}else if(arguments[0]instanceof Tn){var f=arguments[0];v.constructor_.call(this,f,0,v.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var y=arguments[0],P=arguments[1];v.constructor_.call(this,y,P,v.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var F=arguments[0],Z=arguments[1],re=arguments[2];this._precisionModel=F,this._coordinateSequenceFactory=re,this._SRID=Z}}},{key:"toMultiPolygonArray",value:function(c){var f=new Array(c.size()).fill(null);return c.toArray(f)}},{key:"toGeometryArray",value:function(c){if(c===null)return null;var f=new Array(c.size()).fill(null);return c.toArray(f)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return xt.instance()}},{key:"toMultiLineStringArray",value:function(c){var f=new Array(c.size()).fill(null);return c.toArray(f)}},{key:"toLineStringArray",value:function(c){var f=new Array(c.size()).fill(null);return c.toArray(f)}},{key:"toMultiPointArray",value:function(c){var f=new Array(c.size()).fill(null);return c.toArray(f)}},{key:"toLinearRingArray",value:function(c){var f=new Array(c.size()).fill(null);return c.toArray(f)}},{key:"toPointArray",value:function(c){var f=new Array(c.size()).fill(null);return c.toArray(f)}},{key:"toPolygonArray",value:function(c){var f=new Array(c.size()).fill(null);return c.toArray(f)}},{key:"createPointFromInternalCoord",value:function(c,f){return f.getPrecisionModel().makePrecise(c),f.getFactory().createPoint(c)}}])}(),Hr="XY",Mr="XYZ",zs="XYM",Qs="XYZM",xo={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},bs="EMPTY",to=1,rs=2,ws=3,Qr=4,Ho=5,io=6;for(var ao in xo)xo[ao].toUpperCase();var Po=function(){return s(function v(c){xe(this,v),this.wkt=c,this.index_=-1},[{key:"isAlpha_",value:function(v){return v>="a"&&v<="z"||v>="A"&&v<="Z"}},{key:"isNumeric_",value:function(v,c){return v>="0"&&v<="9"||v=="."&&!(c!==void 0&&c)}},{key:"isWhiteSpace_",value:function(v){return v==" "||v=="	"||v=="\r"||v==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var v,c=this.nextChar_(),f=this.index_,y=c;if(c=="(")v=rs;else if(c==",")v=Ho;else if(c==")")v=ws;else if(this.isNumeric_(c)||c=="-")v=Qr,y=this.readNumber_();else if(this.isAlpha_(c))v=to,y=this.readText_();else{if(this.isWhiteSpace_(c))return this.nextToken();if(c!=="")throw new Error("Unexpected character: "+c);v=io}return{position:f,value:y,type:v}}},{key:"readNumber_",value:function(){var v,c=this.index_,f=!1,y=!1;do v=="."?f=!0:v!="e"&&v!="E"||(y=!0),v=this.nextChar_();while(this.isNumeric_(v,f)||!y&&(v=="e"||v=="E")||y&&(v=="-"||v=="+"));return parseFloat(this.wkt.substring(c,this.index_--))}},{key:"readText_",value:function(){var v,c=this.index_;do v=this.nextChar_();while(this.isAlpha_(v));return this.wkt.substring(c,this.index_--).toUpperCase()}}])}(),Zo=function(){return s(function v(c,f){xe(this,v),this.lexer_=c,this.token_,this.layout_=Hr,this.factory=f},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(v){return this.token_.type==v}},{key:"match",value:function(v){var c=this.isTokenType(v);return c&&this.consume_(),c}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var v=Hr,c=this.token_;if(this.isTokenType(to)){var f=c.value;f==="Z"?v=Mr:f==="M"?v=zs:f==="ZM"&&(v=Qs),v!==Hr&&this.consume_()}return v}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(rs)){var v=[];do v.push(this.parseGeometry_());while(this.match(Ho));if(this.match(ws))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(rs)){var v=this.parsePoint_();if(this.match(ws))return v}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(rs)){var v=this.parsePointList_();if(this.match(ws))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(rs)){var v=this.parseLineStringTextList_();if(this.match(ws))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var v;if(this.match(rs)){if(v=this.token_.type==rs?this.parsePointTextList_():this.parsePointList_(),this.match(ws))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(rs)){var v=this.parseLineStringTextList_();if(this.match(ws))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(rs)){var v=this.parsePolygonTextList_();if(this.match(ws))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var v=[],c=this.layout_.length,f=0;f<c;++f){var y=this.token_;if(!this.match(Qr))break;v.push(y.value)}if(v.length==c)return v;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var v=[this.parsePoint_()];this.match(Ho);)v.push(this.parsePoint_());return v}},{key:"parsePointTextList_",value:function(){for(var v=[this.parsePointText_()];this.match(Ho);)v.push(this.parsePointText_());return v}},{key:"parseLineStringTextList_",value:function(){for(var v=[this.parseLineStringText_()];this.match(Ho);)v.push(this.parseLineStringText_());return v}},{key:"parsePolygonTextList_",value:function(){for(var v=[this.parsePolygonText_()];this.match(Ho);)v.push(this.parsePolygonText_());return v}},{key:"isEmptyGeometry_",value:function(){var v=this.isTokenType(to)&&this.token_.value==bs;return v&&this.consume_(),v}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var v=this.factory,c=function(Dr){return Pi(Dt,Qt(Dr))},f=function(Dr){var ts=Dr.map(function(os){return v.createLinearRing(os.map(c))});return ts.length>1?v.createPolygon(ts[0],ts.slice(1)):v.createPolygon(ts[0])},y=this.token_;if(this.match(to)){var P=y.value;if(this.layout_=this.parseGeometryLayout_(),P=="GEOMETRYCOLLECTION"){var F=this.parseGeometryCollectionText_();return v.createGeometryCollection(F)}switch(P){case"POINT":var Z=this.parsePointText_();return Z?v.createPoint(Pi(Dt,Qt(Z))):v.createPoint();case"LINESTRING":var re=this.parseLineStringText_().map(c);return v.createLineString(re);case"LINEARRING":var Te=this.parseLineStringText_().map(c);return v.createLinearRing(Te);case"POLYGON":var Xe=this.parsePolygonText_();return Xe&&Xe.length!==0?f(Xe):v.createPolygon();case"MULTIPOINT":var Yt=this.parseMultiPointText_();if(!Yt||Yt.length===0)return v.createMultiPoint();var Si=Yt.map(c).map(function(Dr){return v.createPoint(Dr)});return v.createMultiPoint(Si);case"MULTILINESTRING":var bn=this.parseMultiLineStringText_().map(function(Dr){return v.createLineString(Dr.map(c))});return v.createMultiLineString(bn);case"MULTIPOLYGON":var Jn=this.parseMultiPolygonText_();if(!Jn||Jn.length===0)return v.createMultiPolygon();var br=Jn.map(f);return v.createMultiPolygon(br);default:throw new Error("Invalid geometry type: "+P)}}throw new Error(this.formatErrorMessage_())}}])}();function bo(v){if(v.isEmpty())return"";var c=v.getCoordinate(),f=[c.x,c.y];return c.z===void 0||Number.isNaN(c.z)||f.push(c.z),c.m===void 0||Number.isNaN(c.m)||f.push(c.m),f.join(" ")}function Oo(v){for(var c=v.getCoordinates().map(function(F){var Z=[F.x,F.y];return F.z===void 0||Number.isNaN(F.z)||Z.push(F.z),F.m===void 0||Number.isNaN(F.m)||Z.push(F.m),Z}),f=[],y=0,P=c.length;y<P;++y)f.push(c[y].join(" "));return f.join(", ")}function wo(v){var c=[];c.push("("+Oo(v.getExteriorRing())+")");for(var f=0,y=v.getNumInteriorRing();f<y;++f)c.push("("+Oo(v.getInteriorRingN(f))+")");return c.join(", ")}var ma={Point:bo,LineString:Oo,LinearRing:Oo,Polygon:wo,MultiPoint:function(v){for(var c=[],f=0,y=v.getNumGeometries();f<y;++f)c.push("("+bo(v.getGeometryN(f))+")");return c.join(", ")},MultiLineString:function(v){for(var c=[],f=0,y=v.getNumGeometries();f<y;++f)c.push("("+Oo(v.getGeometryN(f))+")");return c.join(", ")},MultiPolygon:function(v){for(var c=[],f=0,y=v.getNumGeometries();f<y;++f)c.push("("+wo(v.getGeometryN(f))+")");return c.join(", ")},GeometryCollection:function(v){for(var c=[],f=0,y=v.getNumGeometries();f<y;++f)c.push(Yo(v.getGeometryN(f)));return c.join(", ")}};function Yo(v){var c=v.getGeometryType(),f=ma[c];c=c.toUpperCase();var y=function(P){var F="";if(P.isEmpty())return F;var Z=P.getCoordinate();return Z.z===void 0||Number.isNaN(Z.z)||(F+="Z"),Z.m===void 0||Number.isNaN(Z.m)||(F+="M"),F}(v);return y.length>0&&(c+=" "+y),v.isEmpty()?c+" "+bs:c+" ("+f(v)+")"}var sa=function(){return s(function v(c){xe(this,v),this.geometryFactory=c||new Vn,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(v){var c=new Po(v);return new Zo(c,this.geometryFactory).parse()}},{key:"write",value:function(v){return Yo(v)}}])}(),la=function(){return s(function v(c){xe(this,v),this.parser=new sa(c)},[{key:"write",value:function(v){return this.parser.write(v)}}],[{key:"toLineString",value:function(v,c){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+v.x+" "+v.y+", "+c.x+" "+c.y+" )"}}])}(),Is=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getIndexAlongSegment",value:function(c,f){return this.computeIntLineIndex(),this._intLineIndex[c][f]}},{key:"getTopologySummary",value:function(){var c=new ut;return this.isEndPoint()&&c.append(" endpoint"),this._isProper&&c.append(" proper"),this.isCollinear()&&c.append(" collinear"),c.toString()}},{key:"computeIntersection",value:function(c,f,y,P){this._inputLines[0][0]=c,this._inputLines[0][1]=f,this._inputLines[1][0]=y,this._inputLines[1][1]=P,this._result=this.computeIntersect(c,f,y,P)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var c=arguments[0];this.getEdgeDistance(c,0)>this.getEdgeDistance(c,1)?(this._intLineIndex[c][0]=0,this._intLineIndex[c][1]=1):(this._intLineIndex[c][0]=1,this._intLineIndex[c][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var c=arguments[0],f=0;f<this._result;f++)if(!this._intPt[f].equals2D(this._inputLines[c][0])&&!this._intPt[f].equals2D(this._inputLines[c][1]))return!0;return!1}}},{key:"getIntersection",value:function(c){return this._intPt[c]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==v.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(c,f){return v.computeEdgeDistance(this._intPt[f],this._inputLines[c][0],this._inputLines[c][1])}},{key:"isCollinear",value:function(){return this._result===v.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return la.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+la.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(c,f){return this._inputLines[c][f]}},{key:"isIntersection",value:function(c){for(var f=0;f<this._result;f++)if(this._intPt[f].equals2D(c))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(c,f){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[c][f]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Dt,this._intPt[1]=new Dt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(c,f,y){var P=Math.abs(y.x-f.x),F=Math.abs(y.y-f.y),Z=-1;if(c.equals(f))Z=0;else if(c.equals(y))Z=P>F?P:F;else{var re=Math.abs(c.x-f.x),Te=Math.abs(c.y-f.y);(Z=P>F?re:Te)!==0||c.equals(f)||(Z=Math.max(re,Te))}return Mn.isTrue(!(Z===0&&!c.equals(f)),"Bad distance calculation"),Z}},{key:"nonRobustComputeEdgeDistance",value:function(c,f,y){var P=c.x-f.x,F=c.y-f.y,Z=Math.sqrt(P*P+F*F);return Mn.isTrue(!(Z===0&&!c.equals(f)),"Invalid distance calculation"),Z}}])}();Is.DONT_INTERSECT=0,Is.DO_INTERSECT=1,Is.COLLINEAR=2,Is.NO_INTERSECTION=0,Is.POINT_INTERSECTION=1,Is.COLLINEAR_INTERSECTION=2;var D=function(v){function c(){return xe(this,c),Tt(this,c)}return $t(c,v),s(c,[{key:"isInSegmentEnvelopes",value:function(f){var y=new Pe(this._inputLines[0][0],this._inputLines[0][1]),P=new Pe(this._inputLines[1][0],this._inputLines[1][1]);return y.contains(f)&&P.contains(f)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return ct(c,"computeIntersection",this,1).apply(this,arguments);var f=arguments[0],y=arguments[1],P=arguments[2];if(this._isProper=!1,Pe.intersects(y,P,f)&&Ir.index(y,P,f)===0&&Ir.index(P,y,f)===0)return this._isProper=!0,(f.equals(y)||f.equals(P))&&(this._isProper=!1),this._result=Is.POINT_INTERSECTION,null;this._result=Is.NO_INTERSECTION}},{key:"intersection",value:function(f,y,P,F){var Z=this.intersectionSafe(f,y,P,F);return this.isInSegmentEnvelopes(Z)||(Z=new Dt(c.nearestEndpoint(f,y,P,F))),this._precisionModel!==null&&this._precisionModel.makePrecise(Z),Z}},{key:"checkDD",value:function(f,y,P,F,Z){var re=xs.intersection(f,y,P,F),Te=this.isInSegmentEnvelopes(re);_e.out.println("DD in env = "+Te+"  --------------------- "+re),Z.distance(re)>1e-4&&_e.out.println("Distance = "+Z.distance(re))}},{key:"intersectionSafe",value:function(f,y,P,F){var Z=ur.intersection(f,y,P,F);return Z===null&&(Z=c.nearestEndpoint(f,y,P,F)),Z}},{key:"computeCollinearIntersection",value:function(f,y,P,F){var Z=Pe.intersects(f,y,P),re=Pe.intersects(f,y,F),Te=Pe.intersects(P,F,f),Xe=Pe.intersects(P,F,y);return Z&&re?(this._intPt[0]=P,this._intPt[1]=F,Is.COLLINEAR_INTERSECTION):Te&&Xe?(this._intPt[0]=f,this._intPt[1]=y,Is.COLLINEAR_INTERSECTION):Z&&Te?(this._intPt[0]=P,this._intPt[1]=f,!P.equals(f)||re||Xe?Is.COLLINEAR_INTERSECTION:Is.POINT_INTERSECTION):Z&&Xe?(this._intPt[0]=P,this._intPt[1]=y,!P.equals(y)||re||Te?Is.COLLINEAR_INTERSECTION:Is.POINT_INTERSECTION):re&&Te?(this._intPt[0]=F,this._intPt[1]=f,!F.equals(f)||Z||Xe?Is.COLLINEAR_INTERSECTION:Is.POINT_INTERSECTION):re&&Xe?(this._intPt[0]=F,this._intPt[1]=y,!F.equals(y)||Z||Te?Is.COLLINEAR_INTERSECTION:Is.POINT_INTERSECTION):Is.NO_INTERSECTION}},{key:"computeIntersect",value:function(f,y,P,F){if(this._isProper=!1,!Pe.intersects(f,y,P,F))return Is.NO_INTERSECTION;var Z=Ir.index(f,y,P),re=Ir.index(f,y,F);if(Z>0&&re>0||Z<0&&re<0)return Is.NO_INTERSECTION;var Te=Ir.index(P,F,f),Xe=Ir.index(P,F,y);return Te>0&&Xe>0||Te<0&&Xe<0?Is.NO_INTERSECTION:Z===0&&re===0&&Te===0&&Xe===0?this.computeCollinearIntersection(f,y,P,F):(Z===0||re===0||Te===0||Xe===0?(this._isProper=!1,f.equals2D(P)||f.equals2D(F)?this._intPt[0]=f:y.equals2D(P)||y.equals2D(F)?this._intPt[0]=y:Z===0?this._intPt[0]=new Dt(P):re===0?this._intPt[0]=new Dt(F):Te===0?this._intPt[0]=new Dt(f):Xe===0&&(this._intPt[0]=new Dt(y))):(this._isProper=!0,this._intPt[0]=this.intersection(f,y,P,F)),Is.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(f,y,P,F){var Z=f,re=pe.pointToSegment(f,P,F),Te=pe.pointToSegment(y,P,F);return Te<re&&(re=Te,Z=y),(Te=pe.pointToSegment(P,f,y))<re&&(re=Te,Z=P),(Te=pe.pointToSegment(F,f,y))<re&&(re=Te,Z=F),Z}}])}(Is),W=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"countSegment",value:function(c,f){if(c.x<this._p.x&&f.x<this._p.x)return null;if(this._p.x===f.x&&this._p.y===f.y)return this._isPointOnSegment=!0,null;if(c.y===this._p.y&&f.y===this._p.y){var y=c.x,P=f.x;return y>P&&(y=f.x,P=c.x),this._p.x>=y&&this._p.x<=P&&(this._isPointOnSegment=!0),null}if(c.y>this._p.y&&f.y<=this._p.y||f.y>this._p.y&&c.y<=this._p.y){var F=Ir.index(c,f,this._p);if(F===Ir.COLLINEAR)return this._isPointOnSegment=!0,null;f.y<c.y&&(F=-F),F===Ir.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==lt.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?lt.BOUNDARY:this._crossingCount%2==1?lt.INTERIOR:lt.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var c=arguments[0];this._p=c}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Dt&&cn(arguments[1],Gn)){for(var c=arguments[1],f=new v(arguments[0]),y=new Dt,P=new Dt,F=1;F<c.size();F++)if(c.getCoordinate(F,y),c.getCoordinate(F-1,P),f.countSegment(y,P),f.isOnSegment())return f.getLocation();return f.getLocation()}if(arguments[0]instanceof Dt&&arguments[1]instanceof Array){for(var Z=arguments[1],re=new v(arguments[0]),Te=1;Te<Z.length;Te++){var Xe=Z[Te],Yt=Z[Te-1];if(re.countSegment(Xe,Yt),re.isOnSegment())return re.getLocation()}return re.getLocation()}}}])}(),Ge=function(){function v(){xe(this,v)}return s(v,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Dt&&cn(arguments[1],Gn)){for(var c=arguments[0],f=arguments[1],y=new D,P=new Dt,F=new Dt,Z=f.size(),re=1;re<Z;re++)if(f.getCoordinate(re-1,P),f.getCoordinate(re,F),y.computeIntersection(c,P,F),y.hasIntersection())return!0;return!1}if(arguments[0]instanceof Dt&&arguments[1]instanceof Array){for(var Te=arguments[0],Xe=arguments[1],Yt=new D,Si=1;Si<Xe.length;Si++){var bn=Xe[Si-1],Jn=Xe[Si];if(Yt.computeIntersection(Te,bn,Jn),Yt.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(c,f){return W.locatePointInRing(c,f)}},{key:"isInRing",value:function(c,f){return v.locateInRing(c,f)!==lt.EXTERIOR}}])}(),Ye=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"setAllLocations",value:function(c){for(var f=0;f<this.location.length;f++)this.location[f]=c}},{key:"isNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]!==lt.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(c){for(var f=0;f<this.location.length;f++)this.location[f]===lt.NONE&&(this.location[f]=c)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(c){if(c.location.length>this.location.length){var f=new Array(3).fill(null);f[un.ON]=this.location[un.ON],f[un.LEFT]=lt.NONE,f[un.RIGHT]=lt.NONE,this.location=f}for(var y=0;y<this.location.length;y++)this.location[y]===lt.NONE&&y<c.location.length&&(this.location[y]=c.location[y])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var c=this.location[un.LEFT];this.location[un.LEFT]=this.location[un.RIGHT],this.location[un.RIGHT]=c}},{key:"toString",value:function(){var c=new Jr;return this.location.length>1&&c.append(lt.toLocationSymbol(this.location[un.LEFT])),c.append(lt.toLocationSymbol(this.location[un.ON])),this.location.length>1&&c.append(lt.toLocationSymbol(this.location[un.RIGHT])),c.toString()}},{key:"setLocations",value:function(c,f,y){this.location[un.ON]=c,this.location[un.LEFT]=f,this.location[un.RIGHT]=y}},{key:"get",value:function(c){return c<this.location.length?this.location[c]:lt.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]===lt.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var c=arguments[0];this.setLocation(un.ON,c)}else if(arguments.length===2){var f=arguments[0],y=arguments[1];this.location[f]=y}}},{key:"init",value:function(c){this.location=new Array(c).fill(null),this.setAllLocations(lt.NONE)}},{key:"isEqualOnSide",value:function(c,f){return this.location[f]===c.location[f]}},{key:"allPositionsEqual",value:function(c){for(var f=0;f<this.location.length;f++)if(this.location[f]!==c)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];this.init(c.length)}else if(Number.isInteger(arguments[0])){var f=arguments[0];this.init(1),this.location[un.ON]=f}else if(arguments[0]instanceof v){var y=arguments[0];if(this.init(y.location.length),y!==null)for(var P=0;P<this.location.length;P++)this.location[P]=y.location[P]}}else if(arguments.length===3){var F=arguments[0],Z=arguments[1],re=arguments[2];this.init(3),this.location[un.ON]=F,this.location[un.LEFT]=Z,this.location[un.RIGHT]=re}}}])}(),Bt=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getGeometryCount",value:function(){var c=0;return this.elt[0].isNull()||c++,this.elt[1].isNull()||c++,c}},{key:"setAllLocations",value:function(c,f){this.elt[c].setAllLocations(f)}},{key:"isNull",value:function(c){return this.elt[c].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var c=arguments[0];this.setAllLocationsIfNull(0,c),this.setAllLocationsIfNull(1,c)}else if(arguments.length===2){var f=arguments[0],y=arguments[1];this.elt[f].setAllLocationsIfNull(y)}}},{key:"isLine",value:function(c){return this.elt[c].isLine()}},{key:"merge",value:function(c){for(var f=0;f<2;f++)this.elt[f]===null&&c.elt[f]!==null?this.elt[f]=new Ye(c.elt[f]):this.elt[f].merge(c.elt[f])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var c=arguments[0];return this.elt[c].get(un.ON)}if(arguments.length===2){var f=arguments[0],y=arguments[1];return this.elt[f].get(y)}}},{key:"toString",value:function(){var c=new Jr;return this.elt[0]!==null&&(c.append("A:"),c.append(this.elt[0].toString())),this.elt[1]!==null&&(c.append(" B:"),c.append(this.elt[1].toString())),c.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var c=arguments[0];return this.elt[c].isArea()}}},{key:"isAnyNull",value:function(c){return this.elt[c].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var c=arguments[0],f=arguments[1];this.elt[c].setLocation(un.ON,f)}else if(arguments.length===3){var y=arguments[0],P=arguments[1],F=arguments[2];this.elt[y].setLocation(P,F)}}},{key:"isEqualOnSide",value:function(c,f){return this.elt[0].isEqualOnSide(c.elt[0],f)&&this.elt[1].isEqualOnSide(c.elt[1],f)}},{key:"allPositionsEqual",value:function(c,f){return this.elt[c].allPositionsEqual(f)}},{key:"toLine",value:function(c){this.elt[c].isArea()&&(this.elt[c]=new Ye(this.elt[c].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var c=arguments[0];this.elt[0]=new Ye(c),this.elt[1]=new Ye(c)}else if(arguments[0]instanceof v){var f=arguments[0];this.elt[0]=new Ye(f.elt[0]),this.elt[1]=new Ye(f.elt[1])}}else if(arguments.length===2){var y=arguments[0],P=arguments[1];this.elt[0]=new Ye(lt.NONE),this.elt[1]=new Ye(lt.NONE),this.elt[y].setLocation(P)}else if(arguments.length===3){var F=arguments[0],Z=arguments[1],re=arguments[2];this.elt[0]=new Ye(F,Z,re),this.elt[1]=new Ye(F,Z,re)}else if(arguments.length===4){var Te=arguments[0],Xe=arguments[1],Yt=arguments[2],Si=arguments[3];this.elt[0]=new Ye(lt.NONE,lt.NONE,lt.NONE),this.elt[1]=new Ye(lt.NONE,lt.NONE,lt.NONE),this.elt[Te].setLocations(Xe,Yt,Si)}}},{key:"toLineLabel",value:function(c){for(var f=new v(lt.NONE),y=0;y<2;y++)f.setLocation(y,c.getLocation(y));return f}}])}(),Ei=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var v=new Array(this._pts.size()).fill(null),c=0;c<this._pts.size();c++)v[c]=this._pts.get(c);this._ring=this._geometryFactory.createLinearRing(v),this._isHole=Ir.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(v){this._startDe=v;var c=v,f=!0;do{if(c===null)throw new ms("Found null DirectedEdge");if(c.getEdgeRing()===this)throw new ms("Directed Edge visited twice during ring-building at "+c.getCoordinate());this._edges.add(c);var y=c.getLabel();Mn.isTrue(y.isArea()),this.mergeLabel(y),this.addPoints(c.getEdge(),c.isForward(),f),f=!1,this.setEdgeRing(c,this),c=this.getNext(c)}while(c!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(v){return this._pts.get(v)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var v=this._startDe;do{var c=v.getNode().getEdges().getOutgoingDegree(this);c>this._maxNodeDegree&&(this._maxNodeDegree=c),v=this.getNext(v)}while(v!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(v,c,f){var y=v.getCoordinates();if(c){var P=1;f&&(P=0);for(var F=P;F<y.length;F++)this._pts.add(y[F])}else{var Z=y.length-2;f&&(Z=y.length-1);for(var re=Z;re>=0;re--)this._pts.add(y[re])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var v=this._startDe;do v.getEdge().setInResult(!0),v=v.getNext();while(v!==this._startDe)}},{key:"containsPoint",value:function(v){var c=this.getLinearRing();if(!c.getEnvelopeInternal().contains(v)||!Ge.isInRing(v,c.getCoordinates()))return!1;for(var f=this._holes.iterator();f.hasNext();)if(f.next().containsPoint(v))return!1;return!0}},{key:"addHole",value:function(v){this._holes.add(v)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var v=arguments[0];this.mergeLabel(v,0),this.mergeLabel(v,1)}else if(arguments.length===2){var c=arguments[1],f=arguments[0].getLocation(c,un.RIGHT);if(f===lt.NONE)return null;if(this._label.getLocation(c)===lt.NONE)return this._label.setLocation(c,f),null}}},{key:"setShell",value:function(v){this._shell=v,v!==null&&v.addHole(this)}},{key:"toPolygon",value:function(v){for(var c=new Array(this._holes.size()).fill(null),f=0;f<this._holes.size();f++)c[f]=this._holes.get(f).getLinearRing();return v.createPolygon(this.getLinearRing(),c)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new mr,this._pts=new mr,this._label=new Bt(lt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new mr,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var v=arguments[0],c=arguments[1];this._geometryFactory=c,this.computePoints(v),this.computeRing()}}}}])}(),Pn=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"setEdgeRing",value:function(f,y){f.setMinEdgeRing(y)}},{key:"getNext",value:function(f){return f.getNextMin()}}],[{key:"constructor_",value:function(){var f=arguments[0],y=arguments[1];Ei.constructor_.call(this,f,y)}}])}(Ei),yn=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"buildMinimalRings",value:function(){var f=new mr,y=this._startDe;do{if(y.getMinEdgeRing()===null){var P=new Pn(y,this._geometryFactory);f.add(P)}y=y.getNext()}while(y!==this._startDe);return f}},{key:"setEdgeRing",value:function(f,y){f.setEdgeRing(y)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var f=this._startDe;do f.getNode().getEdges().linkMinimalDirectedEdges(this),f=f.getNext();while(f!==this._startDe)}},{key:"getNext",value:function(f){return f.getNext()}}],[{key:"constructor_",value:function(){var f=arguments[0],y=arguments[1];Ei.constructor_.call(this,f,y)}}])}(Ei),pr=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(v){this._isVisited=v}},{key:"setInResult",value:function(v){this._isInResult=v}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(v){this._label=v}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(v){this._isCovered=v,this._isCoveredSet=!0}},{key:"updateIM",value:function(v){Mn.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(v)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var v=arguments[0];this._label=v}}}}])}(),Er=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"isIncidentEdgeInResult",value:function(){for(var f=this.getEdges().getEdges().iterator();f.hasNext();)if(f.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(f){f.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(f){}},{key:"computeMergedLocation",value:function(f,y){var P=lt.NONE;if(P=this._label.getLocation(y),!f.isNull(y)){var F=f.getLocation(y);P!==lt.BOUNDARY&&(P=F)}return P}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return ct(c,"setLabel",this,1).apply(this,arguments);var f=arguments[0],y=arguments[1];this._label===null?this._label=new Bt(f,y):this._label.setLocation(f,y)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof c){var f=arguments[0];this.mergeLabel(f._label)}else if(arguments[0]instanceof Bt)for(var y=arguments[0],P=0;P<2;P++){var F=this.computeMergedLocation(y,P);this._label.getLocation(P)===lt.NONE&&this._label.setLocation(P,F)}}},{key:"add",value:function(f){this._edges.insert(f),f.setNode(this)}},{key:"setLabelBoundary",value:function(f){if(this._label===null)return null;var y=lt.NONE;this._label!==null&&(y=this._label.getLocation(f));var P=null;switch(y){case lt.BOUNDARY:P=lt.INTERIOR;break;case lt.INTERIOR:default:P=lt.BOUNDARY}this._label.setLocation(f,P)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var f=arguments[0],y=arguments[1];this._coord=f,this._edges=y,this._label=new Bt(0,lt.NONE)}}])}(pr),ft=function(v){function c(){return xe(this,c),Tt(this,c,arguments)}return $t(c,v),s(c)}(vn);function mi(v){return v==null?0:v.color}function nt(v){return v==null?null:v.parent}function jt(v,c){v!==null&&(v.color=c)}function Ti(v){return v==null?null:v.left}function ni(v){return v==null?null:v.right}var wi=function(v){function c(){var f;return xe(this,c),(f=Tt(this,c)).root_=null,f.size_=0,f}return $t(c,v),s(c,[{key:"get",value:function(f){for(var y=this.root_;y!==null;){var P=f.compareTo(y.key);if(P<0)y=y.left;else{if(!(P>0))return y.value;y=y.right}}return null}},{key:"put",value:function(f,y){if(this.root_===null)return this.root_={key:f,value:y,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var P,F,Z=this.root_;do if(P=Z,(F=f.compareTo(Z.key))<0)Z=Z.left;else{if(!(F>0)){var re=Z.value;return Z.value=y,re}Z=Z.right}while(Z!==null);var Te={key:f,left:null,right:null,value:y,parent:P,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return F<0?P.left=Te:P.right=Te,this.fixAfterInsertion(Te),this.size_++,null}},{key:"fixAfterInsertion",value:function(f){var y;for(f.color=1;f!=null&&f!==this.root_&&f.parent.color===1;)nt(f)===Ti(nt(nt(f)))?mi(y=ni(nt(nt(f))))===1?(jt(nt(f),0),jt(y,0),jt(nt(nt(f)),1),f=nt(nt(f))):(f===ni(nt(f))&&(f=nt(f),this.rotateLeft(f)),jt(nt(f),0),jt(nt(nt(f)),1),this.rotateRight(nt(nt(f)))):mi(y=Ti(nt(nt(f))))===1?(jt(nt(f),0),jt(y,0),jt(nt(nt(f)),1),f=nt(nt(f))):(f===Ti(nt(f))&&(f=nt(f),this.rotateRight(f)),jt(nt(f),0),jt(nt(nt(f)),1),this.rotateLeft(nt(nt(f))));this.root_.color=0}},{key:"values",value:function(){var f=new mr,y=this.getFirstEntry();if(y!==null)for(f.add(y.value);(y=c.successor(y))!==null;)f.add(y.value);return f}},{key:"entrySet",value:function(){var f=new Xs,y=this.getFirstEntry();if(y!==null)for(f.add(y);(y=c.successor(y))!==null;)f.add(y);return f}},{key:"rotateLeft",value:function(f){if(f!=null){var y=f.right;f.right=y.left,y.left!=null&&(y.left.parent=f),y.parent=f.parent,f.parent==null?this.root_=y:f.parent.left===f?f.parent.left=y:f.parent.right=y,y.left=f,f.parent=y}}},{key:"rotateRight",value:function(f){if(f!=null){var y=f.left;f.left=y.right,y.right!=null&&(y.right.parent=f),y.parent=f.parent,f.parent==null?this.root_=y:f.parent.right===f?f.parent.right=y:f.parent.left=y,y.right=f,f.parent=y}}},{key:"getFirstEntry",value:function(){var f=this.root_;if(f!=null)for(;f.left!=null;)f=f.left;return f}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(f){for(var y=this.root_;y!==null;){var P=f.compareTo(y.key);if(P<0)y=y.left;else{if(!(P>0))return!0;y=y.right}}return!1}}],[{key:"successor",value:function(f){var y;if(f===null)return null;if(f.right!==null){for(y=f.right;y.left!==null;)y=y.left;return y}y=f.parent;for(var P=f;y!==null&&P===y.right;)P=y,y=y.parent;return y}}])}(ft),Mi=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"find",value:function(v){return this.nodeMap.get(v)}},{key:"addNode",value:function(){if(arguments[0]instanceof Dt){var v=arguments[0],c=this.nodeMap.get(v);return c===null&&(c=this.nodeFact.createNode(v),this.nodeMap.put(v,c)),c}if(arguments[0]instanceof Er){var f=arguments[0],y=this.nodeMap.get(f.getCoordinate());return y===null?(this.nodeMap.put(f.getCoordinate(),f),f):(y.mergeLabel(f),y)}}},{key:"print",value:function(v){for(var c=this.iterator();c.hasNext();)c.next().print(v)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(v){for(var c=new mr,f=this.iterator();f.hasNext();){var y=f.next();y.getLabel().getLocation(v)===lt.BOUNDARY&&c.add(y)}return c}},{key:"add",value:function(v){var c=v.getCoordinate();this.addNode(c).add(v)}}],[{key:"constructor_",value:function(){this.nodeMap=new wi,this.nodeFact=null;var v=arguments[0];this.nodeFact=v}}])}(),Li=function(){function v(){xe(this,v)}return s(v,null,[{key:"isNorthern",value:function(c){return c===v.NE||c===v.NW}},{key:"isOpposite",value:function(c,f){return c!==f&&(c-f+4)%4===2}},{key:"commonHalfPlane",value:function(c,f){if(c===f)return c;if((c-f+4)%4===2)return-1;var y=c<f?c:f;return y===0&&(c>f?c:f)===3?3:y}},{key:"isInHalfPlane",value:function(c,f){return f===v.SE?c===v.SE||c===v.SW:c===f||c===f+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],f=arguments[1];if(c===0&&f===0)throw new vt("Cannot compute the quadrant for point ( "+c+", "+f+" )");return c>=0?f>=0?v.NE:v.SE:f>=0?v.NW:v.SW}if(arguments[0]instanceof Dt&&arguments[1]instanceof Dt){var y=arguments[0],P=arguments[1];if(P.x===y.x&&P.y===y.y)throw new vt("Cannot compute the quadrant for two identical points "+y);return P.x>=y.x?P.y>=y.y?v.NE:v.SE:P.y>=y.y?v.NW:v.SW}}}])}();Li.NE=0,Li.NW=1,Li.SW=2,Li.SE=3;var pt=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"compareDirection",value:function(c){return this._dx===c._dx&&this._dy===c._dy?0:this._quadrant>c._quadrant?1:this._quadrant<c._quadrant?-1:Ir.index(c._p0,c._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(c){this._node=c}},{key:"print",value:function(c){var f=Math.atan2(this._dy,this._dx),y=this.getClass().getName(),P=y.lastIndexOf("."),F=y.substring(P+1);c.print("  "+F+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+f+"   "+this._label)}},{key:"compareTo",value:function(c){var f=c;return this.compareDirection(f)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var c=Math.atan2(this._dy,this._dx),f=this.getClass().getName(),y=f.lastIndexOf(".");return"  "+f.substring(y+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+c+"   "+this._label}},{key:"computeLabel",value:function(c){}},{key:"init",value:function(c,f){this._p0=c,this._p1=f,this._dx=f.x-c.x,this._dy=f.y-c.y,this._quadrant=Li.quadrant(this._dx,this._dy),Mn.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[Ie]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var c=arguments[0];this._edge=c}else if(arguments.length===3){var f=arguments[0],y=arguments[1],P=arguments[2];v.constructor_.call(this,f,y,P,null)}else if(arguments.length===4){var F=arguments[0],Z=arguments[1],re=arguments[2],Te=arguments[3];v.constructor_.call(this,F),this.init(Z,re),this._label=Te}}}])}(),St=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(f){return this._depth[f]}},{key:"setVisited",value:function(f){this._isVisited=f}},{key:"computeDirectedLabel",value:function(){this._label=new Bt(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(f,y){if(this._depth[f]!==-999&&this._depth[f]!==y)throw new ms("assigned depths do not match",this.getCoordinate());this._depth[f]=y}},{key:"isInteriorAreaEdge",value:function(){for(var f=!0,y=0;y<2;y++)this._label.isArea(y)&&this._label.getLocation(y,un.LEFT)===lt.INTERIOR&&this._label.getLocation(y,un.RIGHT)===lt.INTERIOR||(f=!1);return f}},{key:"setNextMin",value:function(f){this._nextMin=f}},{key:"print",value:function(f){ct(c,"print",this,1).call(this,f),f.print(" "+this._depth[un.LEFT]+"/"+this._depth[un.RIGHT]),f.print(" ("+this.getDepthDelta()+")"),this._isInResult&&f.print(" inResult")}},{key:"setMinEdgeRing",value:function(f){this._minEdgeRing=f}},{key:"isLineEdge",value:function(){var f=this._label.isLine(0)||this._label.isLine(1),y=!this._label.isArea(0)||this._label.allPositionsEqual(0,lt.EXTERIOR),P=!this._label.isArea(1)||this._label.allPositionsEqual(1,lt.EXTERIOR);return f&&y&&P}},{key:"setEdgeRing",value:function(f){this._edgeRing=f}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var f=this._edge.getDepthDelta();return this._isForward||(f=-f),f}},{key:"setInResult",value:function(f){this._isInResult=f}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(f){this.print(f),f.print(" "),this._isForward?this._edge.print(f):this._edge.printReverse(f)}},{key:"setSym",value:function(f){this._sym=f}},{key:"setVisitedEdge",value:function(f){this.setVisited(f),this._sym.setVisited(f)}},{key:"setEdgeDepths",value:function(f,y){var P=this.getEdge().getDepthDelta();this._isForward||(P=-P);var F=1;f===un.LEFT&&(F=-1);var Z=un.opposite(f),re=y+P*F;this.setDepth(f,y),this.setDepth(Z,re)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(f){this._next=f}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var f=arguments[0],y=arguments[1];if(pt.constructor_.call(this,f),this._isForward=y,y)this.init(f.getCoordinate(0),f.getCoordinate(1));else{var P=f.getNumPoints()-1;this.init(f.getCoordinate(P),f.getCoordinate(P-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(f,y){return f===lt.EXTERIOR&&y===lt.INTERIOR?1:f===lt.INTERIOR&&y===lt.EXTERIOR?-1:0}}])}(pt),zt=function(){return s(function v(){xe(this,v)},[{key:"createNode",value:function(v){return new Er(v,null)}}])}(),At=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(v){v.println("Edges:");for(var c=0;c<this._edges.size();c++){v.println("edge "+c+":");var f=this._edges.get(c);f.print(v),f.eiList.print(v)}}},{key:"find",value:function(v){return this._nodes.find(v)}},{key:"addNode",value:function(){if(arguments[0]instanceof Er){var v=arguments[0];return this._nodes.addNode(v)}if(arguments[0]instanceof Dt){var c=arguments[0];return this._nodes.addNode(c)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var v=this._nodes.iterator();v.hasNext();)v.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(v){_e.out.println(v)}},{key:"isBoundaryNode",value:function(v,c){var f=this._nodes.find(c);if(f===null)return!1;var y=f.getLabel();return y!==null&&y.getLocation(v)===lt.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var v=this._nodes.iterator();v.hasNext();)v.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(v,c,f,y){return!!v.equals(f)&&Ir.index(v,c,y)===Ir.COLLINEAR&&Li.quadrant(v,c)===Li.quadrant(f,y)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(v){_e.out.print(v)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(v,c){for(var f=0;f<this._edges.size();f++){var y=this._edges.get(f),P=y.getCoordinates();if(this.matchInSameDirection(v,c,P[0],P[1])||this.matchInSameDirection(v,c,P[P.length-1],P[P.length-2]))return y}return null}},{key:"insertEdge",value:function(v){this._edges.add(v)}},{key:"findEdgeEnd",value:function(v){for(var c=this.getEdgeEnds().iterator();c.hasNext();){var f=c.next();if(f.getEdge()===v)return f}return null}},{key:"addEdges",value:function(v){for(var c=v.iterator();c.hasNext();){var f=c.next();this._edges.add(f);var y=new St(f,!0),P=new St(f,!1);y.setSym(P),P.setSym(y),this.add(y),this.add(P)}}},{key:"add",value:function(v){this._nodes.add(v),this._edgeEndList.add(v)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(v,c){for(var f=0;f<this._edges.size();f++){var y=this._edges.get(f),P=y.getCoordinates();if(v.equals(P[0])&&c.equals(P[1]))return y}return null}}],[{key:"constructor_",value:function(){if(this._edges=new mr,this._nodes=null,this._edgeEndList=new mr,arguments.length===0)this._nodes=new Mi(new zt);else if(arguments.length===1){var v=arguments[0];this._nodes=new Mi(v)}}},{key:"linkResultDirectedEdges",value:function(v){for(var c=v.iterator();c.hasNext();)c.next().getEdges().linkResultDirectedEdges()}}])}(),kt=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"sortShellsAndHoles",value:function(c,f,y){for(var P=c.iterator();P.hasNext();){var F=P.next();F.isHole()?y.add(F):f.add(F)}}},{key:"computePolygons",value:function(c){for(var f=new mr,y=c.iterator();y.hasNext();){var P=y.next().toPolygon(this._geometryFactory);f.add(P)}return f}},{key:"placeFreeHoles",value:function(c,f){for(var y=f.iterator();y.hasNext();){var P=y.next();if(P.getShell()===null){var F=v.findEdgeRingContaining(P,c);if(F===null)throw new ms("unable to assign hole to a shell",P.getCoordinate(0));P.setShell(F)}}}},{key:"buildMinimalEdgeRings",value:function(c,f,y){for(var P=new mr,F=c.iterator();F.hasNext();){var Z=F.next();if(Z.getMaxNodeDegree()>2){Z.linkDirectedEdgesForMinimalEdgeRings();var re=Z.buildMinimalRings(),Te=this.findShell(re);Te!==null?(this.placePolygonHoles(Te,re),f.add(Te)):y.addAll(re)}else P.add(Z)}return P}},{key:"buildMaximalEdgeRings",value:function(c){for(var f=new mr,y=c.iterator();y.hasNext();){var P=y.next();if(P.isInResult()&&P.getLabel().isArea()&&P.getEdgeRing()===null){var F=new yn(P,this._geometryFactory);f.add(F),F.setInResult()}}return f}},{key:"placePolygonHoles",value:function(c,f){for(var y=f.iterator();y.hasNext();){var P=y.next();P.isHole()&&P.setShell(c)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(c){for(var f=0,y=null,P=c.iterator();P.hasNext();){var F=P.next();F.isHole()||(y=F,f++)}return Mn.isTrue(f<=1,"found two shells in MinimalEdgeRing list"),y}},{key:"add",value:function(){if(arguments.length===1){var c=arguments[0];this.add(c.getEdgeEnds(),c.getNodes())}else if(arguments.length===2){var f=arguments[0],y=arguments[1];At.linkResultDirectedEdges(y);var P=this.buildMaximalEdgeRings(f),F=new mr,Z=this.buildMinimalEdgeRings(P,this._shellList,F);this.sortShellsAndHoles(Z,this._shellList,F),this.placeFreeHoles(this._shellList,F)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new mr;var c=arguments[0];this._geometryFactory=c}},{key:"findEdgeRingContaining",value:function(c,f){for(var y=c.getLinearRing(),P=y.getEnvelopeInternal(),F=y.getCoordinateN(0),Z=null,re=null,Te=f.iterator();Te.hasNext();){var Xe=Te.next(),Yt=Xe.getLinearRing(),Si=Yt.getEnvelopeInternal();if(!Si.equals(P)&&Si.contains(P)){F=Se.ptNotInList(y.getCoordinates(),Yt.getCoordinates());var bn=!1;Ge.isInRing(F,Yt.getCoordinates())&&(bn=!0),bn&&(Z===null||re.contains(Si))&&(re=(Z=Xe).getLinearRing().getEnvelopeInternal())}}return Z}}])}(),Ci=function(){return s(function v(){xe(this,v)},[{key:"getBounds",value:function(){}}])}(),Ke=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Ci,qe]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var v=arguments[0],c=arguments[1];this._bounds=v,this._item=c}}])}(),It=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var v=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),v}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(v){for(var c=null,f=this._items.get(v);2*v<=this._size&&((c=2*v)!==this._size&&this._items.get(c+1).compareTo(this._items.get(c))<0&&c++,this._items.get(c).compareTo(f)<0);v=c)this._items.set(v,this._items.get(c));this._items.set(v,f)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(v){this._items.add(null),this._size+=1;var c=this._size;for(this._items.set(0,v);v.compareTo(this._items.get(Math.trunc(c/2)))<0;c/=2)this._items.set(c,this._items.get(Math.trunc(c/2)));this._items.set(c,v)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new mr,this._items.add(null)}}])}(),Nt=function(){return s(function v(){xe(this,v)},[{key:"insert",value:function(v,c){}},{key:"remove",value:function(v,c){}},{key:"query",value:function(){}}])}(),ci=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(v){Mn.isTrue(this._bounds===null),this._childBoundables.add(v)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Ci,qe]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new mr,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var v=arguments[0];this._level=v}}}}])}(),oi={reverseOrder:function(){return{compare:function(v,c){return c.compareTo(v)}}},min:function(v){return oi.sort(v),v.get(0)},sort:function(v,c){var f=v.toArray();c?qr.sort(f,c):qr.sort(f);for(var y=v.iterator(),P=0,F=f.length;P<F;P++)y.next(),y.set(f[P])},singletonList:function(v){var c=new mr;return c.add(v),c}},Ki=function(){function v(){xe(this,v)}return s(v,null,[{key:"maxDistance",value:function(c,f,y,P,F,Z,re,Te){var Xe=v.distance(c,f,F,Z);return Xe=Math.max(Xe,v.distance(c,f,re,Te)),Xe=Math.max(Xe,v.distance(y,P,F,Z)),Xe=Math.max(Xe,v.distance(y,P,re,Te))}},{key:"distance",value:function(c,f,y,P){var F=y-c,Z=P-f;return Math.sqrt(F*F+Z*Z)}},{key:"maximumDistance",value:function(c,f){var y=Math.min(c.getMinX(),f.getMinX()),P=Math.min(c.getMinY(),f.getMinY()),F=Math.max(c.getMaxX(),f.getMaxX()),Z=Math.max(c.getMaxY(),f.getMaxY());return v.distance(y,P,F,Z)}},{key:"minMaxDistance",value:function(c,f){var y=c.getMinX(),P=c.getMinY(),F=c.getMaxX(),Z=c.getMaxY(),re=f.getMinX(),Te=f.getMinY(),Xe=f.getMaxX(),Yt=f.getMaxY(),Si=v.maxDistance(y,P,y,Z,re,Te,re,Yt);return Si=Math.min(Si,v.maxDistance(y,P,y,Z,re,Te,Xe,Te)),Si=Math.min(Si,v.maxDistance(y,P,y,Z,Xe,Yt,re,Yt)),Si=Math.min(Si,v.maxDistance(y,P,y,Z,Xe,Yt,Xe,Te)),Si=Math.min(Si,v.maxDistance(y,P,F,P,re,Te,re,Yt)),Si=Math.min(Si,v.maxDistance(y,P,F,P,re,Te,Xe,Te)),Si=Math.min(Si,v.maxDistance(y,P,F,P,Xe,Yt,re,Yt)),Si=Math.min(Si,v.maxDistance(y,P,F,P,Xe,Yt,Xe,Te)),Si=Math.min(Si,v.maxDistance(F,Z,y,Z,re,Te,re,Yt)),Si=Math.min(Si,v.maxDistance(F,Z,y,Z,re,Te,Xe,Te)),Si=Math.min(Si,v.maxDistance(F,Z,y,Z,Xe,Yt,re,Yt)),Si=Math.min(Si,v.maxDistance(F,Z,y,Z,Xe,Yt,Xe,Te)),Si=Math.min(Si,v.maxDistance(F,Z,F,P,re,Te,re,Yt)),Si=Math.min(Si,v.maxDistance(F,Z,F,P,re,Te,Xe,Te)),Si=Math.min(Si,v.maxDistance(F,Z,F,P,Xe,Yt,re,Yt)),Si=Math.min(Si,v.maxDistance(F,Z,F,P,Xe,Yt,Xe,Te))}}])}(),si=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"maximumDistance",value:function(){return Ki.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(c,f){var y=v.isComposite(this._boundable1),P=v.isComposite(this._boundable2);if(y&&P)return v.area(this._boundable1)>v.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,c,f),null):(this.expand(this._boundable2,this._boundable1,!0,c,f),null);if(y)return this.expand(this._boundable1,this._boundable2,!1,c,f),null;if(P)return this.expand(this._boundable2,this._boundable1,!0,c,f),null;throw new vt("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(v.isComposite(this._boundable1)||v.isComposite(this._boundable2))}},{key:"compareTo",value:function(c){var f=c;return this._distance<f._distance?-1:this._distance>f._distance?1:0}},{key:"expand",value:function(c,f,y,P,F){for(var Z=c.getChildBoundables().iterator();Z.hasNext();){var re=Z.next(),Te=null;(Te=y?new v(f,re,this._itemDistance):new v(re,f,this._itemDistance)).getDistance()<F&&P.add(Te)}}},{key:"getBoundable",value:function(c){return c===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[Ie]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var c=arguments[0],f=arguments[1],y=arguments[2];this._boundable1=c,this._boundable2=f,this._itemDistance=y,this._distance=this.distance()}},{key:"area",value:function(c){return c.getBounds().getArea()}},{key:"isComposite",value:function(c){return c instanceof ci}}])}(),Di=function(){return s(function v(){xe(this,v)},[{key:"visitItem",value:function(v){}}])}(),li=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"queryInternal",value:function(){if(cn(arguments[2],Di)&&arguments[0]instanceof Object&&arguments[1]instanceof ci)for(var c=arguments[0],f=arguments[2],y=arguments[1].getChildBoundables(),P=0;P<y.size();P++){var F=y.get(P);this.getIntersectsOp().intersects(F.getBounds(),c)&&(F instanceof ci?this.queryInternal(c,F,f):F instanceof Ke?f.visitItem(F.getItem()):Mn.shouldNeverReachHere())}else if(cn(arguments[2],ls)&&arguments[0]instanceof Object&&arguments[1]instanceof ci)for(var Z=arguments[0],re=arguments[2],Te=arguments[1].getChildBoundables(),Xe=0;Xe<Te.size();Xe++){var Yt=Te.get(Xe);this.getIntersectsOp().intersects(Yt.getBounds(),Z)&&(Yt instanceof ci?this.queryInternal(Z,Yt,re):Yt instanceof Ke?re.add(Yt.getItem()):Mn.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(c){return c.get(c.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var c=0,f=arguments[0].getChildBoundables().iterator();f.hasNext();){var y=f.next();y instanceof ci?c+=this.size(y):y instanceof Ke&&(c+=1)}return c}}},{key:"removeItem",value:function(c,f){for(var y=null,P=c.getChildBoundables().iterator();P.hasNext();){var F=P.next();F instanceof Ke&&F.getItem()===f&&(y=F)}return y!==null&&(c.getChildBoundables().remove(y),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var c=this.itemsTree(this._root);return c===null?new mr:c}if(arguments.length===1){for(var f=arguments[0],y=new mr,P=f.getChildBoundables().iterator();P.hasNext();){var F=P.next();if(F instanceof ci){var Z=this.itemsTree(F);Z!==null&&y.add(Z)}else F instanceof Ke?y.add(F.getItem()):Mn.shouldNeverReachHere()}return y.size()<=0?null:y}}},{key:"insert",value:function(c,f){Mn.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ke(c,f))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var c=arguments[0],f=new mr;return this.boundablesAtLevel(c,this._root,f),f}if(arguments.length===3){var y=arguments[0],P=arguments[1],F=arguments[2];if(Mn.isTrue(y>-2),P.getLevel()===y)return F.add(P),null;for(var Z=P.getChildBoundables().iterator();Z.hasNext();){var re=Z.next();re instanceof ci?this.boundablesAtLevel(y,re,F):(Mn.isTrue(re instanceof Ke),y===-1&&F.add(re))}return null}}},{key:"query",value:function(){if(arguments.length===1){var c=arguments[0];this.build();var f=new mr;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.queryInternal(c,this._root,f),f}if(arguments.length===2){var y=arguments[0],P=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),y)&&this.queryInternal(y,this._root,P)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var c=arguments[0],f=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.remove(c,this._root,f)}if(arguments.length===3){var y=arguments[0],P=arguments[1],F=arguments[2],Z=this.removeItem(P,F);if(Z)return!0;for(var re=null,Te=P.getChildBoundables().iterator();Te.hasNext();){var Xe=Te.next();if(this.getIntersectsOp().intersects(Xe.getBounds(),y)&&Xe instanceof ci&&(Z=this.remove(y,Xe,F))){re=Xe;break}}return re!==null&&re.getChildBoundables().isEmpty()&&P.getChildBoundables().remove(re),Z}}},{key:"createHigherLevels",value:function(c,f){Mn.isTrue(!c.isEmpty());var y=this.createParentBoundables(c,f+1);return y.size()===1?y.get(0):this.createHigherLevels(y,f+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var c=0,f=arguments[0].getChildBoundables().iterator();f.hasNext();){var y=f.next();if(y instanceof ci){var P=this.depth(y);P>c&&(c=P)}}return c+1}}},{key:"createParentBoundables",value:function(c,f){Mn.isTrue(!c.isEmpty());var y=new mr;y.add(this.createNode(f));var P=new mr(c);oi.sort(P,this.getComparator());for(var F=P.iterator();F.hasNext();){var Z=F.next();this.lastNode(y).getChildBoundables().size()===this.getNodeCapacity()&&y.add(this.createNode(f)),this.lastNode(y).addChildBoundable(Z)}return y}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[qe]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new mr,this._nodeCapacity=null,arguments.length===0)v.constructor_.call(this,v.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var c=arguments[0];Mn.isTrue(c>1,"Node capacity must be greater than 1"),this._nodeCapacity=c}}},{key:"compareDoubles",value:function(c,f){return c>f?1:c<f?-1:0}}])}();li.IntersectsOp=function(){},li.DEFAULT_NODE_CAPACITY=10;var Oi=function(){return s(function v(){xe(this,v)},[{key:"distance",value:function(v,c){}}])}(),Hi=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"createParentBoundablesFromVerticalSlices",value:function(f,y){Mn.isTrue(f.length>0);for(var P=new mr,F=0;F<f.length;F++)P.addAll(this.createParentBoundablesFromVerticalSlice(f[F],y));return P}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var f=arguments[0],y=arguments[1];return this.nearestNeighbourK(f,at.POSITIVE_INFINITY,y)}if(arguments.length===3){var P=arguments[0],F=arguments[2],Z=arguments[1],re=new It;re.add(P);for(var Te=new It;!re.isEmpty()&&Z>=0;){var Xe=re.poll(),Yt=Xe.getDistance();if(Yt>=Z)break;Xe.isLeaves()?Te.size()<F?Te.add(Xe):(Te.peek().getDistance()>Yt&&(Te.poll(),Te.add(Xe)),Z=Te.peek().getDistance()):Xe.expandToQueue(re,Z)}return c.getItems(Te)}}},{key:"createNode",value:function(f){return new Sn(f)}},{key:"size",value:function(){return arguments.length===0?ct(c,"size",this,1).call(this):ct(c,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Pe))return ct(c,"insert",this,1).apply(this,arguments);var f=arguments[0],y=arguments[1];if(f.isNull())return null;ct(c,"insert",this,1).call(this,f,y)}},{key:"getIntersectsOp",value:function(){return c.intersectsOp}},{key:"verticalSlices",value:function(f,y){for(var P=Math.trunc(Math.ceil(f.size()/y)),F=new Array(y).fill(null),Z=f.iterator(),re=0;re<y;re++){F[re]=new mr;for(var Te=0;Z.hasNext()&&Te<P;){var Xe=Z.next();F[re].add(Xe),Te++}}return F}},{key:"query",value:function(){if(arguments.length===1){var f=arguments[0];return ct(c,"query",this,1).call(this,f)}if(arguments.length===2){var y=arguments[0],P=arguments[1];ct(c,"query",this,1).call(this,y,P)}}},{key:"getComparator",value:function(){return c.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(f,y){return ct(c,"createParentBoundables",this,1).call(this,f,y)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Pe){var f=arguments[0],y=arguments[1];return ct(c,"remove",this,1).call(this,f,y)}return ct(c,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?ct(c,"depth",this,1).call(this):ct(c,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(f,y){Mn.isTrue(!f.isEmpty());var P=Math.trunc(Math.ceil(f.size()/this.getNodeCapacity())),F=new mr(f);oi.sort(F,c.xComparator);var Z=this.verticalSlices(F,Math.trunc(Math.ceil(Math.sqrt(P))));return this.createParentBoundablesFromVerticalSlices(Z,y)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(cn(arguments[0],Oi)){var f=arguments[0];if(this.isEmpty())return null;var y=new si(this.getRoot(),this.getRoot(),f);return this.nearestNeighbour(y)}if(arguments[0]instanceof si){var P=arguments[0],F=at.POSITIVE_INFINITY,Z=null,re=new It;for(re.add(P);!re.isEmpty()&&F>0;){var Te=re.poll(),Xe=Te.getDistance();if(Xe>=F)break;Te.isLeaves()?(F=Xe,Z=Te):Te.expandToQueue(re,F)}return Z===null?null:[Z.getBoundable(0).getItem(),Z.getBoundable(1).getItem()]}}else{if(arguments.length===2){var Yt=arguments[0],Si=arguments[1];if(this.isEmpty()||Yt.isEmpty())return null;var bn=new si(this.getRoot(),Yt.getRoot(),Si);return this.nearestNeighbour(bn)}if(arguments.length===3){var Jn=arguments[2],br=new Ke(arguments[0],arguments[1]),Dr=new si(this.getRoot(),br,Jn);return this.nearestNeighbour(Dr)[0]}if(arguments.length===4){var ts=arguments[2],os=arguments[3],Ds=new Ke(arguments[0],arguments[1]),mo=new si(this.getRoot(),Ds,ts);return this.nearestNeighbourK(mo,os)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var f=arguments[0],y=arguments[1],P=at.POSITIVE_INFINITY,F=new It;for(F.add(f);!F.isEmpty();){var Z=F.poll(),re=Z.getDistance();if(re>y)return!1;if(Z.maximumDistance()<=y)return!0;if(Z.isLeaves()){if((P=re)<=y)return!0}else Z.expandToQueue(F,P)}return!1}if(arguments.length===3){var Te=arguments[0],Xe=arguments[1],Yt=arguments[2],Si=new si(this.getRoot(),Te.getRoot(),Xe);return this.isWithinDistance(Si,Yt)}}},{key:"interfaces_",get:function(){return[Nt,qe]}}],[{key:"constructor_",value:function(){if(arguments.length===0)c.constructor_.call(this,c.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var f=arguments[0];li.constructor_.call(this,f)}}},{key:"centreX",value:function(f){return c.avg(f.getMinX(),f.getMaxX())}},{key:"avg",value:function(f,y){return(f+y)/2}},{key:"getItems",value:function(f){for(var y=new Array(f.size()).fill(null),P=0;!f.isEmpty();){var F=f.poll();y[P]=F.getBoundable(0).getItem(),P++}return y}},{key:"centreY",value:function(f){return c.avg(f.getMinY(),f.getMaxY())}}])}(li),Sn=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"computeBounds",value:function(){for(var f=null,y=this.getChildBoundables().iterator();y.hasNext();){var P=y.next();f===null?f=new Pe(P.getBounds()):f.expandToInclude(P.getBounds())}return f}}],[{key:"constructor_",value:function(){var f=arguments[0];ci.constructor_.call(this,f)}}])}(ci);Hi.STRtreeNode=Sn,Hi.xComparator=new(function(){return s(function v(){xe(this,v)},[{key:"interfaces_",get:function(){return[Ht]}},{key:"compare",value:function(v,c){return li.compareDoubles(Hi.centreX(v.getBounds()),Hi.centreX(c.getBounds()))}}])}()),Hi.yComparator=new(function(){return s(function v(){xe(this,v)},[{key:"interfaces_",get:function(){return[Ht]}},{key:"compare",value:function(v,c){return li.compareDoubles(Hi.centreY(v.getBounds()),Hi.centreY(c.getBounds()))}}])}()),Hi.intersectsOp=new(function(){return s(function v(){xe(this,v)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(v,c){return v.intersects(c)}}])}()),Hi.DEFAULT_NODE_CAPACITY=10;var On=function(){function v(){xe(this,v)}return s(v,null,[{key:"relativeSign",value:function(c,f){return c<f?-1:c>f?1:0}},{key:"compare",value:function(c,f,y){if(f.equals2D(y))return 0;var P=v.relativeSign(f.x,y.x),F=v.relativeSign(f.y,y.y);switch(c){case 0:return v.compareValue(P,F);case 1:return v.compareValue(F,P);case 2:return v.compareValue(F,-P);case 3:return v.compareValue(-P,F);case 4:return v.compareValue(-P,-F);case 5:return v.compareValue(-F,-P);case 6:return v.compareValue(-F,P);case 7:return v.compareValue(P,-F)}return Mn.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(c,f){return c<0?-1:c>0?1:f<0?-1:f>0?1:0}}])}(),An=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(v){v.print(this.coord),v.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(v){var c=v;return this.segmentIndex<c.segmentIndex?-1:this.segmentIndex>c.segmentIndex?1:this.coord.equals2D(c.coord)?0:this._isInterior?c._isInterior?On.compare(this._segmentOctant,this.coord,c.coord):1:-1}},{key:"isEndPoint",value:function(v){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===v}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[Ie]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var v=arguments[0],c=arguments[1],f=arguments[2],y=arguments[3];this._segString=v,this.coord=new Dt(c),this.segmentIndex=f,this._segmentOctant=y,this._isInterior=!c.equals2D(v.getCoordinate(f))}}])}(),fr=function(){return s(function v(){xe(this,v)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])}(),mt=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var v=new ce;this.addEndpoints();for(var c=this.iterator(),f=c.next();c.hasNext();){var y=c.next();this.addEdgeCoordinates(f,y,v),f=y}return v.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var v=new mr;this.findCollapsesFromInsertedNodes(v),this.findCollapsesFromExistingVertices(v);for(var c=v.iterator();c.hasNext();){var f=c.next().intValue();this.add(this._edge.getCoordinate(f),f)}}},{key:"createSplitEdgePts",value:function(v,c){var f=c.segmentIndex-v.segmentIndex+2;if(f===2)return[new Dt(v.coord),new Dt(c.coord)];var y=this._edge.getCoordinate(c.segmentIndex),P=c.isInterior()||!c.coord.equals2D(y);P||f--;var F=new Array(f).fill(null),Z=0;F[Z++]=new Dt(v.coord);for(var re=v.segmentIndex+1;re<=c.segmentIndex;re++)F[Z++]=this._edge.getCoordinate(re);return P&&(F[Z]=new Dt(c.coord)),F}},{key:"print",value:function(v){v.println("Intersections:");for(var c=this.iterator();c.hasNext();)c.next().print(v)}},{key:"findCollapsesFromExistingVertices",value:function(v){for(var c=0;c<this._edge.size()-2;c++){var f=this._edge.getCoordinate(c);this._edge.getCoordinate(c+1);var y=this._edge.getCoordinate(c+2);f.equals2D(y)&&v.add(Pr.valueOf(c+1))}}},{key:"addEdgeCoordinates",value:function(v,c,f){var y=this.createSplitEdgePts(v,c);f.add(y,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(v){this.addEndpoints(),this.addCollapsedNodes();for(var c=this.iterator(),f=c.next();c.hasNext();){var y=c.next(),P=this.createSplitEdge(f,y);v.add(P),f=y}}},{key:"findCollapseIndex",value:function(v,c,f){if(!v.coord.equals2D(c.coord))return!1;var y=c.segmentIndex-v.segmentIndex;return c.isInterior()||y--,y===1&&(f[0]=v.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(v){for(var c=new Array(1).fill(null),f=this.iterator(),y=f.next();f.hasNext();){var P=f.next();this.findCollapseIndex(y,P,c)&&v.add(Pr.valueOf(c[0])),y=P}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var v=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(v),v)}},{key:"createSplitEdge",value:function(v,c){var f=this.createSplitEdgePts(v,c);return new bt(f,this._edge.getData())}},{key:"add",value:function(v,c){var f=new An(this._edge,v,c,this._edge.getSegmentOctant(c)),y=this._nodeMap.get(f);return y!==null?(Mn.isTrue(y.coord.equals2D(v),"Found equal nodes with different coordinates"),y):(this._nodeMap.put(f,f),f)}},{key:"checkSplitEdgesCorrectness",value:function(v){var c=this._edge.getCoordinates(),f=v.get(0).getCoordinate(0);if(!f.equals2D(c[0]))throw new Qi("bad split edge start point at "+f);var y=v.get(v.size()-1).getCoordinates(),P=y[y.length-1];if(!P.equals2D(c[c.length-1]))throw new Qi("bad split edge end point at "+P)}}],[{key:"constructor_",value:function(){this._nodeMap=new wi,this._edge=null;var v=arguments[0];this._edge=v}}])}(),Wt=function(){function v(){xe(this,v)}return s(v,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],f=arguments[1];if(c===0&&f===0)throw new vt("Cannot compute the octant for point ( "+c+", "+f+" )");var y=Math.abs(c),P=Math.abs(f);return c>=0?f>=0?y>=P?0:1:y>=P?7:6:f>=0?y>=P?3:2:y>=P?4:5}if(arguments[0]instanceof Dt&&arguments[1]instanceof Dt){var F=arguments[0],Z=arguments[1],re=Z.x-F.x,Te=Z.y-F.y;if(re===0&&Te===0)throw new vt("Cannot compute the octant for two identical points "+F);return v.octant(re,Te)}}}])}(),hi=function(){return s(function v(){xe(this,v)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(v){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(v){}},{key:"getData",value:function(){}}])}(),ln=function(){return s(function v(){xe(this,v)},[{key:"addIntersection",value:function(v,c){}},{key:"interfaces_",get:function(){return[hi]}}])}(),bt=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(c){return this._pts[c]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(c){return c===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(c),this.getCoordinate(c+1))}},{key:"setData",value:function(c){this._data=c}},{key:"safeOctant",value:function(c,f){return c.equals2D(f)?0:Wt.octant(c,f)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var c=arguments[0],f=arguments[1];this.addIntersectionNode(c,f)}else if(arguments.length===4){var y=arguments[1],P=arguments[3],F=new Dt(arguments[0].getIntersection(P));this.addIntersection(F,y)}}},{key:"toString",value:function(){return la.toLineString(new Et(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(c,f){var y=f,P=y+1;if(P<this._pts.length){var F=this._pts[P];c.equals2D(F)&&(y=P)}return this._nodeList.add(c,y)}},{key:"addIntersections",value:function(c,f,y){for(var P=0;P<c.getIntersectionNum();P++)this.addIntersection(c,f,y,P)}},{key:"interfaces_",get:function(){return[ln]}}],[{key:"constructor_",value:function(){this._nodeList=new mt(this),this._pts=null,this._data=null;var c=arguments[0],f=arguments[1];this._pts=c,this._data=f}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var c=arguments[0],f=new mr;return v.getNodedSubstrings(c,f),f}if(arguments.length===2)for(var y=arguments[1],P=arguments[0].iterator();P.hasNext();)P.next().getNodeList().addSplitEdges(y)}}])}(),qt=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof v){var c=arguments[0],f=Ir.index(this.p0,this.p1,c.p0),y=Ir.index(this.p0,this.p1,c.p1);return f>=0&&y>=0||f<=0&&y<=0?Math.max(f,y):0}if(arguments[0]instanceof Dt){var P=arguments[0];return Ir.index(this.p0,this.p1,P)}}},{key:"toGeometry",value:function(c){return c.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(c){if(!(c instanceof v))return!1;var f=c;return this.p0.equals(f.p0)&&this.p1.equals(f.p1)}},{key:"intersection",value:function(c){var f=new D;return f.computeIntersection(this.p0,this.p1,c.p0,c.p1),f.hasIntersection()?f.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Dt){var c=arguments[0];if(c.equals(this.p0)||c.equals(this.p1))return new Dt(c);var f=this.projectionFactor(c),y=new Dt;return y.x=this.p0.x+f*(this.p1.x-this.p0.x),y.y=this.p0.y+f*(this.p1.y-this.p0.y),y}if(arguments[0]instanceof v){var P=arguments[0],F=this.projectionFactor(P.p0),Z=this.projectionFactor(P.p1);if(F>=1&&Z>=1||F<=0&&Z<=0)return null;var re=this.project(P.p0);F<0&&(re=this.p0),F>1&&(re=this.p1);var Te=this.project(P.p1);return Z<0&&(Te=this.p0),Z>1&&(Te=this.p1),new v(re,Te)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(c){return c===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(c){return pe.pointToLinePerpendicular(c,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return v.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(c){if(c.equals(this.p0))return 0;if(c.equals(this.p1))return 1;var f=this.p1.x-this.p0.x,y=this.p1.y-this.p0.y,P=f*f+y*y;return P<=0?at.NaN:((c.x-this.p0.x)*f+(c.y-this.p0.y)*y)/P}},{key:"closestPoints",value:function(c){var f=this.intersection(c);if(f!==null)return[f,f];var y=new Array(2).fill(null),P=at.MAX_VALUE,F=null,Z=this.closestPoint(c.p0);P=Z.distance(c.p0),y[0]=Z,y[1]=c.p0;var re=this.closestPoint(c.p1);(F=re.distance(c.p1))<P&&(P=F,y[0]=re,y[1]=c.p1);var Te=c.closestPoint(this.p0);(F=Te.distance(this.p0))<P&&(P=F,y[0]=this.p0,y[1]=Te);var Xe=c.closestPoint(this.p1);return(F=Xe.distance(this.p1))<P&&(P=F,y[0]=this.p1,y[1]=Xe),y}},{key:"closestPoint",value:function(c){var f=this.projectionFactor(c);return f>0&&f<1?this.project(c):this.p0.distance(c)<this.p1.distance(c)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(c){var f=c,y=this.p0.compareTo(f.p0);return y!==0?y:this.p1.compareTo(f.p1)}},{key:"reverse",value:function(){var c=this.p0;this.p0=this.p1,this.p1=c}},{key:"equalsTopo",value:function(c){return this.p0.equals(c.p0)&&this.p1.equals(c.p1)||this.p0.equals(c.p1)&&this.p1.equals(c.p0)}},{key:"lineIntersection",value:function(c){return ur.intersection(this.p0,this.p1,c.p0,c.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(c,f){var y=this.p0.x+c*(this.p1.x-this.p0.x),P=this.p0.y+c*(this.p1.y-this.p0.y),F=this.p1.x-this.p0.x,Z=this.p1.y-this.p0.y,re=Math.sqrt(F*F+Z*Z),Te=0,Xe=0;if(f!==0){if(re<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");Te=f*F/re,Xe=f*Z/re}return new Dt(y-Xe,P+Te)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var c=arguments[0];this.setCoordinates(c.p0,c.p1)}else if(arguments.length===2){var f=arguments[0],y=arguments[1];this.p0.x=f.x,this.p0.y=f.y,this.p1.x=y.x,this.p1.y=y.y}}},{key:"segmentFraction",value:function(c){var f=this.projectionFactor(c);return f<0?f=0:(f>1||at.isNaN(f))&&(f=1),f}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(c){var f=this.p1.getY()-this.p0.getY(),y=this.p0.getX()-this.p1.getX(),P=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),F=f*f+y*y,Z=f*f-y*y,re=c.getX(),Te=c.getY();return new Dt((-Z*re-2*f*y*Te-2*f*P)/F,(Z*Te-2*f*y*re-2*y*P)/F)}},{key:"distance",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return pe.segmentToSegment(this.p0,this.p1,c.p0,c.p1)}if(arguments[0]instanceof Dt){var f=arguments[0];return pe.pointToSegment(f,this.p0,this.p1)}}},{key:"pointAlong",value:function(c){var f=new Dt;return f.x=this.p0.x+c*(this.p1.x-this.p0.x),f.y=this.p0.y+c*(this.p1.y-this.p0.y),f}},{key:"hashCode",value:function(){var c=at.doubleToLongBits(this.p0.x);c^=31*at.doubleToLongBits(this.p0.y);var f=Math.trunc(c)^Math.trunc(c>>32),y=at.doubleToLongBits(this.p1.x);return y^=31*at.doubleToLongBits(this.p1.y),f^(Math.trunc(y)^Math.trunc(y>>32))}},{key:"interfaces_",get:function(){return[Ie,qe]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)v.constructor_.call(this,new Dt,new Dt);else if(arguments.length===1){var c=arguments[0];v.constructor_.call(this,c.p0,c.p1)}else if(arguments.length===2){var f=arguments[0],y=arguments[1];this.p0=f,this.p1=y}else if(arguments.length===4){var P=arguments[0],F=arguments[1],Z=arguments[2],re=arguments[3];v.constructor_.call(this,new Dt(P,F),new Dt(Z,re))}}},{key:"midPoint",value:function(c,f){return new Dt((c.x+f.x)/2,(c.y+f.y)/2)}}])}(),Lt=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var v=arguments[1],c=arguments[2],f=arguments[3];arguments[0].getLineSegment(v,this._overlapSeg1),c.getLineSegment(f,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new qt,this._overlapSeg2=new qt}}])}(),Ai=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(v,c){c.p0=this._pts[v],c.p1=this._pts[v+1]}},{key:"computeSelect",value:function(v,c,f,y){var P=this._pts[c],F=this._pts[f];if(f-c==1)return y.select(this,c),null;if(!v.intersects(P,F))return null;var Z=Math.trunc((c+f)/2);c<Z&&this.computeSelect(v,c,Z,y),Z<f&&this.computeSelect(v,Z,f,y)}},{key:"getCoordinates",value:function(){for(var v=new Array(this._end-this._start+1).fill(null),c=0,f=this._start;f<=this._end;f++)v[c++]=this._pts[f];return v}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var v=arguments[0],c=arguments[1];this.computeOverlaps(this._start,this._end,v,v._start,v._end,c)}else if(arguments.length===6){var f=arguments[0],y=arguments[1],P=arguments[2],F=arguments[3],Z=arguments[4],re=arguments[5];if(y-f==1&&Z-F==1)return re.overlap(this,f,P,F),null;if(!this.overlaps(f,y,P,F,Z))return null;var Te=Math.trunc((f+y)/2),Xe=Math.trunc((F+Z)/2);f<Te&&(F<Xe&&this.computeOverlaps(f,Te,P,F,Xe,re),Xe<Z&&this.computeOverlaps(f,Te,P,Xe,Z,re)),Te<y&&(F<Xe&&this.computeOverlaps(Te,y,P,F,Xe,re),Xe<Z&&this.computeOverlaps(Te,y,P,Xe,Z,re))}}},{key:"setId",value:function(v){this._id=v}},{key:"select",value:function(v,c){this.computeSelect(v,this._start,this._end,c)}},{key:"getEnvelope",value:function(){if(this._env===null){var v=this._pts[this._start],c=this._pts[this._end];this._env=new Pe(v,c)}return this._env}},{key:"overlaps",value:function(v,c,f,y,P){return Pe.intersects(this._pts[v],this._pts[c],f._pts[y],f._pts[P])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var v=arguments[0],c=arguments[1],f=arguments[2],y=arguments[3];this._pts=v,this._start=c,this._end=f,this._context=y}}])}(),Zi=function(){function v(){xe(this,v)}return s(v,null,[{key:"findChainEnd",value:function(c,f){for(var y=f;y<c.length-1&&c[y].equals2D(c[y+1]);)y++;if(y>=c.length-1)return c.length-1;for(var P=Li.quadrant(c[y],c[y+1]),F=f+1;F<c.length&&!(!c[F-1].equals2D(c[F])&&Li.quadrant(c[F-1],c[F])!==P);)F++;return F-1}},{key:"getChains",value:function(){if(arguments.length===1){var c=arguments[0];return v.getChains(c,null)}if(arguments.length===2){var f=arguments[0],y=arguments[1],P=new mr,F=0;do{var Z=v.findChainEnd(f,F),re=new Ai(f,F,Z,y);P.add(re),F=Z}while(F<f.length-1);return P}}}])}(),Gi=function(){return s(function v(){xe(this,v)},[{key:"computeNodes",value:function(v){}},{key:"getNodedSubstrings",value:function(){}}])}(),Vi=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(v){this._segInt=v}},{key:"interfaces_",get:function(){return[Gi]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var v=arguments[0];this.setSegmentIntersector(v)}}}}])}(),gn=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return bt.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(f){for(var y=Zi.getChains(f.getCoordinates(),f).iterator();y.hasNext();){var P=y.next();P.setId(this._idCounter++),this._index.insert(P.getEnvelope(),P),this._monoChains.add(P)}}},{key:"computeNodes",value:function(f){this._nodedSegStrings=f;for(var y=f.iterator();y.hasNext();)this.add(y.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var f=new Nn(this._segInt),y=this._monoChains.iterator();y.hasNext();)for(var P=y.next(),F=this._index.query(P.getEnvelope()).iterator();F.hasNext();){var Z=F.next();if(Z.getId()>P.getId()&&(P.computeOverlaps(Z,f),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new mr,this._index=new Hi,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var f=arguments[0];Vi.constructor_.call(this,f)}}}}])}(Vi),Nn=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"overlap",value:function(){if(arguments.length!==4)return ct(c,"overlap",this,1).apply(this,arguments);var f=arguments[1],y=arguments[2],P=arguments[3],F=arguments[0].getContext(),Z=y.getContext();this._si.processIntersections(F,f,Z,P)}}],[{key:"constructor_",value:function(){this._si=null;var f=arguments[0];this._si=f}}])}(Lt);gn.SegmentOverlapAction=Nn;var sn=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"isDeletable",value:function(c,f,y,P){var F=this._inputLine[c],Z=this._inputLine[f],re=this._inputLine[y];return!!this.isConcave(F,Z,re)&&!!this.isShallow(F,Z,re,P)&&this.isShallowSampled(F,Z,c,y,P)}},{key:"deleteShallowConcavities",value:function(){for(var c=1,f=this.findNextNonDeletedIndex(c),y=this.findNextNonDeletedIndex(f),P=!1;y<this._inputLine.length;){var F=!1;this.isDeletable(c,f,y,this._distanceTol)&&(this._isDeleted[f]=v.DELETE,F=!0,P=!0),c=F?y:f,f=this.findNextNonDeletedIndex(c),y=this.findNextNonDeletedIndex(f)}return P}},{key:"isShallowConcavity",value:function(c,f,y,P){return Ir.index(c,f,y)===this._angleOrientation&&pe.pointToSegment(f,c,y)<P}},{key:"isShallowSampled",value:function(c,f,y,P,F){var Z=Math.trunc((P-y)/v.NUM_PTS_TO_CHECK);Z<=0&&(Z=1);for(var re=y;re<P;re+=Z)if(!this.isShallow(c,f,this._inputLine[re],F))return!1;return!0}},{key:"isConcave",value:function(c,f,y){var P=Ir.index(c,f,y)===this._angleOrientation;return P}},{key:"simplify",value:function(c){this._distanceTol=Math.abs(c),c<0&&(this._angleOrientation=Ir.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var f=!1;do f=this.deleteShallowConcavities();while(f);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(c){for(var f=c+1;f<this._inputLine.length&&this._isDeleted[f]===v.DELETE;)f++;return f}},{key:"isShallow",value:function(c,f,y,P){return pe.pointToSegment(f,c,y)<P}},{key:"collapseLine",value:function(){for(var c=new ce,f=0;f<this._inputLine.length;f++)this._isDeleted[f]!==v.DELETE&&c.add(this._inputLine[f]);return c.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ir.COUNTERCLOCKWISE;var c=arguments[0];this._inputLine=c}},{key:"simplify",value:function(c,f){return new v(c).simplify(f)}}])}();sn.INIT=0,sn.DELETE=1,sn.KEEP=1,sn.NUM_PTS_TO_CHECK=10;var nr=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getCoordinates",value:function(){return this._ptList.toArray(v.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"addPt",value:function(c){var f=new Dt(c);if(this._precisionModel.makePrecise(f),this.isRedundant(f))return null;this._ptList.add(f)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(c,f){if(f)for(var y=0;y<c.length;y++)this.addPt(c[y]);else for(var P=c.length-1;P>=0;P--)this.addPt(c[P])}},{key:"isRedundant",value:function(c){if(this._ptList.size()<1)return!1;var f=this._ptList.get(this._ptList.size()-1);return c.distance(f)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Vn().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var c=new Dt(this._ptList.get(0)),f=this._ptList.get(this._ptList.size()-1);if(c.equals(f))return null;this._ptList.add(c)}},{key:"setMinimumVertexDistance",value:function(c){this._minimimVertexDistance=c}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new mr}}])}();nr.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Fn=function(){function v(){xe(this,v)}return s(v,null,[{key:"toDegrees",value:function(c){return 180*c/Math.PI}},{key:"normalize",value:function(c){for(;c>Math.PI;)c-=v.PI_TIMES_2;for(;c<=-Math.PI;)c+=v.PI_TIMES_2;return c}},{key:"angle",value:function(){if(arguments.length===1){var c=arguments[0];return Math.atan2(c.y,c.x)}if(arguments.length===2){var f=arguments[0],y=arguments[1],P=y.x-f.x,F=y.y-f.y;return Math.atan2(F,P)}}},{key:"isAcute",value:function(c,f,y){var P=c.x-f.x,F=c.y-f.y;return P*(y.x-f.x)+F*(y.y-f.y)>0}},{key:"isObtuse",value:function(c,f,y){var P=c.x-f.x,F=c.y-f.y;return P*(y.x-f.x)+F*(y.y-f.y)<0}},{key:"interiorAngle",value:function(c,f,y){var P=v.angle(f,c),F=v.angle(f,y);return Math.abs(F-P)}},{key:"normalizePositive",value:function(c){if(c<0){for(;c<0;)c+=v.PI_TIMES_2;c>=v.PI_TIMES_2&&(c=0)}else{for(;c>=v.PI_TIMES_2;)c-=v.PI_TIMES_2;c<0&&(c=0)}return c}},{key:"angleBetween",value:function(c,f,y){var P=v.angle(f,c),F=v.angle(f,y);return v.diff(P,F)}},{key:"diff",value:function(c,f){var y=null;return(y=c<f?f-c:c-f)>Math.PI&&(y=2*Math.PI-y),y}},{key:"toRadians",value:function(c){return c*Math.PI/180}},{key:"getTurn",value:function(c,f){var y=Math.sin(f-c);return y>0?v.COUNTERCLOCKWISE:y<0?v.CLOCKWISE:v.NONE}},{key:"angleBetweenOriented",value:function(c,f,y){var P=v.angle(f,c),F=v.angle(f,y)-P;return F<=-Math.PI?F+v.PI_TIMES_2:F>Math.PI?F-v.PI_TIMES_2:F}}])}();Fn.PI_TIMES_2=2*Math.PI,Fn.PI_OVER_2=Math.PI/2,Fn.PI_OVER_4=Math.PI/4,Fn.COUNTERCLOCKWISE=Ir.COUNTERCLOCKWISE,Fn.CLOCKWISE=Ir.CLOCKWISE,Fn.NONE=Ir.COLLINEAR;var or=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"addNextSegment",value:function(c,f){if(this._s0=this._s1,this._s1=this._s2,this._s2=c,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var y=Ir.index(this._s0,this._s1,this._s2),P=y===Ir.CLOCKWISE&&this._side===un.LEFT||y===Ir.COUNTERCLOCKWISE&&this._side===un.RIGHT;y===0?this.addCollinear(f):P?this.addOutsideTurn(y,f):this.addInsideTurn(y,f)}},{key:"addLineEndCap",value:function(c,f){var y=new qt(c,f),P=new qt;this.computeOffsetSegment(y,un.LEFT,this._distance,P);var F=new qt;this.computeOffsetSegment(y,un.RIGHT,this._distance,F);var Z=f.x-c.x,re=f.y-c.y,Te=Math.atan2(re,Z);switch(this._bufParams.getEndCapStyle()){case ot.CAP_ROUND:this._segList.addPt(P.p1),this.addDirectedFillet(f,Te+Math.PI/2,Te-Math.PI/2,Ir.CLOCKWISE,this._distance),this._segList.addPt(F.p1);break;case ot.CAP_FLAT:this._segList.addPt(P.p1),this._segList.addPt(F.p1);break;case ot.CAP_SQUARE:var Xe=new Dt;Xe.x=Math.abs(this._distance)*Math.cos(Te),Xe.y=Math.abs(this._distance)*Math.sin(Te);var Yt=new Dt(P.p1.x+Xe.x,P.p1.y+Xe.y),Si=new Dt(F.p1.x+Xe.x,F.p1.y+Xe.y);this._segList.addPt(Yt),this._segList.addPt(Si)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(c,f,y,P){var F=ur.intersection(f.p0,f.p1,y.p0,y.p1);if(F!==null&&(P<=0?1:F.distance(c)/Math.abs(P))<=this._bufParams.getMitreLimit())return this._segList.addPt(F),null;this.addLimitedMitreJoin(f,y,P,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(c,f){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*v.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===ot.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===ot.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(f&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,c,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(c){this._segList.addPt(new Dt(c.x+this._distance,c.y+this._distance)),this._segList.addPt(new Dt(c.x+this._distance,c.y-this._distance)),this._segList.addPt(new Dt(c.x-this._distance,c.y-this._distance)),this._segList.addPt(new Dt(c.x-this._distance,c.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(c,f){this._segList.addPts(c,f)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(c,f,y,P,F){var Z=f.x-c.x,re=f.y-c.y,Te=Math.atan2(re,Z),Xe=y.x-c.x,Yt=y.y-c.y,Si=Math.atan2(Yt,Xe);P===Ir.CLOCKWISE?Te<=Si&&(Te+=2*Math.PI):Te>=Si&&(Te-=2*Math.PI),this._segList.addPt(f),this.addDirectedFillet(c,Te,Si,P,F),this._segList.addPt(y)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(c,f,y){this._s1=c,this._s2=f,this._side=y,this._seg1.setCoordinates(c,f),this.computeOffsetSegment(this._seg1,y,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(c,f,y,P){var F=this._seg0.p1,Z=Fn.angle(F,this._seg0.p0),re=Fn.angleBetweenOriented(this._seg0.p0,F,this._seg1.p1)/2,Te=Fn.normalize(Z+re),Xe=Fn.normalize(Te+Math.PI),Yt=P*y,Si=y-Yt*Math.abs(Math.sin(re)),bn=F.x+Yt*Math.cos(Xe),Jn=F.y+Yt*Math.sin(Xe),br=new Dt(bn,Jn),Dr=new qt(F,br),ts=Dr.pointAlongOffset(1,Si),os=Dr.pointAlongOffset(1,-Si);this._side===un.LEFT?(this._segList.addPt(ts),this._segList.addPt(os)):(this._segList.addPt(os),this._segList.addPt(ts))}},{key:"addDirectedFillet",value:function(c,f,y,P,F){var Z=P===Ir.CLOCKWISE?-1:1,re=Math.abs(f-y),Te=Math.trunc(re/this._filletAngleQuantum+.5);if(Te<1)return null;for(var Xe=re/Te,Yt=new Dt,Si=0;Si<Te;Si++){var bn=f+Z*Si*Xe;Yt.x=c.x+F*Math.cos(bn),Yt.y=c.y+F*Math.sin(bn),this._segList.addPt(Yt)}}},{key:"computeOffsetSegment",value:function(c,f,y,P){var F=f===un.LEFT?1:-1,Z=c.p1.x-c.p0.x,re=c.p1.y-c.p0.y,Te=Math.sqrt(Z*Z+re*re),Xe=F*y*Z/Te,Yt=F*y*re/Te;P.p0.x=c.p0.x-Yt,P.p0.y=c.p0.y+Xe,P.p1.x=c.p1.x-Yt,P.p1.y=c.p1.y+Xe}},{key:"addInsideTurn",value:function(c,f){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*v.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var y=new Dt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(y);var P=new Dt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(P)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(c){var f=new Dt(c.x+this._distance,c.y);this._segList.addPt(f),this.addDirectedFillet(c,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(c,f){this._segList.addPt(c.p1),this._segList.addPt(f.p0)}},{key:"init",value:function(c){this._distance=c,this._maxCurveSegmentError=c*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new nr,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(c*v.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(c){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===ot.JOIN_BEVEL||this._bufParams.getJoinStyle()===ot.JOIN_MITRE?(c&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,Ir.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new qt,this._seg1=new qt,this._offset0=new qt,this._offset1=new qt,this._side=0,this._hasNarrowConcaveAngle=!1;var c=arguments[0],f=arguments[1],y=arguments[2];this._precisionModel=c,this._bufParams=f,this._li=new D,this._filletAngleQuantum=Math.PI/2/f.getQuadrantSegments(),f.getQuadrantSegments()>=8&&f.getJoinStyle()===ot.JOIN_ROUND&&(this._closingSegLengthFactor=v.MAX_CLOSING_SEG_LEN_FACTOR),this.init(y)}}])}();or.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,or.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,or.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,or.MAX_CLOSING_SEG_LEN_FACTOR=80;var rr=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getOffsetCurve",value:function(c,f){if(this._distance=f,f===0)return null;var y=f<0,P=Math.abs(f),F=this.getSegGen(P);c.length<=1?this.computePointCurve(c[0],F):this.computeOffsetCurve(c,y,F);var Z=F.getCoordinates();return y&&Se.reverse(Z),Z}},{key:"computeSingleSidedBufferCurve",value:function(c,f,y){var P=this.simplifyTolerance(this._distance);if(f){y.addSegments(c,!0);var F=sn.simplify(c,-P),Z=F.length-1;y.initSideSegments(F[Z],F[Z-1],un.LEFT),y.addFirstSegment();for(var re=Z-2;re>=0;re--)y.addNextSegment(F[re],!0)}else{y.addSegments(c,!1);var Te=sn.simplify(c,P),Xe=Te.length-1;y.initSideSegments(Te[0],Te[1],un.LEFT),y.addFirstSegment();for(var Yt=2;Yt<=Xe;Yt++)y.addNextSegment(Te[Yt],!0)}y.addLastSegment(),y.closeRing()}},{key:"computeRingBufferCurve",value:function(c,f,y){var P=this.simplifyTolerance(this._distance);f===un.RIGHT&&(P=-P);var F=sn.simplify(c,P),Z=F.length-1;y.initSideSegments(F[Z-1],F[0],f);for(var re=1;re<=Z;re++){var Te=re!==1;y.addNextSegment(F[re],Te)}y.closeRing()}},{key:"computeLineBufferCurve",value:function(c,f){var y=this.simplifyTolerance(this._distance),P=sn.simplify(c,y),F=P.length-1;f.initSideSegments(P[0],P[1],un.LEFT);for(var Z=2;Z<=F;Z++)f.addNextSegment(P[Z],!0);f.addLastSegment(),f.addLineEndCap(P[F-1],P[F]);var re=sn.simplify(c,-y),Te=re.length-1;f.initSideSegments(re[Te],re[Te-1],un.LEFT);for(var Xe=Te-2;Xe>=0;Xe--)f.addNextSegment(re[Xe],!0);f.addLastSegment(),f.addLineEndCap(re[1],re[0]),f.closeRing()}},{key:"computePointCurve",value:function(c,f){switch(this._bufParams.getEndCapStyle()){case ot.CAP_ROUND:f.createCircle(c);break;case ot.CAP_SQUARE:f.createSquare(c)}}},{key:"getLineCurve",value:function(c,f){if(this._distance=f,this.isLineOffsetEmpty(f))return null;var y=Math.abs(f),P=this.getSegGen(y);if(c.length<=1)this.computePointCurve(c[0],P);else if(this._bufParams.isSingleSided()){var F=f<0;this.computeSingleSidedBufferCurve(c,F,P)}else this.computeLineBufferCurve(c,P);return P.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(c){return c*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(c,f,y){if(this._distance=y,c.length<=2)return this.getLineCurve(c,y);if(y===0)return v.copyCoordinates(c);var P=this.getSegGen(y);return this.computeRingBufferCurve(c,f,P),P.getCoordinates()}},{key:"computeOffsetCurve",value:function(c,f,y){var P=this.simplifyTolerance(this._distance);if(f){var F=sn.simplify(c,-P),Z=F.length-1;y.initSideSegments(F[Z],F[Z-1],un.LEFT),y.addFirstSegment();for(var re=Z-2;re>=0;re--)y.addNextSegment(F[re],!0)}else{var Te=sn.simplify(c,P),Xe=Te.length-1;y.initSideSegments(Te[0],Te[1],un.LEFT),y.addFirstSegment();for(var Yt=2;Yt<=Xe;Yt++)y.addNextSegment(Te[Yt],!0)}y.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(c){return c===0||c<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(c){return new or(this._precisionModel,this._bufParams,c)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var c=arguments[0],f=arguments[1];this._precisionModel=c,this._bufParams=f}},{key:"copyCoordinates",value:function(c){for(var f=new Array(c.length).fill(null),y=0;y<f.length;y++)f[y]=new Dt(c[y]);return f}}])}(),tr=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var v=arguments[0],c=new mr,f=this._subgraphs.iterator();f.hasNext();){var y=f.next(),P=y.getEnvelope();v.y<P.getMinY()||v.y>P.getMaxY()||this.findStabbedSegments(v,y.getDirectedEdges(),c)}return c}if(arguments.length===3){if(cn(arguments[2],ls)&&arguments[0]instanceof Dt&&arguments[1]instanceof St){for(var F=arguments[0],Z=arguments[1],re=arguments[2],Te=Z.getEdge().getCoordinates(),Xe=0;Xe<Te.length-1;Xe++)if(this._seg.p0=Te[Xe],this._seg.p1=Te[Xe+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<F.x||this._seg.isHorizontal()||F.y<this._seg.p0.y||F.y>this._seg.p1.y||Ir.index(this._seg.p0,this._seg.p1,F)===Ir.RIGHT)){var Yt=Z.getDepth(un.LEFT);this._seg.p0.equals(Te[Xe])||(Yt=Z.getDepth(un.RIGHT));var Si=new yr(this._seg,Yt);re.add(Si)}}else if(cn(arguments[2],ls)&&arguments[0]instanceof Dt&&cn(arguments[1],ls))for(var bn=arguments[0],Jn=arguments[2],br=arguments[1].iterator();br.hasNext();){var Dr=br.next();Dr.isForward()&&this.findStabbedSegments(bn,Dr,Jn)}}}},{key:"getDepth",value:function(v){var c=this.findStabbedSegments(v);return c.size()===0?0:oi.min(c)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new qt;var v=arguments[0];this._subgraphs=v}}])}(),yr=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(v){var c=v;if(this._upwardSeg.minX()>=c._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=c._upwardSeg.minX())return-1;var f=this._upwardSeg.orientationIndex(c._upwardSeg);return f!==0||(f=-1*c._upwardSeg.orientationIndex(this._upwardSeg))!==0?f:this._upwardSeg.compareTo(c._upwardSeg)}},{key:"compareX",value:function(v,c){var f=v.p0.compareTo(c.p0);return f!==0?f:v.p1.compareTo(c.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[Ie]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var v=arguments[0],c=arguments[1];this._upwardSeg=new qt(v),this._leftDepth=c}}])}();tr.DepthSegment=yr;var Wr=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,null,[{key:"constructor_",value:function(){dt.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(dt),ss=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getY",value:function(){var c=this.y/this.w;if(at.isNaN(c)||at.isInfinite(c))throw new Wr;return c}},{key:"getX",value:function(){var c=this.x/this.w;if(at.isNaN(c)||at.isInfinite(c))throw new Wr;return c}},{key:"getCoordinate",value:function(){var c=new Dt;return c.x=this.getX(),c.y=this.getY(),c}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var c=arguments[0];this.x=c.x,this.y=c.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var f=arguments[0],y=arguments[1];this.x=f,this.y=y,this.w=1}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var P=arguments[0],F=arguments[1];this.x=P.y*F.w-F.y*P.w,this.y=F.x*P.w-P.x*F.w,this.w=P.x*F.y-F.x*P.y}else if(arguments[0]instanceof Dt&&arguments[1]instanceof Dt){var Z=arguments[0],re=arguments[1];this.x=Z.y-re.y,this.y=re.x-Z.x,this.w=Z.x*re.y-re.x*Z.y}}else if(arguments.length===3){var Te=arguments[0],Xe=arguments[1],Yt=arguments[2];this.x=Te,this.y=Xe,this.w=Yt}else if(arguments.length===4){var Si=arguments[0],bn=arguments[1],Jn=arguments[2],br=arguments[3],Dr=Si.y-bn.y,ts=bn.x-Si.x,os=Si.x*bn.y-bn.x*Si.y,Ds=Jn.y-br.y,mo=br.x-Jn.x,uo=Jn.x*br.y-br.x*Jn.y;this.x=ts*uo-mo*os,this.y=Ds*os-Dr*uo,this.w=Dr*mo-Ds*ts}}}])}(),Br=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"area",value:function(){return v.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return v.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(c){if(c===null)throw new vt("Supplied point is null.");return v.interpolateZ(c,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return v.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return v.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return v.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return v.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return v.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return v.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var c=arguments[0],f=arguments[1],y=arguments[2];this.p0=c,this.p1=f,this.p2=y}},{key:"area",value:function(c,f,y){return Math.abs(((y.x-c.x)*(f.y-c.y)-(f.x-c.x)*(y.y-c.y))/2)}},{key:"signedArea",value:function(c,f,y){return((y.x-c.x)*(f.y-c.y)-(f.x-c.x)*(y.y-c.y))/2}},{key:"det",value:function(c,f,y,P){return c*P-f*y}},{key:"interpolateZ",value:function(c,f,y,P){var F=f.x,Z=f.y,re=y.x-F,Te=P.x-F,Xe=y.y-Z,Yt=P.y-Z,Si=re*Yt-Te*Xe,bn=c.x-F,Jn=c.y-Z,br=(Yt*bn-Te*Jn)/Si,Dr=(-Xe*bn+re*Jn)/Si;return f.getZ()+br*(y.getZ()-f.getZ())+Dr*(P.getZ()-f.getZ())}},{key:"longestSideLength",value:function(c,f,y){var P=c.distance(f),F=f.distance(y),Z=y.distance(c),re=P;return F>re&&(re=F),Z>re&&(re=Z),re}},{key:"circumcentreDD",value:function(c,f,y){var P=Dn.valueOf(c.x).subtract(y.x),F=Dn.valueOf(c.y).subtract(y.y),Z=Dn.valueOf(f.x).subtract(y.x),re=Dn.valueOf(f.y).subtract(y.y),Te=Dn.determinant(P,F,Z,re).multiply(2),Xe=P.sqr().add(F.sqr()),Yt=Z.sqr().add(re.sqr()),Si=Dn.determinant(F,Xe,re,Yt),bn=Dn.determinant(P,Xe,Z,Yt),Jn=Dn.valueOf(y.x).subtract(Si.divide(Te)).doubleValue(),br=Dn.valueOf(y.y).add(bn.divide(Te)).doubleValue();return new Dt(Jn,br)}},{key:"isAcute",value:function(c,f,y){return!!Fn.isAcute(c,f,y)&&!!Fn.isAcute(f,y,c)&&!!Fn.isAcute(y,c,f)}},{key:"circumcentre",value:function(c,f,y){var P=y.x,F=y.y,Z=c.x-P,re=c.y-F,Te=f.x-P,Xe=f.y-F,Yt=2*v.det(Z,re,Te,Xe),Si=v.det(re,Z*Z+re*re,Xe,Te*Te+Xe*Xe),bn=v.det(Z,Z*Z+re*re,Te,Te*Te+Xe*Xe);return new Dt(P-Si/Yt,F+bn/Yt)}},{key:"perpendicularBisector",value:function(c,f){var y=f.x-c.x,P=f.y-c.y,F=new ss(c.x+y/2,c.y+P/2,1),Z=new ss(c.x-P+y/2,c.y+y+P/2,1);return new ss(F,Z)}},{key:"angleBisector",value:function(c,f,y){var P=f.distance(c),F=P/(P+f.distance(y)),Z=y.x-c.x,re=y.y-c.y;return new Dt(c.x+F*Z,c.y+F*re)}},{key:"area3D",value:function(c,f,y){var P=f.x-c.x,F=f.y-c.y,Z=f.getZ()-c.getZ(),re=y.x-c.x,Te=y.y-c.y,Xe=y.getZ()-c.getZ(),Yt=F*Xe-Z*Te,Si=Z*re-P*Xe,bn=P*Te-F*re,Jn=Yt*Yt+Si*Si+bn*bn,br=Math.sqrt(Jn)/2;return br}},{key:"centroid",value:function(c,f,y){var P=(c.x+f.x+y.x)/3,F=(c.y+f.y+y.y)/3;return new Dt(P,F)}},{key:"inCentre",value:function(c,f,y){var P=f.distance(y),F=c.distance(y),Z=c.distance(f),re=P+F+Z,Te=(P*c.x+F*f.x+Z*y.x)/re,Xe=(P*c.y+F*f.y+Z*y.y)/re;return new Dt(Te,Xe)}}])}(),Gr=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(v,c,f,y,P){if(c===0&&v.length<Ce.MINIMUM_VALID_SIZE)return null;var F=y,Z=P;v.length>=Ce.MINIMUM_VALID_SIZE&&Ir.isCCW(v)&&(F=P,Z=y,f=un.opposite(f));var re=this._curveBuilder.getRingCurve(v,f,c);this.addCurve(re,F,Z)}},{key:"addRingBothSides",value:function(v,c){this.addRingSide(v,c,un.LEFT,lt.EXTERIOR,lt.INTERIOR),this.addRingSide(v,c,un.RIGHT,lt.INTERIOR,lt.EXTERIOR)}},{key:"addPoint",value:function(v){if(this._distance<=0)return null;var c=v.getCoordinates(),f=this._curveBuilder.getLineCurve(c,this._distance);this.addCurve(f,lt.EXTERIOR,lt.INTERIOR)}},{key:"addPolygon",value:function(v){var c=this._distance,f=un.LEFT;this._distance<0&&(c=-this._distance,f=un.RIGHT);var y=v.getExteriorRing(),P=Se.removeRepeatedPoints(y.getCoordinates());if(this._distance<0&&this.isErodedCompletely(y,this._distance)||this._distance<=0&&P.length<3)return null;this.addRingSide(P,c,f,lt.EXTERIOR,lt.INTERIOR);for(var F=0;F<v.getNumInteriorRing();F++){var Z=v.getInteriorRingN(F),re=Se.removeRepeatedPoints(Z.getCoordinates());this._distance>0&&this.isErodedCompletely(Z,-this._distance)||this.addRingSide(re,c,un.opposite(f),lt.INTERIOR,lt.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(v,c){var f=new Br(v[0],v[1],v[2]),y=f.inCentre();return pe.pointToSegment(y,f.p0,f.p1)<Math.abs(c)}},{key:"addLineString",value:function(v){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var c=Se.removeRepeatedPoints(v.getCoordinates());if(Se.isRing(c)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(c,this._distance);else{var f=this._curveBuilder.getLineCurve(c,this._distance);this.addCurve(f,lt.EXTERIOR,lt.INTERIOR)}}},{key:"addCurve",value:function(v,c,f){if(v===null||v.length<2)return null;var y=new bt(v,new Bt(0,lt.BOUNDARY,c,f));this._curveList.add(y)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(v){if(v.isEmpty())return null;if(v instanceof gt)this.addPolygon(v);else if(v instanceof Bn)this.addLineString(v);else if(v instanceof hs)this.addPoint(v);else if(v instanceof be)this.addCollection(v);else if(v instanceof dr)this.addCollection(v);else if(v instanceof Xt)this.addCollection(v);else{if(!(v instanceof Ee))throw new vs(v.getGeometryType());this.addCollection(v)}}},{key:"isErodedCompletely",value:function(v,c){var f=v.getCoordinates();if(f.length<4)return c<0;if(f.length===4)return this.isTriangleErodedCompletely(f,c);var y=v.getEnvelopeInternal(),P=Math.min(y.getHeight(),y.getWidth());return c<0&&2*Math.abs(c)>P}},{key:"addCollection",value:function(v){for(var c=0;c<v.getNumGeometries();c++){var f=v.getGeometryN(c);this.add(f)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new mr;var v=arguments[0],c=arguments[1],f=arguments[2];this._inputGeom=v,this._distance=c,this._curveBuilder=f}}])}(),Ms=function(){return s(function v(){xe(this,v)},[{key:"locate",value:function(v){}}])}(),Os=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,v.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Xi;var c=this._parent.getGeometryN(this._index++);return c instanceof Ee?(this._subcollectionIterator=new v(c),this._subcollectionIterator.next()):c}},{key:"remove",value:function(){throw new vs(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[fr]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var c=arguments[0];this._parent=c,this._atStart=!0,this._index=0,this._max=c.getNumGeometries()}},{key:"isAtomic",value:function(c){return!(c instanceof Ee)}}])}(),cr=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"locate",value:function(c){return v.locate(c,this._geom)}},{key:"interfaces_",get:function(){return[Ms]}}],[{key:"constructor_",value:function(){this._geom=null;var c=arguments[0];this._geom=c}},{key:"locatePointInPolygon",value:function(c,f){if(f.isEmpty())return lt.EXTERIOR;var y=f.getExteriorRing(),P=v.locatePointInRing(c,y);if(P!==lt.INTERIOR)return P;for(var F=0;F<f.getNumInteriorRing();F++){var Z=f.getInteriorRingN(F),re=v.locatePointInRing(c,Z);if(re===lt.BOUNDARY)return lt.BOUNDARY;if(re===lt.INTERIOR)return lt.EXTERIOR}return lt.INTERIOR}},{key:"locatePointInRing",value:function(c,f){return f.getEnvelopeInternal().intersects(c)?Ge.locateInRing(c,f.getCoordinates()):lt.EXTERIOR}},{key:"containsPointInPolygon",value:function(c,f){return lt.EXTERIOR!==v.locatePointInPolygon(c,f)}},{key:"locateInGeometry",value:function(c,f){if(f instanceof gt)return v.locatePointInPolygon(c,f);if(f instanceof Ee)for(var y=new Os(f);y.hasNext();){var P=y.next();if(P!==f){var F=v.locateInGeometry(c,P);if(F!==lt.EXTERIOR)return F}}return lt.EXTERIOR}},{key:"isContained",value:function(c,f){return lt.EXTERIOR!==v.locate(c,f)}},{key:"locate",value:function(c,f){return f.isEmpty()?lt.EXTERIOR:f.getEnvelopeInternal().intersects(c)?v.locateInGeometry(c,f):lt.EXTERIOR}}])}(),Ln=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(v){this.getEdges();var c=this._edgeList.indexOf(v),f=c-1;return c===0&&(f=this._edgeList.size()-1),this._edgeList.get(f)}},{key:"propagateSideLabels",value:function(v){for(var c=lt.NONE,f=this.iterator();f.hasNext();){var y=f.next().getLabel();y.isArea(v)&&y.getLocation(v,un.LEFT)!==lt.NONE&&(c=y.getLocation(v,un.LEFT))}if(c===lt.NONE)return null;for(var P=c,F=this.iterator();F.hasNext();){var Z=F.next(),re=Z.getLabel();if(re.getLocation(v,un.ON)===lt.NONE&&re.setLocation(v,un.ON,P),re.isArea(v)){var Te=re.getLocation(v,un.LEFT),Xe=re.getLocation(v,un.RIGHT);if(Xe!==lt.NONE){if(Xe!==P)throw new ms("side location conflict",Z.getCoordinate());Te===lt.NONE&&Mn.shouldNeverReachHere("found single null side (at "+Z.getCoordinate()+")"),P=Te}else Mn.isTrue(re.getLocation(v,un.LEFT)===lt.NONE,"found single null side"),re.setLocation(v,un.RIGHT,P),re.setLocation(v,un.LEFT,P)}}}},{key:"getCoordinate",value:function(){var v=this.iterator();return v.hasNext()?v.next().getCoordinate():null}},{key:"print",value:function(v){_e.out.println("EdgeEndStar:   "+this.getCoordinate());for(var c=this.iterator();c.hasNext();)c.next().print(v)}},{key:"isAreaLabelsConsistent",value:function(v){return this.computeEdgeEndLabels(v.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(v){var c=this.getEdges();if(c.size()<=0)return!0;var f=c.size()-1,y=c.get(f).getLabel().getLocation(v,un.LEFT);Mn.isTrue(y!==lt.NONE,"Found unlabelled area edge");for(var P=y,F=this.iterator();F.hasNext();){var Z=F.next().getLabel();Mn.isTrue(Z.isArea(v),"Found non-area edge");var re=Z.getLocation(v,un.LEFT),Te=Z.getLocation(v,un.RIGHT);if(re===Te||Te!==P)return!1;P=re}return!0}},{key:"findIndex",value:function(v){this.iterator();for(var c=0;c<this._edgeList.size();c++)if(this._edgeList.get(c)===v)return c;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new mr(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(v,c,f){return this._ptInAreaLocation[v]===lt.NONE&&(this._ptInAreaLocation[v]=cr.locate(c,f[v].getGeometry())),this._ptInAreaLocation[v]}},{key:"toString",value:function(){var v=new Jr;v.append("EdgeEndStar:   "+this.getCoordinate()),v.append(`
`);for(var c=this.iterator();c.hasNext();){var f=c.next();v.append(f),v.append(`
`)}return v.toString()}},{key:"computeEdgeEndLabels",value:function(v){for(var c=this.iterator();c.hasNext();)c.next().computeLabel(v)}},{key:"computeLabelling",value:function(v){this.computeEdgeEndLabels(v[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var c=[!1,!1],f=this.iterator();f.hasNext();)for(var y=f.next().getLabel(),P=0;P<2;P++)y.isLine(P)&&y.getLocation(P)===lt.BOUNDARY&&(c[P]=!0);for(var F=this.iterator();F.hasNext();)for(var Z=F.next(),re=Z.getLabel(),Te=0;Te<2;Te++)if(re.isAnyNull(Te)){var Xe=lt.NONE;if(c[Te])Xe=lt.EXTERIOR;else{var Yt=Z.getCoordinate();Xe=this.getLocation(Te,Yt,v)}re.setAllLocationsIfNull(Te,Xe)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(v,c){this._edgeMap.put(v,c),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new wi,this._edgeList=null,this._ptInAreaLocation=[lt.NONE,lt.NONE]}}])}(),$s=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var f=null,y=null,P=this._SCANNING_FOR_INCOMING,F=0;F<this._resultAreaEdgeList.size();F++){var Z=this._resultAreaEdgeList.get(F),re=Z.getSym();if(Z.getLabel().isArea())switch(f===null&&Z.isInResult()&&(f=Z),P){case this._SCANNING_FOR_INCOMING:if(!re.isInResult())continue;y=re,P=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!Z.isInResult())continue;y.setNext(Z),P=this._SCANNING_FOR_INCOMING}}if(P===this._LINKING_TO_OUTGOING){if(f===null)throw new ms("no outgoing dirEdge found",this.getCoordinate());Mn.isTrue(f.isInResult(),"unable to link last incoming dirEdge"),y.setNext(f)}}},{key:"insert",value:function(f){var y=f;this.insertEdgeEnd(y,y)}},{key:"getRightmostEdge",value:function(){var f=this.getEdges(),y=f.size();if(y<1)return null;var P=f.get(0);if(y===1)return P;var F=f.get(y-1),Z=P.getQuadrant(),re=F.getQuadrant();return Li.isNorthern(Z)&&Li.isNorthern(re)?P:Li.isNorthern(Z)||Li.isNorthern(re)?P.getDy()!==0?P:F.getDy()!==0?F:(Mn.shouldNeverReachHere("found two horizontal edges incident on node"),null):F}},{key:"print",value:function(f){_e.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var y=this.iterator();y.hasNext();){var P=y.next();f.print("out "),P.print(f),f.println(),f.print("in "),P.getSym().print(f),f.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new mr;for(var f=this.iterator();f.hasNext();){var y=f.next();(y.isInResult()||y.getSym().isInResult())&&this._resultAreaEdgeList.add(y)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(f){for(var y=this.iterator();y.hasNext();){var P=y.next().getLabel();P.setAllLocationsIfNull(0,f.getLocation(0)),P.setAllLocationsIfNull(1,f.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var f=null,y=null,P=this._edgeList.size()-1;P>=0;P--){var F=this._edgeList.get(P),Z=F.getSym();y===null&&(y=Z),f!==null&&Z.setNext(f),f=F}y.setNext(f)}},{key:"computeDepths",value:function(){if(arguments.length===1){var f=arguments[0],y=this.findIndex(f),P=f.getDepth(un.LEFT),F=f.getDepth(un.RIGHT),Z=this.computeDepths(y+1,this._edgeList.size(),P);if(this.computeDepths(0,y,Z)!==F)throw new ms("depth mismatch at "+f.getCoordinate())}else if(arguments.length===3){for(var re=arguments[1],Te=arguments[2],Xe=arguments[0];Xe<re;Xe++){var Yt=this._edgeList.get(Xe);Yt.setEdgeDepths(un.RIGHT,Te),Te=Yt.getDepth(un.LEFT)}return Te}}},{key:"mergeSymLabels",value:function(){for(var f=this.iterator();f.hasNext();){var y=f.next();y.getLabel().merge(y.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(f){for(var y=null,P=null,F=this._SCANNING_FOR_INCOMING,Z=this._resultAreaEdgeList.size()-1;Z>=0;Z--){var re=this._resultAreaEdgeList.get(Z),Te=re.getSym();switch(y===null&&re.getEdgeRing()===f&&(y=re),F){case this._SCANNING_FOR_INCOMING:if(Te.getEdgeRing()!==f)continue;P=Te,F=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(re.getEdgeRing()!==f)continue;P.setNextMin(re),F=this._SCANNING_FOR_INCOMING}}F===this._LINKING_TO_OUTGOING&&(Mn.isTrue(y!==null,"found null for first outgoing dirEdge"),Mn.isTrue(y.getEdgeRing()===f,"unable to link last incoming dirEdge"),P.setNextMin(y))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var f=0,y=this.iterator();y.hasNext();)y.next().isInResult()&&f++;return f}if(arguments.length===1){for(var P=arguments[0],F=0,Z=this.iterator();Z.hasNext();)Z.next().getEdgeRing()===P&&F++;return F}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var f=lt.NONE,y=this.iterator();y.hasNext();){var P=y.next(),F=P.getSym();if(!P.isLineEdge()){if(P.isInResult()){f=lt.INTERIOR;break}if(F.isInResult()){f=lt.EXTERIOR;break}}}if(f===lt.NONE)return null;for(var Z=f,re=this.iterator();re.hasNext();){var Te=re.next(),Xe=Te.getSym();Te.isLineEdge()?Te.getEdge().setCovered(Z===lt.INTERIOR):(Te.isInResult()&&(Z=lt.EXTERIOR),Xe.isInResult()&&(Z=lt.INTERIOR))}}},{key:"computeLabelling",value:function(f){ct(c,"computeLabelling",this,1).call(this,f),this._label=new Bt(lt.NONE);for(var y=this.iterator();y.hasNext();)for(var P=y.next().getEdge().getLabel(),F=0;F<2;F++){var Z=P.getLocation(F);Z!==lt.INTERIOR&&Z!==lt.BOUNDARY||this._label.setLocation(F,lt.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(Ln),ar=function(v){function c(){return xe(this,c),Tt(this,c)}return $t(c,v),s(c,[{key:"createNode",value:function(f){return new Er(f,new $s)}}])}(zt),po=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"compareTo",value:function(c){var f=c;return v.compareOriented(this._pts,this._orientation,f._pts,f._orientation)}},{key:"interfaces_",get:function(){return[Ie]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var c=arguments[0];this._pts=c,this._orientation=v.orientation(c)}},{key:"orientation",value:function(c){return Se.increasingDirection(c)===1}},{key:"compareOriented",value:function(c,f,y,P){for(var F=f?1:-1,Z=P?1:-1,re=f?c.length:-1,Te=P?y.length:-1,Xe=f?0:c.length-1,Yt=P?0:y.length-1;;){var Si=c[Xe].compareTo(y[Yt]);if(Si!==0)return Si;var bn=(Xe+=F)===re,Jn=(Yt+=Z)===Te;if(bn&&!Jn)return-1;if(!bn&&Jn)return 1;if(bn&&Jn)return 0}}}])}(),lo=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"print",value:function(v){v.print("MULTILINESTRING ( ");for(var c=0;c<this._edges.size();c++){var f=this._edges.get(c);c>0&&v.print(","),v.print("(");for(var y=f.getCoordinates(),P=0;P<y.length;P++)P>0&&v.print(","),v.print(y[P].x+" "+y[P].y);v.println(")")}v.print(")  ")}},{key:"addAll",value:function(v){for(var c=v.iterator();c.hasNext();)this.add(c.next())}},{key:"findEdgeIndex",value:function(v){for(var c=0;c<this._edges.size();c++)if(this._edges.get(c).equals(v))return c;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(v){return this._edges.get(v)}},{key:"findEqualEdge",value:function(v){var c=new po(v.getCoordinates());return this._ocaMap.get(c)}},{key:"add",value:function(v){this._edges.add(v);var c=new po(v.getCoordinates());this._ocaMap.put(c,v)}}],[{key:"constructor_",value:function(){this._edges=new mr,this._ocaMap=new wi}}])}(),Qn=function(){return s(function v(){xe(this,v)},[{key:"processIntersections",value:function(v,c,f,y){}},{key:"isDone",value:function(){}}])}(),Lo=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"isTrivialIntersection",value:function(c,f,y,P){if(c===y&&this._li.getIntersectionNum()===1){if(v.isAdjacentSegments(f,P))return!0;if(c.isClosed()){var F=c.size()-1;if(f===0&&P===F||P===0&&f===F)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(c,f,y,P){if(c===y&&f===P)return null;this.numTests++;var F=c.getCoordinates()[f],Z=c.getCoordinates()[f+1],re=y.getCoordinates()[P],Te=y.getCoordinates()[P+1];this._li.computeIntersection(F,Z,re,Te),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(c,f,y,P)||(this._hasIntersection=!0,c.addIntersections(this._li,f,0),y.addIntersections(this._li,P,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Qn]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var c=arguments[0];this._li=c}},{key:"isAdjacentSegments",value:function(c,f){return Math.abs(c-f)===1}}])}(),Go=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(v){v.print(this.coord),v.print(" seg # = "+this.segmentIndex),v.println(" dist = "+this.dist)}},{key:"compareTo",value:function(v){var c=v;return this.compare(c.segmentIndex,c.dist)}},{key:"isEndPoint",value:function(v){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===v}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(v,c){return this.segmentIndex<v?-1:this.segmentIndex>v?1:this.dist<c?-1:this.dist>c?1:0}},{key:"interfaces_",get:function(){return[Ie]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var v=arguments[0],c=arguments[1],f=arguments[2];this.coord=new Dt(v),this.segmentIndex=c,this.dist=f}}])}(),Aa=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"print",value:function(v){v.println("Intersections:");for(var c=this.iterator();c.hasNext();)c.next().print(v)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(v){this.addEndpoints();for(var c=this.iterator(),f=c.next();c.hasNext();){var y=c.next(),P=this.createSplitEdge(f,y);v.add(P),f=y}}},{key:"addEndpoints",value:function(){var v=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[v],v,0)}},{key:"createSplitEdge",value:function(v,c){var f=c.segmentIndex-v.segmentIndex+2,y=this.edge.pts[c.segmentIndex],P=c.dist>0||!c.coord.equals2D(y);P||f--;var F=new Array(f).fill(null),Z=0;F[Z++]=new Dt(v.coord);for(var re=v.segmentIndex+1;re<=c.segmentIndex;re++)F[Z++]=this.edge.pts[re];return P&&(F[Z]=c.coord),new $a(F,new Bt(this.edge._label))}},{key:"add",value:function(v,c,f){var y=new Go(v,c,f),P=this._nodeMap.get(y);return P!==null?P:(this._nodeMap.put(y,y),y)}},{key:"isIntersection",value:function(v){for(var c=this.iterator();c.hasNext();)if(c.next().coord.equals(v))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new wi,this.edge=null;var v=arguments[0];this.edge=v}}])}(),Ca=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(v.isTrue(this._matrix[lt.INTERIOR][lt.INTERIOR])||v.isTrue(this._matrix[lt.INTERIOR][lt.BOUNDARY])||v.isTrue(this._matrix[lt.BOUNDARY][lt.INTERIOR])||v.isTrue(this._matrix[lt.BOUNDARY][lt.BOUNDARY]))&&this._matrix[lt.EXTERIOR][lt.INTERIOR]===Zt.FALSE&&this._matrix[lt.EXTERIOR][lt.BOUNDARY]===Zt.FALSE}},{key:"isCoveredBy",value:function(){return(v.isTrue(this._matrix[lt.INTERIOR][lt.INTERIOR])||v.isTrue(this._matrix[lt.INTERIOR][lt.BOUNDARY])||v.isTrue(this._matrix[lt.BOUNDARY][lt.INTERIOR])||v.isTrue(this._matrix[lt.BOUNDARY][lt.BOUNDARY]))&&this._matrix[lt.INTERIOR][lt.EXTERIOR]===Zt.FALSE&&this._matrix[lt.BOUNDARY][lt.EXTERIOR]===Zt.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var c=arguments[0],f=0;f<c.length;f++){var y=Math.trunc(f/3),P=f%3;this._matrix[y][P]=Zt.toDimensionValue(c.charAt(f))}else if(arguments.length===3){var F=arguments[0],Z=arguments[1],re=arguments[2];this._matrix[F][Z]=re}}},{key:"isContains",value:function(){return v.isTrue(this._matrix[lt.INTERIOR][lt.INTERIOR])&&this._matrix[lt.EXTERIOR][lt.INTERIOR]===Zt.FALSE&&this._matrix[lt.EXTERIOR][lt.BOUNDARY]===Zt.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var c=arguments[0],f=0;f<c.length;f++){var y=Math.trunc(f/3),P=f%3;this.setAtLeast(y,P,Zt.toDimensionValue(c.charAt(f)))}else if(arguments.length===3){var F=arguments[0],Z=arguments[1],re=arguments[2];this._matrix[F][Z]<re&&(this._matrix[F][Z]=re)}}},{key:"setAtLeastIfValid",value:function(c,f,y){c>=0&&f>=0&&this.setAtLeast(c,f,y)}},{key:"isWithin",value:function(){return v.isTrue(this._matrix[lt.INTERIOR][lt.INTERIOR])&&this._matrix[lt.INTERIOR][lt.EXTERIOR]===Zt.FALSE&&this._matrix[lt.BOUNDARY][lt.EXTERIOR]===Zt.FALSE}},{key:"isTouches",value:function(c,f){return c>f?this.isTouches(f,c):(c===Zt.A&&f===Zt.A||c===Zt.L&&f===Zt.L||c===Zt.L&&f===Zt.A||c===Zt.P&&f===Zt.A||c===Zt.P&&f===Zt.L)&&this._matrix[lt.INTERIOR][lt.INTERIOR]===Zt.FALSE&&(v.isTrue(this._matrix[lt.INTERIOR][lt.BOUNDARY])||v.isTrue(this._matrix[lt.BOUNDARY][lt.INTERIOR])||v.isTrue(this._matrix[lt.BOUNDARY][lt.BOUNDARY]))}},{key:"isOverlaps",value:function(c,f){return c===Zt.P&&f===Zt.P||c===Zt.A&&f===Zt.A?v.isTrue(this._matrix[lt.INTERIOR][lt.INTERIOR])&&v.isTrue(this._matrix[lt.INTERIOR][lt.EXTERIOR])&&v.isTrue(this._matrix[lt.EXTERIOR][lt.INTERIOR]):c===Zt.L&&f===Zt.L&&this._matrix[lt.INTERIOR][lt.INTERIOR]===1&&v.isTrue(this._matrix[lt.INTERIOR][lt.EXTERIOR])&&v.isTrue(this._matrix[lt.EXTERIOR][lt.INTERIOR])}},{key:"isEquals",value:function(c,f){return c===f&&v.isTrue(this._matrix[lt.INTERIOR][lt.INTERIOR])&&this._matrix[lt.INTERIOR][lt.EXTERIOR]===Zt.FALSE&&this._matrix[lt.BOUNDARY][lt.EXTERIOR]===Zt.FALSE&&this._matrix[lt.EXTERIOR][lt.INTERIOR]===Zt.FALSE&&this._matrix[lt.EXTERIOR][lt.BOUNDARY]===Zt.FALSE}},{key:"toString",value:function(){for(var c=new ut("123456789"),f=0;f<3;f++)for(var y=0;y<3;y++)c.setCharAt(3*f+y,Zt.toDimensionSymbol(this._matrix[f][y]));return c.toString()}},{key:"setAll",value:function(c){for(var f=0;f<3;f++)for(var y=0;y<3;y++)this._matrix[f][y]=c}},{key:"get",value:function(c,f){return this._matrix[c][f]}},{key:"transpose",value:function(){var c=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=c,c=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=c,c=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=c,this}},{key:"matches",value:function(c){if(c.length!==9)throw new vt("Should be length 9: "+c);for(var f=0;f<3;f++)for(var y=0;y<3;y++)if(!v.matches(this._matrix[f][y],c.charAt(3*f+y)))return!1;return!0}},{key:"add",value:function(c){for(var f=0;f<3;f++)for(var y=0;y<3;y++)this.setAtLeast(f,y,c.get(f,y))}},{key:"isDisjoint",value:function(){return this._matrix[lt.INTERIOR][lt.INTERIOR]===Zt.FALSE&&this._matrix[lt.INTERIOR][lt.BOUNDARY]===Zt.FALSE&&this._matrix[lt.BOUNDARY][lt.INTERIOR]===Zt.FALSE&&this._matrix[lt.BOUNDARY][lt.BOUNDARY]===Zt.FALSE}},{key:"isCrosses",value:function(c,f){return c===Zt.P&&f===Zt.L||c===Zt.P&&f===Zt.A||c===Zt.L&&f===Zt.A?v.isTrue(this._matrix[lt.INTERIOR][lt.INTERIOR])&&v.isTrue(this._matrix[lt.INTERIOR][lt.EXTERIOR]):c===Zt.L&&f===Zt.P||c===Zt.A&&f===Zt.P||c===Zt.A&&f===Zt.L?v.isTrue(this._matrix[lt.INTERIOR][lt.INTERIOR])&&v.isTrue(this._matrix[lt.EXTERIOR][lt.INTERIOR]):c===Zt.L&&f===Zt.L&&this._matrix[lt.INTERIOR][lt.INTERIOR]===0}},{key:"interfaces_",get:function(){return[Ue]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(Zt.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var c=arguments[0];v.constructor_.call(this),this.set(c)}else if(arguments[0]instanceof v){var f=arguments[0];v.constructor_.call(this),this._matrix[lt.INTERIOR][lt.INTERIOR]=f._matrix[lt.INTERIOR][lt.INTERIOR],this._matrix[lt.INTERIOR][lt.BOUNDARY]=f._matrix[lt.INTERIOR][lt.BOUNDARY],this._matrix[lt.INTERIOR][lt.EXTERIOR]=f._matrix[lt.INTERIOR][lt.EXTERIOR],this._matrix[lt.BOUNDARY][lt.INTERIOR]=f._matrix[lt.BOUNDARY][lt.INTERIOR],this._matrix[lt.BOUNDARY][lt.BOUNDARY]=f._matrix[lt.BOUNDARY][lt.BOUNDARY],this._matrix[lt.BOUNDARY][lt.EXTERIOR]=f._matrix[lt.BOUNDARY][lt.EXTERIOR],this._matrix[lt.EXTERIOR][lt.INTERIOR]=f._matrix[lt.EXTERIOR][lt.INTERIOR],this._matrix[lt.EXTERIOR][lt.BOUNDARY]=f._matrix[lt.EXTERIOR][lt.BOUNDARY],this._matrix[lt.EXTERIOR][lt.EXTERIOR]=f._matrix[lt.EXTERIOR][lt.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var c=arguments[0],f=arguments[1];return f===Zt.SYM_DONTCARE||f===Zt.SYM_TRUE&&(c>=0||c===Zt.TRUE)||f===Zt.SYM_FALSE&&c===Zt.FALSE||f===Zt.SYM_P&&c===Zt.P||f===Zt.SYM_L&&c===Zt.L||f===Zt.SYM_A&&c===Zt.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var y=arguments[1];return new v(arguments[0]).matches(y)}}},{key:"isTrue",value:function(c){return c>=0||c===Zt.TRUE}}])}(),Ro=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(c){return c===null||c.length===0?null:(this.ensureCapacity(this._size+c.length),_e.arraycopy(c,0,this._data,this._size,c.length),void(this._size+=c.length))}},{key:"ensureCapacity",value:function(c){if(c<=this._data.length)return null;var f=Math.max(c,2*this._data.length);this._data=qr.copyOf(this._data,f)}},{key:"toArray",value:function(){var c=new Array(this._size).fill(null);return _e.arraycopy(this._data,0,c,0,this._size),c}},{key:"add",value:function(c){this.ensureCapacity(this._size+1),this._data[this._size]=c,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)v.constructor_.call(this,10);else if(arguments.length===1){var c=arguments[0];this._data=new Array(c).fill(null)}}}])}(),Eo=function(){function v(){xe(this,v)}return s(v,[{key:"getChainStartIndices",value:function(c){var f=0,y=new Ro(Math.trunc(c.length/2));y.add(f);do{var P=this.findChainEnd(c,f);y.add(P),f=P}while(f<c.length-1);return y.toArray()}},{key:"findChainEnd",value:function(c,f){for(var y=Li.quadrant(c[f],c[f+1]),P=f+1;P<c.length&&Li.quadrant(c[P-1],c[P])===y;)P++;return P-1}},{key:"OLDgetChainStartIndices",value:function(c){var f=0,y=new mr;y.add(f);do{var P=this.findChainEnd(c,f);y.add(P),f=P}while(f<c.length-1);return v.toIntArray(y)}}],[{key:"toIntArray",value:function(c){for(var f=new Array(c.size()).fill(null),y=0;y<f.length;y++)f[y]=c.get(y).intValue();return f}}])}(),mn=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(v){var c=this.pts[this.startIndex[v]].x,f=this.pts[this.startIndex[v+1]].x;return c>f?c:f}},{key:"getMinX",value:function(v){var c=this.pts[this.startIndex[v]].x,f=this.pts[this.startIndex[v+1]].x;return c<f?c:f}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var v=arguments[0],c=arguments[1],f=arguments[2],y=arguments[3];this.computeIntersectsForChain(this.startIndex[v],this.startIndex[v+1],c,c.startIndex[f],c.startIndex[f+1],y)}else if(arguments.length===6){var P=arguments[0],F=arguments[1],Z=arguments[2],re=arguments[3],Te=arguments[4],Xe=arguments[5];if(F-P==1&&Te-re==1)return Xe.addIntersections(this.e,P,Z.e,re),null;if(!this.overlaps(P,F,Z,re,Te))return null;var Yt=Math.trunc((P+F)/2),Si=Math.trunc((re+Te)/2);P<Yt&&(re<Si&&this.computeIntersectsForChain(P,Yt,Z,re,Si,Xe),Si<Te&&this.computeIntersectsForChain(P,Yt,Z,Si,Te,Xe)),Yt<F&&(re<Si&&this.computeIntersectsForChain(Yt,F,Z,re,Si,Xe),Si<Te&&this.computeIntersectsForChain(Yt,F,Z,Si,Te,Xe))}}},{key:"overlaps",value:function(v,c,f,y,P){return Pe.intersects(this.pts[v],this.pts[c],f.pts[y],f.pts[P])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(v,c){for(var f=0;f<this.startIndex.length-1;f++)for(var y=0;y<v.startIndex.length-1;y++)this.computeIntersectsForChain(f,v,y,c)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var v=arguments[0];this.e=v,this.pts=v.getCoordinates();var c=new Eo;this.startIndex=c.getChainStartIndices(this.pts)}}])}(),ol=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"getDepth",value:function(c,f){return this._depth[c][f]}},{key:"setDepth",value:function(c,f,y){this._depth[c][f]=y}},{key:"isNull",value:function(){if(arguments.length===0){for(var c=0;c<2;c++)for(var f=0;f<3;f++)if(this._depth[c][f]!==v.NULL_VALUE)return!1;return!0}if(arguments.length===1){var y=arguments[0];return this._depth[y][1]===v.NULL_VALUE}if(arguments.length===2){var P=arguments[0],F=arguments[1];return this._depth[P][F]===v.NULL_VALUE}}},{key:"normalize",value:function(){for(var c=0;c<2;c++)if(!this.isNull(c)){var f=this._depth[c][1];this._depth[c][2]<f&&(f=this._depth[c][2]),f<0&&(f=0);for(var y=1;y<3;y++){var P=0;this._depth[c][y]>f&&(P=1),this._depth[c][y]=P}}}},{key:"getDelta",value:function(c){return this._depth[c][un.RIGHT]-this._depth[c][un.LEFT]}},{key:"getLocation",value:function(c,f){return this._depth[c][f]<=0?lt.EXTERIOR:lt.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var c=arguments[0],f=0;f<2;f++)for(var y=1;y<3;y++){var P=c.getLocation(f,y);P!==lt.EXTERIOR&&P!==lt.INTERIOR||(this.isNull(f,y)?this._depth[f][y]=v.depthAtLocation(P):this._depth[f][y]+=v.depthAtLocation(P))}else if(arguments.length===3){var F=arguments[0],Z=arguments[1];arguments[2]===lt.INTERIOR&&this._depth[F][Z]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var c=0;c<2;c++)for(var f=0;f<3;f++)this._depth[c][f]=v.NULL_VALUE}},{key:"depthAtLocation",value:function(c){return c===lt.EXTERIOR?0:c===lt.INTERIOR?1:v.NULL_VALUE}}])}();ol.NULL_VALUE=-1;var $a=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var f=new Array(2).fill(null);return f[0]=this.pts[0],f[1]=this.pts[1],new c(f,Bt.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(f){this._isIsolated=f}},{key:"setName",value:function(f){this._name=f}},{key:"equals",value:function(f){if(!(f instanceof c))return!1;var y=f;if(this.pts.length!==y.pts.length)return!1;for(var P=!0,F=!0,Z=this.pts.length,re=0;re<this.pts.length;re++)if(this.pts[re].equals2D(y.pts[re])||(P=!1),this.pts[re].equals2D(y.pts[--Z])||(F=!1),!P&&!F)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var f=arguments[0];return this.pts[f]}}},{key:"print",value:function(f){f.print("edge "+this._name+": "),f.print("LINESTRING (");for(var y=0;y<this.pts.length;y++)y>0&&f.print(","),f.print(this.pts[y].x+" "+this.pts[y].y);f.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(f){c.updateIM(this._label,f)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(f){f.print("edge "+this._name+": ");for(var y=this.pts.length-1;y>=0;y--)f.print(this.pts[y]+" ");f.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new mn(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Pe;for(var f=0;f<this.pts.length;f++)this._env.expandToInclude(this.pts[f])}return this._env}},{key:"addIntersection",value:function(f,y,P,F){var Z=new Dt(f.getIntersection(F)),re=y,Te=f.getEdgeDistance(P,F),Xe=re+1;if(Xe<this.pts.length){var Yt=this.pts[Xe];Z.equals2D(Yt)&&(re=Xe,Te=0)}this.eiList.add(Z,re,Te)}},{key:"toString",value:function(){var f=new ut;f.append("edge "+this._name+": "),f.append("LINESTRING (");for(var y=0;y<this.pts.length;y++)y>0&&f.append(","),f.append(this.pts[y].x+" "+this.pts[y].y);return f.append(")  "+this._label+" "+this._depthDelta),f.toString()}},{key:"isPointwiseEqual",value:function(f){if(this.pts.length!==f.pts.length)return!1;for(var y=0;y<this.pts.length;y++)if(!this.pts[y].equals2D(f.pts[y]))return!1;return!0}},{key:"setDepthDelta",value:function(f){this._depthDelta=f}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(f,y,P){for(var F=0;F<f.getIntersectionNum();F++)this.addIntersection(f,y,P,F)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Aa(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ol,this._depthDelta=0,arguments.length===1){var f=arguments[0];c.constructor_.call(this,f,null)}else if(arguments.length===2){var y=arguments[0],P=arguments[1];this.pts=y,this._label=P}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Ca&&arguments[0]instanceof Bt))return ct(c,"updateIM",this).apply(this,arguments);var f=arguments[0],y=arguments[1];y.setAtLeastIfValid(f.getLocation(0,un.ON),f.getLocation(1,un.ON),1),f.isArea()&&(y.setAtLeastIfValid(f.getLocation(0,un.LEFT),f.getLocation(1,un.LEFT),2),y.setAtLeastIfValid(f.getLocation(0,un.RIGHT),f.getLocation(1,un.RIGHT),2))}}])}(pr),Pa=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"setWorkingPrecisionModel",value:function(c){this._workingPrecisionModel=c}},{key:"insertUniqueEdge",value:function(c){var f=this._edgeList.findEqualEdge(c);if(f!==null){var y=f.getLabel(),P=c.getLabel();f.isPointwiseEqual(c)||(P=new Bt(c.getLabel())).flip(),y.merge(P);var F=v.depthDelta(P),Z=f.getDepthDelta()+F;f.setDepthDelta(Z)}else this._edgeList.add(c),c.setDepthDelta(v.depthDelta(c.getLabel()))}},{key:"buildSubgraphs",value:function(c,f){for(var y=new mr,P=c.iterator();P.hasNext();){var F=P.next(),Z=F.getRightmostCoordinate(),re=new tr(y).getDepth(Z);F.computeDepth(re),F.findResultEdges(),y.add(F),f.add(F.getDirectedEdges(),F.getNodes())}}},{key:"createSubgraphs",value:function(c){for(var f=new mr,y=c.getNodes().iterator();y.hasNext();){var P=y.next();if(!P.isVisited()){var F=new ks;F.create(P),f.add(F)}}return oi.sort(f,oi.reverseOrder()),f}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(c){if(this._workingNoder!==null)return this._workingNoder;var f=new gn,y=new D;return y.setPrecisionModel(c),f.setSegmentIntersector(new Lo(y)),f}},{key:"buffer",value:function(c,f){var y=this._workingPrecisionModel;y===null&&(y=c.getPrecisionModel()),this._geomFact=c.getFactory();var P=new rr(y,this._bufParams),F=new Gr(c,f,P).getCurves();if(F.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(F,y),this._graph=new At(new ar),this._graph.addEdges(this._edgeList.getEdges());var Z=this.createSubgraphs(this._graph),re=new kt(this._geomFact);this.buildSubgraphs(Z,re);var Te=re.getPolygons();return Te.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(Te)}},{key:"computeNodedEdges",value:function(c,f){var y=this.getNoder(f);y.computeNodes(c);for(var P=y.getNodedSubstrings().iterator();P.hasNext();){var F=P.next(),Z=F.getCoordinates();if(Z.length!==2||!Z[0].equals2D(Z[1])){var re=F.getData(),Te=new $a(F.getCoordinates(),new Bt(re));this.insertUniqueEdge(Te)}}}},{key:"setNoder",value:function(c){this._workingNoder=c}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new lo;var c=arguments[0];this._bufParams=c}},{key:"depthDelta",value:function(c){var f=c.getLocation(0,un.LEFT),y=c.getLocation(0,un.RIGHT);return f===lt.INTERIOR&&y===lt.EXTERIOR?1:f===lt.EXTERIOR&&y===lt.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(c){for(var f=new Vn,y=new mr;c.hasNext();){var P=c.next(),F=f.createLineString(P.getCoordinates());y.add(F)}return f.buildGeometry(y)}}])}(),La=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"rescale",value:function(){if(cn(arguments[0],cs))for(var c=arguments[0].iterator();c.hasNext();){var f=c.next();this.rescale(f.getCoordinates())}else if(arguments[0]instanceof Array){for(var y=arguments[0],P=0;P<y.length;P++)y[P].x=y[P].x/this._scaleFactor+this._offsetX,y[P].y=y[P].y/this._scaleFactor+this._offsetY;y.length===2&&y[0].equals2D(y[1])&&_e.out.println(y)}}},{key:"scale",value:function(){if(cn(arguments[0],cs)){for(var c=arguments[0],f=new mr(c.size()),y=c.iterator();y.hasNext();){var P=y.next();f.add(new bt(this.scale(P.getCoordinates()),P.getData()))}return f}if(arguments[0]instanceof Array){for(var F=arguments[0],Z=new Array(F.length).fill(null),re=0;re<F.length;re++)Z[re]=new Dt(Math.round((F[re].x-this._offsetX)*this._scaleFactor),Math.round((F[re].y-this._offsetY)*this._scaleFactor),F[re].getZ());return Se.removeRepeatedPoints(Z)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var c=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(c),c}},{key:"computeNodes",value:function(c){var f=c;this._isScaled&&(f=this.scale(c)),this._noder.computeNodes(f)}},{key:"interfaces_",get:function(){return[Gi]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var c=arguments[0],f=arguments[1];v.constructor_.call(this,c,f,0,0)}else if(arguments.length===4){var y=arguments[0],P=arguments[1];this._noder=y,this._scaleFactor=P,this._isScaled=!this.isIntegerPrecision()}}}])}(),_o=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var f=c.next().getCoordinates();this.checkEndPtVertexIntersections(f[0],this._segStrings),this.checkEndPtVertexIntersections(f[f.length-1],this._segStrings)}else if(arguments.length===2){for(var y=arguments[0],P=arguments[1].iterator();P.hasNext();)for(var F=P.next().getCoordinates(),Z=1;Z<F.length-1;Z++)if(F[Z].equals(y))throw new Qi("found endpt/interior pt intersection at index "+Z+" :pt "+y)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();)for(var f=c.next(),y=this._segStrings.iterator();y.hasNext();){var P=y.next();this.checkInteriorIntersections(f,P)}else if(arguments.length===2)for(var F=arguments[0],Z=arguments[1],re=F.getCoordinates(),Te=Z.getCoordinates(),Xe=0;Xe<re.length-1;Xe++)for(var Yt=0;Yt<Te.length-1;Yt++)this.checkInteriorIntersections(F,Xe,Z,Yt);else if(arguments.length===4){var Si=arguments[0],bn=arguments[1],Jn=arguments[2],br=arguments[3];if(Si===Jn&&bn===br)return null;var Dr=Si.getCoordinates()[bn],ts=Si.getCoordinates()[bn+1],os=Jn.getCoordinates()[br],Ds=Jn.getCoordinates()[br+1];if(this._li.computeIntersection(Dr,ts,os,Ds),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Dr,ts)||this.hasInteriorIntersection(this._li,os,Ds)))throw new Qi("found non-noded intersection at "+Dr+"-"+ts+" and "+os+"-"+Ds)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var f=c.next();this.checkCollapses(f)}else if(arguments.length===1)for(var y=arguments[0].getCoordinates(),P=0;P<y.length-2;P++)this.checkCollapse(y[P],y[P+1],y[P+2])}},{key:"hasInteriorIntersection",value:function(c,f,y){for(var P=0;P<c.getIntersectionNum();P++){var F=c.getIntersection(P);if(!F.equals(f)&&!F.equals(y))return!0}return!1}},{key:"checkCollapse",value:function(c,f,y){if(c.equals(y))throw new Qi("found non-noded collapse at "+v.fact.createLineString([c,f,y]))}}],[{key:"constructor_",value:function(){this._li=new D,this._segStrings=null;var c=arguments[0];this._segStrings=c}}])}();_o.fact=new Vn;var Qo=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"intersectsScaled",value:function(c,f){var y=Math.min(c.x,f.x),P=Math.max(c.x,f.x),F=Math.min(c.y,f.y),Z=Math.max(c.y,f.y),re=this._maxx<y||this._minx>P||this._maxy<F||this._miny>Z;if(re)return!1;var Te=this.intersectsToleranceSquare(c,f);return Mn.isTrue(!(re&&Te),"Found bad envelope test"),Te}},{key:"initCorners",value:function(c){var f=.5;this._minx=c.x-f,this._maxx=c.x+f,this._miny=c.y-f,this._maxy=c.y+f,this._corner[0]=new Dt(this._maxx,this._maxy),this._corner[1]=new Dt(this._minx,this._maxy),this._corner[2]=new Dt(this._minx,this._miny),this._corner[3]=new Dt(this._maxx,this._miny)}},{key:"intersects",value:function(c,f){return this._scaleFactor===1?this.intersectsScaled(c,f):(this.copyScaled(c,this._p0Scaled),this.copyScaled(f,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(c){return Math.round(c*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(c,f){f.x=this.scale(c.x),f.y=this.scale(c.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var c=v.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Pe(this._originalPt.x-c,this._originalPt.x+c,this._originalPt.y-c,this._originalPt.y+c)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(c,f){return this._li.computeIntersection(c,f,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,f,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,f,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,f,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(c,f){var y=!1,P=!1;return this._li.computeIntersection(c,f,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(c,f,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(y=!0),this._li.computeIntersection(c,f,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(P=!0),this._li.computeIntersection(c,f,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!y||!P)||!!c.equals(this._pt)||!!f.equals(this._pt))))}},{key:"addSnappedNode",value:function(c,f){var y=c.getCoordinate(f),P=c.getCoordinate(f+1);return!!this.intersects(y,P)&&(c.addIntersection(this.getCoordinate(),f),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var c=arguments[0],f=arguments[1],y=arguments[2];if(this._originalPt=c,this._pt=c,this._scaleFactor=f,this._li=y,f<=0)throw new vt("Scale factor must be non-zero");f!==1&&(this._pt=new Dt(this.scale(c.x),this.scale(c.y)),this._p0Scaled=new Dt,this._p1Scaled=new Dt),this.initCorners(this._pt)}}])}();Qo.SAFE_ENV_EXPANSION_FACTOR=.75;var Wa=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var v=arguments[1];arguments[0].getLineSegment(v,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new qt}}])}(),va=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(arguments.length===1){var v=arguments[0];return this.snap(v,null,-1)}if(arguments.length===3){var c=arguments[0],f=arguments[1],y=arguments[2],P=c.getSafeEnvelope(),F=new xa(c,f,y);return this._index.query(P,new(function(){return s(function Z(){xe(this,Z)},[{key:"interfaces_",get:function(){return[Di]}},{key:"visitItem",value:function(Z){Z.select(P,F)}}])}())),F.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var v=arguments[0];this._index=v}}])}(),xa=function(v){function c(){var f;return xe(this,c),f=Tt(this,c),c.constructor_.apply(f,arguments),f}return $t(c,v),s(c,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Ai))return ct(c,"select",this,1).apply(this,arguments);var f=arguments[1],y=arguments[0].getContext();if(this._parentEdge===y&&(f===this._hotPixelVertexIndex||f+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(y,f)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var f=arguments[0],y=arguments[1],P=arguments[2];this._hotPixel=f,this._parentEdge=y,this._hotPixelVertexIndex=P}}])}(Wa);va.HotPixelSnapAction=xa;var ua=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(v,c,f,y){if(v===f&&c===y)return null;var P=v.getCoordinates()[c],F=v.getCoordinates()[c+1],Z=f.getCoordinates()[y],re=f.getCoordinates()[y+1];if(this._li.computeIntersection(P,F,Z,re),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var Te=0;Te<this._li.getIntersectionNum();Te++)this._interiorIntersections.add(this._li.getIntersection(Te));v.addIntersections(this._li,c,0),f.addIntersections(this._li,y,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Qn]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var v=arguments[0];this._li=v,this._interiorIntersections=new mr}}])}(),Ns=function(){return s(function v(){xe(this,v),v.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(v){var c=bt.getNodedSubstrings(v),f=new _o(c);try{f.checkValid()}catch(y){if(!(y instanceof dt))throw y;y.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return bt.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(v,c){var f=this.findInteriorIntersections(v,c);this.computeIntersectionSnaps(f),this.computeVertexSnaps(v)}},{key:"findInteriorIntersections",value:function(v,c){var f=new ua(c);return this._noder.setSegmentIntersector(f),this._noder.computeNodes(v),f.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(cn(arguments[0],cs))for(var v=arguments[0].iterator();v.hasNext();){var c=v.next();this.computeVertexSnaps(c)}else if(arguments[0]instanceof bt)for(var f=arguments[0],y=f.getCoordinates(),P=0;P<y.length;P++){var F=new Qo(y[P],this._scaleFactor,this._li);this._pointSnapper.snap(F,f,P)&&f.addIntersection(y[P],P)}}},{key:"computeNodes",value:function(v){this._nodedSegStrings=v,this._noder=new gn,this._pointSnapper=new va(this._noder.getIndex()),this.snapRound(v,this._li)}},{key:"computeIntersectionSnaps",value:function(v){for(var c=v.iterator();c.hasNext();){var f=c.next(),y=new Qo(f,this._scaleFactor,this._li);this._pointSnapper.snap(y)}}},{key:"interfaces_",get:function(){return[Gi]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var v=arguments[0];this._pm=v,this._li=new D,this._li.setPrecisionModel(v),this._scaleFactor=v.getScale()}}])}(),wa=function(){function v(){xe(this,v),v.constructor_.apply(this,arguments)}return s(v,[{key:"bufferFixedPrecision",value:function(c){var f=new La(new Ns(new Tn(1)),c.getScale()),y=new Pa(this._bufParams);y.setWorkingPrecisionModel(c),y.setNoder(f),this._resultGeometry=y.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var c=v.MAX_PRECISION_DIGITS;c>=0;c--){try{this.bufferReducedPrecision(c)}catch(F){if(!(F instanceof ms))throw F;this._saveException=F}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var f=arguments[0],y=v.precisionScaleFactor(this._argGeom,this._distance,f),P=new Tn(y);this.bufferFixedPrecision(P)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var c=this._argGeom.getFactory().getPrecisionModel();c.getType()===Tn.FIXED?this.bufferFixedPrecision(c):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(c){this._bufParams.setQuadrantSegments(c)}},{key:"bufferOriginalPrecision",value:function(){try{var c=new Pa(this._bufParams);this._resultGeometry=c.buffer(this._argGeom,this._distance)}catch(f){if(!(f instanceof Qi))throw f;this._saveException=f}}},{key:"getResultGeometry",value:function(c){return this._distance=c,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(c){this._bufParams.setEndCapStyle(c)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new ot,this._resultGeometry=null,this._saveException=null,arguments.length===1){var c=arguments[0];this._argGeom=c}else if(arguments.length===2){var f=arguments[0],y=arguments[1];this._argGeom=f,this._bufParams=y}}},{key:"bufferOp",value:function(){if(arguments.length===2){var c=arguments[1];return new v(arguments[0]).getResultGeometry(c)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof $n&&typeof arguments[1]=="number"){var f=arguments[1],y=arguments[2],P=new v(arguments[0]);return P.setQuadrantSegments(y),P.getResultGeometry(f)}if(arguments[2]instanceof ot&&arguments[0]instanceof $n&&typeof arguments[1]=="number"){var F=arguments[1];return new v(arguments[0],arguments[2]).getResultGeometry(F)}}else if(arguments.length===4){var Z=arguments[1],re=arguments[2],Te=arguments[3],Xe=new v(arguments[0]);return Xe.setQuadrantSegments(re),Xe.setEndCapStyle(Te),Xe.getResultGeometry(Z)}}},{key:"precisionScaleFactor",value:function(c,f,y){var P=c.getEnvelopeInternal(),F=he.max(Math.abs(P.getMaxX()),Math.abs(P.getMaxY()),Math.abs(P.getMinX()),Math.abs(P.getMinY()))+2*(f>0?f:0),Z=y-Math.trunc(Math.log(F)/Math.log(10)+1);return Math.pow(10,Z)}}])}();wa.CAP_ROUND=ot.CAP_ROUND,wa.CAP_BUTT=ot.CAP_FLAT,wa.CAP_FLAT=ot.CAP_FLAT,wa.CAP_SQUARE=ot.CAP_SQUARE,wa.MAX_PRECISION_DIGITS=12;var Il=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Ml=function(){return s(function v(c){xe(this,v),this.geometryFactory=c||new Vn},[{key:"read",value:function(v){var c,f=(c=typeof v=="string"?JSON.parse(v):v).type;if(!oa[f])throw new Error("Unknown GeoJSON type: "+c.type);return Il.indexOf(f)!==-1?oa[f].call(this,c.coordinates):f==="GeometryCollection"?oa[f].call(this,c.geometries):oa[f].call(this,c)}},{key:"write",value:function(v){var c=v.getGeometryType();if(!ea[c])throw new Error("Geometry is not supported");return ea[c].call(this,v)}}])}(),oa={Feature:function(v){var c={};for(var f in v)c[f]=v[f];if(v.geometry){var y=v.geometry.type;if(!oa[y])throw new Error("Unknown GeoJSON type: "+v.type);c.geometry=this.read(v.geometry)}return v.bbox&&(c.bbox=oa.bbox.call(this,v.bbox)),c},FeatureCollection:function(v){var c={};if(v.features){c.features=[];for(var f=0;f<v.features.length;++f)c.features.push(this.read(v.features[f]))}return v.bbox&&(c.bbox=this.parse.bbox.call(this,v.bbox)),c},coordinates:function(v){for(var c=[],f=0;f<v.length;++f){var y=v[f];c.push(Pi(Dt,Qt(y)))}return c},bbox:function(v){return this.geometryFactory.createLinearRing([new Dt(v[0],v[1]),new Dt(v[2],v[1]),new Dt(v[2],v[3]),new Dt(v[0],v[3]),new Dt(v[0],v[1])])},Point:function(v){var c=Pi(Dt,Qt(v));return this.geometryFactory.createPoint(c)},MultiPoint:function(v){for(var c=[],f=0;f<v.length;++f)c.push(oa.Point.call(this,v[f]));return this.geometryFactory.createMultiPoint(c)},LineString:function(v){var c=oa.coordinates.call(this,v);return this.geometryFactory.createLineString(c)},MultiLineString:function(v){for(var c=[],f=0;f<v.length;++f)c.push(oa.LineString.call(this,v[f]));return this.geometryFactory.createMultiLineString(c)},Polygon:function(v){for(var c=oa.coordinates.call(this,v[0]),f=this.geometryFactory.createLinearRing(c),y=[],P=1;P<v.length;++P){var F=v[P],Z=oa.coordinates.call(this,F),re=this.geometryFactory.createLinearRing(Z);y.push(re)}return this.geometryFactory.createPolygon(f,y)},MultiPolygon:function(v){for(var c=[],f=0;f<v.length;++f){var y=v[f];c.push(oa.Polygon.call(this,y))}return this.geometryFactory.createMultiPolygon(c)},GeometryCollection:function(v){for(var c=[],f=0;f<v.length;++f){var y=v[f];c.push(this.read(y))}return this.geometryFactory.createGeometryCollection(c)}},ea={coordinate:function(v){var c=[v.x,v.y];return v.z&&c.push(v.z),v.m&&c.push(v.m),c},Point:function(v){return{type:"Point",coordinates:ea.coordinate.call(this,v.getCoordinate())}},MultiPoint:function(v){for(var c=[],f=0;f<v._geometries.length;++f){var y=v._geometries[f],P=ea.Point.call(this,y);c.push(P.coordinates)}return{type:"MultiPoint",coordinates:c}},LineString:function(v){for(var c=[],f=v.getCoordinates(),y=0;y<f.length;++y){var P=f[y];c.push(ea.coordinate.call(this,P))}return{type:"LineString",coordinates:c}},MultiLineString:function(v){for(var c=[],f=0;f<v._geometries.length;++f){var y=v._geometries[f],P=ea.LineString.call(this,y);c.push(P.coordinates)}return{type:"MultiLineString",coordinates:c}},Polygon:function(v){var c=[],f=ea.LineString.call(this,v._shell);c.push(f.coordinates);for(var y=0;y<v._holes.length;++y){var P=v._holes[y],F=ea.LineString.call(this,P);c.push(F.coordinates)}return{type:"Polygon",coordinates:c}},MultiPolygon:function(v){for(var c=[],f=0;f<v._geometries.length;++f){var y=v._geometries[f],P=ea.Polygon.call(this,y);c.push(P.coordinates)}return{type:"MultiPolygon",coordinates:c}},GeometryCollection:function(v){for(var c=[],f=0;f<v._geometries.length;++f){var y=v._geometries[f],P=y.getGeometryType();c.push(ea[P].call(this,y))}return{type:"GeometryCollection",geometries:c}}};return{BufferOp:wa,GeoJSONReader:function(){return s(function v(c){xe(this,v),this.parser=new Ml(c||new Vn)},[{key:"read",value:function(v){return this.parser.read(v)}}])}(),GeoJSONWriter:function(){return s(function v(){xe(this,v),this.parser=new Ml(this.geometryFactory)},[{key:"write",value:function(v){return this.parser.write(v)}}])}()}})},94889:function(){"use strict"},58596:function(){"use strict"},3341:function(ir){"use strict";ir.exports=function Yn(Tt,xe){if(Tt===xe)return!0;if(Tt&&xe&&typeof Tt=="object"&&typeof xe=="object"){if(Tt.constructor!==xe.constructor)return!1;var Pi,hn,s;if(Array.isArray(Tt)){if(Pi=Tt.length,Pi!=xe.length)return!1;for(hn=Pi;hn--!==0;)if(!Yn(Tt[hn],xe[hn]))return!1;return!0}if(Tt.constructor===RegExp)return Tt.source===xe.source&&Tt.flags===xe.flags;if(Tt.valueOf!==Object.prototype.valueOf)return Tt.valueOf()===xe.valueOf();if(Tt.toString!==Object.prototype.toString)return Tt.toString()===xe.toString();if(s=Object.keys(Tt),Pi=s.length,Pi!==Object.keys(xe).length)return!1;for(hn=Pi;hn--!==0;)if(!Object.prototype.hasOwnProperty.call(xe,s[hn]))return!1;for(hn=Pi;hn--!==0;){var xn=s[hn];if(!Yn(Tt[xn],xe[xn]))return!1}return!0}return Tt!==Tt&&xe!==xe}},95959:function(ir){(function(Yn,Tt){ir.exports=Tt()})(this,function(){"use strict";var Yn,Tt,xe;function Pi(s,xn){if(!Yn)Yn=xn;else if(!Tt)Tt=xn;else{var tn="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Yn+")(sharedChunk); ("+Tt+")(sharedChunk); self.onerror = null;",ti={};Yn(ti),xe=xn(ti),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(xe.workerUrl=window.URL.createObjectURL(new Blob([tn],{type:"text/javascript"})))}}Pi(["exports"],function(s){function xn(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var tn,ti={},$t={};function et(){if(tn)return $t;tn=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.setMatrixArrayType=function(h){$t.ARRAY_TYPE=e=h},$t.toRadian=function(h){return h*o},$t.equals=function(h,a){return Math.abs(h-a)<=r*Math.max(1,Math.abs(h),Math.abs(a))},$t.RANDOM=$t.ARRAY_TYPE=$t.EPSILON=void 0;var r=1e-6;$t.EPSILON=r;var e=typeof Float32Array!="undefined"?Float32Array:Array;$t.ARRAY_TYPE=e;var i=Math.random;$t.RANDOM=i;var o=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var h=0,a=arguments.length;a--;)h+=arguments[a]*arguments[a];return Math.sqrt(h)}),$t}var yi,ct={};function Qt(){if(yi)return ct;function r(a){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},r(a)}yi=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.create=function(){var a=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},ct.clone=function(a){var d=new e.ARRAY_TYPE(4);return d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d},ct.copy=function(a,d){return a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=d[3],a},ct.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},ct.fromValues=function(a,d,_,w){var M=new e.ARRAY_TYPE(4);return M[0]=a,M[1]=d,M[2]=_,M[3]=w,M},ct.set=function(a,d,_,w,M){return a[0]=d,a[1]=_,a[2]=w,a[3]=M,a},ct.transpose=function(a,d){if(a===d){var _=d[1];a[1]=d[2],a[2]=_}else a[0]=d[0],a[1]=d[2],a[2]=d[1],a[3]=d[3];return a},ct.invert=function(a,d){var _=d[0],w=d[1],M=d[2],m=d[3],E=_*m-M*w;return E?(a[0]=m*(E=1/E),a[1]=-w*E,a[2]=-M*E,a[3]=_*E,a):null},ct.adjoint=function(a,d){var _=d[0];return a[0]=d[3],a[1]=-d[1],a[2]=-d[2],a[3]=_,a},ct.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},ct.multiply=o,ct.rotate=function(a,d,_){var w=d[0],M=d[1],m=d[2],E=d[3],I=Math.sin(_),b=Math.cos(_);return a[0]=w*b+m*I,a[1]=M*b+E*I,a[2]=w*-I+m*b,a[3]=M*-I+E*b,a},ct.scale=function(a,d,_){var w=d[1],M=d[2],m=d[3],E=_[0],I=_[1];return a[0]=d[0]*E,a[1]=w*E,a[2]=M*I,a[3]=m*I,a},ct.fromRotation=function(a,d){var _=Math.sin(d),w=Math.cos(d);return a[0]=w,a[1]=_,a[2]=-_,a[3]=w,a},ct.fromScaling=function(a,d){return a[0]=d[0],a[1]=0,a[2]=0,a[3]=d[1],a},ct.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},ct.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},ct.LDU=function(a,d,_,w){return a[2]=w[2]/w[0],_[0]=w[0],_[1]=w[1],_[3]=w[3]-a[2]*_[1],[a,d,_]},ct.add=function(a,d,_){return a[0]=d[0]+_[0],a[1]=d[1]+_[1],a[2]=d[2]+_[2],a[3]=d[3]+_[3],a},ct.subtract=h,ct.exactEquals=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]},ct.equals=function(a,d){var _=a[0],w=a[1],M=a[2],m=a[3],E=d[0],I=d[1],b=d[2],T=d[3];return Math.abs(_-E)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(E))&&Math.abs(w-I)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(I))&&Math.abs(M-b)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(b))&&Math.abs(m-T)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(T))},ct.multiplyScalar=function(a,d,_){return a[0]=d[0]*_,a[1]=d[1]*_,a[2]=d[2]*_,a[3]=d[3]*_,a},ct.multiplyScalarAndAdd=function(a,d,_,w){return a[0]=d[0]+_[0]*w,a[1]=d[1]+_[1]*w,a[2]=d[2]+_[2]*w,a[3]=d[3]+_[3]*w,a},ct.sub=ct.mul=void 0;var e=function(a,d){if(a&&a.__esModule)return a;if(a===null||r(a)!=="object"&&typeof a!="function")return{default:a};var _=i(void 0);if(_&&_.has(a))return _.get(a);var w={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in a)if(m!=="default"&&Object.prototype.hasOwnProperty.call(a,m)){var E=M?Object.getOwnPropertyDescriptor(a,m):null;E&&(E.get||E.set)?Object.defineProperty(w,m,E):w[m]=a[m]}return w.default=a,_&&_.set(a,w),w}(et());function i(a){if(typeof WeakMap!="function")return null;var d=new WeakMap,_=new WeakMap;return(i=function(w){return w?_:d})(a)}function o(a,d,_){var w=d[0],M=d[1],m=d[2],E=d[3],I=_[0],b=_[1],T=_[2],A=_[3];return a[0]=w*I+m*b,a[1]=M*I+E*b,a[2]=w*T+m*A,a[3]=M*T+E*A,a}function h(a,d,_){return a[0]=d[0]-_[0],a[1]=d[1]-_[1],a[2]=d[2]-_[2],a[3]=d[3]-_[3],a}return ct.mul=o,ct.sub=h,ct}var Ii,Yi={};function We(){if(Ii)return Yi;function r(a){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},r(a)}Ii=1,Object.defineProperty(Yi,"__esModule",{value:!0}),Yi.create=function(){var a=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[4]=0,a[5]=0),a[0]=1,a[3]=1,a},Yi.clone=function(a){var d=new e.ARRAY_TYPE(6);return d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[4]=a[4],d[5]=a[5],d},Yi.copy=function(a,d){return a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=d[3],a[4]=d[4],a[5]=d[5],a},Yi.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},Yi.fromValues=function(a,d,_,w,M,m){var E=new e.ARRAY_TYPE(6);return E[0]=a,E[1]=d,E[2]=_,E[3]=w,E[4]=M,E[5]=m,E},Yi.set=function(a,d,_,w,M,m,E){return a[0]=d,a[1]=_,a[2]=w,a[3]=M,a[4]=m,a[5]=E,a},Yi.invert=function(a,d){var _=d[0],w=d[1],M=d[2],m=d[3],E=d[4],I=d[5],b=_*m-w*M;return b?(a[0]=m*(b=1/b),a[1]=-w*b,a[2]=-M*b,a[3]=_*b,a[4]=(M*I-m*E)*b,a[5]=(w*E-_*I)*b,a):null},Yi.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},Yi.multiply=o,Yi.rotate=function(a,d,_){var w=d[0],M=d[1],m=d[2],E=d[3],I=d[4],b=d[5],T=Math.sin(_),A=Math.cos(_);return a[0]=w*A+m*T,a[1]=M*A+E*T,a[2]=w*-T+m*A,a[3]=M*-T+E*A,a[4]=I,a[5]=b,a},Yi.scale=function(a,d,_){var w=d[1],M=d[2],m=d[3],E=d[4],I=d[5],b=_[0],T=_[1];return a[0]=d[0]*b,a[1]=w*b,a[2]=M*T,a[3]=m*T,a[4]=E,a[5]=I,a},Yi.translate=function(a,d,_){var w=d[0],M=d[1],m=d[2],E=d[3],I=d[4],b=d[5],T=_[0],A=_[1];return a[0]=w,a[1]=M,a[2]=m,a[3]=E,a[4]=w*T+m*A+I,a[5]=M*T+E*A+b,a},Yi.fromRotation=function(a,d){var _=Math.sin(d),w=Math.cos(d);return a[0]=w,a[1]=_,a[2]=-_,a[3]=w,a[4]=0,a[5]=0,a},Yi.fromScaling=function(a,d){return a[0]=d[0],a[1]=0,a[2]=0,a[3]=d[1],a[4]=0,a[5]=0,a},Yi.fromTranslation=function(a,d){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=d[0],a[5]=d[1],a},Yi.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},Yi.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],1)},Yi.add=function(a,d,_){return a[0]=d[0]+_[0],a[1]=d[1]+_[1],a[2]=d[2]+_[2],a[3]=d[3]+_[3],a[4]=d[4]+_[4],a[5]=d[5]+_[5],a},Yi.subtract=h,Yi.multiplyScalar=function(a,d,_){return a[0]=d[0]*_,a[1]=d[1]*_,a[2]=d[2]*_,a[3]=d[3]*_,a[4]=d[4]*_,a[5]=d[5]*_,a},Yi.multiplyScalarAndAdd=function(a,d,_,w){return a[0]=d[0]+_[0]*w,a[1]=d[1]+_[1]*w,a[2]=d[2]+_[2]*w,a[3]=d[3]+_[3]*w,a[4]=d[4]+_[4]*w,a[5]=d[5]+_[5]*w,a},Yi.exactEquals=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]},Yi.equals=function(a,d){var _=a[0],w=a[1],M=a[2],m=a[3],E=a[4],I=a[5],b=d[0],T=d[1],A=d[2],k=d[3],O=d[4],U=d[5];return Math.abs(_-b)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(b))&&Math.abs(w-T)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(T))&&Math.abs(M-A)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(A))&&Math.abs(m-k)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(E-O)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(O))&&Math.abs(I-U)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(U))},Yi.sub=Yi.mul=void 0;var e=function(a,d){if(a&&a.__esModule)return a;if(a===null||r(a)!=="object"&&typeof a!="function")return{default:a};var _=i(void 0);if(_&&_.has(a))return _.get(a);var w={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in a)if(m!=="default"&&Object.prototype.hasOwnProperty.call(a,m)){var E=M?Object.getOwnPropertyDescriptor(a,m):null;E&&(E.get||E.set)?Object.defineProperty(w,m,E):w[m]=a[m]}return w.default=a,_&&_.set(a,w),w}(et());function i(a){if(typeof WeakMap!="function")return null;var d=new WeakMap,_=new WeakMap;return(i=function(w){return w?_:d})(a)}function o(a,d,_){var w=d[0],M=d[1],m=d[2],E=d[3],I=d[4],b=d[5],T=_[0],A=_[1],k=_[2],O=_[3],U=_[4],G=_[5];return a[0]=w*T+m*A,a[1]=M*T+E*A,a[2]=w*k+m*O,a[3]=M*k+E*O,a[4]=w*U+m*G+I,a[5]=M*U+E*G+b,a}function h(a,d,_){return a[0]=d[0]-_[0],a[1]=d[1]-_[1],a[2]=d[2]-_[2],a[3]=d[3]-_[3],a[4]=d[4]-_[4],a[5]=d[5]-_[5],a}return Yi.mul=o,Yi.sub=h,Yi}var ot,dt={};function vt(){if(ot)return dt;function r(a){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},r(a)}ot=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.create=function(){var a=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},dt.fromMat4=function(a,d){return a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=d[4],a[4]=d[5],a[5]=d[6],a[6]=d[8],a[7]=d[9],a[8]=d[10],a},dt.clone=function(a){var d=new e.ARRAY_TYPE(9);return d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[8]=a[8],d},dt.copy=function(a,d){return a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=d[3],a[4]=d[4],a[5]=d[5],a[6]=d[6],a[7]=d[7],a[8]=d[8],a},dt.fromValues=function(a,d,_,w,M,m,E,I,b){var T=new e.ARRAY_TYPE(9);return T[0]=a,T[1]=d,T[2]=_,T[3]=w,T[4]=M,T[5]=m,T[6]=E,T[7]=I,T[8]=b,T},dt.set=function(a,d,_,w,M,m,E,I,b,T){return a[0]=d,a[1]=_,a[2]=w,a[3]=M,a[4]=m,a[5]=E,a[6]=I,a[7]=b,a[8]=T,a},dt.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},dt.transpose=function(a,d){if(a===d){var _=d[1],w=d[2],M=d[5];a[1]=d[3],a[2]=d[6],a[3]=_,a[5]=d[7],a[6]=w,a[7]=M}else a[0]=d[0],a[1]=d[3],a[2]=d[6],a[3]=d[1],a[4]=d[4],a[5]=d[7],a[6]=d[2],a[7]=d[5],a[8]=d[8];return a},dt.invert=function(a,d){var _=d[0],w=d[1],M=d[2],m=d[3],E=d[4],I=d[5],b=d[6],T=d[7],A=d[8],k=A*E-I*T,O=-A*m+I*b,U=T*m-E*b,G=_*k+w*O+M*U;return G?(a[0]=k*(G=1/G),a[1]=(-A*w+M*T)*G,a[2]=(I*w-M*E)*G,a[3]=O*G,a[4]=(A*_-M*b)*G,a[5]=(-I*_+M*m)*G,a[6]=U*G,a[7]=(-T*_+w*b)*G,a[8]=(E*_-w*m)*G,a):null},dt.adjoint=function(a,d){var _=d[0],w=d[1],M=d[2],m=d[3],E=d[4],I=d[5],b=d[6],T=d[7],A=d[8];return a[0]=E*A-I*T,a[1]=M*T-w*A,a[2]=w*I-M*E,a[3]=I*b-m*A,a[4]=_*A-M*b,a[5]=M*m-_*I,a[6]=m*T-E*b,a[7]=w*b-_*T,a[8]=_*E-w*m,a},dt.determinant=function(a){var d=a[3],_=a[4],w=a[5],M=a[6],m=a[7],E=a[8];return a[0]*(E*_-w*m)+a[1]*(-E*d+w*M)+a[2]*(m*d-_*M)},dt.multiply=o,dt.translate=function(a,d,_){var w=d[0],M=d[1],m=d[2],E=d[3],I=d[4],b=d[5],T=d[6],A=d[7],k=d[8],O=_[0],U=_[1];return a[0]=w,a[1]=M,a[2]=m,a[3]=E,a[4]=I,a[5]=b,a[6]=O*w+U*E+T,a[7]=O*M+U*I+A,a[8]=O*m+U*b+k,a},dt.rotate=function(a,d,_){var w=d[0],M=d[1],m=d[2],E=d[3],I=d[4],b=d[5],T=d[6],A=d[7],k=d[8],O=Math.sin(_),U=Math.cos(_);return a[0]=U*w+O*E,a[1]=U*M+O*I,a[2]=U*m+O*b,a[3]=U*E-O*w,a[4]=U*I-O*M,a[5]=U*b-O*m,a[6]=T,a[7]=A,a[8]=k,a},dt.scale=function(a,d,_){var w=_[0],M=_[1];return a[0]=w*d[0],a[1]=w*d[1],a[2]=w*d[2],a[3]=M*d[3],a[4]=M*d[4],a[5]=M*d[5],a[6]=d[6],a[7]=d[7],a[8]=d[8],a},dt.fromTranslation=function(a,d){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=d[0],a[7]=d[1],a[8]=1,a},dt.fromRotation=function(a,d){var _=Math.sin(d),w=Math.cos(d);return a[0]=w,a[1]=_,a[2]=0,a[3]=-_,a[4]=w,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},dt.fromScaling=function(a,d){return a[0]=d[0],a[1]=0,a[2]=0,a[3]=0,a[4]=d[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},dt.fromMat2d=function(a,d){return a[0]=d[0],a[1]=d[1],a[2]=0,a[3]=d[2],a[4]=d[3],a[5]=0,a[6]=d[4],a[7]=d[5],a[8]=1,a},dt.fromQuat=function(a,d){var _=d[0],w=d[1],M=d[2],m=d[3],E=_+_,I=w+w,b=M+M,T=_*E,A=w*E,k=w*I,O=M*E,U=M*I,G=M*b,B=m*E,H=m*I,$=m*b;return a[0]=1-k-G,a[3]=A-$,a[6]=O+H,a[1]=A+$,a[4]=1-T-G,a[7]=U-B,a[2]=O-H,a[5]=U+B,a[8]=1-T-k,a},dt.normalFromMat4=function(a,d){var _=d[0],w=d[1],M=d[2],m=d[3],E=d[4],I=d[5],b=d[6],T=d[7],A=d[8],k=d[9],O=d[10],U=d[11],G=d[12],B=d[13],H=d[14],$=d[15],ne=_*I-w*E,me=_*b-M*E,de=_*T-m*E,ue=w*b-M*I,Fe=w*T-m*I,ye=M*T-m*b,Ve=A*B-k*G,$e=A*H-O*G,Ze=A*$-U*G,Qe=k*H-O*B,ht=k*$-U*B,wt=O*$-U*H,st=ne*wt-me*ht+de*Qe+ue*Ze-Fe*$e+ye*Ve;return st?(a[0]=(I*wt-b*ht+T*Qe)*(st=1/st),a[1]=(b*Ze-E*wt-T*$e)*st,a[2]=(E*ht-I*Ze+T*Ve)*st,a[3]=(M*ht-w*wt-m*Qe)*st,a[4]=(_*wt-M*Ze+m*$e)*st,a[5]=(w*Ze-_*ht-m*Ve)*st,a[6]=(B*ye-H*Fe+$*ue)*st,a[7]=(H*de-G*ye-$*me)*st,a[8]=(G*Fe-B*de+$*ne)*st,a):null},dt.projection=function(a,d,_){return a[0]=2/d,a[1]=0,a[2]=0,a[3]=0,a[4]=-2/_,a[5]=0,a[6]=-1,a[7]=1,a[8]=1,a},dt.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},dt.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},dt.add=function(a,d,_){return a[0]=d[0]+_[0],a[1]=d[1]+_[1],a[2]=d[2]+_[2],a[3]=d[3]+_[3],a[4]=d[4]+_[4],a[5]=d[5]+_[5],a[6]=d[6]+_[6],a[7]=d[7]+_[7],a[8]=d[8]+_[8],a},dt.subtract=h,dt.multiplyScalar=function(a,d,_){return a[0]=d[0]*_,a[1]=d[1]*_,a[2]=d[2]*_,a[3]=d[3]*_,a[4]=d[4]*_,a[5]=d[5]*_,a[6]=d[6]*_,a[7]=d[7]*_,a[8]=d[8]*_,a},dt.multiplyScalarAndAdd=function(a,d,_,w){return a[0]=d[0]+_[0]*w,a[1]=d[1]+_[1]*w,a[2]=d[2]+_[2]*w,a[3]=d[3]+_[3]*w,a[4]=d[4]+_[4]*w,a[5]=d[5]+_[5]*w,a[6]=d[6]+_[6]*w,a[7]=d[7]+_[7]*w,a[8]=d[8]+_[8]*w,a},dt.exactEquals=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]&&a[6]===d[6]&&a[7]===d[7]&&a[8]===d[8]},dt.equals=function(a,d){var _=a[0],w=a[1],M=a[2],m=a[3],E=a[4],I=a[5],b=a[6],T=a[7],A=a[8],k=d[0],O=d[1],U=d[2],G=d[3],B=d[4],H=d[5],$=d[6],ne=d[7],me=d[8];return Math.abs(_-k)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(k))&&Math.abs(w-O)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(O))&&Math.abs(M-U)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(U))&&Math.abs(m-G)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(G))&&Math.abs(E-B)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(B))&&Math.abs(I-H)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(H))&&Math.abs(b-$)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs($))&&Math.abs(T-ne)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(ne))&&Math.abs(A-me)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(me))},dt.sub=dt.mul=void 0;var e=function(a,d){if(a&&a.__esModule)return a;if(a===null||r(a)!=="object"&&typeof a!="function")return{default:a};var _=i(void 0);if(_&&_.has(a))return _.get(a);var w={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in a)if(m!=="default"&&Object.prototype.hasOwnProperty.call(a,m)){var E=M?Object.getOwnPropertyDescriptor(a,m):null;E&&(E.get||E.set)?Object.defineProperty(w,m,E):w[m]=a[m]}return w.default=a,_&&_.set(a,w),w}(et());function i(a){if(typeof WeakMap!="function")return null;var d=new WeakMap,_=new WeakMap;return(i=function(w){return w?_:d})(a)}function o(a,d,_){var w=d[0],M=d[1],m=d[2],E=d[3],I=d[4],b=d[5],T=d[6],A=d[7],k=d[8],O=_[0],U=_[1],G=_[2],B=_[3],H=_[4],$=_[5],ne=_[6],me=_[7],de=_[8];return a[0]=O*w+U*E+G*T,a[1]=O*M+U*I+G*A,a[2]=O*m+U*b+G*k,a[3]=B*w+H*E+$*T,a[4]=B*M+H*I+$*A,a[5]=B*m+H*b+$*k,a[6]=ne*w+me*E+de*T,a[7]=ne*M+me*I+de*A,a[8]=ne*m+me*b+de*k,a}function h(a,d,_){return a[0]=d[0]-_[0],a[1]=d[1]-_[1],a[2]=d[2]-_[2],a[3]=d[3]-_[3],a[4]=d[4]-_[4],a[5]=d[5]-_[5],a[6]=d[6]-_[6],a[7]=d[7]-_[7],a[8]=d[8]-_[8],a}return dt.mul=o,dt.sub=h,dt}var Be,Ie={};function Ue(){if(Be)return Ie;function r(m){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},r(m)}Be=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.create=function(){var m=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=0,m[12]=0,m[13]=0,m[14]=0),m[0]=1,m[5]=1,m[10]=1,m[15]=1,m},Ie.clone=function(m){var E=new e.ARRAY_TYPE(16);return E[0]=m[0],E[1]=m[1],E[2]=m[2],E[3]=m[3],E[4]=m[4],E[5]=m[5],E[6]=m[6],E[7]=m[7],E[8]=m[8],E[9]=m[9],E[10]=m[10],E[11]=m[11],E[12]=m[12],E[13]=m[13],E[14]=m[14],E[15]=m[15],E},Ie.copy=function(m,E){return m[0]=E[0],m[1]=E[1],m[2]=E[2],m[3]=E[3],m[4]=E[4],m[5]=E[5],m[6]=E[6],m[7]=E[7],m[8]=E[8],m[9]=E[9],m[10]=E[10],m[11]=E[11],m[12]=E[12],m[13]=E[13],m[14]=E[14],m[15]=E[15],m},Ie.fromValues=function(m,E,I,b,T,A,k,O,U,G,B,H,$,ne,me,de){var ue=new e.ARRAY_TYPE(16);return ue[0]=m,ue[1]=E,ue[2]=I,ue[3]=b,ue[4]=T,ue[5]=A,ue[6]=k,ue[7]=O,ue[8]=U,ue[9]=G,ue[10]=B,ue[11]=H,ue[12]=$,ue[13]=ne,ue[14]=me,ue[15]=de,ue},Ie.set=function(m,E,I,b,T,A,k,O,U,G,B,H,$,ne,me,de,ue){return m[0]=E,m[1]=I,m[2]=b,m[3]=T,m[4]=A,m[5]=k,m[6]=O,m[7]=U,m[8]=G,m[9]=B,m[10]=H,m[11]=$,m[12]=ne,m[13]=me,m[14]=de,m[15]=ue,m},Ie.identity=o,Ie.transpose=function(m,E){if(m===E){var I=E[1],b=E[2],T=E[3],A=E[6],k=E[7],O=E[11];m[1]=E[4],m[2]=E[8],m[3]=E[12],m[4]=I,m[6]=E[9],m[7]=E[13],m[8]=b,m[9]=A,m[11]=E[14],m[12]=T,m[13]=k,m[14]=O}else m[0]=E[0],m[1]=E[4],m[2]=E[8],m[3]=E[12],m[4]=E[1],m[5]=E[5],m[6]=E[9],m[7]=E[13],m[8]=E[2],m[9]=E[6],m[10]=E[10],m[11]=E[14],m[12]=E[3],m[13]=E[7],m[14]=E[11],m[15]=E[15];return m},Ie.invert=function(m,E){var I=E[0],b=E[1],T=E[2],A=E[3],k=E[4],O=E[5],U=E[6],G=E[7],B=E[8],H=E[9],$=E[10],ne=E[11],me=E[12],de=E[13],ue=E[14],Fe=E[15],ye=I*O-b*k,Ve=I*U-T*k,$e=I*G-A*k,Ze=b*U-T*O,Qe=b*G-A*O,ht=T*G-A*U,wt=B*de-H*me,st=B*ue-$*me,Jt=B*Fe-ne*me,zi=H*ue-$*de,Kt=H*Fe-ne*de,wn=$*Fe-ne*ue,_n=ye*wn-Ve*Kt+$e*zi+Ze*Jt-Qe*st+ht*wt;return _n?(m[0]=(O*wn-U*Kt+G*zi)*(_n=1/_n),m[1]=(T*Kt-b*wn-A*zi)*_n,m[2]=(de*ht-ue*Qe+Fe*Ze)*_n,m[3]=($*Qe-H*ht-ne*Ze)*_n,m[4]=(U*Jt-k*wn-G*st)*_n,m[5]=(I*wn-T*Jt+A*st)*_n,m[6]=(ue*$e-me*ht-Fe*Ve)*_n,m[7]=(B*ht-$*$e+ne*Ve)*_n,m[8]=(k*Kt-O*Jt+G*wt)*_n,m[9]=(b*Jt-I*Kt-A*wt)*_n,m[10]=(me*Qe-de*$e+Fe*ye)*_n,m[11]=(H*$e-B*Qe-ne*ye)*_n,m[12]=(O*st-k*zi-U*wt)*_n,m[13]=(I*zi-b*st+T*wt)*_n,m[14]=(de*Ve-me*Ze-ue*ye)*_n,m[15]=(B*Ze-H*Ve+$*ye)*_n,m):null},Ie.adjoint=function(m,E){var I=E[0],b=E[1],T=E[2],A=E[3],k=E[4],O=E[5],U=E[6],G=E[7],B=E[8],H=E[9],$=E[10],ne=E[11],me=E[12],de=E[13],ue=E[14],Fe=E[15];return m[0]=O*($*Fe-ne*ue)-H*(U*Fe-G*ue)+de*(U*ne-G*$),m[1]=-(b*($*Fe-ne*ue)-H*(T*Fe-A*ue)+de*(T*ne-A*$)),m[2]=b*(U*Fe-G*ue)-O*(T*Fe-A*ue)+de*(T*G-A*U),m[3]=-(b*(U*ne-G*$)-O*(T*ne-A*$)+H*(T*G-A*U)),m[4]=-(k*($*Fe-ne*ue)-B*(U*Fe-G*ue)+me*(U*ne-G*$)),m[5]=I*($*Fe-ne*ue)-B*(T*Fe-A*ue)+me*(T*ne-A*$),m[6]=-(I*(U*Fe-G*ue)-k*(T*Fe-A*ue)+me*(T*G-A*U)),m[7]=I*(U*ne-G*$)-k*(T*ne-A*$)+B*(T*G-A*U),m[8]=k*(H*Fe-ne*de)-B*(O*Fe-G*de)+me*(O*ne-G*H),m[9]=-(I*(H*Fe-ne*de)-B*(b*Fe-A*de)+me*(b*ne-A*H)),m[10]=I*(O*Fe-G*de)-k*(b*Fe-A*de)+me*(b*G-A*O),m[11]=-(I*(O*ne-G*H)-k*(b*ne-A*H)+B*(b*G-A*O)),m[12]=-(k*(H*ue-$*de)-B*(O*ue-U*de)+me*(O*$-U*H)),m[13]=I*(H*ue-$*de)-B*(b*ue-T*de)+me*(b*$-T*H),m[14]=-(I*(O*ue-U*de)-k*(b*ue-T*de)+me*(b*U-T*O)),m[15]=I*(O*$-U*H)-k*(b*$-T*H)+B*(b*U-T*O),m},Ie.determinant=function(m){var E=m[0],I=m[1],b=m[2],T=m[3],A=m[4],k=m[5],O=m[6],U=m[7],G=m[8],B=m[9],H=m[10],$=m[11],ne=m[12],me=m[13],de=m[14],ue=m[15];return(E*k-I*A)*(H*ue-$*de)-(E*O-b*A)*(B*ue-$*me)+(E*U-T*A)*(B*de-H*me)+(I*O-b*k)*(G*ue-$*ne)-(I*U-T*k)*(G*de-H*ne)+(b*U-T*O)*(G*me-B*ne)},Ie.multiply=h,Ie.translate=function(m,E,I){var b,T,A,k,O,U,G,B,H,$,ne,me,de=I[0],ue=I[1],Fe=I[2];return E===m?(m[12]=E[0]*de+E[4]*ue+E[8]*Fe+E[12],m[13]=E[1]*de+E[5]*ue+E[9]*Fe+E[13],m[14]=E[2]*de+E[6]*ue+E[10]*Fe+E[14],m[15]=E[3]*de+E[7]*ue+E[11]*Fe+E[15]):(T=E[1],A=E[2],k=E[3],O=E[4],U=E[5],G=E[6],B=E[7],H=E[8],$=E[9],ne=E[10],me=E[11],m[0]=b=E[0],m[1]=T,m[2]=A,m[3]=k,m[4]=O,m[5]=U,m[6]=G,m[7]=B,m[8]=H,m[9]=$,m[10]=ne,m[11]=me,m[12]=b*de+O*ue+H*Fe+E[12],m[13]=T*de+U*ue+$*Fe+E[13],m[14]=A*de+G*ue+ne*Fe+E[14],m[15]=k*de+B*ue+me*Fe+E[15]),m},Ie.scale=function(m,E,I){var b=I[0],T=I[1],A=I[2];return m[0]=E[0]*b,m[1]=E[1]*b,m[2]=E[2]*b,m[3]=E[3]*b,m[4]=E[4]*T,m[5]=E[5]*T,m[6]=E[6]*T,m[7]=E[7]*T,m[8]=E[8]*A,m[9]=E[9]*A,m[10]=E[10]*A,m[11]=E[11]*A,m[12]=E[12],m[13]=E[13],m[14]=E[14],m[15]=E[15],m},Ie.rotate=function(m,E,I,b){var T,A,k,O,U,G,B,H,$,ne,me,de,ue,Fe,ye,Ve,$e,Ze,Qe,ht,wt,st,Jt,zi,Kt=b[0],wn=b[1],_n=b[2],Wi=Math.hypot(Kt,wn,_n);return Wi<e.EPSILON?null:(Kt*=Wi=1/Wi,wn*=Wi,_n*=Wi,T=Math.sin(I),A=Math.cos(I),U=E[1],G=E[2],B=E[3],$=E[5],ne=E[6],me=E[7],ue=E[9],Fe=E[10],ye=E[11],Ve=Kt*Kt*(k=1-A)+A,Qe=Kt*wn*k-_n*T,ht=wn*wn*k+A,wt=_n*wn*k+Kt*T,st=Kt*_n*k+wn*T,Jt=wn*_n*k-Kt*T,zi=_n*_n*k+A,m[0]=(O=E[0])*Ve+(H=E[4])*($e=wn*Kt*k+_n*T)+(de=E[8])*(Ze=_n*Kt*k-wn*T),m[1]=U*Ve+$*$e+ue*Ze,m[2]=G*Ve+ne*$e+Fe*Ze,m[3]=B*Ve+me*$e+ye*Ze,m[4]=O*Qe+H*ht+de*wt,m[5]=U*Qe+$*ht+ue*wt,m[6]=G*Qe+ne*ht+Fe*wt,m[7]=B*Qe+me*ht+ye*wt,m[8]=O*st+H*Jt+de*zi,m[9]=U*st+$*Jt+ue*zi,m[10]=G*st+ne*Jt+Fe*zi,m[11]=B*st+me*Jt+ye*zi,E!==m&&(m[12]=E[12],m[13]=E[13],m[14]=E[14],m[15]=E[15]),m)},Ie.rotateX=function(m,E,I){var b=Math.sin(I),T=Math.cos(I),A=E[4],k=E[5],O=E[6],U=E[7],G=E[8],B=E[9],H=E[10],$=E[11];return E!==m&&(m[0]=E[0],m[1]=E[1],m[2]=E[2],m[3]=E[3],m[12]=E[12],m[13]=E[13],m[14]=E[14],m[15]=E[15]),m[4]=A*T+G*b,m[5]=k*T+B*b,m[6]=O*T+H*b,m[7]=U*T+$*b,m[8]=G*T-A*b,m[9]=B*T-k*b,m[10]=H*T-O*b,m[11]=$*T-U*b,m},Ie.rotateY=function(m,E,I){var b=Math.sin(I),T=Math.cos(I),A=E[0],k=E[1],O=E[2],U=E[3],G=E[8],B=E[9],H=E[10],$=E[11];return E!==m&&(m[4]=E[4],m[5]=E[5],m[6]=E[6],m[7]=E[7],m[12]=E[12],m[13]=E[13],m[14]=E[14],m[15]=E[15]),m[0]=A*T-G*b,m[1]=k*T-B*b,m[2]=O*T-H*b,m[3]=U*T-$*b,m[8]=A*b+G*T,m[9]=k*b+B*T,m[10]=O*b+H*T,m[11]=U*b+$*T,m},Ie.rotateZ=function(m,E,I){var b=Math.sin(I),T=Math.cos(I),A=E[0],k=E[1],O=E[2],U=E[3],G=E[4],B=E[5],H=E[6],$=E[7];return E!==m&&(m[8]=E[8],m[9]=E[9],m[10]=E[10],m[11]=E[11],m[12]=E[12],m[13]=E[13],m[14]=E[14],m[15]=E[15]),m[0]=A*T+G*b,m[1]=k*T+B*b,m[2]=O*T+H*b,m[3]=U*T+$*b,m[4]=G*T-A*b,m[5]=B*T-k*b,m[6]=H*T-O*b,m[7]=$*T-U*b,m},Ie.fromTranslation=function(m,E){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=E[0],m[13]=E[1],m[14]=E[2],m[15]=1,m},Ie.fromScaling=function(m,E){return m[0]=E[0],m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=E[1],m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=E[2],m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},Ie.fromRotation=function(m,E,I){var b,T,A,k=I[0],O=I[1],U=I[2],G=Math.hypot(k,O,U);return G<e.EPSILON?null:(k*=G=1/G,O*=G,U*=G,b=Math.sin(E),T=Math.cos(E),m[0]=k*k*(A=1-T)+T,m[1]=O*k*A+U*b,m[2]=U*k*A-O*b,m[3]=0,m[4]=k*O*A-U*b,m[5]=O*O*A+T,m[6]=U*O*A+k*b,m[7]=0,m[8]=k*U*A+O*b,m[9]=O*U*A-k*b,m[10]=U*U*A+T,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m)},Ie.fromXRotation=function(m,E){var I=Math.sin(E),b=Math.cos(E);return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=b,m[6]=I,m[7]=0,m[8]=0,m[9]=-I,m[10]=b,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},Ie.fromYRotation=function(m,E){var I=Math.sin(E),b=Math.cos(E);return m[0]=b,m[1]=0,m[2]=-I,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=I,m[9]=0,m[10]=b,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},Ie.fromZRotation=function(m,E){var I=Math.sin(E),b=Math.cos(E);return m[0]=b,m[1]=I,m[2]=0,m[3]=0,m[4]=-I,m[5]=b,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},Ie.fromRotationTranslation=a,Ie.fromQuat2=function(m,E){var I=new e.ARRAY_TYPE(3),b=-E[0],T=-E[1],A=-E[2],k=E[3],O=E[4],U=E[5],G=E[6],B=E[7],H=b*b+T*T+A*A+k*k;return H>0?(I[0]=2*(O*k+B*b+U*A-G*T)/H,I[1]=2*(U*k+B*T+G*b-O*A)/H,I[2]=2*(G*k+B*A+O*T-U*b)/H):(I[0]=2*(O*k+B*b+U*A-G*T),I[1]=2*(U*k+B*T+G*b-O*A),I[2]=2*(G*k+B*A+O*T-U*b)),a(m,E,I),m},Ie.getTranslation=function(m,E){return m[0]=E[12],m[1]=E[13],m[2]=E[14],m},Ie.getScaling=d,Ie.getRotation=function(m,E){var I=new e.ARRAY_TYPE(3);d(I,E);var b=1/I[0],T=1/I[1],A=1/I[2],k=E[0]*b,O=E[1]*T,U=E[2]*A,G=E[4]*b,B=E[5]*T,H=E[6]*A,$=E[8]*b,ne=E[9]*T,me=E[10]*A,de=k+B+me,ue=0;return de>0?(ue=2*Math.sqrt(de+1),m[3]=.25*ue,m[0]=(H-ne)/ue,m[1]=($-U)/ue,m[2]=(O-G)/ue):k>B&&k>me?(ue=2*Math.sqrt(1+k-B-me),m[3]=(H-ne)/ue,m[0]=.25*ue,m[1]=(O+G)/ue,m[2]=($+U)/ue):B>me?(ue=2*Math.sqrt(1+B-k-me),m[3]=($-U)/ue,m[0]=(O+G)/ue,m[1]=.25*ue,m[2]=(H+ne)/ue):(ue=2*Math.sqrt(1+me-k-B),m[3]=(O-G)/ue,m[0]=($+U)/ue,m[1]=(H+ne)/ue,m[2]=.25*ue),m},Ie.fromRotationTranslationScale=function(m,E,I,b){var T=E[0],A=E[1],k=E[2],O=E[3],U=T+T,G=A+A,B=k+k,H=T*U,$=T*G,ne=T*B,me=A*G,de=A*B,ue=k*B,Fe=O*U,ye=O*G,Ve=O*B,$e=b[0],Ze=b[1],Qe=b[2];return m[0]=(1-(me+ue))*$e,m[1]=($+Ve)*$e,m[2]=(ne-ye)*$e,m[3]=0,m[4]=($-Ve)*Ze,m[5]=(1-(H+ue))*Ze,m[6]=(de+Fe)*Ze,m[7]=0,m[8]=(ne+ye)*Qe,m[9]=(de-Fe)*Qe,m[10]=(1-(H+me))*Qe,m[11]=0,m[12]=I[0],m[13]=I[1],m[14]=I[2],m[15]=1,m},Ie.fromRotationTranslationScaleOrigin=function(m,E,I,b,T){var A=E[0],k=E[1],O=E[2],U=E[3],G=A+A,B=k+k,H=O+O,$=A*G,ne=A*B,me=A*H,de=k*B,ue=k*H,Fe=O*H,ye=U*G,Ve=U*B,$e=U*H,Ze=b[0],Qe=b[1],ht=b[2],wt=T[0],st=T[1],Jt=T[2],zi=(1-(de+Fe))*Ze,Kt=(ne+$e)*Ze,wn=(me-Ve)*Ze,_n=(ne-$e)*Qe,Wi=(1-($+Fe))*Qe,Fi=(ue+ye)*Qe,qn=(me+Ve)*ht,En=(ue-ye)*ht,kn=(1-($+de))*ht;return m[0]=zi,m[1]=Kt,m[2]=wn,m[3]=0,m[4]=_n,m[5]=Wi,m[6]=Fi,m[7]=0,m[8]=qn,m[9]=En,m[10]=kn,m[11]=0,m[12]=I[0]+wt-(zi*wt+_n*st+qn*Jt),m[13]=I[1]+st-(Kt*wt+Wi*st+En*Jt),m[14]=I[2]+Jt-(wn*wt+Fi*st+kn*Jt),m[15]=1,m},Ie.fromQuat=function(m,E){var I=E[0],b=E[1],T=E[2],A=E[3],k=I+I,O=b+b,U=T+T,G=I*k,B=b*k,H=b*O,$=T*k,ne=T*O,me=T*U,de=A*k,ue=A*O,Fe=A*U;return m[0]=1-H-me,m[1]=B+Fe,m[2]=$-ue,m[3]=0,m[4]=B-Fe,m[5]=1-G-me,m[6]=ne+de,m[7]=0,m[8]=$+ue,m[9]=ne-de,m[10]=1-G-H,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},Ie.frustum=function(m,E,I,b,T,A,k){var O=1/(I-E),U=1/(T-b),G=1/(A-k);return m[0]=2*A*O,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=2*A*U,m[6]=0,m[7]=0,m[8]=(I+E)*O,m[9]=(T+b)*U,m[10]=(k+A)*G,m[11]=-1,m[12]=0,m[13]=0,m[14]=k*A*2*G,m[15]=0,m},Ie.perspectiveNO=_,Ie.perspectiveZO=function(m,E,I,b,T){var A,k=1/Math.tan(E/2);return m[0]=k/I,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=k,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,T!=null&&T!==1/0?(m[10]=T*(A=1/(b-T)),m[14]=T*b*A):(m[10]=-1,m[14]=-b),m},Ie.perspectiveFromFieldOfView=function(m,E,I,b){var T=Math.tan(E.upDegrees*Math.PI/180),A=Math.tan(E.downDegrees*Math.PI/180),k=Math.tan(E.leftDegrees*Math.PI/180),O=Math.tan(E.rightDegrees*Math.PI/180),U=2/(k+O),G=2/(T+A);return m[0]=U,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=G,m[6]=0,m[7]=0,m[8]=-(k-O)*U*.5,m[9]=(T-A)*G*.5,m[10]=b/(I-b),m[11]=-1,m[12]=0,m[13]=0,m[14]=b*I/(I-b),m[15]=0,m},Ie.orthoNO=w,Ie.orthoZO=function(m,E,I,b,T,A,k){var O=1/(E-I),U=1/(b-T),G=1/(A-k);return m[0]=-2*O,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=-2*U,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=G,m[11]=0,m[12]=(E+I)*O,m[13]=(T+b)*U,m[14]=A*G,m[15]=1,m},Ie.lookAt=function(m,E,I,b){var T,A,k,O,U,G,B,H,$,ne,me=E[0],de=E[1],ue=E[2],Fe=b[0],ye=b[1],Ve=b[2],$e=I[0],Ze=I[1],Qe=I[2];return Math.abs(me-$e)<e.EPSILON&&Math.abs(de-Ze)<e.EPSILON&&Math.abs(ue-Qe)<e.EPSILON?o(m):(B=me-$e,H=de-Ze,$=ue-Qe,T=ye*($*=ne=1/Math.hypot(B,H,$))-Ve*(H*=ne),A=Ve*(B*=ne)-Fe*$,k=Fe*H-ye*B,(ne=Math.hypot(T,A,k))?(T*=ne=1/ne,A*=ne,k*=ne):(T=0,A=0,k=0),O=H*k-$*A,U=$*T-B*k,G=B*A-H*T,(ne=Math.hypot(O,U,G))?(O*=ne=1/ne,U*=ne,G*=ne):(O=0,U=0,G=0),m[0]=T,m[1]=O,m[2]=B,m[3]=0,m[4]=A,m[5]=U,m[6]=H,m[7]=0,m[8]=k,m[9]=G,m[10]=$,m[11]=0,m[12]=-(T*me+A*de+k*ue),m[13]=-(O*me+U*de+G*ue),m[14]=-(B*me+H*de+$*ue),m[15]=1,m)},Ie.targetTo=function(m,E,I,b){var T=E[0],A=E[1],k=E[2],O=b[0],U=b[1],G=b[2],B=T-I[0],H=A-I[1],$=k-I[2],ne=B*B+H*H+$*$;ne>0&&(B*=ne=1/Math.sqrt(ne),H*=ne,$*=ne);var me=U*$-G*H,de=G*B-O*$,ue=O*H-U*B;return(ne=me*me+de*de+ue*ue)>0&&(me*=ne=1/Math.sqrt(ne),de*=ne,ue*=ne),m[0]=me,m[1]=de,m[2]=ue,m[3]=0,m[4]=H*ue-$*de,m[5]=$*me-B*ue,m[6]=B*de-H*me,m[7]=0,m[8]=B,m[9]=H,m[10]=$,m[11]=0,m[12]=T,m[13]=A,m[14]=k,m[15]=1,m},Ie.str=function(m){return"mat4("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+", "+m[4]+", "+m[5]+", "+m[6]+", "+m[7]+", "+m[8]+", "+m[9]+", "+m[10]+", "+m[11]+", "+m[12]+", "+m[13]+", "+m[14]+", "+m[15]+")"},Ie.frob=function(m){return Math.hypot(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15])},Ie.add=function(m,E,I){return m[0]=E[0]+I[0],m[1]=E[1]+I[1],m[2]=E[2]+I[2],m[3]=E[3]+I[3],m[4]=E[4]+I[4],m[5]=E[5]+I[5],m[6]=E[6]+I[6],m[7]=E[7]+I[7],m[8]=E[8]+I[8],m[9]=E[9]+I[9],m[10]=E[10]+I[10],m[11]=E[11]+I[11],m[12]=E[12]+I[12],m[13]=E[13]+I[13],m[14]=E[14]+I[14],m[15]=E[15]+I[15],m},Ie.subtract=M,Ie.multiplyScalar=function(m,E,I){return m[0]=E[0]*I,m[1]=E[1]*I,m[2]=E[2]*I,m[3]=E[3]*I,m[4]=E[4]*I,m[5]=E[5]*I,m[6]=E[6]*I,m[7]=E[7]*I,m[8]=E[8]*I,m[9]=E[9]*I,m[10]=E[10]*I,m[11]=E[11]*I,m[12]=E[12]*I,m[13]=E[13]*I,m[14]=E[14]*I,m[15]=E[15]*I,m},Ie.multiplyScalarAndAdd=function(m,E,I,b){return m[0]=E[0]+I[0]*b,m[1]=E[1]+I[1]*b,m[2]=E[2]+I[2]*b,m[3]=E[3]+I[3]*b,m[4]=E[4]+I[4]*b,m[5]=E[5]+I[5]*b,m[6]=E[6]+I[6]*b,m[7]=E[7]+I[7]*b,m[8]=E[8]+I[8]*b,m[9]=E[9]+I[9]*b,m[10]=E[10]+I[10]*b,m[11]=E[11]+I[11]*b,m[12]=E[12]+I[12]*b,m[13]=E[13]+I[13]*b,m[14]=E[14]+I[14]*b,m[15]=E[15]+I[15]*b,m},Ie.exactEquals=function(m,E){return m[0]===E[0]&&m[1]===E[1]&&m[2]===E[2]&&m[3]===E[3]&&m[4]===E[4]&&m[5]===E[5]&&m[6]===E[6]&&m[7]===E[7]&&m[8]===E[8]&&m[9]===E[9]&&m[10]===E[10]&&m[11]===E[11]&&m[12]===E[12]&&m[13]===E[13]&&m[14]===E[14]&&m[15]===E[15]},Ie.equals=function(m,E){var I=m[0],b=m[1],T=m[2],A=m[3],k=m[4],O=m[5],U=m[6],G=m[7],B=m[8],H=m[9],$=m[10],ne=m[11],me=m[12],de=m[13],ue=m[14],Fe=m[15],ye=E[0],Ve=E[1],$e=E[2],Ze=E[3],Qe=E[4],ht=E[5],wt=E[6],st=E[7],Jt=E[8],zi=E[9],Kt=E[10],wn=E[11],_n=E[12],Wi=E[13],Fi=E[14],qn=E[15];return Math.abs(I-ye)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(ye))&&Math.abs(b-Ve)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(Ve))&&Math.abs(T-$e)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs($e))&&Math.abs(A-Ze)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ze))&&Math.abs(k-Qe)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(Qe))&&Math.abs(O-ht)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(ht))&&Math.abs(U-wt)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(wt))&&Math.abs(G-st)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(st))&&Math.abs(B-Jt)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Jt))&&Math.abs(H-zi)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(zi))&&Math.abs($-Kt)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Kt))&&Math.abs(ne-wn)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(wn))&&Math.abs(me-_n)<=e.EPSILON*Math.max(1,Math.abs(me),Math.abs(_n))&&Math.abs(de-Wi)<=e.EPSILON*Math.max(1,Math.abs(de),Math.abs(Wi))&&Math.abs(ue-Fi)<=e.EPSILON*Math.max(1,Math.abs(ue),Math.abs(Fi))&&Math.abs(Fe-qn)<=e.EPSILON*Math.max(1,Math.abs(Fe),Math.abs(qn))},Ie.sub=Ie.mul=Ie.ortho=Ie.perspective=void 0;var e=function(m,E){if(m&&m.__esModule)return m;if(m===null||r(m)!=="object"&&typeof m!="function")return{default:m};var I=i(void 0);if(I&&I.has(m))return I.get(m);var b={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var A in m)if(A!=="default"&&Object.prototype.hasOwnProperty.call(m,A)){var k=T?Object.getOwnPropertyDescriptor(m,A):null;k&&(k.get||k.set)?Object.defineProperty(b,A,k):b[A]=m[A]}return b.default=m,I&&I.set(m,b),b}(et());function i(m){if(typeof WeakMap!="function")return null;var E=new WeakMap,I=new WeakMap;return(i=function(b){return b?I:E})(m)}function o(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function h(m,E,I){var b=E[0],T=E[1],A=E[2],k=E[3],O=E[4],U=E[5],G=E[6],B=E[7],H=E[8],$=E[9],ne=E[10],me=E[11],de=E[12],ue=E[13],Fe=E[14],ye=E[15],Ve=I[0],$e=I[1],Ze=I[2],Qe=I[3];return m[0]=Ve*b+$e*O+Ze*H+Qe*de,m[1]=Ve*T+$e*U+Ze*$+Qe*ue,m[2]=Ve*A+$e*G+Ze*ne+Qe*Fe,m[3]=Ve*k+$e*B+Ze*me+Qe*ye,m[4]=(Ve=I[4])*b+($e=I[5])*O+(Ze=I[6])*H+(Qe=I[7])*de,m[5]=Ve*T+$e*U+Ze*$+Qe*ue,m[6]=Ve*A+$e*G+Ze*ne+Qe*Fe,m[7]=Ve*k+$e*B+Ze*me+Qe*ye,m[8]=(Ve=I[8])*b+($e=I[9])*O+(Ze=I[10])*H+(Qe=I[11])*de,m[9]=Ve*T+$e*U+Ze*$+Qe*ue,m[10]=Ve*A+$e*G+Ze*ne+Qe*Fe,m[11]=Ve*k+$e*B+Ze*me+Qe*ye,m[12]=(Ve=I[12])*b+($e=I[13])*O+(Ze=I[14])*H+(Qe=I[15])*de,m[13]=Ve*T+$e*U+Ze*$+Qe*ue,m[14]=Ve*A+$e*G+Ze*ne+Qe*Fe,m[15]=Ve*k+$e*B+Ze*me+Qe*ye,m}function a(m,E,I){var b=E[0],T=E[1],A=E[2],k=E[3],O=b+b,U=T+T,G=A+A,B=b*O,H=b*U,$=b*G,ne=T*U,me=T*G,de=A*G,ue=k*O,Fe=k*U,ye=k*G;return m[0]=1-(ne+de),m[1]=H+ye,m[2]=$-Fe,m[3]=0,m[4]=H-ye,m[5]=1-(B+de),m[6]=me+ue,m[7]=0,m[8]=$+Fe,m[9]=me-ue,m[10]=1-(B+ne),m[11]=0,m[12]=I[0],m[13]=I[1],m[14]=I[2],m[15]=1,m}function d(m,E){var I=E[4],b=E[5],T=E[6],A=E[8],k=E[9],O=E[10];return m[0]=Math.hypot(E[0],E[1],E[2]),m[1]=Math.hypot(I,b,T),m[2]=Math.hypot(A,k,O),m}function _(m,E,I,b,T){var A,k=1/Math.tan(E/2);return m[0]=k/I,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=k,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,T!=null&&T!==1/0?(m[10]=(T+b)*(A=1/(b-T)),m[14]=2*T*b*A):(m[10]=-1,m[14]=-2*b),m}function w(m,E,I,b,T,A,k){var O=1/(E-I),U=1/(b-T),G=1/(A-k);return m[0]=-2*O,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=-2*U,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=2*G,m[11]=0,m[12]=(E+I)*O,m[13]=(T+b)*U,m[14]=(k+A)*G,m[15]=1,m}function M(m,E,I){return m[0]=E[0]-I[0],m[1]=E[1]-I[1],m[2]=E[2]-I[2],m[3]=E[3]-I[3],m[4]=E[4]-I[4],m[5]=E[5]-I[5],m[6]=E[6]-I[6],m[7]=E[7]-I[7],m[8]=E[8]-I[8],m[9]=E[9]-I[9],m[10]=E[10]-I[10],m[11]=E[11]-I[11],m[12]=E[12]-I[12],m[13]=E[13]-I[13],m[14]=E[14]-I[14],m[15]=E[15]-I[15],m}return Ie.perspective=_,Ie.ortho=w,Ie.mul=h,Ie.sub=M,Ie}var qe,De={},je={};function Pt(){if(qe)return je;function r(T){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},r(T)}qe=1,Object.defineProperty(je,"__esModule",{value:!0}),je.create=o,je.clone=function(T){var A=new e.ARRAY_TYPE(3);return A[0]=T[0],A[1]=T[1],A[2]=T[2],A},je.length=h,je.fromValues=function(T,A,k){var O=new e.ARRAY_TYPE(3);return O[0]=T,O[1]=A,O[2]=k,O},je.copy=function(T,A){return T[0]=A[0],T[1]=A[1],T[2]=A[2],T},je.set=function(T,A,k,O){return T[0]=A,T[1]=k,T[2]=O,T},je.add=function(T,A,k){return T[0]=A[0]+k[0],T[1]=A[1]+k[1],T[2]=A[2]+k[2],T},je.subtract=a,je.multiply=d,je.divide=_,je.ceil=function(T,A){return T[0]=Math.ceil(A[0]),T[1]=Math.ceil(A[1]),T[2]=Math.ceil(A[2]),T},je.floor=function(T,A){return T[0]=Math.floor(A[0]),T[1]=Math.floor(A[1]),T[2]=Math.floor(A[2]),T},je.min=function(T,A,k){return T[0]=Math.min(A[0],k[0]),T[1]=Math.min(A[1],k[1]),T[2]=Math.min(A[2],k[2]),T},je.max=function(T,A,k){return T[0]=Math.max(A[0],k[0]),T[1]=Math.max(A[1],k[1]),T[2]=Math.max(A[2],k[2]),T},je.round=function(T,A){return T[0]=Math.round(A[0]),T[1]=Math.round(A[1]),T[2]=Math.round(A[2]),T},je.scale=function(T,A,k){return T[0]=A[0]*k,T[1]=A[1]*k,T[2]=A[2]*k,T},je.scaleAndAdd=function(T,A,k,O){return T[0]=A[0]+k[0]*O,T[1]=A[1]+k[1]*O,T[2]=A[2]+k[2]*O,T},je.distance=w,je.squaredDistance=M,je.squaredLength=m,je.negate=function(T,A){return T[0]=-A[0],T[1]=-A[1],T[2]=-A[2],T},je.inverse=function(T,A){return T[0]=1/A[0],T[1]=1/A[1],T[2]=1/A[2],T},je.normalize=function(T,A){var k=A[0],O=A[1],U=A[2],G=k*k+O*O+U*U;return G>0&&(G=1/Math.sqrt(G)),T[0]=A[0]*G,T[1]=A[1]*G,T[2]=A[2]*G,T},je.dot=E,je.cross=function(T,A,k){var O=A[0],U=A[1],G=A[2],B=k[0],H=k[1],$=k[2];return T[0]=U*$-G*H,T[1]=G*B-O*$,T[2]=O*H-U*B,T},je.lerp=function(T,A,k,O){var U=A[0],G=A[1],B=A[2];return T[0]=U+O*(k[0]-U),T[1]=G+O*(k[1]-G),T[2]=B+O*(k[2]-B),T},je.hermite=function(T,A,k,O,U,G){var B=G*G,H=B*(2*G-3)+1,$=B*(G-2)+G,ne=B*(G-1),me=B*(3-2*G);return T[0]=A[0]*H+k[0]*$+O[0]*ne+U[0]*me,T[1]=A[1]*H+k[1]*$+O[1]*ne+U[1]*me,T[2]=A[2]*H+k[2]*$+O[2]*ne+U[2]*me,T},je.bezier=function(T,A,k,O,U,G){var B=1-G,H=B*B,$=G*G,ne=H*B,me=3*G*H,de=3*$*B,ue=$*G;return T[0]=A[0]*ne+k[0]*me+O[0]*de+U[0]*ue,T[1]=A[1]*ne+k[1]*me+O[1]*de+U[1]*ue,T[2]=A[2]*ne+k[2]*me+O[2]*de+U[2]*ue,T},je.random=function(T,A){A=A||1;var k=2*e.RANDOM()*Math.PI,O=2*e.RANDOM()-1,U=Math.sqrt(1-O*O)*A;return T[0]=Math.cos(k)*U,T[1]=Math.sin(k)*U,T[2]=O*A,T},je.transformMat4=function(T,A,k){var O=A[0],U=A[1],G=A[2],B=k[3]*O+k[7]*U+k[11]*G+k[15];return T[0]=(k[0]*O+k[4]*U+k[8]*G+k[12])/(B=B||1),T[1]=(k[1]*O+k[5]*U+k[9]*G+k[13])/B,T[2]=(k[2]*O+k[6]*U+k[10]*G+k[14])/B,T},je.transformMat3=function(T,A,k){var O=A[0],U=A[1],G=A[2];return T[0]=O*k[0]+U*k[3]+G*k[6],T[1]=O*k[1]+U*k[4]+G*k[7],T[2]=O*k[2]+U*k[5]+G*k[8],T},je.transformQuat=function(T,A,k){var O=k[0],U=k[1],G=k[2],B=A[0],H=A[1],$=A[2],ne=U*$-G*H,me=G*B-O*$,de=O*H-U*B,ue=U*de-G*me,Fe=G*ne-O*de,ye=O*me-U*ne,Ve=2*k[3];return me*=Ve,de*=Ve,Fe*=2,ye*=2,T[0]=B+(ne*=Ve)+(ue*=2),T[1]=H+me+Fe,T[2]=$+de+ye,T},je.rotateX=function(T,A,k,O){var U=[],G=[];return U[0]=A[0]-k[0],U[1]=A[1]-k[1],U[2]=A[2]-k[2],G[0]=U[0],G[1]=U[1]*Math.cos(O)-U[2]*Math.sin(O),G[2]=U[1]*Math.sin(O)+U[2]*Math.cos(O),T[0]=G[0]+k[0],T[1]=G[1]+k[1],T[2]=G[2]+k[2],T},je.rotateY=function(T,A,k,O){var U=[],G=[];return U[0]=A[0]-k[0],U[1]=A[1]-k[1],U[2]=A[2]-k[2],G[0]=U[2]*Math.sin(O)+U[0]*Math.cos(O),G[1]=U[1],G[2]=U[2]*Math.cos(O)-U[0]*Math.sin(O),T[0]=G[0]+k[0],T[1]=G[1]+k[1],T[2]=G[2]+k[2],T},je.rotateZ=function(T,A,k,O){var U=[],G=[];return U[0]=A[0]-k[0],U[1]=A[1]-k[1],U[2]=A[2]-k[2],G[0]=U[0]*Math.cos(O)-U[1]*Math.sin(O),G[1]=U[0]*Math.sin(O)+U[1]*Math.cos(O),G[2]=U[2],T[0]=G[0]+k[0],T[1]=G[1]+k[1],T[2]=G[2]+k[2],T},je.angle=function(T,A){var k=T[0],O=T[1],U=T[2],G=A[0],B=A[1],H=A[2],$=Math.sqrt(k*k+O*O+U*U)*Math.sqrt(G*G+B*B+H*H),ne=$&&E(T,A)/$;return Math.acos(Math.min(Math.max(ne,-1),1))},je.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T},je.str=function(T){return"vec3("+T[0]+", "+T[1]+", "+T[2]+")"},je.exactEquals=function(T,A){return T[0]===A[0]&&T[1]===A[1]&&T[2]===A[2]},je.equals=function(T,A){var k=T[0],O=T[1],U=T[2],G=A[0],B=A[1],H=A[2];return Math.abs(k-G)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(G))&&Math.abs(O-B)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(B))&&Math.abs(U-H)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(H))},je.forEach=je.sqrLen=je.len=je.sqrDist=je.dist=je.div=je.mul=je.sub=void 0;var e=function(T,A){if(T&&T.__esModule)return T;if(T===null||r(T)!=="object"&&typeof T!="function")return{default:T};var k=i(void 0);if(k&&k.has(T))return k.get(T);var O={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in T)if(G!=="default"&&Object.prototype.hasOwnProperty.call(T,G)){var B=U?Object.getOwnPropertyDescriptor(T,G):null;B&&(B.get||B.set)?Object.defineProperty(O,G,B):O[G]=T[G]}return O.default=T,k&&k.set(T,O),O}(et());function i(T){if(typeof WeakMap!="function")return null;var A=new WeakMap,k=new WeakMap;return(i=function(O){return O?k:A})(T)}function o(){var T=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0),T}function h(T){return Math.hypot(T[0],T[1],T[2])}function a(T,A,k){return T[0]=A[0]-k[0],T[1]=A[1]-k[1],T[2]=A[2]-k[2],T}function d(T,A,k){return T[0]=A[0]*k[0],T[1]=A[1]*k[1],T[2]=A[2]*k[2],T}function _(T,A,k){return T[0]=A[0]/k[0],T[1]=A[1]/k[1],T[2]=A[2]/k[2],T}function w(T,A){return Math.hypot(A[0]-T[0],A[1]-T[1],A[2]-T[2])}function M(T,A){var k=A[0]-T[0],O=A[1]-T[1],U=A[2]-T[2];return k*k+O*O+U*U}function m(T){var A=T[0],k=T[1],O=T[2];return A*A+k*k+O*O}function E(T,A){return T[0]*A[0]+T[1]*A[1]+T[2]*A[2]}je.sub=a,je.mul=d,je.div=_,je.dist=w,je.sqrDist=M,je.len=h,je.sqrLen=m;var I,b=(I=o(),function(T,A,k,O,U,G){var B,H;for(A||(A=3),k||(k=0),H=O?Math.min(O*A+k,T.length):T.length,B=k;B<H;B+=A)I[0]=T[B],I[1]=T[B+1],I[2]=T[B+2],U(I,I,G),T[B]=I[0],T[B+1]=I[1],T[B+2]=I[2];return T});return je.forEach=b,je}var ki,bi,ji={};function hr(){if(ki)return ji;function r(b){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},r(b)}ki=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.create=o,ji.clone=function(b){var T=new e.ARRAY_TYPE(4);return T[0]=b[0],T[1]=b[1],T[2]=b[2],T[3]=b[3],T},ji.fromValues=function(b,T,A,k){var O=new e.ARRAY_TYPE(4);return O[0]=b,O[1]=T,O[2]=A,O[3]=k,O},ji.copy=function(b,T){return b[0]=T[0],b[1]=T[1],b[2]=T[2],b[3]=T[3],b},ji.set=function(b,T,A,k,O){return b[0]=T,b[1]=A,b[2]=k,b[3]=O,b},ji.add=function(b,T,A){return b[0]=T[0]+A[0],b[1]=T[1]+A[1],b[2]=T[2]+A[2],b[3]=T[3]+A[3],b},ji.subtract=h,ji.multiply=a,ji.divide=d,ji.ceil=function(b,T){return b[0]=Math.ceil(T[0]),b[1]=Math.ceil(T[1]),b[2]=Math.ceil(T[2]),b[3]=Math.ceil(T[3]),b},ji.floor=function(b,T){return b[0]=Math.floor(T[0]),b[1]=Math.floor(T[1]),b[2]=Math.floor(T[2]),b[3]=Math.floor(T[3]),b},ji.min=function(b,T,A){return b[0]=Math.min(T[0],A[0]),b[1]=Math.min(T[1],A[1]),b[2]=Math.min(T[2],A[2]),b[3]=Math.min(T[3],A[3]),b},ji.max=function(b,T,A){return b[0]=Math.max(T[0],A[0]),b[1]=Math.max(T[1],A[1]),b[2]=Math.max(T[2],A[2]),b[3]=Math.max(T[3],A[3]),b},ji.round=function(b,T){return b[0]=Math.round(T[0]),b[1]=Math.round(T[1]),b[2]=Math.round(T[2]),b[3]=Math.round(T[3]),b},ji.scale=function(b,T,A){return b[0]=T[0]*A,b[1]=T[1]*A,b[2]=T[2]*A,b[3]=T[3]*A,b},ji.scaleAndAdd=function(b,T,A,k){return b[0]=T[0]+A[0]*k,b[1]=T[1]+A[1]*k,b[2]=T[2]+A[2]*k,b[3]=T[3]+A[3]*k,b},ji.distance=_,ji.squaredDistance=w,ji.length=M,ji.squaredLength=m,ji.negate=function(b,T){return b[0]=-T[0],b[1]=-T[1],b[2]=-T[2],b[3]=-T[3],b},ji.inverse=function(b,T){return b[0]=1/T[0],b[1]=1/T[1],b[2]=1/T[2],b[3]=1/T[3],b},ji.normalize=function(b,T){var A=T[0],k=T[1],O=T[2],U=T[3],G=A*A+k*k+O*O+U*U;return G>0&&(G=1/Math.sqrt(G)),b[0]=A*G,b[1]=k*G,b[2]=O*G,b[3]=U*G,b},ji.dot=function(b,T){return b[0]*T[0]+b[1]*T[1]+b[2]*T[2]+b[3]*T[3]},ji.cross=function(b,T,A,k){var O=A[0]*k[1]-A[1]*k[0],U=A[0]*k[2]-A[2]*k[0],G=A[0]*k[3]-A[3]*k[0],B=A[1]*k[2]-A[2]*k[1],H=A[1]*k[3]-A[3]*k[1],$=A[2]*k[3]-A[3]*k[2],ne=T[0],me=T[1],de=T[2],ue=T[3];return b[0]=me*$-de*H+ue*B,b[1]=-ne*$+de*G-ue*U,b[2]=ne*H-me*G+ue*O,b[3]=-ne*B+me*U-de*O,b},ji.lerp=function(b,T,A,k){var O=T[0],U=T[1],G=T[2],B=T[3];return b[0]=O+k*(A[0]-O),b[1]=U+k*(A[1]-U),b[2]=G+k*(A[2]-G),b[3]=B+k*(A[3]-B),b},ji.random=function(b,T){var A,k,O,U,G,B;T=T||1;do G=(A=2*e.RANDOM()-1)*A+(k=2*e.RANDOM()-1)*k;while(G>=1);do B=(O=2*e.RANDOM()-1)*O+(U=2*e.RANDOM()-1)*U;while(B>=1);var H=Math.sqrt((1-G)/B);return b[0]=T*A,b[1]=T*k,b[2]=T*O*H,b[3]=T*U*H,b},ji.transformMat4=function(b,T,A){var k=T[0],O=T[1],U=T[2],G=T[3];return b[0]=A[0]*k+A[4]*O+A[8]*U+A[12]*G,b[1]=A[1]*k+A[5]*O+A[9]*U+A[13]*G,b[2]=A[2]*k+A[6]*O+A[10]*U+A[14]*G,b[3]=A[3]*k+A[7]*O+A[11]*U+A[15]*G,b},ji.transformQuat=function(b,T,A){var k=T[0],O=T[1],U=T[2],G=A[0],B=A[1],H=A[2],$=A[3],ne=$*k+B*U-H*O,me=$*O+H*k-G*U,de=$*U+G*O-B*k,ue=-G*k-B*O-H*U;return b[0]=ne*$+ue*-G+me*-H-de*-B,b[1]=me*$+ue*-B+de*-G-ne*-H,b[2]=de*$+ue*-H+ne*-B-me*-G,b[3]=T[3],b},ji.zero=function(b){return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b},ji.str=function(b){return"vec4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"},ji.exactEquals=function(b,T){return b[0]===T[0]&&b[1]===T[1]&&b[2]===T[2]&&b[3]===T[3]},ji.equals=function(b,T){var A=b[0],k=b[1],O=b[2],U=b[3],G=T[0],B=T[1],H=T[2],$=T[3];return Math.abs(A-G)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(G))&&Math.abs(k-B)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(B))&&Math.abs(O-H)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(H))&&Math.abs(U-$)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs($))},ji.forEach=ji.sqrLen=ji.len=ji.sqrDist=ji.dist=ji.div=ji.mul=ji.sub=void 0;var e=function(b,T){if(b&&b.__esModule)return b;if(b===null||r(b)!=="object"&&typeof b!="function")return{default:b};var A=i(void 0);if(A&&A.has(b))return A.get(b);var k={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in b)if(U!=="default"&&Object.prototype.hasOwnProperty.call(b,U)){var G=O?Object.getOwnPropertyDescriptor(b,U):null;G&&(G.get||G.set)?Object.defineProperty(k,U,G):k[U]=b[U]}return k.default=b,A&&A.set(b,k),k}(et());function i(b){if(typeof WeakMap!="function")return null;var T=new WeakMap,A=new WeakMap;return(i=function(k){return k?A:T})(b)}function o(){var b=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0,b[3]=0),b}function h(b,T,A){return b[0]=T[0]-A[0],b[1]=T[1]-A[1],b[2]=T[2]-A[2],b[3]=T[3]-A[3],b}function a(b,T,A){return b[0]=T[0]*A[0],b[1]=T[1]*A[1],b[2]=T[2]*A[2],b[3]=T[3]*A[3],b}function d(b,T,A){return b[0]=T[0]/A[0],b[1]=T[1]/A[1],b[2]=T[2]/A[2],b[3]=T[3]/A[3],b}function _(b,T){return Math.hypot(T[0]-b[0],T[1]-b[1],T[2]-b[2],T[3]-b[3])}function w(b,T){var A=T[0]-b[0],k=T[1]-b[1],O=T[2]-b[2],U=T[3]-b[3];return A*A+k*k+O*O+U*U}function M(b){return Math.hypot(b[0],b[1],b[2],b[3])}function m(b){var T=b[0],A=b[1],k=b[2],O=b[3];return T*T+A*A+k*k+O*O}ji.sub=h,ji.mul=a,ji.div=d,ji.dist=_,ji.sqrDist=w,ji.len=M,ji.sqrLen=m;var E,I=(E=o(),function(b,T,A,k,O,U){var G,B;for(T||(T=4),A||(A=0),B=k?Math.min(k*T+A,b.length):b.length,G=A;G<B;G+=T)E[0]=b[G],E[1]=b[G+1],E[2]=b[G+2],E[3]=b[G+3],O(E,E,U),b[G]=E[0],b[G+1]=E[1],b[G+2]=E[2],b[G+3]=E[3];return b});return ji.forEach=I,ji}function Xn(){if(bi)return De;function r(ye){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ve){return typeof Ve}:function(Ve){return Ve&&typeof Symbol=="function"&&Ve.constructor===Symbol&&Ve!==Symbol.prototype?"symbol":typeof Ve},r(ye)}bi=1,Object.defineProperty(De,"__esModule",{value:!0}),De.create=_,De.identity=function(ye){return ye[0]=0,ye[1]=0,ye[2]=0,ye[3]=1,ye},De.setAxisAngle=w,De.getAxisAngle=function(ye,Ve){var $e=2*Math.acos(Ve[3]),Ze=Math.sin($e/2);return Ze>e.EPSILON?(ye[0]=Ve[0]/Ze,ye[1]=Ve[1]/Ze,ye[2]=Ve[2]/Ze):(ye[0]=1,ye[1]=0,ye[2]=0),$e},De.getAngle=function(ye,Ve){var $e=A(ye,Ve);return Math.acos(2*$e*$e-1)},De.multiply=M,De.rotateX=function(ye,Ve,$e){$e*=.5;var Ze=Ve[0],Qe=Ve[1],ht=Ve[2],wt=Ve[3],st=Math.sin($e),Jt=Math.cos($e);return ye[0]=Ze*Jt+wt*st,ye[1]=Qe*Jt+ht*st,ye[2]=ht*Jt-Qe*st,ye[3]=wt*Jt-Ze*st,ye},De.rotateY=function(ye,Ve,$e){$e*=.5;var Ze=Ve[0],Qe=Ve[1],ht=Ve[2],wt=Ve[3],st=Math.sin($e),Jt=Math.cos($e);return ye[0]=Ze*Jt-ht*st,ye[1]=Qe*Jt+wt*st,ye[2]=ht*Jt+Ze*st,ye[3]=wt*Jt-Qe*st,ye},De.rotateZ=function(ye,Ve,$e){$e*=.5;var Ze=Ve[0],Qe=Ve[1],ht=Ve[2],wt=Ve[3],st=Math.sin($e),Jt=Math.cos($e);return ye[0]=Ze*Jt+Qe*st,ye[1]=Qe*Jt-Ze*st,ye[2]=ht*Jt+wt*st,ye[3]=wt*Jt-ht*st,ye},De.calculateW=function(ye,Ve){var $e=Ve[0],Ze=Ve[1],Qe=Ve[2];return ye[0]=$e,ye[1]=Ze,ye[2]=Qe,ye[3]=Math.sqrt(Math.abs(1-$e*$e-Ze*Ze-Qe*Qe)),ye},De.exp=m,De.ln=E,De.pow=function(ye,Ve,$e){return E(ye,Ve),T(ye,ye,$e),m(ye,ye),ye},De.slerp=I,De.random=function(ye){var Ve=e.RANDOM(),$e=e.RANDOM(),Ze=e.RANDOM(),Qe=Math.sqrt(1-Ve),ht=Math.sqrt(Ve);return ye[0]=Qe*Math.sin(2*Math.PI*$e),ye[1]=Qe*Math.cos(2*Math.PI*$e),ye[2]=ht*Math.sin(2*Math.PI*Ze),ye[3]=ht*Math.cos(2*Math.PI*Ze),ye},De.invert=function(ye,Ve){var $e=Ve[0],Ze=Ve[1],Qe=Ve[2],ht=Ve[3],wt=$e*$e+Ze*Ze+Qe*Qe+ht*ht,st=wt?1/wt:0;return ye[0]=-$e*st,ye[1]=-Ze*st,ye[2]=-Qe*st,ye[3]=ht*st,ye},De.conjugate=function(ye,Ve){return ye[0]=-Ve[0],ye[1]=-Ve[1],ye[2]=-Ve[2],ye[3]=Ve[3],ye},De.fromMat3=b,De.fromEuler=function(ye,Ve,$e,Ze){var Qe=.5*Math.PI/180;Ve*=Qe,$e*=Qe,Ze*=Qe;var ht=Math.sin(Ve),wt=Math.cos(Ve),st=Math.sin($e),Jt=Math.cos($e),zi=Math.sin(Ze),Kt=Math.cos(Ze);return ye[0]=ht*Jt*Kt-wt*st*zi,ye[1]=wt*st*Kt+ht*Jt*zi,ye[2]=wt*Jt*zi-ht*st*Kt,ye[3]=wt*Jt*Kt+ht*st*zi,ye},De.str=function(ye){return"quat("+ye[0]+", "+ye[1]+", "+ye[2]+", "+ye[3]+")"},De.setAxes=De.sqlerp=De.rotationTo=De.equals=De.exactEquals=De.normalize=De.sqrLen=De.squaredLength=De.len=De.length=De.lerp=De.dot=De.scale=De.mul=De.add=De.set=De.copy=De.fromValues=De.clone=void 0;var e=d(et()),i=d(vt()),o=d(Pt()),h=d(hr());function a(ye){if(typeof WeakMap!="function")return null;var Ve=new WeakMap,$e=new WeakMap;return(a=function(Ze){return Ze?$e:Ve})(ye)}function d(ye,Ve){if(ye&&ye.__esModule)return ye;if(ye===null||r(ye)!=="object"&&typeof ye!="function")return{default:ye};var $e=a(Ve);if($e&&$e.has(ye))return $e.get(ye);var Ze={},Qe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ht in ye)if(ht!=="default"&&Object.prototype.hasOwnProperty.call(ye,ht)){var wt=Qe?Object.getOwnPropertyDescriptor(ye,ht):null;wt&&(wt.get||wt.set)?Object.defineProperty(Ze,ht,wt):Ze[ht]=ye[ht]}return Ze.default=ye,$e&&$e.set(ye,Ze),Ze}function _(){var ye=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(ye[0]=0,ye[1]=0,ye[2]=0),ye[3]=1,ye}function w(ye,Ve,$e){$e*=.5;var Ze=Math.sin($e);return ye[0]=Ze*Ve[0],ye[1]=Ze*Ve[1],ye[2]=Ze*Ve[2],ye[3]=Math.cos($e),ye}function M(ye,Ve,$e){var Ze=Ve[0],Qe=Ve[1],ht=Ve[2],wt=Ve[3],st=$e[0],Jt=$e[1],zi=$e[2],Kt=$e[3];return ye[0]=Ze*Kt+wt*st+Qe*zi-ht*Jt,ye[1]=Qe*Kt+wt*Jt+ht*st-Ze*zi,ye[2]=ht*Kt+wt*zi+Ze*Jt-Qe*st,ye[3]=wt*Kt-Ze*st-Qe*Jt-ht*zi,ye}function m(ye,Ve){var $e=Ve[0],Ze=Ve[1],Qe=Ve[2],ht=Ve[3],wt=Math.sqrt($e*$e+Ze*Ze+Qe*Qe),st=Math.exp(ht),Jt=wt>0?st*Math.sin(wt)/wt:0;return ye[0]=$e*Jt,ye[1]=Ze*Jt,ye[2]=Qe*Jt,ye[3]=st*Math.cos(wt),ye}function E(ye,Ve){var $e=Ve[0],Ze=Ve[1],Qe=Ve[2],ht=Ve[3],wt=Math.sqrt($e*$e+Ze*Ze+Qe*Qe),st=wt>0?Math.atan2(wt,ht)/wt:0;return ye[0]=$e*st,ye[1]=Ze*st,ye[2]=Qe*st,ye[3]=.5*Math.log($e*$e+Ze*Ze+Qe*Qe+ht*ht),ye}function I(ye,Ve,$e,Ze){var Qe,ht,wt,st,Jt,zi=Ve[0],Kt=Ve[1],wn=Ve[2],_n=Ve[3],Wi=$e[0],Fi=$e[1],qn=$e[2],En=$e[3];return(ht=zi*Wi+Kt*Fi+wn*qn+_n*En)<0&&(ht=-ht,Wi=-Wi,Fi=-Fi,qn=-qn,En=-En),1-ht>e.EPSILON?(Qe=Math.acos(ht),wt=Math.sin(Qe),st=Math.sin((1-Ze)*Qe)/wt,Jt=Math.sin(Ze*Qe)/wt):(st=1-Ze,Jt=Ze),ye[0]=st*zi+Jt*Wi,ye[1]=st*Kt+Jt*Fi,ye[2]=st*wn+Jt*qn,ye[3]=st*_n+Jt*En,ye}function b(ye,Ve){var $e,Ze=Ve[0]+Ve[4]+Ve[8];if(Ze>0)$e=Math.sqrt(Ze+1),ye[3]=.5*$e,ye[0]=(Ve[5]-Ve[7])*($e=.5/$e),ye[1]=(Ve[6]-Ve[2])*$e,ye[2]=(Ve[1]-Ve[3])*$e;else{var Qe=0;Ve[4]>Ve[0]&&(Qe=1),Ve[8]>Ve[3*Qe+Qe]&&(Qe=2);var ht=(Qe+1)%3,wt=(Qe+2)%3;$e=Math.sqrt(Ve[3*Qe+Qe]-Ve[3*ht+ht]-Ve[3*wt+wt]+1),ye[Qe]=.5*$e,ye[3]=(Ve[3*ht+wt]-Ve[3*wt+ht])*($e=.5/$e),ye[ht]=(Ve[3*ht+Qe]+Ve[3*Qe+ht])*$e,ye[wt]=(Ve[3*wt+Qe]+Ve[3*Qe+wt])*$e}return ye}De.clone=h.clone,De.fromValues=h.fromValues,De.copy=h.copy,De.set=h.set,De.add=h.add,De.mul=M;var T=h.scale;De.scale=T;var A=h.dot;De.dot=A,De.lerp=h.lerp;var k=h.length;De.length=k,De.len=k;var O=h.squaredLength;De.squaredLength=O,De.sqrLen=O;var U=h.normalize;De.normalize=U,De.exactEquals=h.exactEquals,De.equals=h.equals;var G,B,H,$=(G=o.create(),B=o.fromValues(1,0,0),H=o.fromValues(0,1,0),function(ye,Ve,$e){var Ze=o.dot(Ve,$e);return Ze<-.999999?(o.cross(G,B,Ve),o.len(G)<1e-6&&o.cross(G,H,Ve),o.normalize(G,G),w(ye,G,Math.PI),ye):Ze>.999999?(ye[0]=0,ye[1]=0,ye[2]=0,ye[3]=1,ye):(o.cross(G,Ve,$e),ye[0]=G[0],ye[1]=G[1],ye[2]=G[2],ye[3]=1+Ze,U(ye,ye))});De.rotationTo=$;var ne,me,de=(ne=_(),me=_(),function(ye,Ve,$e,Ze,Qe,ht){return I(ne,Ve,Qe,ht),I(me,$e,Ze,ht),I(ye,ne,me,2*ht*(1-ht)),ye});De.sqlerp=de;var ue,Fe=(ue=i.create(),function(ye,Ve,$e,Ze){return ue[0]=$e[0],ue[3]=$e[1],ue[6]=$e[2],ue[1]=Ze[0],ue[4]=Ze[1],ue[7]=Ze[2],ue[2]=-Ve[0],ue[5]=-Ve[1],ue[8]=-Ve[2],U(ye,b(ye,ue))});return De.setAxes=Fe,De}var rn,Ot={};function at(){if(rn)return Ot;function r(I){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},r(I)}rn=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.create=function(){var I=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0,I[4]=0,I[5]=0,I[6]=0,I[7]=0),I[3]=1,I},Ot.clone=function(I){var b=new e.ARRAY_TYPE(8);return b[0]=I[0],b[1]=I[1],b[2]=I[2],b[3]=I[3],b[4]=I[4],b[5]=I[5],b[6]=I[6],b[7]=I[7],b},Ot.fromValues=function(I,b,T,A,k,O,U,G){var B=new e.ARRAY_TYPE(8);return B[0]=I,B[1]=b,B[2]=T,B[3]=A,B[4]=k,B[5]=O,B[6]=U,B[7]=G,B},Ot.fromRotationTranslationValues=function(I,b,T,A,k,O,U){var G=new e.ARRAY_TYPE(8);G[0]=I,G[1]=b,G[2]=T,G[3]=A;var B=.5*k,H=.5*O,$=.5*U;return G[4]=B*A+H*T-$*b,G[5]=H*A+$*I-B*T,G[6]=$*A+B*b-H*I,G[7]=-B*I-H*b-$*T,G},Ot.fromRotationTranslation=d,Ot.fromTranslation=function(I,b){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=.5*b[0],I[5]=.5*b[1],I[6]=.5*b[2],I[7]=0,I},Ot.fromRotation=function(I,b){return I[0]=b[0],I[1]=b[1],I[2]=b[2],I[3]=b[3],I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},Ot.fromMat4=function(I,b){var T=i.create();o.getRotation(T,b);var A=new e.ARRAY_TYPE(3);return o.getTranslation(A,b),d(I,T,A),I},Ot.copy=_,Ot.identity=function(I){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},Ot.set=function(I,b,T,A,k,O,U,G,B){return I[0]=b,I[1]=T,I[2]=A,I[3]=k,I[4]=O,I[5]=U,I[6]=G,I[7]=B,I},Ot.getDual=function(I,b){return I[0]=b[4],I[1]=b[5],I[2]=b[6],I[3]=b[7],I},Ot.setDual=function(I,b){return I[4]=b[0],I[5]=b[1],I[6]=b[2],I[7]=b[3],I},Ot.getTranslation=function(I,b){var T=b[4],A=b[5],k=b[6],O=b[7],U=-b[0],G=-b[1],B=-b[2],H=b[3];return I[0]=2*(T*H+O*U+A*B-k*G),I[1]=2*(A*H+O*G+k*U-T*B),I[2]=2*(k*H+O*B+T*G-A*U),I},Ot.translate=function(I,b,T){var A=b[0],k=b[1],O=b[2],U=b[3],G=.5*T[0],B=.5*T[1],H=.5*T[2],$=b[4],ne=b[5],me=b[6],de=b[7];return I[0]=A,I[1]=k,I[2]=O,I[3]=U,I[4]=U*G+k*H-O*B+$,I[5]=U*B+O*G-A*H+ne,I[6]=U*H+A*B-k*G+me,I[7]=-A*G-k*B-O*H+de,I},Ot.rotateX=function(I,b,T){var A=-b[0],k=-b[1],O=-b[2],U=b[3],G=b[4],B=b[5],H=b[6],$=b[7],ne=G*U+$*A+B*O-H*k,me=B*U+$*k+H*A-G*O,de=H*U+$*O+G*k-B*A,ue=$*U-G*A-B*k-H*O;return i.rotateX(I,b,T),I[4]=ne*(U=I[3])+ue*(A=I[0])+me*(O=I[2])-de*(k=I[1]),I[5]=me*U+ue*k+de*A-ne*O,I[6]=de*U+ue*O+ne*k-me*A,I[7]=ue*U-ne*A-me*k-de*O,I},Ot.rotateY=function(I,b,T){var A=-b[0],k=-b[1],O=-b[2],U=b[3],G=b[4],B=b[5],H=b[6],$=b[7],ne=G*U+$*A+B*O-H*k,me=B*U+$*k+H*A-G*O,de=H*U+$*O+G*k-B*A,ue=$*U-G*A-B*k-H*O;return i.rotateY(I,b,T),I[4]=ne*(U=I[3])+ue*(A=I[0])+me*(O=I[2])-de*(k=I[1]),I[5]=me*U+ue*k+de*A-ne*O,I[6]=de*U+ue*O+ne*k-me*A,I[7]=ue*U-ne*A-me*k-de*O,I},Ot.rotateZ=function(I,b,T){var A=-b[0],k=-b[1],O=-b[2],U=b[3],G=b[4],B=b[5],H=b[6],$=b[7],ne=G*U+$*A+B*O-H*k,me=B*U+$*k+H*A-G*O,de=H*U+$*O+G*k-B*A,ue=$*U-G*A-B*k-H*O;return i.rotateZ(I,b,T),I[4]=ne*(U=I[3])+ue*(A=I[0])+me*(O=I[2])-de*(k=I[1]),I[5]=me*U+ue*k+de*A-ne*O,I[6]=de*U+ue*O+ne*k-me*A,I[7]=ue*U-ne*A-me*k-de*O,I},Ot.rotateByQuatAppend=function(I,b,T){var A=T[0],k=T[1],O=T[2],U=T[3],G=b[0],B=b[1],H=b[2],$=b[3];return I[0]=G*U+$*A+B*O-H*k,I[1]=B*U+$*k+H*A-G*O,I[2]=H*U+$*O+G*k-B*A,I[3]=$*U-G*A-B*k-H*O,I[4]=(G=b[4])*U+($=b[7])*A+(B=b[5])*O-(H=b[6])*k,I[5]=B*U+$*k+H*A-G*O,I[6]=H*U+$*O+G*k-B*A,I[7]=$*U-G*A-B*k-H*O,I},Ot.rotateByQuatPrepend=function(I,b,T){var A=b[0],k=b[1],O=b[2],U=b[3],G=T[0],B=T[1],H=T[2],$=T[3];return I[0]=A*$+U*G+k*H-O*B,I[1]=k*$+U*B+O*G-A*H,I[2]=O*$+U*H+A*B-k*G,I[3]=U*$-A*G-k*B-O*H,I[4]=A*($=T[7])+U*(G=T[4])+k*(H=T[6])-O*(B=T[5]),I[5]=k*$+U*B+O*G-A*H,I[6]=O*$+U*H+A*B-k*G,I[7]=U*$-A*G-k*B-O*H,I},Ot.rotateAroundAxis=function(I,b,T,A){if(Math.abs(A)<e.EPSILON)return _(I,b);var k=Math.hypot(T[0],T[1],T[2]);A*=.5;var O=Math.sin(A),U=O*T[0]/k,G=O*T[1]/k,B=O*T[2]/k,H=Math.cos(A),$=b[0],ne=b[1],me=b[2],de=b[3];I[0]=$*H+de*U+ne*B-me*G,I[1]=ne*H+de*G+me*U-$*B,I[2]=me*H+de*B+$*G-ne*U,I[3]=de*H-$*U-ne*G-me*B;var ue=b[4],Fe=b[5],ye=b[6],Ve=b[7];return I[4]=ue*H+Ve*U+Fe*B-ye*G,I[5]=Fe*H+Ve*G+ye*U-ue*B,I[6]=ye*H+Ve*B+ue*G-Fe*U,I[7]=Ve*H-ue*U-Fe*G-ye*B,I},Ot.add=function(I,b,T){return I[0]=b[0]+T[0],I[1]=b[1]+T[1],I[2]=b[2]+T[2],I[3]=b[3]+T[3],I[4]=b[4]+T[4],I[5]=b[5]+T[5],I[6]=b[6]+T[6],I[7]=b[7]+T[7],I},Ot.multiply=w,Ot.scale=function(I,b,T){return I[0]=b[0]*T,I[1]=b[1]*T,I[2]=b[2]*T,I[3]=b[3]*T,I[4]=b[4]*T,I[5]=b[5]*T,I[6]=b[6]*T,I[7]=b[7]*T,I},Ot.lerp=function(I,b,T,A){var k=1-A;return M(b,T)<0&&(A=-A),I[0]=b[0]*k+T[0]*A,I[1]=b[1]*k+T[1]*A,I[2]=b[2]*k+T[2]*A,I[3]=b[3]*k+T[3]*A,I[4]=b[4]*k+T[4]*A,I[5]=b[5]*k+T[5]*A,I[6]=b[6]*k+T[6]*A,I[7]=b[7]*k+T[7]*A,I},Ot.invert=function(I,b){var T=E(b);return I[0]=-b[0]/T,I[1]=-b[1]/T,I[2]=-b[2]/T,I[3]=b[3]/T,I[4]=-b[4]/T,I[5]=-b[5]/T,I[6]=-b[6]/T,I[7]=b[7]/T,I},Ot.conjugate=function(I,b){return I[0]=-b[0],I[1]=-b[1],I[2]=-b[2],I[3]=b[3],I[4]=-b[4],I[5]=-b[5],I[6]=-b[6],I[7]=b[7],I},Ot.normalize=function(I,b){var T=E(b);if(T>0){T=Math.sqrt(T);var A=b[0]/T,k=b[1]/T,O=b[2]/T,U=b[3]/T,G=b[4],B=b[5],H=b[6],$=b[7],ne=A*G+k*B+O*H+U*$;I[0]=A,I[1]=k,I[2]=O,I[3]=U,I[4]=(G-A*ne)/T,I[5]=(B-k*ne)/T,I[6]=(H-O*ne)/T,I[7]=($-U*ne)/T}return I},Ot.str=function(I){return"quat2("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+")"},Ot.exactEquals=function(I,b){return I[0]===b[0]&&I[1]===b[1]&&I[2]===b[2]&&I[3]===b[3]&&I[4]===b[4]&&I[5]===b[5]&&I[6]===b[6]&&I[7]===b[7]},Ot.equals=function(I,b){var T=I[0],A=I[1],k=I[2],O=I[3],U=I[4],G=I[5],B=I[6],H=I[7],$=b[0],ne=b[1],me=b[2],de=b[3],ue=b[4],Fe=b[5],ye=b[6],Ve=b[7];return Math.abs(T-$)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs($))&&Math.abs(A-ne)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(ne))&&Math.abs(k-me)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(me))&&Math.abs(O-de)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(de))&&Math.abs(U-ue)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(ue))&&Math.abs(G-Fe)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(Fe))&&Math.abs(B-ye)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(ye))&&Math.abs(H-Ve)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ve))},Ot.sqrLen=Ot.squaredLength=Ot.len=Ot.length=Ot.dot=Ot.mul=Ot.setReal=Ot.getReal=void 0;var e=a(et()),i=a(Xn()),o=a(Ue());function h(I){if(typeof WeakMap!="function")return null;var b=new WeakMap,T=new WeakMap;return(h=function(A){return A?T:b})(I)}function a(I,b){if(I&&I.__esModule)return I;if(I===null||r(I)!=="object"&&typeof I!="function")return{default:I};var T=h(b);if(T&&T.has(I))return T.get(I);var A={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var O in I)if(O!=="default"&&Object.prototype.hasOwnProperty.call(I,O)){var U=k?Object.getOwnPropertyDescriptor(I,O):null;U&&(U.get||U.set)?Object.defineProperty(A,O,U):A[O]=I[O]}return A.default=I,T&&T.set(I,A),A}function d(I,b,T){var A=.5*T[0],k=.5*T[1],O=.5*T[2],U=b[0],G=b[1],B=b[2],H=b[3];return I[0]=U,I[1]=G,I[2]=B,I[3]=H,I[4]=A*H+k*B-O*G,I[5]=k*H+O*U-A*B,I[6]=O*H+A*G-k*U,I[7]=-A*U-k*G-O*B,I}function _(I,b){return I[0]=b[0],I[1]=b[1],I[2]=b[2],I[3]=b[3],I[4]=b[4],I[5]=b[5],I[6]=b[6],I[7]=b[7],I}function w(I,b,T){var A=b[0],k=b[1],O=b[2],U=b[3],G=T[4],B=T[5],H=T[6],$=T[7],ne=b[4],me=b[5],de=b[6],ue=b[7],Fe=T[0],ye=T[1],Ve=T[2],$e=T[3];return I[0]=A*$e+U*Fe+k*Ve-O*ye,I[1]=k*$e+U*ye+O*Fe-A*Ve,I[2]=O*$e+U*Ve+A*ye-k*Fe,I[3]=U*$e-A*Fe-k*ye-O*Ve,I[4]=A*$+U*G+k*H-O*B+ne*$e+ue*Fe+me*Ve-de*ye,I[5]=k*$+U*B+O*G-A*H+me*$e+ue*ye+de*Fe-ne*Ve,I[6]=O*$+U*H+A*B-k*G+de*$e+ue*Ve+ne*ye-me*Fe,I[7]=U*$-A*G-k*B-O*H+ue*$e-ne*Fe-me*ye-de*Ve,I}Ot.getReal=i.copy,Ot.setReal=i.copy,Ot.mul=w;var M=i.dot;Ot.dot=M;var m=i.length;Ot.length=m,Ot.len=m;var E=i.squaredLength;return Ot.squaredLength=E,Ot.sqrLen=E,Ot}var Ht,Qi,vi={};function Mn(){if(Ht)return vi;function r(b){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},r(b)}Ht=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.create=o,vi.clone=function(b){var T=new e.ARRAY_TYPE(2);return T[0]=b[0],T[1]=b[1],T},vi.fromValues=function(b,T){var A=new e.ARRAY_TYPE(2);return A[0]=b,A[1]=T,A},vi.copy=function(b,T){return b[0]=T[0],b[1]=T[1],b},vi.set=function(b,T,A){return b[0]=T,b[1]=A,b},vi.add=function(b,T,A){return b[0]=T[0]+A[0],b[1]=T[1]+A[1],b},vi.subtract=h,vi.multiply=a,vi.divide=d,vi.ceil=function(b,T){return b[0]=Math.ceil(T[0]),b[1]=Math.ceil(T[1]),b},vi.floor=function(b,T){return b[0]=Math.floor(T[0]),b[1]=Math.floor(T[1]),b},vi.min=function(b,T,A){return b[0]=Math.min(T[0],A[0]),b[1]=Math.min(T[1],A[1]),b},vi.max=function(b,T,A){return b[0]=Math.max(T[0],A[0]),b[1]=Math.max(T[1],A[1]),b},vi.round=function(b,T){return b[0]=Math.round(T[0]),b[1]=Math.round(T[1]),b},vi.scale=function(b,T,A){return b[0]=T[0]*A,b[1]=T[1]*A,b},vi.scaleAndAdd=function(b,T,A,k){return b[0]=T[0]+A[0]*k,b[1]=T[1]+A[1]*k,b},vi.distance=_,vi.squaredDistance=w,vi.length=M,vi.squaredLength=m,vi.negate=function(b,T){return b[0]=-T[0],b[1]=-T[1],b},vi.inverse=function(b,T){return b[0]=1/T[0],b[1]=1/T[1],b},vi.normalize=function(b,T){var A=T[0],k=T[1],O=A*A+k*k;return O>0&&(O=1/Math.sqrt(O)),b[0]=T[0]*O,b[1]=T[1]*O,b},vi.dot=function(b,T){return b[0]*T[0]+b[1]*T[1]},vi.cross=function(b,T,A){var k=T[0]*A[1]-T[1]*A[0];return b[0]=b[1]=0,b[2]=k,b},vi.lerp=function(b,T,A,k){var O=T[0],U=T[1];return b[0]=O+k*(A[0]-O),b[1]=U+k*(A[1]-U),b},vi.random=function(b,T){T=T||1;var A=2*e.RANDOM()*Math.PI;return b[0]=Math.cos(A)*T,b[1]=Math.sin(A)*T,b},vi.transformMat2=function(b,T,A){var k=T[0],O=T[1];return b[0]=A[0]*k+A[2]*O,b[1]=A[1]*k+A[3]*O,b},vi.transformMat2d=function(b,T,A){var k=T[0],O=T[1];return b[0]=A[0]*k+A[2]*O+A[4],b[1]=A[1]*k+A[3]*O+A[5],b},vi.transformMat3=function(b,T,A){var k=T[0],O=T[1];return b[0]=A[0]*k+A[3]*O+A[6],b[1]=A[1]*k+A[4]*O+A[7],b},vi.transformMat4=function(b,T,A){var k=T[0],O=T[1];return b[0]=A[0]*k+A[4]*O+A[12],b[1]=A[1]*k+A[5]*O+A[13],b},vi.rotate=function(b,T,A,k){var O=T[0]-A[0],U=T[1]-A[1],G=Math.sin(k),B=Math.cos(k);return b[0]=O*B-U*G+A[0],b[1]=O*G+U*B+A[1],b},vi.angle=function(b,T){var A=b[0],k=b[1],O=T[0],U=T[1],G=Math.sqrt(A*A+k*k)*Math.sqrt(O*O+U*U);return Math.acos(Math.min(Math.max(G&&(A*O+k*U)/G,-1),1))},vi.zero=function(b){return b[0]=0,b[1]=0,b},vi.str=function(b){return"vec2("+b[0]+", "+b[1]+")"},vi.exactEquals=function(b,T){return b[0]===T[0]&&b[1]===T[1]},vi.equals=function(b,T){var A=b[0],k=b[1],O=T[0],U=T[1];return Math.abs(A-O)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(O))&&Math.abs(k-U)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(U))},vi.forEach=vi.sqrLen=vi.sqrDist=vi.dist=vi.div=vi.mul=vi.sub=vi.len=void 0;var e=function(b,T){if(b&&b.__esModule)return b;if(b===null||r(b)!=="object"&&typeof b!="function")return{default:b};var A=i(void 0);if(A&&A.has(b))return A.get(b);var k={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in b)if(U!=="default"&&Object.prototype.hasOwnProperty.call(b,U)){var G=O?Object.getOwnPropertyDescriptor(b,U):null;G&&(G.get||G.set)?Object.defineProperty(k,U,G):k[U]=b[U]}return k.default=b,A&&A.set(b,k),k}(et());function i(b){if(typeof WeakMap!="function")return null;var T=new WeakMap,A=new WeakMap;return(i=function(k){return k?A:T})(b)}function o(){var b=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(b[0]=0,b[1]=0),b}function h(b,T,A){return b[0]=T[0]-A[0],b[1]=T[1]-A[1],b}function a(b,T,A){return b[0]=T[0]*A[0],b[1]=T[1]*A[1],b}function d(b,T,A){return b[0]=T[0]/A[0],b[1]=T[1]/A[1],b}function _(b,T){return Math.hypot(T[0]-b[0],T[1]-b[1])}function w(b,T){var A=T[0]-b[0],k=T[1]-b[1];return A*A+k*k}function M(b){return Math.hypot(b[0],b[1])}function m(b){var T=b[0],A=b[1];return T*T+A*A}vi.len=M,vi.sub=h,vi.mul=a,vi.div=d,vi.dist=_,vi.sqrDist=w,vi.sqrLen=m;var E,I=(E=o(),function(b,T,A,k,O,U){var G,B;for(T||(T=2),A||(A=0),B=k?Math.min(k*T+A,b.length):b.length,G=A;G<B;G+=T)E[0]=b[G],E[1]=b[G+1],O(E,E,U),b[G]=E[0],b[G+1]=E[1];return b});return vi.forEach=I,vi}function gr(){if(Qi)return ti;function r(b){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},r(b)}Qi=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.vec4=ti.vec3=ti.vec2=ti.quat2=ti.quat=ti.mat4=ti.mat3=ti.mat2d=ti.mat2=ti.glMatrix=void 0;var e=I(et());ti.glMatrix=e;var i=I(Qt());ti.mat2=i;var o=I(We());ti.mat2d=o;var h=I(vt());ti.mat3=h;var a=I(Ue());ti.mat4=a;var d=I(Xn());ti.quat=d;var _=I(at());ti.quat2=_;var w=I(Mn());ti.vec2=w;var M=I(Pt());ti.vec3=M;var m=I(hr());function E(b){if(typeof WeakMap!="function")return null;var T=new WeakMap,A=new WeakMap;return(E=function(k){return k?A:T})(b)}function I(b,T){if(b&&b.__esModule)return b;if(b===null||r(b)!=="object"&&typeof b!="function")return{default:b};var A=E(T);if(A&&A.has(b))return A.get(b);var k={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in b)if(U!=="default"&&Object.prototype.hasOwnProperty.call(b,U)){var G=O?Object.getOwnPropertyDescriptor(b,U):null;G&&(G.get||G.set)?Object.defineProperty(k,U,G):k[U]=b[U]}return k.default=b,A&&A.set(b,k),k}return ti.vec4=m,ti}var Hn,kr,Dt,Ls,Pe=gr(),$n=function(){if(kr)return Hn;function r(e,i,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=h}return kr=1,Hn=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var a=this.sampleCurveX(o)-e;if(Math.abs(a)<i)return o;var d=this.sampleCurveDerivativeX(o);if(Math.abs(d)<1e-6)break;o-=a/d}var _=0,w=1;for(o=e,h=0;h<20&&(a=this.sampleCurveX(o),!(Math.abs(a-e)<i));h++)e>a?_=o:w=o,o=.5*(w-_)+_;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Hn}(),lt=xn($n);function cs(){if(Ls)return Dt;function r(e,i){this.x=e,this.y=i}return Ls=1,Dt=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),h=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=h,this},_rotateAround:function(e,i){var o=Math.cos(e),h=Math.sin(e),a=i.y+h*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-h*(this.y-i.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(e){return e instanceof r?e:Array.isArray(e)?new r(e[0],e[1]):e},Dt}var Xi=xn(cs());function vs(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!vs(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!vs(r[i],e[i]))return!1;return!0}return r===e}const Bs=Math.PI/180,Xs=180/Math.PI;function Sr(r){return r*Bs}function un(r){return r*Xs}const ys=[[0,0],[1,0],[1,1],[0,1]];function Hs(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function ls(r,e,i,o){const h=new lt(r,e,i,o);return function(a){return h.solve(a)}}const Rs=ls(.25,.1,.25,1);function cn(r,e,i){return Math.min(i,Math.max(e,r))}function Jr(r,e,i){return(i=cn((i-r)/(e-r),0,1))*i*(3-2*i)}function Pr(r,e,i){const o=i-e,h=((r-e)%o+o)%o+e;return h===e?i:h}function Ts(r,e,i){if(!r.length)return i(null,[]);let o=r.length;const h=new Array(r.length);let a=null;r.forEach((d,_)=>{e(d,(w,M)=>{w&&(a=w),h[_]=M,--o==0&&i(a,h)})})}function Dn(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}let xs=1;function Gn(){return xs++}function Ir(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function fo(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ms(r,e){return r.indexOf(e,r.length-e.length)!==-1}function Co(r,e,i){const o={};for(const h in r)o[h]=e.call(this,r[h],h,r);return o}function mr(r,e,i){const o={};for(const h in r)e.call(this,r[h],h,r)&&(o[h]=r[h]);return o}function Ss(r){return Array.isArray(r)?r.map(Ss):typeof r=="object"&&r?Co(r,Ss):r}const ks={};function ur(r){ks[r]||(typeof console!="undefined"&&console.warn(r),ks[r]=!0)}function _e(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function he(r){let e=0;for(let i,o,h=0,a=r.length,d=a-1;h<a;d=h++)i=r[h],o=r[d],e+=(o.x-i.x)*(i.y+o.y);return e}function pe([r,e,i]){const o=Sr(e+90),h=Sr(i);return{x:r*Math.cos(o)*Math.sin(h),y:r*Math.sin(o)*Math.sin(h),z:r*Math.cos(h),azimuthal:e,polar:i}}function Re(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function ke(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,h,a)=>{const d=h||a;return e[o]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ui=null;function Vt(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function fi(r,e,i,o){for(;e<i;){const h=e+i>>1;r[h]<o?e=h+1:i=h}return e}function Zt(r,e,i,o){for(;e<i;){const h=e+i>>1;r[h]<=o?e=h+1:i=h}return e}function en(r){return r>0?1/(1.001-r):1+r}function Un(r){return r>0?1-1/(1.001-r):-r}const Bn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Bn.API_URL)return null;try{const r=new URL(Bn.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch(r){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Or(r){return Bn.API_URL_REGEX.test(r)}function hs(r){return Bn.API_SPRITE_REGEX.test(r)}let Vs,qr,ds,gt,q,ee;function oe(){return Vs==null&&(Vs=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Vs}const Ee={now:()=>gt!==void 0?gt:performance.now(),setNow(r){gt=r},restoreNow(){gt=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:o}=r;q||(q=document.createElement("canvas"));const h=q.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>q.width||o>q.height)&&(q.width=i,q.height=o),h.clearRect(-e,-e,i+2*e,o+2*e),h.drawImage(r,0,0,i,o),h.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:r=>(qr||(qr=document.createElement("a")),qr.href=r,qr.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ds==null&&(ds=window.matchMedia("(prefers-reduced-motion: reduce)")),ds.matches)},hasCanvasFingerprintNoise(){if(ee!==void 0)return ee;if(!oe())return ee=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<r.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const o=e.getImageData(0,0,r.width,r.height);i=0;for(let h=0;h<o.data.length;++h)if(h%4!=3&&i++!==o.data[h])return ee=!0,!0;return ee=!1,!1}};function be(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(r.slice(i));for(const h in e)o.set(h,e[h]);return`${r.slice(0,i)}?${o.toString()}`}function Ce(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const o=new URLSearchParams,h=new URLSearchParams(r.slice(i));for(const d of e.persistentParams){const _=h.get(d);_&&o.set(d,_)}const a=o.toString();return`${r.slice(0,i)}${a.length>0?`?${a}`:""}`}const Y="mapbox-tiles";let K=500,se=50;const fe=["language","worldview","jobid"];let ce,Se;function it(){try{return caches}catch(r){}}function Ne(){const r=it();r&&ce==null&&(ce=r.open(Y))}let ut=1/0;const Et={supported:!1,testSupport:function(r){!vn&&Xt&&(nn?Kn(r):xt=r)}};let xt,Xt,vn=!1,nn=!1;const Tn=typeof self!="undefined"?self:{};function Kn(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Xt),r.isContextLost())return;Et.supported=!0}catch(i){}r.deleteTexture(e),vn=!0}Tn.document&&(Xt=Tn.document.createElement("img"),Xt.onload=function(){xt&&Kn(xt),xt=null,nn=!0},Xt.onerror=function(){vn=!0,xt=null},Xt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const dr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(dr);class Vn extends Error{constructor(e,i,o){i===401&&Or(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Hr=Re()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Mr=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Hr())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,h){const a=new AbortController,d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Hr(),referrerPolicy:o.referrerPolicy,signal:a.signal});let _=!1,w=!1;const M=(m=d.url).indexOf("sku=")>0&&Or(m);var m;o.type==="json"&&d.headers.set("Accept","application/json");const E=(b,T,A)=>{if(w)return;if(b&&b.message!=="SecurityError"&&ur(b.toString()),T&&A)return I(T);const k=Date.now();fetch(d).then(O=>{if(O.ok){const U=M?O.clone():null;return I(O,U,k)}return h(new Vn(O.statusText,O.status,o.url))}).catch(O=>{O.name!=="AbortError"&&h(new Error(`${O.message} ${o.url}`))})},I=(b,T,A)=>{(o.type==="arrayBuffer"?b.arrayBuffer():o.type==="json"?b.json():b.text()).then(k=>{w||(T&&A&&function(O,U,G){if(Ne(),ce==null)return;const B=ke(U.headers.get("Cache-Control")||"");if(B["no-store"])return;const H={status:U.status,statusText:U.statusText,headers:new Headers};U.headers.forEach((me,de)=>H.headers.set(de,me)),B["max-age"]&&H.headers.set("Expires",new Date(G+1e3*B["max-age"]).toUTCString());const $=H.headers.get("Expires");if(!$||new Date($).getTime()-G<42e4)return;let ne=Ce(O.url,{persistentParams:fe});if(U.status===206){const me=O.headers.get("Range");if(!me)return;H.status=200,ne=be(ne,{range:me})}(function(me,de){if(Se===void 0)try{new Response(new ReadableStream),Se=!0}catch(ue){Se=!1}Se?de(me.body):me.blob().then(de)})(U,me=>{const de=new Response((ue=U.status)!==200&&ue!==404&&[101,103,204,205,304].includes(ue)?null:me,H);var ue;Ne(),ce!=null&&ce.then(Fe=>Fe.put(ne,de)).catch(Fe=>ur(Fe.message))})}(d,T,A),_=!0,h(null,k,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(k=>{w||h(new Error(k.message))})};return M?function(b,T){if(Ne(),ce==null)return T(null);ce.then(A=>{let k=Ce(b.url,{persistentParams:fe});const O=b.headers.get("Range");O&&(k=be(k,{range:O})),A.match(k).then(U=>{const G=function(B){if(!B)return!1;const H=new Date(B.headers.get("Expires")||0),$=ke(B.headers.get("Cache-Control")||"");return H>Date.now()&&!$["no-cache"]}(U);A.delete(k),G&&A.put(k,U.clone()),T(null,U,G)}).catch(T)}).catch(T)}(d,E):E(null,null),{cancel:()=>{w=!0,_||a.abort()}}}(r,e);if(Re()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(o,h){const a=new XMLHttpRequest;a.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(a.responseType="arraybuffer");for(const d in o.headers)a.setRequestHeader(d,o.headers[d]);return o.type==="json"&&(a.responseType="text",a.setRequestHeader("Accept","application/json")),a.withCredentials=o.credentials==="include",a.onerror=()=>{h(new Error(a.statusText))},a.onload=()=>{if((a.status>=200&&a.status<300||a.status===0)&&a.response!==null){let d=a.response;if(o.type==="json")try{d=JSON.parse(a.response)}catch(_){return h(_)}h(null,d,a.getResponseHeader("Cache-Control"),a.getResponseHeader("Expires"))}else h(new Vn(a.statusText,a.status,o.url))},a.send(o.body),{cancel:()=>a.abort()}}(r,e)},zs=function(r,e){return Mr(Dn(r,{type:"arrayBuffer"}),e)};function Qs(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const xo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let bs,to;bs=[],to=0;const rs=function(r,e){if(Et.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),to>=Bn.MAX_PARALLEL_IMAGE_REQUESTS){const a={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return bs.push(a),a}to++;let i=!1;const o=()=>{if(!i)for(i=!0,to--;bs.length&&to<Bn.MAX_PARALLEL_IMAGE_REQUESTS;){const a=bs.shift(),{requestParameters:d,callback:_,cancelled:w}=a;w||(a.cancel=rs(d,_).cancel)}},h=zs(r,(a,d,_,w)=>{o(),a?e(a):d&&(self.createImageBitmap?function(M,m){const E=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(E).then(I=>{m(null,I)}).catch(I=>{m(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(M,m)=>e(M,m,_,w)):function(M,m){const E=new Image;E.onload=()=>{m(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=xo})},E.onerror=()=>m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(M)],{type:"image/png"});E.src=M.byteLength?URL.createObjectURL(I):xo}(d,(M,m)=>e(M,m,_,w)))});return{cancel:()=>{h.cancel(),o()}}};var ws,Qr,Ho,io={exports:{}},ao={exports:{}},Po={exports:{}},Zo=function(){if(Ho)return io.exports;Ho=1;var r=(ws||(ws=1,ao.exports=function(i,o){var h,a,d,_,w,M,m,E;for(a=i.length-(h=3&i.length),d=o,w=3432918353,M=461845907,E=0;E<a;)m=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,d=27492+(65535&(_=5*(65535&(d=(d^=m=(65535&(m=(m=(65535&m)*w+(((m>>>16)*w&65535)<<16)&4294967295)<<15|m>>>17))*M+(((m>>>16)*M&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(m=0,h){case 3:m^=(255&i.charCodeAt(E+2))<<16;case 2:m^=(255&i.charCodeAt(E+1))<<8;case 1:d^=m=(65535&(m=(m=(65535&(m^=255&i.charCodeAt(E)))*w+(((m>>>16)*w&65535)<<16)&4294967295)<<15|m>>>17))*M+(((m>>>16)*M&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),ao.exports),e=(Qr||(Qr=1,Po.exports=function(i,o){for(var h,a=i.length,d=o^a,_=0;a>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(h>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),a-=4,++_;switch(a){case 3:d^=(255&i.charCodeAt(_+2))<<16;case 2:d^=(255&i.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),Po.exports);return io.exports=r,io.exports.murmur3=r,io.exports.murmur2=e,io.exports}(),bo=xn(Zo);class Oo{constructor(e,...i){Dn(this,i[0]||{}),this.type=e}}class wo extends Oo{constructor(e,i={}){super("error",Dn({error:e},i))}}function ma(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function Yo(r,e,i){if(i&&i[r]){const o=i[r].indexOf(e);o!==-1&&i[r].splice(o,1)}}class sa{on(e,i){return this._listeners=this._listeners||{},ma(e,i,this._listeners),this}off(e,i){return Yo(e,i,this._listeners),Yo(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},ma(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){const o=typeof e=="string"?new Oo(e,i):e,h=o.type;if(this.listens(h)){o.target=this;const a=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of a)w.call(this,o);const d=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of d)Yo(h,w,this._oneTimeListeners),w.call(this,o);const _=this._eventedParent;_&&(Dn(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(o))}else o instanceof wo&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var la,Is={},D=function(){if(la)return Is;la=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(a){return(a=Math.round(a))<0?0:a>255?255:a}function i(a){return e(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function o(a){return(d=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:d>1?1:d;var d}function h(a,d,_){return _<0?_+=1:_>1&&(_-=1),6*_<1?a+(d-a)*_*6:2*_<1?d:3*_<2?a+(d-a)*(2/3-_)*6:a}try{Is.parseCSSColor=function(a){var d,_=a.replace(/ /g,"").toLowerCase();if(_ in r)return r[_].slice();if(_[0]==="#")return _.length===4?(d=parseInt(_.substr(1),16))>=0&&d<=4095?[(3840&d)>>4|(3840&d)>>8,240&d|(240&d)>>4,15&d|(15&d)<<4,1]:null:_.length===7&&(d=parseInt(_.substr(1),16))>=0&&d<=16777215?[(16711680&d)>>16,(65280&d)>>8,255&d,1]:null;var w=_.indexOf("("),M=_.indexOf(")");if(w!==-1&&M+1===_.length){var m=_.substr(0,w),E=_.substr(w+1,M-(w+1)).split(","),I=1;switch(m){case"rgba":if(E.length!==4)return null;I=o(E.pop());case"rgb":return E.length!==3?null:[i(E[0]),i(E[1]),i(E[2]),I];case"hsla":if(E.length!==4)return null;I=o(E.pop());case"hsl":if(E.length!==3)return null;var b=(parseFloat(E[0])%360+360)%360/360,T=o(E[1]),A=o(E[2]),k=A<=.5?A*(T+1):A+T-A*T,O=2*A-k;return[e(255*h(O,k,b+1/3)),e(255*h(O,k,b)),e(255*h(O,k,b-1/3)),I];default:return null}}return null}}catch(a){}return Is}();class W{constructor(e,i,o,h=1){this.r=e,this.g=i,this.b=o,this.a=h}static parse(e){if(!e)return;if(e instanceof W)return e;if(typeof e!="string")return;const i=D.parseCSSColor(e);return i?new W(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,o,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${h})`}toString(){const[e,i,o,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${h})`}toRenderColor(e){const{r:i,g:o,b:h,a}=this;return new Ge(e,i,o,h,a)}clone(){return new W(this.r,this.g,this.b,this.a)}}class Ge{constructor(e,i,o,h,a){if(e){const d=e.image.height,_=d*d;i=a===0?0:i/a*(d-1),o=a===0?0:o/a*(d-1),h=a===0?0:h/a*(d-1);const w=Math.floor(i),M=Math.floor(o),m=Math.floor(h),E=Math.ceil(i),I=Math.ceil(o),b=Math.ceil(h),T=i-w,A=o-M,k=h-m,O=e.image.data,U=4*(w+M*_+m*d),G=4*(w+M*_+b*d),B=4*(w+I*_+m*d),H=4*(w+I*_+b*d),$=4*(E+M*_+m*d),ne=4*(E+M*_+b*d),me=4*(E+I*_+m*d),de=4*(E+I*_+b*d);if(U<0||de>=O.length)throw new Error("out of range");this.r=Ye(Ye(Ye(O[U],O[G],k),Ye(O[B],O[H],k),A),Ye(Ye(O[$],O[ne],k),Ye(O[me],O[de],k),A),T)/255*a,this.g=Ye(Ye(Ye(O[U+1],O[G+1],k),Ye(O[B+1],O[H+1],k),A),Ye(Ye(O[$+1],O[ne+1],k),Ye(O[me+1],O[de+1],k),A),T)/255*a,this.b=Ye(Ye(Ye(O[U+2],O[G+2],k),Ye(O[B+2],O[H+2],k),A),Ye(Ye(O[$+2],O[ne+2],k),Ye(O[me+2],O[de+2],k),A),T)/255*a,this.a=a}else this.r=i,this.g=o,this.b=h,this.a=a}toArray(){const{r:e,g:i,b:o,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*i/h,255*o/h,h]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:o,a:h}=this,a=Math.min(Math.max(e/h,0),1),d=Math.min(Math.max(i/h,0),1),_=Math.min(Math.max(o/h,0),1),w=Math.min(a,d,_),M=Math.max(a,d,_),m=(w+M)/2;if(w===M)return[0,0,100*m,h];const E=M-w,I=m>.5?E/(2-M-w):E/(M+w);let b=0;return M===a?b=(d-_)/E+(d<_?6:0):M===d?b=(_-a)/E+2:M===_&&(b=(a-d)/E+4),b*=60,[Math.min(Math.max(b,0),360),Math.min(Math.max(100*I,0),100),Math.min(Math.max(100*m,0),100),h]}toArray01(){const{r:e,g:i,b:o,a:h}=this;return h===0?[0,0,0,0]:[e/h,i/h,o/h,h]}toArray01Scaled(e){const{r:i,g:o,b:h,a}=this;return a===0?[0,0,0]:[i/a*e,o/a*e,h/a*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:h}=this;return[e,i,o,h]}toArray01Linear(){const{r:e,g:i,b:o,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(e/h,2.2),Math.pow(i/h,2.2),Math.pow(o/h,2.2),h]}}function Ye(r,e,i){return r*(1-i)+e*i}function Bt(r,e,i){return r.map((o,h)=>Ye(o,e[h],i))}W.black=new W(0,0,0,1),W.white=new W(1,1,1,1),W.transparent=new W(0,0,0,0),W.red=new W(1,0,0,1),W.blue=new W(0,0,1,1);var Ei=Object.freeze({__proto__:null,array:Bt,color:function(r,e,i){return new W(Ye(r.r,e.r,i),Ye(r.g,e.g,i),Ye(r.b,e.b,i),Ye(r.a,e.a,i))},number:Ye});function Pn(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}class yn extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class pr{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,h]of i)this.bindings[o]=h}concat(e){return new pr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Er={kind:"null"},ft={kind:"number"},mi={kind:"string"},nt={kind:"boolean"},jt={kind:"color"},Ti={kind:"object"},ni={kind:"value"},wi={kind:"collator"},Mi={kind:"formatted"},Li={kind:"resolvedImage"};function pt(r,e){return{kind:"array",itemType:r,N:e}}function St(r){if(r.kind==="array"){const e=St(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const zt=[Er,ft,mi,nt,jt,Mi,Ti,pt(ni),Li];function At(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!At(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of zt)if(!At(i,e))return null}}return`Expected ${St(r)} but found ${St(e)} instead.`}function kt(r,e){return e.some(i=>i.kind===r.kind)}function Ci(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}class Ke{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class It{constructor(e,i,o,h,a){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=h,this.textColor=a}}class Nt{constructor(e){this.sections=e}static fromString(e){return new Nt([new It(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof Nt?e:Nt.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class ci{constructor(e,i){if(this.id=e,this.options=i||{params:{}},this.options.transform){const{a:o,b:h,c:a,d,e:_,f:w}=this.options.transform;this.options.transform=new DOMMatrix([o,h,a,d,_,w])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){const i=JSON.parse(e),{a:o,b:h,c:a,d,e:_,f:w}=i.options.transform;return new DOMMatrix([o,h,a,d,_,w]),new ci(i.id,i.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){const e={id:this.id};this.options&&(e.options=this.options);const{a:i,b:o,c:h,d:a,e:d,f:_}=this.options.transform;return e.options.transform={a:i,b:o,c:h,d:a,e:d,f:_},JSON.stringify(e)}}class oi{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new ci(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new ci(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?oi.build(e):e}static build(e,i,o,h){return e?new oi({namePrimary:e,nameSecondary:i,optionsPrimary:o,optionsSecondary:h,available:!1}):null}}function Ki(r,e,i,o){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,e,i,o]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function si(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof W||r instanceof Ke||r instanceof Nt||r instanceof oi)return!0;if(Array.isArray(r)){for(const e of r)if(!si(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!si(r[e]))return!1;return!0}return!1}function Di(r){if(r===null)return Er;if(typeof r=="string")return mi;if(typeof r=="boolean")return nt;if(typeof r=="number")return ft;if(r instanceof W)return jt;if(r instanceof Ke)return wi;if(r instanceof Nt)return Mi;if(r instanceof oi)return Li;if(Array.isArray(r)){const e=r.length;let i;for(const o of r){const h=Di(o);if(i){if(i===h)continue;i=ni;break}i=h}return pt(i||ni,e)}return Ti}function li(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof W?r.toStringPremultipliedAlpha():r instanceof Nt||r instanceof oi?r.toString():JSON.stringify(r)}class Oi{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!si(e[1]))return i.error("invalid value");const o=e[1];let h=Di(o);const a=i.expectedType;return h.kind!=="array"||h.N!==0||!a||a.kind!=="array"||typeof a.N=="number"&&a.N!==0||(h=a),new Oi(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof W?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Nt?this.value.serialize():this.value}}class Hi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Sn={string:mi,number:ft,boolean:nt,object:Ti};class On{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,h=1;const a=e[0];if(a==="array"){let _,w;if(e.length>2){const M=e[1];if(typeof M!="string"||!(M in Sn)||M==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=Sn[M],h++}else _=ni;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],h++}o=pt(_,w)}else o=Sn[a];const d=[];for(;h<e.length;h++){const _=i.parse(e[h],h,ni);if(!_)return null;d.push(_)}return new On(o,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!At(this.type,Di(o)))return o;if(i===this.args.length-1)throw new Hi(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${St(Di(o))} but was expected to be of type ${St(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(o=>o.serialize()))}}class An{constructor(e){this.type=Mi,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const h=[];let a=!1;for(let d=1;d<=e.length-1;++d){const _=e[d];if(a&&typeof _=="object"&&!Array.isArray(_)){a=!1;let w=null;if(_["font-scale"]&&(w=i.parseObjectValue(_["font-scale"],d,"font-scale",ft),!w))return null;let M=null;if(_["text-font"]&&(M=i.parseObjectValue(_["text-font"],d,"text-font",pt(mi)),!M))return null;let m=null;if(_["text-color"]&&(m=i.parseObjectValue(_["text-color"],d,"text-color",jt),!m))return null;const E=h[h.length-1];E.scale=w,E.font=M,E.textColor=m}else{const w=i.parse(e[d],d,ni);if(!w)return null;const M=w.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new An(h)}evaluate(e){return new Nt(this.sections.map(i=>{const o=i.content.evaluate(e);return Di(o)===Li?new It("",o,null,null,null):new It(li(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class fr{constructor(e,i,o,h){this._imageWarnHistory={},this.type=Li,this.inputPrimary=e,this.inputSecondary=i,this.inputPrimaryParams=o,this.inputSecondaryParams=h}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const h=[];function a(){if(o<e.length){const _=i.parse(e[o],o++,mi);return _?(h.push({image:_,options:void 0}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function d(){if(o<e.length){if((_=e[o])===null||typeof _!="object"||Array.isArray(_))return!0;const w=e[o].params,M=i.concat(o);if(!w)return o++,!0;if(typeof w!="object"||w.constructor!==Object)return M.error('Image options "params" should be an object'),!1;const m={},E=M.concat(void 0,"params");for(const I in w){if(!I)return E.error("Image parameter name should be non-empty"),!1;const b=E.concat(void 0,I).parse(w[I],void 0,jt,void 0,{typeAnnotation:"coerce"});if(!b)return!1;m[I]=b}return h[h.length-1].options=m,o++,!0}var _;return!0}for(let _=0;_<2;_++)if(!a()||!d())return;return new fr(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const h in i)if(i[h])try{const a=i[h].evaluate(e),d=`Ignoring image parameter "${h}" with semi-transparent color ${a.toString()}`;if(a.a!==1){this._imageWarnHistory[d]||(console.warn(d),this._imageWarnHistory[d]=!0);continue}o[h]=a}catch(a){continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i=oi.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(const i in this.inputPrimaryParams)this.inputPrimaryParams[i]&&e(this.inputPrimaryParams[i]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(const i in this.inputSecondaryParams)this.inputSecondaryParams[i]&&e(this.inputSecondaryParams[i])}outputDefined(){return!1}serializeParams(e){const i={};if(e){for(const o in e)e[o]&&(i[o]=e[o].serialize());return{params:i}}}serialize(){const e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function mt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}const Wt={"to-boolean":nt,"to-color":jt,"to-number":ft,"to-string":mi};class hi{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],h=[];let a=Er;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);a=pt(i.expectedType.itemType,d)}else{if(!(d>0&&si(e[1][0])))return null;a=pt(Di(e[1][0]),d)}for(let _=0;_<d;_++){const w=e[1][_];let M;if(mt(w)==="array")M=i.parse(w,void 0,a.itemType);else{const m=mt(w);if(m!==a.itemType.kind)return i.error(`Expected ${a.itemType.kind} but found ${m}.`);M=i.registry.literal.parse(["literal",w===void 0?null:w],i)}if(!M)return null;h.push(M)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");a=Wt[o];for(let d=1;d<e.length;d++){const _=i.parse(e[d],d,ni);if(!_)return null;h.push(_)}}return new hi(a,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const h of this.args){if(i=h.evaluate(e),o=null,i instanceof W)return i;if(typeof i=="string"){const a=e.parseColor(i);if(a)return a}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ki(i[0],i[1],i[2],i[3]),!o))return new W(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Hi(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Hi(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Nt.fromString(li(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?oi.build(li(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):li(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new An([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new fr(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const ln=["Unknown","Point","LineString","Polygon"];class bt{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ln[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=W.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class qt{constructor(e,i,o,h,a){this.name=e,this.type=i,this._evaluate=o,this.args=h,this._overloadIndex=a}evaluate(e){if(!this._evaluate){const i=qt.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],h=qt.definitions[o];if(!h)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const a=Array.isArray(h)?h[0]:h.type,d=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,_=[];let w=null,M=-1;for(const[m,E]of d){if(Array.isArray(m)&&m.length!==e.length-1)continue;_.push(m),M++,w=new ja(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const I=[];let b=!1;for(let T=1;T<e.length;T++){const A=e[T],k=Array.isArray(m)?m[T-1]:m.type,O=w.parse(A,1+I.length,k);if(!O){b=!0;break}I.push(O)}if(!b)if(Array.isArray(m)&&m.length!==I.length)w.error(`Expected ${m.length} arguments, but found ${I.length} instead.`);else{for(let T=0;T<I.length;T++){const A=Array.isArray(m)?m[T]:m.type,k=I[T];w.concat(T+1).checkSubtype(A,k.type)}if(w.errors.length===0)return new qt(o,a,E,I,M)}}if(_.length===1)i.errors.push(...w.errors);else{const m=(_.length?_:d.map(([I])=>I)).map(Lt).join(" | "),E=[];for(let I=1;I<e.length;I++){const b=i.parse(e[I],1+E.length);if(!b)return null;E.push(St(b.type))}i.error(`Expected arguments of type ${m}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){qt.definitions=i;for(const o in i)e[o]=qt}}function Lt(r){return Array.isArray(r)?`(${r.map(St).join(", ")})`:`(${St(r.type)}...)`}class Ai{constructor(e,i,o){this.type=wi,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const h=o["case-sensitive"]===void 0?i.parse(!1,1,nt):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",nt);if(!h)return null;const a=o["diacritic-sensitive"]===void 0?i.parse(!1,1,nt):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",nt);if(!a)return null;let d=null;return o.locale&&(d=i.parseObjectValue(o.locale,1,"locale",mi),!d)?null:new Ai(h,a,d)}evaluate(e){return new Ke(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Zi(r,e,i=0,o=r.length-1,h=Vi){for(;o>i;){if(o-i>600){const w=o-i+1,M=e-i+1,m=Math.log(w),E=.5*Math.exp(2*m/3),I=.5*Math.sqrt(m*E*(w-E)/w)*(M-w/2<0?-1:1);Zi(r,e,Math.max(i,Math.floor(e-M*E/w+I)),Math.min(o,Math.floor(e+(w-M)*E/w+I)),h)}const a=r[e];let d=i,_=o;for(Gi(r,i,e),h(r[o],a)>0&&Gi(r,i,o);d<_;){for(Gi(r,d,_),d++,_--;h(r[d],a)<0;)d++;for(;h(r[_],a)>0;)_--}h(r[i],a)===0?Gi(r,i,_):(_++,Gi(r,_,o)),_<=e&&(i=_+1),e<=_&&(o=_-1)}}function Gi(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}function Vi(r,e){return r<e?-1:r>e?1:0}function gn(r){let e=0;for(let i,o,h=0,a=r.length,d=a-1;h<a;d=h++)i=r[h],o=r[d],e+=(o.x-i.x)*(i.y+o.y);return e}function Nn(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function sn(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function nr(r,e,i){const o=r[0]-e[0],h=r[1]-e[1],a=r[0]-i[0],d=r[1]-i[1];return o*d-a*h==0&&o*a<=0&&h*d<=0}function Fn(r,e,i=!1){let o=!1;for(let _=0,w=e.length;_<w;_++){const M=e[_];for(let m=0,E=M.length,I=E-1;m<E;I=m++){const b=M[I],T=M[m];if(nr(r,b,T))return i;(a=b)[1]>(h=r)[1]!=(d=T)[1]>h[1]&&h[0]<(d[0]-a[0])*(h[1]-a[1])/(d[1]-a[1])+a[0]&&(o=!o)}}var h,a,d;return o}function or(r,e,i,o){const h=o[0]-i[0],a=o[1]-i[1],d=(r[0]-i[0])*a-h*(r[1]-i[1]),_=(e[0]-i[0])*a-h*(e[1]-i[1]);return d>0&&_<0||d<0&&_>0}function rr(r,e,i,o){return(h=[o[0]-i[0],o[1]-i[1]])[0]*(a=[e[0]-r[0],e[1]-r[1]])[1]-h[1]*a[0]!=0&&!(!or(r,e,i,o)||!or(i,o,r,e));var h,a}const tr=8192;function yr(r,e){const i=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*tr),Math.round(o*h*tr)]}function Wr(r,e){for(let i=0;i<e.length;i++)if(Fn(r,e[i]))return!0;return!1}function ss(r,e,i){for(const o of i)for(let h=0,a=o.length,d=a-1;h<a;d=h++)if(rr(r,e,o[d],o[h]))return!0;return!1}function Br(r,e){for(let i=0;i<r.length;++i)if(!Fn(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(ss(r[i],r[i+1],e))return!1;return!0}function Gr(r,e){for(let i=0;i<e.length;i++)if(Br(r,e[i]))return!0;return!1}function Ms(r,e,i){const o=[];for(let h=0;h<r.length;h++){const a=[];for(let d=0;d<r[h].length;d++){const _=yr(r[h][d],i);Nn(e,_),a.push(_)}o.push(a)}return o}function Os(r,e,i){const o=[];for(let h=0;h<r.length;h++){const a=Ms(r[h],e,i);o.push(a)}return o}function cr(r,e,i,o){if(r[0]<i[0]||r[0]>i[2]){const h=.5*o;let a=r[0]-i[0]>h?-o:i[0]-r[0]>h?o:0;a===0&&(a=r[0]-i[2]>h?-o:i[2]-r[0]>h?o:0),r[0]+=a}Nn(e,r)}function Ln(r,e,i,o){const h=Math.pow(2,o.z)*tr,a=[o.x*tr,o.y*tr],d=[];if(!r)return d;for(const _ of r)for(const w of _){const M=[w.x+a[0],w.y+a[1]];cr(M,e,i,h),d.push(M)}return d}function $s(r,e,i,o){const h=Math.pow(2,o.z)*tr,a=[o.x*tr,o.y*tr],d=[];if(!r)return d;for(const w of r){const M=[];for(const m of w){const E=[m.x+a[0],m.y+a[1]];Nn(e,E),M.push(E)}d.push(M)}if(e[2]-e[0]<=h/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const w of d)for(const M of w)cr(M,e,i,h)}var _;return d}class ar{constructor(e,i){this.type=nt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(si(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let h=0;h<o.features.length;++h){const a=o.features[h].geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new ar(o,o.features[h].geometry)}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ar(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ar(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const h=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(o.type==="Polygon"){const _=Ms(o.coordinates,a,d),w=Ln(i.geometry(),h,a,d);if(!sn(h,a))return!1;for(const M of w)if(!Fn(M,_))return!1}if(o.type==="MultiPolygon"){const _=Os(o.coordinates,a,d),w=Ln(i.geometry(),h,a,d);if(!sn(h,a))return!1;for(const M of w)if(!Wr(M,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const h=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(o.type==="Polygon"){const _=Ms(o.coordinates,a,d),w=$s(i.geometry(),h,a,d);if(!sn(h,a))return!1;for(const M of w)if(!Br(M,_))return!1}if(o.type==="MultiPolygon"){const _=Os(o.coordinates,a,d),w=$s(i.geometry(),h,a,d);if(!sn(h,a))return!1;for(const M of w)if(!Gr(M,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const po={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},lo=1/298.257223563,Qn=lo*(2-lo),Lo=Math.PI/180;class Go{static fromTile(e,i,o){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),a=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Lo;return new Go(a,o)}static get units(){return po}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!po[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(po).join(", ")}`);const o=6378.137*Lo*(i?po[i]:1),h=Math.cos(e*Lo),a=1/(1-Qn*(1-h*h)),d=Math.sqrt(a);this.kx=o*d*h,this.ky=o*d*a*(1-Qn)}distance(e,i){const o=Ro(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+h*h)}bearing(e,i){const o=Ro(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/Lo}destination(e,i,o){const h=o*Lo;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const h=e[o];for(let a=0,d=h.length,_=d-1;a<d;_=a++)i+=Ro(h[a][0]-h[_][0])*(h[a][1]+h[_][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const a=e[h],d=e[h+1],_=this.distance(a,d);if(o+=_,o>i)return Ca(a,d,(i-(o-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[h,a]=i,d=Ro(o[0]-h)*this.kx,_=(o[1]-a)*this.ky;if(d!==0||_!==0){const w=(Ro(e[0]-h)*this.kx*d+(e[1]-a)*this.ky*_)/(d*d+_*_);w>1?(h=o[0],a=o[1]):w>0&&(h+=d/this.kx*w,a+=_/this.ky*w)}return d=Ro(e[0]-h)*this.kx,_=(e[1]-a)*this.ky,Math.sqrt(d*d+_*_)}pointOnLine(e,i){let o=1/0,h=e[0][0],a=e[0][1],d=0,_=0;for(let w=0;w<e.length-1;w++){let M=e[w][0],m=e[w][1],E=Ro(e[w+1][0]-M)*this.kx,I=(e[w+1][1]-m)*this.ky,b=0;E===0&&I===0||(b=(Ro(i[0]-M)*this.kx*E+(i[1]-m)*this.ky*I)/(E*E+I*I),b>1?(M=e[w+1][0],m=e[w+1][1]):b>0&&(M+=E/this.kx*b,m+=I/this.ky*b)),E=Ro(i[0]-M)*this.kx,I=(i[1]-m)*this.ky;const T=E*E+I*I;T<o&&(o=T,h=M,a=m,d=w,_=b)}return{point:[h,a],index:d,t:Math.max(0,Math.min(1,_))}}lineSlice(e,i,o){let h=this.pointOnLine(o,e),a=this.pointOnLine(o,i);if(h.index>a.index||h.index===a.index&&h.t>a.t){const M=h;h=a,a=M}const d=[h.point],_=h.index+1,w=a.index;!Aa(o[_],d[0])&&_<=w&&d.push(o[_]);for(let M=_+1;M<=w;M++)d.push(o[M]);return Aa(o[w],a.point)||d.push(a.point),d}lineSliceAlong(e,i,o){let h=0;const a=[];for(let d=0;d<o.length-1;d++){const _=o[d],w=o[d+1],M=this.distance(_,w);if(h+=M,h>e&&a.length===0&&a.push(Ca(_,w,(e-(h-M))/M)),h>=i)return a.push(Ca(_,w,(i-(h-M))/M)),a;h>e&&a.push(w)}return a}bufferPoint(e,i){const o=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-o,e[0]+h,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-o,e[2]+h,e[3]+o]}insideBBox(e,i){return Ro(e[0]-i[0])>=0&&Ro(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Aa(r,e){return r[0]===e[0]&&r[1]===e[1]}function Ca(r,e,i){const o=Ro(e[0]-r[0]);return[r[0]+o*i,r[1]+(e[1]-r[1])*i]}function Ro(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class Eo{constructor(e=[],i=(o,h)=>o<h?-1:o>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,h=i[e];for(;e>0;){const a=e-1>>1,d=i[a];if(o(h,d)>=0)break;i[e]=d,e=a}i[e]=h}_down(e){const{data:i,compare:o}=this,h=this.length>>1,a=i[e];for(;e<h;){let d=1+(e<<1);const _=d+1;if(_<this.length&&o(i[_],i[d])<0&&(d=_),o(i[d],a)>=0)break;i[e]=i[d],e=d}i[e]=a}}var mn=8192;function ol(r,e){return e.dist-r.dist}const $a=100,Pa=50;function La(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function _o(r){return r[1]-r[0]+1}function Qo(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Wa(r,e){if(r[0]>r[1])return[null,null];const i=_o(r);if(e){if(i===2)return[r,null];const o=Math.floor(i/2);return[[r[0],r[0]+o],[r[0]+o,r[1]]]}{if(i===1)return[r,null];const o=Math.floor(i/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}}function va(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!Qo(e,r.length))return i;for(let o=e[0];o<=e[1];++o)Nn(i,r[o]);return i}function xa(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let o=0;o<r[i].length;++o)Nn(e,r[i][o]);return e}function ua(r,e,i){if(La(r)||La(e))return NaN;let o=0,h=0;return r[2]<e[0]&&(o=e[0]-r[2]),r[0]>e[2]&&(o=r[0]-e[2]),r[1]>e[3]&&(h=r[1]-e[3]),r[3]<e[1]&&(h=e[1]-r[3]),i.distance([0,0],[o,h])}function Ns(r){return 360*r-180}function wa(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Il(r,e){const i=Math.pow(2,e.z),o=(r.y/mn+e.y)/i;return[Ns((r.x/mn+e.x)/i),wa(o)]}function Ml(r,e){const i=[];for(let o=0;o<r.length;++o)i.push(Il(r[o],e));return i}function oa(r,e,i){const o=i.pointOnLine(e,r).point;return i.distance(r,o)}function ea(r,e,i,o,h){const a=i.slice(o[0],o[1]+1);let d=1/0;for(let _=e[0];_<=e[1];++_)if((d=Math.min(d,oa(r[_],a,h)))===0)return 0;return d}function v(r,e,i,o,h){const a=Math.min(h.pointToSegmentDistance(r,i,o),h.pointToSegmentDistance(e,i,o)),d=Math.min(h.pointToSegmentDistance(i,r,e),h.pointToSegmentDistance(o,r,e));return Math.min(a,d)}function c(r,e,i,o,h){if(!Qo(e,r.length)||!Qo(o,i.length))return NaN;let a=1/0;for(let d=e[0];d<e[1];++d)for(let _=o[0];_<o[1];++_){if(rr(r[d],r[d+1],i[_],i[_+1]))return 0;a=Math.min(a,v(r[d],r[d+1],i[_],i[_+1],h))}return a}function f(r,e,i,o,h){if(!Qo(e,r.length)||!Qo(o,i.length))return NaN;let a=1/0;for(let d=e[0];d<=e[1];++d)for(let _=o[0];_<=o[1];++_)if((a=Math.min(a,h.distance(r[d],i[_])))===0)return a;return a}function y(r,e,i){if(Fn(r,e,!0))return 0;let o=1/0;for(const h of e){const a=h.length;if(a<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[a-1]&&(o=Math.min(o,i.pointToSegmentDistance(r,h[a-1],h[0])))===0||(o=Math.min(o,oa(r,h,i)))===0)return o}return o}function P(r,e,i,o){if(!Qo(e,r.length))return NaN;for(let a=e[0];a<=e[1];++a)if(Fn(r[a],i,!0))return 0;let h=1/0;for(let a=e[0];a<e[1];++a)for(const d of i)for(let _=0,w=d.length,M=w-1;_<w;M=_++){if(rr(r[a],r[a+1],d[M],d[_]))return 0;h=Math.min(h,v(r[a],r[a+1],d[M],d[_],o))}return h}function F(r,e){for(const i of r)for(let o=0;o<=i.length-1;++o)if(Fn(i[o],e,!0))return!0;return!1}function Z(r,e,i,o=1/0){const h=xa(r),a=xa(e);if(o!==1/0&&ua(h,a,i)>=o)return o;if(sn(h,a)){if(F(r,e))return 0}else if(F(e,r))return 0;let d=o;for(const _ of r)for(let w=0,M=_.length,m=M-1;w<M;m=w++)for(const E of e)for(let I=0,b=E.length,T=b-1;I<b;T=I++){if(rr(_[m],_[w],E[T],E[I]))return 0;d=Math.min(d,v(_[m],_[w],E[T],E[I],i))}return d}function re(r,e,i,o,h,a,d){if(a===null||d===null)return;const _=ua(va(o,a),va(h,d),i);_<e&&r.push({dist:_,range1:a,range2:d})}function Te(r,e,i,o,h=1/0){let a=Math.min(o.distance(r[0],i[0][0]),h);if(a===0)return a;const d=new Eo([{dist:0,range1:[0,r.length-1],range2:[0,0]}],ol),_=e?Pa:$a,w=xa(i);for(;d.length;){const M=d.pop();if(M.dist>=a)continue;const m=M.range1;if(_o(m)<=_){if(!Qo(m,r.length))return NaN;if(e){const E=P(r,m,i,o);if((a=Math.min(a,E))===0)return a}else for(let E=m[0];E<=m[1];++E){const I=y(r[E],i,o);if((a=Math.min(a,I))===0)return a}}else{const E=Wa(m,e);if(E[0]!==null){const I=ua(va(r,E[0]),w,o);I<a&&d.push({dist:I,range1:E[0],range2:[0,0]})}if(E[1]!==null){const I=ua(va(r,E[1]),w,o);I<a&&d.push({dist:I,range1:E[1],range2:[0,0]})}}}return a}function Xe(r,e,i,o,h,a=1/0){let d=Math.min(a,h.distance(r[0],i[0]));if(d===0)return d;const _=new Eo([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],ol),w=e?Pa:$a,M=o?Pa:$a;for(;_.length;){const m=_.pop();if(m.dist>=d)continue;const E=m.range1,I=m.range2;if(_o(E)<=w&&_o(I)<=M){if(!Qo(E,r.length)||!Qo(I,i.length))return NaN;if(e&&o?d=Math.min(d,c(r,E,i,I,h)):e||o?e&&!o?d=Math.min(d,ea(i,I,r,E,h)):!e&&o&&(d=Math.min(d,ea(r,E,i,I,h))):d=Math.min(d,f(r,E,i,I,h)),d===0)return d}else{const b=Wa(E,e),T=Wa(I,o);re(_,d,h,r,i,b[0],T[0]),re(_,d,h,r,i,b[0],T[1]),re(_,d,h,r,i,b[1],T[0]),re(_,d,h,r,i,b[1],T[1])}}return d}function Yt(r,e,i,o,h=1/0){let a=h;const d=va(r,[0,r.length-1]);for(const _ of i)if(!(a!==1/0&&ua(d,va(_,[0,_.length-1]),o)>=a)&&(a=Math.min(a,Xe(r,e,_,!0,o,a)),a===0))return a;return a}function Si(r,e,i,o,h=1/0){let a=h;const d=va(r,[0,r.length-1]);for(const _ of i){if(a!==1/0&&ua(d,xa(_),o)>=a)continue;const w=Te(r,e,_,o,a);if(isNaN(w))return w;if((a=Math.min(a,w))===0)return a}return a}function bn(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Jn{constructor(e,i){this.type=ft,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(si(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let h=0;h<o.features.length;++h)if(bn(o.features[h].geometry.type))return new Jn(o,o.features[h].geometry)}else if(o.type==="Feature"){if(bn(o.geometry.type))return new Jn(o,o.geometry)}else if(bn(o.type))return new Jn(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(h,a,d){const _=[];for(const M of h)for(const m of M)_.push(Il(m,a));const w=new Go(_[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?Xe(_,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",w):d.type==="MultiLineString"?Yt(_,!1,d.coordinates,w):d.type==="Polygon"||d.type==="MultiPolygon"?Si(_,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,w):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(h,a,d){const _=[];for(const M of h){const m=[];for(const E of M)m.push(Il(E,a));_.push(m)}const w=new Go(_[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Yt(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",_,w);if(d.type==="MultiLineString"){let M=1/0;for(let m=0;m<d.coordinates.length;m++){const E=Yt(d.coordinates[m],!0,_,w,M);if(isNaN(E))return E;if((M=Math.min(M,E))===0)return M}return M}if(d.type==="Polygon"||d.type==="MultiPolygon"){let M=1/0;for(let m=0;m<_.length;m++){const E=Si(_[m],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,w,M);if(isNaN(E))return E;if((M=Math.min(M,E))===0)return M}return M}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(h,a,d){const _=[];for(const M of function(m,E){const I=m.length;if(I<=1)return[m];const b=[];let T,A;for(let k=0;k<I;k++){const O=gn(m[k]);O!==0&&(m[k].area=Math.abs(O),A===void 0&&(A=O<0),A===O<0?(T&&b.push(T),T=[m[k]]):T.push(m[k]))}return T&&b.push(T),b}(h)){const m=[];for(let E=0;E<M.length;++E)m.push(Ml(M[E],a));_.push(m)}const w=new Go(_[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Si(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",_,w);if(d.type==="MultiLineString"){let M=1/0;for(let m=0;m<d.coordinates.length;m++){const E=Si(d.coordinates[m],!0,_,w,M);if(isNaN(E))return E;if((M=Math.min(M,E))===0)return M}return M}return d.type==="Polygon"||d.type==="MultiPolygon"?function(M,m,E){let I=1/0;for(const b of M)for(const T of m){const A=Z(b,T,E,I);if(isNaN(A))return A;if((I=Math.min(I,A))===0)return I}return I}(d.type==="Polygon"?[d.coordinates]:d.coordinates,_,w):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function br(r,e){switch(r){case"string":return li(e);case"number":return+e;case"boolean":return!!e;case"color":return W.parse(e);case"formatted":return Nt.fromString(li(e));case"resolvedImage":return oi.build(li(e))}return e}function Dr(r,e,i,o){return o!==void 0&&(r=o*Math.round(r/o)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class ts{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=ni),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof Oi))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const a=i.parse(e[2],2);return a instanceof Oi?new ts(o,li(h.value),li(a.value)):i.error("Scope of 'config' expression must be a string literal.")}return new ts(o,li(h.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:h,value:a,values:d,minValue:_,maxValue:w,stepValue:M}=o,m=o.default.evaluate(e);let E=m;if(a){const I=e.scope;e.scope=(I||"").split("").slice(1).join(""),E=a.evaluate(e),e.scope=I}return h&&(E=br(h,E)),E===void 0||_===void 0&&w===void 0&&M===void 0||(typeof E=="number"?E=Dr(E,_,w,M):Array.isArray(E)&&(E=E.map(I=>typeof I=="number"?Dr(I,_,w,M):I))),a!==void 0&&E!==void 0&&d&&!d.includes(E)&&(E=m,h&&(E=br(h,E))),(h&&h!==this.type||E!==void 0&&Di(E)!==this.type)&&(E=br(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function os(r){if(r instanceof qt&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof ar||r instanceof Jn)return!1;let e=!0;return r.eachChild(i=>{e&&!os(i)&&(e=!1)}),e}function Ds(r){if(r instanceof qt&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!Ds(i)&&(e=!1)}),e}function mo(r){if(r instanceof ts)return new Set([r.key]);let e=new Set;return r.eachChild(i=>{e=new Set([...e,...mo(i)])}),e}function uo(r,e){if(r instanceof qt&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(o=>{i&&!uo(o,e)&&(i=!1)}),i}class ta{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new ta(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ga{constructor(e,i=[],o,h=new pr,a=[],d,_){this.registry=e,this.path=i,this.key=i.map(w=>typeof w=="string"?`['${w}']`:`[${w}]`).join(""),this.scope=h,this.errors=a,this.expectedType=o,this._scope=d,this.options=_}parse(e,i,o,h,a={}){return i||o?this.concat(i,null,o,h)._parse(e,a):this._parse(e,a)}parseObjectValue(e,i,o,h,a,d={}){return this.concat(i,o,h,a)._parse(e,d)}_parse(e,i){function o(h,a,d){return d==="assert"?new On(a,[h]):d==="coerce"?new hi(a,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let a=h.parse(e,this);if(!a)return null;if(this.expectedType){const d=this.expectedType,_=a.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||_.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(d,_))return null}else a=o(a,d,i.typeAnnotation||"coerce");else a=o(a,d,i.typeAnnotation||"assert")}if(!(a instanceof Oi)&&a.type.kind!=="resolvedImage"&&al(a)){const d=new bt(this._scope,this.options);try{a=new Oi(a.type,a.evaluate(d))}catch(_){return this.error(_.message),null}}return a}return hi.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,h){let a=typeof e=="number"?this.path.concat(e):this.path;a=typeof i=="string"?a.concat(i):a;const d=h?this.scope.concat(h):this.scope;return new ga(this.registry,a,o||null,d,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new yn(o,e))}checkSubtype(e,i){const o=At(e,i);return o&&this.error(o),o}}var ja=ga;function al(r){if(r instanceof ta)return al(r.boundExpression);if(r instanceof qt&&r.name==="error"||r instanceof Ai||r instanceof ar||r instanceof Jn||r instanceof ts)return!1;const e=r instanceof hi||r instanceof On;let i=!0;return r.eachChild(o=>{i=e?i&&al(o):i&&o instanceof Oi}),!!i&&os(r)&&uo(r,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ya(r,e){const i=r.length-1;let o,h,a=0,d=i,_=0;for(;a<=d;)if(_=Math.floor((a+d)/2),o=r[_],h=r[_+1],o<=e){if(_===i||e<h)return _;a=_+1}else{if(!(o>e))throw new Hi("Input is not a number.");d=_-1}return 0}class Ra{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,a]of o)this.labels.push(h),this.outputs.push(a)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,ft);if(!o)return null;const h=[];let a=null;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);for(let d=1;d<e.length;d+=2){const _=d===1?-1/0:e[d],w=e[d+1],M=d,m=d+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(h.length&&h[h.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const E=i.parse(w,m,a);if(!E)return null;a=a||E.type,h.push([_,E])}return new Ra(a,o,h)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const a=i.length;return h>=i[a-1]?o[a-1].evaluate(e):o[Ya(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const ka=.95047,jr=1.08883,ll=4/29,Oa=6/29,iu=3*Oa*Oa,ul=Oa*Oa*Oa,vu=Math.PI/180,Gs=180/Math.PI;function cl(r){return r>ul?Math.pow(r,1/3):r/iu+ll}function nu(r){return r>Oa?r*r*r:iu*(r-ll)}function Ka(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function xu(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function ql(r){const e=xu(r.r),i=xu(r.g),o=xu(r.b),h=cl((.4124564*e+.3575761*i+.1804375*o)/ka),a=cl((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*a-16,a:500*(h-a),b:200*(a-cl((.0193339*e+.119192*i+.9503041*o)/jr)),alpha:r.a}}function Al(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,o=isNaN(r.b)?e:e-r.b/200;return e=1*nu(e),i=ka*nu(i),o=jr*nu(o),new W(Ka(3.2404542*i-1.5371385*e-.4985314*o),Ka(-.969266*i+1.8760108*e+.041556*o),Ka(.0556434*i-.2040259*e+1.0572252*o),r.alpha)}function ru(r,e,i){const o=e-r;return r+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Cl={forward:ql,reverse:Al,interpolate:function(r,e,i){return{l:Ye(r.l,e.l,i),a:Ye(r.a,e.a,i),b:Ye(r.b,e.b,i),alpha:Ye(r.alpha,e.alpha,i)}}},Ja={forward:function(r){const{l:e,a:i,b:o}=ql(r),h=Math.atan2(o,i)*Gs;return{h:h<0?h+360:h,c:Math.sqrt(i*i+o*o),l:e,alpha:r.a}},reverse:function(r){const e=r.h*vu,i=r.c;return Al({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:ru(r.h,e.h,i),c:Ye(r.c,e.c,i),l:Ye(r.l,e.l,i),alpha:Ye(r.alpha,e.alpha,i)}}};var bu=Object.freeze({__proto__:null,hcl:Ja,lab:Cl});class ia{constructor(e,i,o,h,a,d){this.type=e,this.operator=i,this.interpolation=o,this.input=h,this.dynamicStops=a,this.labels=[],this.outputs=[];for(const[_,w]of d)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(e,i,o,h){let a=0;if(e.name==="exponential")a=su(i,e.base,o,h);else if(e.name==="linear")a=su(i,1,o,h);else if(e.name==="cubic-bezier"){const d=e.controlPoints;a=new lt(d[0],d[1],d[2],d[3]).solve(su(i,1,o,h))}return a}static parse(e,i){let[o,h,a,...d]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const M=h[1];if(typeof M!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:M}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const M=h.slice(1);if(M.length!==4||M.some(m=>typeof m!="number"||m<0||m>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<3)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(a=i.parse(a,2,ft),!a)return null;const _=[];let w=null;if(o==="interpolate-hcl"||o==="interpolate-lab"?w=jt:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType),e.length-1==3){const M=i.parse(d[0],3,ni);return M?new ia(w,o,h,a,M,_):null}for(let M=0;M<d.length;M+=2){const m=d[M],E=d[M+1],I=M+3,b=M+4;if(typeof m!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(_.length&&_[_.length-1][0]>=m)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const T=i.parse(E,b,w);if(!T)return null;w=w||T.type,_.push([m,T])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new ia(w,o,h,a,null,_):i.error(`Type ${St(w)} is not interpolatable.`)}evaluate(e){let i=this.labels,o=this.outputs;if(this.dynamicStops){const m=this.dynamicStops.evaluate(e);if(m.length%2!=0)throw new Hi("Expected an even number of arguments.");i=[],o=[];for(let E=0;E<m.length;E+=2){const I=m[E],b=new Oi(ft,m[E+1]);if(typeof I!="number")throw new Hi('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(i.length&&i[i.length-1]>=I)throw new Hi('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');i.push(I),o.push(b)}if(i.length===0)throw new Hi("Expected at least one input/output pair.")}if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const a=i.length;if(h>=i[a-1])return o[a-1].evaluate(e);const d=Ya(i,h),_=ia.interpolationFactor(this.interpolation,h,i[d],i[d+1]),w=o[d].evaluate(e),M=o[d+1].evaluate(e);return this.operator==="interpolate"?Ei[this.type.kind.toLowerCase()](w,M,_):this.operator==="interpolate-hcl"?Ja.reverse(Ja.interpolate(Ja.forward(w),Ja.forward(M),_)):Cl.reverse(Cl.interpolate(Cl.forward(w),Cl.forward(M),_))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];if(this.dynamicStops)i.push(this.dynamicStops.serialize());else for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function su(r,e,i,o){const h=o-i,a=r-i;return h===0?0:e===1?a/h:(Math.pow(e,a)-1)/(Math.pow(e,h)-1)}class hl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const h=i.expectedType;h&&h.kind!=="value"&&(o=h);const a=[];for(const _ of e.slice(1)){const w=i.parse(_,1+a.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,a.push(w)}const d=h&&a.some(_=>At(h,_.type));return new hl(d?ni:o,a)}evaluate(e){let i,o=null,h=0;for(const a of this.args){if(h++,o=a.evaluate(e),o&&o instanceof oi&&!o.available&&(i||(i=o),o=null,h===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ou{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let a=1;a<e.length-1;a+=2){const d=e[a];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,a);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",a);const _=i.parse(e[a+1],a+1);if(!_)return null;o.push([d,_])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return h?new ou(o,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class dl{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ft),h=i.parse(e[2],2,pt(i.expectedType||ni));return o&&h?new dl(h.type.itemType,o,h):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Hi(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new Hi(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const h=Math.floor(i),a=Math.ceil(i),d=o[h],_=o[a];if(typeof d!="number"||typeof _!="number")throw new Hi(`Cannot interpolate between non-number values at index ${i}.`);const w=i-h;return d*(1-w)+_*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class wu{constructor(e,i){this.type=nt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ni),h=i.parse(e[2],2,ni);return o&&h?kt(o.type,[nt,mi,ft,Er,ni])?new wu(o,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${St(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Ci(i,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${St(Di(i))} instead.`);if(!Ci(o,["string","array"]))throw new Hi(`Expected second argument to be of type array or string, but found ${St(Di(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Pl{constructor(e,i,o){this.type=ft,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ni),h=i.parse(e[2],2,ni);if(!o||!h)return null;if(!kt(o.type,[nt,mi,ft,Er,ni]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${St(o.type)} instead`);if(e.length===4){const a=i.parse(e[3],3,ft);return a?new Pl(o,h,a):null}return new Pl(o,h)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ci(i,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${St(Di(i))} instead.`);if(!Ci(o,["string","array"]))throw new Hi(`Expected second argument to be of type array or string, but found ${St(Di(o))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return o.indexOf(i,h)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Eu{constructor(e,i,o,h,a,d){this.inputType=e,this.type=i,this.input=o,this.cases=h,this.outputs=a,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const a={},d=[];for(let M=2;M<e.length-1;M+=2){let m=e[M];const E=e[M+1];Array.isArray(m)||(m=[m]);const I=i.concat(M);if(m.length===0)return I.error("Expected at least one branch label.");for(const T of m){if(typeof T!="number"&&typeof T!="string")return I.error("Branch labels must be numbers or strings.");if(typeof T=="number"&&Math.abs(T)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof T=="number"&&Math.floor(T)!==T)return I.error("Numeric branch labels must be integer values.");if(o){if(I.checkSubtype(o,Di(T)))return null}else o=Di(T);if(a[String(T)]!==void 0)return I.error("Branch labels must be unique.");a[String(T)]=d.length}const b=i.parse(E,M,h);if(!b)return null;h=h||b.type,d.push(b)}const _=i.parse(e[1],1,ni);if(!_)return null;const w=i.parse(e[e.length-1],e.length-1,h);return w?_.type.kind!=="value"&&i.concat(1).checkSubtype(o,_.type)?null:new Eu(o,h,_,a,d,w):null}evaluate(e){const i=this.input.evaluate(e);return(Di(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],h={};for(const d of i){const _=h[this.cases[d]];_===void 0?(h[this.cases[d]]=o.length,o.push([this.cases[d],[d]])):o[_][1].push(d)}const a=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,_]of o)e.push(_.length===1?a(_[0]):_.map(a)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class Ea{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const h=[];for(let d=1;d<e.length-1;d+=2){const _=i.parse(e[d],d,nt);if(!_)return null;const w=i.parse(e[d+1],d+1,o);if(!w)return null;h.push([_,w]),o=o||w.type}const a=i.parse(e[e.length-1],e.length-1,o);return a?new Ea(o,h,a):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Hl{constructor(e,i,o,h){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ni),h=i.parse(e[2],2,ft);if(!o||!h)return null;if(!kt(o.type,[pt(ni),mi,ni]))return i.error(`Expected first argument to be of type array or string, but found ${St(o.type)} instead`);if(e.length===4){const a=i.parse(e[3],3,ft);return a?new Hl(o.type,o,h,a):null}return new Hl(o.type,o,h)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Ci(i,["string","array"]))throw new Hi(`Expected first argument to be of type array or string, but found ${St(Di(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(o,h)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function au(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Tu(r,e,i,o){return o.compare(e,i)===0}function qa(r,e,i){const o=r!=="=="&&r!=="!=";return class Ly{constructor(a,d,_){this.type=nt,this.lhs=a,this.rhs=d,this.collator=_,this.hasUntypedArgument=a.type.kind==="value"||d.type.kind==="value"}static parse(a,d){if(a.length!==3&&a.length!==4)return d.error("Expected two or three arguments.");const _=a[0];let w=d.parse(a[1],1,ni);if(!w)return null;if(!au(_,w.type))return d.concat(1).error(`"${_}" comparisons are not supported for type '${St(w.type)}'.`);let M=d.parse(a[2],2,ni);if(!M)return null;if(!au(_,M.type))return d.concat(2).error(`"${_}" comparisons are not supported for type '${St(M.type)}'.`);if(w.type.kind!==M.type.kind&&w.type.kind!=="value"&&M.type.kind!=="value")return d.error(`Cannot compare types '${St(w.type)}' and '${St(M.type)}'.`);o&&(w.type.kind==="value"&&M.type.kind!=="value"?w=new On(M.type,[w]):w.type.kind!=="value"&&M.type.kind==="value"&&(M=new On(w.type,[M])));let m=null;if(a.length===4){if(w.type.kind!=="string"&&M.type.kind!=="string"&&w.type.kind!=="value"&&M.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(m=d.parse(a[3],3,wi),!m)return null}return new Ly(w,M,m)}evaluate(a){const d=this.lhs.evaluate(a),_=this.rhs.evaluate(a);if(o&&this.hasUntypedArgument){const w=Di(d),M=Di(_);if(w.kind!==M.kind||w.kind!=="string"&&w.kind!=="number")throw new Hi(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${w.kind}, ${M.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=Di(d),M=Di(_);if(w.kind!=="string"||M.kind!=="string")return e(a,d,_)}return this.collator?i(a,d,_,this.collator.evaluate(a)):e(a,d,_)}eachChild(a){a(this.lhs),a(this.rhs),this.collator&&a(this.collator)}outputDefined(){return!0}serialize(){const a=[r];return this.eachChild(d=>{a.push(d.serialize())}),a}}}const lu=qa("==",function(r,e,i){return e===i},Tu),Qa=qa("!=",function(r,e,i){return e!==i},function(r,e,i,o){return!Tu(0,e,i,o)}),Su=qa("<",function(r,e,i){return e<i},function(r,e,i,o){return o.compare(e,i)<0}),Yu=qa(">",function(r,e,i){return e>i},function(r,e,i,o){return o.compare(e,i)>0}),Ku=qa("<=",function(r,e,i){return e<=i},function(r,e,i,o){return o.compare(e,i)<=0}),Iu=qa(">=",function(r,e,i){return e>=i},function(r,e,i,o){return o.compare(e,i)>=0});class fl{constructor(e,i,o,h,a,d){this.type=mi,this.number=e,this.locale=i,this.currency=o,this.unit=h,this.minFractionDigits=a,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,ft);if(!o)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let a=null;if(h.locale&&(a=i.parseObjectValue(h.locale,2,"locale",mi),!a))return null;let d=null;if(h.currency&&(d=i.parseObjectValue(h.currency,2,"currency",mi),!d))return null;let _=null;if(h.unit&&(_=i.parseObjectValue(h.unit,2,"unit",mi),!_))return null;let w=null;if(h["min-fraction-digits"]&&(w=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",ft),!w))return null;let M=null;return h["max-fraction-digits"]&&(M=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",ft),!M)?null:new fl(o,a,d,_,w,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Zl{constructor(e){this.type=ft,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${St(o.type)} instead.`):new Zl(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Hi(`Expected value to be of type string or array, but found ${St(Di(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Ll(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Je={"==":lu,"!=":Qa,">":Yu,"<":Su,">=":Iu,"<=":Ku,array:On,at:dl,boolean:On,case:Ea,coalesce:hl,collator:Ai,format:An,image:fr,in:wu,"index-of":Pl,interpolate:ia,"interpolate-hcl":ia,"interpolate-lab":ia,length:Zl,let:ou,literal:Oi,match:Eu,number:On,"number-format":fl,object:On,slice:Hl,step:Ra,string:On,"to-boolean":hi,"to-color":hi,"to-number":hi,"to-string":hi,var:ta,within:ar,distance:Jn,config:ts};function ri(r,[e,i,o,h]){e=e.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const a=h?h.evaluate(r):1,d=Ki(e,i,o,a);if(d)throw new Hi(d);return new W(e/255*a,i/255*a,o/255*a,a)}function In(r,[e,i,o,h]){e=e.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const a=h?h.evaluate(r):1,d=function(M,m,E,I){return typeof M=="number"&&M>=0&&M<=360?typeof m=="number"&&m>=0&&m<=100&&typeof E=="number"&&E>=0&&E<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[M,m,E,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[M,m,E,I]:[M,m,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[M,m,E,I]:[M,m,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,a);if(d)throw new Hi(d);const _=`hsla(${e}, ${i}%, ${o}%, ${a})`,w=W.parse(_);if(!w)throw new Hi(`Failed to parse HSLA color: ${_}`);return w}function j(r,e){return r in e}function Q(r,e){const i=e[r];return i===void 0?null:i}function ae(r){return{type:r}}function ge(r){return{result:"success",value:r}}function Oe(r){return{result:"error",value:r}}function rt(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Rt(r){return r["property-type"]==="data-driven"}function gi(r){return rt(r.expression,"measure-light")}function Ni(r){return rt(r.expression,"zoom")}function qi(r){return!!r.expression&&r.expression.interpolated}function ii(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Bi(r){return r}function xi(r,e){const i=e.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",h=o||!(o||r.property!==void 0),a=r.type||(qi(e)?"exponential":"interval");if(i&&((r=Pn({},r)).stops&&(r.stops=r.stops.map(M=>[M[0],W.parse(M[1])])),r.default=W.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!bu[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let d,_,w;if(a==="exponential")d=vr;else if(a==="interval")d=Zn;else if(a==="categorical"){d=pn,_=Object.create(null);for(const M of r.stops)_[M[0]]=M[1];w=typeof r.stops[0][0]}else{if(a!=="identity")throw new Error(`Unknown function type "${a}"`);d=Lr}if(o){const M={},m=[];for(let b=0;b<r.stops.length;b++){const T=r.stops[b],A=T[0].zoom;M[A]===void 0&&(M[A]={zoom:A,type:r.type,property:r.property,default:r.default,stops:[]},m.push(A)),M[A].stops.push([T[0].value,T[1]])}const E=[];for(const b of m)E.push([M[b].zoom,xi(M[b],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:ia.interpolationFactor.bind(void 0,I),zoomStops:E.map(b=>b[0]),evaluate:({zoom:b},T)=>vr({stops:E,base:r.base},e,b).evaluate(b,T)}}if(h){const M=a==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:ia.interpolationFactor.bind(void 0,M),zoomStops:r.stops.map(m=>m[0]),evaluate:({zoom:m})=>d(r,e,m,_,w)}}return{kind:"source",evaluate(M,m){const E=m&&m.properties?m.properties[r.property]:void 0;return E===void 0?Ji(r.default,e.default):d(r,e,E,_,w)}}}function Ji(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function pn(r,e,i,o,h){return Ji(typeof i===h?o[i]:void 0,r.default,e.default)}function Zn(r,e,i){if(mt(i)!=="number")return Ji(r.default,e.default);const o=r.stops.length;if(o===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[o-1][0])return r.stops[o-1][1];const h=Ya(r.stops.map(a=>a[0]),i);return r.stops[h][1]}function vr(r,e,i){const o=r.base!==void 0?r.base:1;if(mt(i)!=="number")return Ji(r.default,e.default);const h=r.stops.length;if(h===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[h-1][0])return r.stops[h-1][1];const a=Ya(r.stops.map(m=>m[0]),i),d=function(m,E,I,b){const T=b-I,A=m-I;return T===0?0:E===1?A/T:(Math.pow(E,A)-1)/(Math.pow(E,T)-1)}(i,o,r.stops[a][0],r.stops[a+1][0]),_=r.stops[a][1],w=r.stops[a+1][1];let M=Ei[e.type]||Bi;if(r.colorSpace&&r.colorSpace!=="rgb"){const m=bu[r.colorSpace];M=(E,I)=>m.reverse(m.interpolate(m.forward(E),m.forward(I),d))}return typeof _.evaluate=="function"?{evaluate(...m){const E=_.evaluate.apply(void 0,m),I=w.evaluate.apply(void 0,m);if(E!==void 0&&I!==void 0)return M(E,I,d)}}:M(_,w,d)}function Lr(r,e,i){return e.type==="color"?i=W.parse(i):e.type==="formatted"?i=Nt.fromString(i.toString()):e.type==="resolvedImage"?i=oi.build(i.toString()):mt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Ji(i,r.default,e.default)}qt.register(Je,{error:[{kind:"error"},[mi],(r,[e])=>{throw new Hi(e.evaluate(r))}],typeof:[mi,[ni],(r,[e])=>St(Di(e.evaluate(r)))],"to-rgba":[pt(ft,4),[jt],(r,[e])=>e.evaluate(r).toRenderColor(null).toArray()],"to-hsla":[pt(ft,4),[jt],(r,[e])=>e.evaluate(r).toRenderColor(null).toHslaArray()],rgb:[jt,[ft,ft,ft],ri],rgba:[jt,[ft,ft,ft,ft],ri],hsl:[jt,[ft,ft,ft],In],hsla:[jt,[ft,ft,ft,ft],In],has:{type:nt,overloads:[[[mi],(r,[e])=>j(e.evaluate(r),r.properties())],[[mi,Ti],(r,[e,i])=>j(e.evaluate(r),i.evaluate(r))]]},get:{type:ni,overloads:[[[mi],(r,[e])=>Q(e.evaluate(r),r.properties())],[[mi,Ti],(r,[e,i])=>Q(e.evaluate(r),i.evaluate(r))]]},"feature-state":[ni,[mi],(r,[e])=>Q(e.evaluate(r),r.featureState||{})],properties:[Ti,[],r=>r.properties()],"geometry-type":[mi,[],r=>r.geometryType()],id:[ni,[],r=>r.id()],zoom:[ft,[],r=>r.globals.zoom],pitch:[ft,[],r=>r.globals.pitch||0],"distance-from-center":[ft,[],r=>r.distanceFromCenter()],"measure-light":[ft,[mi],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[ft,[],r=>r.globals.heatmapDensity||0],"line-progress":[ft,[],r=>r.globals.lineProgress||0],"raster-value":[ft,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[ft,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[ft,[],r=>r.globals.skyRadialProgress||0],accumulated:[ni,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[ft,ae(ft),(r,e)=>{let i=0;for(const o of e)i+=o.evaluate(r);return i}],"*":[ft,ae(ft),(r,e)=>{let i=1;for(const o of e)i*=o.evaluate(r);return i}],"-":{type:ft,overloads:[[[ft,ft],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[ft],(r,[e])=>-e.evaluate(r)]]},"/":[ft,[ft,ft],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[ft,[ft,ft],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[ft,[],()=>Math.LN2],pi:[ft,[],()=>Math.PI],e:[ft,[],()=>Math.E],"^":[ft,[ft,ft],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[ft,[ft],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[ft,[ft],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[ft,[ft],(r,[e])=>Math.log(e.evaluate(r))],log2:[ft,[ft],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[ft,[ft],(r,[e])=>Math.sin(e.evaluate(r))],cos:[ft,[ft],(r,[e])=>Math.cos(e.evaluate(r))],tan:[ft,[ft],(r,[e])=>Math.tan(e.evaluate(r))],asin:[ft,[ft],(r,[e])=>Math.asin(e.evaluate(r))],acos:[ft,[ft],(r,[e])=>Math.acos(e.evaluate(r))],atan:[ft,[ft],(r,[e])=>Math.atan(e.evaluate(r))],min:[ft,ae(ft),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[ft,ae(ft),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[ft,[ft],(r,[e])=>Math.abs(e.evaluate(r))],round:[ft,[ft],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[ft,[ft],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[ft,[ft],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[nt,[mi,ni],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[nt,[ni],(r,[e])=>r.id()===e.value],"filter-type-==":[nt,[mi],(r,[e])=>r.geometryType()===e.value],"filter-<":[nt,[mi,ni],(r,[e,i])=>{const o=r.properties()[e.value],h=i.value;return typeof o==typeof h&&o<h}],"filter-id-<":[nt,[ni],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[nt,[mi,ni],(r,[e,i])=>{const o=r.properties()[e.value],h=i.value;return typeof o==typeof h&&o>h}],"filter-id->":[nt,[ni],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[nt,[mi,ni],(r,[e,i])=>{const o=r.properties()[e.value],h=i.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[nt,[ni],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[nt,[mi,ni],(r,[e,i])=>{const o=r.properties()[e.value],h=i.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[nt,[ni],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[nt,[ni],(r,[e])=>e.value in r.properties()],"filter-has-id":[nt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[nt,[pt(mi)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[nt,[pt(ni)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[nt,[mi,pt(ni)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[nt,[mi,pt(ni)],(r,[e,i])=>function(o,h,a,d){for(;a<=d;){const _=a+d>>1;if(h[_]===o)return!0;h[_]>o?d=_-1:a=_+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:nt,overloads:[[[nt,nt],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[ae(nt),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:nt,overloads:[[[nt,nt],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[ae(nt),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[nt,[nt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[nt,[mi],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[mi,[mi],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[mi,[mi],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[mi,ae(ni),(r,e)=>e.map(i=>li(i.evaluate(r))).join("")],"resolved-locale":[mi,[wi],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[ft,[ft,ft,ni],(r,e)=>{const[i,o,h]=e.map(d=>d.evaluate(r));if(i>o||i===o)return i;let a;if(typeof h=="string")a=function(d){let _=0;if(d.length===0)return _;for(let w=0;w<d.length;w++)_=(_<<5)-_+d.charCodeAt(w),_|=0;return _}(h);else{if(typeof h!="number")throw new Hi(`Invalid seed input: ${h}`);a=h}return i+Ll(a)()*(o-i)}]});class Ar{constructor(e,i,o,h){this.expression=e,this._warningHistory={},this._evaluator=new bt(o,h),this._defaultValue=i?function(a){return a.type==="color"&&(ii(a.default)||Array.isArray(a.default))?new W(0,0,0,0):a.type==="color"?W.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=mo(e)}evaluateWithoutErrorHandling(e,i,o,h,a,d,_,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=h||null,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,h,a,d,_,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=w||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Hi(`Expected value to be one of ${Object.keys(this._enumValues).map(m=>JSON.stringify(m)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function er(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Je}function es(r,e,i,o){const h=new ja(Je,[],e?function(d){const _={color:jt,string:mi,number:ft,enum:mi,boolean:nt,formatted:Mi,resolvedImage:Li};return d.type==="array"?pt(_[d.value]||ni,d.length):_[d.type]}(e):void 0,void 0,void 0,i,o),a=h.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?ge(new Ar(a,e,i,o)):Oe(h.errors)}class Zs{constructor(e,i,o,h){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!Ds(i.expression),this.configDependencies=mo(i.expression)}evaluateWithoutErrorHandling(e,i,o,h,a,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,a,d)}evaluate(e,i,o,h,a,d){return this._styleExpression.evaluate(e,i,o,h,a,d)}}class Vr{constructor(e,i,o,h,a,d){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Ds(i.expression),this.isLightConstant=a,this.isLineProgressConstant=d,this.configDependencies=mo(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,o,h,a,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,a,d)}evaluate(e,i,o,h,a,d){return this._styleExpression.evaluate(e,i,o,h,a,d)}interpolationFactor(e,i,o){return this.interpolationType?ia.interpolationFactor(this.interpolationType,e,i,o):0}}function fs(r,e,i,o){if((r=es(r,e,i,o)).result==="error")return r;const h=r.value.expression,a=os(h);if(!a&&!Rt(e))return Oe([new yn("","data expressions not supported")]);const d=uo(h,["zoom","pitch","distance-from-center"]);if(!d&&!Ni(e))return Oe([new yn("","zoom expressions not supported")]);const _=uo(h,["measure-light"]);if(!_&&!gi(e))return Oe([new yn("","measure-light expression not supported")]);const w=uo(h,["line-progress"]);if(!w&&!function(E){return rt(E.expression,"line-progress")}(e))return Oe([new yn("","line-progress expression not supported")]);const M=e.expression&&e.expression.relaxZoomRestriction,m=is(h);return m||d||M?m instanceof yn?Oe([m]):m instanceof ia&&!qi(e)?Oe([new yn("",'"interpolate" expressions cannot be used with this property')]):ge(m?new Vr(a&&w?"camera":"composite",r.value,m.labels,m instanceof ia?m.interpolation:void 0,_,w):new Zs(a&&w?"constant":"source",r.value,_,w)):Oe([new yn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class us{constructor(e,i){this._parameters=e,this._specification=i,Pn(this,xi(this._parameters,this._specification))}static deserialize(e){return new us(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function is(r){let e=null;if(r instanceof ou)e=is(r.result);else if(r instanceof hl){for(const i of r.args)if(e=is(i),e)break}else(r instanceof Ra||r instanceof ia)&&r.input instanceof qt&&r.input.name==="zoom"&&(e=r);return e instanceof yn||r.eachChild(i=>{const o=is(i);o instanceof yn?e=o:e&&o&&e!==o&&(e=new yn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var To,co,Do=function(){if(co)return To;co=1,To=e;var r=3;function e(i,o,h){var a=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var d=new Int32Array(this.arrayBuffer);i=d[0],this.d=(o=d[1])+2*(h=d[2]);for(var _=0;_<this.d*this.d;_++){var w=d[r+_],M=d[r+_+1];a.push(w===M?null:d.subarray(w,M))}var m=d[r+a.length+1];this.keys=d.subarray(d[r+a.length],m),this.bboxes=d.subarray(m),this.insert=this._insertReadonly}else{this.d=o+2*h;for(var E=0;E<this.d*this.d;E++)a.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=h,this.scale=o/i,this.uid=0;var I=h/o*i;this.min=-I,this.max=i+I}return e.prototype.insert=function(i,o,h,a,d){this._forEachCell(o,h,a,d,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(a),this.bboxes.push(d)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,h,a,d,_){this.cells[d].push(_)},e.prototype.query=function(i,o,h,a,d){var _=this.min,w=this.max;if(i<=_&&o<=_&&w<=h&&w<=a&&!d)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(i,o,h,a,this._queryCell,M,{},d),M},e.prototype._queryCell=function(i,o,h,a,d,_,w,M){var m=this.cells[d];if(m!==null)for(var E=this.keys,I=this.bboxes,b=0;b<m.length;b++){var T=m[b];if(w[T]===void 0){var A=4*T;(M?M(I[A+0],I[A+1],I[A+2],I[A+3]):i<=I[A+2]&&o<=I[A+3]&&h>=I[A+0]&&a>=I[A+1])?(w[T]=!0,_.push(E[T])):w[T]=!1}}},e.prototype._forEachCell=function(i,o,h,a,d,_,w,M){for(var m=this._convertToCellCoord(i),E=this._convertToCellCoord(o),I=this._convertToCellCoord(h),b=this._convertToCellCoord(a),T=m;T<=I;T++)for(var A=E;A<=b;A++){var k=this.d*A+T;if((!M||M(this._convertFromCellCoord(T),this._convertFromCellCoord(A),this._convertFromCellCoord(T+1),this._convertFromCellCoord(A+1)))&&d.call(this,i,o,h,a,k,_,w,M))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=r+this.cells.length+1+1,h=0,a=0;a<this.cells.length;a++)h+=this.cells[a].length;var d=new Int32Array(o+h+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var _=o,w=0;w<i.length;w++){var M=i[w];d[r+w]=_,d.set(M,_),_+=M.length}return d[r+i.length]=_,d.set(this.keys,_),d[r+i.length+1]=_+=this.keys.length,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer},To}(),zo=xn(Do);const _r={};function on(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),_r[e]={klass:r,omit:i.omit||[]}}on(Object,"Object"),zo.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},zo.deserialize=function(r){return new zo(r.buffer)},Object.defineProperty(zo,"name",{value:"Grid"}),on(zo,"Grid"),typeof DOMMatrix!="undefined"&&on(DOMMatrix,"DOMMatrix"),on(W,"Color"),on(Error,"Error"),on(Nt,"Formatted"),on(It,"FormattedSection"),on(Vn,"AJAXError"),on(oi,"ResolvedImage"),on(us,"StylePropertyFunction"),on(Ar,"StyleExpression",{omit:["_evaluator"]}),on(ci,"ImageIdWithOptions"),on(Vr,"ZoomDependentExpression"),on(Zs,"ZoomConstantExpression"),on(qt,"CompoundExpression",{omit:["_evaluate"]});for(const r in Je)_r[Je[r]._classRegistryKey]||on(Je[r],`Expression${r}`);function no(r){return r&&typeof ArrayBuffer!="undefined"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function jo(r){return self.ImageBitmap&&r instanceof ImageBitmap}function No(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(no(r)||jo(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const o of r)i.push(No(o,e));return i}if(r instanceof Map){const i={$name:"Map"};for(const[o,h]of r.entries())i[o]=No(h);return i}if(r instanceof Set){const i={$name:"Set"};let o=0;for(const h of r.values())i[++o]=No(h);return i}if(typeof r=="object"){const i=r.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${o}".`);const h=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const a in r)r.hasOwnProperty(a)&&(_r[o].omit.indexOf(a)>=0||(h[a]=No(r[a],e)));r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(h.$name=o),h}throw new Error("can't serialize object of type "+typeof r)}function Ko(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||no(r)||jo(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Ko);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const h=new Map;for(const a of Object.keys(r))a!=="$name"&&h.set(a,Ko(r[a]));return h}if(e==="Set"){const h=new Set;for(const a of Object.keys(r))a!=="$name"&&h.add(Ko(r[a]));return h}const{klass:i}=_r[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const o=Object.create(i.prototype);for(const h of Object.keys(r))h!=="$name"&&(o[h]=Ko(r[h]));return o}throw new Error("can't deserialize object of type "+typeof r)}const jn={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Da(r){for(const e of r)if(kl(e.charCodeAt(0)))return!0;return!1}function Rl(r){for(const e of r)if(!el(e.charCodeAt(0)))return!1;return!0}function el(r){return!(jn.Arabic(r)||jn["Arabic Supplement"](r)||jn["Arabic Extended-A"](r)||jn["Arabic Presentation Forms-A"](r)||jn["Arabic Presentation Forms-B"](r))}function kl(r){return!(r!==746&&r!==747&&(r<4352||!(jn["Bopomofo Extended"](r)||jn.Bopomofo(r)||jn["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||jn["CJK Compatibility Ideographs"](r)||jn["CJK Compatibility"](r)||jn["CJK Radicals Supplement"](r)||jn["CJK Strokes"](r)||!(!jn["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||jn["CJK Unified Ideographs Extension A"](r)||jn["CJK Unified Ideographs"](r)||jn["Enclosed CJK Letters and Months"](r)||jn["Hangul Compatibility Jamo"](r)||jn["Hangul Jamo Extended-A"](r)||jn["Hangul Jamo Extended-B"](r)||jn["Hangul Jamo"](r)||jn["Hangul Syllables"](r)||jn.Hiragana(r)||jn["Ideographic Description Characters"](r)||jn.Kanbun(r)||jn["Kangxi Radicals"](r)||jn["Katakana Phonetic Extensions"](r)||jn.Katakana(r)&&r!==12540||!(!jn["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!jn["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||jn["Unified Canadian Aboriginal Syllabics"](r)||jn["Unified Canadian Aboriginal Syllabics Extended"](r)||jn["Vertical Forms"](r)||jn["Yijing Hexagram Symbols"](r)||jn["Yi Syllables"](r)||jn["Yi Radicals"](r))))}function pl(r){return!(kl(r)||function(e){return!!(jn["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||jn["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||jn["Letterlike Symbols"](e)||jn["Number Forms"](e)||jn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||jn["Control Pictures"](e)&&e!==9251||jn["Optical Character Recognition"](e)||jn["Enclosed Alphanumerics"](e)||jn["Geometric Shapes"](e)||jn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||jn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||jn["CJK Symbols and Punctuation"](e)||jn.Katakana(e)||jn["Private Use Area"](e)||jn["CJK Compatibility Forms"](e)||jn["Small Form Variants"](e)||jn["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function uh(r){return r>=1424&&r<=2303||jn["Arabic Presentation Forms-A"](r)||jn["Arabic Presentation Forms-B"](r)}function vd(r,e){return!(!e&&uh(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||jn.Khmer(r))}function ch(r){for(const e of r)if(uh(e.charCodeAt(0)))return!0;return!1}const Ju="deferred",Mc="loading",hh="loaded";let ml=null,Ta="unavailable",Xl=null;const dh=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Ta="error"),ml&&ml(r)};function fh(){Mu.fire(new Oo("pluginStateChange",{pluginStatus:Ta,pluginURL:Xl}))}const Mu=new sa,Ac=function(){return Ta},Qu=function(){if(Ta!==Ju||!Xl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ta=Mc,fh(),Xl&&zs({url:Xl},r=>{r?dh(r):(Ta=hh,fh())})},za={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ta===hh||za.applyArabicShaping!=null,isLoading:()=>Ta===Mc,setState(r){Ta=r.pluginStatus,Xl=r.pluginURL},isParsed:()=>za.applyArabicShaping!=null&&za.processBidirectionalText!=null&&za.processStyledBidirectionalText!=null,getPluginURL:()=>Xl};class Ws{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const h of i)if(!vd(h.charCodeAt(0),o))return!1;return!0}(e,za.isLoaded())}}class Cc{constructor(e,i,o,h){this.property=e,this.value=i,this.expression=function(a,d,_,w){if(ii(a))return new us(a,d);if(er(a)||Array.isArray(a)&&a.length>0){const M=fs(a,d,_,w);if(M.result==="error")throw new Error(M.value.map(m=>`${m.key}: ${m.message}`).join(", "));return M.value}{let M=a;return typeof a=="string"&&d.type==="color"&&(M=W.parse(a)),{kind:"constant",configDependencies:new Set,evaluate:()=>M}}}(i===void 0?e.specification.default:i,e.specification,o,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class ec{constructor(e,i,o){this.property=e,this.value=new Cc(e,void 0,i,o)}transitioned(e,i){return new ph(this.property,this.value,i,Dn({},e.transition,this.transition),e.now)}untransitioned(){return new ph(this.property,this.value,null,{},0)}}class Pc{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Ss(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ec(this._values[e].property,this._scope,this._options)),this._values[e].value=new Cc(this._values[e].property,i===null?void 0:Ss(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const h in e){const a=e[h];if(ms(h,"-transition")){const d=h.slice(0,-11);o[d]&&this.setTransition(d,a)}else o.hasOwnProperty(h)&&this.setValue(h,a)}}getTransition(e){return Ss(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ec(this._values[e].property)),this._values[e].transition=Ss(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const o=new tc(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(e,i._values[h]);return o}untransitioned(){const e=new tc(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ph{constructor(e,i,o,h,a){const d=h.delay||0,_=h.duration||0;a=a||0,this.property=e,this.value=i,this.begin=a+d,this.end=this.begin+_,e.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const h=e.now||0,a=this.value.possiblyEvaluate(e,i,o),d=this.prior;if(d){if(h>this.end)return this.prior=null,a;if(this.value.isDataDriven())return this.prior=null,a;if(h<this.begin)return d.possiblyEvaluate(e,i,o);{const _=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,o),a,Hs(_))}}return a}}class tc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const h=new Pu(this._properties);for(const a of Object.keys(this._values))h._values[a]=this._values[a].possiblyEvaluate(e,i,o);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Au{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Ss(this._values[e].value)}setValue(e,i){this._values[e]=new Cc(this._values[e].property,i===null?void 0:Ss(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const h=new Pu(this._properties);for(const a of Object.keys(this._values))h._values[a]=this._values[a].possiblyEvaluate(e,i,o);return h}}class Cu{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,h){return this.property.evaluate(this.value,this.parameters,e,i,o,h)}}class Pu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class an{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const h=Ei[this.specification.type];return h?h(e,i,o):e}}class Rn{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,h){return new Cu(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,h)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Cu(this,{kind:"constant",value:void 0},e.parameters);const h=Ei[this.specification.type];return h?new Cu(this,{kind:"constant",value:h(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,h,a,d){return e.kind==="constant"?e.value:e.evaluate(i,o,h,a,d)}}class Lu{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,h){return!!e.expression.evaluate(i,null,{},o,h)}interpolate(){return!1}}class ro{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Ws(0,{});for(const o in e){const h=e[o];h.specification.overridable&&this.overridableProperties.push(o);const a=this.defaultPropertyValues[o]=new Cc(h,void 0),d=this.defaultTransitionablePropertyValues[o]=new ec(h);this.defaultTransitioningPropertyValues[o]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=a.possiblyEvaluate(i)}}}on(Rn,"DataDrivenProperty"),on(an,"DataConstantProperty"),on(Lu,"ColorRampProperty");var Ct=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function xd(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Lc(r){if(Array.isArray(r))return r.map(Lc);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Lc(r[i]);return e}return xd(r)}function mh(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!mh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function bd(r,e="",i=null,o="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};mh(r)||(r=Rc(r));const h=r;let a=!0;try{a=function(m){if(!Ru(m))return m;let E=Lc(m);return Ed(E),E=wd(E),E}(h)}catch(m){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let d=null,_=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){_=Ct[`filter_${o}`];const m=es(a,_,e,i);if(m.result==="error")throw new Error(m.value.map(E=>`${E.key}: ${E.message}`).join(", "));d=(E,I,b)=>m.value.evaluate(E,I,{},b)}let w=null,M=null;if(a!==h){const m=es(h,_,e,i);if(m.result==="error")throw new Error(m.value.map(E=>`${E.key}: ${E.message}`).join(", "));w=(E,I,b,T,A)=>m.value.evaluate(E,I,{},b,void 0,void 0,T,A),M=!os(m.value.expression)}return{filter:d,dynamicFilter:w||void 0,needGeometry:Td(a),needFeature:!!M}}function wd(r){if(!Array.isArray(r))return r;const e=function(i){if(Lf.has(i[0])){for(let o=1;o<i.length;o++)if(Ru(i[o]))return!0}return i}(r);return e===!0?e:e.map(i=>wd(i))}function Ed(r){let e=!1;const i=[];if(r[0]==="case"){for(let o=1;o<r.length-1;o+=2)e=e||Ru(r[o]),i.push(r[o+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Ru(r[1]);for(let o=2;o<r.length-1;o+=2)i.push(r[o+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Ru(r[1]);for(let o=1;o<r.length-1;o+=2)i.push(r[o+1])}e&&(r.length=0,r.push("any",...i));for(let o=1;o<r.length;o++)Ed(r[o])}function Ru(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Ru(r[i]))return!0;return!1}const Lf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Rf(r,e){return r<e?-1:r>e?1:0}function Td(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Td(r[e]))return!0;return!1}function Rc(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?$l(r[1],r[2],"=="):e==="!="?uu($l(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?$l(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Rc))):e==="all"?["all"].concat(r.slice(1).map(Rc)):e==="none"?["all"].concat(r.slice(1).map(Rc).map(uu)):e==="in"?gh(r[1],r.slice(2)):e==="!in"?uu(gh(r[1],r.slice(2))):e==="has"?_h(r[1]):e!=="!has"||uu(_h(r[1]));var i}function $l(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function gh(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Rf)]]:["filter-in-small",r,["literal",e]]}}function _h(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function uu(r){return["!",r]}const kc="";function gl(r,e){return e?`${r}${kc}${e}`:r}const Ol="-transition",Sd=new Set(["fill","line","background","hillshade","raster"]);class Jo extends sa{constructor(e,i,o,h,a){if(super(),this.id=e.id,this.fqid=gl(this.id,o),this.type=e.type,this.scope=o,this.lut=h,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const d=es(this.filter,Ct[`filter_${e.type}`]);d.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...d.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Au(i.layout,this.scope,a),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Pc(i.paint,this.scope,a);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pu(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&Sd.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return ms(e,Ol)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,h=o._properties.properties;if(ms(e,Ol)){const E=e.slice(0,-11);return h[E]&&o.setTransition(E,i||void 0),!1}if(!h[e])return!1;const a=o._values[e],d=a.value.isDataDriven(),_=a.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const w=o._values[e].value,M=w.isDataDriven(),m=ms(e,"pattern")||e==="line-dasharray";return M||d||m||this._handleOverridablePaintPropertyUpdate(e,_,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return mr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Cu&&Rt(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=bd(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,h,a,d,_,w,M){}}const kf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ic{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ys{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function gs(r,e=1){let i=0,o=0;return{members:r.map(h=>{const a=kf[h.type].BYTES_PER_ELEMENT,d=i=Id(i,Math.max(e,a)),_=h.components||1;return o=Math.max(o,a),i+=a*_,{name:h.name,type:h.type,components:_,offset:d}}),size:Id(i,Math.max(o,e)),alignment:e}}function Id(r,e){return Math.ceil(r/e)*e}class Dl extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=o,e}}Dl.prototype.bytesPerElement=4,on(Dl,"StructArrayLayout2i4");class ku extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const a=3*e;return this.int16[a+0]=i,this.int16[a+1]=o,this.int16[a+2]=h,e}}ku.prototype.bytesPerElement=6,on(ku,"StructArrayLayout3i6");class zl extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,h)}emplace(e,i,o,h,a){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=h,this.int16[d+3]=a,e}}zl.prototype.bytesPerElement=8,on(zl,"StructArrayLayout4i8");class Oc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,h,a)}emplace(e,i,o,h,a,d){const _=5*e;return this.int16[_+0]=i,this.int16[_+1]=o,this.int16[_+2]=h,this.int16[_+3]=a,this.int16[_+4]=d,e}}Oc.prototype.bytesPerElement=10,on(Oc,"StructArrayLayout5i10");class nc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,a,d,_)}emplace(e,i,o,h,a,d,_,w){const M=6*e,m=12*e,E=3*e;return this.int16[M+0]=i,this.int16[M+1]=o,this.uint8[m+4]=h,this.uint8[m+5]=a,this.uint8[m+6]=d,this.uint8[m+7]=_,this.float32[E+2]=w,e}}nc.prototype.bytesPerElement=12,on(nc,"StructArrayLayout2i4ub1f12");class _l extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const a=3*e;return this.float32[a+0]=i,this.float32[a+1]=o,this.float32[a+2]=h,e}}_l.prototype.bytesPerElement=12,on(_l,"StructArrayLayout3f12");class ca extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,h,a)}emplace(e,i,o,h,a,d){const _=6*e,w=3*e;return this.uint16[_+0]=i,this.uint16[_+1]=o,this.uint16[_+2]=h,this.uint16[_+3]=a,this.float32[w+2]=d,e}}ca.prototype.bytesPerElement=12,on(ca,"StructArrayLayout4ui1f12");class Dc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,h)}emplace(e,i,o,h,a){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=h,this.uint16[d+3]=a,e}}Dc.prototype.bytesPerElement=8,on(Dc,"StructArrayLayout4ui8");class rc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,h,a,d)}emplace(e,i,o,h,a,d,_){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=h,this.int16[w+3]=a,this.int16[w+4]=d,this.int16[w+5]=_,e}}rc.prototype.bytesPerElement=12,on(rc,"StructArrayLayout6i12");class yh extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_,w,M,m,E,I){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,h,a,d,_,w,M,m,E,I)}emplace(e,i,o,h,a,d,_,w,M,m,E,I,b){const T=12*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.int16[T+2]=h,this.int16[T+3]=a,this.uint16[T+4]=d,this.uint16[T+5]=_,this.uint16[T+6]=w,this.uint16[T+7]=M,this.int16[T+8]=m,this.int16[T+9]=E,this.int16[T+10]=I,this.int16[T+11]=b,e}}yh.prototype.bytesPerElement=24,on(yh,"StructArrayLayout4i4ui4i24");class vh extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,h,a,d)}emplace(e,i,o,h,a,d,_){const w=10*e,M=5*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=h,this.float32[M+2]=a,this.float32[M+3]=d,this.float32[M+4]=_,e}}vh.prototype.bytesPerElement=20,on(vh,"StructArrayLayout3i3f20");class cu extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,h)}emplace(e,i,o,h,a){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=h,this.float32[d+3]=a,e}}cu.prototype.bytesPerElement=16,on(cu,"StructArrayLayout4f16");class xh extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}xh.prototype.bytesPerElement=4,on(xh,"StructArrayLayout1ul4");class Wl extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,e}}Wl.prototype.bytesPerElement=4,on(Wl,"StructArrayLayout2ui4");class bh extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_,w,M,m,E,I,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,h,a,d,_,w,M,m,E,I,b)}emplace(e,i,o,h,a,d,_,w,M,m,E,I,b,T){const A=20*e,k=10*e;return this.int16[A+0]=i,this.int16[A+1]=o,this.int16[A+2]=h,this.int16[A+3]=a,this.int16[A+4]=d,this.float32[k+3]=_,this.float32[k+4]=w,this.float32[k+5]=M,this.float32[k+6]=m,this.int16[A+14]=E,this.uint32[k+8]=I,this.uint16[A+18]=b,this.uint16[A+19]=T,e}}bh.prototype.bytesPerElement=40,on(bh,"StructArrayLayout5i4f1i1ul2ui40");class zc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,a,d,_)}emplace(e,i,o,h,a,d,_,w){const M=8*e;return this.int16[M+0]=i,this.int16[M+1]=o,this.int16[M+2]=h,this.int16[M+4]=a,this.int16[M+5]=d,this.int16[M+6]=_,this.int16[M+7]=w,e}}zc.prototype.bytesPerElement=16,on(zc,"StructArrayLayout3i2i2i16");class wh extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,h,a)}emplace(e,i,o,h,a,d){const _=4*e,w=8*e;return this.float32[_+0]=i,this.float32[_+1]=o,this.float32[_+2]=h,this.int16[w+6]=a,this.int16[w+7]=d,e}}wh.prototype.bytesPerElement=16,on(wh,"StructArrayLayout2f1f2i16");class Eh extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,h,a,d)}emplace(e,i,o,h,a,d,_){const w=20*e,M=5*e;return this.uint8[w+0]=i,this.uint8[w+1]=o,this.float32[M+1]=h,this.float32[M+2]=a,this.float32[M+3]=d,this.float32[M+4]=_,e}}Eh.prototype.bytesPerElement=20,on(Eh,"StructArrayLayout2ub4f20");class na extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const a=3*e;return this.uint16[a+0]=i,this.uint16[a+1]=o,this.uint16[a+2]=h,e}}na.prototype.bytesPerElement=6,on(na,"StructArrayLayout3ui6");class Th extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k,O,U,G,B,H){const $=this.length;return this.resize($+1),this.emplace($,e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k,O,U,G,B,H)}emplace(e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k,O,U,G,B,H,$){const ne=30*e,me=15*e,de=60*e;return this.int16[ne+0]=i,this.int16[ne+1]=o,this.int16[ne+2]=h,this.float32[me+2]=a,this.float32[me+3]=d,this.uint16[ne+8]=_,this.uint16[ne+9]=w,this.uint32[me+5]=M,this.uint32[me+6]=m,this.uint32[me+7]=E,this.uint16[ne+16]=I,this.uint16[ne+17]=b,this.uint16[ne+18]=T,this.float32[me+10]=A,this.float32[me+11]=k,this.uint8[de+48]=O,this.uint8[de+49]=U,this.uint8[de+50]=G,this.uint32[me+13]=B,this.int16[ne+28]=H,this.uint8[de+58]=$,e}}Th.prototype.bytesPerElement=60,on(Th,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sh extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k,O,U,G,B,H,$,ne,me,de,ue,Fe,ye,Ve,$e,Ze,Qe){const ht=this.length;return this.resize(ht+1),this.emplace(ht,e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k,O,U,G,B,H,$,ne,me,de,ue,Fe,ye,Ve,$e,Ze,Qe)}emplace(e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k,O,U,G,B,H,$,ne,me,de,ue,Fe,ye,Ve,$e,Ze,Qe,ht){const wt=20*e,st=40*e,Jt=80*e;return this.float32[wt+0]=i,this.float32[wt+1]=o,this.int16[st+4]=h,this.int16[st+5]=a,this.int16[st+6]=d,this.int16[st+7]=_,this.int16[st+8]=w,this.int16[st+9]=M,this.int16[st+10]=m,this.int16[st+11]=E,this.int16[st+12]=I,this.uint16[st+13]=b,this.uint16[st+14]=T,this.uint16[st+15]=A,this.uint16[st+16]=k,this.uint16[st+17]=O,this.uint16[st+18]=U,this.uint16[st+19]=G,this.uint16[st+20]=B,this.uint16[st+21]=H,this.uint16[st+22]=$,this.uint16[st+23]=ne,this.uint16[st+24]=me,this.uint16[st+25]=de,this.uint16[st+26]=ue,this.uint16[st+27]=Fe,this.uint32[wt+14]=ye,this.float32[wt+15]=Ve,this.float32[wt+16]=$e,this.float32[wt+17]=Ze,this.float32[wt+18]=Qe,this.uint8[Jt+76]=ht,e}}Sh.prototype.bytesPerElement=80,on(Sh,"StructArrayLayout2f9i15ui1ul4f1ub80");class sc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}sc.prototype.bytesPerElement=4,on(sc,"StructArrayLayout1f4");class Yl extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,h,a)}emplace(e,i,o,h,a,d){const _=5*e;return this.float32[_+0]=i,this.float32[_+1]=o,this.float32[_+2]=h,this.float32[_+3]=a,this.float32[_+4]=d,e}}Yl.prototype.bytesPerElement=20,on(Yl,"StructArrayLayout5f20");class Nc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,a,d,_)}emplace(e,i,o,h,a,d,_,w){const M=7*e;return this.float32[M+0]=i,this.float32[M+1]=o,this.float32[M+2]=h,this.float32[M+3]=a,this.float32[M+4]=d,this.float32[M+5]=_,this.float32[M+6]=w,e}}Nc.prototype.bytesPerElement=28,on(Nc,"StructArrayLayout7f28");class yl extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_,w,M,m,E){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,o,h,a,d,_,w,M,m,E)}emplace(e,i,o,h,a,d,_,w,M,m,E,I){const b=11*e;return this.float32[b+0]=i,this.float32[b+1]=o,this.float32[b+2]=h,this.float32[b+3]=a,this.float32[b+4]=d,this.float32[b+5]=_,this.float32[b+6]=w,this.float32[b+7]=M,this.float32[b+8]=m,this.float32[b+9]=E,this.float32[b+10]=I,e}}yl.prototype.bytesPerElement=44,on(yl,"StructArrayLayout11f44");class Fc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_,w,M){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,h,a,d,_,w,M)}emplace(e,i,o,h,a,d,_,w,M,m){const E=9*e;return this.float32[E+0]=i,this.float32[E+1]=o,this.float32[E+2]=h,this.float32[E+3]=a,this.float32[E+4]=d,this.float32[E+5]=_,this.float32[E+6]=w,this.float32[E+7]=M,this.float32[E+8]=m,e}}Fc.prototype.bytesPerElement=36,on(Fc,"StructArrayLayout9f36");class Ou extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=o,e}}Ou.prototype.bytesPerElement=8,on(Ou,"StructArrayLayout2f8");class Ih extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,h)}emplace(e,i,o,h,a){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=o,this.uint16[d+3]=h,this.uint16[d+4]=a,e}}Ih.prototype.bytesPerElement=12,on(Ih,"StructArrayLayout1ul3ui12");class Mh extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Mh.prototype.bytesPerElement=2,on(Mh,"StructArrayLayout1ui2");class oc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k)}emplace(e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k,O){const U=16*e;return this.float32[U+0]=i,this.float32[U+1]=o,this.float32[U+2]=h,this.float32[U+3]=a,this.float32[U+4]=d,this.float32[U+5]=_,this.float32[U+6]=w,this.float32[U+7]=M,this.float32[U+8]=m,this.float32[U+9]=E,this.float32[U+10]=I,this.float32[U+11]=b,this.float32[U+12]=T,this.float32[U+13]=A,this.float32[U+14]=k,this.float32[U+15]=O,e}}oc.prototype.bytesPerElement=64,on(oc,"StructArrayLayout16f64");class ac extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,a,d,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,a,d,_)}emplace(e,i,o,h,a,d,_,w){const M=10*e,m=5*e;return this.uint16[M+0]=i,this.uint16[M+1]=o,this.uint16[M+2]=h,this.uint16[M+3]=a,this.float32[m+2]=d,this.float32[m+3]=_,this.float32[m+4]=w,e}}ac.prototype.bytesPerElement=20,on(ac,"StructArrayLayout4ui3f20");class Ah extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Ah.prototype.bytesPerElement=2,on(Ah,"StructArrayLayout1i2");class Bc extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Bc.prototype.bytesPerElement=1,on(Bc,"StructArrayLayout1ub1");class Md extends ic{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Md.prototype.size=40;class Ch extends bh{get(e){return new Md(this,e)}}on(Ch,"CollisionBoxArray");class lc extends ic{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}lc.prototype.size=60;class Ad extends Th{get(e){return new lc(this,e)}}on(Ad,"PlacedSymbolArray");class Cd extends ic{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Cd.prototype.size=80;class Pd extends Sh{get(e){return new Cd(this,e)}}on(Pd,"SymbolInstanceArray");class Ld extends sc{getoffsetX(e){return this.float32[1*e+0]}}on(Ld,"GlyphOffsetArray");class Rd extends Dl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}on(Rd,"SymbolLineVertexArray");class uc extends ic{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}uc.prototype.size=12;class cc extends Ih{get(e){return new uc(this,e)}}on(cc,"FeatureIndexArray");class Sa extends Wl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}on(Sa,"FillExtrusionCentroidArray");class hc extends ic{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}hc.prototype.size=6;class kd extends ku{get(e){return new hc(this,e)}}on(kd,"FillExtrusionWallArray");const Of=gs([{name:"a_pos",components:2,type:"Int16"}],4),Df=gs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class yo{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,h){let a=this.segments[this.segments.length-1];return e>yo.MAX_VERTEX_ARRAY_LENGTH&&ur(`Max vertices per segment is ${yo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!a||a.vertexLength+e>yo.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==h)&&(a={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},h!==void 0&&(a.sortKey=h),this.segments.push(a)),a}prepareSegment(e,i,o,h){return this._prepareSegment(e,i.length,o.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,h){return new yo([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function Uc(r,e){return 256*(r=cn(Math.floor(r),0,255))+cn(Math.floor(e),0,255)}yo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,on(yo,"SegmentVector");const zf=gs([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ph=gs([{name:"a_dash",components:4,type:"Uint16"}]);class dc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,h){this.ids.push(Od(e)),this.positions.push(i,o,h)}eachPosition(e,i){const o=Od(e);let h=0,a=this.ids.length-1;for(;h<a;){const d=h+a>>1;this.ids[d]>=o?a=d:h=d+1}for(;this.ids[h]===o;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const o=new Float64Array(e.ids),h=new Uint32Array(e.positions);return fc(o,h,0,o.length-1),i&&(i.add(o.buffer),i.add(h.buffer)),{ids:o,positions:h}}static deserialize(e){const i=new dc;let o;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==o&&i.uniqueIds.push(h),o=h;return i.indexed=!0,i}}function Od(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:bo(String(r))}function fc(r,e,i,o){for(;i<o;){const h=r[i+o>>1];let a=i-1,d=o+1;for(;;){do a++;while(r[a]<h);do d--;while(r[d]>h);if(a>=d)break;Vc(r,a,d),Vc(e,3*a,3*d),Vc(e,3*a+1,3*d+1),Vc(e,3*a+2,3*d+2)}d-i<o-d?(fc(r,e,i,d),i=d+1):(fc(r,e,d+1,o),o=d)}}function Vc(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}on(dc,"FeaturePositionMap");class vl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class pc extends vl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class So extends vl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Ha extends vl{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Du extends vl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class mc extends vl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Dd extends vl{constructor(e){super(e),this.current=W.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const zd=new Float32Array(16);class gc extends vl{constructor(e){super(e),this.current=zd}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let h=1;h<16;h++)if(o[h]!==this.current[h]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const Lh=new Float32Array(9),Nf=new Float32Array(4);class Rh extends vl{constructor(e){super(e),this.current=Nf}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(o[h]!==this.current[h]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function kh(r){return[Uc(255*r.r,255*r.g),Uc(255*r.b,255*r.a)]}class hu{constructor(e,i,o,h){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=o,this.context=h}setUniform(e,i,o,h,a){const d=h.constantOr(this.value);i.set(e,a,d instanceof W?d.toRenderColor(this.ignoreLut?null:this.context.lut):d)}getBinding(e,i){return this.type==="color"?new Dd(e):new So(e)}}class du{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,h,a){const d=a==="u_pattern"||a==="u_dash"?this.pattern:a==="u_pixel_ratio"?this.pixelRatio:null;d&&i.set(e,a,d)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new mc(e):new So(e)}}class Nl{constructor(e,i,o,h){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(a=>({name:`a_${a}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,o,h,a,d,_){const w=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ws(0,{brightness:d}),i,{},a,h,_):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Ws(0,{brightness:d}),i,{},a,h,_)==="none"),this.paintVertexArray.resize(e),this._setPaintValue(w,e,M,this.context)}updatePaintArray(e,i,o,h,a,d,_){const w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:_},o,h,void 0,a):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:_},o,h,void 0,a)==="none"),this._setPaintValue(e,i,w,this.context)}_setPaintValue(e,i,o,h){if(this.type==="color"){const a=kh(o.toRenderColor(this.ignoreLut?null:h.lut));for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tl{constructor(e,i,o,h,a,d){this.expression=e,this.uniformNames=i.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=h,this.context=a,this.maxValue=0,this.paintVertexAttributes=i.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,o,h,a,d,_){const w=this.expression.evaluate(new Ws(this.context.zoom,{brightness:d}),i,{},a,h,_),M=this.expression.evaluate(new Ws(this.context.zoom+1,{brightness:d}),i,{},a,h,_);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Ws(this.context.zoom,{brightness:d}),i,{},a,h,_)==="none");const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,w,M,this.context)}updatePaintArray(e,i,o,h,a,d,_){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:_},o,h,void 0,a),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},o,h,void 0,a);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:_},o,h,void 0,a)==="none"),this._setPaintValue(e,i,w,M,this.context)}_setPaintValue(e,i,o,h,a){if(this.type==="color"){const d=kh(o.toRenderColor(this.ignoreLut?null:a.lut)),_=kh(o.toRenderColor(this.ignoreLut?null:a.lut));for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,d[0],d[1],_[0],_[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,h,a){const d=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,_=cn(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);i.set(e,a,_)}getBinding(e,i){return new So(e)}}class Kl{constructor(e,i,o,h,a){this.expression=e,this.layerId=a,this.paintVertexAttributes=(o==="array"?Ph:zf).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new h}populatePaintArray(e,i,o,h){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,h,a,d,_){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],d)}_setPaintValues(e,i,o,h){if(!h||!o)return;const a=h[o];if(!a)return;const{tl:d,br:_,pixelRatio:w}=a;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,d[0],d[1],_[0],_[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fu{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const h=[];for(const a in e.paint._values){const d=e.paint.get(a),_=e.paint.get(`${a}-use-theme`);if(a.endsWith("-use-theme")||!o(a)||!(d instanceof Cu&&Rt(d.property.specification)))continue;const w=Bf(a,e.type),M=d.value,m=d.property.specification.type,E=!!d.property.useIntegerZoom,I=a==="line-dasharray"||a.endsWith("pattern"),b=a==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||_&&_.value.kind!=="constant";if(M.kind!=="constant"||b)if(M.kind==="source"||b||I){const T=Nd(a,m,"source");this.binders[a]=I?new Kl(M,w,m,T,e.id):new Nl(M,w,m,T),h.push(`/a_${a}`)}else{const T=Nd(a,m,"composite");this.binders[a]=new tl(M,w,m,E,i,T),h.push(`/z_${a}`)}else this.binders[a]=I?new du(M.value,w):new hu(M.value,w,m,i),h.push(`/u_${a}`);_&&(this.binders[a].ignoreLut=_.constantOr("default")==="none",this.binders[a].lutExpression=_.value,this.binders[a].checkUseTheme=!0)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Nl||i instanceof tl?i.maxValue:0}populatePaintArrays(e,i,o,h,a,d,_){for(const w in this.binders){const M=this.binders[w];M.context=this.context,M instanceof Nl||M instanceof tl||M instanceof Kl?M.populatePaintArray(e,i,o,h,a,d,_):M.lutExpression&&M instanceof hu&&M.lutExpression&&(M.lutExpression.kind==="composite"||M.lutExpression.kind==="source")&&(M.ignoreLut=M.lutExpression.evaluate(new Ws(0,{brightness:d}),i,{},a,h,_)==="none")}}setConstantPatternPositions(e){for(const i in this.binders){const o=this.binders[i];o instanceof du&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,h,a,d,_,w,M){let m=!1;const E=Object.keys(e),I=E.length!==0&&!w,b=I?E:i.uniqueIds;this.context.lut=a.lut;for(const T in this.binders){const A=this.binders[T];if(A.context=this.context,(A instanceof Nl||A instanceof tl||A instanceof Kl)&&A.expression&&A.expression.kind&&A.expression.kind!=="constant"&&(A.expression.isStateDependent===!0||A.expression.isLightConstant===!1)){const k=a.paint.get(T);A.expression=k.value;for(const O of b){const U=e[O.toString()];i.eachPosition(O,(G,B,H)=>{const $=h.feature(G);A.updatePaintArray(B,H,$,U,d,_,M)})}if(!I)for(const O of o.uniqueIds){const U=e[O.toString()];o.eachPosition(O,(G,B,H)=>{const $=h.feature(G);A.updatePaintArray(B,H,$,U,d,_,M)})}m=!0}}return m}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof hu||o instanceof du)&&e.push(...o.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Nl||o instanceof tl||o instanceof Kl)for(let h=0;h<o.paintVertexAttributes.length;h++)e.push(o.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof hu||o instanceof du||o instanceof tl)for(const h of o.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof hu||h instanceof du||h instanceof tl)for(const a of h.uniformNames)i.push({name:a,property:o,binding:h.getBinding(e,a)})}return i}setUniforms(e,i,o,h,a){for(const{name:d,property:_,binding:w}of o){if(this.binders[_].checkUseTheme&&this.binders[_]instanceof hu){const M=h.get(`${_}-use-theme`);M.isConstant()&&(this.binders[_].ignoreLut=M.constantOr("default")==="none")}this.binders[_].setUniform(e,w,a,h.get(_),d)}}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Nl||i instanceof tl||i instanceof Kl)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Nl||o instanceof tl||o instanceof Kl)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Nl||i instanceof tl||i instanceof Kl)&&i.destroy()}}}class Jl{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new fu(h,i,o);this.needsUpload=!1,this._featureMap=new dc,this._featureMapWithoutIds=new dc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,h,a,d,_,w){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,i,h,a,d,_,w);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,h,a,d,_){for(const w of o)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,w,h,a,d,_||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ff={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Bf(r,e){return Ff[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Uf={"line-pattern":{source:ca,composite:ca},"fill-pattern":{source:ca,composite:ca},"fill-extrusion-pattern":{source:ca,composite:ca},"line-dasharray":{source:Dc,composite:Dc}},Gc={color:{source:Ou,composite:cu},number:{source:sc,composite:Ou}};function Nd(r,e,i){const o=Uf[r];return o&&o[i]||Gc[e][i]}on(hu,"ConstantBinder"),on(du,"PatternConstantBinder"),on(Nl,"SourceExpressionBinder"),on(Kl,"PatternCompositeBinder"),on(tl,"CompositeExpressionBinder"),on(fu,"ProgramConfiguration",{omit:["_buffers"]}),on(Jl,"ProgramConfigurationSet");const _a=mn/Math.PI/2,zu=5,Fd=6,Bd=16383,Nu=64,jc=[Nu,32,16],Na=-_a,Fa=_a;function Fu(r,e,i,o=_a){return i=Sr(i),[r*Math.sin(i)*o,-e*o,r*Math.cos(i)*o]}function pu(r,e,i){return Fu(Math.cos(Sr(r)),Math.sin(Sr(r)),e,i)}const mu=63710088e-1,Oh=2*Math.PI*mu;class as{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new as(Pr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,h=e.lat*i,a=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return mu*Math.acos(Math.min(a,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new Ql({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return pu(this.lat,this.lng,_a+e*_a/mu)}static convert(e){if(e instanceof as)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new as(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new as(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ql{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof as?new as(e.lng,e.lat):as.convert(e),this}setSouthWest(e){return this._sw=e instanceof as?new as(e.lng,e.lat):as.convert(e),this}extend(e){const i=this._sw,o=this._ne;let h,a;if(e instanceof as)h=e,a=e;else{if(!(e instanceof Ql))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ql.convert(e)):this.extend(as.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(as.convert(e)):this;if(h=e._sw,a=e._ne,!h||!a)return this}return i||o?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),o.lng=Math.max(a.lng,o.lng),o.lat=Math.max(a.lat,o.lat)):(this._sw=new as(h.lng,h.lat),this._ne=new as(a.lng,a.lat)),this}getCenter(){return new as((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new as(this.getWest(),this.getNorth())}getSouthEast(){return new as(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=as.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&h}static convert(e){if(e)return e instanceof Ql?e:new Ql(e)}}const Vf=0,Gf=25.5;function qc(r){return Oh*Math.cos(r*Math.PI/180)}function xl(r){return(180+r)/360}function il(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ya(r,e){return r/qc(e)}function Ia(r){return 360*r-180}function ra(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Ud(r,e){return r*qc(ra(e))}const vo=85.051129;function Dh(r){return Math.cos(Sr(cn(r,-vo,vo)))}function Bu(r,e){const i=cn(e,Vf,Gf),o=Math.pow(2,i);return Dh(r)*Oh/(512*o)}function l(r){return 1/Math.cos(r*Math.PI/180)}function t(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/mn)/(1<<r.z)*2));return 80150034*i/(i*i+1)/mn/(1<<r.z)}class n{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=as.convert(e);return new n(xl(o.lng),il(o.lat),ya(i,o.lat))}toLngLat(){return new as(Ia(this.x),ra(this.y))}toAltitude(){return Ud(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Oh*l(ra(this.y))}}function u(r,e,i,o,h,a,d,_,w){const M=(e+o)/2,m=(i+h)/2,E=new Xi(M,m);_(E),function(I,b,T,A,k,O){const U=T-k,G=A-O;return Math.abs((A-b)*U-(T-I)*G)/Math.hypot(U,G)}(E.x,E.y,a.x,a.y,d.x,d.y)>=w?(u(r,e,i,M,m,a,E,_,w),u(r,M,m,o,h,E,d,_,w)):r.push(d)}function p(r,e,i){let o=r[0],h=o.x,a=o.y;e(o);const d=[o];for(let _=1;_<r.length;_++){const w=r[_],{x:M,y:m}=w;e(w),u(d,h,a,M,m,o,w,e,i),h=M,a=m,o=w}return d}function g(r,e,i,o){if(o(e,i)){const h=e.add(i)._mult(.5);g(r,e,h,o),g(r,h,i,o)}else r.push(i)}function x(r,e){let i=r[0];const o=[i];for(let h=1;h<r.length;h++){const a=r[h];g(o,i,a,e),i=a}return o}const S=Math.pow(2,14)-1,C=-S-1;function L(r,e){const i=Math.round(r.x*e),o=Math.round(r.y*e);return r.x=cn(i,C,S),r.y=cn(o,C,S),(i<r.x||i>r.x+1||o<r.y||o>r.y+1)&&ur("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function R(r,e,i){const o=r.loadGeometry(),h=r.extent,a=mn/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:_,x:w,y:M,projection:m}=i,E=I=>{const b=Ia((e.x+I.x/h)/d),T=ra((e.y+I.y/h)/d),A=m.project(b,T);I.x=(A.x*_-w)*h,I.y=(A.y*_-M)*h};for(let I=0;I<o.length;I++)if(r.type!==1)o[I]=p(o[I],E,1);else{const b=[];for(const T of o[I])T.x<0||T.x>=h||T.y<0||T.y>=h||(E(T),b.push(T));o[I]=b}}for(const d of o)for(const _ of d)L(_,a);return o}function z(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?R(r):[]}}function N(r,e,i,o,h){r.emplaceBack(2*e+(o+1)/2,2*i+(h+1)/2)}function V(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class J{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Dl,this.indexArray=new na,this.segments=new yo,this.programConfigurations=new Jl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,h){const a=this.layers[0],d=[];let _=null;a.type==="circle"&&(_=a.layout.get("circle-sort-key"));for(const{feature:M,id:m,index:E,sourceLayerIndex:I}of e){const b=this.layers[0]._featureFilter.needGeometry,T=z(M,b);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),T,o))continue;const A=_?_.evaluate(T,{},o):void 0,k={id:m,properties:M.properties,type:M.type,sourceLayerIndex:I,index:E,geometry:b?T.geometry:R(M,o,h),patterns:{},sortKey:A};d.push(k)}_&&d.sort((M,m)=>M.sortKey-m.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new rc,w=h.projection);for(const M of d){const{geometry:m,index:E,sourceLayerIndex:I}=M,b=e[E].feature;this.addFeature(M,m,E,i.availableImages,o,w,i.brightness),i.featureIndex.insert(b,m,E,I,this.index)}}update(e,i,o,h,a,d,_){this.programConfigurations.updatePaintArrays(e,i,a,o,h,d,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Of.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Df.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,h,a,d,_){for(const w of i)for(const M of w){const m=M.x,E=M.y;if(m<0||m>=mn||E<0||E>=mn)continue;if(d){const T=d.projectTilePoint(m,E,a),A=d.upVector(a,m,E),k=this.globeExtVertexArray;V(k,T,A),V(k,T,A),V(k,T,A),V(k,T,A)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),b=I.vertexLength;N(this.layoutVertexArray,m,E,-1,-1),N(this.layoutVertexArray,m,E,1,-1),N(this.layoutVertexArray,m,E,1,1),N(this.layoutVertexArray,m,E,-1,1),this.indexArray.emplaceBack(b,b+1,b+2),this.indexArray.emplaceBack(b,b+2,b+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},h,a,_)}}function X(r,e){for(let i=0;i<r.length;i++)if(Me(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Me(r,e[i]))return!0;return!!we(r,e)}function ie(r,e,i){return!!Me(r,e)||!!ze(e,r,i)}function te(r,e){if(r.length===1)return Le(e,r[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let h=0;h<o.length;h++)if(Me(r,o[h]))return!0}for(let i=0;i<r.length;i++)if(Le(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(we(r,e[i]))return!0;return!1}function le(r,e,i){if(r.length>1){if(we(r,e))return!0;for(let o=0;o<e.length;o++)if(ze(e[o],r,i))return!0}for(let o=0;o<r.length;o++)if(ze(r[o],e,i))return!0;return!1}function we(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const o=r[i],h=r[i+1];for(let a=0;a<e.length-1;a++)if(ve(o,h,e[a],e[a+1]))return!0}return!1}function ve(r,e,i,o){return _e(r,i,o)!==_e(e,i,o)&&_e(r,e,i)!==_e(r,e,o)}function ze(r,e,i){const o=i*i;if(e.length===1)return r.distSqr(e[0])<o;for(let h=1;h<e.length;h++)if(Ae(r,e[h-1],e[h])<o)return!0;return!1}function Ae(r,e,i){const o=e.distSqr(i);if(o===0)return r.distSqr(e);const h=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/o;return r.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function Le(r,e){let i,o,h,a=!1;for(let d=0;d<r.length;d++){i=r[d];for(let _=0,w=i.length-1;_<i.length;w=_++)o=i[_],h=i[w],o.y>e.y!=h.y>e.y&&e.x<(h.x-o.x)*(e.y-o.y)/(h.y-o.y)+o.x&&(a=!a)}return a}function Me(r,e){let i=!1;for(let o=0,h=r.length-1;o<r.length;h=o++){const a=r[o],d=r[h];a.y>e.y!=d.y>e.y&&e.x<(d.x-a.x)*(e.y-a.y)/(d.y-a.y)+a.x&&(i=!i)}return i}function He(r,e,i,o,h){for(const d of r)if(e<=d.x&&i<=d.y&&o>=d.x&&h>=d.y)return!0;const a=[new Xi(e,i),new Xi(e,h),new Xi(o,h),new Xi(o,i)];if(r.length>2){for(const d of a)if(Me(r,d))return!0}for(let d=0;d<r.length-1;d++)if(tt(r[d],r[d+1],a))return!0;return!1}function tt(r,e,i){const o=i[0],h=i[2];if(r.x<o.x&&e.x<o.x||r.x>h.x&&e.x>h.x||r.y<o.y&&e.y<o.y||r.y>h.y&&e.y>h.y)return!1;const a=_e(r,e,i[0]);return a!==_e(r,e,i[1])||a!==_e(r,e,i[2])||a!==_e(r,e,i[3])}function Ft(r,e,i,o,h,a){let d=e.y-r.y,_=r.x-e.x;if(a=a||0){const w=d*d+_*_;if(w===0)return!0;const M=Math.sqrt(w);d/=M,_/=M}return!((i.x-r.x)*d+(i.y-r.y)*_-a<0||(o.x-r.x)*d+(o.y-r.y)*_-a<0||(h.x-r.x)*d+(h.y-r.y)*_-a<0)}function Mt(r,e,i,o,h,a,d){return!(Ft(r,e,o,h,a,d)||Ft(e,i,o,h,a,d)||Ft(i,r,o,h,a,d)||Ft(o,h,r,e,i,d)||Ft(h,a,r,e,i,d)||Ft(a,o,r,e,i,d))}function ai(r,e,i){const o=e.paint.get(r).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(r)}function ei(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function yt(r,e,i,o,h){if(!e[0]&&!e[1])return r;const a=Xi.convert(e)._mult(h);i==="viewport"&&a._rotate(-o);const d=[];for(let _=0;_<r.length;_++)d.push(r[_].sub(a));return d}function Ut(r,e,i,o){const h=Xi.convert(r)._mult(o);return e==="viewport"&&h._rotate(-i),h}let Ui,_t;on(J,"CircleBucket",{omit:["layers"]});var _i,Gt={exports:{}},fn=(_i||(_i=1,function(r,e){(function(i){function o(a,d,_){var w=h(256*a,256*(d=Math.pow(2,_)-d-1),_),M=h(256*(a+1),256*(d+1),_);return w[0]+","+w[1]+","+M[0]+","+M[1]}function h(a,d,_){var w=2*Math.PI*6378137/256/Math.pow(2,_);return[a*w-2*Math.PI*6378137/2,d*w-2*Math.PI*6378137/2]}i.getURL=function(a,d,_,w,M,m){return m=m||{},a+"?"+["bbox="+o(_,w,M),"format="+(m.format||"image/png"),"service="+(m.service||"WMS"),"version="+(m.version||"1.1.1"),"request="+(m.request||"GetMap"),"srs="+(m.srs||"EPSG:3857"),"width="+(m.width||256),"height="+(m.height||256),"layers="+d].join("&")},i.getTileBBox=o,i.getMercCoords=h,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Gt.exports)),Gt.exports);class Ri{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=dn(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=fn.getTileBBox(this.x,this.y,this.z),h=function(a,d,_){let w,M="";for(let m=a;m>0;m--)w=1<<m-1,M+=(d&w?1:0)+(_&w?2:0);return M}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class di{constructor(e,i){this.wrap=e,this.canonical=i,this.key=dn(e,i.z,i.z,i.x,i.y)}}class $i{constructor(e,i,o,h,a){this.overscaledZ=e,this.wrap=i,this.canonical=new Ri(o,+h,+a),this.key=i===0&&e===o?this.canonical.key:dn(i,e,o,h,a)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new $i(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $i(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return dn(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return dn(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new $i(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new $i(i,this.wrap,i,o,h),new $i(i,this.wrap,i,o+1,h),new $i(i,this.wrap,i,o,h+1),new $i(i,this.wrap,i,o+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new $i(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new $i(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new di(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function dn(r,e,i,o,h){const a=1<<Math.min(i,22);let d=a*(h%a)+o%a;return r&&i<22&&(d+=a*a*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}const Cn=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new $i(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new $i(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new $i(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new $i(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];on(Ri,"CanonicalTileID"),on($i,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const zn=gs([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:xr}=zn,sr=gs([{name:"a_pos_3",components:3,type:"Int16"}]);var lr=gs([{name:"a_pos",type:"Int16",components:2}]);class Tr{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const h=Pe.vec3.dot(i,this.dir);if(Math.abs(h)<1e-6)return!1;const a=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return o[0]=this.pos[0]+this.dir[0]*a,o[1]=this.pos[1]+this.dir[1]*a,o[2]=this.pos[2]+this.dir[2]*a,!0}closestPointOnSphere(e,i,o){if(Pe.vec3.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[h,a,d]=this.dir,_=this.pos[0]-e[0],w=this.pos[1]-e[1],M=this.pos[2]-e[2],m=h*h+a*a+d*d,E=2*(_*h+w*a+M*d),I=E*E-4*m*(_*_+w*w+M*M-i*i);if(I<0){const b=Math.max(-E/2,0),T=_+h*b,A=w+a*b,k=M+d*b,O=Math.hypot(T,A,k);return o[0]=T*i/O,o[1]=A*i/O,o[2]=k*i/O,!1}{const b=(-E-Math.sqrt(I))/(2*m);if(b<0){const T=Math.hypot(_,w,M);return o[0]=_*i/T,o[1]=w*i/T,o[2]=M*i/T,!1}return o[0]=_+h*b,o[1]=w+a*b,o[2]=M+d*b,!0}}}class Yr{constructor(e,i,o,h,a){this.TL=e,this.TR=i,this.BR=o,this.BL=h,this.horizon=a}static fromInvProjectionMatrix(e,i,o){const h=[-1,1,1],a=[1,1,1],d=[1,-1,1],_=[-1,-1,1],w=Pe.vec3.transformMat4(h,h,e),M=Pe.vec3.transformMat4(a,a,e),m=Pe.vec3.transformMat4(d,d,e),E=Pe.vec3.transformMat4(_,_,e);return new Yr(w,M,m,E,i/o)}}function As(r,e,i){let o=1/0,h=-1/0;const a=[];for(const d of r){Pe.vec3.sub(a,d,e);const _=Pe.vec3.dot(a,i);o=Math.min(o,_),h=Math.max(h,_)}return[o,h]}function ho(r,e){let i=!0;for(let o=0;o<r.planes.length;o++){const h=r.planes[o];let a=0;for(let d=0;d<e.length;d++)a+=Pe.vec3.dot(h,e[d])+h[3]>=0;if(a===0)return 0;a!==e.length&&(i=!1)}return i?2:1}function Ks(r,e){for(const i of r.projections){const o=As(e,r.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function Rr(r,e){let i=0;const o=[0,0,0,0];for(let h=0;h<r.length;h++)o[0]=r[h][0],o[1]=r[h][1],o[2]=r[h][2],o[3]=1,Pe.vec4.dot(o,e)>=0&&i++;return i}class ns{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Wn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Pe.vec3.sub([],this.points[2],this.points[3]),Pe.vec3.sub([],this.points[0],this.points[3]),Pe.vec3.sub([],this.points[4],this.points[0]),Pe.vec3.sub([],this.points[5],this.points[1]),Pe.vec3.sub([],this.points[6],this.points[2]),Pe.vec3.sub([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const h=[0,-o[2],o[1]],a=[o[2],0,-o[0]];this.projections.push({axis:h,projection:As(this.points,this.points[0],h)}),this.projections.push({axis:a,projection:As(this.points,this.points[0],a)})}}static fromInvProjectionMatrix(e,i,o,h){const a=Math.pow(2,o),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const m=Pe.vec4.transformMat4([],M,e),E=1/m[3]/i*a;return Pe.vec4.mul(m,m,[E,E,h?1/m[3]:E,E])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const m=Pe.vec3.sub([],d[M[0]],d[M[1]]),E=Pe.vec3.sub([],d[M[2]],d[M[1]]),I=Pe.vec3.normalize([],Pe.vec3.cross([],m,E)),b=-Pe.vec3.dot(I,d[M[1]]);return I.concat(b)}),w=[];for(let M=0;M<d.length;M++)w.push([d[M][0],d[M][1],d[M][2]]);return new ns(w,_)}intersectsPrecise(e,i,o){for(let h=0;h<i.length;h++)if(!Rr(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Rr(e,this.planes[h]))return 0;for(const h of o)for(const a of this.frustumEdges){const d=Pe.vec3.cross([],h,a),_=Pe.vec3.length(d);if(_===0)continue;Pe.vec3.scale(d,d,1/_);const w=As(this.points,this.points[0],d),M=As(e,this.points[0],d);if(w[0]>M[1]||M[0]>w[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(Pe.vec3.dot([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class Wn{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const h of e)Pe.vec3.min(i,i,h),Pe.vec3.max(o,o,h);return new Wn(i,o)}static fromTileIdAndHeight(e,i,o){const h=1<<e.canonical.z,a=e.canonical.x,d=e.canonical.y;return new Wn([a/h,d/h,i],[(a+1)/h,(d+1)/h,o])}static applyTransform(e,i){const o=e.getCorners();for(let h=0;h<o.length;++h)Pe.vec3.transformMat4(o[h],o[h],i);return Wn.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],h=[...o];for(let a=0;a<3;a++)for(let d=0;d<3;d++){const _=i[4*d+a],w=_*e.min[d],M=_*e.max[d];o[a]+=Math.min(w,M),h[a]+=Math.max(w,M)}return new Wn(o,h)}static projectAabbCorners(e,i){const o=e.getCorners();for(let h=0;h<o.length;++h)Pe.vec3.transformMat4(o[h],o[h],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=Pe.vec3.scale([],Pe.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Pe.vec3.clone(this.min),h=Pe.vec3.clone(this.max);for(let a=0;a<i.length;a++)o[a]=i[a]?this.min[a]:this.center[a],h[a]=i[a]?this.center[a]:this.max[a];return h[2]=this.max[2],new Wn(o,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?ho(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?ho(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Ks(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Ks(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function $r(r){return r*_a/mu}on(Wn,"Aabb");const ps=[new Wn([Na,Na,Na],[Fa,Fa,Fa]),new Wn([Na,Na,Na],[0,0,Fa]),new Wn([0,Na,Na],[Fa,0,Fa]),new Wn([Na,0,Na],[0,Fa,Fa]),new Wn([0,0,Na],[Fa,Fa,Fa])];function _s(r,e,i,o=!0){const h=Pe.vec3.scale([],r._camera.position,r.worldSize),a=[e,i,1,1];Pe.vec4.transformMat4(a,a,r.pixelMatrixInverse),Pe.vec4.scale(a,a,1/a[3]);const d=Pe.vec3.sub([],a,h),_=Pe.vec3.normalize([],d),w=r.globeMatrix,M=[w[12],w[13],w[14]],m=Pe.vec3.sub([],M,h),E=Pe.vec3.length(m),I=Pe.vec3.normalize([],m),b=r.worldSize/(2*Math.PI),T=Pe.vec3.dot(I,_),A=Math.asin(b/E);if(A<Math.acos(T)){if(!o)return null;const Fe=[],ye=[];Pe.vec3.scale(Fe,_,E/T),Pe.vec3.normalize(ye,Pe.vec3.sub(ye,Fe,m)),Pe.vec3.normalize(_,Pe.vec3.add(_,m,Pe.vec3.scale(_,ye,Math.tan(A)*E)))}const k=[];new Tr(h,_).closestPointOnSphere(M,b,k);const O=Pe.vec3.normalize([],Vt(w,0)),U=Pe.vec3.normalize([],Vt(w,1)),G=Pe.vec3.normalize([],Vt(w,2)),B=Pe.vec3.dot(O,k),H=Pe.vec3.dot(U,k),$=Pe.vec3.dot(G,k),ne=un(Math.asin(-H/b));let me=un(Math.atan2(B,$));me=r.center.lng+function(Fe,ye){const Ve=(ye-Fe+180)%360-180;return Ve<-180?Ve+360:Ve}(r.center.lng,me);const de=xl(me),ue=cn(il(ne),0,1);return new n(de,ue)}class so{constructor(e,i,o){this.a=Pe.vec3.sub([],e,o),this.b=Pe.vec3.sub([],i,o),this.center=o;const h=Pe.vec3.normalize([],this.a),a=Pe.vec3.normalize([],this.b);this.angle=Math.acos(Pe.vec3.dot(h,a))}}function Xo(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(o,h,a,d){const _=Math.sin(a);return o*(Math.sin((1-d)*a)/_)+h*(Math.sin(d*a)/_)}(r.a[e],r.b[e],r.angle,cn(i,0,1))+r.center[e]}function Fo(r){if(r.z<=1)return ps[r.z+2*r.y+r.x];const e=js(oo(r));return Wn.fromPoints(e)}function Bo(r,e,i){return Pe.vec3.scale(r,r,1-i),Pe.vec3.scaleAndAdd(r,r,e,i)}function Ba(r,e,i){for(const o of r)Pe.vec3.transformMat4(o,o,e),Pe.vec3.scale(o,o,i)}function ha(r,e,i,o){const h=e/r.worldSize,a=r.globeMatrix;if(i.z<=1){const de=Fo(i).getCorners();return Ba(de,a,h),Wn.fromPoints(de)}const d=oo(i,o),_=js(d,_a+$r(r._tileCoverLift));Ba(_,a,h);const w=Number.MAX_VALUE,M=[-w,-w,-w],m=[w,w,w];if(d.contains(r.center)){for(const Fe of _)Pe.vec3.min(m,m,Fe),Pe.vec3.max(M,M,Fe);M[2]=0;const de=r.point,ue=[de.x*h,de.y*h,0];return Pe.vec3.min(m,m,ue),Pe.vec3.max(M,M,ue),new Wn(m,M)}if(r._tileCoverLift>0){for(const de of _)Pe.vec3.min(m,m,de),Pe.vec3.max(M,M,de);return new Wn(m,M)}const E=[a[12]*h,a[13]*h,a[14]*h],I=d.getCenter(),b=cn(r.center.lat,-vo,vo),T=cn(I.lat,-vo,vo),A=xl(r.center.lng),k=il(b);let O=A-xl(I.lng);const U=k-il(T);O>.5?O-=1:O<-.5&&(O+=1);let G=0;if(Math.abs(O)>Math.abs(U))G=O>=0?1:3;else{G=U>=0?0:2;const de=[a[4]*h,a[5]*h,a[6]*h],ue=-Math.sin(Sr(U>=0?d.getSouth():d.getNorth()))*_a;Pe.vec3.scaleAndAdd(E,E,de,ue)}const B=_[G],H=_[(G+1)%4],$=new so(B,H,E),ne=[Xo($,0)||B[0],Xo($,1)||B[1],Xo($,2)||B[2]],me=ba(r.zoom);if(me>0){const de=function({x:Fe,y:ye,z:Ve},$e,Ze,Qe,ht){const wt=1/(1<<Ve);let st=Fe*wt,Jt=st+wt,zi=ye*wt,Kt=zi+wt,wn=0;const _n=(st+Jt)/2-Qe;return _n>.5?wn=-1:_n<-.5&&(wn=1),st=((st+wn)*$e-(Qe*=$e))*Ze+Qe,Jt=((Jt+wn)*$e-Qe)*Ze+Qe,zi=(zi*$e-(ht*=$e))*Ze+ht,Kt=(Kt*$e-ht)*Ze+ht,[[st,Kt,0],[Jt,Kt,0],[Jt,zi,0],[st,zi,0]]}(i,e,r._pixelsPerMercatorPixel,A,k);for(let Fe=0;Fe<_.length;Fe++)Bo(_[Fe],de[Fe],me);const ue=Pe.vec3.add([],de[G],de[(G+1)%4]);Pe.vec3.scale(ue,ue,.5),Bo(ne,ue,me)}for(const de of _)Pe.vec3.min(m,m,de),Pe.vec3.max(M,M,de);return m[2]=Math.min(B[2],H[2]),Pe.vec3.min(m,m,ne),Pe.vec3.max(M,M,ne),new Wn(m,M)}function oo({x:r,y:e,z:i},o=!1){const h=1/(1<<i),a=new as(Ia(r*h),e===(1<<i)-1&&o?-90:ra((e+1)*h)),d=new as(Ia((r+1)*h),e===0&&o?90:ra(e*h));return new Ql(a,d)}function js(r,e=_a){const i=Sr(r.getNorth()),o=Sr(r.getSouth()),h=Math.cos(i),a=Math.cos(o),d=Math.sin(i),_=Math.sin(o),w=r.getWest(),M=r.getEast();return[Fu(a,_,w,e),Fu(a,_,M,e),Fu(h,d,M,e),Fu(h,d,w,e)]}function Fs(r,e,i,o){const h=1<<i.z,a=(r/mn+i.x)/h;return pu(ra((e/mn+i.y)/h),Ia(a),o)}function Kr({min:r,max:e}){return Bd/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const Io=new Float64Array(16);function $o(r){const e=Kr(r),i=Pe.mat4.fromScaling(Io,[e,e,e]);return Pe.mat4.translate(i,i,Pe.vec3.negate([],r.min))}function Us(r){const e=Pe.mat4.fromTranslation(Io,r.min),i=1/Kr(r);return Pe.mat4.scale(e,e,[i,i,i])}function da(r){const e=mn/(2*Math.PI);return r/(2*Math.PI)/e}function Za(r,e){return mn/(512*Math.pow(2,r))*Kr(Fo(e))}function Ma(r,e,i,o,h){const a=da(i),d=[r,e,-i/(2*Math.PI)],_=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.translate(_,_,d),Pe.mat4.scale(_,_,[a,a,a]),Pe.mat4.rotateX(_,_,Sr(-h)),Pe.mat4.rotateY(_,_,Sr(-o)),_}function ba(r){return Jr(zu,Fd,r)}function bl(r,e){const i=pu(e.lat,e.lng),o=function(a){const d=pu(a._center.lat,a._center.lng),_=Pe.vec3.fromValues(0,1,0);let w=Pe.vec3.cross([],_,d);const M=Pe.mat4.fromRotation([],-a.angle,d);w=Pe.vec3.transformMat4(w,w,M),Pe.mat4.fromRotation(M,-a._pitch,w);const m=Pe.vec3.normalize([],d);return Pe.vec3.scale(m,m,$r(a.cameraToCenterDistance/a.pixelsPerMeter)),Pe.vec3.transformMat4(m,m,M),Pe.vec3.add([],d,m)}(r),h=Pe.vec3.subtract([],o,i);return Pe.vec3.angle(h,i)}function Xa(r,e){return bl(r,e)>Math.PI/2*1.01}const Ua=Sr(85),gu=Math.cos(Ua),wl=Math.sin(Ua),_u=Pe.mat4.create(),Uu=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Hc(r,e,i,o,h,a,d,_,w){if(a&&r.queryGeometry.isAboveHorizon)return!1;a&&(w*=r.pixelToTileUnitsFactor);const M=r.tileID.canonical,m=i.projection.upVectorScale(M,i.center.lat,i.worldSize).metersToTile;for(const E of e)for(const I of E){const b=I.add(_),T=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(b.x,b.y,!0):0,A=i.projection.projectTilePoint(b.x,b.y,M);if(T>0){const G=i.projection.upVector(M,b.x,b.y);A.x+=G[0]*m*T,A.y+=G[1]*m*T,A.z+=G[2]*m*T}const k=a?b:zh(A.x,A.y,A.z,o),O=a?r.tilespaceRays.map(G=>Dy(G,T)):r.queryGeometry.screenGeometry,U=Pe.vec4.transformMat4([],[A.x,A.y,A.z,1],o);if(!d&&a?w*=U[3]/i.cameraToCenterDistance:d&&!a&&(w*=i.cameraToCenterDistance/U[3]),a){const G=ra((I.y/mn+M.y)/(1<<M.z));w/=i.projection.pixelsPerMeter(G,1)/ya(1,G)}if(ie(O,k,w))return!0}return!1}function zh(r,e,i,o){const h=Pe.vec4.transformMat4([],[r,e,i,1],o);return new Xi(h[0]/h[3],h[1]/h[3])}const om=Pe.vec3.fromValues(0,0,0),Oy=Pe.vec3.fromValues(0,0,1);function Dy(r,e){const i=Pe.vec3.create();return om[2]=e,r.intersectsPlane(om,Oy,i),new Xi(i[0],i[1])}class am extends J{}let lm,um,cm,hm;function dm(r,{width:e,height:i},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*o)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*o);return r.width=e,r.height=i,r.data=h,r}function fm(r,e,i){const{width:o,height:h}=e;o===r.width&&h===r.height||(jf(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,o),height:Math.min(r.height,h)},i,null),r.width=o,r.height=h,r.data=e.data)}function jf(r,e,i,o,h,a,d,_){if(h.width===0||h.height===0)return e;if(h.width>r.width||h.height>r.height||i.x>r.width-h.width||i.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||o.x>e.width-h.width||o.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const w=r.data,M=e.data,m=a===4&&_;for(let E=0;E<h.height;E++){const I=((i.y+E)*r.width+i.x)*a,b=((o.y+E)*e.width+o.x)*a;if(m)for(let T=0;T<h.width;T++){const A=I+T*a+3,k=b+T*a;M[k+0]=255,M[k+1]=255,M[k+2]=255,M[k+3]=w[A]}else if(d)for(let T=0;T<h.width;T++){const A=I+T*a,k=b+T*a,O=w[A+3],U=new W(w[A+0]/255*O,w[A+1]/255*O,w[A+2]/255*O,O).toRenderColor(d).toArray();M[k+0]=U[0],M[k+1]=U[1],M[k+2]=U[2],M[k+3]=U[3]}else for(let T=0;T<h.width*a;T++)M[b+T]=w[I+T]}return e}on(am,"HeatmapBucket",{omit:["layers"]});class Vu{constructor(e,i){dm(this,e,1,i)}resize(e){fm(this,new Vu(e),1)}clone(){return new Vu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,a){jf(e,i,o,h,a,1,null)}}class aa{constructor(e,i){dm(this,e,4,i)}resize(e){fm(this,new aa(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new aa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,a,d,_){jf(e,i,o,h,a,4,d,_)}}class pm{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Nh(r){const e={},i=r.resolution||256,o=r.clips?r.clips.length:1,h=r.image||new aa({width:i,height:o}),a=(d,_,w)=>{e[r.evaluationKey]=w;const M=r.expression.evaluate(e);M&&(h.data[d+_+0]=Math.floor(255*M.r/M.a),h.data[d+_+1]=Math.floor(255*M.g/M.a),h.data[d+_+2]=Math.floor(255*M.b/M.a),h.data[d+_+3]=Math.floor(255*M.a))};if(r.clips)for(let d=0,_=0;d<o;++d,_+=4*i)for(let w=0,M=0;w<i;w++,M+=4){const m=w/(i-1),{start:E,end:I}=r.clips[d];a(_,M,E*(1-m)+I*m)}else for(let d=0,_=0;d<i;d++,_+=4)a(0,_,d/(i-1));return h}on(Vu,"AlphaImage"),on(aa,"RGBAImage");const zy=gs([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ny}=zy;function Fh(r,e,i=2){const o=e&&e.length,h=o?e[0]*i:r.length;let a=mm(r,0,h,i,!0);const d=[];if(!a||a.next===a.prev)return d;let _,w,M;if(o&&(a=function(m,E,I,b){const T=[];for(let A=0,k=E.length;A<k;A++){const O=mm(m,E[A]*b,A<k-1?E[A+1]*b:m.length,b,!1);O===O.next&&(O.steiner=!0),T.push(Hy(O))}T.sort(Gy);for(let A=0;A<T.length;A++)I=jy(T[A],I);return I}(r,e,a,i)),r.length>80*i){_=1/0,w=1/0;let m=-1/0,E=-1/0;for(let I=i;I<h;I+=i){const b=r[I],T=r[I+1];b<_&&(_=b),T<w&&(w=T),b>m&&(m=b),T>E&&(E=T)}M=Math.max(m-_,E-w),M=M!==0?32767/M:0}return Bh(a,d,i,_,w,M,0),d}function mm(r,e,i,o,h){let a;if(h===function(d,_,w,M){let m=0;for(let E=_,I=w-M;E<w;E+=M)m+=(d[I]-d[E])*(d[E+1]+d[I+1]),I=E;return m}(r,e,i,o)>0)for(let d=e;d<i;d+=o)a=ym(d/o|0,r[d],r[d+1],a);else for(let d=i-o;d>=e;d-=o)a=ym(d/o|0,r[d],r[d+1],a);return a&&Vd(a,a.next)&&(Vh(a),a=a.next),a}function _c(r,e){if(!r)return r;e||(e=r);let i,o=r;do if(i=!1,o.steiner||!Vd(o,o.next)&&Wo(o.prev,o,o.next)!==0)o=o.next;else{if(Vh(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Bh(r,e,i,o,h,a,d){if(!r)return;!d&&a&&function(w,M,m,E){let I=w;do I.z===0&&(I.z=qf(I.x,I.y,M,m,E)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==w);I.prevZ.nextZ=null,I.prevZ=null,function(b){let T,A=1;do{let k,O=b;b=null;let U=null;for(T=0;O;){T++;let G=O,B=0;for(let $=0;$<A&&(B++,G=G.nextZ,G);$++);let H=A;for(;B>0||H>0&&G;)B!==0&&(H===0||!G||O.z<=G.z)?(k=O,O=O.nextZ,B--):(k=G,G=G.nextZ,H--),U?U.nextZ=k:b=k,k.prevZ=U,U=k;O=G}U.nextZ=null,A*=2}while(T>1)}(I)}(r,o,h,a);let _=r;for(;r.prev!==r.next;){const w=r.prev,M=r.next;if(a?By(r,o,h,a):Fy(r))e.push(w.i,r.i,M.i),Vh(r),r=M.next,_=M.next;else if((r=M)===_){d?d===1?Bh(r=Uy(_c(r),e),e,i,o,h,a,2):d===2&&Vy(r,e,i,o,h,a):Bh(_c(r),e,i,o,h,a,1);break}}}function Fy(r){const e=r.prev,i=r,o=r.next;if(Wo(e,i,o)>=0)return!1;const h=e.x,a=i.x,d=o.x,_=e.y,w=i.y,M=o.y,m=h<a?h<d?h:d:a<d?a:d,E=_<w?_<M?_:M:w<M?w:M,I=h>a?h>d?h:d:a>d?a:d,b=_>w?_>M?_:M:w>M?w:M;let T=o.next;for(;T!==e;){if(T.x>=m&&T.x<=I&&T.y>=E&&T.y<=b&&Zc(h,_,a,w,d,M,T.x,T.y)&&Wo(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function By(r,e,i,o){const h=r.prev,a=r,d=r.next;if(Wo(h,a,d)>=0)return!1;const _=h.x,w=a.x,M=d.x,m=h.y,E=a.y,I=d.y,b=_<w?_<M?_:M:w<M?w:M,T=m<E?m<I?m:I:E<I?E:I,A=_>w?_>M?_:M:w>M?w:M,k=m>E?m>I?m:I:E>I?E:I,O=qf(b,T,e,i,o),U=qf(A,k,e,i,o);let G=r.prevZ,B=r.nextZ;for(;G&&G.z>=O&&B&&B.z<=U;){if(G.x>=b&&G.x<=A&&G.y>=T&&G.y<=k&&G!==h&&G!==d&&Zc(_,m,w,E,M,I,G.x,G.y)&&Wo(G.prev,G,G.next)>=0||(G=G.prevZ,B.x>=b&&B.x<=A&&B.y>=T&&B.y<=k&&B!==h&&B!==d&&Zc(_,m,w,E,M,I,B.x,B.y)&&Wo(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;G&&G.z>=O;){if(G.x>=b&&G.x<=A&&G.y>=T&&G.y<=k&&G!==h&&G!==d&&Zc(_,m,w,E,M,I,G.x,G.y)&&Wo(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;B&&B.z<=U;){if(B.x>=b&&B.x<=A&&B.y>=T&&B.y<=k&&B!==h&&B!==d&&Zc(_,m,w,E,M,I,B.x,B.y)&&Wo(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function Uy(r,e){let i=r;do{const o=i.prev,h=i.next.next;!Vd(o,h)&&gm(o,i,i.next,h)&&Uh(o,h)&&Uh(h,o)&&(e.push(o.i,i.i,h.i),Vh(i),Vh(i.next),i=r=h),i=i.next}while(i!==r);return _c(i)}function Vy(r,e,i,o,h,a){let d=r;do{let _=d.next.next;for(;_!==d.prev;){if(d.i!==_.i&&Zy(d,_)){let w=_m(d,_);return d=_c(d,d.next),w=_c(w,w.next),Bh(d,e,i,o,h,a,0),void Bh(w,e,i,o,h,a,0)}_=_.next}d=d.next}while(d!==r)}function Gy(r,e){return r.x-e.x}function jy(r,e){const i=function(h,a){let d=a;const _=h.x,w=h.y;let M,m=-1/0;do{if(w<=d.y&&w>=d.next.y&&d.next.y!==d.y){const A=d.x+(w-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(A<=_&&A>m&&(m=A,M=d.x<d.next.x?d:d.next,A===_))return M}d=d.next}while(d!==a);if(!M)return null;const E=M,I=M.x,b=M.y;let T=1/0;d=M;do{if(_>=d.x&&d.x>=I&&_!==d.x&&Zc(w<b?_:m,w,I,b,w<b?m:_,w,d.x,d.y)){const A=Math.abs(w-d.y)/(_-d.x);Uh(d,h)&&(A<T||A===T&&(d.x>M.x||d.x===M.x&&qy(M,d)))&&(M=d,T=A)}d=d.next}while(d!==E);return M}(r,e);if(!i)return e;const o=_m(i,r);return _c(o,o.next),_c(i,i.next)}function qy(r,e){return Wo(r.prev,r,e.prev)<0&&Wo(e.next,r,r.next)<0}function qf(r,e,i,o,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Hy(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Zc(r,e,i,o,h,a,d,_){return(h-d)*(e-_)>=(r-d)*(a-_)&&(r-d)*(o-_)>=(i-d)*(e-_)&&(i-d)*(a-_)>=(h-d)*(o-_)}function Zy(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,o){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==o.i&&h.next.i!==o.i&&gm(h,h.next,i,o))return!0;h=h.next}while(h!==i);return!1}(r,e)&&(Uh(r,e)&&Uh(e,r)&&function(i,o){let h=i,a=!1;const d=(i.x+o.x)/2,_=(i.y+o.y)/2;do h.y>_!=h.next.y>_&&h.next.y!==h.y&&d<(h.next.x-h.x)*(_-h.y)/(h.next.y-h.y)+h.x&&(a=!a),h=h.next;while(h!==i);return a}(r,e)&&(Wo(r.prev,r,e.prev)||Wo(r,e.prev,e))||Vd(r,e)&&Wo(r.prev,r,r.next)>0&&Wo(e.prev,e,e.next)>0)}function Wo(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Vd(r,e){return r.x===e.x&&r.y===e.y}function gm(r,e,i,o){const h=jd(Wo(r,e,i)),a=jd(Wo(r,e,o)),d=jd(Wo(i,o,r)),_=jd(Wo(i,o,e));return h!==a&&d!==_||!(h!==0||!Gd(r,i,e))||!(a!==0||!Gd(r,o,e))||!(d!==0||!Gd(i,r,o))||!(_!==0||!Gd(i,e,o))}function Gd(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function jd(r){return r>0?1:r<0?-1:0}function Uh(r,e){return Wo(r.prev,r,r.next)<0?Wo(r,e,r.next)>=0&&Wo(r,r.prev,e)>=0:Wo(r,e,r.prev)<0||Wo(r,r.next,e)<0}function _m(r,e){const i=Hf(r.i,r.x,r.y),o=Hf(e.i,e.x,e.y),h=r.next,a=e.prev;return r.next=e,e.prev=r,i.next=h,h.prev=i,o.next=i,i.prev=o,a.next=o,o.prev=a,o}function ym(r,e,i,o){const h=Hf(r,e,i);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function Vh(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Hf(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function qd(r,e){const i=r.length;if(i<=1)return[r];const o=[];let h,a;for(let d=0;d<i;d++){const _=he(r[d]);_!==0&&(r[d].area=Math.abs(_),a===void 0&&(a=_<0),a===_<0?(h&&o.push(h),h=[r[d]]):h.push(r[d]))}if(h&&o.push(h),e>1)for(let d=0;d<o.length;d++)o[d].length<=e||(Zi(o[d],e,1,o[d].length-1,Xy),o[d]=o[d].slice(0,e));return o}function Xy(r,e){return e.area-r.area}function vm(r,e,i=1){if(!r)return null;const o=typeof r=="string"?r:r.getPrimary().id;e[o]||(e[o]=[]);const h=oi.from(o).getPrimary().scaleSelf(i);return e[o].push(h),h.serialize()}function Zf(r,e,i,o){const h=o.patternDependencies;let a=!1;for(const d of e){const _=d.paint.get(`${r}-pattern`);_.isConstant()||(a=!0),vm(_.constantOr(null),h,i)&&(a=!0)}return a}function Xf(r,e,i,o,h,a){const d=a.patternDependencies;for(const _ of e){const w=_.paint.get(`${r}-pattern`).value;if(w.kind!=="constant"){let M=w.evaluate({zoom:o},i,{},a.availableImages);M=M&&M.name?M.name:M;const m=vm(M,d,h);m&&(i.patterns[_.id]=m)}}return i}class $f{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Dl,this.indexArray=new na,this.indexArray2=new Wl,this.programConfigurations=new Jl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new yo,this.segments2=new yo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,o,h){this.hasPattern=Zf("fill",this.layers,this.pixelRatio,i);const a=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:_,id:w,index:M,sourceLayerIndex:m}of e){const E=this.layers[0]._featureFilter.needGeometry,I=z(_,E);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),I,o))continue;const b=a?a.evaluate(I,{},o,i.availableImages):void 0,T={id:w,properties:_.properties,type:_.type,sourceLayerIndex:m,index:M,geometry:E?I.geometry:R(_,o,h),patterns:{},sortKey:b};d.push(T)}a&&d.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of d){const{geometry:w,index:M,sourceLayerIndex:m}=_;if(this.hasPattern){const E=Xf("fill",this.layers,_,this.zoom,this.pixelRatio,i);this.patternFeatures.push(E)}else this.addFeature(_,w,M,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[M].feature,w,M,m,this.index)}}update(e,i,o,h,a,d,_){this.programConfigurations.updatePaintArrays(e,i,a,o,h,d,_)}addFeatures(e,i,o,h,a,d){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,o,h,d,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ny),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,h,a,d=[],_,w){for(const M of qd(i,500)){let m=0;for(const k of M)m+=k.length;const E=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),I=E.vertexLength,b=[],T=[];for(const k of M){if(k.length===0)continue;k!==M[0]&&T.push(b.length/2);const O=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),U=O.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(U+k.length-1,U),b.push(k[0].x),b.push(k[0].y);for(let G=1;G<k.length;G++)this.layoutVertexArray.emplaceBack(k[G].x,k[G].y),this.indexArray2.emplaceBack(U+G-1,U+G),b.push(k[G].x),b.push(k[G].y);O.vertexLength+=k.length,O.primitiveLength+=k.length}const A=Fh(b,T);for(let k=0;k<A.length;k+=3)this.indexArray.emplaceBack(I+A[k],I+A[k+1],I+A[k+2]);E.vertexLength+=m,E.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,a,d,h,_)}}let xm,bm,wm,Em;on($f,"FillBucket",{omit:["layers","patternFeatures"]});class Wf{constructor(e,i,o,h){if(this.triangleCount=i.length/3,this.min=new Xi(0,0),this.max=new Xi(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[a,d]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){const I=e[E];a.x=Math.min(a.x,I.x),a.y=Math.min(a.y,I.y),d.x=Math.max(d.x,I.x),d.y=Math.max(d.y,I.y)}if(h){const E=Math.ceil(Math.max(d.x-a.x,d.y-a.y)/h);o=Math.max(o,E)}if(o===0)return;this.min=a,this.max=d;const _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);const w=Math.max(_.x,_.y)/o;this.cellsX=Math.max(1,Math.ceil(_.x/w)),this.cellsY=Math.max(1,Math.ceil(_.y/w)),this.xScale=1/w,this.yScale=1/w;const M=[];for(let E=0;E<this.triangleCount;E++){const I=e[i[3*E+0]].sub(this.min),b=e[i[3*E+1]].sub(this.min),T=e[i[3*E+2]].sub(this.min),A=eu(Math.floor(Math.min(I.x,b.x,T.x)),this.xScale,this.cellsX),k=eu(Math.floor(Math.max(I.x,b.x,T.x)),this.xScale,this.cellsX),O=eu(Math.floor(Math.min(I.y,b.y,T.y)),this.yScale,this.cellsY),U=eu(Math.floor(Math.max(I.y,b.y,T.y)),this.yScale,this.cellsY),G=new Xi(0,0),B=new Xi(0,0),H=new Xi(0,0),$=new Xi(0,0);for(let ne=O;ne<=U;++ne){G.y=B.y=ne*w,H.y=$.y=(ne+1)*w;for(let me=A;me<=k;++me)G.x=H.x=me*w,B.x=$.x=(me+1)*w,(Mt(I,b,T,G,B,$)||Mt(I,b,T,G,$,H))&&M.push({cellIdx:ne*this.cellsX+me,triIdx:E})}}if(M.length===0)return;M.sort((E,I)=>E.cellIdx-I.cellIdx||E.triIdx-I.triIdx);let m=0;for(;m<M.length;){const E=M[m].cellIdx,I={start:this.payload.length,len:0};for(;m<M.length&&M[m].cellIdx===E;)++I.len,this.payload.push(M[m++].triIdx);this.cells[E]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=eu(e.x-this.min.x,this.xScale,this.cellsX),h=eu(e.y-this.min.y,this.yScale,this.cellsY),a=this.cells[h*this.cellsX+o];if(a){this._lazyInitLookup();for(let d=0;d<a.len;d++){const _=this.payload[a.start+d],w=Math.floor(_/8),M=1<<_%8;if(!(this.lookup[w]&M)&&(this.lookup[w]|=M,i.push(_),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=eu(e.x-this.min.x,this.xScale,this.cellsX),a=eu(i.x-this.min.x,this.xScale,this.cellsX),d=eu(e.y-this.min.y,this.yScale,this.cellsY),_=eu(i.y-this.min.y,this.yScale,this.cellsY);for(let w=d;w<=_;w++)for(let M=h;M<=a;M++){const m=this.cells[w*this.cellsX+M];if(m)for(let E=0;E<m.len;E++){const I=this.payload[m.start+E],b=Math.floor(I/8),T=1<<I%8;if(!(this.lookup[b]&T)&&(this.lookup[b]|=T,o.push(I),o.length===this.triangleCount))return}}}}function eu(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}on(Wf,"TriangleGridIndex");class Tm{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,h){const a=[];for(const{feature:d,id:_,index:w,sourceLayerIndex:M}of e){const m=this.layers[0]._featureFilter.needGeometry,E=z(d,m);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),E,o))continue;const I={id:_,properties:d.properties,type:d.type,sourceLayerIndex:M,index:w,geometry:m?E.geometry:R(d,o,h),patterns:{}};a.push(I)}for(const d of a){const{geometry:_,index:w,sourceLayerIndex:M}=d;this.addFeature(d,_,w,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[w].feature,_,w,M,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,h,a,d,_){}destroy(){}addFeature(e,i,o,h,a,d=[],_){for(const w of qd(i,2)){const M=[],m=[],E=[],I=new Xi(1/0,1/0),b=new Xi(-1/0,-1/0);for(const k of w)if(k.length!==0){k!==w[0]&&E.push(m.length/2);for(let O=0;O<k.length;O++)m.push(k[O].x),m.push(k[O].y),M.push(k[O]),I.x=Math.min(I.x,k[O].x),I.y=Math.min(I.y,k[O].y),b.x=Math.max(b.x,k[O].x),b.y=Math.max(b.y,k[O].y)}const T=Fh(m,E),A=new Wf(M,T,8,256);this.footprints.push({vertices:M,indices:T,grid:A,min:I,max:b})}}}on(Tm,"ClipBucket",{omit:["layers"]});const $y=gs([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Wy=gs([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Yy=gs([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ky=gs([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Jy=gs([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Qy=gs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:e0}=$y;var Yf,Sm,Kf,Im,Jf,Mm,Am,Hd={};function Cm(){if(Sm)return Yf;Sm=1;var r=cs();function e(h,a,d,_,w){this.properties={},this.extent=d,this.type=0,this._pbf=h,this._geometry=-1,this._keys=_,this._values=w,h.readFields(i,this,a)}function i(h,a,d){h==1?a.id=d.readVarint():h==2?function(_,w){for(var M=_.readVarint()+_.pos;_.pos<M;){var m=w._keys[_.readVarint()],E=w._values[_.readVarint()];w.properties[m]=E}}(d,a):h==3?a.type=d.readVarint():h==4&&(a._geometry=d.pos)}function o(h){for(var a,d,_=0,w=0,M=h.length,m=M-1;w<M;m=w++)_+=((d=h[m]).x-(a=h[w]).x)*(a.y+d.y);return _}return Yf=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var a,d=h.readVarint()+h.pos,_=1,w=0,M=0,m=0,E=[];h.pos<d;){if(w<=0){var I=h.readVarint();_=7&I,w=I>>3}if(w--,_===1||_===2)M+=h.readSVarint(),m+=h.readSVarint(),_===1&&(a&&E.push(a),a=[]),a.push(new r(M,m));else{if(_!==7)throw new Error("unknown command "+_);a&&a.push(a[0].clone())}}return a&&E.push(a),E},e.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var a=h.readVarint()+h.pos,d=1,_=0,w=0,M=0,m=1/0,E=-1/0,I=1/0,b=-1/0;h.pos<a;){if(_<=0){var T=h.readVarint();d=7&T,_=T>>3}if(_--,d===1||d===2)(w+=h.readSVarint())<m&&(m=w),w>E&&(E=w),(M+=h.readSVarint())<I&&(I=M),M>b&&(b=M);else if(d!==7)throw new Error("unknown command "+d)}return[m,I,E,b]},e.prototype.toGeoJSON=function(h,a,d){var _,w,M=this.extent*Math.pow(2,d),m=this.extent*h,E=this.extent*a,I=this.loadGeometry(),b=e.types[this.type];function T(O){for(var U=0;U<O.length;U++){var G=O[U];O[U]=[360*(G.x+m)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+E)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(_=0;_<I.length;_++)A[_]=I[_][0];T(I=A);break;case 2:for(_=0;_<I.length;_++)T(I[_]);break;case 3:for(I=function(O){var U=O.length;if(U<=1)return[O];for(var G,B,H=[],$=0;$<U;$++){var ne=o(O[$]);ne!==0&&(B===void 0&&(B=ne<0),B===ne<0?(G&&H.push(G),G=[O[$]]):G.push(O[$]))}return G&&H.push(G),H}(I),_=0;_<I.length;_++)for(w=0;w<I[_].length;w++)T(I[_][w])}I.length===1?I=I[0]:b="Multi"+b;var k={type:"Feature",geometry:{type:b,coordinates:I},properties:this.properties};return"id"in this&&(k.id=this.id),k},Yf}function Pm(){if(Im)return Kf;Im=1;var r=Cm();function e(o,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,h),this.length=this._features.length}function i(o,h,a){o===15?h.version=a.readVarint():o===1?h.name=a.readString():o===5?h.extent=a.readVarint():o===2?h._features.push(a.pos):o===3?h._keys.push(a.readString()):o===4&&h._values.push(function(d){for(var _=null,w=d.readVarint()+d.pos;d.pos<w;){var M=d.readVarint()>>3;_=M===1?d.readString():M===2?d.readFloat():M===3?d.readDouble():M===4?d.readVarint64():M===5?d.readVarint():M===6?d.readSVarint():M===7?d.readBoolean():null}return _}(a))}return Kf=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var h=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,h,this.extent,this._keys,this._values)},Kf}function Lm(){return Am||(Am=1,Hd.VectorTile=function(){if(Mm)return Jf;Mm=1;var r=Pm();function e(i,o,h){if(i===3){var a=new r(h,h.readVarint()+h.pos);a.length&&(o[a.name]=a)}}return Jf=function(i,o){this.layers=i.readFields(e,{},o)},Jf}(),Hd.VectorTileFeature=Cm(),Hd.VectorTileLayer=Pm()),Hd}var Xc=Lm();class yc extends Xi{constructor(e,i,o){super(e,i),this.z=o}}class Rm extends yc{constructor(e,i,o,h){super(e,i,o),this.w=h}}function Zd(r,e,i,o){const h=[],a=o===0?(d,_,w,M,m,E)=>{d.push(new Xi(E,w+(E-_)/(M-_)*(m-w)))}:(d,_,w,M,m,E)=>{d.push(new Xi(_+(E-w)/(m-w)*(M-_),E))};for(const d of r){const _=[];for(const w of d){if(w.length<=2)continue;const M=[];for(let I=0;I<w.length-1;I++){const b=w[I].x,T=w[I].y,A=w[I+1].x,k=w[I+1].y,O=o===0?b:T,U=o===0?A:k;O<e?U>e&&a(M,b,T,A,k,e):O>i?U<i&&a(M,b,T,A,k,i):M.push(w[I]),U<e&&O>=e&&a(M,b,T,A,k,e),U>i&&O<=i&&a(M,b,T,A,k,i)}let m=w[w.length-1];const E=o===0?m.x:m.y;E>=e&&E<=i&&M.push(m),M.length&&(m=M[M.length-1],M[0].x===m.x&&M[0].y===m.y||M.push(M[0]),_.push(M))}_.length&&h.push(_)}return h}function km(r,e,i,o){const h=i==="x"?"y":"x",a=(o-r[i])/(e[i]-r[i]);r[h]=r[h]+(e[h]-r[h])*a,r[i]=o,r.hasOwnProperty("z")&&(r.z=Ye(r.z,e.z,a)),r.hasOwnProperty("w")&&(r.w=Ye(r.w,e.w,a))}function Om(r,e,i,o){const h=i,a=o;for(const d of["x","y"]){let _=r,w=e;_[d]>=w[d]&&(_=e,w=r),_[d]<h&&w[d]>h&&km(_,w,d,h),_[d]<a&&w[d]>a&&km(w,_,d,a)}}const Xd=Number.MAX_SAFE_INTEGER;function Dm(r,e,i,o){return r.order<e||r.order===Xd||!(r.clipMask&i)||function(h,a){return a.length!==0&&a.find(d=>d===h)===void 0}(o,r.clipScope)}function $d(r,e){return r.x-e.x||r.y-e.y}function zm(r,e){return $d(r.min,e.min)===0&&$d(r.max,e.max)===0}function Qf(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function ep(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!zm(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!vs(r[i].clipScope,e[i].clipScope))return!1;return!0}function Nm(r,e,i){const o=1/mn,h=1/(1<<i.canonical.z),a=(e.x*o+i.canonical.x)*h+i.wrap,d=(e.y*o+i.canonical.y)*h;return{min:new Xi((r.x*o+i.canonical.x)*h+i.wrap,(r.y*o+i.canonical.y)*h),max:new Xi(a,d)}}function t0(r,e,i){const o=1<<i.canonical.z,h=((e.x-i.wrap)*o-i.canonical.x)*mn,a=(e.y*o-i.canonical.y)*mn;return{min:new Xi(((r.x-i.wrap)*o-i.canonical.x)*mn,(r.y*o-i.canonical.y)*mn),max:new Xi(h,a)}}function Fm(r,e,i,o,h,a,d){const _=r.indices,w=r.vertices,M=[];for(let m=o;m<o+h;m+=3){const E=e[i[m+0]+a],I=e[i[m+1]+a],b=e[i[m+2]+a],T=Math.min(E.x,I.x,b.x),A=Math.max(E.x,I.x,b.x),k=Math.min(E.y,I.y,b.y),O=Math.max(E.y,I.y,b.y);M.length=0,r.grid.query(new Xi(T,k),new Xi(A,O),M);for(let U=0;U<M.length;U++){const G=M[U];if(Mt(w[_[3*G+0]],w[_[3*G+1]],w[_[3*G+2]],E,I,b,d))return!0}}return!1}function Bm(r,e,i,o){if(!r||!i)return!1;let h=r.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<r.vertices.length)return Bm(i,o,r,e);const a=e.canonical,d=o.canonical,_=Math.pow(2,d.z-a.z);h=r.vertices.map(w=>new Xi((w.x+a.x*mn)*_-d.x*mn,(w.y+a.y*mn)*_-d.y*mn))}return Fm(i,h,r.indices,0,r.indices.length,0,0)}function Um(r,e,i,o){const h=Math.pow(2,o.z-i.z);return new Xi((r+i.x*mn)*h-o.x*mn,(e+i.y*mn)*h-o.y*mn)}function Vm(r,e){const i=[];e.grid.queryPoint(r,i);const o=e.indices,h=e.vertices;for(let a=0;a<i.length;a++){const d=i[a];if(Me([h[o[3*d+0]],h[o[3*d+1]],h[o[3*d+2]]],r))return!0}return!1}const tp=[new Xi(0,0),new Xi(mn,0),new Xi(mn,mn),new Xi(0,mn)];function Gm(r,e){const i=[];let o=[];if(!e||r.length<2)return[r];if(r.length===2)return tt(r[0],r[1],tp)?[r]:[];for(let h=0;h<r.length+2;h++){const a=r[h%r.length],d=r[(h+1)%r.length],_=tt(h===0?r[r.length-1]:r[(h-1)%r.length],a,tp),w=tt(a,d,tp),M=_||w;M&&o.push(a),M&&w||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const ip=Xc.VectorTileFeature.types,i0=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],n0=["fill-extrusion-flood-light-ground-radius"],r0=Math.pow(2,13),s0=Math.pow(2,15)-1,jm=new Xi(0,1),Gu=2147483648;function Gh(r,e,i,o,h,a,d,_){r.emplaceBack((e<<1)+d,(i<<1)+a,(Math.floor(o*r0)<<1)+h,Math.round(_))}function jh(r,e,i){r.emplaceBack(e.x*mn,e.y*mn,i?1:0)}function Wd(r,e,i,o,h,a){r.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+h,a)}function qh(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class qm{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Hm{constructor(){this.centroidXY=new Xi(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Xi(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Xi(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Xi(this.max.x-this.min.x,this.max.y-this.min.y)}}class Zm{constructor(){this.acc=new Xi(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===mn)&&i.x===o.x)!=((i.y===0||i.y===mn)&&i.y===o.y)&&this.processBorderOverlap(i,o),h&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Ye(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>mn!=e.x>mn&&this.addBorderIntersection(1,Ye(i.y,e.y,(mn-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ye(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>mn!=e.y>mn&&this.addBorderIntersection(3,Ye(i.x,e.x,(mn-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Xi(0,0):new Xi(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Xm(r,e){const i=r.add(e)._unit(),o=cn(r.x*i.x+r.y*i.y,-1,1);var h,a,d;return d=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(d)))/4*s0*((h=r).x*(a=e).y-h.y*a.x<0?-1:1)}const o0=[r=>r.x<0,r=>r.x>mn,r=>r.y<0,r=>r.y>mn];function a0(r,e,i,o){const h=[4];if(o===0)return h;i._mult(o);const a=r.sub(i),d=e.sub(i),_=[r,e,a,d];for(let w=0;w<4;w++)for(const M of _)if(o0[w](M)){h.push(w);break}return h}class $m{constructor(e){this.vertexArray=new Oc,this.indexArray=new na,this.programConfigurations=new Jl(e.layers,{zoom:e.zoom,lut:e.lut},i=>n0.includes(i)),this._segments=new yo,this.hiddenByLandmarkVertexArray=new Bc,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new yo}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,h=!1){const a=e.length;if(a>2){let d=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*a,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let w;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const M=e[0],m=e[1];w=Xm(M.sub(e[a-1])._perp()._unit(),m.sub(M)._perp()._unit())}for(let M=0;M<a;M++){const m=M===a-1?0:M+1,E=e[M],I=e[m],b=e[m===a-1?0:m+1],T=I.sub(E)._perp()._unit(),A=Xm(T,b.sub(I)._perp()._unit()),k=w,O=A;if(np(E,I,i)||h&&Km(E,i)&&Km(I,i)){w=A;continue}const U=_.vertexLength;Wd(this.vertexArray,E,I,1,1,k),Wd(this.vertexArray,E,I,1,0,k),Wd(this.vertexArray,E,I,0,1,O),Wd(this.vertexArray,E,I,0,0,O),_.vertexLength+=4;const G=a0(E,I,T,o);for(const B of G)this._segmentToGroundQuads[d].push({id:U,region:B}),this._segmentToRegionTriCounts[d][B]+=2,_.primitiveLength+=2;w=A}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((h,a)=>h.region-a.region);for(let o=0;o<i;o++){const h=this._segmentToGroundQuads[o],a=e[o],d=this._segmentToRegionTriCounts[o];d.reduce((w,M)=>w+M,0);let _=0;for(let w=0;w<=4;w++){const M=d[w];if(M!==0){let m=this.regionSegments[w];m||(m=this.regionSegments[w]=new yo);const E={vertexOffset:a.vertexOffset,primitiveOffset:a.primitiveOffset+_,vertexLength:a.vertexLength,primitiveLength:M};m.get().push(E)}_+=M}for(let w=0;w<h.length;w++){const M=h[w].id;this.indexArray.emplaceBack(M,M+1,M+3),this.indexArray.emplaceBack(M,M+3,M+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,h,a,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,h,a,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Wy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,h,a,d,_){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,h,a,d,_)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Gu?1:0;for(let h=e.groundVertexArrayOffset;h<i;++h)this.hiddenByLandmarkVertexArray.emplace(h,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Jy.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Yd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new na,this.footprintVertices=new Dl,this.footprintSegments=[],this.layoutVertexArray=new zl,this.centroidVertexArray=new Sa,this.wallVertexArray=new kd,this.indexArray=new na,this.programConfigurations=new Jl(e.layers,{zoom:e.zoom,lut:e.lut},i=>i0.includes(i)),this.segments=new yo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new $m(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,h){this.features=[],this.hasPattern=Zf("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=t(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:a,id:d,index:_,sourceLayerIndex:w}of e){const M=this.layers[0]._featureFilter.needGeometry,m=z(a,M);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),m,o))continue;const E={id:d,sourceLayerIndex:w,index:_,geometry:M?m.geometry:R(a,o,h),properties:a.properties,type:a.type,patterns:{}},I=this.layoutVertexArray.length,b=ip[E.type]==="Polygon";if(this.hasPattern)this.features.push(Xf("fill-extrusion",this.layers,E,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const T of E.geometry)for(const A of Gm(T,b))this.addFeature(E,[A],_,o,{},i.availableImages,h,i.brightness);else this.addFeature(E,E.geometry,_,o,{},i.availableImages,h,i.brightness);i.featureIndex.insert(a,E.geometry,_,w,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,h,a,d){for(const _ of this.features){const w=ip[_.type]==="Polygon",{geometry:M}=_;if(this.wallMode)for(const m of M)for(const E of Gm(m,w))this.addFeature(_,[E],_.index,i,o,h,a,d);else this.addFeature(_,M,_.index,i,o,h,a,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,h,a,d,_){this.programConfigurations.updatePaintArrays(e,i,a,o,h,d,_),this.groundEffect.update(e,i,a,o,h,d,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,e0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Ky.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Qy.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Yy.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,h,a,d,_,w){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,m=[new Xi(0,0),new Xi(mn,mn)],E=_.projection,I=E.name==="globe",b=this.wallMode||ip[e.type]==="Polygon",T=new Zm;T.centroidDataIndex=this.centroidData.length;const A=new Hm,k=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},h)<=0,O=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},h);let U;if(A.height=O,A.vertexArrayOffset=this.layoutVertexArray.length,A.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new rc),this.wallMode){if(I)return void ur("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;U=function(ue){const Fe=ue[0].x===ue[ue.length-1].x&&ue[0].y===ue[ue.length-1].y;(function(Wi){let Fi=0;const qn=Wi.length;for(let En=0;En<qn;En++)Fi+=(Wi[(En+1)%qn].x-Wi[En].x)*(Wi[(En+1)%qn].y+Wi[En].y);return Fi>=0})(ue)||(ue=ue.reverse());const Ve={geometry:[],joinNormals:[],indices:[]},$e=[],Ze=[],Qe=[];let ht=ue.length;for(;ht>=2&&ue[ht-1].equals(ue[ht-2]);)ht--;if(ht<(Fe?3:2))return Ve;let wt,st,Jt,zi,Kt,wn=0;for(;wn<ht-1&&ue[wn].equals(ue[wn+1]);)wn++;Fe&&(wt=ue[ht-2],Kt=ue[wn].sub(wt)._unit()._perp());for(let Wi=wn;Wi<ht;Wi++){if(Jt=Wi===ht-1?Fe?ue[wn+1]:void 0:ue[Wi+1],Jt&&ue[Wi].equals(Jt))continue;Kt&&(zi=Kt),wt&&(st=wt),wt=ue[Wi],Kt=Jt?Jt.sub(wt)._unit()._perp():zi,zi=zi||Kt;let Fi=zi.add(Kt);Fi.x===0&&Fi.y===0||Fi._unit();const qn=Fi.x*Kt.x+Fi.y*Kt.y,En=qn!==0?1/qn:1/0,kn=zi.x*Kt.y-zi.y*Kt.x>0;let wr="miter";const zr=2;wr==="miter"&&En>zr&&(wr="bevel"),wr==="bevel"&&(En>100&&(wr="flipbevel"),En<zr&&(wr="miter"));const Nr=(Fr,Zr,Xr,qs)=>{const Ps=new Xi(Fr.x,Fr.y),Cr=new Xi(Fr.x,Fr.y);Ps.x+=Zr.x*qs,Ps.y+=Zr.y*qs,Cr.x-=Zr.x*Math.max(Xr,1),Cr.y-=Zr.y*Math.max(Xr,1),Qe.push(Zr),$e.push(Ps),Ze.push(Cr)};if(wr==="miter")Fi._mult(En),Nr(wt,Fi,0,0);else if(wr==="flipbevel")Fi=Kt.mult(-1),Nr(wt,Fi,0,0),Nr(wt,Fi.mult(-1),0,0);else{const Fr=-Math.sqrt(En*En-1),Zr=kn?Fr:0,Xr=kn?0:Fr;st&&Nr(wt,zi,Zr,Xr),Jt&&Nr(wt,Kt,Zr,Xr)}}Ve.geometry=[...$e,...Ze.reverse(),$e[0]],Ve.joinNormals=[...Qe,...Qe.reverse(),Qe[Qe.length-1]];const _n=Ve.geometry.length-1;for(let Wi=0;Wi<_n/2;Wi++)if(Wi+1<_n/2){let Fi=Wi,qn=Wi+1,En=_n-1-Wi,kn=_n-2-Wi;Fi=Fi===0?_n-1:Fi-1,qn=qn===0?_n-1:qn-1,En=En===0?_n-1:En-1,kn=kn===0?_n-1:kn-1,Ve.indices.push(En),Ve.indices.push(qn),Ve.indices.push(Fi),Ve.indices.push(En),Ve.indices.push(kn),Ve.indices.push(qn)}return Ve}(i[0]),i=[U.geometry]}const G=(ue,Fe)=>ue<(Fe.length-1)/2||ue===Fe.length-1,B=this.wallMode?[i]:qd(i,500);for(let ue=B.length-1;ue>=0;ue--){const Fe=B[ue];(Fe.length===0||(H=Fe[0]).every(ye=>ye.x<=0)||H.every(ye=>ye.x>=mn)||H.every(ye=>ye.y<=0)||H.every(ye=>ye.y>=mn))&&B.splice(ue,1)}var H;let $;if(I)$=tg(B,m,h);else{$=[];for(const ue of B)$.push({polygon:ue,bounds:m})}const ne=b?this.edgeRadius:0,me=ne>0&&this.zoom<17,de=(ue,Fe)=>{if(ue.length===0)return!1;const ye=ue[ue.length-1];return Fe.x===ye.x&&Fe.y===ye.y};for(const{polygon:ue,bounds:Fe}of $){let ye=0,Ve=0;for(const ht of ue)b&&!ht[0].equals(ht[ht.length-1])&&ht.push(ht[0]),Ve+=b?ht.length-1:ht.length;const $e=this.segments.prepareSegment((b?5:4)*Ve,this.layoutVertexArray,this.indexArray);A.footprintSegIdx<0&&(A.footprintSegIdx=this.footprintSegments.length),A.polygonSegIdx<0&&(A.polygonSegIdx=this.polygonSegments.length);const Ze={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Qe=new qm;if(Qe.vertexOffset=this.footprintVertices.length,Qe.indexOffset=3*this.footprintIndices.length,Qe.ringIndices=[],b){const ht=[],wt=[];ye=$e.vertexLength;for(let Jt=0;Jt<ue.length;Jt++){const zi=ue[Jt];zi.length&&Jt!==0&&wt.push(ht.length/2);const Kt=[];let wn,_n;wn=zi[1].sub(zi[0])._perp()._unit(),Qe.ringIndices.push(zi.length-1);for(let Wi=1;Wi<zi.length;Wi++){const Fi=zi[Wi],qn=zi[Wi===zi.length-1?1:Wi+1],En=Fi.clone();if(ne){_n=qn.sub(Fi)._perp()._unit();const kn=wn.add(_n)._unit(),wr=ne*Math.min(4,1/(wn.x*kn.x+wn.y*kn.y));En.x+=wr*kn.x,En.y+=wr*kn.y,En.x=Math.round(En.x),En.y=Math.round(En.y),wn=_n}if(!k||ne!==0&&!me||de(Kt,En)||Kt.push(En),Gh(this.layoutVertexArray,En.x,En.y,0,0,1,1,0),this.wallMode){const kn=G(Wi,zi);jh(this.wallVertexArray,U.joinNormals[Wi],!kn)}$e.vertexLength++,this.footprintVertices.emplaceBack(Fi.x,Fi.y),ht.push(Fi.x,Fi.y),I&&qh(this.layoutVertexExtArray,E.projectTilePoint(En.x,En.y,h),E.upVector(h,En.x,En.y))}k&&(ne===0||me)&&(Kt.length!==0&&de(Kt,Kt[0])&&Kt.pop(),this.groundEffect.addData(Kt,Fe,M))}const st=this.wallMode?U.indices:Fh(ht,wt);for(let Jt=0;Jt<st.length;Jt+=3)this.footprintIndices.emplaceBack(Qe.vertexOffset+st[Jt+0],Qe.vertexOffset+st[Jt+1],Qe.vertexOffset+st[Jt+2]),this.indexArray.emplaceBack(ye+st[Jt],ye+st[Jt+2],ye+st[Jt+1]),$e.primitiveLength++;Qe.indexCount+=st.length,Qe.vertexCount+=this.footprintVertices.length-Qe.vertexOffset}for(let ht=0;ht<ue.length;ht++){const wt=ue[ht];T.startRing(A,wt[0]);let st=wt.length>4&&Jm(wt[wt.length-2],wt[0],wt[1]),Jt=ne?l0(wt[wt.length-2],wt[0],wt[1],ne):0;const zi=[];let Kt,wn,_n;wn=wt[1].sub(wt[0])._perp()._unit();let Wi=!0;for(let Fi=1,qn=0;Fi<wt.length;Fi++){let En=wt[Fi-1],kn=wt[Fi];const wr=wt[Fi===wt.length-1?1:Fi+1];if(T.appendEdge(A,kn,En),np(kn,En,Fe)){ne&&(wn=wr.sub(kn)._perp()._unit(),Wi=!Wi);continue}const zr=kn.sub(En)._perp(),Nr=zr.x/(Math.abs(zr.x)+Math.abs(zr.y)),Fr=zr.y>0?1:0,Zr=En.dist(kn);if(qn+Zr>32768&&(qn=0),ne){_n=wr.sub(kn)._perp()._unit();let Cr=Ym(En,kn,wr,Wm(wn,_n),ne);isNaN(Cr)&&(Cr=0);const Es=kn.sub(En)._unit();En=En.add(Es.mult(Jt))._round(),kn=kn.add(Es.mult(-Cr))._round(),Jt=Cr,wn=_n,k&&this.zoom>=17&&(de(zi,En)||zi.push(En),de(zi,kn)||zi.push(kn))}const Xr=$e.vertexLength,qs=wt.length>4&&Jm(En,kn,wr);let Ps=Qm(qn,st,Wi);if(Gh(this.layoutVertexArray,En.x,En.y,Nr,Fr,0,0,Ps),Gh(this.layoutVertexArray,En.x,En.y,Nr,Fr,0,1,Ps),this.wallMode){const Cr=G(Fi-1,wt),Es=U.joinNormals[Fi-1];jh(this.wallVertexArray,Es,Cr),jh(this.wallVertexArray,Es,Cr)}if(qn+=Zr,Ps=Qm(qn,qs,!Wi),st=qs,Gh(this.layoutVertexArray,kn.x,kn.y,Nr,Fr,0,0,Ps),Gh(this.layoutVertexArray,kn.x,kn.y,Nr,Fr,0,1,Ps),this.wallMode){const Cr=G(Fi,wt),Es=U.joinNormals[Fi];jh(this.wallVertexArray,Es,Cr),jh(this.wallVertexArray,Es,Cr)}if($e.vertexLength+=4,this.indexArray.emplaceBack(Xr+0,Xr+1,Xr+2),this.indexArray.emplaceBack(Xr+1,Xr+3,Xr+2),$e.primitiveLength+=2,ne){const Cr=ye+(Fi===1?wt.length-2:Fi-2),Es=Fi===1?ye:Cr+1;if(this.indexArray.emplaceBack(Xr+1,Cr,Xr+3),this.indexArray.emplaceBack(Cr,Es,Xr+3),$e.primitiveLength+=2,Kt===void 0&&(Kt=Xr),!np(wr,wt[Fi],Fe)){const Cs=Fi===wt.length-1?Kt:$e.vertexLength;this.indexArray.emplaceBack(Xr+2,Xr+3,Cs),this.indexArray.emplaceBack(Xr+3,Cs+1,Cs),this.indexArray.emplaceBack(Xr+3,Es,Cs+1),$e.primitiveLength+=3}Wi=!Wi}if(I){const Cr=this.layoutVertexExtArray,Es=E.projectTilePoint(En.x,En.y,h),Cs=E.projectTilePoint(kn.x,kn.y,h),eo=E.upVector(h,En.x,En.y),Mo=E.upVector(h,kn.x,kn.y);qh(Cr,Es,eo),qh(Cr,Es,eo),qh(Cr,Cs,Mo),qh(Cr,Cs,Mo)}}b&&(ye+=wt.length-1),k&&ne&&this.zoom>=17&&(zi.length!==0&&de(zi,zi[0])&&zi.pop(),this.groundEffect.addData(zi,Fe,M,ne>0))}this.footprintSegments.push(Qe),Ze.triangleCount=this.indexArray.length-Ze.triangleArrayOffset,this.polygonSegments.push(Ze),++A.footprintSegLen,++A.polygonSegLen}if(A.vertexCount=this.layoutVertexArray.length-A.vertexArrayOffset,A.groundVertexCount=this.groundEffect.vertexArray.length-A.groundVertexArrayOffset,A.vertexCount!==0){if(A.centroidXY=T.borders?jm:this.encodeCentroid(T,A),this.centroidData.push(A),T.borders){this.featuresOnBorder.push(T);const ue=this.featuresOnBorder.length-1;for(let Fe=0;Fe<T.borders.length;Fe++)T.borders[Fe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Fe].push(ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,a,d,h,w),this.groundEffect.addPaintPropertiesData(e,o,a,d,h,w),this.maxHeight=Math.max(this.maxHeight,O)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let _=0;_<this.centroidData.length;_++){const w=this.centroidData[_],M=+(w.min.y+w.max.y>mn),m=2*M+(+(w.min.x+w.max.x>mn)^M);for(let E=0;E<w.polygonSegLen;E++){const I=w.polygonSegIdx+E;e.push({centroidIdx:_,subtile:m,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const i=new na;e.sort((_,w)=>_.triangleSegmentIdx===w.triangleSegmentIdx?_.subtile-w.subtile:_.triangleSegmentIdx-w.triangleSegmentIdx);let o=0,h=0,a=0;for(const _ of e){if(_.triangleSegmentIdx!==o)break;a++}const d=e.length;for(;h!==e.length;){o=e[h].triangleSegmentIdx;let _=0,w=h,M=h;for(let m=w;m<a&&e[m].subtile===_;m++)M++;for(;w!==a;){const m=e[w];_=m.subtile;const E=this.centroidData[m.centroidIdx].min.clone(),I=this.centroidData[m.centroidIdx].max.clone(),b={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let T=w;T<M;T++){const A=e[T],k=this.polygonSegments[A.polygonSegmentIdx],O=this.centroidData[A.centroidIdx].min,U=this.centroidData[A.centroidIdx].max,G=this.indexArray.uint16;for(let B=k.triangleArrayOffset;B<k.triangleArrayOffset+k.triangleCount;B++)i.emplaceBack(G[3*B],G[3*B+1],G[3*B+2]);b.primitiveLength+=k.triangleCount,E.x=Math.min(E.x,O.x),E.y=Math.min(E.y,O.y),I.x=Math.max(I.x,U.x),I.y=Math.max(I.y,U.y)}b.primitiveLength>0&&this.triangleSubSegments.push({segment:b,min:E,max:I}),w=M;for(let T=w;T<a&&e[T].subtile===e[w].subtile;T++)M++}h=a;for(let m=h;m<d&&e[m].triangleSegmentIdx===e[h].triangleSegmentIdx;m++)a++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const h=new yo;if(this.wallMode){for(const A of this.triangleSubSegments)h.segments.push(A.segment);return h}let a=0,d=0;const _=1<<e.canonical.z;if(i){const A=i.getMinMaxForTile(e);A&&(a=A.min,d=A.max)}d+=this.maxHeight;const w=e.toUnwrapped();let M;const m=[w.canonical.x/_+w.wrap,w.canonical.y/_],E=[(w.canonical.x+1)/_+w.wrap,(w.canonical.y+1)/_],I=(A,k,O)=>[A[0]*(1-O[0])+k[0]*O[0],A[1]*(1-O[1])+k[1]*O[1]],b=[],T=[];for(const A of this.triangleSubSegments){b[0]=A.min.x/mn,b[1]=A.min.y/mn,T[0]=A.max.x/mn,T[1]=A.max.y/mn;const k=I(m,E,b),O=I(m,E,T);if(new Wn([k[0],k[1],a],[O[0],O[1],d]).intersectsPrecise(o)===0){M&&(h.segments.push(M),M=void 0);continue}const U=A.segment;M&&M.vertexOffset!==U.vertexOffset&&(h.segments.push(M),M=void 0),M?(M.vertexLength+=U.vertexLength,M.primitiveLength+=U.primitiveLength):M={vertexOffset:U.vertexOffset,primitiveLength:U.primitiveLength,vertexLength:U.vertexLength,primitiveOffset:U.primitiveOffset,sortKey:void 0,vaos:{}}}return M&&h.segments.push(M),h}encodeCentroid(e,i){const o=e.centroid(),h=i.span(),a=Math.min(7,Math.round(h.x*this.tileToMeter/10)),d=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Xi(cn(o.x,1,mn-1)<<3|a,cn(o.y,1,mn-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Xi(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const h=i[0][0]!==o?0:1;return new Xi(6|(i[0][0]!==o?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==o?2:3;return new Xi((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Gu,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,h=e.flags&Gu?jm:e.centroidXY,a=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||a!==h.x){for(let d=i;d<o;++d)this.centroidVertexArray.emplace(d,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(ep(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const a=[];for(const d of this.activeReplacements){if(d.order<o)continue;const _=Math.max(1,Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z));for(const w of this.centroidData)if(!(w.flags&Gu||d.min.x>w.max.x||w.min.x>d.max.x||d.min.y>w.max.y||w.min.y>d.max.y))for(let M=0;M<w.footprintSegLen;M++){const m=this.footprintSegments[w.footprintSegIdx+M];if(a.length=0,u0(this.footprintVertices,m.vertexOffset,m.vertexCount,d.footprintTileId.canonical,e.canonical,a),Fm(d.footprint,a,this.footprintIndices.uint16,m.indexOffset,m.indexCount,-m.vertexOffset,-_)){w.flags|=Gu;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let h=!1;for(let a=0;a<o.footprintSegLen;a++){const d=this.footprintSegments[o.footprintSegIdx+a];let _=0;for(const w of d.ringIndices){for(let M=_,m=w+_-1;M<w+_;m=M++){const E=this.footprintVertices.int16[2*(M+d.vertexOffset)+0],I=this.footprintVertices.int16[2*(M+d.vertexOffset)+1],b=this.footprintVertices.int16[2*(m+d.vertexOffset)+1];I>i!=b>i&&e<(this.footprintVertices.int16[2*(m+d.vertexOffset)+0]-E)*(i-I)/(b-I)+E&&(h=!h)}_=w}}return h}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,h=!0;const a=4*(e+mn)*mn+(i+mn);if(this.partLookup.hasOwnProperty(a)){const d=this.partLookup[a];return d?{height:d.height,hidden:!!(d.flags&Gu)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||i>d.max.y||d.min.y>i||this.footprintContainsPoint(e,i,d)&&d&&d.height>o&&(o=d.height,this.partLookup[a]=d,h=!!(d.flags&Gu));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:h};this.partLookup[a]=void 0}}function Wm(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function l0(r,e,i,o){const h=e.sub(r)._perp()._unit(),a=i.sub(e)._perp()._unit();return Ym(r,e,i,Wm(h,a),o)}function Ym(r,e,i,o,h){const a=Math.sqrt(1-o*o);return Math.min(r.dist(e)/3,e.dist(i)/3,h*a/o)}function np(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function Km(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function Jm(r,e,i){if(r.x<0||r.x>=mn||e.x<0||e.x>=mn||i.x<0||i.x>=mn)return!1;const o=i.sub(e),h=o.perp(),a=r.sub(e);return(o.x*a.x+o.y*a.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(a.x*a.x+a.y*a.y))>-.866&&h.x*a.x+h.y*a.y<0}function Qm(r,e,i){const o=e?2|r:-3&r;return i?1|o:-2&o}function eg(){const r=Math.PI/32,e=Math.tan(r),i=mu;return i*Math.sqrt(1+2*e*e)-i}function tg(r,e,i){const o=1<<i.z,h=Ia(i.x/o),a=Ia((i.x+1)/o),d=ra(i.y/o),_=ra((i.y+1)/o);return function(w,M,m,E,I=0,b){const T=[];if(!w.length||!m||!E)return T;const A=($,ne)=>{for(const me of $)T.push({polygon:me,bounds:ne})},k=Math.ceil(Math.log2(m)),O=Math.ceil(Math.log2(E)),U=k-O,G=[];for(let $=0;$<Math.abs(U);$++)G.push(U>0?0:1);for(let $=0;$<Math.min(k,O);$++)G.push(0),G.push(1);let B=w;if(B=Zd(B,M[0].y-I,M[1].y+I,1),B=Zd(B,M[0].x-I,M[1].x+I,0),!B.length)return T;const H=[];for(G.length?H.push({polygons:B,bounds:M,depth:0}):A(B,M);H.length;){const $=H.pop(),ne=$.depth,me=G[ne],de=$.bounds[0],ue=$.bounds[1],Fe=me===0?de.x:de.y,ye=me===0?ue.x:ue.y,Ve=b?b(me,Fe,ye):.5*(Fe+ye),$e=Zd($.polygons,Fe-I,Ve+I,me),Ze=Zd($.polygons,Ve-I,ye+I,me);if($e.length){const Qe=[de,new Xi(me===0?Ve:ue.x,me===1?Ve:ue.y)];G.length>ne+1?H.push({polygons:$e,bounds:Qe,depth:ne+1}):A($e,Qe)}if(Ze.length){const Qe=[new Xi(me===0?Ve:de.x,me===1?Ve:de.y),ue];G.length>ne+1?H.push({polygons:Ze,bounds:Qe,depth:ne+1}):A(Ze,Qe)}}return T}(r,e,Math.ceil((a-h)/11.25),Math.ceil((d-_)/11.25),1,(w,M,m)=>{if(w===0)return .5*(M+m);{const E=ra((i.y+M/mn)/o);return(il(.5*(ra((i.y+m/mn)/o)+E))*o-i.y)*mn}})}function u0(r,e,i,o,h,a){const d=Math.pow(2,o.z-h.z);for(let _=0;_<i;_++){let w=r.int16[2*(_+e)+0],M=r.int16[2*(_+e)+1];w=(w+h.x*mn)*d-o.x*mn,M=(M+h.y*mn)*d-o.y*mn,a.push(new Xi(w,M))}}let ig,ng;function Hh(r,e){return r.x*e.x+r.y*e.y}function rg(r,e){if(r.length===1){let i=0;const o=e[i++];let h;for(;!h||o.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const a=e[i],d=r[0],_=h.sub(o),w=a.sub(o),M=d.sub(o),m=Hh(_,_),E=Hh(_,w),I=Hh(w,w),b=Hh(M,_),T=Hh(M,w),A=m*I-E*E,k=(I*b-E*T)/A,O=(m*T-E*b)/A,U=o.z*(1-k-O)+h.z*k+a.z*O;if(isFinite(U))return U}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function sg(r,e,i,o,h,a,d,_){const w=d*h.getElevationAt(r,e,!0,!0),M=a[0]!==0,m=M?a[1]===0?d*(a[0]/7-450):d*function(E,I,b){const T=Math.floor(I[0]/8),A=Math.floor(I[1]/8),k=10*(I[0]-8*T),O=10*(I[1]-8*A),U=E.getElevationAt(T,A,!0,!0),G=E.getMeterToDEM(b),B=Math.floor(.5*(k*G-1)),H=Math.floor(.5*(O*G-1)),$=E.tileCoordToPixel(T,A),ne=2*B+1,me=2*H+1,de=function(Ze,Qe,ht,wt,st){return[Ze.getElevationAtPixel(Qe,ht,!0),Ze.getElevationAtPixel(Qe+st,ht,!0),Ze.getElevationAtPixel(Qe,ht+st,!0),Ze.getElevationAtPixel(Qe+wt,ht+st,!0)]}(E,$.x-B,$.y-H,ne,me),ue=Math.abs(de[0]-de[1]),Fe=Math.abs(de[2]-de[3]),ye=Math.abs(de[0]-de[2])+Math.abs(de[1]-de[3]),Ve=Math.min(.25,.5*G*(ue+Fe)/ne),$e=Math.min(.25,.5*G*ye/me);return U+Math.max(Ve*k,$e*O)}(h,a,_):w;return{base:w+(i===0?-1:i),top:M?Math.max(m+o,w+i+2):w+o}}on(Yd,"FillExtrusionBucket",{omit:["layers","features"]}),on(Hm,"PartData"),on(qm,"FootprintSegment"),on(Zm,"BorderCentroidData"),on($m,"GroundEffect");const c0=gs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),h0=gs([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:d0}=c0,f0=gs([{name:"a_packed",components:3,type:"Float32"}]),{members:p0}=f0,m0=gs([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:g0}=m0;class og{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Vu({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Ir(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const h=[];let a=e.length%2==1?-e[e.length-1]*o:0,d=e[0]*o,_=!0;h.push({left:a,right:d,isDash:_,zeroLength:e[0]===0});let w=e[0];for(let M=1;M<e.length;M++){_=!_;const m=e[M];a=w*o,w+=m,d=w*o,h.push({left:a,right:d,isDash:_,zeroLength:m===0})}return h}addRoundDash(e,i,o){const h=i/2;for(let a=-o;a<=o;a++){const d=this.width*(this.nextRow+o+a);let _=0,w=e[_];for(let M=0;M<this.width;M++){M/w.right>1&&(w=e[++_]);const m=Math.abs(M-w.left),E=Math.abs(M-w.right),I=Math.min(m,E);let b;const T=a/o*(h+1);if(w.isDash){const A=h-Math.abs(T);b=Math.sqrt(I*I+A*A)}else b=h-Math.sqrt(I*I+T*T);this.image.data[d+M]=Math.max(0,Math.min(255,b+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const M=e[w],m=e[w+1];M.zeroLength?e.splice(w,1):m&&m.isDash===M.isDash&&(m.left=M.left,e.splice(w,1))}const o=e[0],h=e[e.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const a=this.width*this.nextRow;let d=0,_=e[d];for(let w=0;w<this.width;w++){w/_.right>1&&(_=e[++d]);const M=Math.abs(w-_.left),m=Math.abs(w-_.right),E=Math.min(M,m);this.image.data[a+w]=Math.max(0,Math.min(255,(_.isDash?E:-E)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const h=i==="round",a=h?7:0,d=2*a+1;if(this.nextRow+d>this.height)return ur("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let m=0;m<e.length;m++)e[m]<0&&(ur("Negative value is found in line dasharray, replacing values with 0"),e[m]=0),_+=e[m];if(_!==0){const m=this.width/_,E=this.getDashRanges(e,this.width,m);h?this.addRoundDash(E,m,a):this.addRegularDash(E,i==="square"?.5*m:0)}const w=this.nextRow+a;this.nextRow+=d;const M={tl:[w,a],br:[_,0]};return this.positions[o]=M,M}}on(og,"LineAtlas");const _0=Xc.VectorTileFeature.types,y0=Math.cos(Math.PI/180*37.5),v0=Math.cos(Math.PI/180*5);class rp{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new nc,this.layoutVertexArray2=new _l,this.patternVertexArray=new _l,this.indexArray=new na,this.programConfigurations=new Jl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new yo,this.maxLineLength=0,this.zOffsetVertexArray=new _l,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:mn/64}updateFootprints(e,i){}populate(e,i,o,h){this.hasPattern=Zf("line",this.layers,this.pixelRatio,i);const a=this.layers[0].layout.get("line-sort-key");this.tileToMeter=t(o);const d=this.layers[0].layout.get("line-z-offset"),_=d.isConstant()&&!d.constantOr(0),w=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=w==="sea"||w==="ground"||!_&&w==="none",this.hasZOffset&&w==="none"&&ur(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const M=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&M!==void 0;const m=[];for(const{feature:T,id:A,index:k,sourceLayerIndex:O}of e){const U=this.layers[0]._featureFilter.needGeometry,G=z(T,U);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),G,o))continue;const B=a?a.evaluate(G,{},o):void 0,H={id:A,properties:T.properties,type:T.type,sourceLayerIndex:O,index:k,geometry:U?G.geometry:R(T,o,h),patterns:{},sortKey:B};m.push(H)}a&&m.sort((T,A)=>T.sortKey-A.sortKey);const{lineAtlas:E,featureIndex:I}=i,b=this.addConstantDashes(E);for(const T of m){const{geometry:A,index:k,sourceLayerIndex:O}=T;if(b&&this.addFeatureDashes(T,E),this.hasPattern){const U=Xf("line",this.layers,T,this.zoom,this.pixelRatio,i);this.patternFeatures.push(U)}else this.addFeature(T,A,k,o,E.positions,i.availableImages,i.brightness);I.insert(e[k].feature,A,k,O,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const h=o.paint.get("line-dasharray").value,a=o.layout.get("line-cap").value;if(h.kind!=="constant"||a.kind!=="constant")i=!0;else{const d=a.value,_=h.value;if(!_)continue;e.addDash(_,d)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const h of this.layers){const a=h.paint.get("line-dasharray").value,d=h.layout.get("line-cap").value;if(a.kind==="constant"&&d.kind==="constant")continue;let _,w;if(a.kind==="constant"){if(_=a.value,!_)continue}else _=a.evaluate({zoom:o},e);w=d.kind==="constant"?d.value:d.evaluate({zoom:o},e),i.addDash(_,w),e.patterns[h.id]=i.getKey(_,w)}}update(e,i,o,h,a,d,_){this.programConfigurations.updatePaintArrays(e,i,a,o,h,d,_)}addFeatures(e,i,o,h,a,d){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,o,h,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,p0)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,g0)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,h0.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,h,a,d,_){const w=this.layers[0].layout,M=w.get("line-join").evaluate(e,{}),m=w.get("line-cap").evaluate(e,{}),E=w.get("line-miter-limit"),I=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=w.get("line-z-offset").value;const b=this.layers[0].paint.get("line-width").value;b.kind!=="constant"&&b.isLineProgressConstant===!1&&(this.variableWidthValue=b);for(const T of i)this.addLine(T,e,h,M,m,E,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,a,d,h,_)}addLine(e,i,o,h,a,d,_){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const w=h==="none";if(this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<e.length-1;G++)this.totalDistance+=e[G].dist(e[G+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=_0[i.type]==="Polygon";let m=e.length;for(;m>=2&&e[m-1].equals(e[m-2]);)m--;let E=0;for(;E<m-1&&e[E].equals(e[E+1]);)E++;if(m<(M?3:2))return;h==="bevel"&&(d=1.05);const I=this.segments.prepareSegment(10*m,this.layoutVertexArray,this.indexArray);let b,T,A,k,O,U;this.e1=this.e2=-1,M&&(b=e[m-2],O=e[E].sub(b)._unit()._perp());for(let G=E;G<m;G++){if(A=G===m-1?M?e[E+1]:void 0:e[G+1],A&&e[G].equals(A))continue;O&&(k=O),b&&(T=b),b=e[G],U=this.evaluateLineProgressFeatures(T?T.dist(b):0),O=A?A.sub(b)._unit()._perp():k,k=k||O;const B=T&&A;let H=B?h:M||w?"butt":a;const $=k.x*O.x+k.y*O.y;if(w){const $e=function(Ze){if(Ze.patternJoinNone){const Qe=Ze.segmentPoints.length/2,ht=Ze.lineSoFar-Ze.segmentStart;for(let wt=0;wt<Qe;++wt){const st=Ze.segmentPoints[2*wt+1],Jt=Math.round(Ze.segmentPoints[2*wt])+.5+.25*st;Ze.patternVertexArray.emplaceBack(Jt,ht,Ze.segmentStart),Ze.patternVertexArray.emplaceBack(Jt,ht,Ze.segmentStart)}Ze.segmentPoints.length=0}Ze.e1=Ze.e2=-1};if(B&&$<v0){this.updateDistance(T,b),this.addCurrentVertex(b,k,1,1,I,U),$e(this),this.addCurrentVertex(b,O,-1,-1,I,U);continue}if(T){if(!A){this.updateDistance(T,b),this.addCurrentVertex(b,k,1,1,I,U),$e(this);continue}H="miter"}}let ne=k.add(O);ne.x===0&&ne.y===0||ne._unit();const me=ne.x*O.x+ne.y*O.y,de=me!==0?1/me:1/0,ue=2*Math.sqrt(2-2*me),Fe=me<y0&&T&&A,ye=k.x*O.y-k.y*O.x>0,Ve=this.overscaling<=16?15*mn/(512*this.overscaling):0;if(B&&H==="round"){if(de<_)H="miter";else if(de<=2){const $e=sp(b,-10,mn+10);H=this.hasZOffset&&($e||this.hasCrossSlope)?"miter":"fakeround"}}if(H==="miter"&&de>d&&(H="bevel"),H==="bevel"&&(de>2&&(H="flipbevel"),de<d&&(H="miter")),T&&!(H==="miter"&&Fe)&&this.updateDistance(T,b),H==="miter")if(Fe){const $e=b.dist(T);if($e>2*Ve){const Qe=b.sub(b.sub(T)._mult(Ve/$e)._round());this.updateDistance(T,Qe),this.addCurrentVertex(Qe,k,0,0,I,U),T=Qe}this.updateDistance(T,b),ne._mult(de),this.addCurrentVertex(b,ne,0,0,I,U);const Ze=b.dist(A);if(Ze>2*Ve){const Qe=b.add(A.sub(b)._mult(Ve/Ze)._round());this.updateDistance(b,Qe),this.addCurrentVertex(Qe,O,0,0,I,U),b=Qe}}else ne._mult(de),this.addCurrentVertex(b,ne,0,0,I,U);else if(H==="flipbevel"){if(de>100)ne=O.mult(-1);else{const $e=de*k.add(O).mag()/k.sub(O).mag();ne._perp()._mult($e*(ye?-1:1))}this.addCurrentVertex(b,ne,0,0,I,U),this.addCurrentVertex(b,ne.mult(-1),0,0,I,U)}else if(H==="bevel"||H==="fakeround"){U!=null&&T&&this.addCurrentVertex(b,k,-1,-1,I,U);const $e=b.dist(T)<=2*Ve&&H!=="bevel",Ze=ne.mult(ye?1:-1);Ze._mult(de);const Qe=O.mult(ye?-1:1),ht=k.mult(ye?-1:1),wt=this.evaluateLineProgressFeatures(this.distance);if(U==null&&(this.addHalfVertex(b,Ze.x,Ze.y,!1,!ye,0,I,wt),$e||this.addHalfVertex(b,Ze.x+2*ht.x,Ze.y+2*ht.y,!1,ye,0,I,wt)),H==="fakeround"){const st=Math.round(180*ue/Math.PI/20);this.addHalfVertex(b,ht.x,ht.y,!1,ye,0,I,wt);for(let Jt=0;Jt<st;Jt++){let zi=Jt/st;if(zi!==.5){const wn=zi-.5;zi+=zi*wn*(zi-1)*((1.0904+$*($*(3.55645-1.43519*$)-3.2452))*wn*wn+(.848013+$*(.215638*$-1.06021)))}const Kt=Qe.sub(ht)._mult(zi)._add(ht)._unit();this.addHalfVertex(b,Kt.x,Kt.y,!1,ye,0,I,wt)}this.addHalfVertex(b,Qe.x,Qe.y,!1,ye,0,I,wt)}$e||U!=null||this.addHalfVertex(b,Ze.x+2*Qe.x,Ze.y+2*Qe.y,!1,ye,0,I,wt),U!=null&&A&&this.addCurrentVertex(b,O,1,1,I,U)}else H==="butt"?this.addCurrentVertex(b,ne,0,0,I,U):H==="square"?(T||this.addCurrentVertex(b,ne,-1,-1,I,U),this.addCurrentVertex(b,ne,0,0,I,U),T&&this.addCurrentVertex(b,ne,1,1,I,U)):H==="round"&&(T&&(this.addCurrentVertex(b,k,0,0,I,U),this.addCurrentVertex(b,k,1,1,I,U,!0)),A&&(this.addCurrentVertex(b,O,-1,-1,I,U,!0),this.addCurrentVertex(b,O,0,0,I,U)))}}addVerticesTo(e,i,o,h,a,d,_,w,M,m){const E=(i.w-e.w)/this.tessellationStep|0;let I=0;const b=this.scaledDistance;if(E>1){this.lineSoFar=e.w;const A=(i.x-e.x)/E,k=(i.y-e.y)/E,O=(i.z-e.z)/E,U=(i.w-e.w)/E;for(let G=1;G<E;++G){e.x+=A,e.y+=k,e.z+=O,this.lineSoFar+=U,I+=U;const B=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(e,o,h,m,!1,_,M,B),this.addHalfVertex(e,a,d,m,!0,-w,M,B)}}this.lineSoFar=i.w,this.scaledDistance=b;const T=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,h,m,!1,_,M,T),this.addHalfVertex(i,a,d,m,!0,-w,M,T)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):ur(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}:{zOffset:0,variableWidth:i}}addCurrentVertex(e,i,o,h,a,d,_=!1){const w=i.x+i.y*o,M=i.y-i.x*o,m=i.y*h-i.x,E=-i.y-i.x*h;if(d!=null){const I=this.hasZOffset,b=-10,T=mn+10,A=d.zOffset,k=new Rm(e.x,e.y,A,this.lineSoFar),O=!!I&&sp(e,b,T),U=this.lineSoFar,G=this.distance;if(this.currentVertex)if(O){const B=this.currentVertexIsOutside,H=this.currentVertex,$=new Rm(e.x,e.y,A,this.lineSoFar);if(Om(H,$,b,T),!sp($,b,T)){if(B){this.e1=this.e2=-1,this.distance-=H.dist(k),this.lineSoFar=H.w;const ne=this.evaluateLineProgressFeatures(H.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(H,w,M,_,!1,o,a,ne),this.addHalfVertex(H,m,E,_,!0,-h,a,ne),this.prevDistance=this.distance}this.distance=this.prevDistance+H.dist($),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(H,$,w,M,m,E,o,h,a,_),this.distance=G,this.scaledDistance=this.distance/this.totalDistance}}else{const B=this.currentVertex;if(this.currentVertexIsOutside){Om(B,k,b,T),this.e1=this.e2=-1,this.distance-=B.dist(k),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=B.w;const H=this.evaluateLineProgressFeatures(B.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(B,w,M,_,!1,o,a,H),this.addHalfVertex(B,m,E,_,!0,-h,a,H),this.prevDistance=this.distance,this.distance=G,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(B,k,w,M,m,E,o,h,a,_)}else O||(this.addHalfVertex(e,w,M,_,!1,o,a,d),this.addHalfVertex(e,m,E,_,!0,-h,a,d));this.currentVertex=k,this.currentVertexIsOutside=O,this.lineSoFar=U}else this.addHalfVertex(e,w,M,_,!1,o,a,d),this.addHalfVertex(e,m,E,_,!0,-h,a,d)}addHalfVertex({x:e,y:i},o,h,a,d,_,w,M){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(a?1:0),(i<<1)+(d?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const E=Ye(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,E)}const m=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,m),w.primitiveLength++),d?this.e2=m:this.e1=m,M!=null&&this.zOffsetVertexArray.emplaceBack(M.zOffset,M.variableWidth,M.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function sp(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let ag,lg;function ug(r,e,i){return e*(mn/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}on(rp,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const cg=(r,e,i)=>(1-i)*r+i*e;function hg(r,e){return 1/ug(r,1,e.tileZoom)}function dg(r,e,i,o){return r.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const fg=r=>{const e=[];pg(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=r.layout.get("line-join").constantOr("miter")==="none",h=!!r.paint.get("line-pattern").constantOr(1);return o&&h&&e.push("LINE_JOIN_NONE"),e};function pg(r){const e=r.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let op;const mg=()=>op||(op={layout:ag||(ag=new ro({"line-cap":new Rn(Ct.layout_line["line-cap"]),"line-join":new Rn(Ct.layout_line["line-join"]),"line-miter-limit":new an(Ct.layout_line["line-miter-limit"]),"line-round-limit":new an(Ct.layout_line["line-round-limit"]),"line-sort-key":new Rn(Ct.layout_line["line-sort-key"]),"line-z-offset":new Rn(Ct.layout_line["line-z-offset"]),"line-elevation-reference":new an(Ct.layout_line["line-elevation-reference"]),"line-cross-slope":new an(Ct.layout_line["line-cross-slope"]),visibility:new an(Ct.layout_line.visibility),"line-width-unit":new an(Ct.layout_line["line-width-unit"])})),paint:lg||(lg=new ro({"line-opacity":new Rn(Ct.paint_line["line-opacity"]),"line-color":new Rn(Ct.paint_line["line-color"]),"line-translate":new an(Ct.paint_line["line-translate"]),"line-translate-anchor":new an(Ct.paint_line["line-translate-anchor"]),"line-width":new Rn(Ct.paint_line["line-width"]),"line-gap-width":new Rn(Ct.paint_line["line-gap-width"]),"line-offset":new Rn(Ct.paint_line["line-offset"]),"line-blur":new Rn(Ct.paint_line["line-blur"]),"line-dasharray":new Rn(Ct.paint_line["line-dasharray"]),"line-pattern":new Rn(Ct.paint_line["line-pattern"]),"line-gradient":new Lu(Ct.paint_line["line-gradient"]),"line-trim-offset":new an(Ct.paint_line["line-trim-offset"]),"line-trim-fade-range":new an(Ct.paint_line["line-trim-fade-range"]),"line-trim-color":new an(Ct.paint_line["line-trim-color"]),"line-emissive-strength":new an(Ct.paint_line["line-emissive-strength"]),"line-border-width":new Rn(Ct.paint_line["line-border-width"]),"line-border-color":new Rn(Ct.paint_line["line-border-color"]),"line-occlusion-opacity":new an(Ct.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},op);class x0 extends Rn{possiblyEvaluate(e,i){return i=new Ws(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,h){return i=Dn({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,h)}}let Zh;function gg(r,e){return e>0?e+2*r:r}const b0=gs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),w0=gs([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),E0=gs([{name:"a_projected_pos",components:4,type:"Float32"}],4);gs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const T0=gs([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),S0=gs([{name:"a_texb",components:2,type:"Uint16"}]),I0=gs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),M0=gs([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);gs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _g=gs([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),A0=gs([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);gs([{name:"triangle",components:3,type:"Uint16"}]),gs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),gs([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),gs([{type:"Float32",name:"offsetX"}]),gs([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fa=24;const Fl=128;function ap(r,e,i,o,h){if(r.kind==="camera")return r.maxSize;if(r.kind==="composite"){const a=e.possiblyEvaluate(new Ws(r.maxZoom),i).evaluate(h,{},i),d=e.possiblyEvaluate(new Ws(r.minZoom),i).evaluate(h,{},i);return Math.max(a,d)}return e.possiblyEvaluate(new Ws(o)).evaluate(h,{},i)}function lp(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Ws(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=i;let a=0;for(;a<o.length&&o[a]<=r;)a++;a=Math.max(0,a-1);let d=a;for(;d<o.length&&o[d]<r+1;)d++;d=Math.min(o.length-1,d);const _=o[a],w=o[d];return i.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:_,maxZoom:w,minSize:i.evaluate(new Ws(_)),maxSize:i.evaluate(new Ws(w)),interpolationType:h}}}function Kd(r,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:h}){return r.kind==="source"?o/Fl:r.kind==="composite"?Ye(o/Fl,h/Fl,i):e}function $c(r,e,i=1){let o=0,h=0;if(r.kind==="constant")h=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:a,minZoom:d,maxZoom:_}=r,w=a?cn(ia.interpolationFactor(a,e,d,_),0,1):0;r.kind==="camera"?h=Ye(r.minSize,r.maxSize,w)*i:o=w*i}return{uSizeT:o,uSize:h}}var C0=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Fl,evaluateSizeForFeature:Kd,evaluateSizeForZoom:$c,getRasterizedIconSize:ap,getSizeData:lp});function P0(r,e,i){return r.sections.forEach(o=>{o.text=function(h,a,d){const _=a.layout.get("text-transform").evaluate(d,{});return _==="uppercase"?h=h.toLocaleUpperCase():_==="lowercase"&&(h=h.toLocaleLowerCase()),za.applyArabicShaping&&(h=za.applyArabicShaping(h)),h}(o.text,e,i)}),r}const Xh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function L0(r){return r==="\uFE36"||r==="\uFE48"||r==="\uFE38"||r==="\uFE44"||r==="\uFE42"||r==="\uFE3E"||r==="\uFE3C"||r==="\uFE3A"||r==="\uFE18"||r==="\uFE40"||r==="\uFE10"||r==="\uFE13"||r==="\uFE14"||r==="\uFF40"||r==="\uFFE3"||r==="\uFE11"||r==="\uFE12"}function R0(r){return r==="\uFE35"||r==="\uFE47"||r==="\uFE37"||r==="\uFE43"||r==="\uFE41"||r==="\uFE3D"||r==="\uFE3B"||r==="\uFE39"||r==="\uFE17"||r==="\uFE3F"}var yg,up,vg,cp={};function k0(){return yg||(yg=1,cp.read=function(r,e,i,o,h){var a,d,_=8*h-o-1,w=(1<<_)-1,M=w>>1,m=-7,E=i?h-1:0,I=i?-1:1,b=r[e+E];for(E+=I,a=b&(1<<-m)-1,b>>=-m,m+=_;m>0;a=256*a+r[e+E],E+=I,m-=8);for(d=a&(1<<-m)-1,a>>=-m,m+=o;m>0;d=256*d+r[e+E],E+=I,m-=8);if(a===0)a=1-M;else{if(a===w)return d?NaN:1/0*(b?-1:1);d+=Math.pow(2,o),a-=M}return(b?-1:1)*d*Math.pow(2,a-o)},cp.write=function(r,e,i,o,h,a){var d,_,w,M=8*a-h-1,m=(1<<M)-1,E=m>>1,I=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=o?0:a-1,T=o?1:-1,A=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,d=m):(d=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-d))<1&&(d--,w*=2),(e+=d+E>=1?I/w:I*Math.pow(2,1-E))*w>=2&&(d++,w/=2),d+E>=m?(_=0,d=m):d+E>=1?(_=(e*w-1)*Math.pow(2,h),d+=E):(_=e*Math.pow(2,E-1)*Math.pow(2,h),d=0));h>=8;r[i+b]=255&_,b+=T,_/=256,h-=8);for(d=d<<h|_,M+=h;M>0;r[i+b]=255&d,b+=T,d/=256,M-=8);r[i+b-T]|=128*A}),cp}function xg(){if(vg)return up;vg=1,up=e;var r=k0();function e(B){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(B)?B:new Uint8Array(B||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,h=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function a(B){return B.type===e.Bytes?B.readVarint()+B.pos:B.pos+1}function d(B,H,$){return $?4294967296*H+(B>>>0):4294967296*(H>>>0)+(B>>>0)}function _(B,H,$){var ne=H<=16383?1:H<=2097151?2:H<=268435455?3:Math.floor(Math.log(H)/(7*Math.LN2));$.realloc(ne);for(var me=$.pos-1;me>=B;me--)$.buf[me+ne]=$.buf[me]}function w(B,H){for(var $=0;$<B.length;$++)H.writeVarint(B[$])}function M(B,H){for(var $=0;$<B.length;$++)H.writeSVarint(B[$])}function m(B,H){for(var $=0;$<B.length;$++)H.writeFloat(B[$])}function E(B,H){for(var $=0;$<B.length;$++)H.writeDouble(B[$])}function I(B,H){for(var $=0;$<B.length;$++)H.writeBoolean(B[$])}function b(B,H){for(var $=0;$<B.length;$++)H.writeFixed32(B[$])}function T(B,H){for(var $=0;$<B.length;$++)H.writeSFixed32(B[$])}function A(B,H){for(var $=0;$<B.length;$++)H.writeFixed64(B[$])}function k(B,H){for(var $=0;$<B.length;$++)H.writeSFixed64(B[$])}function O(B,H){return(B[H]|B[H+1]<<8|B[H+2]<<16)+16777216*B[H+3]}function U(B,H,$){B[$]=H,B[$+1]=H>>>8,B[$+2]=H>>>16,B[$+3]=H>>>24}function G(B,H){return(B[H]|B[H+1]<<8|B[H+2]<<16)+(B[H+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(B,H,$){for($=$||this.length;this.pos<$;){var ne=this.readVarint(),me=ne>>3,de=this.pos;this.type=7&ne,B(me,H,this),this.pos===de&&this.skip(ne)}return H},readMessage:function(B,H){return this.readFields(B,H,this.readVarint()+this.pos)},readFixed32:function(){var B=O(this.buf,this.pos);return this.pos+=4,B},readSFixed32:function(){var B=G(this.buf,this.pos);return this.pos+=4,B},readFixed64:function(){var B=O(this.buf,this.pos)+O(this.buf,this.pos+4)*i;return this.pos+=8,B},readSFixed64:function(){var B=O(this.buf,this.pos)+G(this.buf,this.pos+4)*i;return this.pos+=8,B},readFloat:function(){var B=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,B},readDouble:function(){var B=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,B},readVarint:function(B){var H,$,ne=this.buf;return H=127&($=ne[this.pos++]),$<128?H:(H|=(127&($=ne[this.pos++]))<<7,$<128?H:(H|=(127&($=ne[this.pos++]))<<14,$<128?H:(H|=(127&($=ne[this.pos++]))<<21,$<128?H:function(me,de,ue){var Fe,ye,Ve=ue.buf;if(Fe=(112&(ye=Ve[ue.pos++]))>>4,ye<128||(Fe|=(127&(ye=Ve[ue.pos++]))<<3,ye<128)||(Fe|=(127&(ye=Ve[ue.pos++]))<<10,ye<128)||(Fe|=(127&(ye=Ve[ue.pos++]))<<17,ye<128)||(Fe|=(127&(ye=Ve[ue.pos++]))<<24,ye<128)||(Fe|=(1&(ye=Ve[ue.pos++]))<<31,ye<128))return d(me,Fe,de);throw new Error("Expected varint not more than 10 bytes")}(H|=(15&($=ne[this.pos]))<<28,B,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var B=this.readVarint();return B%2==1?(B+1)/-2:B/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var B=this.readVarint()+this.pos,H=this.pos;return this.pos=B,B-H>=12&&h?function($,ne,me){return h.decode($.subarray(ne,me))}(this.buf,H,B):function($,ne,me){for(var de="",ue=ne;ue<me;){var Fe,ye,Ve,$e=$[ue],Ze=null,Qe=$e>239?4:$e>223?3:$e>191?2:1;if(ue+Qe>me)break;Qe===1?$e<128&&(Ze=$e):Qe===2?(192&(Fe=$[ue+1]))==128&&(Ze=(31&$e)<<6|63&Fe)<=127&&(Ze=null):Qe===3?(ye=$[ue+2],(192&(Fe=$[ue+1]))==128&&(192&ye)==128&&((Ze=(15&$e)<<12|(63&Fe)<<6|63&ye)<=2047||Ze>=55296&&Ze<=57343)&&(Ze=null)):Qe===4&&(ye=$[ue+2],Ve=$[ue+3],(192&(Fe=$[ue+1]))==128&&(192&ye)==128&&(192&Ve)==128&&((Ze=(15&$e)<<18|(63&Fe)<<12|(63&ye)<<6|63&Ve)<=65535||Ze>=1114112)&&(Ze=null)),Ze===null?(Ze=65533,Qe=1):Ze>65535&&(Ze-=65536,de+=String.fromCharCode(Ze>>>10&1023|55296),Ze=56320|1023&Ze),de+=String.fromCharCode(Ze),ue+=Qe}return de}(this.buf,H,B)},readBytes:function(){var B=this.readVarint()+this.pos,H=this.buf.subarray(this.pos,B);return this.pos=B,H},readPackedVarint:function(B,H){if(this.type!==e.Bytes)return B.push(this.readVarint(H));var $=a(this);for(B=B||[];this.pos<$;)B.push(this.readVarint(H));return B},readPackedSVarint:function(B){if(this.type!==e.Bytes)return B.push(this.readSVarint());var H=a(this);for(B=B||[];this.pos<H;)B.push(this.readSVarint());return B},readPackedBoolean:function(B){if(this.type!==e.Bytes)return B.push(this.readBoolean());var H=a(this);for(B=B||[];this.pos<H;)B.push(this.readBoolean());return B},readPackedFloat:function(B){if(this.type!==e.Bytes)return B.push(this.readFloat());var H=a(this);for(B=B||[];this.pos<H;)B.push(this.readFloat());return B},readPackedDouble:function(B){if(this.type!==e.Bytes)return B.push(this.readDouble());var H=a(this);for(B=B||[];this.pos<H;)B.push(this.readDouble());return B},readPackedFixed32:function(B){if(this.type!==e.Bytes)return B.push(this.readFixed32());var H=a(this);for(B=B||[];this.pos<H;)B.push(this.readFixed32());return B},readPackedSFixed32:function(B){if(this.type!==e.Bytes)return B.push(this.readSFixed32());var H=a(this);for(B=B||[];this.pos<H;)B.push(this.readSFixed32());return B},readPackedFixed64:function(B){if(this.type!==e.Bytes)return B.push(this.readFixed64());var H=a(this);for(B=B||[];this.pos<H;)B.push(this.readFixed64());return B},readPackedSFixed64:function(B){if(this.type!==e.Bytes)return B.push(this.readSFixed64());var H=a(this);for(B=B||[];this.pos<H;)B.push(this.readSFixed64());return B},skip:function(B){var H=7&B;if(H===e.Varint)for(;this.buf[this.pos++]>127;);else if(H===e.Bytes)this.pos=this.readVarint()+this.pos;else if(H===e.Fixed32)this.pos+=4;else{if(H!==e.Fixed64)throw new Error("Unimplemented type: "+H);this.pos+=8}},writeTag:function(B,H){this.writeVarint(B<<3|H)},realloc:function(B){for(var H=this.length||16;H<this.pos+B;)H*=2;if(H!==this.length){var $=new Uint8Array(H);$.set(this.buf),this.buf=$,this.length=H}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(B){this.realloc(4),U(this.buf,B,this.pos),this.pos+=4},writeSFixed32:function(B){this.realloc(4),U(this.buf,B,this.pos),this.pos+=4},writeFixed64:function(B){this.realloc(8),U(this.buf,-1&B,this.pos),U(this.buf,Math.floor(B*o),this.pos+4),this.pos+=8},writeSFixed64:function(B){this.realloc(8),U(this.buf,-1&B,this.pos),U(this.buf,Math.floor(B*o),this.pos+4),this.pos+=8},writeVarint:function(B){(B=+B||0)>268435455||B<0?function(H,$){var ne,me;if(H>=0?(ne=H%4294967296|0,me=H/4294967296|0):(me=~(-H/4294967296),4294967295^(ne=~(-H%4294967296))?ne=ne+1|0:(ne=0,me=me+1|0)),H>=18446744073709552e3||H<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");$.realloc(10),function(de,ue,Fe){Fe.buf[Fe.pos++]=127&de|128,de>>>=7,Fe.buf[Fe.pos++]=127&de|128,de>>>=7,Fe.buf[Fe.pos++]=127&de|128,de>>>=7,Fe.buf[Fe.pos++]=127&de|128,Fe.buf[Fe.pos]=127&(de>>>=7)}(ne,0,$),function(de,ue){var Fe=(7&de)<<4;ue.buf[ue.pos++]|=Fe|((de>>>=3)?128:0),de&&(ue.buf[ue.pos++]=127&de|((de>>>=7)?128:0),de&&(ue.buf[ue.pos++]=127&de|((de>>>=7)?128:0),de&&(ue.buf[ue.pos++]=127&de|((de>>>=7)?128:0),de&&(ue.buf[ue.pos++]=127&de|((de>>>=7)?128:0),de&&(ue.buf[ue.pos++]=127&de)))))}(me,$)}(B,this):(this.realloc(4),this.buf[this.pos++]=127&B|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=B>>>7&127))))},writeSVarint:function(B){this.writeVarint(B<0?2*-B-1:2*B)},writeBoolean:function(B){this.writeVarint(!!B)},writeString:function(B){B=String(B),this.realloc(4*B.length),this.pos++;var H=this.pos;this.pos=function(ne,me,de){for(var ue,Fe,ye=0;ye<me.length;ye++){if((ue=me.charCodeAt(ye))>55295&&ue<57344){if(!Fe){ue>56319||ye+1===me.length?(ne[de++]=239,ne[de++]=191,ne[de++]=189):Fe=ue;continue}if(ue<56320){ne[de++]=239,ne[de++]=191,ne[de++]=189,Fe=ue;continue}ue=Fe-55296<<10|ue-56320|65536,Fe=null}else Fe&&(ne[de++]=239,ne[de++]=191,ne[de++]=189,Fe=null);ue<128?ne[de++]=ue:(ue<2048?ne[de++]=ue>>6|192:(ue<65536?ne[de++]=ue>>12|224:(ne[de++]=ue>>18|240,ne[de++]=ue>>12&63|128),ne[de++]=ue>>6&63|128),ne[de++]=63&ue|128)}return de}(this.buf,B,this.pos);var $=this.pos-H;$>=128&&_(H,$,this),this.pos=H-1,this.writeVarint($),this.pos+=$},writeFloat:function(B){this.realloc(4),r.write(this.buf,B,this.pos,!0,23,4),this.pos+=4},writeDouble:function(B){this.realloc(8),r.write(this.buf,B,this.pos,!0,52,8),this.pos+=8},writeBytes:function(B){var H=B.length;this.writeVarint(H),this.realloc(H);for(var $=0;$<H;$++)this.buf[this.pos++]=B[$]},writeRawMessage:function(B,H){this.pos++;var $=this.pos;B(H,this);var ne=this.pos-$;ne>=128&&_($,ne,this),this.pos=$-1,this.writeVarint(ne),this.pos+=ne},writeMessage:function(B,H,$){this.writeTag(B,e.Bytes),this.writeRawMessage(H,$)},writePackedVarint:function(B,H){H.length&&this.writeMessage(B,w,H)},writePackedSVarint:function(B,H){H.length&&this.writeMessage(B,M,H)},writePackedBoolean:function(B,H){H.length&&this.writeMessage(B,I,H)},writePackedFloat:function(B,H){H.length&&this.writeMessage(B,m,H)},writePackedDouble:function(B,H){H.length&&this.writeMessage(B,E,H)},writePackedFixed32:function(B,H){H.length&&this.writeMessage(B,b,H)},writePackedSFixed32:function(B,H){H.length&&this.writeMessage(B,T,H)},writePackedFixed64:function(B,H){H.length&&this.writeMessage(B,A,H)},writePackedSFixed64:function(B,H){H.length&&this.writeMessage(B,k,H)},writeBytesField:function(B,H){this.writeTag(B,e.Bytes),this.writeBytes(H)},writeFixed32Field:function(B,H){this.writeTag(B,e.Fixed32),this.writeFixed32(H)},writeSFixed32Field:function(B,H){this.writeTag(B,e.Fixed32),this.writeSFixed32(H)},writeFixed64Field:function(B,H){this.writeTag(B,e.Fixed64),this.writeFixed64(H)},writeSFixed64Field:function(B,H){this.writeTag(B,e.Fixed64),this.writeSFixed64(H)},writeVarintField:function(B,H){this.writeTag(B,e.Varint),this.writeVarint(H)},writeSVarintField:function(B,H){this.writeTag(B,e.Varint),this.writeSVarint(H)},writeStringField:function(B,H){this.writeTag(B,e.Bytes),this.writeString(H)},writeFloatField:function(B,H){this.writeTag(B,e.Fixed32),this.writeFloat(H)},writeDoubleField:function(B,H){this.writeTag(B,e.Fixed64),this.writeDouble(H)},writeBooleanField:function(B,H){this.writeVarintField(B,!!H)}},up}var Jd=xn(xg());const hp=3;function O0(r,e,i){e.glyphs=[],r===1&&i.readMessage(D0,e)}function D0(r,e,i){if(r===3){const{id:o,bitmap:h,width:a,height:d,left:_,top:w,advance:M}=i.readMessage(z0,{});e.glyphs.push({id:o,bitmap:new Vu({width:a+2*hp,height:d+2*hp},h),metrics:{width:a,height:d,left:_,top:w,advance:M}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function z0(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const bg=hp,nl={horizontal:1,vertical:2,horizontalOnly:3};class $h{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new $h;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new $h;return i.image=e,i}}class Wc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new Wc;for(let h=0;h<e.sections.length;h++){const a=e.sections[h];a.image?o.addImageSection(a):o.addTextSection(a,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let h="";for(let a=0;a<i.length;a++){const d=i.charCodeAt(a+1)||null,_=i.charCodeAt(a-1)||null;h+=!o&&(d&&pl(d)&&!Xh[i[a+1]]||_&&pl(_)&&!Xh[i[a-1]])||!Xh[i[a]]?i[a]:Xh[i[a]]}return h}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Qd[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Qd[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Wc;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push($h.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(o)}addImageSection(e){const i=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!i)return void ur("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push($h.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ur("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function dp(r,e,i,o,h,a,d,_,w,M,m,E,I,b,T){const A=Wc.fromFeature(r,h);E===nl.vertical&&A.verticalizePunctuation(I);let k=[];const O=function($,ne,me,de,ue,Fe){if(!$)return[];const ye=[],Ve=function(ht,wt,st,Jt,zi,Kt){let wn=0;for(let _n=0;_n<ht.length();_n++){const Wi=ht.getSection(_n);wn+=wg(ht.getCodePoint(_n),Wi,Jt,zi,wt,Kt)}return wn/Math.max(1,Math.ceil(wn/st))}($,ne,me,de,ue,Fe),$e=$.text.indexOf("\u200B")>=0;let Ze=0;for(let ht=0;ht<$.length();ht++){const wt=$.getSection(ht),st=$.getCodePoint(ht);if(Qd[st]||(Ze+=wg(st,wt,de,ue,ne,Fe)),ht<$.length()-1){const Jt=!((Qe=st)<11904||!(jn["Bopomofo Extended"](Qe)||jn.Bopomofo(Qe)||jn["CJK Compatibility Forms"](Qe)||jn["CJK Compatibility Ideographs"](Qe)||jn["CJK Compatibility"](Qe)||jn["CJK Radicals Supplement"](Qe)||jn["CJK Strokes"](Qe)||jn["CJK Symbols and Punctuation"](Qe)||jn["CJK Unified Ideographs Extension A"](Qe)||jn["CJK Unified Ideographs"](Qe)||jn["Enclosed CJK Letters and Months"](Qe)||jn["Halfwidth and Fullwidth Forms"](Qe)||jn.Hiragana(Qe)||jn["Ideographic Description Characters"](Qe)||jn["Kangxi Radicals"](Qe)||jn["Katakana Phonetic Extensions"](Qe)||jn.Katakana(Qe)||jn["Vertical Forms"](Qe)||jn["Yi Radicals"](Qe)||jn["Yi Syllables"](Qe)));(N0[st]||Jt||wt.image)&&ye.push(Tg(ht+1,Ze,Ve,ye,F0(st,$.getCodePoint(ht+1),Jt&&$e),!1))}}var Qe;return Sg(Tg($.length(),Ze,Ve,ye,0,!0))}(A,M,a,e,o,b),{processBidirectionalText:U,processStyledBidirectionalText:G}=za;if(U&&A.sections.length===1){const $=U(A.toString(),O);for(const ne of $){const me=new Wc;me.text=ne,me.sections=A.sections;for(let de=0;de<ne.length;de++)me.sectionIndex.push(0);k.push(me)}}else if(G){const $=G(A.text,A.sectionIndex,O);for(const ne of $){const me=new Wc;me.text=ne[0],me.sectionIndex=ne[1],me.sections=A.sections,k.push(me)}}else k=function($,ne){const me=[],de=$.text;let ue=0;for(const Fe of ne)me.push($.substring(ue,Fe)),ue=Fe;return ue<de.length&&me.push($.substring(ue,de.length)),me}(A,O);const B=[],H={positionedLines:B,text:A.toString(),top:m[1],bottom:m[1],left:m[0],right:m[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function($,ne,me,de,ue,Fe,ye,Ve,$e,Ze,Qe,ht){let wt=0,st=0,Jt=0;const zi=Ve==="right"?1:Ve==="left"?0:.5;let Kt=!1;for(const En of ue){const kn=En.getSections();for(const wr of kn){if(wr.image)continue;const zr=ne[wr.fontStack];if(zr&&(Kt=zr.ascender!==void 0&&zr.descender!==void 0,!Kt))break}if(!Kt)break}let wn=0;for(const En of ue){En.trim();const kn=En.getMaxScale(),wr=(kn-1)*fa,zr={positionedGlyphs:[],lineOffset:0};$.positionedLines[wn]=zr;const Nr=zr.positionedGlyphs;let Fr=0;if(!En.length()){st+=Fe,++wn;continue}let Zr=0,Xr=0;for(let Ps=0;Ps<En.length();Ps++){const Cr=En.getSection(Ps),Es=En.getSectionIndex(Ps),Cs=En.getCodePoint(Ps);let eo=Cr.scale,Mo=null,Vo=null,Ao=null,go=fa,ko=0;const qo=!($e===nl.horizontal||!Qe&&!kl(Cs)||Qe&&(Qd[Cs]||(_n=Cs,jn.Arabic(_n)||jn["Arabic Supplement"](_n)||jn["Arabic Extended-A"](_n)||jn["Arabic Presentation Forms-A"](_n)||jn["Arabic Presentation Forms-B"](_n))));if(Cr.image){const pa=de[Cr.image.serialize()];if(!pa)continue;Ao=Cr.image.id,$.iconsInText=$.iconsInText||!0,Vo=pa.paddedRect;const Js=pa.displaySize;eo=eo*fa/ht,Mo={width:Js[0],height:Js[1],left:0,top:-bg,advance:qo?Js[1]:Js[0],localGlyph:!1},ko=Kt?-Mo.height*eo:kn*fa-17-Js[1]*eo,go=Mo.advance;const Va=(qo?Js[0]:Js[1])*eo-fa*kn;Va>0&&Va>Fr&&(Fr=Va)}else{const pa=me[Cr.fontStack];if(!pa)continue;pa[Cs]&&(Vo=pa[Cs]);const Js=ne[Cr.fontStack];if(!Js)continue;const Va=Js.glyphs[Cs];if(!Va)continue;if(Mo=Va.metrics,go=Cs!==8203?fa:0,Kt){const jl=Js.ascender!==void 0?Math.abs(Js.ascender):0,Tl=Js.descender!==void 0?Math.abs(Js.descender):0,Sl=(jl+Tl)*eo;Zr<Sl&&(Zr=Sl,Xr=(jl-Tl)/2*eo),ko=-jl*eo}else ko=(kn-eo)*fa-17}qo?($.verticalizable=!0,Nr.push({glyph:Cs,imageName:Ao,x:wt,y:st+ko,vertical:qo,scale:eo,localGlyph:Mo.localGlyph,fontStack:Cr.fontStack,sectionIndex:Es,metrics:Mo,rect:Vo}),wt+=go*eo+Ze):(Nr.push({glyph:Cs,imageName:Ao,x:wt,y:st+ko,vertical:qo,scale:eo,localGlyph:Mo.localGlyph,fontStack:Cr.fontStack,sectionIndex:Es,metrics:Mo,rect:Vo}),wt+=Mo.advance*eo+Ze)}Nr.length!==0&&(Jt=Math.max(wt-Ze,Jt),Kt?Ig(Nr,zi,Fr,Xr,Fe*kn/2):Ig(Nr,zi,Fr,0,Fe/2)),wt=0;const qs=Fe*kn+Fr;zr.lineOffset=Math.max(Fr,wr),st+=qs,++wn}var _n;const Wi=st,{horizontalAlign:Fi,verticalAlign:qn}=fp(ye);(function(En,kn,wr,zr,Nr,Fr){const Zr=(kn-wr)*Nr,Xr=-Fr*zr;for(const qs of En)for(const Ps of qs.positionedGlyphs)Ps.x+=Zr,Ps.y+=Xr})($.positionedLines,zi,Fi,qn,Jt,Wi),$.top+=-qn*Wi,$.bottom=$.top+Wi,$.left+=-Fi*Jt,$.right=$.left+Jt,$.hasBaseline=Kt}(H,e,i,o,k,d,_,w,E,M,I,T),!function($){for(const ne of $)if(ne.positionedGlyphs.length!==0)return!1;return!0}(B)&&H}const Qd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},N0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wg(r,e,i,o,h,a){if(e.image){const d=o[e.image.serialize()];return d?d.displaySize[0]*e.scale*fa/a+h:0}{const d=i[e.fontStack],_=d&&d.glyphs[r];return _?_.metrics.advance*e.scale+h:0}}function Eg(r,e,i,o){const h=Math.pow(r-e,2);return o?r<e?h/2:2*h:h+Math.abs(i)*i}function F0(r,e,i){let o=0;return r===10&&(o-=1e4),i&&(o+=150),r!==40&&r!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Tg(r,e,i,o,h,a){let d=null,_=Eg(e,i,h,a);for(const w of o){const M=Eg(e-w.x,i,h,a)+w.badness;M<=_&&(d=w,_=M)}return{index:r,x:e,priorBreak:d,badness:_}}function Sg(r){return r?Sg(r.priorBreak).concat(r.index):[]}function fp(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Ig(r,e,i,o,h){if(!(e||i||o||h))return;const a=r.length-1,d=r[a],_=(d.x+d.metrics.advance*d.scale)*e;for(let w=0;w<=a;w++)r[w].x-=_,r[w].y+=i+o+h}function B0(r,e,i,o){const{horizontalAlign:h,verticalAlign:a}=fp(o),d=i[0]-r.displaySize[0]*h,_=i[1]-r.displaySize[1]*a;return{imagePrimary:r,imageSecondary:e,top:_,bottom:_+r.displaySize[1],left:d,right:d+r.displaySize[0]}}function Mg(r,e,i,o,h,a){const d=r.imagePrimary;let _;if(d.content){const k=d.content,O=d.pixelRatio||1;_=[k[0]/O,k[1]/O,d.displaySize[0]-k[2]/O,d.displaySize[1]-k[3]/O]}const w=e.left*a,M=e.right*a;let m,E,I,b;i==="width"||i==="both"?(b=h[0]+w-o[3],E=h[0]+M+o[1]):(b=h[0]+(w+M-d.displaySize[0])/2,E=b+d.displaySize[0]);const T=e.top*a,A=e.bottom*a;return i==="height"||i==="both"?(m=h[1]+T-o[0],I=h[1]+A+o[2]):(m=h[1]+(T+A-d.displaySize[1])/2,I=m+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:m,right:E,bottom:I,left:b,collisionPadding:_}}class yu extends Xi{constructor(e,i,o,h,a){super(e,i),this.angle=h,this.z=o,a!==void 0&&(this.segment=a)}clone(){return new yu(this.x,this.y,this.z,this.angle,this.segment)}}function Ag(r,e,i,o,h){if(e.segment===void 0)return!0;let a=e,d=e.segment+1,_=0;for(;_>-i/2;){if(d--,d<0)return!1;_-=r[d].dist(a),a=r[d]}_+=r[d].dist(r[d+1]),d++;const w=[];let M=0;for(;_<i/2;){const m=r[d],E=r[d+1];if(!E)return!1;let I=r[d-1].angleTo(m)-m.angleTo(E);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:_,angleDelta:I}),M+=I;_-w[0].distance>o;)M-=w.shift().angleDelta;if(M>h)return!1;d++,_+=m.dist(E)}return!0}function Cg(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function Pg(r,e,i){return r?.6*e*i:0}function Lg(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function U0(r,e,i,o,h,a){const d=Pg(i,h,a),_=Lg(i,o)*a;let w=0;const M=Cg(r)/2;for(let m=0;m<r.length-1;m++){const E=r[m],I=r[m+1],b=E.dist(I);if(w+b>M){const T=(M-w)/b,A=Ye(E.x,I.x,T),k=Ye(E.y,I.y,T),O=new yu(A,k,0,I.angleTo(E),m);return!d||Ag(r,O,_,d,e)?O:void 0}w+=b}}function V0(r,e,i,o,h,a,d,_,w){const M=Pg(o,a,d),m=Lg(o,h),E=m*d,I=r[0].x===0||r[0].x===w||r[0].y===0||r[0].y===w;return e-E<e/4&&(e=E+e/4),Rg(r,I?e/2*_%e:(m/2+2*a)*d*_%e,e,M,i,E,I,!1,w)}function Rg(r,e,i,o,h,a,d,_,w){const M=a/2,m=Cg(r);let E=0,I=e-i,b=[];for(let T=0;T<r.length-1;T++){const A=r[T],k=r[T+1],O=A.dist(k),U=k.angleTo(A);for(;I+i<E+O;){I+=i;const G=(I-E)/O,B=Ye(A.x,k.x,G),H=Ye(A.y,k.y,G);if(B>=0&&B<w&&H>=0&&H<w&&I-M>=0&&I+M<=m){const $=new yu(B,H,0,U,T);o&&!Ag(r,$,a,o,h)||b.push($)}}E+=O}return _||b.length||d||(b=Rg(r,E/2,i,o,h,a,d,!0,w)),b}function kg(r,e,i,o,h){const a=[];for(let d=0;d<r.length;d++){const _=r[d];let w;for(let M=0;M<_.length-1;M++){let m=_[M],E=_[M+1];m.x<e&&E.x<e||(m.x<e?m=new Xi(e,m.y+(e-m.x)/(E.x-m.x)*(E.y-m.y))._round():E.x<e&&(E=new Xi(e,m.y+(e-m.x)/(E.x-m.x)*(E.y-m.y))._round()),m.y<i&&E.y<i||(m.y<i?m=new Xi(m.x+(i-m.y)/(E.y-m.y)*(E.x-m.x),i)._round():E.y<i&&(E=new Xi(m.x+(i-m.y)/(E.y-m.y)*(E.x-m.x),i)._round()),m.x>=o&&E.x>=o||(m.x>=o?m=new Xi(o,m.y+(o-m.x)/(E.x-m.x)*(E.y-m.y))._round():E.x>=o&&(E=new Xi(o,m.y+(o-m.x)/(E.x-m.x)*(E.y-m.y))._round()),m.y>=h&&E.y>=h||(m.y>=h?m=new Xi(m.x+(h-m.y)/(E.y-m.y)*(E.x-m.x),h)._round():E.y>=h&&(E=new Xi(m.x+(h-m.y)/(E.y-m.y)*(E.x-m.x),h)._round()),w&&m.equals(w[w.length-1])||(w=[m],a.push(w)),w.push(E)))))}}return a}function Og(r){let e=0,i=0;for(const d of r)e+=d.w*d.h,i=Math.max(i,d.w);r.sort((d,_)=>_.h-d.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,a=0;for(const d of r)for(let _=o.length-1;_>=0;_--){const w=o[_];if(!(d.w>w.w||d.h>w.h)){if(d.x=w.x,d.y=w.y,a=Math.max(a,d.y+d.h),h=Math.max(h,d.x+d.w),d.w===w.w&&d.h===w.h){const M=o.pop();_<o.length&&(o[_]=M)}else d.h===w.h?(w.x+=d.w,w.w-=d.w):d.w===w.w?(w.y+=d.h,w.h-=d.h):(o.push({x:w.x+d.w,y:w.y,w:w.w-d.w,h:d.h}),w.y+=d.h,w.h-=d.h);break}}return{w:h,h:a,fill:e/(h*a)||0}}on(yu,"Anchor");const Wh=1;class Yh{static getImagePositionScale(e,i,o){return i&&e&&e.options&&e.options.transform?{x:e.options.transform.a,y:e.options.transform.d}:{x:o,y:o}}constructor(e,{pixelRatio:i,version:o,stretchX:h,stretchY:a,content:d,sdf:_,usvg:w},M,m){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=a,this.content=d,this.version=o,this.padding=M,this.sdf=_,this.scale=Yh.getImagePositionScale(m,w,i)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class Dg{constructor(e,i,o){const h={},a={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,h,Wh,d),this.addImages(i,a,2,d);const{w:_,h:w}=Og(d),M=new aa({width:_||1,height:w||1});for(const m in e){const E=e[m],I=h[m].paddedRect;aa.copy(E.data,M,{x:0,y:0},{x:I.x+Wh,y:I.y+Wh},E.data,o,E.sdf)}for(const m in i){const E=i[m],I=a[m].paddedRect;let b=a[m].padding;const T=I.x+b,A=I.y+b,k=E.data.width,O=E.data.height;b=b>1?b-1:b,aa.copy(E.data,M,{x:0,y:0},{x:T,y:A},E.data,o),aa.copy(E.data,M,{x:0,y:O-b},{x:T,y:A-b},{width:k,height:b},o),aa.copy(E.data,M,{x:0,y:0},{x:T,y:A+O},{width:k,height:b},o),aa.copy(E.data,M,{x:k-b,y:0},{x:T-b,y:A},{width:b,height:O},o),aa.copy(E.data,M,{x:0,y:0},{x:T+k,y:A},{width:b,height:O},o),aa.copy(E.data,M,{x:k-b,y:O-b},{x:T-b,y:A-b},{width:b,height:b},o),aa.copy(E.data,M,{x:0,y:O-b},{x:T+k,y:A-b},{width:b,height:b},o),aa.copy(E.data,M,{x:0,y:0},{x:T+k,y:A+O},{width:b,height:b},o),aa.copy(E.data,M,{x:k-b,y:0},{x:T-b,y:A+O},{width:b,height:b},o)}this.lut=o,this.image=M,this.iconPositions=h,this.patternPositions=a}addImages(e,i,o,h){for(const a in e){const d=e[a],_={x:0,y:0,w:d.data.width+2*o,h:d.data.height+2*o};h.push(_);const w=ci.deserializeFromString(a);i[a]=new Yh(_,d,o,w),d.hasRenderCallback&&this.haveRenderCallbacks.push(w.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const h in e.getUpdatedImages(o)){for(const a of Object.keys(this.iconPositions))ci.deserializeId(a)===h&&this.patchUpdatedImage(this.iconPositions[a],e.getImage(h,o),i);for(const a of Object.keys(this.patternPositions))ci.deserializeId(a)===h&&this.patchUpdatedImage(this.patternPositions[a],e.getImage(h,o),i)}}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,a]=e.tl,d=e.sdf;if(this.lut||d){const _={width:i.data.width,height:i.data.height},w=new aa(_);aa.copy(i.data,w,{x:0,y:0},{x:0,y:0},_,this.lut,d),o.update(w,{position:{x:h,y:a}})}else o.update(i.data,{position:{x:h,y:a}})}}on(Yh,"ImagePosition"),on(Dg,"ImageAtlas");const Kh=1e20;function zg(r,e,i,o,h,a,d,_,w){for(let M=e;M<e+o;M++)Ng(r,i*a+M,a,h,d,_,w);for(let M=i;M<i+h;M++)Ng(r,M*a+e,1,o,d,_,w)}function Ng(r,e,i,o,h,a,d){a[0]=0,d[0]=-Kh,d[1]=Kh,h[0]=r[e];for(let _=1,w=0,M=0;_<o;_++){h[_]=r[e+_*i];const m=_*_;do{const E=a[w];M=(h[_]-h[E]+m-E*E)/(_-E)/2}while(M<=d[w]&&--w>-1);w++,a[w]=_,d[w]=M,d[w+1]=Kh}for(let _=0,w=0;_<o;_++){for(;d[w+1]<_;)w++;const M=a[w],m=_-M;r[e+_*i]=h[M]+m*m}}const Bl=2,pp={none:0,ideographs:1,all:2};class Yc{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const h=[],a=this.urls[i]||Bn.GLYPHS_URL;for(const d in e)for(const _ of e[d])h.push({stack:d,id:_});Ts(h,({stack:d,id:_},w)=>{let M=this.entries[d];M||(M=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let m=M.glyphs[_];if(m!==void 0)return void w(null,{stack:d,id:_,glyph:m});if(m=this._tinySDF(M,d,_),m)return M.glyphs[_]=m,void w(null,{stack:d,id:_,glyph:m});const E=Math.floor(_/256);if(256*E>65535)return ur("glyphs > 65535 not supported"),void w(null,{stack:d,id:_,glyph:m});if(M.ranges[E])return void w(null,{stack:d,id:_,glyph:m});let I=M.requests[E];I||(I=M.requests[E]=[],Yc.loadGlyphRange(d,E,a,this.requestManager,(b,T)=>{if(T){M.ascender=T.ascender,M.descender=T.descender;for(const A in T.glyphs)this._doesCharSupportLocalGlyph(+A)||(M.glyphs[+A]=T.glyphs[+A]);M.ranges[E]=!0}for(const A of I)A(b,T);delete M.requests[E]})),I.push((b,T)=>{b?w(b):T&&w(null,{stack:d,id:_,glyph:T.glyphs[_]||null})})},(d,_)=>{if(d)o(d);else if(_){const w={};for(const{stack:M,id:m,glyph:E}of _)w[M]===void 0&&(w[M]={}),w[M].glyphs===void 0&&(w[M].glyphs={}),w[M].glyphs[m]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},w[M].ascender=this.entries[M].ascender,w[M].descender=this.entries[M].descender;o(null,w)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==pp.none&&(this.localGlyphMode===pp.all?!!this.localFontFamily:!!this.localFontFamily&&(jn["CJK Unified Ideographs"](e)||jn["Hangul Syllables"](e)||jn.Hiragana(e)||jn.Katakana(e)||jn["CJK Symbols and Punctuation"](e)||jn["CJK Unified Ideographs Extension A"](e)||jn["CJK Unified Ideographs Extension B"](e)||jn.Osage(e)))}_tinySDF(e,i,o){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(o))return;let a=e.tinySDF;if(!a){let A="400";/bold/i.test(i)?A="900":/medium/i.test(i)?A="500":/light/i.test(i)&&(A="200"),a=e.tinySDF=new Yc.TinySDF({fontFamily:h,fontWeight:A,fontSize:24*Bl,buffer:3*Bl,radius:8*Bl}),a.fontWeight=A}if(this.localGlyphs[a.fontWeight][o])return this.localGlyphs[a.fontWeight][o];const d=String.fromCodePoint(o),{data:_,width:w,height:M,glyphWidth:m,glyphHeight:E,glyphLeft:I,glyphTop:b,glyphAdvance:T}=a.draw(d);return this.localGlyphs[a.fontWeight][o]={id:o,bitmap:new Vu({width:w,height:M},_),metrics:{width:m/Bl,height:E/Bl,left:I/Bl,top:b/Bl-27,advance:T/Bl,localGlyph:!0}}}}Yc.loadGlyphRange=function(r,e,i,o,h){const a=256*e,d=a+255,_=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${a}-${d}`),dr.Glyphs);zs(_,(w,M)=>{if(w)h(w);else if(M){const m={},E=function(I){return new Jd(I).readFields(O0,{})}(M);for(const I of E.glyphs)m[I.id]=I;h(null,{glyphs:m,ascender:E.ascender,descender:E.descender})}})},Yc.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:h="sans-serif",fontWeight:a="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const _=this.size=r+4*e,w=this._createCanvas(_),M=this.ctx=w.getContext("2d",{willReadFrequently:!0});M.font=`${d} ${a} ${r}px ${h}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:h,actualBoundingBoxRight:a}=this.ctx.measureText(r),d=Math.ceil(i),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-h))),w=Math.min(this.size-this.buffer,d+Math.ceil(o)),M=_+2*this.buffer,m=w+2*this.buffer,E=Math.max(M*m,0),I=new Uint8ClampedArray(E),b={data:I,width:M,height:m,glyphWidth:_,glyphHeight:w,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(_===0||w===0)return b;const{ctx:T,buffer:A,gridInner:k,gridOuter:O}=this;T.clearRect(A,A,_,w),T.fillText(r,A,A+d);const U=T.getImageData(A,A,_,w);O.fill(Kh,0,E),k.fill(0,0,E);for(let G=0;G<w;G++)for(let B=0;B<_;B++){const H=U.data[4*(G*_+B)+3]/255;if(H===0)continue;const $=(G+A)*M+B+A;if(H===1)O[$]=0,k[$]=Kh;else{const ne=.5-H;O[$]=ne>0?ne*ne:0,k[$]=ne<0?ne*ne:0}}zg(O,0,0,M,m,M,this.f,this.v,this.z),zg(k,A,A,_,w,M,this.f,this.v,this.z);for(let G=0;G<E;G++){const B=Math.sqrt(O[G])-Math.sqrt(k[G]);I[G]=Math.round(255-255*(B/this.radius+this.cutoff))}return b}};const ju=Wh;function Fg(r,e){return r+e[1]-e[0]}function Bg(r,e,i,o,h=1){const a=[],d=r.imagePrimary,_=d.pixelRatio,w=d.paddedRect.w-2*ju,M=d.paddedRect.h-2*ju,m=(r.right-r.left)*h,E=(r.bottom-r.top)*h,I=d.stretchX||[[0,w]],b=d.stretchY||[[0,M]],T=I.reduce(Fg,0),A=b.reduce(Fg,0),k=w-T,O=M-A;let U=0,G=T,B=0,H=A,$=0,ne=k,me=0,de=O;if(d.content&&o){const Fe=d.content;U=ef(I,0,Fe[0]),B=ef(b,0,Fe[1]),G=ef(I,Fe[0],Fe[2]),H=ef(b,Fe[1],Fe[3]),$=Fe[0]-U,me=Fe[1]-B,ne=Fe[2]-Fe[0]-G,de=Fe[3]-Fe[1]-H}const ue=(Fe,ye,Ve,$e)=>{const Ze=tf(Fe.stretch-U,G,m,r.left*h),Qe=nf(Fe.fixed-$,ne,Fe.stretch,T),ht=tf(ye.stretch-B,H,E,r.top*h),wt=nf(ye.fixed-me,de,ye.stretch,A),st=tf(Ve.stretch-U,G,m,r.left*h),Jt=nf(Ve.fixed-$,ne,Ve.stretch,T),zi=tf($e.stretch-B,H,E,r.top*h),Kt=nf($e.fixed-me,de,$e.stretch,A),wn=new Xi(Ze,ht),_n=new Xi(st,ht),Wi=new Xi(st,zi),Fi=new Xi(Ze,zi),qn=new Xi(Qe/_,wt/_),En=new Xi(Jt/_,Kt/_),kn=e*Math.PI/180;if(kn){const Xr=Math.sin(kn),qs=Math.cos(kn),Ps=[qs,-Xr,Xr,qs];wn._matMult(Ps),_n._matMult(Ps),Fi._matMult(Ps),Wi._matMult(Ps)}const wr=Fe.stretch+Fe.fixed,zr=Ve.stretch+Ve.fixed,Nr=ye.stretch+ye.fixed,Fr=$e.stretch+$e.fixed,Zr=r.imageSecondary;return{tl:wn,tr:_n,bl:Fi,br:Wi,texPrimary:{x:d.paddedRect.x+ju+wr,y:d.paddedRect.y+ju+Nr,w:zr-wr,h:Fr-Nr},texSecondary:Zr?{x:Zr.paddedRect.x+ju+wr,y:Zr.paddedRect.y+ju+Nr,w:zr-wr,h:Fr-Nr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qn,pixelOffsetBR:En,minFontScaleX:ne/_/m,minFontScaleY:de/_/E,isSDF:i}};if(o&&(d.stretchX||d.stretchY)){const Fe=Ug(I,k,T),ye=Ug(b,O,A);for(let Ve=0;Ve<Fe.length-1;Ve++){const $e=Fe[Ve],Ze=Fe[Ve+1];for(let Qe=0;Qe<ye.length-1;Qe++)a.push(ue($e,ye[Qe],Ze,ye[Qe+1]))}}else a.push(ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:M+1}));return a}function ef(r,e,i){let o=0;for(const h of r)o+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return o}function Ug(r,e,i){const o=[{fixed:-ju,stretch:0}];for(const[h,a]of r){const d=o[o.length-1];o.push({fixed:h-d.stretch,stretch:d.stretch}),o.push({fixed:h-d.stretch,stretch:d.stretch+(a-h)})}return o.push({fixed:e+ju,stretch:i}),o}function tf(r,e,i,o){return r/e*i+o}function nf(r,e,i,o){return r-e*i/o}function G0(r,e,i,o){const h=e+r.positionedLines[o].lineOffset;return o===0?i+h/2:i+(h+(e+r.positionedLines[o-1].lineOffset))/2}function j0(r,e=1,i=!1){let o=1/0,h=1/0,a=-1/0,d=-1/0;const _=r[0];for(let b=0;b<_.length;b++){const T=_[b];(!b||T.x<o)&&(o=T.x),(!b||T.y<h)&&(h=T.y),(!b||T.x>a)&&(a=T.x),(!b||T.y>d)&&(d=T.y)}const w=Math.min(a-o,d-h);let M=w/2;const m=new Eo([],q0);if(w===0)return new Xi(o,h);for(let b=o;b<a;b+=w)for(let T=h;T<d;T+=w)m.push(new Kc(b+M,T+M,M,r));let E=function(b){let T=0,A=0,k=0;const O=b[0];for(let U=0,G=O.length,B=G-1;U<G;B=U++){const H=O[U],$=O[B],ne=H.x*$.y-$.x*H.y;A+=(H.x+$.x)*ne,k+=(H.y+$.y)*ne,T+=3*ne}return new Kc(A/T,k/T,0,b)}(r),I=m.length;for(;m.length;){const b=m.pop();(b.d>E.d||!E.d)&&(E=b,i&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,I)),b.max-E.d<=e||(M=b.h/2,m.push(new Kc(b.p.x-M,b.p.y-M,M,r)),m.push(new Kc(b.p.x+M,b.p.y-M,M,r)),m.push(new Kc(b.p.x-M,b.p.y+M,M,r)),m.push(new Kc(b.p.x+M,b.p.y+M,M,r)),I+=4)}return i&&(console.log(`num probes: ${I}`),console.log(`best distance: ${E.d}`)),E.p}function q0(r,e){return e.max-r.max}class Kc{constructor(e,i,o,h){this.p=new Xi(e,i),this.h=o,this.d=function(a,d){let _=!1,w=1/0;for(let M=0;M<d.length;M++){const m=d[M];for(let E=0,I=m.length,b=I-1;E<I;b=E++){const T=m[E],A=m[b];T.y>a.y!=A.y>a.y&&a.x<(A.x-T.x)*(a.y-T.y)/(A.y-T.y)+T.x&&(_=!_),w=Math.min(w,Ae(a,T,A))}}return(_?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const mp=Number.POSITIVE_INFINITY,H0=Math.sqrt(2);function Vg(r,[e,i]){let o=0,h=0;if(i===mp){e<0&&(e=0);const a=e/H0;switch(r){case"top-right":case"top-left":h=a-7;break;case"bottom-right":case"bottom-left":h=7-a;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(r){case"top-right":case"bottom-right":o=-a;break;case"top-left":case"bottom-left":o=a;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(r){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,h]}function gp(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Z0(r,e,i,o,h,a,d,_,w,M,m,E,I,b,T){let A=a.textMaxSize.evaluate(e,{},E);A===void 0?A=d*a.textScaleFactor:A*=a.textScaleFactor;const k=r.layers[0].layout,O=k.get("icon-offset").evaluate(e,{},E),U=jg(i.horizontal)||i.vertical,G=I.name==="globe",B=fa,H=d*a.textScaleFactor/B,$=r.tilePixelRatio*A/B,ne=(Ze=r.overscaling,r.zoom>18&&Ze>2&&(Ze>>=1),Math.max(mn/(512*Ze),1)*k.get("symbol-spacing")),me=k.get("text-padding")*r.tilePixelRatio,de=k.get("icon-padding")*r.tilePixelRatio,ue=Sr(k.get("text-max-angle")),Fe=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",ye=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Ve=k.get("symbol-placement"),$e=ne/2;var Ze;const Qe=k.get("icon-text-fit").evaluate(e,{},E),ht=k.get("icon-text-fit-padding").evaluate(e,{},E),wt=Qe!=="none";let st;r.hasAnyIconTextFit===!1&&wt&&(r.hasAnyIconTextFit=!0),o&&wt&&(r.allowVerticalPlacement&&i.vertical&&(st=Mg(o,i.vertical,Qe,ht,O,H)),U&&(o=Mg(o,U,Qe,ht,O,H)));const Jt=(zi,Kt,wn)=>{if(Kt.x<0||Kt.x>=mn||Kt.y<0||Kt.y>=mn)return;let _n=null;if(G){const{x:Wi,y:Fi,z:qn}=I.projectTilePoint(Kt.x,Kt.y,wn);_n={anchor:new yu(Wi,Fi,qn,0,void 0),up:I.upVector(wn,Kt.x,Kt.y)}}(function(Wi,Fi,qn,En,kn,wr,zr,Nr,Fr,Zr,Xr,qs,Ps,Cr,Es,Cs,eo,Mo,Vo,Ao,go,ko,qo,pa,Js,Va,jl){const Tl=Wi.addToLineVertexArray(Fi,En);let Sl,Ec,$u,Tc,gd,Ey,Ty,Sy=0,Iy=0,My=0,Ay=0,Kp=-1,Jp=-1;const tu={};let Cy=bo("");const Sc=qn?qn.anchor:Fi,Qp=Fr.layout.get("icon-text-fit").evaluate(go,{},Js)!=="none";let em=0,tm=0;if(Fr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[em,tm]=Fr.layout.get("text-offset").evaluate(go,{},Js).map(sl=>sl*fa):(em=Fr.layout.get("text-radial-offset").evaluate(go,{},Js)*fa,tm=mp),Wi.allowVerticalPlacement&&kn.vertical){const sl=kn.vertical;if(Es)Ey=_p(sl),Nr&&(Ty=_p(Nr));else{const Ga=Fr.layout.get("text-rotate").evaluate(go,{},Js)+90;$u=rf(Zr,Sc,Fi,Xr,qs,Ps,sl,Cr,Ga,Cs),Nr&&(Tc=rf(Zr,Sc,Fi,Xr,qs,Ps,Nr,Mo,Ga))}}if(wr){const sl=Wi.iconSizeData,Ga=Fr.layout.get("icon-rotate").evaluate(go,{},Js),_d=Bg(wr,Ga,qo,Qp,ko.iconScaleFactor),nm=Nr?Bg(Nr,Ga,qo,Qp,ko.iconScaleFactor):void 0;Ec=rf(Zr,Sc,Fi,Xr,qs,Ps,wr,Mo,Ga,null),Sy=4*_d.length;let Ic=null;sl.kind==="source"?(Ic=[Fl*Fr.layout.get("icon-size").evaluate(go,{},Js)*ko.iconScaleFactor],Ic[0]>qu&&ur(`${Wi.layerIds[0]}: Value for "icon-size" is >= ${Jh}. Reduce your "icon-size".`)):sl.kind==="composite"&&(Ic=[Fl*ko.compositeIconSizes[0].evaluate(go,{},Js)*ko.iconScaleFactor,Fl*ko.compositeIconSizes[1].evaluate(go,{},Js)*ko.iconScaleFactor],(Ic[0]>qu||Ic[1]>qu)&&ur(`${Wi.layerIds[0]}: Value for "icon-size" is >= ${Jh}. Reduce your "icon-size".`)),Wi.addSymbols(Wi.icon,_d,Ic,Ao,Vo,go,!1,qn,Fi,Tl.lineStartIndex,Tl.lineLength,-1,pa,Js,Va,jl),Kp=Wi.icon.placedSymbolArray.length-1,nm&&(Iy=4*nm.length,Wi.addSymbols(Wi.icon,nm,Ic,Ao,Vo,go,nl.vertical,qn,Fi,Tl.lineStartIndex,Tl.lineLength,-1,pa,Js,Va,jl),Jp=Wi.icon.placedSymbolArray.length-1)}for(const sl in kn.horizontal){const Ga=kn.horizontal[sl];Sl||(Cy=bo(Ga.text),Es?gd=_p(Ga):Sl=rf(Zr,Sc,Fi,Xr,qs,Ps,Ga,Cr,Fr.layout.get("text-rotate").evaluate(go,{},Js),Cs));const _d=Ga.positionedLines.length===1;if(My+=Gg(Wi,qn,Fi,Ga,zr,Fr,Es,go,Cs,Tl,kn.vertical?nl.horizontal:nl.horizontalOnly,_d?Object.keys(kn.horizontal):[sl],tu,Kp,ko,pa,Js,Va),_d)break}kn.vertical&&(Ay+=Gg(Wi,qn,Fi,kn.vertical,zr,Fr,Es,go,Cs,Tl,nl.vertical,["vertical"],tu,Jp,ko,pa,Js,Va));let Wu=-1;const im=(sl,Ga)=>sl?Math.max(sl,Ga):Ga;Wu=im(gd,Wu),Wu=im(Ey,Wu),Wu=im(Ty,Wu);const Sx=Wu>-1?1:0;Wi.glyphOffsetArray.length>=65535&&ur("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),go.sortKey!==void 0&&Wi.addToSortKeyRanges(Wi.symbolInstances.length,go.sortKey),Wi.symbolInstances.emplaceBack(Fi.x,Fi.y,Sc.x,Sc.y,Sc.z,tu.right>=0?tu.right:-1,tu.center>=0?tu.center:-1,tu.left>=0?tu.left:-1,tu.vertical>=0?tu.vertical:-1,Kp,Jp,Cy,Sl!==void 0?Sl:Wi.collisionBoxArray.length,Sl!==void 0?Sl+1:Wi.collisionBoxArray.length,$u!==void 0?$u:Wi.collisionBoxArray.length,$u!==void 0?$u+1:Wi.collisionBoxArray.length,Ec!==void 0?Ec:Wi.collisionBoxArray.length,Ec!==void 0?Ec+1:Wi.collisionBoxArray.length,Tc||Wi.collisionBoxArray.length,Tc?Tc+1:Wi.collisionBoxArray.length,Xr,My,Ay,Sy,Iy,Sx,0,em,tm,Wu,0,Qp?1:0)})(r,Kt,_n,zi,i,o,h,st,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,me,Fe,w,0,de,ye,O,e,a,M,m,E,b,T)};if(Ve==="line")for(const zi of kg(e.geometry,0,0,mn,mn)){const Kt=V0(zi,ne,ue,i.vertical||U,o,B,$,r.overscaling,mn);for(const wn of Kt)U&&X0(r,U.text,$e,wn)||Jt(zi,wn,E)}else if(Ve==="line-center"){for(const zi of e.geometry)if(zi.length>1){const Kt=U0(zi,ue,i.vertical||U,o,B,$);Kt&&Jt(zi,Kt,E)}}else if(e.type==="Polygon")for(const zi of qd(e.geometry,0)){const Kt=j0(zi,16);Jt(zi[0],new yu(Kt.x,Kt.y,0,0,void 0),E)}else if(e.type==="LineString")for(const zi of e.geometry)Jt(zi,new yu(zi[0].x,zi[0].y,0,0,void 0),E);else if(e.type==="Point")for(const zi of e.geometry)for(const Kt of zi)Jt([Kt],new yu(Kt.x,Kt.y,0,0,void 0),E)}const Jh=255,qu=Jh*Fl;function Gg(r,e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k,O){const U=function(H,$,ne,me,de,ue,Fe,ye){const Ve=[];if($.positionedLines.length===0)return Ve;const $e=me.layout.get("text-rotate").evaluate(ue,{})*Math.PI/180,Ze=function(Jt){const zi=Jt[0],Kt=Jt[1],wn=zi*Kt;return wn>0?[zi,-Kt]:wn<0?[-zi,Kt]:zi===0?[Kt,zi]:[Kt,-zi]}(ne);let Qe=Math.abs($.top-$.bottom);for(const Jt of $.positionedLines)Qe-=Jt.lineOffset;const ht=$.positionedLines.length,wt=Qe/ht;let st=$.top-ne[1];for(let Jt=0;Jt<ht;++Jt){const zi=$.positionedLines[Jt];st=G0($,wt,st,Jt);for(const Kt of zi.positionedGlyphs){if(!Kt.rect)continue;const wn=Kt.rect||{};let _n=bg+1,Wi=!0,Fi=1,qn=0;if(Kt.imageName){const Ao=Fe[oi.build(Kt.imageName).getSerializedPrimary()];if(!Ao)continue;if(Ao.sdf){ur("SDF images are not supported in formatted text and will be ignored.");continue}Wi=!1,Fi=Ao.pixelRatio,_n=Wh/Fi}const En=(de||ye)&&Kt.vertical,kn=Kt.metrics.advance*Kt.scale/2,wr=Kt.metrics,zr=Kt.rect;if(zr===null)continue;ye&&$.verticalizable&&(qn=Kt.imageName?kn-Kt.metrics.width*Kt.scale/2:0);const Nr=de?[Kt.x+kn,Kt.y]:[0,0];let Fr=[0,0],Zr=[0,0],Xr=!1;de||(En?(Zr=[Kt.x+kn+Ze[0],Kt.y+Ze[1]-qn],Xr=!0):Fr=[Kt.x+kn+ne[0],Kt.y+ne[1]-qn]);const qs=zr.w*Kt.scale/(Fi*(Kt.localGlyph?Bl:1)),Ps=zr.h*Kt.scale/(Fi*(Kt.localGlyph?Bl:1));let Cr,Es,Cs,eo;if(En){const Ao=Kt.y-st,go=new Xi(-kn,kn-Ao),ko=-Math.PI/2,qo=new Xi(...Zr);Cr=new Xi(-kn+Fr[0],Fr[1]),Cr._rotateAround(ko,go)._add(qo),Cr.x+=-Ao+kn,Cr.y-=(wr.left-_n)*Kt.scale;const pa=Kt.imageName?wr.advance*Kt.scale:fa*Kt.scale,Js=String.fromCodePoint(Kt.glyph);L0(Js)?Cr.x+=(1-_n)*Kt.scale:R0(Js)?Cr.x+=pa-wr.height*Kt.scale+(-_n-1)*Kt.scale:Cr.x+=Kt.imageName||wr.width+2*_n===zr.w&&wr.height+2*_n===zr.h?(pa-Ps)/2:(pa-(wr.height+2*_n)*Kt.scale)/2,Es=new Xi(Cr.x,Cr.y-qs),Cs=new Xi(Cr.x+Ps,Cr.y),eo=new Xi(Cr.x+Ps,Cr.y-qs)}else{const Ao=(wr.left-_n)*Kt.scale-kn+Fr[0],go=(-wr.top-_n)*Kt.scale+Fr[1],ko=Ao+qs,qo=go+Ps;Cr=new Xi(Ao,go),Es=new Xi(ko,go),Cs=new Xi(Ao,qo),eo=new Xi(ko,qo)}if($e){let Ao;Ao=de?new Xi(0,0):Xr?new Xi(Ze[0],Ze[1]):new Xi(ne[0],ne[1]),Cr._rotateAround($e,Ao),Es._rotateAround($e,Ao),Cs._rotateAround($e,Ao),eo._rotateAround($e,Ao)}const Mo=new Xi(0,0),Vo=new Xi(0,0);Ve.push({tl:Cr,tr:Es,bl:Cs,br:eo,texPrimary:wn,texSecondary:void 0,writingMode:$.writingMode,glyphOffset:Nr,sectionIndex:Kt.sectionIndex,isSDF:Wi,pixelOffsetTL:Mo,pixelOffsetBR:Vo,minFontScaleX:0,minFontScaleY:0})}}return Ve}(0,o,w,a,d,_,h,r.allowVerticalPlacement),G=r.textSizeData;let B=null;G.kind==="source"?(B=[Fl*a.layout.get("text-size").evaluate(_,{},k)*T.textScaleFactor],B[0]>qu&&ur(`${r.layerIds[0]}: Value for "text-size" is >= ${Jh}. Reduce your "text-size".`)):G.kind==="composite"&&(B=[Fl*T.compositeTextSizes[0].evaluate(_,{},k)*T.textScaleFactor,Fl*T.compositeTextSizes[1].evaluate(_,{},k)*T.textScaleFactor],(B[0]>qu||B[1]>qu)&&ur(`${r.layerIds[0]}: Value for "text-size" is >= ${Jh}. Reduce your "text-size".`)),r.addSymbols(r.text,U,B,w,d,_,m,e,i,M.lineStartIndex,M.lineLength,b,A,k,O,!1);for(const H of E)I[H]=r.text.placedSymbolArray.length-1;return 4*U.length}function jg(r){for(const e in r)return r[e];return null}function rf(r,e,i,o,h,a,d,_,w,M){let m=d.top,E=d.bottom,I=d.left,b=d.right;const T=d.collisionPadding;if(T&&(I-=T[0],m-=T[1],b+=T[2],E+=T[3]),w){const A=new Xi(I,m),k=new Xi(b,m),O=new Xi(I,E),U=new Xi(b,E),G=Sr(w);let B=new Xi(0,0);M&&(B=new Xi(M[0],M[1])),A._rotateAround(G,B),k._rotateAround(G,B),O._rotateAround(G,B),U._rotateAround(G,B),I=Math.min(A.x,k.x,O.x,U.x),b=Math.max(A.x,k.x,O.x,U.x),m=Math.min(A.y,k.y,O.y,U.y),E=Math.max(A.y,k.y,O.y,U.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,I,m,b,E,_,o,h,a),r.length-1}function _p(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function X0(r,e,i,o){const h=r.compareText;if(e in h){const a=h[e];for(let d=a.length-1;d>=0;d--)if(o.dist(a[d])<i)return!0}else h[e]=[];return h[e].push(o),!1}function qg(r,e){const i=r.fovAboveCenter,o=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,h=(r._camera.position[2]*r.worldSize-o)/Math.cos(r._pitch),a=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let d=Math.sin(r._pitch)*a+h;const _=h*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let w=Math.max(r.zoom-17,0);r.isOrthographic&&(w/=10),d*=1+w}return Math.min(1.01*d,_)}function Qh(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),o=r.x*i,h=(r.x+1)*i,a=r.y*i,d=(r.y+1)*i,_=Ia(o),w=Ia(h),M=ra(a),m=ra(d),E=e.project(_,M),I=e.project(w,M),b=e.project(w,m),T=e.project(_,m);let A=Math.min(E.x,I.x,b.x,T.x),k=Math.min(E.y,I.y,b.y,T.y),O=Math.max(E.x,I.x,b.x,T.x),U=Math.max(E.y,I.y,b.y,T.y);const G=i/16;function B($,ne,me,de,ue,Fe){const ye=(me+ue)/2,Ve=(de+Fe)/2,$e=e.project(Ia(ye),ra(Ve)),Ze=Math.max(0,A-$e.x,k-$e.y,$e.x-O,$e.y-U);A=Math.min(A,$e.x),O=Math.max(O,$e.x),k=Math.min(k,$e.y),U=Math.max(U,$e.y),Ze>G&&(B($,$e,me,de,ye,Ve),B($e,ne,ye,Ve,ue,Fe))}B(E,I,o,a,h,a),B(I,b,h,a,h,d),B(b,T,h,d,o,d),B(T,E,o,d,o,a),A-=G,k-=G,O+=G,U+=G;const H=1/Math.max(O-A,U-k);return{scale:H,x:A*H,y:k*H,x2:O*H,y2:U*H,projection:e}}function Hg(r,{x:e,y:i},o=0){return new Xi(((e-o)*r.scale-r.x)*mn,(i*r.scale-r.y)*mn)}const $0=Pe.mat4.identity(new Float32Array(16));class Hu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new as(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return ya(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return qg(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,h){const a=e.horizonLineFromTop(!1),d=new Xi(i,Math.max(a,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,h))}pointCoordinate3D(e,i,o){const h=new Xi(i,o);if(e.elevation)return e.elevation.pointCoordinate(h);{const a=this.pointCoordinate(e,h.x,h.y,0);return[a.x,a.y,a.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return $0}createTileMatrix(e,i,o){let h,a,d;const _=o.canonical,w=Pe.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=Qh(_,this);h=1,a=M.x+o.wrap*M.scale,d=M.y,Pe.mat4.scale(w,w,[h/M.scale,h/M.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(_.z),a=(_.x+Math.pow(2,_.z)*o.wrap)*h,d=_.y*h;return Pe.mat4.translate(w,w,[a,d,0]),Pe.mat4.scale(w,w,[h/mn,h/mn,1]),w}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class W0 extends Hu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Sr(i));this.n=(h+Math.sin(Sr(o)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:h,r0:a}=this,d=Sr(e-this.center[0]),_=Sr(i),w=Math.sqrt(h-2*o*Math.sin(_))/o;return{x:w*Math.sin(d*o),y:w*Math.cos(d*o)-a,z:0}}unproject(e,i){const{n:o,c:h,r0:a}=this,d=a+i;let _=Math.atan2(e,Math.abs(d))*Math.sign(d);d*o<0&&(_-=Math.PI*Math.sign(e)*Math.sign(d));const w=Sr(this.center[0])*o;_=Pr(_,-Math.PI-w,Math.PI-w);const M=cn(un(_/o)+this.center[0],-180,180),m=Math.asin(cn((h-(e*e+d*d)*o*o)/(2*o),-1,1)),E=cn(un(m),-vo,vo);return new as(M,E)}}const ed=1.340264,td=-.081106,id=893e-6,nd=.003796,sf=Math.sqrt(3)/2;class Y0 extends Hu{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(sf*Math.sin(i)),h=o*o,a=h*h*h;return{x:.5*(e*Math.cos(o)/(sf*(ed+3*td*h+a*(7*id+9*nd*h)))/Math.PI+.5),y:1-.5*(o*(ed+td*h+a*(id+nd*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,h=o*o,a=h*h*h;for(let m,E,I,b=0;b<12&&(E=o*(ed+td*h+a*(id+nd*h))-i,I=ed+3*td*h+a*(7*id+9*nd*h),m=E/I,o=cn(o-m,-Math.PI/3,Math.PI/3),h=o*o,a=h*h*h,!(Math.abs(m)<1e-12));++b);const d=sf*e*(ed+3*td*h+a*(7*id+9*nd*h))/Math.cos(o),_=Math.asin(Math.sin(o)/sf),w=cn(180*d/Math.PI,-180,180),M=cn(180*_/Math.PI,-vo,vo);return new as(w,M)}}class K0 extends Hu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),h=cn(360*(.5-i),-vo,vo);return new as(o,h)}}const Jc=Math.PI/2;function of(r){return Math.tan((Jc+r)/2)}class J0 extends Hu{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let h=Sr(i),a=Sr(o);this.southernCenter=h+a<0,this.southernCenter&&(h=-h,a=-a);const d=Math.cos(h),_=of(h);this.n=h===a?Math.sin(h):Math.log(d/Math.cos(a))/Math.log(of(a)/_),this.f=d*Math.pow(of(h),this.n)/this.n}project(e,i){i=Sr(i),this.southernCenter&&(i=-i),e=Sr(e-this.center[0]);const o=1e-6,{n:h,f:a}=this;a>0?i<-Jc+o&&(i=-Jc+o):i>Jc-o&&(i=Jc-o);const d=a/Math.pow(of(i),h);let _=d*Math.sin(h*e),w=a-d*Math.cos(h*e);return _=.5*(_/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:_,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:h}=this,a=h-i,d=Math.sign(a),_=Math.sign(o)*Math.sqrt(e*e+a*a);let w=Math.atan2(e,Math.abs(a))*d;a*o<0&&(w-=Math.PI*Math.sign(e)*d);const M=cn(un(w/o)+this.center[0],-180,180),m=cn(un(2*Math.atan(Math.pow(h/_,1/o))-Jc),-vo,vo);return new as(M,this.southernCenter?-m:m)}}class Zg extends Hu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:xl(e),y:il(i),z:0}}unproject(e,i){const o=Ia(e),h=ra(i);return new as(o,h)}}const Xg=Sr(vo);class Q0 extends Hu{project(e,i){const o=(i=Sr(i))*i,h=o*o;return{x:.5*((e=Sr(e))*(.8707-.131979*o+h*(h*(.003971*o-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+h*(.028874*o-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,h=25,a=0,d=o*o;do{d=o*o;const M=d*d;a=(o*(1.007226+d*(.015085+M*(.028874*d-.044475-.005916*M)))-i)/(1.007226+d*(.045255+M*(.259866*d-.311325-.005916*11*M))),o=cn(o-a,-Xg,Xg)}while(Math.abs(a)>1e-6&&--h>0);d=o*o;const _=cn(un(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),w=un(o);return new as(_,w)}}const $g=Sr(vo);class ev extends Hu{project(e,i){i=Sr(i),e=Sr(e);const o=Math.cos(i),h=2/Math.PI,a=Math.acos(o*Math.cos(e/2)),d=Math.sin(a)/a,_=.5*(e*h+2*o*Math.sin(e/2)/d)||0,w=.5*(i+Math.sin(i)/d)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,a=25;const d=1e-6;let _=0,w=0;do{const M=Math.cos(h),m=Math.sin(h),E=2*m*M,I=m*m,b=M*M,T=Math.cos(o/2),A=Math.sin(o/2),k=2*T*A,O=A*A,U=1-b*T*T,G=U?1/U:0,B=U?Math.acos(M*T)*Math.sqrt(1/U):0,H=.5*(2*B*M*A+2*o/Math.PI)-e,$=.5*(B*m+h)-i,ne=.5*G*(b*O+B*M*T*I)+1/Math.PI,me=G*(k*E/4-B*m*A),de=.125*G*(E*A-B*m*b*k),ue=.5*G*(I*T+B*O*M)+.5,Fe=me*de-ue*ne;_=($*me-H*ue)/Fe,w=(H*de-$*ne)/Fe,o=cn(o-_,-Math.PI,Math.PI),h=cn(h-w,-$g,$g)}while((Math.abs(_)>d||Math.abs(w)>d)&&--a>0);return new as(un(o),un(h))}}class Wg extends Hu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Sr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:h}=this;return{x:Sr(e)*h*o+.5,y:-Math.sin(Sr(i))/h*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:h}=this,a=-(i-.5)/o,d=cn(un((e-.5)/o)/h,-180,180),_=Math.asin(cn(a*h,-1,1)),w=cn(un(_),-vo,vo);return new as(d,w)}}class tv extends Zg{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const h=Fs(e,i,o),a=$o(Fo(o));return Pe.vec3.transformMat4(h,h,a),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i){const o=pu(i.lat,i.lng),h=Pe.vec3.normalize([],o),a=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,d=ya(1,0)*mn*a;Pe.vec3.scaleAndAdd(o,o,h,d);const _=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.multiply(_,e.pixelMatrix,e.globeMatrix),Pe.vec3.transformMat4(o,o,_),new Xi(o[0],o[1])}pixelsPerMeter(e,i){return ya(1,0)*i}pixelSpaceConversion(e,i,o){const h=ya(1,e)*i,a=Ye(ya(1,45)*i,h,o);return this.pixelsPerMeter(e,i)/a}createTileMatrix(e,i,o){const h=Us(Fo(o.canonical));return Pe.mat4.multiply(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:o}=e,h=$o(Fo(i));return Pe.mat4.rotateY(h,h,Sr(o.lng)),Pe.mat4.rotateX(h,h,Sr(o.lat)),Pe.mat4.scale(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,o,h){return _s(e,i,o,!0)||new n(0,0)}pointCoordinate3D(e,i,o){const h=this.pointCoordinate(e,i,o,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!_s(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,a){const d=h.cameraToCenterDistance,_=h._centerAltitude*a,w=h._camera,M=h._camera.forward(),m=Pe.vec3.add([],Pe.vec3.scale([],M,-d),[0,0,_]),E=h.worldSize/(2*Math.PI),I=[0,0,-E],b=h.width/h.height,T=Math.tan(h.fovAboveCenter),A=Pe.vec3.scale([],w.up(),T),k=Pe.vec3.scale([],w.right(),T*b),O=Pe.vec3.normalize([],Pe.vec3.add([],Pe.vec3.add([],M,A),k)),U=[];let G;if(new Tr(m,O).closestPointOnSphere(I,E,U)){const B=Pe.vec3.add([],U,I),H=Pe.vec3.sub([],B,m);G=Math.cos(h.fovAboveCenter)*Pe.vec3.length(H)}else{const B=Pe.vec3.sub([],m,I),H=Pe.vec3.sub([],I,m);Pe.vec3.normalize(H,H);const $=Pe.vec3.length(B)-E;G=Math.sqrt($*($+2*E));const ne=Math.acos(G/(E+$))-Math.acos(Pe.vec3.dot(M,H));G*=Math.cos(ne)}return 1.01*G}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=ba(e.zoom);if(o>0){const h=qg(e,ya(1,e.center.lat)*e.worldSize),a=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ye(i,h+a*(1-Math.cos(d)),Math.pow(o,10))}return i}upVector(e,i,o){return Fs(i,o,e,1)}upVectorScale(e){return{metersToTile:$r(Kr(Fo(e)))}}}function Yg(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new Zg(r);case"equirectangular":return new K0(r);case"naturalEarth":return new Q0(r);case"equalEarth":return new Y0(r);case"winkelTripel":return new ev(r);case"albers":return i?new Wg(r):new W0(r);case"lambertConformalConic":return i?new Wg(r):new J0(r);case"globe":return new tv(r)}throw new Error(`Invalid projection name: ${r.name}`)}const iv=Xc.VectorTileFeature.types,nv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function af(r,e,i,o,h,a,d,_,w,M,m,E,I){const b=_?Math.min(qu,Math.round(_[0])):0,T=_?Math.min(qu,Math.round(_[1])):0;r.emplaceBack(e,i,Math.round(32*o),Math.round(32*h),a,d,(b<<1)+(w?1:0),T,16*M,16*m,256*E,256*I)}function lf(r,e,i){r.emplaceBack(e,i)}function uf(r,e,i,o,h,a,d){r.emplaceBack(e,i,o,h,a,d)}function cf(r,e,i,o,h){r.emplaceBack(e,i,o,h),r.emplaceBack(e,i,o,h),r.emplaceBack(e,i,o,h),r.emplaceBack(e,i,o,h)}function rv(r){for(const e of r.sections)if(ch(e.text))return!0;return!1}class yp{constructor(e){this.layoutVertexArray=new yh,this.indexArray=new na,this.programConfigurations=e,this.segments=new yo,this.dynamicLayoutVertexArray=new cu,this.opacityVertexArray=new xh,this.placedSymbolArray=new Ad,this.iconTransitioningVertexArray=new Wl,this.globeExtVertexArray=new vh,this.zOffsetVertexArray=new sc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,h,a){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,b0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,E0.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,nv,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,S0.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,w0.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||a)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,T0.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}on(yp,"SymbolBuffers");class vp{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new yo,this.collisionVertexArray=new Eh,this.collisionVertexArrayExt=new cu}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,I0.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,M0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}on(vp,"CollisionBuffers");class hf{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Pe.mat4.identity([]),this.placementViewportMatrix=Pe.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=lp(this.zoom,i["text-size"]),this.iconSizeData=lp(this.zoom,i["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),a=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=a!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(a==="viewport-y"||a==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(d=>nl[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new yp(new Jl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new yp(new Jl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Ld,this.lineVertexArray=new Rd,this.symbolInstances=new Pd}calculateGlyphDependencies(e,i,o,h,a){for(const d of e){const _=d.codePointAt(0);if(_===void 0)break;if(i[_]=!0,h&&a&&_<=65535){const w=Xh[d];w&&(i[w.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!ep(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,h){const a=this.layers[0],d=a.layout,_=this.projection.name==="globe",w=d.get("text-font"),M=d.get("text-field"),m=d.get("icon-image"),[E,I]=d.get("icon-size-scale-range"),b=cn(i.scaleFactor||1,E,I),T=(M.value.kind!=="constant"||M.value.value instanceof Nt&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),A=m.value.kind!=="constant"||!!m.value.value||Object.keys(m.parameters).length>0,k=d.get("symbol-sort-key");if(this.features=[],!T&&!A)return;const O=i.iconDependencies,U=i.glyphDependencies,G=i.availableImages,B=new Ws(this.zoom);for(const{feature:H,id:$,index:ne,sourceLayerIndex:me}of e){const de=a._featureFilter.needGeometry,ue=z(H,de);if(!a._featureFilter.filter(B,ue,o))continue;if(de||(ue.geometry=R(H,o,h)),_&&H.type!==1&&o.z<=5){const Ze=ue.geometry,Qe=.98078528056,ht=(wt,st)=>{const Jt=Fs(wt.x,wt.y,o,1),zi=Fs(st.x,st.y,o,1);return Pe.vec3.dot(Jt,zi)<Qe};for(let wt=0;wt<Ze.length;wt++)Ze[wt]=x(Ze[wt],ht)}let Fe,ye;if(T){const Ze=a.getValueAndResolveTokens("text-field",ue,o,G),Qe=Nt.factory(Ze);rv(Qe)&&(this.hasRTLText=!0),(!this.hasRTLText||Ac()==="unavailable"||this.hasRTLText&&za.isParsed())&&(Fe=P0(Qe,a,ue))}if(A){const Ze=a.getValueAndResolveTokens("icon-image",ue,o,G);ye=Ze instanceof oi?Ze:oi.build(Ze)}if(!Fe&&!ye)continue;const Ve=this.sortFeaturesByKey?k.evaluate(ue,{},o):void 0,$e={id:$,text:Fe,icon:ye,index:ne,sourceLayerIndex:me,geometry:ue.geometry,properties:H.properties,type:iv[H.type],sortKey:Ve};if(this.features.push($e),ye){const Ze=ap(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],o,this.zoom,$e)*b*this.pixelRatio,Qe=ye.getPrimary().scaleSelf(Ze);if(O[Qe.id]=O[Qe.id]||[],O[Qe.id].push(Qe),ye.nameSecondary){const ht=ye.getSecondary().scaleSelf(Ze);O[ht.id]=O[ht.id]||[],O[ht.id].push(ht)}}if(Fe){const Ze=w.evaluate(ue,{},o).join(","),Qe=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(nl.vertical)>=0;for(const ht of Fe.sections)if(ht.image){const wt=ht.image.getPrimary().scaleSelf(this.pixelRatio);O[wt.id]=O[wt.id]||[],O[wt.id].push(wt)}else{const wt=Da(Fe.toString()),st=ht.fontStack||Ze,Jt=U[st]=U[st]||{};this.calculateGlyphDependencies(ht.text,Jt,Qe,this.allowVerticalPlacement,wt)}}}d.get("symbol-placement")==="line"&&(this.features=function(H){const $={},ne={},me=[];let de=0;function ue($e){me.push(H[$e]),de++}function Fe($e,Ze,Qe){const ht=ne[$e];return delete ne[$e],ne[Ze]=ht,me[ht].geometry[0].pop(),me[ht].geometry[0]=me[ht].geometry[0].concat(Qe[0]),ht}function ye($e,Ze,Qe){const ht=$[Ze];return delete $[Ze],$[$e]=ht,me[ht].geometry[0].shift(),me[ht].geometry[0]=Qe[0].concat(me[ht].geometry[0]),ht}function Ve($e,Ze,Qe){const ht=Qe?Ze[0][Ze[0].length-1]:Ze[0][0];return`${$e}:${ht.x}:${ht.y}`}for(let $e=0;$e<H.length;$e++){const Ze=H[$e],Qe=Ze.geometry,ht=Ze.text?Ze.text.toString():null;if(!ht){ue($e);continue}const wt=Ve(ht,Qe),st=Ve(ht,Qe,!0);if(wt in ne&&st in $&&ne[wt]!==$[st]){const Jt=ye(wt,st,Qe),zi=Fe(wt,st,me[Jt].geometry);delete $[wt],delete ne[st],ne[Ve(ht,me[zi].geometry,!0)]=zi,me[Jt].geometry=null}else wt in ne?Fe(wt,st,Qe):st in $?ye(wt,st,Qe):(ue($e),$[wt]=de-1,ne[st]=de-1)}return me.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((H,$)=>H.sortKey-$.sortKey)}update(e,i,o,h,a,d,_){this.text.programConfigurations.updatePaintArrays(e,i,a,o,h,d,_),this.icon.programConfigurations.updatePaintArrays(e,i,a,o,h,d,_)}updateZOffset(){const e=(a,d,_)=>{o+=d,o>a.length&&a.resize(o);for(let w=-d;w<0;w++)a.emplace(w+o,_)},i=(a,d,_)=>{h+=d,h>a.length&&a.resize(h);for(let w=-d;w<0;w++)a.emplace(w+h,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,h=0;for(let a=0;a<this.symbolInstances.length;a++){const d=this.symbolInstances.get(a),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:w,numIconVertices:M}=d,m=d.zOffset,E=M>0;if((_>0||w>0)&&(e(this.text.zOffsetVertexArray,_,m),e(this.text.zOffsetVertexArray,w,m)),E){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:b}=d;I>=0&&i(this.icon.zOffsetVertexArray,M,m),b>=0&&i(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,m)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Yg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:a}of i)this.lineVertexArray.emplaceBack(h,a);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,h,a,d,_,w,M,m,E,I,b,T,A,k){const O=e.indexArray,U=e.layoutVertexArray,G=e.globeExtVertexArray,B=e.segments.prepareSegment(4*i.length,U,O,this.canOverlap?d.sortKey:void 0),H=this.glyphOffsetArray.length,$=B.vertexLength,ne=this.allowVerticalPlacement&&_===nl.vertical?Math.PI/2:0,me=d.text&&d.text.sections;for(let ue=0;ue<i.length;ue++){const{tl:Fe,tr:ye,bl:Ve,br:$e,texPrimary:Ze,texSecondary:Qe,pixelOffsetTL:ht,pixelOffsetBR:wt,minFontScaleX:st,minFontScaleY:Jt,glyphOffset:zi,isSDF:Kt,sectionIndex:wn}=i[ue],_n=B.vertexLength,Wi=zi[1];if(af(U,M.x,M.y,Fe.x,Wi+Fe.y,Ze.x,Ze.y,o,Kt,ht.x,ht.y,st,Jt),af(U,M.x,M.y,ye.x,Wi+ye.y,Ze.x+Ze.w,Ze.y,o,Kt,wt.x,ht.y,st,Jt),af(U,M.x,M.y,Ve.x,Wi+Ve.y,Ze.x,Ze.y+Ze.h,o,Kt,ht.x,wt.y,st,Jt),af(U,M.x,M.y,$e.x,Wi+$e.y,Ze.x+Ze.w,Ze.y+Ze.h,o,Kt,wt.x,wt.y,st,Jt),w){const{x:Fi,y:qn,z:En}=w.anchor,[kn,wr,zr]=w.up;uf(G,Fi,qn,En,kn,wr,zr),uf(G,Fi,qn,En,kn,wr,zr),uf(G,Fi,qn,En,kn,wr,zr),uf(G,Fi,qn,En,kn,wr,zr),cf(e.dynamicLayoutVertexArray,Fi,qn,En,ne)}else cf(e.dynamicLayoutVertexArray,M.x,M.y,M.z,ne);if(k){const Fi=Qe||Ze;lf(e.iconTransitioningVertexArray,Fi.x,Fi.y),lf(e.iconTransitioningVertexArray,Fi.x+Fi.w,Fi.y),lf(e.iconTransitioningVertexArray,Fi.x,Fi.y+Fi.h),lf(e.iconTransitioningVertexArray,Fi.x+Fi.w,Fi.y+Fi.h)}O.emplaceBack(_n,_n+1,_n+2),O.emplaceBack(_n+1,_n+2,_n+3),B.vertexLength+=4,B.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zi[0]),ue!==i.length-1&&wn===i[ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,d,d.index,{},b,T,A,me&&me[wn])}const de=w?w.anchor:M;e.placedSymbolArray.emplaceBack(de.x,de.y,de.z,M.x,M.y,H,this.glyphOffsetArray.length-H,$,m,E,M.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],_,0,!1,0,I,0)}_commitLayoutVertex(e,i,o,h,a,d,_){e.emplaceBack(i,o,h,a,d,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,i,o,h,a,d,_){const w=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),M=w.vertexLength,m=_.tileAnchorX,E=_.tileAnchorY;for(let b=0;b<4;b++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,_.zOffset),this._commitLayoutVertex(o.layoutVertexArray,h,a,d,m,E,new Xi(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,h,a,d,m,E,new Xi(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,h,a,d,m,E,new Xi(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,h,a,d,m,E,new Xi(e.x1,e.y2)),w.vertexLength+=4;const I=o.indexArray;I.emplaceBack(M,M+1),I.emplaceBack(M+1,M+2),I.emplaceBack(M+2,M+3),I.emplaceBack(M+3,M),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,h,a,d){for(let _=h;_<a;_++){const w=o.get(_),M=this.getSymbolInstanceTextSize(e,d,i,_);this._addCollisionDebugVertices(w,M,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,o,h,a,d){for(let _=h;_<a;_++){const w=o.get(_),M=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(w,M,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vp(zc,_g.members,Wl),this.iconCollisionBox=new vp(zc,_g.members,Wl);const h=$c(this.iconSizeData,e),a=$c(this.textSizeData,e,o);for(let d=0;d<this.symbolInstances.length;d++){const _=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(a,e,i,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(a,e,i,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(h,e,i,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(h,e,i,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,i,o,h){const a=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),d=Kd(this.textSizeData,e,a)/fa;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,o){const h=this.icon.placedSymbolArray.get(o),a=Kd(this.iconSizeData,e,h);return this.tilePixelRatio*a}_commitDebugCollisionVertexUpdate(e,i,o,h){e.emplaceBack(i,-o,-o,h),e.emplaceBack(i,o,-o,h),e.emplaceBack(i,o,o,h),e.emplaceBack(i,-o,o,h)}_updateTextDebugCollisionBoxes(e,i,o,h,a,d,_){for(let w=h;w<a;w++){const M=o.get(w),m=this.getSymbolInstanceTextSize(e,d,i,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,m,M.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,h,a,d,_){for(let w=h;w<a;w++){const M=o.get(w),m=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,m,M.padding,d.zOffset)}}updateCollisionDebugBuffers(e,i,o,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=$c(this.iconSizeData,e,h),d=$c(this.textSizeData,e,o);for(let _=0;_<this.symbolInstances.length;_++){const w=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(d,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w,o),this._updateTextDebugCollisionBoxes(d,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,o),this._updateIconDebugCollisionBoxes(a,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w,h),this._updateIconDebugCollisionBoxes(a,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,h,a,d,_,w,M){const m={};if(i<o){const{x1:E,y1:I,x2:b,y2:T,padding:A,projectedAnchorX:k,projectedAnchorY:O,projectedAnchorZ:U,tileAnchorX:G,tileAnchorY:B,featureIndex:H}=e.get(i);m.textBox={x1:E,y1:I,x2:b,y2:T,padding:A,projectedAnchorX:k,projectedAnchorY:O,projectedAnchorZ:U,tileAnchorX:G,tileAnchorY:B},m.textFeatureIndex=H}if(h<a){const{x1:E,y1:I,x2:b,y2:T,padding:A,projectedAnchorX:k,projectedAnchorY:O,projectedAnchorZ:U,tileAnchorX:G,tileAnchorY:B,featureIndex:H}=e.get(h);m.verticalTextBox={x1:E,y1:I,x2:b,y2:T,padding:A,projectedAnchorX:k,projectedAnchorY:O,projectedAnchorZ:U,tileAnchorX:G,tileAnchorY:B},m.verticalTextFeatureIndex=H}if(d<_){const{x1:E,y1:I,x2:b,y2:T,padding:A,projectedAnchorX:k,projectedAnchorY:O,projectedAnchorZ:U,tileAnchorX:G,tileAnchorY:B,featureIndex:H}=e.get(d);m.iconBox={x1:E,y1:I,x2:b,y2:T,padding:A,projectedAnchorX:k,projectedAnchorY:O,projectedAnchorZ:U,tileAnchorX:G,tileAnchorY:B},m.iconFeatureIndex=H}if(w<M){const{x1:E,y1:I,x2:b,y2:T,padding:A,projectedAnchorX:k,projectedAnchorY:O,projectedAnchorZ:U,tileAnchorX:G,tileAnchorY:B,featureIndex:H}=e.get(w);m.verticalIconBox={x1:E,y1:I,x2:b,y2:T,padding:A,projectedAnchorX:k,projectedAnchorY:O,projectedAnchorZ:U,tileAnchorX:G,tileAnchorY:B},m.verticalIconFeatureIndex=H}return m}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),h=o.vertexStartIndex+4*o.numGlyphs;for(let a=o.vertexStartIndex;a<h;a+=4)e.indexArray.emplaceBack(a,a+1,a+2),e.indexArray.emplaceBack(a+1,a+2,a+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),h=[],a=[],d=[];for(let _=0;_<this.symbolInstances.length;++_){d.push(_);const w=this.symbolInstances.get(_);h.push(0|Math.round(i*w.tileAnchorX+o*w.tileAnchorY)),a.push(w.featureIndex)}return d.sort((_,w)=>h[_]-h[w]||a[w]-a[_]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:a,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:M}=o;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),a>=0&&a!==h&&this.addIndicesForPlacedSymbol(this.text,a),d>=0&&d!==a&&d!==h&&this.addIndicesForPlacedSymbol(this.text,d),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Kg,Jg,xp;on(hf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),hf.addDynamicAttributes=cf;class Qg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Er,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}on(Qg,"FormatSectionOverride",{omit:["defaultValue"]});const bp=()=>xp||(xp={layout:Kg||(Kg=new ro({"symbol-placement":new an(Ct.layout_symbol["symbol-placement"]),"symbol-spacing":new an(Ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new an(Ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Rn(Ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new an(Ct.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new an(Ct.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new an(Ct.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new an(Ct.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new an(Ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new an(Ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new an(Ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new Rn(Ct.layout_symbol["icon-size"]),"icon-size-scale-range":new an(Ct.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Rn(Ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Rn(Ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new Rn(Ct.layout_symbol["icon-image"]),"icon-rotate":new Rn(Ct.layout_symbol["icon-rotate"]),"icon-padding":new an(Ct.layout_symbol["icon-padding"]),"icon-keep-upright":new an(Ct.layout_symbol["icon-keep-upright"]),"icon-offset":new Rn(Ct.layout_symbol["icon-offset"]),"icon-anchor":new Rn(Ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new an(Ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new an(Ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new an(Ct.layout_symbol["text-rotation-alignment"]),"text-field":new Rn(Ct.layout_symbol["text-field"]),"text-font":new Rn(Ct.layout_symbol["text-font"]),"text-size":new Rn(Ct.layout_symbol["text-size"]),"text-size-scale-range":new an(Ct.layout_symbol["text-size-scale-range"]),"text-max-width":new Rn(Ct.layout_symbol["text-max-width"]),"text-line-height":new Rn(Ct.layout_symbol["text-line-height"]),"text-letter-spacing":new Rn(Ct.layout_symbol["text-letter-spacing"]),"text-justify":new Rn(Ct.layout_symbol["text-justify"]),"text-radial-offset":new Rn(Ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new an(Ct.layout_symbol["text-variable-anchor"]),"text-anchor":new Rn(Ct.layout_symbol["text-anchor"]),"text-max-angle":new an(Ct.layout_symbol["text-max-angle"]),"text-writing-mode":new an(Ct.layout_symbol["text-writing-mode"]),"text-rotate":new Rn(Ct.layout_symbol["text-rotate"]),"text-padding":new an(Ct.layout_symbol["text-padding"]),"text-keep-upright":new an(Ct.layout_symbol["text-keep-upright"]),"text-transform":new Rn(Ct.layout_symbol["text-transform"]),"text-offset":new Rn(Ct.layout_symbol["text-offset"]),"text-allow-overlap":new an(Ct.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new an(Ct.layout_symbol["text-ignore-placement"]),"text-optional":new an(Ct.layout_symbol["text-optional"]),visibility:new an(Ct.layout_symbol.visibility)})),paint:Jg||(Jg=new ro({"icon-opacity":new Rn(Ct.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Rn(Ct.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Rn(Ct.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Rn(Ct.paint_symbol["text-emissive-strength"]),"icon-color":new Rn(Ct.paint_symbol["icon-color"]),"icon-halo-color":new Rn(Ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new Rn(Ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Rn(Ct.paint_symbol["icon-halo-blur"]),"icon-translate":new an(Ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new an(Ct.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Rn(Ct.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Rn(Ct.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Rn(Ct.paint_symbol["text-occlusion-opacity"]),"text-color":new Rn(Ct.paint_symbol["text-color"],{runtimeType:jt,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Rn(Ct.paint_symbol["text-halo-color"]),"text-halo-width":new Rn(Ct.paint_symbol["text-halo-width"]),"text-halo-blur":new Rn(Ct.paint_symbol["text-halo-blur"]),"text-translate":new an(Ct.paint_symbol["text-translate"]),"text-translate-anchor":new an(Ct.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new an(Ct.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new an(Ct.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new an(Ct.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new an(Ct.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Rn(Ct.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},xp);class df extends Jo{constructor(e,i,o,h){super(e,bp(),i,o,h),this._colorAdjustmentMatrix=Pe.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const a of o)h.indexOf(a)<0&&h.push(a);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(a,d,_,w){a=Un(a),d=en(d);const M=Pe.mat4.create(),m=a/3,E=1-2*m,I=[E,m,m,0,m,E,m,0,m,m,E,0,0,0,0,1],b=.5-.5*d,T=w-_;return Pe.mat4.multiply(M,[T,0,0,0,0,T,0,0,0,0,T,0,_,_,_,1],[d,0,0,0,0,d,0,0,0,0,d,0,b,b,b,1]),Pe.mat4.multiply(M,M,I),M}(e,i,o,h),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,h){const a=this.layout.get(e).evaluate(i,{},o,h),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||er(d.value)||!a?a:function(_,w){return w.replace(/{([^{}]+)}/g,(M,m)=>m in _?String(_[m]):"")}(i.properties,a)}createBucket(e){return new hf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of bp().paint.overridableProperties){if(!df.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Qg(i),h=new Ar(o,i.property.specification,this.scope,this.options);let a=null;a=i.value.kind==="constant"||i.value.kind==="source"?new Zs("source",h):new Vr("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Cu(i.property,a,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&df.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),h=bp().paint.properties[i];let a=!1;const d=_=>{for(const w of _)if(h.overrides&&h.overrides.hasOverride(w))return void(a=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Nt)d(o.value.value.sections);else if(o.value.kind==="source"){const _=M=>{a||(M instanceof Oi&&Di(M.value)===Mi?d(M.value.sections):M instanceof An?d(M.sections):M.eachChild(_))},w=o.value;w._styleExpression&&_(w._styleExpression.expression)}return a}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new fu(this,{zoom:i,lut:o}),overrideFog:!1}}}let e_,t_,i_,n_;var wp=gs([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Ep(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Tp(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Sp{constructor(e,i,o,h){this.context=e,this.format=o,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:a}=this,{gl:d}=a,{x:_,y:w}=i&&i.position?i.position:{x:0,y:0},M=_+o,m=w+h;!this.size||this.size[0]===M&&this.size[1]===m||(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(this.texture),this.texture=d.createTexture(),this.size=null),d.bindTexture(d.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA8&&(!i||i.premultiply!==!1));const E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&M>0&&m>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(M,m)))+1:1;d.texStorage2D(d.TEXTURE_2D,I,this.format,M,m),this.size=[M,m]}if(this.size)if(E)d.texSubImage2D(d.TEXTURE_2D,0,_,w,Ep(this.format),Tp(this.format),e);else{const I=e.data;I&&d.texSubImage2D(d.TEXTURE_2D,0,_,w,o,h,Ep(this.format),Tp(this.format),I)}this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,i,o=!1){const{context:h}=this,{gl:a}=h;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,h){const{context:a}=this,{gl:d}=a;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,o),this.wrapS=o),h!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ff{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:h}=o;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}function pf(r,e,i,o,h,a,d,_){const w=[r,e,1,i,o,1,h,a,1],M=[d,_,1],m=Pe.mat3.adjoint([],w),[E,I,b]=Pe.vec3.transformMat3(M,M,m);return Pe.mat3.multiply(w,w,[E,0,0,0,I,0,0,0,b])}function r_(r,e,i,o,h,a,d,_){const w=function(M,m,E,I,b,T,A,k){const O=pf(0,0,1,0,1,1,0,1),U=pf(M,m,E,I,b,T,A,k),G=Pe.mat3.adjoint([],O);return Pe.mat3.multiply(U,U,G)}(r,e,i,o,h,a,d,_);return[w[2]/w[8]/mn,w[5]/w[8]/mn]}function mf(r){return[r[0],Math.min(Math.max(r[1],-vo),vo)]}class s_ extends sa{constructor(e,i,o,h){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Oo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=rs(this.map._requestManager.transformRequest(this.url,dr.Image),(o,h)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new wo(o)):h&&(this.image=h instanceof HTMLImageElement?Ee.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ff(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Oo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ff||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const a of e)a[1]>o&&(o=a[1]),a[1]<i&&(i=a[1]);const h=(o+i)/2;if(h>vo?this.onNorthPole=!0:h<-vo&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const a=e.map(n.fromLngLat);this.tileID=function(d){let _=1/0,w=1/0,M=-1/0,m=-1/0;for(const A of d)_=Math.min(_,A.x),w=Math.min(w,A.y),M=Math.max(M,A.x),m=Math.max(m,A.y);const E=Math.max(M-_,m-w),I=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),b=Math.pow(2,I);let T=Math.floor((_+M)/2*b);return T>1&&(T-=1),new Ri(I,T,Math.floor((w+m)/2*b))}(a),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Oo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const O in this.tiles){const U=this.tiles[O];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Qh(new Ri(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(O){const U=O[1].x-O[0].x,G=O[1].y-O[0].y,B=O[2].x-O[1].x,H=O[2].y-O[1].y,$=O[3].x-O[2].x,ne=O[3].y-O[2].y,me=O[0].x-O[3].x,de=O[0].y-O[3].y,ue=U*H-B*G,Fe=B*ne-$*H,ye=$*de-me*ne,Ve=me*G-U*de;return ue>0&&Fe>0&&ye>0&&Ve>0||ue<0&&Fe<0&&ye<0&&Ve<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Qh(this.tileID,this.map.transform.projection),[a,d,_,w]=this.coordinates.map(O=>{const U=h.projection.project(O[0],O[1]);return Hg(h,U)._round()});this.perspectiveTransform=r_(a.x,a.y,d.x,d.y,_.x,_.y,w.x,w.y);const M=this._boundsArray=new zl;M.emplaceBack(a.x,a.y,0,0),M.emplaceBack(d.x,d.y,mn,0),M.emplaceBack(w.x,w.y,0,mn),M.emplaceBack(_.x,_.y,mn,mn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(M,wp.members),this.boundsSegments=yo.simpleSegment(0,0,4,2);const m=[],E=[mf((I=this.coordinates)[0]),mf(I[1]),mf(I[2]),mf(I[3])];var I;const[b,T,A,k]=function(O){let U=O[0][0],G=U,B=O[0][1],H=B;for(let $=1;$<O.length;$++)O[$][0]<U?U=O[$][0]:O[$][0]>G&&(G=O[$][0]),O[$][1]<B?B=O[$][1]:O[$][1]>H&&(H=O[$][1]);return[U,B,G-U,H-B]}(E);{const O=new zl,[U,G,B,H]=function(ht){let wt=ht[0].x,st=wt,Jt=ht[0].y,zi=Jt;for(let Kt=1;Kt<ht.length;Kt++)ht[Kt].x<wt?wt=ht[Kt].x:ht[Kt].x>st&&(st=ht[Kt].x),ht[Kt].y<Jt?Jt=ht[Kt].y:ht[Kt].y>zi&&(zi=ht[Kt].y);return[wt,Jt,st-wt,zi-Jt]}(o),$=ht=>[(ht.x-U)/B,(ht.y-G)/H],[ne,me,de,ue]=o.map($),Fe=function(ht,wt,st,Jt,zi,Kt,wn,_n){const Wi=pf(0,0,1,0,1,1,0,1),Fi=pf(ht,wt,st,Jt,zi,Kt,wn,_n),qn=Pe.mat3.adjoint([],Fi);return Pe.mat3.multiply(Wi,Wi,qn)}(ne[0],ne[1],me[0],me[1],de[0],de[1],ue[0],ue[1]);this.elevatedGlobePerspectiveTransform=r_(ne[0],ne[1],me[0],me[1],de[0],de[1],ue[0],ue[1]);const ye=(ht,wt)=>{m.push(ht.lng);const st=Math.round((ht.lng-b)/A*mn),Jt=Math.round((ht.lat-T)/k*mn),zi=$(wt),Kt=Pe.vec3.transformMat3([],[zi[0],zi[1],1],Fe),wn=Math.round(Kt[0]/Kt[2]*mn),_n=Math.round(Kt[1]/Kt[2]*mn);O.emplaceBack(st,Jt,wn,_n)},Ve=o[3].x-o[0].x,$e=o[3].y-o[0].y,Ze=o[2].x-o[1].x,Qe=o[2].y-o[1].y;for(let ht=0;ht<65;ht++){const wt=ht/64,st=[o[0].x+wt*Ve,o[0].y+wt*$e],Jt=[o[1].x+wt*Ze,o[1].y+wt*Qe],zi=Jt[0]-st[0],Kt=Jt[1]-st[1];for(let wn=0;wn<65;wn++){const _n=wn/64,Wi={x:st[0]+zi*_n,y:st[1]+Kt*_n,z:0};ye(i.projection.unproject(Wi.x,Wi.y),Wi)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(O,wp.members)}{this.maxLongitudeTriangleSize=0;let O=[],U=new na;const G=(B,H,$)=>{U.emplaceBack(B,H,$);const ne=m[B],me=m[H],de=m[$],ue=Math.min(Math.min(ne,me),de),Fe=Math.max(Math.max(ne,me),de)-ue;Fe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Fe),O.push(ue+Fe/2)};for(let B=0;B<64;B++)for(let H=0;H<64;H++){const $=65*B+H,ne=$+1,me=$+65,de=me+1;G($,me,ne),G(ne,me,de)}[O,U]=function(B,H){const $=Array.from({length:B.length},(de,ue)=>ue);$.sort((de,ue)=>B[de]-B[ue]);const ne=[],me=new na;for(let de=0;de<$.length;de++){const ue=$[de];ne.push(B[ue]);const Fe=3*ue,ye=Fe+1;me.emplaceBack(H.uint16[Fe],H.uint16[ye],H.uint16[ye+1])}return[ne,me]}(O,U),this.elevatedGlobeTrianglesCenterLongitudes=O,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(U)}this.elevatedGlobeSegments=yo.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,A/mn,0,k/mn,0,0,T,b,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof ff||(this.texture?this.texture.update(this.image):(this.texture=new Sp(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let h=(a=e+180)+360*Math.round((o[0]-a)/360);var a;const d=new yo,_=(E,I)=>{d.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:i.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-h)<=w){const E=Zt(o,0,o.length,h+w);return E===o.length||_(E,fi(o,E+1,o.length,h+360-w)-E),d}h<o[0]&&(h+=360);const M=fi(o,0,o.length,h-w);if(M===o.length)return _(0,o.length),d;_(0,M-0);const m=Zt(o,M+1,o.length,h+w);return m!==o.length&&_(m,o.length-m),d}}const sv=(Math.pow(256,2)-1)/16907520;class o_ extends Jo{constructor(e,i,o,h){super(e,{layout:i_||(i_=new ro({visibility:new an(Ct.layout_raster.visibility)})),paint:n_||(n_=new ro({"raster-opacity":new an(Ct.paint_raster["raster-opacity"]),"raster-color":new Lu(Ct.paint_raster["raster-color"]),"raster-color-mix":new an(Ct.paint_raster["raster-color-mix"]),"raster-color-range":new an(Ct.paint_raster["raster-color-range"]),"raster-hue-rotate":new an(Ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new an(Ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new an(Ct.paint_raster["raster-brightness-max"]),"raster-saturation":new an(Ct.paint_raster["raster-saturation"]),"raster-contrast":new an(Ct.paint_raster["raster-contrast"]),"raster-resampling":new an(Ct.paint_raster["raster-resampling"]),"raster-fade-duration":new an(Ct.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new an(Ct.paint_raster["raster-emissive-strength"]),"raster-array-band":new an(Ct.paint_raster["raster-array-band"]),"raster-elevation":new an(Ct.paint_raster["raster-elevation"]),"raster-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},i,o,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof s_&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(h)||o===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Nh({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,h])}}let a_,l_,u_,c_,h_;class d_ extends Jo{constructor(e,i,o,h){super(e,{layout:a_||(a_=new ro({visibility:new an(Ct["layout_raster-particle"].visibility)})),paint:l_||(l_=new ro({"raster-particle-array-band":new an(Ct["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new an(Ct["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Lu(Ct["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new an(Ct["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new an(Ct["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new an(Ct["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new an(Ct["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new an(Ct["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},i,o,h),this._updateColorRamp(),this.lastInvalidatedAt=Ee.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Nh({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ee.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class ov extends Jo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Ip(r,e,i){const o=[0,0,1],h=Pe.quat.identity([]);return Pe.quat.rotateY(h,h,i?-Sr(r)+Math.PI:Sr(r)),Pe.quat.rotateX(h,h,-Sr(e)),Pe.vec3.transformQuat(o,o,h),Pe.vec3.normalize(o,o)}function f_(r,e){const i=gf(r.projection,r.zoom,r.width,r.height),o=function(a,d,_,w,M){const m=new as(_.lng-180*Zu,_.lat),E=new as(_.lng+180*Zu,_.lat),I=a.project(m.lng,m.lat),b=a.project(E.lng,E.lat),T=-Math.atan2(b.y-I.y,b.x-I.x),A=n.fromLngLat(_);A.y=cn(A.y,-1+Zu,1-Zu);const k=A.toLngLat(),O=a.project(k.lng,k.lat),U=n.fromLngLat(k);U.x+=Zu;const G=U.toLngLat(),B=a.project(G.lng,G.lat),H=m_(B.x-O.x,B.y-O.y,T),$=n.fromLngLat(k);$.y+=Zu;const ne=$.toLngLat(),me=a.project(ne.lng,ne.lat),de=m_(me.x-O.x,me.y-O.y,T),ue=Math.abs(H.x)/Math.abs(de.y),Fe=Pe.mat4.identity([]);Pe.mat4.rotateZ(Fe,Fe,-T*(1-(M?0:w)));const ye=Pe.mat4.identity([]);return Pe.mat4.scale(ye,ye,[1,1-(1-ue)*w,1]),ye[4]=-de.x/de.y*w,Pe.mat4.rotateZ(ye,ye,T),Pe.mat4.multiply(ye,Fe,ye),ye}(r.projection,0,r.center,i,e),h=p_(r);return Pe.mat4.scale(o,o,[h,h,1]),o}function p_(r){const e=r.projection,i=gf(r.projection,r.zoom,r.width,r.height),o=Mp(e,r.center),h=Mp(e,as.convert(e.center));return Math.pow(2,o*i+(1-i)*h)}function gf(r,e,i,o,h=1/0){const a=r.range;if(!a)return 0;const d=Math.min(h,Math.max(i,o)),_=Math.log(d/1024)/Math.LN2;return Jr(a[0]+_,a[1]+_,e)}const Zu=1/4e4;function Mp(r,e){const i=cn(e.lat,-vo,vo),o=new as(e.lng-180*Zu,i),h=new as(e.lng+180*Zu,i),a=r.project(o.lng,i),d=r.project(h.lng,i),_=n.fromLngLat(o),w=n.fromLngLat(h),M=d.x-a.x,m=d.y-a.y,E=w.x-_.x,I=w.y-_.y,b=Math.sqrt((E*E+I*I)/(M*M+m*m));return Math.log(b)/Math.LN2}function m_(r,e,i){const o=Math.cos(i),h=Math.sin(i);return{x:r*o-e*h,y:r*h+e*o}}function g_(r,e,i){Pe.mat4.identity(r),Pe.mat4.rotateZ(r,r,Sr(e[2])),Pe.mat4.rotateX(r,r,Sr(e[0])),Pe.mat4.rotateY(r,r,Sr(e[1])),Pe.mat4.scale(r,r,i),Pe.mat4.multiply(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function _f(r,e,i,o,h,a,d,_){const w=[i[0]-e[0],i[1]-e[1],0],M=[o[0]-e[0],o[1]-e[1],0];if(Pe.vec3.length(w)<1e-12||Pe.vec3.length(M)<1e-12)return Pe.quat.identity(r);const m=Pe.vec3.cross([],w,M);Pe.vec3.normalize(m,m),Pe.vec3.subtract(M,o,e),w[2]=(a-h)*_,M[2]=(d-h)*_;const E=w;return Pe.vec3.cross(E,w,M),Pe.vec3.normalize(E,E),Pe.quat.rotationTo(r,m,E)}function Ap(r,e,i=!1){const o=ba(e.zoom),h=function(a,d,_){const w=d.worldSize,M=[a[12],a[13],a[14]],m=ra(M[1]/w),E=Ia(M[0]/w),I=Pe.mat4.identity([]),b=ya(1,m)*w,T=ya(1,0)*w*Bu(m,d.zoom),A=1/da(w);let k=T*A;if(_){const B=gf(d.projection,d.zoom,d.width,d.height,1024);k=A*d.projection.pixelSpaceConversion(d.center.lat,w,B)}const O=pu(m,E);Pe.vec3.add(O,O,Pe.vec3.scale([],Pe.vec3.normalize([],O),b*k*M[2]));const U=function(B){const H=[B[0],B[1],B[2]];let $=[0,1,0];const ne=Pe.vec3.cross([],$,H);return Pe.vec3.cross($,H,ne),Pe.vec3.squaredLength($)===0&&($=[0,1,0],Pe.vec3.cross(ne,H,$)),Pe.vec3.normalize(ne,ne),Pe.vec3.normalize($,$),Pe.vec3.normalize(H,H),[ne[0],ne[1],ne[2],0,$[0],$[1],$[2],0,H[0],H[1],H[2],0,B[0],B[1],B[2],1]}(O);Pe.mat4.scale(I,I,[k,k,k*b]),Pe.mat4.translate(I,I,[-M[0],-M[1],-M[2]]);const G=Pe.mat4.multiply([],d.globeMatrix,U);return Pe.mat4.multiply(G,G,I),Pe.mat4.multiply(G,G,a),G}(r,e,i);if(o>0){const a=function(d,_){const w=_.worldSize,M=ya(1,0)*w*Bu(_.center.lat,_.zoom)/da(w),m=ya(1,_.center.lat)*w,E=Pe.mat4.identity([]);return Pe.mat4.rotateY(E,E,Sr(_.center.lng)),Pe.mat4.rotateX(E,E,Sr(_.center.lat)),Pe.mat4.translate(E,E,[0,0,_a]),Pe.mat4.scale(E,E,[M,M,M*m]),Pe.mat4.translate(E,E,[_.point.x-.5*w,_.point.y-.5*w,0]),Pe.mat4.multiply(E,E,d),Pe.mat4.multiply(E,_.globeMatrix,E)}(r,e);return function(d,_,w){const M=(T,A,k)=>{const O=Pe.vec3.length(T),U=Pe.vec3.length(A),G=Bo(T,A,k);return Pe.vec3.scale(G,G,1/Pe.vec3.length(G)*Ye(O,U,k))},m=M([d[0],d[1],d[2]],[_[0],_[1],_[2]],w),E=M([d[4],d[5],d[6]],[_[4],_[5],_[6]],w),I=M([d[8],d[9],d[10]],[_[8],_[9],_[10]],w),b=Bo([d[12],d[13],d[14]],[_[12],_[13],_[14]],w);return[m[0],m[1],m[2],0,E[0],E[1],E[2],0,I[0],I[1],I[2],0,b[0],b[1],b[2],1]}(h,a,o)}return h}function __(r,e,i,o){const h=Wn.projectAabbCorners(o,i);let a=Number.MAX_VALUE,d=-1;for(let M=0;M<h.length;++M){const m=h[M];m[0]=(.5*m[0]+.5)*e.width,m[1]=(.5-.5*m[1])*e.height,m[2]<a&&(d=M,a=m[2])}const _=M=>new Xi(h[M][0],h[M][1]);let w;switch(d){case 0:case 6:w=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:w=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:w=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:w=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(X(r,w))return a}const av=gs([{name:"a_pos_3f",components:3,type:"Float32"}]),lv=gs([{name:"a_color_3f",components:3,type:"Float32"}]),uv=gs([{name:"a_color_4f",components:4,type:"Float32"}]),cv=gs([{name:"a_uv_2f",components:2,type:"Float32"}]),hv=gs([{name:"a_normal_3f",components:3,type:"Float32"}]),dv=gs([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),fv=gs([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),y_={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class yf{constructor(e,i,o,h){this.message=(e?`${e}: `:"")+o,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function v_(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch(o){return!1}}class x_{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class b_{constructor(){this.instancedDataArray=new oc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Cp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,o,h){this.tileToMeter=t(o);const a=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:_,index:w,sourceLayerIndex:M}of e){const m=_!=null?_:d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0,E=z(d,a);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),E,o))continue;const I={id:m,sourceLayerIndex:M,index:w,geometry:a?E.geometry:R(d,o,h),properties:d.properties,type:d.type,patterns:{}},b=this.addFeature(I,I.geometry,E);b&&i.featureIndex.insert(d,I.geometry,w,M,this.index,this.instancesPerModel[b].instancedDataArray.length,mn/32)}this.lookup=null}update(e,i,o,h){for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];for(const _ in e)d.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(d.features[d.idToFeaturesIndex[_]],e[_],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const h of o.features){const a=this.layers[0],d=h.feature,_=this.canonical,w=a.paint.get("model-rotation").evaluate(d,{},_),M=a.paint.get("model-scale").evaluate(d,{},_),m=a.paint.get("model-translation").evaluate(d,{},_);Pe.vec3.exactEquals(h.rotation,w)&&Pe.vec3.exactEquals(h.scale,M)&&Pe.vec3.exactEquals(h.translation,m)||(this.evaluate(h,h.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(ep(this.activeReplacements,a))return!1;this.activeReplacements=a;let d=!1;for(const _ in this.instancesPerModel){const w=this.instancesPerModel[_],M=w.instancedDataArray;for(const m of w.features){const E=m.instancedDataOffset,I=m.instancedDataCount;for(let b=0;b<I;b++){const T=16*(b+E);let A=M.float32[T+0];const k=A>mn;A=k?A-mn:A;const O=Math.floor(A),U=M.float32[T+1];let G=!1;for(const B of this.activeReplacements)if(!Dm(B,o,y_.Model,h)&&!(B.min.x>O||O>B.max.x||B.min.y>U||U>B.max.y)&&(G=Vm(Um(O,U,e.canonical,B.footprintTileId.canonical),B.footprint),G))break;M.float32[T]=G?A+mn:A,d=d||G!==k}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,dv.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,o){const h=this.layers[0],a=h.layout.get("model-id").evaluate(o,{},this.canonical);if(!a)return ur(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),a;v_(a,!1)&&(this.modelUris.includes(a)||this.modelUris.push(a)),this.instancesPerModel[a]||(this.instancesPerModel[a]=new b_);const d=this.instancesPerModel[a],_=d.instancedDataArray,w=new x_(o,_.length);for(const M of i)for(const m of M){if(m.x<0||m.x>=mn||m.y<0||m.y>=mn)continue;const E=(this.lookupDim-1)/mn,I=this.lookupDim*(m.y*E|0)+m.x*E|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const b=_.length;_.resize(b+1),d.instancesEvaluatedElevation.push(0),_.float32[16*b]=m.x,_.float32[16*b+1]=m.y}return w.instancedDataCount=d.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(w),this.evaluate(w,{},d,!1)),a}getModelUris(){return this.modelUris}evaluate(e,i,o,h){const a=this.layers[0],d=e.feature,_=this.canonical,w=e.rotation=a.paint.get("model-rotation").evaluate(d,i,_),M=e.scale=a.paint.get("model-scale").evaluate(d,i,_),m=e.translation=a.paint.get("model-translation").evaluate(d,i,_),E=a.paint.get("model-color").evaluate(d,i,_);E.a=a.paint.get("model-color-mix-intensity").evaluate(d,i,_);const I=[];this.maxVerticalOffset<m[2]&&(this.maxVerticalOffset=m[2]),this.maxScale=Math.max(Math.max(this.maxScale,M[0]),Math.max(M[1],M[2])),g_(I,w,M);const b=Math.round(100*E.a)+E.b/1.05;for(let T=0;T<e.instancedDataCount;++T){const A=e.instancedDataOffset+T,k=16*A,O=o.instancedDataArray.float32;let U=0;h&&(U=O[k+6]-o.instancesEvaluatedElevation[A]);const G=0|O[k+1];O[k]=(0|O[k])+E.r/1.05,O[k+1]=G+E.g/1.05,O[k+2]=b,O[k+3]=1/(_.z>10?this.tileToMeter:t(_,G)),O[k+4]=m[0],O[k+5]=m[1],O[k+6]=m[2]+U,O[k+7]=I[0],O[k+8]=I[1],O[k+9]=I[2],O[k+10]=I[4],O[k+11]=I[5],O[k+12]=I[6],O[k+13]=I[8],O[k+14]=I[9],O[k+15]=I[10],o.instancesEvaluatedElevation[A]=m[2]}}}let w_,E_;on(Cp,"ModelBucket",{omit:["layers"]}),on(b_,"PerModelAttributes"),on(x_,"ModelFeature");const vc=64,Qc={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function T_(r,e,i,o,h,a,d,_,w,M=!1){const m=i.zoom,E=i.project(o),I=Bu(o.lat,m),b=1/I;Pe.mat4.identity(r),Pe.mat4.translate(r,r,[E.x+d[0]*b,E.y+d[1]*b,d[2]]);let T=1,A=1;const k=i.worldSize;if(M){if(i.projection.name==="mercator"){let B=0;i.elevation&&(B=i.elevation.getAtPointOrZero(new n(E.x/k,E.y/k),0));const H=Pe.vec4.transformMat4([],[E.x,E.y,B,1],i.projMatrix)[3]/i.cameraToCenterDistance;T=H,A=H*Bu(i.center.lat,m)}else if(i.projection.name==="globe"){const B=Ap(r,i),H=Pe.mat4.multiply([],i.projMatrix,B),$=[0,0,0,1];Pe.vec4.transformMat4($,$,H);const ne=$[3]/i.cameraToCenterDistance,me=ba(m),de=i.projection.pixelsPerMeter(o.lat,k)*Bu(o.lat,m),ue=i.projection.pixelsPerMeter(i.center.lat,k)*Bu(i.center.lat,m);T=ne/Ye(de,Dh(i.center.lat),me),A=ne*I/de,T*=ue,A*=ue}}else T=b;Pe.mat4.scale(r,r,[T,T,A]);const O=[...r],U=e.orientation,G=[];if(g_(G,[U[0]+h[0],U[1]+h[1],U[2]+h[2]],a),Pe.mat4.multiply(r,O,G),_&&i.elevation){let B=0;const H=[];if(w&&i.elevation){B=function(me,de,ue,Fe,ye){const Ve=de.elevation;if(!Ve)return 0;const $e=Wn.projectAabbCorners(ue,Fe),Ze=ya(1,ye.lat)*de.worldSize,Qe=function(qn,En){const kn=[0,0,1],wr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const zr of wr){const Nr=qn[zr.corners[0]],Fr=qn[zr.corners[1]],Zr=qn[zr.corners[2]],Xr=[Fr[0]-Nr[0],Fr[1]-Nr[1],En*(Fr[2]-Nr[2])],qs=Pe.vec3.cross(Xr,Xr,[Zr[0]-Nr[0],Zr[1]-Nr[1],En*(Zr[2]-Nr[2])]);Pe.vec3.normalize(qs,qs),zr.dotProductWithUp=Pe.vec3.dot(qs,kn)}return wr.sort((zr,Nr)=>zr.dotProductWithUp-Nr.dotProductWithUp),wr[0].corners}($e,Ze),ht=$e[Qe[0]],wt=$e[Qe[1]],st=$e[Qe[2]],Jt=$e[Qe[3]],zi=Ve.getAtPointOrZero(new n(ht[0]/de.worldSize,ht[1]/de.worldSize),0),Kt=Ve.getAtPointOrZero(new n(wt[0]/de.worldSize,wt[1]/de.worldSize),0),wn=Ve.getAtPointOrZero(new n(st[0]/de.worldSize,st[1]/de.worldSize),0),_n=Ve.getAtPointOrZero(new n(Jt[0]/de.worldSize,Jt[1]/de.worldSize),0),Wi=(zi+_n)/2,Fi=(Kt+wn)/2;return Wi>Fi?Kt<wn?_f(me,wt,Jt,ht,Kt,_n,zi,Ze):_f(me,st,ht,Jt,wn,zi,_n,Ze):zi<_n?_f(me,ht,wt,st,zi,Kt,wn,Ze):_f(me,Jt,st,wt,_n,wn,Kt,Ze),Math.max(Wi,Fi)}(H,i,e.aabb,r,o);const $=Pe.mat4.fromQuat([],H),ne=Pe.mat4.multiply([],$,G);Pe.mat4.multiply(r,O,ne)}else B=i.elevation.getAtPointOrZero(new n(E.x/k,E.y/k),0);B!==0&&(r[14]+=B)}}function rd(r,e,i=!1){r.uploaded||(r.gfxTexture=new Sp(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function pv(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,av.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,hv.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,cv.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?lv:uv).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,fv.members,!0)),r.segments=yo.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const o=r.material;o.pbrMetallicRoughness.baseColorTexture&&rd(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&rd(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&rd(o.normalTexture,e),o.occlusionTexture&&rd(o.occlusionTexture,e,i),o.emissionTexture&&rd(o.emissionTexture,e)}function Pp(r,e,i){if(r.meshes)for(const o of r.meshes)pv(o,e,i);if(r.children)for(const o of r.children)Pp(o,e,i)}function vf(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)vf(e)}function Lp(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)Lp(i)}class eh{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const h=o||e.findDEMTileFor(i);if(!h||!h.dem)return;const a=h.dem,d=h.tileID,_=1<<i.canonical.z-d.canonical.z;return new eh(h,a.dim/mn/_,[(i.canonical.x/_-d.canonical.x)*a.dim,(i.canonical.y/_-d.canonical.y)*a.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),a=Math.floor(o);return new Xi(h,a)}getElevationAt(e,i,o,h){const a=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],_=Math.floor(a),w=Math.floor(d),M=this._dem;return h=!!h,o?Ye(Ye(M.get(_,w,h),M.get(_,w+1,h),d-w),Ye(M.get(_+1,w,h),M.get(_+1,w+1,h),d-w),a-_):M.get(_,w,h)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ya(1,e)*this._dem.stride}}const Rp=new Float32Array(262144),xc=new Uint8Array(262144);function S_(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,S_(i));return e}function I_(r,e,i){if(r.meshes)for(const o of r.meshes){if(o.aabb.min[0]===1/0)continue;const h=Wn.applyTransform(o.aabb,r.matrix);i.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(r.children)for(const o of r.children)I_(o,e,i)}const M_=["","wall","door","roof","window","lamp","logo"];class A_{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:S_(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=Wn.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class xf{constructor(e,i,o,h,a,d,_){this.id=o,this.layers=e,this.layerIds=this.layers.map(w=>w.fqid),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.modelTraits|=Qc.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Qc.HasMapboxMeshFeatures),a&&(this.modelTraits|=Qc.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const w of i)this.nodesInfo.push(new A_(w)),I_(w,_.featureIndexArray.length,_.grid),_.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,_.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const h=o.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!vs(e,this.states))for(const h of o)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const h=o.node;this.uploaded?this.updatePbrBuffer(h):Pp(h,e,!0)}for(const o of i)vf(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const h=e.transform.projectionOptions,a=e.style.getBrightness(),d=this.brightness!==a;if(!this.uploaded||this.dirty||h.name!==this.projection.name||sd(o.paint.get("model-color").value,d)||sd(o.paint.get("model-color-mix-intensity").value,d)||sd(o.paint.get("model-roughness").value,d)||sd(o.paint.get("model-emissive-strength").value,d)||sd(o.paint.get("model-height-based-emissive-strength-multiplier").value,d)){this.projection=h,this.brightness=a;const _=this.getNodesInfo();for(const w of _)w.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),h=this.id.canonical;for(const a of o){const d=a.feature;a.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},h)}}evaluate(e,i){const o=this.getNodesInfo();for(const h of o){if(!h.node.meshes)continue;const a=h.feature,d=i&&i[a.id];if(vs(d,h.state))continue;h.state=structuredClone(d);const _=h.node.meshes&&h.node.meshes[0].featureData,w=h.evaluatedColor[2],M=h.evaluatedRMEA[2],m=this.id.canonical;if(h.hasTranslucentParts=!1,_){for(let E=0;E<M_.length;E++){const I=M_[E];I.length&&(a.properties.part=I);const b=e.paint.get("model-color").evaluate(a,d,m).toRenderColor(null),T=e.paint.get("model-color-mix-intensity").evaluate(a,d,m);h.evaluatedColor[E]=[b.r,b.g,b.b,T],h.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(a,d,m),h.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(a,d,m),h.evaluatedRMEA[E][3]=b.a,h.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,d,m),!h.hasTranslucentParts&&b.a<1&&(h.hasTranslucentParts=!0)}delete a.properties.part,gv(h,w!==h.evaluatedColor[2]||M!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(a,d,m);h.evaluatedScale=e.paint.get("model-scale").evaluate(a,d,m),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,h){const a=e.findDEMTileFor(o);if(a&&(a.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(a.dem&&a.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=a.tileID.overscaledZ;const d=eh.create(e,o,a);if(!d)return;this.modelTraits&Qc.HasMapboxMeshFeatures&&this.updateDEM(e,d,o,h);for(const _ of this.getNodesInfo()){const w=_.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const M=w.footprint.vertices;let m=d.getElevationAt(M[0].x,M[0].y,!0,!0);for(let E=1;E<M.length;E++)m=Math.min(m,d.getElevationAt(M[E].x,M[E].y,!0,!0));w.elevation=m}}this.terrainTile=a.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,h){let a=i._dem._modifiedForSources[h];if(a===void 0&&(i._dem._modifiedForSources[h]=[],a=i._dem._modifiedForSources[h]),a.includes(o.canonical))return;const d=i._dem.dim;a.push(o.canonical);let _=!1;for(const w of this.getNodesInfo()){const M=w.node;if(!M.footprint||!M.footprint.grid)continue;const m=M.footprint.grid,E=i.tileCoordToPixel(m.min.x,m.min.y),I=i.tileCoordToPixel(m.max.x,m.max.y),b=Math.min(Math.min(d-I.y,E.x),Math.min(E.y,d-I.x));if(b<0)continue;const T=cn(b,2,5);let A=Math.max(0,E.x-T),k=Math.max(0,E.y-T),O=Math.min(I.x+T,d-1),U=Math.min(I.y+T,d-1);for(let $=k;$<=U;++$)for(let ne=A;ne<=O;++ne)xc[$*d+ne]=255;let G=0,B=0;for(let $=0;$<m.cellsY;++$)for(let ne=0;ne<m.cellsX;++ne){if(!m.cells[$*m.cellsX+ne])continue;const me=i.tileCoordToPixel(m.min.x+ne/m.xScale,m.min.y+$/m.yScale),de=i.tileCoordToPixel(m.min.x+(ne+1)/m.xScale,m.min.y+($+1)/m.yScale);for(let ue=me.y;ue<=Math.min(de.y+1,d-1);++ue)for(let Fe=me.x;Fe<=Math.min(de.x+1,d-1);++Fe)xc[ue*d+Fe]===255&&(xc[ue*d+Fe]=0,G+=i.getElevationAtPixel(Fe,ue),B++)}const H=G/B;A=Math.max(1,E.x-T),k=Math.max(1,E.y-T),O=Math.min(I.x+T,d-2),U=Math.min(I.y+T,d-2),_=!0;for(let $=k;$<=U;++$)for(let ne=A;ne<=O;++ne)xc[$*d+ne]===0&&(Rp[$*d+ne]=i._dem.set(ne,$,H));for(let $=1;$<T;++$){A=Math.max(1,E.x-$),k=Math.max(1,E.y-$),O=Math.min(I.x+$,d-2),U=Math.min(I.y+$,d-2);for(let ne=k;ne<=U;++ne)for(let me=A;me<=O;++me){const de=ne*d+me;if(xc[de]===255){let ue=0,Fe=0,ye=-1,Ve=-1;for(let $e=-1;$e<=1;++$e)for(let Ze=-1;Ze<=1;++Ze){const Qe=(ne+$e)*d+me+Ze;if(xc[Qe]>=$)continue;const ht=Rp[Qe],wt=Math.abs(ht);wt>Fe&&(ue=ht,Fe=wt,ye=Ze,Ve=$e)}if(Fe>.1){const $e=1-($+.5*Math.abs(ye*Ve))/T;let Ze=i._dem.get(me,ne)+ue*$e;const Qe=i._dem.get(me+ye,ne+Ve),ht=i._dem.get(me-ye,ne-Ve,!0);(Ze-Qe)*(Ze-ht)>0&&(Ze=(Qe+ht)/2),Rp[de]=i._dem.set(me,ne,Ze),xc[de]=$}}}}}_&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ee.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)vf(i.node),Lp(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),h=this.getNodesInfo();for(let a=0;a<this.nodesInfo.length;a++){const d=h[a].node;h[a].hiddenByReplacement=!!d.footprint&&!o.find(_=>_.footprint===d.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),h=[],a=[0,0,0],d=Pe.mat4.identity([]);for(let _=0;_<this.nodesInfo.length;_++){const w=o[_],M=w.node.meshes[0],m=M.transformedAabb;if(e<m.min[0]||i<m.min[1]||e>m.max[0]||i>m.max[1])continue;if(w.node.hidden===!0)return{height:1/0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};Pe.mat4.invert(d,w.node.matrix),a[0]=e,a[1]=i,Pe.vec3.transformMat4(a,a,d);const E=(a[0]-M.aabb.min[0])/(M.aabb.max[0]-M.aabb.min[0])*vc|0,I=Math.min(63,(a[1]-M.aabb.min[1])/(M.aabb.max[1]-M.aabb.min[1])*vc|0)*vc+Math.min(63,E),b=M.heightmap[I];if(!(b<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:b,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new Xi(e,i),new Xi(e,i),h),h.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function sd(r,e){return!r.isLightConstant&&e}function mv(r,e,i,o,h,a,d,_){let w=(61440&e|(61440&e)>>4)>>8,M=(3840&e|(3840&e)>>4)>>4,m=240&e|(240&e)>>4;i[3]>0&&(w=Ye(w,255*i[0],i[3]),M=Ye(M,255*i[1],i[3]),m=Ye(m,255*i[2],i[3]));const E=w<<8|M,I=m<<8|Math.floor(255*o[3]),b=function($){const ne=cn($,0,2);return Math.min(Math.round(.5*ne*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],T=cn(h[0],0,1),A=cn(h[1],0,1),k=cn(h[2],0,1),O=cn(h[3],0,1);let U,G,B,H;if(T!==A&&d!==a&&A!==T){const $=d-a;G=1/($*(A-T)),B=-(a+$*T)/($*(A-T));const ne=cn(h[4],-1,1);H=Math.pow(10,ne),U=255*k<<8|255*O}else U=65535,G=0,B=1,H=1;if(r.emplaceBack(E,I,b,U,G,B,H),_){const $=_.length;_.clear();for(let ne=0;ne<$;ne++)_.emplaceBack(E,I,b,U,G,B,H)}}function gv(r,e,i){const o=r.node;let h=0;const a=i&Qc.HasMeshoptCompression;for(const d of o.meshes){if(o.lights&&o.lightMeshIndex===h||!d.featureData)continue;d.featureArray=new ac,d.featureArray.reserve(d.featureData.length);let _=e;for(const w of d.featureData){const M=a?65535&w:w>>16&65535,m=a?w>>16&65535:65535&w,E=(15&m)<8?15&m:0,I=r.evaluatedRMEA[E],b=r.evaluatedColor[E],T=r.emissionHeightBasedParams[E];let A;if(_&&E===2&&o.lights&&(A=new ac,A.resize(10*o.lights.length)),mv(d.featureArray,M,b,I,T,d.aabb.min[2],d.aabb.max[2],A),A&&_){_=!1;const k=o.meshes[o.lightMeshIndex];k.featureArray=A,k.featureArray._trim()}}d.featureArray._trim(),h++}}function C_(r,e,i,o){const h=1<<r.z;e.lat=ra((o/mn+r.y)/h),e.lng=Ia((i/mn+r.x)/h)}on(xf,"Tiled3dModelBucket",{omit:["layers"]}),on(A_,"Tiled3dModelFeature");const _v={circle:class extends Jo{constructor(r,e,i,o){super(r,{layout:Ui||(Ui=new ro({"circle-sort-key":new Rn(Ct.layout_circle["circle-sort-key"]),"circle-elevation-reference":new an(Ct.layout_circle["circle-elevation-reference"]),visibility:new an(Ct.layout_circle.visibility)})),paint:_t||(_t=new ro({"circle-radius":new Rn(Ct.paint_circle["circle-radius"]),"circle-color":new Rn(Ct.paint_circle["circle-color"]),"circle-blur":new Rn(Ct.paint_circle["circle-blur"]),"circle-opacity":new Rn(Ct.paint_circle["circle-opacity"]),"circle-translate":new an(Ct.paint_circle["circle-translate"]),"circle-translate-anchor":new an(Ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new an(Ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new an(Ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Rn(Ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Rn(Ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Rn(Ct.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new an(Ct.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(r){return new J(r)}queryRadius(r){const e=r;return ai("circle-radius",this,e)+ai("circle-stroke-width",this,e)+ei(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,o,h,a,d,_){const w=Ut(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,r.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Hc(r,o,a,d,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,M)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const o=Uu(this);return{config:new fu(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}},heatmap:class extends Jo{createBucket(r){return new am(r)}constructor(r,e,i,o){super(r,{layout:lm||(lm=new ro({visibility:new an(Ct.layout_heatmap.visibility)})),paint:um||(um=new ro({"heatmap-radius":new Rn(Ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Rn(Ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new an(Ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Lu(Ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new an(Ct.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return ai("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,o,h,a,d,_){const w=this.paint.get("heatmap-radius").evaluate(e,i);return Hc(r,o,a,d,_,!0,!0,new Xi(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new fu(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Jo{constructor(r,e,i,o){super(r,{layout:cm||(cm=new ro({visibility:new an(Ct.layout_hillshade.visibility)})),paint:hm||(hm=new ro({"hillshade-illumination-direction":new an(Ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new an(Ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new an(Ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new an(Ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new an(Ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new an(Ct.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new an(Ct.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends Jo{constructor(r,e,i,o){super(r,{layout:xm||(xm=new ro({"fill-sort-key":new Rn(Ct.layout_fill["fill-sort-key"]),visibility:new an(Ct.layout_fill.visibility),"fill-elevation-reference":new an(Ct.layout_fill["fill-elevation-reference"])})),paint:bm||(bm=new ro({"fill-antialias":new an(Ct.paint_fill["fill-antialias"]),"fill-opacity":new Rn(Ct.paint_fill["fill-opacity"]),"fill-color":new Rn(Ct.paint_fill["fill-color"]),"fill-outline-color":new Rn(Ct.paint_fill["fill-outline-color"]),"fill-translate":new an(Ct.paint_fill["fill-translate"]),"fill-translate-anchor":new an(Ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new Rn(Ct.paint_fill["fill-pattern"]),"fill-emissive-strength":new an(Ct.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Rn(Ct.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new fu(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new $f(r)}queryRadius(){return ei(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,o,h,a){return!r.queryGeometry.isAboveHorizon&&te(yt(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,r.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Jo{constructor(r,e,i,o){super(r,{layout:ig||(ig=new ro({visibility:new an(Ct["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new an(Ct["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:ng||(ng=new ro({"fill-extrusion-opacity":new an(Ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Rn(Ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new an(Ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new an(Ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Rn(Ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Rn(Ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Rn(Ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new an(Ct["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new an(Ct["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new an(Ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new an(Ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new an(Ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new an(Ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new an(Ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new an(Ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new an(Ct["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new an(Ct["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Rn(Ct["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Rn(Ct["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new an(Ct["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new an(Ct["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new an(Ct["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new an(Ct["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Rn(Ct["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Rn(Ct["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new an(Ct["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Yd(r)}queryRadius(){return ei(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,o,h,a,d,_,w){const M=Ut(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,r.pixelToTileUnitsFactor),m=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),I=[0,0],b=_&&a.elevation,T=a.elevation?a.elevation.exaggeration():1,A=r.tile.getBucket(this);if(b&&A instanceof Yd){const B=A.centroidVertexArray,H=w+1;H<B.length&&(I[0]=B.geta_centroid_pos0(H),I[1]=B.geta_centroid_pos1(H))}if(I[0]===0&&I[1]===1)return!1;a.projection.name==="globe"&&(o=tg([o],[new Xi(0,0),new Xi(mn,mn)],r.tileID.canonical).map(B=>B.polygon).flat());const k=b?_:null,[O,U]=function(B,H,$,ne,me,de,ue,Fe,ye,Ve,$e){return B.projection.name==="globe"?function(Ze,Qe,ht,wt,st,Jt,zi,Kt,wn,_n,Wi){const Fi=[],qn=[],En=Ze.projection.upVectorScale(Wi,Ze.center.lat,Ze.worldSize).metersToTile,kn=[0,0,0,1],wr=[0,0,0,1],zr=(Fr,Zr,Xr,qs)=>{Fr[0]=Zr,Fr[1]=Xr,Fr[2]=qs,Fr[3]=1},Nr=eg();ht>0&&(ht+=Nr),wt+=Nr;for(const Fr of Qe){const Zr=[],Xr=[];for(const qs of Fr){const Ps=qs.x+st.x,Cr=qs.y+st.y,Es=Ze.projection.projectTilePoint(Ps,Cr,Wi),Cs=Ze.projection.upVector(Wi,qs.x,qs.y);let eo=ht,Mo=wt;if(zi){const Vo=sg(Ps,Cr,ht,wt,zi,Kt,wn,_n);eo+=Vo.base,Mo+=Vo.top}ht!==0?zr(kn,Es.x+Cs[0]*En*eo,Es.y+Cs[1]*En*eo,Es.z+Cs[2]*En*eo):zr(kn,Es.x,Es.y,Es.z),zr(wr,Es.x+Cs[0]*En*Mo,Es.y+Cs[1]*En*Mo,Es.z+Cs[2]*En*Mo),Pe.vec3.transformMat4(kn,kn,Jt),Pe.vec3.transformMat4(wr,wr,Jt),Zr.push(new yc(kn[0],kn[1],kn[2])),Xr.push(new yc(wr[0],wr[1],wr[2]))}Fi.push(Zr),qn.push(Xr)}return[Fi,qn]}(B,H,$,ne,me,de,ue,Fe,ye,Ve,$e):ue?function(Ze,Qe,ht,wt,st,Jt,zi,Kt,wn){const _n=[],Wi=[],Fi=[0,0,0,1];for(const qn of Ze){const En=[],kn=[];for(const wr of qn){const zr=wr.x+wt.x,Nr=wr.y+wt.y,Fr=sg(zr,Nr,Qe,ht,Jt,zi,Kt,wn);Fi[0]=zr,Fi[1]=Nr,Fi[2]=Fr.base,Fi[3]=1,Pe.vec4.transformMat4(Fi,Fi,st),Fi[3]=Math.max(Fi[3],1e-5);const Zr=new yc(Fi[0]/Fi[3],Fi[1]/Fi[3],Fi[2]/Fi[3]);Fi[0]=zr,Fi[1]=Nr,Fi[2]=Fr.top,Fi[3]=1,Pe.vec4.transformMat4(Fi,Fi,st),Fi[3]=Math.max(Fi[3],1e-5);const Xr=new yc(Fi[0]/Fi[3],Fi[1]/Fi[3],Fi[2]/Fi[3]);En.push(Zr),kn.push(Xr)}_n.push(En),Wi.push(kn)}return[_n,Wi]}(H,$,ne,me,de,ue,Fe,ye,Ve):function(Ze,Qe,ht,wt,st){const Jt=[],zi=[],Kt=st[8]*Qe,wn=st[9]*Qe,_n=st[10]*Qe,Wi=st[11]*Qe,Fi=st[8]*ht,qn=st[9]*ht,En=st[10]*ht,kn=st[11]*ht;for(const wr of Ze){const zr=[],Nr=[];for(const Fr of wr){const Zr=Fr.x+wt.x,Xr=Fr.y+wt.y,qs=st[0]*Zr+st[4]*Xr+st[12],Ps=st[1]*Zr+st[5]*Xr+st[13],Cr=st[2]*Zr+st[6]*Xr+st[14],Es=st[3]*Zr+st[7]*Xr+st[15],Cs=qs+Kt,eo=Ps+wn,Mo=Cr+_n,Vo=Math.max(Es+Wi,1e-5),Ao=qs+Fi,go=Ps+qn,ko=Cr+En,qo=Math.max(Es+kn,1e-5);zr.push(new yc(Cs/Vo,eo/Vo,Mo/Vo)),Nr.push(new yc(Ao/qo,go/qo,ko/qo))}Jt.push(zr),zi.push(Nr)}return[Jt,zi]}(H,$,ne,me,de)}(a,o,E,m,M,d,k,I,T,a.center.lat,r.tileID.canonical),G=r.queryGeometry;return function(B,H,$){let ne=1/0;te($,H)&&(ne=rg($,H[0]));for(let me=0;me<H.length;me++){const de=H[me],ue=B[me];for(let Fe=0;Fe<de.length-1;Fe++){const ye=de[Fe],Ve=[ye,de[Fe+1],ue[Fe+1],ue[Fe],ye];X($,Ve)&&(ne=Math.min(ne,rg($,Ve)))}}return ne!==1/0&&ne}(O,U,G.isPointQuery()?G.screenBounds:G.screenGeometry)}},line:class extends Jo{constructor(r,e,i,o){const h=mg();super(r,h,e,i,o),h.layout&&(this.layout=new Pu(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ra,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(Zh)return Zh;const i=mg();return Zh=new x0(i.paint.properties["line-width"].specification),Zh.useIntegerZoom=!0,Zh})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new rp(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const o=fg(this);return{config:new fu(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(r){const e=r,i=gg(ai("line-width",this,e),ai("line-gap-width",this,e)),o=ai("line-offset",this,e);return i/2+Math.abs(o)+ei(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,o,h,a){if(r.queryGeometry.isAboveHorizon)return!1;const d=yt(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,r.pixelToTileUnitsFactor),_=r.pixelToTileUnitsFactor/2*gg(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(o=function(M,m){const E=[],I=new Xi(0,0);for(let b=0;b<M.length;b++){const T=M[b],A=[];for(let k=0;k<T.length;k++){const O=T[k],U=T[k+1],G=k===0?I:O.sub(T[k-1])._unit()._perp(),B=k===T.length-1?I:U.sub(O)._unit()._perp(),H=G._add(B)._unit();H._mult(1/(H.x*B.x+H.y*B.y)),A.push(H._mult(m)._add(O))}E.push(A)}return E}(o,w*r.pixelToTileUnitsFactor)),function(M,m,E){for(let I=0;I<m.length;I++){const b=m[I];if(M.length>=3){for(let T=0;T<b.length;T++)if(Me(M,b[T]))return!0}if(le(M,b,E))return!0}return!1}(d,o,_)}isTileClipped(){return!0}isDraped(r){return!this.hasElevatedBuckets}},symbol:df,background:class extends Jo{constructor(r,e,i,o){super(r,{layout:e_||(e_=new ro({visibility:new an(Ct.layout_background.visibility)})),paint:t_||(t_=new ro({"background-pitch-alignment":new an(Ct.paint_background["background-pitch-alignment"]),"background-color":new an(Ct.paint_background["background-color"]),"background-pattern":new an(Ct.paint_background["background-pattern"]),"background-opacity":new an(Ct.paint_background["background-opacity"]),"background-emissive-strength":new an(Ct.paint_background["background-emissive-strength"]),"background-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:o_,"raster-particle":d_,sky:class extends Jo{constructor(r,e,i,o){super(r,{layout:u_||(u_=new ro({visibility:new an(Ct.layout_sky.visibility)})),paint:c_||(c_=new ro({"sky-type":new an(Ct.paint_sky["sky-type"]),"sky-atmosphere-sun":new an(Ct.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new an(Ct.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new an(Ct.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new an(Ct.paint_sky["sky-gradient-radius"]),"sky-gradient":new Lu(Ct.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new an(Ct.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new an(Ct.paint_sky["sky-atmosphere-color"]),"sky-opacity":new an(Ct.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Nh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),h=!o,a=r.style.light,d=a.properties.get("position");return h&&a.properties.get("anchor")==="viewport"&&ur("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Ip(d.azimuthal,90-d.polar,e):Ip(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return Ip(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Jo{constructor(r,e,i,o){super(r,{paint:h_||(h_=new ro({}))},e,null)}},model:class extends Jo{constructor(r,e,i,o){super(r,{layout:w_||(w_=new ro({visibility:new an(Ct.layout_model.visibility),"model-id":new Rn(Ct.layout_model["model-id"])})),paint:E_||(E_=new ro({"model-opacity":new Rn(Ct.paint_model["model-opacity"]),"model-rotation":new Rn(Ct.paint_model["model-rotation"]),"model-scale":new Rn(Ct.paint_model["model-scale"]),"model-translation":new Rn(Ct.paint_model["model-translation"]),"model-color":new Rn(Ct.paint_model["model-color"]),"model-color-mix-intensity":new Rn(Ct.paint_model["model-color-mix-intensity"]),"model-type":new an(Ct.paint_model["model-type"]),"model-cast-shadows":new an(Ct.paint_model["model-cast-shadows"]),"model-receive-shadows":new an(Ct.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new an(Ct.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Rn(Ct.paint_model["model-emissive-strength"]),"model-roughness":new Rn(Ct.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Rn(Ct.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new an(Ct.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new an(Ct.paint_model["model-front-cutoff"]),"model-color-use-theme":new Rn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Cp(r)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof xf?mn-1:0}queryIntersectsFeature(r,e,i,o,h,a){if(!this.modelManager)return!1;const d=this.modelManager,_=r.tile.getBucket(this);if(!(_&&_ instanceof Cp))return!1;for(const w in _.instancesPerModel){const M=_.instancesPerModel[w],m=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(m)){const E=M.features[M.idToFeaturesIndex[m]],I=d.getModel(w,this.scope);if(!I)return!1;let b=Pe.mat4.create();const T=new as(0,0),A=_.canonical;let k=Number.MAX_VALUE;for(let O=0;O<E.instancedDataCount;++O){const U=16*(E.instancedDataOffset+O),G=M.instancedDataArray.float32,B=[G[U+4],G[U+5],G[U+6]];C_(A,T,G[U],0|G[U+1]),T_(b,I,a,T,E.rotation,E.scale,B,!1,!1,!1),a.projection.name==="globe"&&(b=Ap(b,a));const H=Pe.mat4.multiply([],a.projMatrix,b),$=r.queryGeometry,ne=__($.isPointQuery()?$.screenBounds:$.screenGeometry,a,H,I.aabb);ne!=null&&(k=Math.min(ne,k))}return k!==Number.MAX_VALUE&&k}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Vr}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Jo{constructor(r,e,i,o){super(r,{layout:wm||(wm=new ro({"clip-layer-types":new an(Ct.layout_clip["clip-layer-types"]),"clip-layer-scope":new an(Ct.layout_clip["clip-layer-scope"])})),paint:Em||(Em=new ro({}))},e,i,o)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new Tm(r)}isTileClipped(){return!0}is3D(){return!0}}};class yv{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class vv{constructor(){this.tasks={},this.taskQueue=[],fo(["process"],this),this.invoker=new yv(this.process),this.nextId=0}add(e,i){const o=this.nextId++,h=function({type:a,isSymbolTile:d,zoom:_}){return _=_||0,a==="message"?0:a!=="maybePrepare"||d?a!=="parseTile"||d?a==="parseTile"&&d?300-_:a==="maybePrepare"&&d?400-_:500:200-_:100-_}(i);if(h===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:h,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const a=this.tasks[this.taskQueue[h]];a.priority<i&&(i=a.priority,e=h)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class P_{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},fo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new vv}send(e,i,o,h,a=!1,d){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=d,this.callbacks[_]=o);const w=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!o,targetMapId:h,mustQueue:a,sourceMapId:this.mapId,data:No(i,w)},w),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[o];delete this.cancelCallbacks[o],h&&h.cancel()}else if(i.mustQueue||Re()){const h=this.callbacks[o],a=this.scheduler.add(()=>this.processTask(o,i),h&&h.metadata||{type:"message"});a&&(this.cancelCallbacks[o]=a)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(Ko(i.error)):o(null,Ko(i.data)))}else{const o=new Set,h=i.hasCallback?(d,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?No(d):null,data:No(_,o)},o)}:()=>{},a=Ko(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,a,h);else if(this.parent.getWorkerSource){const d=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,d[0],a.source,a.scope)[d[1]](a,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var od={workerUrl:"",workerClass:null,workerParams:void 0};const kp="mapboxgl_preloaded_worker_pool";class bc{constructor(){this.active={}}acquire(e,i=bc.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(od.workerClass!=null?new od.workerClass:new self.Worker(od.workerUrl,od.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kp]}numActive(){return Object.keys(this.active).length}}bc.workerCount=2;class th{constructor(e,i,o="Worker",h=bc.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Gn();const a=this.workerPool.acquire(this.id,h);for(let d=0;d<a.length;d++){const _=new th.Actor(a[d],i,this.id);_.name=`${o} ${d}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){Ts(this.actors,(h,a)=>{h.send(e,i,a)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let ad,Op;function bf(){return ad||(ad=new bc),ad}th.Actor=P_;const Dp=new W(0,0,0);var zp=(r=>(r[r.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",r[r.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",r[r.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",r))(zp||{}),wf=(r=>(r[r.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",r[r.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",r[r.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",r[r.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",r))(wf||{}),ld=(r=>(r[r.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",r[r.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",r[r.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",r[r.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",r[r.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",r))(ld||{}),L_=(r=>(r[r.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",r[r.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",r[r.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",r))(L_||{}),ih=(r=>(r[r.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",r[r.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",r[r.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",r[r.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",r[r.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",r[r.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",r))(ih||{}),R_=(r=>(r[r.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",r[r.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",r[r.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",r))(R_||{});function xv(r,e,i){r===1&&e.icons.push(function(o,h){return function(a){if(a.usvg_tree.height||(a.usvg_tree.height=a.usvg_tree.width),!a.metadata)return a;const{metadata:d}=a;if(d.content_area){const{content_area:_}=d;_.top==null&&(_.top=_.left),_.width==null&&(_.width=a.usvg_tree.width),_.height==null&&(_.height=_.width)}return d.stretch_x&&d.stretch_x.length&&k_(d,"x"),d.stretch_y&&d.stretch_y.length&&k_(d,"y"),a}(o.readFields(bv,{name:void 0},h))}(i,i.readVarint()+i.pos))}function k_(r,e){const i=[],o=r[`stretch_${e}`];let h=null;for(let a=0;a<o.length;a++)h===null?h=i.length===0?o[0]:i[i.length-1][1]+o[a]:(i.push([h,h+o[a]]),h=null);r[`stretch_${e}_areas`]=i}function bv(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=function(o,h){return o.readFields(wv,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=function(o,h){return o.readFields(Sv,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function wv(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=function(o,h){return o.readFields(Ev,{left:0},h)}(i,i.readVarint()+i.pos):r===4&&e.variables.push(function(o,h){return o.readFields(Tv,{name:void 0},h)}(i,i.readVarint()+i.pos))}function Ev(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function Tv(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=Sf(i.readVarint()),e.value="rgb_color")}function Sv(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(Ef(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push(function(o,h){return o.readFields(Rv,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push(function(o,h){return o.readFields(Ov,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push(function(o,h){return o.readFields(Dv,{children:[]},h)}(i,i.readVarint()+i.pos)):r===8&&e.masks.push(function(o,h){const a=o.readFields(zv,{left:0,width:20,mask_type:1,children:[]},h);return a.height==null&&(a.height=a.width),a.top==null&&(a.top=a.left),a}(i,i.readVarint()+i.pos))}function Ef(r,e){return r.readFields(Iv,{},e)}function Iv(r,e,i){r===1?(e.group=function(o,h){return o.readFields(Mv,{opacity:255,children:[]},h)}(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=function(o,h){return o.readFields(Cv,{paint_order:1,commands:[],step:1,diffs:[],rule:1},h)}(i,i.readVarint()+i.pos),e.node="path")}function Mv(r,e,i){r===1?e.transform=Tf(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(Ef(i,i.readVarint()+i.pos))}function Tf(r,e){return r.readFields(Av,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function Av(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function Cv(r,e,i){r===1?e.fill=function(o,h){return o.readFields(Pv,{rgb_color:Dp,paint:"rgb_color",opacity:255},h)}(i,i.readVarint()+i.pos):r===2?e.stroke=function(o,h){return o.readFields(Lv,{rgb_color:Dp,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function Pv(r,e,i){r===1?(e.rgb_color=Sf(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function Sf(r){return new W((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function Lv(r,e,i){r===1?(e.rgb_color=Sf(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function Rv(r,e,i){r===1?e.transform=Tf(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(O_(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function O_(r,e){return r.readFields(kv,{offset:0,opacity:255,rgb_color:Dp},e)}function kv(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=Sf(i.readVarint()))}function Ov(r,e,i){r===1?e.transform=Tf(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(O_(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function Dv(r,e,i){r===1?e.transform=Tf(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(Ef(i,i.readVarint()+i.pos))}function zv(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(Ef(i,i.readVarint()+i.pos))}class Nv{static calculate(e,i){const o=new Map,h=new Map;if(Object.keys(e).length===0)return o;i.forEach(a=>{h.set(a.name,a.rgb_color||new W(0,0,0))});for(const[a,d]of Object.entries(e))h.has(a)?o.set(h.get(a).toStringPremultipliedAlpha(),d):console.warn(`Ignoring unknown image variable "${a}"`);return o}}function nh(r,e=255,i){const o=e/255,h=r.toStringPremultipliedAlpha(),a=i.has(h)?i.get(h).clone():r.clone();return a.a=o,a.toString()}function ud(r,e){if(!oe()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}function Fv(r,e){const i=Nv.calculate(e.params,r.metadata?r.metadata.variables:[]),o=r.usvg_tree,h=o.width,a=o.height,d=e.transform?e.transform:new DOMMatrix,_=Math.max(1,Math.round(h*d.a)),w=Math.max(1,Math.round(a*d.d)),M=new DOMMatrix([_/h,0,0,w/a,0,0]),m=ud(_,w).getContext("2d");return Np(m,M,o,o,i),m.getImageData(0,0,_,w)}function Np(r,e,i,o,h){for(const a of o.children)D_(r,e,i,a,h)}function D_(r,e,i,o,h){o.group?(r.save(),function(a,d,_,w,M){const m=w.mask_idx!=null?_.masks[w.mask_idx]:null,E=w.clip_path_idx!=null?_.clip_paths[w.clip_path_idx]:null;if(w.transform&&(d=If(w.transform).preMultiplySelf(d)),!function(T,A,k){return T.opacity!==255||A||k}(w,E!=null,m!=null))return void Np(a,d,_,w,M);const I=ud(a.canvas.width,a.canvas.height),b=I.getContext("2d");Np(b,d,_,w,M),E&&G_(b,d,_,E),m&&j_(b,d,_,m,M),a.globalAlpha=w.opacity/255,a.drawImage(I,0,0)}(r,e,i,o.group,h),r.restore()):o.path&&(r.save(),function(a,d,_,w,M){const m=q_(w);a.setTransform(d),w.paint_order===L_.PAINT_ORDER_FILL_AND_STROKE?(z_(a,_,w,m,M),F_(a,_,w,m,M)):(F_(a,_,w,m,M),z_(a,_,w,m,M))}(r,e,i,o.path,h),r.restore())}function z_(r,e,i,o,h){const a=i.fill;if(!a)return;const d=a.opacity/255;switch(a.paint){case"rgb_color":r.fillStyle=nh(a.rgb_color,a.opacity,h);break;case"linear_gradient_idx":r.fillStyle=B_(r,e.linear_gradients[a.linear_gradient_idx],d,h);break;case"radial_gradient_idx":r.fillStyle=U_(r,e.radial_gradients[a.radial_gradient_idx],d,h)}r.fill(o,N_(i))}function N_(r){return r.rule===zp.PATH_RULE_NON_ZERO?"nonzero":r.rule===zp.PATH_RULE_EVEN_ODD?"evenodd":void 0}function F_(r,e,i,o,h){const a=i.stroke;if(!a)return;r.lineWidth=a.width,r.miterLimit=a.miterlimit,r.setLineDash(a.dasharray),r.lineDashOffset=a.dashoffset;const d=a.opacity/255;switch(a.paint){case"rgb_color":r.strokeStyle=nh(a.rgb_color,a.opacity,h);break;case"linear_gradient_idx":r.strokeStyle=B_(r,e.linear_gradients[a.linear_gradient_idx],d,h);break;case"radial_gradient_idx":r.strokeStyle=U_(r,e.radial_gradients[a.radial_gradient_idx],d,h)}switch(a.linejoin){case ld.LINE_JOIN_MITER_CLIP:case ld.LINE_JOIN_MITER:r.lineJoin="miter";break;case ld.LINE_JOIN_ROUND:r.lineJoin="round";break;case ld.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(a.linecap){case wf.LINE_CAP_BUTT:r.lineCap="butt";break;case wf.LINE_CAP_ROUND:r.lineCap="round";break;case wf.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(o)}function B_(r,e,i,o){if(e.stops.length===1){const I=e.stops[0];return nh(I.rgb_color,I.opacity*i,o)}const h=If(e.transform),{x1:a,y1:d,x2:_,y2:w}=e,M=h.transformPoint(new DOMPoint(a,d)),m=h.transformPoint(new DOMPoint(_,w)),E=r.createLinearGradient(M.x,M.y,m.x,m.y);for(const I of e.stops)E.addColorStop(I.offset,nh(I.rgb_color,I.opacity*i,o));return E}function U_(r,e,i,o){if(e.stops.length===1){const I=e.stops[0];return nh(I.rgb_color,I.opacity*i,o)}const h=If(e.transform),{fx:a,fy:d,cx:_,cy:w}=e,M=h.transformPoint(new DOMPoint(a,d)),m=h.transformPoint(new DOMPoint(_,w)),E=r.createRadialGradient(M.x,M.y,0,m.x,m.y,e.r*((h.a+h.d)/2));for(const I of e.stops)E.addColorStop(I.offset,nh(I.rgb_color,I.opacity*i,o));return E}function V_(r,e,i,o){const h=o.transform?If(o.transform).preMultiplySelf(e):e,a=ud(r.canvas.width,r.canvas.height),d=a.getContext("2d");for(const w of o.children)if(w.group)V_(d,h,i,w.group);else if(w.path){const M=w.path,m=new Path2D;m.addPath(q_(M),h),d.fill(m,N_(M))}const _=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;_&&G_(d,h,i,_),r.globalCompositeOperation="source-over",r.drawImage(a,0,0)}function G_(r,e,i,o){const h=ud(r.canvas.width,r.canvas.height);V_(h.getContext("2d"),e,i,o),r.globalCompositeOperation="destination-in",r.drawImage(h,0,0)}function j_(r,e,i,o,h){if(o.children.length===0)return;const a=o.mask_idx!=null?i.masks[o.mask_idx]:null;a&&j_(r,e,i,a,h);const d=r.canvas.width,_=r.canvas.height,w=ud(d,_),M=w.getContext("2d"),m=o.width,E=o.height,I=o.left,b=o.top,T=new Path2D,A=new Path2D;A.rect(I,b,m,E),T.addPath(A,e),M.clip(T);for(const U of o.children)D_(M,e,i,U,h);const k=M.getImageData(0,0,d,_),O=k.data;if(o.mask_type===R_.MASK_TYPE_LUMINANCE)for(let U=0;U<O.length;U+=4)O[U+3]=O[U+3]/255*(.2126*O[U]+.7152*O[U+1]+.0722*O[U+2]);M.putImageData(k,0,0),r.globalCompositeOperation="destination-in",r.drawImage(w,0,0)}function If(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function q_(r){const e=new Path2D,i=r.step;let o=r.diffs[0]*i,h=r.diffs[1]*i;e.moveTo(o,h);for(let a=0,d=2;a<r.commands.length;a++)switch(r.commands[a]){case ih.PATH_COMMAND_MOVE:o+=r.diffs[d++]*i,h+=r.diffs[d++]*i,e.moveTo(o,h);break;case ih.PATH_COMMAND_LINE:o+=r.diffs[d++]*i,h+=r.diffs[d++]*i,e.lineTo(o,h);break;case ih.PATH_COMMAND_QUAD:{const _=o+r.diffs[d++]*i,w=h+r.diffs[d++]*i;o=_+r.diffs[d++]*i,h=w+r.diffs[d++]*i,e.quadraticCurveTo(_,w,o,h);break}case ih.PATH_COMMAND_CUBIC:{const _=o+r.diffs[d++]*i,w=h+r.diffs[d++]*i,M=_+r.diffs[d++]*i,m=w+r.diffs[d++]*i;o=M+r.diffs[d++]*i,h=m+r.diffs[d++]*i,e.bezierCurveTo(_,w,M,m,o,h);break}case ih.PATH_COMMAND_CLOSE:e.closePath()}return e}class Fp{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}class Bp{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new aa(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new Fp(150)),this.cacheMap.get(o).get(gl(e.serialize(),i))}setInCache(e,i,o,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Fp(150));const a=this.cacheDependenciesMap.get(h);a.get(gl(e.id,o))||a.set(gl(e.id,o),new Set);const d=this.cacheMap.get(h),_=e.serialize();a.get(gl(e.id,o)).add(_),d.put(gl(e.serialize(),o),i)}removeImagesFromCacheByIds(e,i,o=""){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const h=this.cacheMap.get(o),a=this.cacheDependenciesMap.get(o);for(const d of e)if(a.has(gl(d,i))){for(const _ of a.get(gl(d,i)))h.delete(_);a.delete(gl(d,i))}}rasterize(e,i,o,h,a=Fv){const d=this.getFromCache(e,o,h);if(d)return d.clone();const _=a(i.icon,e.options),w=Bp._getImage(_);return this.setInCache(e,w,o,h),w.clone()}}class H_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Z_(r,e,i,o){let h=0,a=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(o[d])<1e-15){if(i[d]<r[d]||i[d]>e[d])return null}else{const _=1/o[d];let w=(r[d]-i[d])*_,M=(e[d]-i[d])*_;if(w>M){const m=w;w=M,M=m}if(w>h&&(h=w),M<a&&(a=M),h>a)return null}return h}function X_(r,e,i,o,h,a,d,_,w,M,m){const E=o-r,I=h-e,b=a-i,T=d-r,A=_-e,k=w-i,O=m[1]*k-m[2]*A,U=m[2]*T-m[0]*k,G=m[0]*A-m[1]*T,B=E*O+I*U+b*G;if(Math.abs(B)<1e-15)return null;const H=1/B,$=M[0]-r,ne=M[1]-e,me=M[2]-i,de=($*O+ne*U+me*G)*H;if(de<0||de>1)return null;const ue=ne*b-me*I,Fe=me*E-$*b,ye=$*I-ne*E,Ve=(m[0]*ue+m[1]*Fe+m[2]*ye)*H;return Ve<0||de+Ve>1?null:(T*ue+A*Fe+k*ye)*H}function $_(r,e,i){return(r-e)/(i-e)}function W_(r,e,i,o,h,a,d,_,w){const M=1<<i,m=a-o,E=d-h,I=(r+1)/M*m+o,b=(e+0)/M*E+h,T=(e+1)/M*E+h;_[0]=(r+0)/M*m+o,_[1]=b,w[0]=I,w[1]=T}class Y_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(a){const d=Math.ceil(Math.log2(a.dim/8)),_=[];let w=Math.ceil(Math.pow(2,d));const M=1/w,m=(b,T,A,k,O)=>{const U=k?1:0,G=(b+1)*A-U,B=T*A,H=(T+1)*A-U;O[0]=b*A,O[1]=B,O[2]=G,O[3]=H};let E=new H_(w);const I=[];for(let b=0;b<w*w;b++){m(b%w,Math.floor(b/w),M,!1,I);const T=Xu(I[0],I[1],a),A=Xu(I[2],I[1],a),k=Xu(I[2],I[3],a),O=Xu(I[0],I[3],a);E.minimums.push(Math.min(T,A,k,O)),E.maximums.push(Math.max(T,A,k,O)),E.leaves.push(1)}for(_.push(E),w/=2;w>=1;w/=2){const b=_[_.length-1];E=new H_(w);for(let T=0;T<w*w;T++){m(T%w,Math.floor(T/w),2,!0,I);const A=b.getElevation(I[0],I[1]),k=b.getElevation(I[2],I[1]),O=b.getElevation(I[2],I[3]),U=b.getElevation(I[0],I[3]),G=b.isLeaf(I[0],I[1]),B=b.isLeaf(I[2],I[1]),H=b.isLeaf(I[2],I[3]),$=b.isLeaf(I[0],I[3]),ne=Math.min(A.min,k.min,O.min,U.min),me=Math.max(A.max,k.max,O.max,U.max),de=G&&B&&H&&$;E.maximums.push(me),E.minimums.push(ne),E.leaves.push(me-ne<=5&&de?1:0)}_.push(E)}return _}(this.dem),o=i.length-1,h=i[o];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,h,a,d,_=1){return Z_([e,i,-100],[o,h,this.maximums[0]*_],a,d)}raycast(e,i,o,h,a,d,_=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,o,h,a,d,_);if(w==null)return null;const M=[],m=[],E=[],I=[],b=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;b.length>0;){const{idx:T,t:A,nodex:k,nodey:O,depth:U}=b.pop();if(this.leaves[T]){W_(k,O,U,e,i,o,h,E,I);const B=1<<U,H=(k+0)/B,$=(k+1)/B,ne=(O+0)/B,me=(O+1)/B,de=Xu(H,ne,this.dem)*_,ue=Xu($,ne,this.dem)*_,Fe=Xu($,me,this.dem)*_,ye=Xu(H,me,this.dem)*_,Ve=X_(E[0],E[1],de,I[0],E[1],ue,I[0],I[1],Fe,a,d),$e=X_(I[0],I[1],Fe,E[0],I[1],ye,E[0],E[1],de,a,d),Ze=Math.min(Ve!==null?Ve:Number.MAX_VALUE,$e!==null?$e:Number.MAX_VALUE);if(Ze!==Number.MAX_VALUE)return Ze;{const Qe=Pe.vec3.scaleAndAdd([],a,d,A);if(K_(de,ue,ye,Fe,$_(Qe[0],E[0],I[0]),$_(Qe[1],E[1],I[1]))>=Qe[2])return A}continue}let G=0;for(let B=0;B<this._siblingOffset.length;B++){W_((k<<1)+this._siblingOffset[B][0],(O<<1)+this._siblingOffset[B][1],U+1,e,i,o,h,E,I),E[2]=-100,I[2]=this.maximums[this.childOffsets[T]+B]*_;const H=Z_(E,I,a,d);if(H!=null){const $=H;M[B]=$;let ne=!1;for(let me=0;me<G&&!ne;me++)$>=M[m[me]]&&(m.splice(me,0,B),ne=!0);ne||(m[G]=B),G++}}for(let B=0;B<G;B++){const H=m[B];b.push({idx:this.childOffsets[T]+H,t:M[H],nodex:(k<<1)+this._siblingOffset[H][0],nodey:(O<<1)+this._siblingOffset[H][1],depth:U+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,h,a){if(e[h].isLeaf(i,o)===1)return;this.childOffsets[a]||(this.childOffsets[a]=this.nodeCount);const d=h-1,_=e[d];let w=0,M=0;for(let m=0;m<this._siblingOffset.length;m++){const E=2*i+this._siblingOffset[m][0],I=2*o+this._siblingOffset[m][1],b=_.getElevation(E,I),T=_.isLeaf(E,I),A=this._addNode(b.min,b.max,T);T&&(w|=1<<m),M||(M=A)}for(let m=0;m<this._siblingOffset.length;m++)w&1<<m||this._construct(e,2*i+this._siblingOffset[m][0],2*o+this._siblingOffset[m][1],d,M+m)}}function K_(r,e,i,o,h,a){return Ye(Ye(r,i,a),Ye(e,o,a),h)}function Xu(r,e,i){const o=i.dim,h=cn(r*o-.5,0,o-1),a=cn(e*o-.5,0,o-1),d=Math.floor(h),_=Math.floor(a),w=Math.min(d+1,o-1),M=Math.min(_+1,o-1);return K_(i.get(d,_),i.get(w,_),i.get(d,M),i.get(w,M),h-d,a-_)}const Bv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Uv(r,e,i){return(256*r*256+256*e+i)/10-1e4}function Vv(r,e,i){return 256*r+e+i/256-32768}class Mf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void ur(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const a=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let w=0;w<a;w++)d[this._idx(-1,w)]=d[this._idx(0,w)],d[this._idx(a,w)]=d[this._idx(a-1,w)],d[this._idx(w,-1)]=d[this._idx(w,0)],d[this._idx(w,a)]=d[this._idx(w,a-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(a,-1)]=d[this._idx(a-1,0)],d[this._idx(-1,a)]=d[this._idx(0,a-1)],d[this._idx(a,a)]=d[this._idx(a-1,a-1)]}const _=o==="terrarium"?Vv:Uv;for(let w=0;w<d.length;++w){const M=4*w;this.floatView[w]=_(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}this._timestamp=Ee.now()}_buildQuadTree(){this._tree=new Y_(this)}get(e,i,o=!1){o&&(e=cn(e,-1,this.dim),i=cn(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,o){const h=this._idx(e,i),a=this.floatView[h];return this.floatView[h]=o,o-a}static getUnpackVector(e){return Bv[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],h=Mf.getUnpackVector(i);let a=Math.floor((e+h[3])/h[2]);return o[2]=a%256,a=Math.floor(a/256),o[1]=a%256,a=Math.floor(a/256),o[0]=a,o}getPixels(){return new pm({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,a=i*this.dim+this.dim,d=o*this.dim,_=o*this.dim+this.dim;switch(i){case-1:h=a-1;break;case 1:a=h+1}switch(o){case-1:d=_-1;break;case 1:_=d+1}const w=-i*this.dim,M=-o*this.dim;for(let m=d;m<_;m++)for(let E=h;E<a;E++){const I=4*this._idx(E,m),b=4*this._idx(E+w,m+M);this.pixels[I+0]=e.pixels[b+0],this.pixels[I+1]=e.pixels[b+1],this.pixels[I+2]=e.pixels[b+2],this.pixels[I+3]=e.pixels[b+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Gv(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push(function(o,h){return o.readFields(Xv,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(i,i.readVarint()+i.pos))}function jv(r,e,i){r===1?(e.delta_filter=function(o,h){return o.readFields(qv,{blockSize:0},h)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function qv(r,e,i){r===1&&(e.blockSize=i.readVarint())}function Hv(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function Zv(r,e,i){let o=0,h=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push(function(a,d){return a.readFields(jv,{},d)}(i,i.readVarint()+i.pos)):r===4?e.codec=function(a,d){return a.readFields(Hv,{},d)}(i,i.readVarint()+i.pos):r===5?h=i.readFloat():r===6?o=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=o)}function Xv(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push(function(o,h){return o.readFields(Zv,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(i,i.readVarint()+i.pos))}function $v(r,e,i){if(r===2)(function(o,h,a){o.readFields(Wv,a,h)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function Wv(r,e,i){if(r===1){let o=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[o++]=i.readVarint()}}function Yv(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const h=o===1?1:0,a=o===2?1:0;for(let d=0;d<e[0];d++){const _=e[1]*d;for(let w=h;w<e[1];w++){const M=e[2]*(w+_);for(let m=a;m<e[2];m++){const E=e[3]*(m+M);for(let I=0;I<e[3];I++){const b=E+I;r[b]+=r[b-i]}}}}i*=e[o]}return r}function Kv(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function Jv(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const o=r[i],h=r[i+1];r[i]=(240&o)>>4|(61440&o)>>8|(240&h)<<4|61440&h,r[i+1]=15&o|(3840&o)>>4|(15&h)<<8|(3840&h)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const o=r[i],h=r[i+1],a=r[i+2],d=r[i+3];r[i+0]=(192&o)>>6|(192&h)>>4|(192&a)>>2|192&d,r[i+1]=(48&o)>>4|(48&h)>>2|48&a|(48&d)<<2,r[i+2]=(12&o)>>2|12&h|(12&a)<<2|(12&d)<<4,r[i+3]=3&o|(3&h)<<2|(3&a)<<4|(3&d)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}on(Mf,"DEMData"),on(Y_,"DemMinMaxQuadTree",{omit:["dem"]});var rl=Uint8Array,cd=Uint16Array,Qv=Int32Array,J_=new rl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Q_=new rl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ex=new rl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ey=function(r,e){for(var i=new cd(31),o=0;o<31;++o)i[o]=e+=1<<r[o-1];var h=new Qv(i[30]);for(o=1;o<30;++o)for(var a=i[o];a<i[o+1];++a)h[a]=a-i[o]<<5|o;return{b:i,r:h}},ty=ey(J_,2),iy=ty.b,tx=ty.r;iy[28]=258,tx[258]=28;for(var ix=ey(Q_,0).b,ny=new cd(32768),Uo=0;Uo<32768;++Uo){var rh=(43690&Uo)>>1|(21845&Uo)<<1;ny[Uo]=((65280&(rh=(61680&(rh=(52428&rh)>>2|(13107&rh)<<2))>>4|(3855&rh)<<4))>>8|(255&rh)<<8)>>1}var hd=function(r,e,i){for(var o=r.length,h=0,a=new cd(e);h<o;++h)r[h]&&++a[r[h]-1];var d,_=new cd(e);for(h=1;h<e;++h)_[h]=_[h-1]+a[h-1]<<1;d=new cd(1<<e);var w=15-e;for(h=0;h<o;++h)if(r[h])for(var M=h<<4|r[h],m=e-r[h],E=_[r[h]-1]++<<m,I=E|(1<<m)-1;E<=I;++E)d[ny[E]>>w]=M;return d},dd=new rl(288);for(Uo=0;Uo<144;++Uo)dd[Uo]=8;for(Uo=144;Uo<256;++Uo)dd[Uo]=9;for(Uo=256;Uo<280;++Uo)dd[Uo]=7;for(Uo=280;Uo<288;++Uo)dd[Uo]=8;var ry=new rl(32);for(Uo=0;Uo<32;++Uo)ry[Uo]=5;var nx=hd(dd,9),rx=hd(ry,5),Up=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},Ul=function(r,e,i){var o=e/8|0;return(r[o]|r[o+1]<<8)>>(7&e)&i},Vp=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},sx=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Vl=function(r,e,i){var o=new Error(e||sx[r]);if(o.code=r,Error.captureStackTrace&&Error.captureStackTrace(o,Vl),!i)throw o;return o},ox=new rl(0),ax=typeof TextDecoder!="undefined"&&new TextDecoder;try{ax.decode(ox,{stream:!0})}catch(r){}const lx={gzip_data:"gzip"};class El extends Error{constructor(e){super(e),this.name="MRTError"}}const ux={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},sy={uint32:1,uint16:2,uint8:4},cx={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Gp;class jp{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new El(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new El("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new El(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const h=function(a,d){return a.readFields(Gv,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Gp(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new El(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const a of h.layers)this.layers[a.name]=new hx(a,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let h of e.blockIndices){const a=o.dataIndex[h],d=a.firstByte-e.firstByte,_=a.lastByte-e.firstByte;if(o._blocksInProgress.has(h))continue;const w={layerName:o.name,firstByte:d,lastByte:_,pixelFormat:o.pixelFormat,blockIndex:h,blockShape:[a.bands.length].concat(o.bandShape),buffer:o.buffer,codec:a.codec.codec,filters:a.filters.map(M=>M.filter)};o._blocksInProgress.add(h),i.push(w)}return new oy(i,()=>{i.forEach(h=>o._blocksInProgress.delete(h.blockIndex))},(h,a)=>{if(i.forEach(d=>o._blocksInProgress.delete(d.blockIndex)),h)throw h;a.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class hx{constructor({version:e,name:i,units:o,tileSize:h,pixelFormat:a,buffer:d,dataIndex:_},w){if(this.version=e,this.version!==1)throw new El(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=h,this.buffer=d,this.pixelFormat=ux[a],this.dataIndex=_,this.bandShape=[h+2*d,h+2*d,sy[this.pixelFormat]],this._decodedBlocks=new Fp(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return sy[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,h]of this.dataIndex.entries()){for(const[a,d]of h.bands.entries())if(d===e)return{bandIndex:i+a,blockIndex:o,blockBandIndex:a};i+=h.bands.length}break;case"number":for(const[o,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new El(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new El(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0;const h=[],a=new Set;for(const d of e){const{blockIndex:_}=this.getBlockForBand(d);if(_<0)throw new El(`Invalid band: ${JSON.stringify(d)}`);const w=this.dataIndex[_];h.includes(_)||h.push(_),a.add(_),i=Math.min(i,w.firstByte),o=Math.max(o,w.lastByte)}if(a.size>this.cacheSize)throw new El(`Number of blocks to decode (${a.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),h=this._decodedBlocks.get(i.toString());if(!h)throw new El(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const a=this.dataIndex[i],d=this.bandShape.reduce((M,m)=>M*m,1),_=o*d,w=h.subarray(_,_+d);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:a.offset,scale:a.scale}}}jp.setPbf=function(r){Gp=r};class oy{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}jp.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map(o=>{const{layerName:h,firstByte:a,lastByte:d,pixelFormat:_,blockShape:w,blockIndex:M,filters:m,codec:E}=o,I=i.subarray(a,d+1),b=new Uint32Array(w[0]*w[1]*w[2]);let T;if(E!=="gzip_data")throw new El(`Unhandled codec: ${E}`);return T=function(A,k){if(!globalThis.DecompressionStream&&k==="gzip_data")return Promise.resolve(((B=function(ne){ne[0]==31&&ne[1]==139&&ne[2]==8||Vl(6,"invalid gzip data");var me=ne[3],de=10;4&me&&(de+=2+(ne[10]|ne[11]<<8));for(var ue=(me>>3&1)+(me>>4&1);ue>0;ue-=!ne[de++]);return de+(2&me)}(G=A))+8>G.length&&Vl(6,"invalid gzip data"),function(ne,me,de,ue){var Fe=ne.length;if(!Fe||me.f&&!me.l)return de||new rl(0);var ye=!de,Ve=ye||me.i!=2,$e=me.i;ye&&(de=new rl(3*Fe));var Ze,Qe,ht=function($u){var Tc=de.length;if($u>Tc){var gd=new rl(Math.max(2*Tc,$u));gd.set(de),de=gd}},wt=me.f||0,st=me.p||0,Jt=me.b||0,zi=me.l,Kt=me.d,wn=me.m,_n=me.n,Wi=8*Fe;do{if(!zi){wt=Ul(ne,st,1);var Fi=Ul(ne,st+1,3);if(st+=3,!Fi){var qn=ne[(Cr=4+((st+7)/8|0))-4]|ne[Cr-3]<<8,En=Cr+qn;if(En>Fe){$e&&Vl(0);break}Ve&&ht(Jt+qn),de.set(ne.subarray(Cr,En),Jt),me.b=Jt+=qn,me.p=st=8*En,me.f=wt;continue}if(Fi==1)zi=nx,Kt=rx,wn=9,_n=5;else if(Fi==2){var kn=Ul(ne,st,31)+257,wr=Ul(ne,st+10,15)+4,zr=kn+Ul(ne,st+5,31)+1;st+=14;for(var Nr=new rl(zr),Fr=new rl(19),Zr=0;Zr<wr;++Zr)Fr[ex[Zr]]=Ul(ne,st+3*Zr,7);st+=3*wr;var Xr=Up(Fr),qs=(1<<Xr)-1,Ps=hd(Fr,Xr);for(Zr=0;Zr<zr;){var Cr,Es=Ps[Ul(ne,st,qs)];if(st+=15&Es,(Cr=Es>>4)<16)Nr[Zr++]=Cr;else{var Cs=0,eo=0;for(Cr==16?(eo=3+Ul(ne,st,3),st+=2,Cs=Nr[Zr-1]):Cr==17?(eo=3+Ul(ne,st,7),st+=3):Cr==18&&(eo=11+Ul(ne,st,127),st+=7);eo--;)Nr[Zr++]=Cs}}var Mo=Nr.subarray(0,kn),Vo=Nr.subarray(kn);wn=Up(Mo),_n=Up(Vo),zi=hd(Mo,wn),Kt=hd(Vo,_n)}else Vl(1);if(st>Wi){$e&&Vl(0);break}}Ve&&ht(Jt+131072);for(var Ao=(1<<wn)-1,go=(1<<_n)-1,ko=st;;ko=st){var qo=(Cs=zi[Vp(ne,st)&Ao])>>4;if((st+=15&Cs)>Wi){$e&&Vl(0);break}if(Cs||Vl(2),qo<256)de[Jt++]=qo;else{if(qo==256){ko=st,zi=null;break}var pa=qo-254;qo>264&&(pa=Ul(ne,st,(1<<(jl=J_[Zr=qo-257]))-1)+iy[Zr],st+=jl);var Js=Kt[Vp(ne,st)&go],Va=Js>>4;if(Js||Vl(3),st+=15&Js,Vo=ix[Va],Va>3){var jl=Q_[Va];Vo+=Vp(ne,st)&(1<<jl)-1,st+=jl}if(st>Wi){$e&&Vl(0);break}Ve&&ht(Jt+131072);var Tl=Jt+pa;if(Jt<Vo){var Sl=0-Vo,Ec=Math.min(Vo,Tl);for(Sl+Jt<0&&Vl(3);Jt<Ec;++Jt)de[Jt]=(void 0)[Sl+Jt]}for(;Jt<Tl;++Jt)de[Jt]=de[Jt-Vo]}}me.l=zi,me.p=ko,me.b=Jt,me.f=wt,zi&&(wt=1,me.m=wn,me.d=Kt,me.n=_n)}while(!wt);return Jt!=de.length&&ye?(Ze=de,((Qe=Jt)==null||Qe>Ze.length)&&(Qe=Ze.length),new rl(Ze.subarray(0,Qe))):de.subarray(0,Jt)}(G.subarray(B,-8),{i:2},new rl(((O=G)[(U=O.length)-4]|O[U-3]<<8|O[U-2]<<16|O[U-1]<<24)>>>0))));var O,U,G,B;const H=lx[k];if(!H)throw new Error(`Unhandled codec: ${k}`);const $=new globalThis.DecompressionStream(H);return new Response(new Blob([A]).stream().pipeThrough($)).arrayBuffer().then(ne=>new Uint8Array(ne))}(I,E).then(A=>(function(k,O){k.readFields($v,O)}(new Gp(A),b),new cx[_](b.buffer))),T.then(A=>{for(let k=m.length-1;k>=0;k--)switch(m[k]){case"delta_filter":Yv(A,w);break;case"zigzag_filter":Kv(A);break;case"bitshuffle_filter":Jv(A,_);break;default:throw new El(`Unhandled filter "${m[k]}"`)}return{layerName:h,blockIndex:M,data:A}}).catch(A=>{throw A})}))},on(oy,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let fd,qp,Gl,sh,Hp,oh=null;function ay(){return Re()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:qp||Bn.DRACO_URL}function ly(){if(Re()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(sh)return sh;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return sh=WebAssembly.validate(r)?Bn.MESHOPT_SIMD_URL:Bn.MESHOPT_URL,sh}const Af={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},dx={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},pd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function uy(r,e,i){const o=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:h,byteLength:r.byteLength},i.buffers[h]=r}const Zp="KHR_draco_mesh_compression";function fx(r,e){const i=r.extensions&&r.extensions[Zp];if(!i)return;const o=new Gl.Decoder,h=fy(e,i.bufferView),a=new Gl.Mesh;if(!o.DecodeArrayToMesh(h,h.byteLength,a))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[r.indices],_=Af[d.componentType],w=d.count*_.BYTES_PER_ELEMENT,M=Gl._malloc(w);_===Uint16Array?o.GetTrianglesUInt16Array(a,w,M):o.GetTrianglesUInt32Array(a,w,M),uy(Gl.memory.buffer.slice(M,M+w),d,e),Gl._free(M);for(const m of Object.keys(i.attributes)){const E=o.GetAttributeByUniqueId(a,i.attributes[m]),I=e.json.accessors[r.attributes[m]],b=dx[I.componentType],T=I.count*pd[I.type]*Af[I.componentType].BYTES_PER_ELEMENT,A=Gl._malloc(T);o.GetAttributeDataArrayForAllPoints(a,E,Gl[b],T,A),uy(Gl.memory.buffer.slice(A,A+T),I,e),Gl._free(A)}o.destroy(),a.destroy(),delete r.extensions[Zp]}const Cf="EXT_meshopt_compression";function px(r,e){if(!r.extensions||!r.extensions[Cf])return;const i=r.extensions[Cf],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);Hp.decodeGltfBuffer(h,i.count,i.byteStride,o,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=h.buffer,delete r.extensions[Cf]}const cy=1179937895,hy=new TextDecoder("utf8");function dy(r,e){return new URL(r,e).href}function mx(r,e,i,o){return fetch(dy(r.uri,o)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[i]=h})}function fy(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function gx(r,e,i,o){if(r.uri){const h=dy(r.uri,o);return fetch(h).then(a=>a.blob()).then(a=>createImageBitmap(a)).then(a=>{e.images[i]=a})}if(r.bufferView!==void 0){const h=fy(e,r.bufferView),a=new Blob([h],{type:r.mimeType});return createImageBitmap(a).then(d=>{e.images[i]=d})}}function py(r,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===cy){const m=new Uint32Array(r,e);let E=2;const I=(m[E++]>>2)-3,b=m[E++]>>2;if(E++,o.json=JSON.parse(hy.decode(m.subarray(E,E+b))),E+=b,E<I){const T=m[E++];E++;const A=e+(E<<2);o.buffers[0]=r.slice(A,A+T)}}else o.json=JSON.parse(hy.decode(new Uint8Array(r,e)));const{buffers:h,images:a,meshes:d,extensionsUsed:_,bufferViews:w}=o.json;let M=Promise.resolve();if(h){const m=[];for(let E=0;E<h.length;E++){const I=h[E];I.uri?m.push(mx(I,o,E,i)):o.buffers[E]||(o.buffers[E]=null)}M=Promise.all(m)}return M.then(()=>{const m=[],E=_&&_.includes(Zp),I=_&&_.includes(Cf);if(E&&m.push(function(){if(!Gl)return fd!=null?fd:(fd=function(b){let T,A=null;function k(){T=new Uint8Array(A.buffer)}function O(){throw new Error("Unexpected Draco error.")}const U={a:{a:O,d:function(G,B,H){return T.copyWithin(G,B,B+H)},c:function(G){const B=T.length,H=Math.max(G>>>0,Math.ceil(1.2*B)),$=Math.ceil((H-B)/65536);try{return A.grow($),k(),!0}catch(ne){return!1}},b:O}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(b,U):b.then(G=>G.arrayBuffer()).then(G=>WebAssembly.instantiate(G,U))).then(G=>{const{Rb:B,Qb:H,P:$,T:ne,X:me,Ja:de,La:ue,Qa:Fe,Va:ye,Wa:Ve,eb:$e,jb:Ze,f:Qe,e:ht,yb:wt,zb:st,Ab:Jt,Bb:zi,Db:Kt,Gb:wn}=G.instance.exports;A=ht;const _n=(()=>{let Wi=0,Fi=0,qn=0,En=0;return kn=>{qn&&(B(En),B(Wi),Fi+=qn,qn=Wi=0),Wi||(Fi+=128,Wi=H(Fi));const wr=kn.length+7&-8;let zr=Wi;wr>=Fi&&(qn=wr,zr=En=H(wr));for(let Nr=0;Nr<kn.length;Nr++)T[zr+Nr]=kn[Nr];return zr}})();return k(),Qe(),{memory:ht,_free:B,_malloc:H,Mesh:class{constructor(){this.ptr=$()}destroy(){ne(this.ptr)}},Decoder:class{constructor(){this.ptr=de()}destroy(){Ze(this.ptr)}DecodeArrayToMesh(Wi,Fi,qn){const En=_n(Wi),kn=ue(this.ptr,En,Fi,qn.ptr);return!!me(kn)}GetAttributeByUniqueId(Wi,Fi){return{ptr:Fe(this.ptr,Wi.ptr,Fi)}}GetTrianglesUInt16Array(Wi,Fi,qn){ye(this.ptr,Wi.ptr,Fi,qn)}GetTrianglesUInt32Array(Wi,Fi,qn){Ve(this.ptr,Wi.ptr,Fi,qn)}GetAttributeDataArrayForAllPoints(Wi,Fi,qn,En,kn){$e(this.ptr,Wi.ptr,Fi.ptr,qn,En,kn)}},DT_INT8:wt(),DT_UINT8:st(),DT_INT16:Jt(),DT_UINT16:zi(),DT_UINT32:Kt(),DT_FLOAT32:wn()}})}(fetch(ay())),fd.then(b=>{Gl=b,fd=void 0}))}()),I&&m.push(function(){if(Hp)return;const b=function(T){let A;const k=WebAssembly.instantiateStreaming(T,{}).then(G=>{A=G.instance,A.exports.__wasm_call_ctors()}),O={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},U={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:k,supported:!0,decodeGltfBuffer(G,B,H,$,ne,me){(function(de,ue,Fe,ye,Ve,$e,Ze){const Qe=de.exports.sbrk,ht=ye+3&-4,wt=Qe(ht*Ve),st=Qe($e.length),Jt=new Uint8Array(de.exports.memory.buffer);Jt.set($e,st);const zi=ue(wt,ye,Ve,st,$e.length);if(zi===0&&Ze&&Ze(wt,ht,Ve),Fe.set(Jt.subarray(wt,wt+ye*Ve)),Qe(wt-Qe(0)),zi!==0)throw new Error(`Malformed buffer data: ${zi}`)})(A,A.exports[U[ne]],G,B,H,$,A.exports[O[me]])}}}(fetch(ly()));return b.ready.then(()=>{Hp=b})}()),a)for(let b=0;b<a.length;b++)m.push(gx(a[b],o,b,i));return(m.length?Promise.all(m):Promise.resolve()).then(()=>{if(E&&d)for(const{primitives:b}of d)for(const T of b)fx(T,o);if(I&&d&&w)for(const b of w)px(b,o);return o})})}function wc(r,e){const i=r.json.bufferViews[e.bufferView],o=Af[e.componentType];return new o(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==pd[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:pd[e.type]))}function Xp(r,e,i,o){const h=Af[e.componentType],a=function(m){switch(m){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),d=r.json.bufferViews[e.bufferView],_=d.byteStride?d.byteStride/h.BYTES_PER_ELEMENT:pd[e.type],w=i.float32,M=w.length/i.capacity;for(let m=0,E=0;m<e.count*_;m+=_,E+=M)for(let I=0;I<M;I++)w[E+I]=o[m+I]*a;i._trim()}function _x(r,e,i){const o=r.indices,h=r.attributes,a={};a.indexArray=new na;const d=e.json.accessors[o],_=d.count/3;a.indexArray.reserve(_);const w=wc(e,d);for(let I=0;I<_;I++)a.indexArray.emplaceBack(w[3*I],w[3*I+1],w[3*I+2]);a.indexArray._trim(),a.vertexArray=new _l;const M=e.json.accessors[h.POSITION];a.vertexArray.reserve(M.count);const m=wc(e,M);for(let I=0;I<M.count;I++)a.vertexArray.emplaceBack(m[3*I],m[3*I+1],m[3*I+2]);if(a.vertexArray._trim(),a.aabb=new Wn(M.min,M.max),a.centroid=function(I,b){const T=[0,0,0],A=I.length;if(A>0){for(let k=0;k<A;k++){const O=3*I[k];T[0]+=b[O],T[1]+=b[O+1],T[2]+=b[O+2]}T[0]/=A,T[1]/=A,T[2]/=A}return T}(w,m),h.COLOR_0!==void 0){const I=e.json.accessors[h.COLOR_0],b=pd[I.type],T=wc(e,I);a.colorArray=b===3?new _l:new cu,a.colorArray.resize(I.count),Xp(e,I,a.colorArray,T)}if(h.NORMAL!==void 0){a.normalArray=new _l;const I=e.json.accessors[h.NORMAL];a.normalArray.resize(I.count);const b=wc(e,I);Xp(e,I,a.normalArray,b)}if(h.TEXCOORD_0!==void 0&&i.length>0){a.texcoordArray=new Ou;const I=e.json.accessors[h.TEXCOORD_0];a.texcoordArray.resize(I.count);const b=wc(e,I);Xp(e,I,a.texcoordArray,b)}if(h._FEATURE_ID_RGBA4444!==void 0){const I=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(a.featureData=wc(e,I))}h._FEATURE_RGBA4444!==void 0&&(a.featureData=new Uint32Array(wc(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const E=r.material;return a.material=function(I,b){const{emissiveFactor:T=[0,0,0],alphaMode:A="OPAQUE",alphaCutoff:k=.5,normalTexture:O,occlusionTexture:U,emissiveTexture:G,doubleSided:B}=I,{baseColorFactor:H=[1,1,1,1],metallicFactor:$=1,roughnessFactor:ne=1,baseColorTexture:me,metallicRoughnessTexture:de}=I.pbrMetallicRoughness||{},ue=U?b[U.index]:void 0;if(U&&U.extensions&&U.extensions.KHR_texture_transform&&ue){const Fe=U.extensions.KHR_texture_transform;ue.offsetScale=[Fe.offset[0],Fe.offset[1],Fe.scale[0],Fe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new W(...H),metallicFactor:$,roughnessFactor:ne,baseColorTexture:me?b[me.index]:void 0,metallicRoughnessTexture:de?b[de.index]:void 0},doubleSided:B,emissiveFactor:T,alphaMode:A,alphaCutoff:k,normalTexture:O?b[O.index]:void 0,occlusionTexture:ue,emissionTexture:G?b[G.index]:void 0,defined:I.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},i),a}function my(r,e,i){const{matrix:o,rotation:h,translation:a,scale:d,mesh:_,extras:w,children:M}=r,m={};if(m.matrix=o||Pe.mat4.fromRotationTranslationScale([],h||[0,0,0,1],a||[0,0,0],d||[1,1,1]),_!==void 0){m.meshes=i[_];const E=m.anchor=[0,0];for(const I of m.meshes){const{min:b,max:T}=I.aabb;E[0]+=b[0]+T[0],E[1]+=b[1]+T[1]}E[0]=Math.floor(E[0]/m.meshes.length/2),E[1]=Math.floor(E[1]/m.meshes.length/2)}if(w&&(w.id&&(m.id=w.id),w.lights&&(m.lights=function(E){if(!E.length)return[];const I=function(O){const U=atob(O),G=new Uint8Array(U.length);for(let B=0;B<U.length;B++)G[B]=U.codePointAt(B);return G}(E),b=[],T=I.length/24,A=new Uint16Array(I.buffer),k=new Float32Array(I.buffer);for(let O=0;O<T;O++){const U=A[2*O*6]/30,G=A[2*O*6+1]/30,B=A[2*O*6+10]/100,H=k[6*O+1],$=k[6*O+2],ne=k[6*O+3],me=k[6*O+4],de=ne-H,ue=me-$,Fe=Math.hypot(de,ue);b.push({pos:[H+.5*de,$+.5*ue,G],normal:[ue/Fe,-de/Fe,0],width:Fe,height:U,depth:B,points:[H,$,ne,me]})}return b}(w.lights))),M){const E=[];for(const I of M)E.push(my(e.json.nodes[I],e,i));m.children=E}return m}function yx(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Wf(r.vertices,r.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:o}}function vx(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const d of i){if(!Array.isArray(d)||d.length!==2)continue;const _=d[0],w=d[1];typeof _=="number"&&typeof w=="number"&&o.push(new Xi(_,w))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let h=0;for(let d=0;d<o.length;d++){const _=o[d],w=o[(d+1)%o.length],M=o[(d+2)%o.length];h+=(_.x-w.x)*(M.y-w.y)-(M.x-w.x)*(_.y-w.y)}h>0&&o.reverse();const a=Fh(o.flatMap(d=>[d.x,d.y]),[]);return a.length===0?null:{vertices:o,indices:a}}function xx(r,e){const i=[],o=[];let h=0;const a=[];for(const d of r){h=i.length;const _=d.vertexArray.float32,w=d.indexArray.uint16;for(let M=0;M<d.vertexArray.length;M++)a[0]=_[3*M+0],a[1]=_[3*M+1],a[2]=_[3*M+2],Pe.vec3.transformMat4(a,a,e),i.push(new Xi(a[0],a[1]));for(let M=0;M<3*d.indexArray.length;M++)o.push(w[M]+h)}if(o.length%3!=0)return null;for(let d=0;d<o.length;d+=3){const _=i[o[d+0]],w=i[o[d+1]],M=i[o[d+2]];(_.x-w.x)*(M.y-w.y)-(M.x-w.x)*(_.y-w.y)>0&&([o[d+1],o[d+2]]=[o[d+2],o[d+1]])}return{vertices:i,indices:o}}function gy(r){const e=function(w,M){const m=[],E=WebGL2RenderingContext;if(w.json.textures)for(const I of w.json.textures){const b={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};I.sampler!==void 0&&Object.assign(b,w.json.samplers[I.sampler]),m.push({image:M[I.source],sampler:b,uploaded:!1})}return m}(r,r.images),i=function(w,M){const m=[];for(const E of w.json.meshes){const I=[];for(const b of E.primitives)I.push(_x(b,w,M));m.push(I)}return m}(r,e),{scenes:o,scene:h,nodes:a}=r.json,d=o?o[h||0].nodes:a,_=[];for(const w of d)_.push(my(a[w],r,i));return function(w,M,m){const E={},I=new Set;for(let b=0;b<w.length;b++){const T=m[M[b]];if(!T.extras)continue;const A=T.extras["mapbox:footprint:version"],k=T.extras["mapbox:footprint:id"];(A||k)&&I.add(b),A==="1.0.0"&&k&&(E[k]=b)}for(let b=0;b<w.length;b++){if(I.has(b))continue;const T=w[b],A=m[M[b]];if(!A.extras)continue;let k=null;T.id in E&&(k=xx(w[E[T.id]].meshes,T.matrix)),k||(k=vx(A)),k&&(T.footprint=yx(k))}if(I.size>0){const b=Array.from(I.values()).sort((T,A)=>T-A);for(let T=b.length-1;T>=0;T--)w.splice(b[T],1)}}(_,d,r.json.nodes),_}function bx(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,o=r.aabb.min[1]-1,h=vc/(r.aabb.max[0]-i+2),a=vc/(r.aabb.max[1]-o+2);for(let d=0;d<e.length;d+=3){const _=e[d+2],w=(e[d+0]-i)*h|0,M=(e[d+1]-o)*a|0;_>r.heightmap[M*vc+w]&&(r.heightmap[M*vc+w]=_)}}function wx(r,e){const i={};i.indexArray=new na,i.indexArray.reserve(4*r.length),i.vertexArray=new _l,i.vertexArray.reserve(10*r.length),i.colorArray=new cu,i.vertexArray.reserve(10*r.length);let o=0;for(const d of r){const _=Math.min(10,Math.max(4,1.3*d.height))*e,w=[-d.normal[1],d.normal[0],0],M=Math.min(.29,.1*d.width/d.depth),m=d.width-2*d.depth*e*(M+.01),E=Pe.vec3.scaleAndAdd([],d.pos,w,m/2),I=Pe.vec3.scaleAndAdd([],d.pos,w,-m/2),b=[E[0],E[1],E[2]+d.height],T=[I[0],I[1],I[2]+d.height],A=Pe.vec3.scaleAndAdd([],d.normal,w,M);Pe.vec3.scale(A,A,_);const k=Pe.vec3.scaleAndAdd([],d.normal,w,-M);Pe.vec3.scale(k,k,_),Pe.vec3.add(A,E,A),Pe.vec3.add(k,I,k),E[2]+=.1,I[2]+=.1,i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(b[0],b[1],b[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]);const O=m/_/2;i.colorArray.emplaceBack(-O-M,-1,O,.8),i.colorArray.emplaceBack(O+M,-1,O,.8),i.colorArray.emplaceBack(-O,0,O,1.3),i.colorArray.emplaceBack(O,0,O,1.3),i.colorArray.emplaceBack(O+M,-.8,O,.7),i.colorArray.emplaceBack(O+M,-.8,O,.7),i.colorArray.emplaceBack(0,0,O,1.3),i.colorArray.emplaceBack(0,0,O,1.3),i.colorArray.emplaceBack(O+M,-1.2,O,.8),i.colorArray.emplaceBack(O+M,-1.2,O,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const h={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=W.white,h.pbrMetallicRoughness=a,i.material=h,i.aabb=new Wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class _y{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Ex=["id","tile","layer","source","sourceLayer","state"];class ah{constructor(e,i,o,h,a){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=h,this.properties=e.properties,this.id=a}clone(){const e=new ah(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of Ex)this[i]!==void 0&&(e[i]=this[i]);return e}}class yy{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new zo(mn,16,0),this.featureIndexArray=new cc,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,h,a,d=0,_=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,a,d);const M=this.grid;for(let m=0;m<i.length;m++){const E=i[m],I=[1/0,1/0,-1/0,-1/0];for(let b=0;b<E.length;b++){const T=E[b];I[0]=Math.min(I[0],T.x),I[1]=Math.min(I[1],T.y),I[2]=Math.max(I[2],T.x),I[3]=Math.max(I[3],T.y)}_!==0&&(I[0]-=_,I[1]-=_,I[2]+=_,I[3]+=_),I[0]<mn&&I[1]<mn&&I[2]>=0&&I[3]>=0&&M.insert(w,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Xc.VectorTile(new Jd(this.rawTileData)).layers,this.sourceLayerCoder=new _y(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:h,tileTransform:a,pixelPosMatrix:d,availableImages:_}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const w=o.bufferedTilespaceBounds,M=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(b,T,A,k)=>He(o.bufferedTilespaceGeometry,b,T,A,k));M.sort(Tx);let m=null;h.elevation&&M.length>0&&(m=eh.create(h.elevation,this.tileID));const E={};let I;for(let b=0;b<M.length;b++){const T=M[b];if(T===I)continue;I=T;const A=this.featureIndexArray.get(T);let k=null;this.is3DTile?this.loadMatchingModelFeature(E,A,e,o,h):this.loadMatchingFeature(E,A,e,_,(O,U,G,B=0)=>(k||(k=R(O,this.tileID.canonical,a)),U.queryIntersectsFeature(o,O,G,k,this.z,h,d,m,B)))}return E}loadMatchingFeature(e,i,o,h,a){const{featureIndex:d,bucketIndex:_,sourceLayerIndex:w,layoutVertexArrayOffset:M}=i,m=this.bucketLayerIDs[_],E=o.layers,I=Object.keys(E);if(I.length&&!function(O,U){for(let G=0;G<O.length;G++)if(U.indexOf(O[G])>=0)return!0;return!1}(I,m))return;const b=o.sourceCache,T=this.sourceLayerCoder.decode(w),A=this.vtLayers[T].feature(d),k=this.getId(A,T);for(let O=0;O<m.length;O++){const U=m[O];if(!E[U])continue;const{styleLayer:G,targets:B}=E[U];let H={};k!==void 0&&(H=b.getFeatureState(G.sourceLayer,k));const $=!a||a(A,G,H,M);if(!$)continue;const ne=new ah(A,this.z,this.x,this.y,k);ne.tile=this.tileID.canonical,ne.state=H;let me=this.serializedLayersCache.get(U);me||(me=G.serialize(),me.id=U,this.serializedLayersCache.set(U,me)),ne.source=me.source,ne.sourceLayer=me["source-layer"],ne.layer=Dn({},me),ne.layer.paint=vy(me.paint,G.paint,A,H,h),ne.layer.layout=vy(me.layout,G.layout,A,H,h);let de=!1;for(const ue of B){this.updateFeatureProperties(ne,ue);const{filter:Fe}=ue;if(Fe){if(A.properties=ne.properties,Fe.needGeometry){const ye=z(A,!0);if(!Fe.filter(new Ws(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!Fe.filter(new Ws(this.tileID.overscaledZ),A))continue}de=!0,ue.targetId&&this.addFeatureVariant(ne,ue)}de&&this.appendToResult(e,U,d,ne,$)}}loadMatchingModelFeature(e,i,o,h,a){const d=this.bucketLayerIDs[0][0],_=o.layers;if(!_[d])return;const{styleLayer:w,targets:M}=_[d];if(w.type!=="model")return;const m=h.tile,E=i.featureIndex,I=m.getBucket(w);if(!(I&&I instanceof xf))return;const b=function(me,de,ue,Fe){const ye=me.getNodesInfo()[de];if(ye.hiddenByReplacement||!ye.node.meshes)return;let Ve=Number.MAX_VALUE;const $e=ye.node,Ze=ue.tile,Qe=Fe.calculatePosMatrix(Ze.tileID.toUnwrapped(),Fe.worldSize),ht=ye.evaluatedScale;let wt=0;Fe.elevation&&$e.elevation&&(wt=$e.elevation*Fe.elevation.exaggeration()),Pe.mat4.translate(Qe,Qe,[($e.anchor?$e.anchor[0]:0)*(ht[0]-1),($e.anchor?$e.anchor[1]:0)*(ht[1]-1),wt]),Pe.mat4.scale(Qe,Qe,ht);const st=ue.queryGeometry,Jt=st.isPointQuery()?st.screenBounds:st.screenGeometry,zi=function(wn){const _n=Pe.mat4.multiply([],Qe,wn.matrix);Pe.mat4.multiply(_n,Fe.expandedFarZProjMatrix,_n);for(let Wi=0;Wi<wn.meshes.length;++Wi){const Fi=wn.meshes[Wi];if(Wi===wn.lightMeshIndex)continue;const qn=__(Jt,Fe,_n,Fi.aabb);qn!=null&&(Ve=Math.min(qn,Ve))}if(wn.children)for(const Wi of wn.children)zi(Wi)};if(zi($e),Ve===Number.MAX_VALUE)return;const Kt=new as(0,0);return C_(Ze.tileID.canonical,Kt,ye.node.anchor[0],ye.node.anchor[1]),{intersectionZ:Ve,position:Kt,feature:ye.feature}}(I,E,h,a);if(!b)return;const{z:T,x:A,y:k}=m.tileID.canonical,{feature:O,intersectionZ:U,position:G}=b;let B={};O.id!==void 0&&(B=o.sourceCache.getFeatureState(w.sourceLayer,O.id));const H=new ah({},T,A,k,O.id);H.tile=this.tileID.canonical,H.state=B,H.properties=O.properties,H.geometry={type:"Point",coordinates:[G.lng,G.lat]};let $=this.serializedLayersCache.get(d);$||($=w.serialize(),$.id=d,this.serializedLayersCache.set(d,$)),H.source=$.source,H.sourceLayer=$["source-layer"],H.layer=Dn({},$);let ne=!1;for(const me of M){this.updateFeatureProperties(H,me);const{filter:de}=me;if(de){if(O.properties=H.properties,de.needGeometry){if(!de.filter(new Ws(this.tileID.overscaledZ),O,this.tileID.canonical))continue}else if(!de.filter(new Ws(this.tileID.overscaledZ),O))continue}ne=!0,me.targetId&&this.addFeatureVariant(H,me)}ne&&this.appendToResult(e,d,E,H,U)}updateFeatureProperties(e,i,o){if(i.properties){const h={};for(const a in i.properties){const d=i.properties[a].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);d!=null&&(h[a]=d)}e.properties=h}}addFeatureVariant(e,i,o){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(h)}appendToResult(e,i,o,h,a){let d=e[i];d===void 0&&(d=e[i]=[]),d.push({featureIndex:o,feature:h,intersectionZ:a})}lookupSymbolFeatures(e,i,o,h,a){const d={};this.loadVTLayers();for(const _ of e)this.loadMatchingFeature(d,{bucketIndex:i,sourceLayerIndex:o,featureIndex:_,layoutVertexArrayOffset:0},h,a);return d}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(o),a=this.vtFeatures[h];if(a[i])return a[i];const d=this.vtLayers[h].feature(i);return a[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const a=es(h);if(a.result!=="success"){const d=a.value.map(_=>`${_.key}: ${_.message}`).join(", ");return void ur(`Failed to create expression for promoteId: ${d}`)}this.promoteIdExpression=a.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new bt),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[h];typeof o=="boolean"&&(o=Number(o))}return o}}function vy(r,e,i,o,h){return Co(r,(a,d)=>{const _=e instanceof Pu?e.get(d):null;return _&&_.evaluate?_.evaluate(i,o,h):_})}function Tx(r,e){return e-r}on(yy,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const xy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $p{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const a=xy[15&o];if(!a)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new $p(_,d,a,e)}constructor(e,i=64,o=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const a=xy.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-_%8)%8;if(a<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+_+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+a]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Wp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:d,nodeSize:_}=this,w=[0,a.length-1,0],M=[];for(;w.length;){const m=w.pop()||0,E=w.pop()||0,I=w.pop()||0;if(E-I<=_){for(let k=I;k<=E;k++){const O=d[2*k],U=d[2*k+1];O>=e&&O<=o&&U>=i&&U<=h&&M.push(a[k])}continue}const b=I+E>>1,T=d[2*b],A=d[2*b+1];T>=e&&T<=o&&A>=i&&A<=h&&M.push(a[b]),(m===0?e<=T:i<=A)&&(w.push(I),w.push(b-1),w.push(1-m)),(m===0?o>=T:h>=A)&&(w.push(b+1),w.push(E),w.push(1-m))}return M}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:a,nodeSize:d}=this,_=[0,h.length-1,0],w=[],M=o*o;for(;_.length;){const m=_.pop()||0,E=_.pop()||0,I=_.pop()||0;if(E-I<=d){for(let k=I;k<=E;k++)wy(a[2*k],a[2*k+1],e,i)<=M&&w.push(h[k]);continue}const b=I+E>>1,T=a[2*b],A=a[2*b+1];wy(T,A,e,i)<=M&&w.push(h[b]),(m===0?e-o<=T:i-o<=A)&&(_.push(I),_.push(b-1),_.push(1-m)),(m===0?e+o>=T:i+o>=A)&&(_.push(b+1),_.push(E),_.push(1-m))}return w}}function Wp(r,e,i,o,h,a){if(h-o<=i)return;const d=o+h>>1;by(r,e,d,o,h,a),Wp(r,e,i,o,d-1,1-a),Wp(r,e,i,d+1,h,1-a)}function by(r,e,i,o,h,a){for(;h>o;){if(h-o>600){const M=h-o+1,m=i-o+1,E=Math.log(M),I=.5*Math.exp(2*E/3),b=.5*Math.sqrt(E*I*(M-I)/M)*(m-M/2<0?-1:1);by(r,e,i,Math.max(o,Math.floor(i-m*I/M+b)),Math.min(h,Math.floor(i+(M-m)*I/M+b)),a)}const d=e[2*i+a];let _=o,w=h;for(md(r,e,o,i),e[2*h+a]>d&&md(r,e,o,h);_<w;){for(md(r,e,_,w),_++,w--;e[2*_+a]<d;)_++;for(;e[2*w+a]>d;)w--}e[2*o+a]===d?md(r,e,o,w):(w++,md(r,e,w,h)),w<=i&&(o=w+1),i<=w&&(h=w-1)}}function md(r,e,i,o){Yp(r,i,o),Yp(e,2*i,2*o),Yp(e,2*i+1,2*o+1)}function Yp(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}function wy(r,e,i,o){const h=r-i,a=e-o;return h*h+a*a}s.$=mh,s.A=oi,s.B=2,s.C=Yh,s.D=th,s.E=sa,s.F=Og,s.G=class extends yf{},s.H=mt,s.I=Bp,s.J=Pn,s.K=xd,s.L=qi,s.M=Rt,s.N=Ni,s.O=er,s.P=Xi,s.Q=Lc,s.R=dr,s.S=fs,s.T=Sp,s.U=es,s.V=yf,s.W=Ds,s.X=uo,s.Y=os,s.Z=qt,s._=D,s.a=function(r){return Bn.API_CDN_URL_REGEX.test(r)},s.a$=ah,s.a0=ii,s.a1=gi,s.a2=function(r){const e=r.value;let i=[];if(!e)return i;const o=mt(e);return o!=="string"?(i=i.concat([new yf(r.key,e,`string expected, "${o}" found`)]),i):(v_(e,!0)||(i=i.concat([new yf(r.key,e,`invalid url "${e}"`)])),i)},s.a3=Ct,s.a4=Pc,s.a5=ro,s.a6=an,s.a7=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return pe(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Ye(r.x,e.x,i),y:Ye(r.y,e.y,i),z:Ye(r.z,e.z,i),azimuthal:Ye(r.azimuthal,e.azimuthal,i),polar:Ye(r.polar,e.polar,i)}}},s.a8=Ws,s.a9=Vr,s.aA=il,s.aB=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,o){const h=this.entries[r]=this.entries[r]||{callbacks:[]};if(h.result){const[a,d]=h.result;return this.scheduler?this.scheduler.add(()=>{o(a,d)},e):o(a,d),()=>{}}return h.callbacks.push(o),h.cancel||(h.cancel=i((a,d)=>{h.result=[a,d];for(const _ of h.callbacks)this.scheduler?this.scheduler.add(()=>{_(a,d)},e):_(a,d);setTimeout(()=>delete this.entries[r],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(a=>a!==o),h.callbacks.length||(h.cancel(),delete this.entries[r]))}}},s.aC=gl,s.aD=function(r,e,i){const o=JSON.stringify(r.request);return r.data&&(this.deduped.entries[o]={result:[null,r.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},h=>{const a=zs(r.request,(d,_,w,M)=>{d?h(d):_&&h(null,{vectorTile:i?void 0:new Xc.VectorTile(new Jd(_)),rawData:_,cacheControl:w,expires:M})});return()=>{a.cancel(),h()}},e)},s.aE=function(r){ut++,ut>se&&(r.getActor().send("enforceCacheSizeLimit",K),ut=0)},s.aF=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},s.aG=$i,s.aH=o_,s.aI=d_,s.aJ=s_,s.aK=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<r.length;o++){const h=document.createElement("source");Qs(r[o])||(i.crossOrigin="Anonymous"),h.src=r[o],i.appendChild(h)}return{cancel:()=>{}}},s.aL=ff,s.aM=function(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>py(e,0,r))},s.aN=gy,s.aO=class{constructor(r,e,i,o){this.id=r,this.position=e!=null?new as(e[0],e[1]):new as(0,0),this.orientation=i!=null?i:[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new Wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,e){if(Pe.mat4.multiply(r.matrix,e,r.matrix),r.meshes)for(const i of r.meshes){const o=Wn.applyTransformFast(i.aabb,r.matrix);this.aabb.encapsulate(o)}if(r.children)for(const i of r.children)this._applyTransformations(i,r.matrix)}computeBoundsAndApplyParent(){const r=Pe.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,r)}computeModelMatrix(r,e,i,o,h,a,d=!1){T_(this.matrix,this,r.transform,this.position,e,i,o,h,a,d)}upload(r){if(!this.uploaded){for(const e of this.nodes)Pp(e,r);for(const e of this.nodes)vf(e);this.uploaded=!0}}destroy(){for(const r of this.nodes)Lp(r)}},s.aP=fo,s.aQ=Qh,s.aR=Ia,s.aS=ra,s.aT=zl,s.aU=na,s.aV=Gn,s.aW=Ch,s.aX=hf,s.aY=function(){za.isLoading()||za.isLoaded()||Ac()!=="deferred"||Qu()},s.aZ=bd,s.a_=z,s.aa=n,s.ab=Pe,s.ac=Jr,s.ad=Pu,s.ae=ba,s.af=Ye,s.ag=mn,s.ah=Bt,s.ai=Sr,s.aj=W,s.ak=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([i,o]){const h=pe([1,i,o]);return{x:h.x,y:h.y,z:h.z}}(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Ye(r.x,e.x,i),y:Ye(r.y,e.y,i),z:Ye(r.z,e.z,i)}}},s.al=function(r,e,i=0,o=!0){const h=new Xi(i,i),a=r.sub(h),d=e.add(h),_=[a,new Xi(d.x,a.y),d,new Xi(a.x,d.y)];return o&&_.push(a.clone()),_},s.am=function(r,e){const i=[];for(let o=0;o<r.length;o++){const h=Pr(o-1,-1,r.length-1),a=Pr(o+1,-1,r.length-1),d=r[o],_=r[a],w=r[h].sub(d).unit(),M=_.sub(d).unit(),m=M.angleWithSep(w.x,w.y),E=w.add(M).unit().mult(-1*e/Math.sin(m/2));i.push(d.add(E))}return i},s.an=Hg,s.ao=He,s.ap=function(r,e,i=0){return Pe.vec3.fromValues(((e.x-i)*r.scale-r.x)*mn,(e.y*r.scale-r.y)*mn,Ud(e.z,e.y))},s.aq=Tr,s.ar=ug,s.as=function(r){let e=1/0,i=1/0,o=-1/0,h=-1/0;for(const a of r)e=Math.min(e,a.x),i=Math.min(i,a.y),o=Math.max(o,a.x),h=Math.max(h,a.y);return{min:new Xi(e,i),max:new Xi(o,h)}},s.at=xl,s.au=Me,s.av=p,s.aw=cn,s.ax=_a,s.ay=function(r,e){const i={};for(let o=0;o<e.length;o++){const h=e[o];h in r&&(i[h]=r[h])}return i},s.az=Ql,s.b=function(r){return Bn.API_FONTS_REGEX.test(r)},s.b$=gf,s.b0=ke,s.b1=rp,s.b2=$f,s.b3=R,s.b4=Dl,s.b5=Mh,s.b6=lr,s.b7=yo,s.b8=Fh,s.b9=wp,s.bA=Vm,s.bB=gp,s.bC=Vg,s.bD=fp,s.bE=$p,s.bF=Pr,s.bG=Vt,s.bH=ya,s.bI=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},s.bJ=gc,s.bK=Ha,s.bL=Du,s.bM=So,s.bN=pc,s.bO=as,s.bP=Yg,s.bQ=di,s.bR=ns,s.bS=p_,s.bT=Ri,s.bU=ha,s.bV=function(r,e,i,o,h,a,d,_,w){if(w.name==="globe")return ha(r,e,new Ri(i,o,h),!1);const M=Qh({z:i,x:o,y:h},w);return new Wn([(a+M.x/M.scale)*e,e*(M.y/M.scale),d],[(a+M.x2/M.scale)*e,e*(M.y2/M.scale),_])},s.bW=function(r,e,i){let o=0;for(let h=0;h<2;++h)r[h]>0&&(o+=(r[h]-0)*(r[h]-0)),e[h]<0&&(o+=(0-e[h])*(0-e[h]));return o},s.bX=vo,s.bY=Fd,s.bZ=function(r){const e=Pe.mat4.identity(new Float64Array(16));Pe.mat4.multiply(e,r.pixelMatrix,r.globeMatrix);const i=[0,Na,0],o=[0,Fa,0];return Pe.vec3.transformMat4(i,i,e),Pe.vec3.transformMat4(o,o,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!Xa(r,new as(r.center.lat,90)),o[0]>0&&o[0]<=r.width&&o[1]>0&&o[1]<=r.height&&!Xa(r,new as(r.center.lat,-90))]},s.b_=function(r,e){const{scale:i}=r.tileTransform,o=i*mn/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return Pe.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},s.ba=function(r,e){const i=ba(e.zoom);if(i===0)return Fo(r);const o=oo(r),h=js(o),a=xl(o.getWest())*e.worldSize,d=xl(o.getEast())*e.worldSize,_=il(o.getNorth())*e.worldSize,w=il(o.getSouth())*e.worldSize,M=[a,_,0],m=[d,_,0],E=[a,w,0],I=[d,w,0],b=Pe.mat4.invert([],e.globeMatrix);return Pe.vec3.transformMat4(M,M,b),Pe.vec3.transformMat4(m,m,b),Pe.vec3.transformMat4(E,E,b),Pe.vec3.transformMat4(I,I,b),h[0]=Bo(h[0],E,i),h[1]=Bo(h[1],I,i),h[2]=Bo(h[2],m,i),h[3]=Bo(h[3],M,i),Wn.fromPoints(h)},s.bb=$o,s.bc=Fs,s.bd=Bo,s.be=ku,s.bf=sr,s.bg=jp,s.bh=Jd,s.bi=zs,s.bj=function(r){const e=[];for(const i in r)e.push(r[i]);return e},s.bk=function(r,e){const i=[];for(const o in r)o in e||i.push(o);return i},s.bl=Ts,s.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bn=vs,s.bo=function(r,e){const{x:i,y:o}=r.point,h=Ma(i,o,r.worldSize/r._pixelsPerMercatorPixel,0,0);return Pe.mat4.multiply(h,h,Us(Fo(e)))},s.bp=$c,s.bq=nl,s.br=Kd,s.bs=function(r,e,i,o,h){const a=5*e+2;r.float32[a+0]=i,r.float32[a+1]=o,r.float32[a+2]=h},s.bt=cf,s.bu=kg,s.bv=X,s.bw=fa,s.bx=Dm,s.by=y_,s.bz=Um,s.c=hs,s.c$=(r,e,i,o,h,a,d,_)=>{const w=r.transform,M=w.pitch<15?cg(.07,.7,cn((14-w.zoom)/5,0,1)):.07,m=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:dg(r,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:a,u_floor_width_scale:d,u_image:0,u_tile_units_to_pixels:hg(e,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:_,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(m?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:t(e.tileID.canonical,0)}},s.c0=f_,s.c1=function(r){const e=f_(r,!0);return Pe.mat2.invert([],[e[0],e[1],e[4],e[5]])},s.c2=Yr,s.c3=function(r){const{x:e,y:i}=r.point,{lng:o,lat:h}=r._center;return Ma(e,i,r.worldSize,o,h)},s.c4=un,s.c5=dn,s.c6=zu,s.c7=function(r){const e=Math.round((r+45+360)%360/90)%4;return ys[e]},s.c8=45,s.c9=qc,s.cA=class extends vl{constructor(r){super(r),this.current=Lh}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.cB=Hs,s.cC=function(r,e,i){const o=ba(i.zoom),h=r.style.map._antialias,a=r.terrain&&r.terrain.exaggeration()>0;return o===0&&!h&&!a},s.cD=function(r){const e=r.pixelsPerMeter,i=e/ya(1,r.center.lat),o=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.translate(o,o,[r.point.x,r.point.y,0]),Pe.mat4.scale(o,o,[i,i,e]),Float32Array.from(o)},s.cE=oo,s.cF=function(r){const e=vo-5;r=cn(r,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Sr(r))),3);return Math.round(i*(jc.length-1))},s.cG=function(r,e,i,o){const h=e.getNorth(),a=e.getSouth(),d=e.getWest(),_=e.getEast(),w=1<<r.z,M=_-d,m=h-a,E=M/Nu,I=-m/jc[i],b=[0,E,0,I,0,0,h,d,0];if(r.z>0){const T=180/o;Pe.mat3.multiply(b,b,[T/M+1,0,0,0,T/m+1,0,-.5*T/E,.5*T/I,1])}return b[2]=w,b[5]=r.x,b[8]=r.y,b},s.cH=Fo,s.cI=function(r,e,i){const o=Pe.mat4.identity(new Float64Array(16)),h=(e/(1<<r)-.5)*Math.PI*2;return Pe.mat4.rotateY(o,i.globeMatrix,h),Float32Array.from(o)},s.cJ=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,h=Math.floor(r.x),a=Math.floor((r.x-h)*o),d=Math.floor(r.y*o),_=this.findDEMTileFor(new $i(i,h,i,a,d));return!(!_||!_.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||r.y<0||r.y>1)return e;const h=o.getSource().maxzoom,a=1<<h,d=Math.floor(r.x),_=r.x-d,w=new $i(h,d,h,Math.floor(_*a),Math.floor(r.y*a)),M=this.findDEMTileFor(w);if(!M||!M.dem)return e;const m=M.dem,E=1<<M.tileID.canonical.z,I=(_*E-M.tileID.canonical.x)*m.dim,b=(r.y*E-M.tileID.canonical.y)*m.dim,T=Math.floor(I),A=Math.floor(b);return(i?this.exaggeration():1)*Ye(Ye(m.get(T,A),m.get(T,A+1),b-A),Ye(m.get(T+1,A),m.get(T+1,A+1),b-A),I-T)}getAtTileOffset(r,e,i){const o=1<<r.canonical.z;return this.getAtPointOrZero(new n(r.wrap+(r.canonical.x+e/mn)/o,(r.canonical.y+i/mn)/o))}getAtTileOffsetFunc(r,e,i,o){return h=>{const a=this.getAtTileOffset(r,h.x,h.y),d=o.upVector(r.canonical,h.x,h.y),_=o.upVectorScale(r.canonical,e,i).metersToTile;return Pe.vec3.scale(d,d,a*_),d}}getForTilePoints(r,e,i,o){if(this.isUsingMockSource())return!1;const h=eh.create(this,r,o);return!!h&&(e.forEach(a=>{a[2]=this.exaggeration()*h.getElevationAt(a[0],a[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,h=1<<r.canonical.z-o.canonical.z;let a=r.canonical.x/h-o.canonical.x,d=r.canonical.y/h-o.canonical.y,_=0;for(let w=0;w<r.canonical.z-o.canonical.z&&!i.leaves[_];w++){a*=2,d*=2;const M=2*Math.floor(d)+Math.floor(a);_=i.childOffsets[_]+M,a%=1,d%=1}return{min:this.exaggeration()*i.minimums[_],max:this.exaggeration()*i.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const h of r){const a=this.getMinMaxForTile(h.tileID);a&&(i=Math.min(i,a.min),o=Math.max(o,a.max),e=!0)}return e?{min:i,max:o}:null}},s.cK=pm,s.cL=$r,s.cM=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},s.cN=Za,s.cO=Un,s.cP=en,s.cQ=256,s.cR=function(r,e){const i=[0,0,0],o=$o(Fo(e.canonical));return Pe.vec3.transformMat4(i,i,o),Pe.vec3.transformMat4(i,i,r),i},s.cS=r=>({u_camera_to_center_distance:new So(r),u_extrude_scale:new Rh(r),u_device_pixel_ratio:new So(r),u_matrix:new gc(r),u_inv_rot_matrix:new gc(r),u_merc_center:new Ha(r),u_tile_id:new Du(r),u_zoom_transition:new So(r),u_up_dir:new Du(r),u_emissive_strength:new So(r)}),s.cT=r=>({u_matrix:new gc(r),u_pixels_to_tile_units:new Rh(r),u_device_pixel_ratio:new So(r),u_width_scale:new So(r),u_floor_width_scale:new So(r),u_units_to_pixels:new Ha(r),u_dash_image:new pc(r),u_gradient_image:new pc(r),u_image_height:new So(r),u_texsize:new Ha(r),u_tile_units_to_pixels:new So(r),u_alpha_discard_threshold:new So(r),u_trim_offset:new Ha(r),u_trim_fade_range:new Ha(r),u_trim_color:new mc(r),u_emissive_strength:new So(r),u_zbias_factor:new So(r),u_tile_to_meter:new So(r)}),s.cU=r=>({u_matrix:new gc(r),u_texsize:new Ha(r),u_pixels_to_tile_units:new Rh(r),u_device_pixel_ratio:new So(r),u_width_scale:new So(r),u_floor_width_scale:new So(r),u_image:new pc(r),u_units_to_pixels:new Ha(r),u_tile_units_to_pixels:new So(r),u_alpha_discard_threshold:new So(r),u_trim_offset:new Ha(r),u_trim_fade_range:new Ha(r),u_trim_color:new mc(r),u_emissive_strength:new So(r),u_zbias_factor:new So(r),u_tile_to_meter:new So(r)}),s.cV=wh,s.cW=A0,s.cX=C0,s.cY=Uu,s.cZ=(r,e,i,o,h,a)=>{const d=r.transform,_=d.projection.name==="globe";let w;if(a.paint.get("circle-pitch-alignment")==="map")if(_){const m=Za(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;w=Float32Array.from([m,0,0,m])}else w=d.calculatePixelsToTileUnitsMatrix(i);else w=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(d.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ee.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:_u,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:a.paint.get("circle-emissive-strength")};if(_){M.u_inv_rot_matrix=o,M.u_merc_center=h,M.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],M.u_zoom_transition=ba(d.zoom);const m=h[0]*mn,E=h[1]*mn;M.u_up_dir=d.projection.upVector(new Ri(0,0,0),m,E)}return M},s.c_=fg,s.ca=mc,s.cb=function(r,e,i){const o=Math.sqrt(r*r+e*e+i*i),h=o>0?Math.acos(i/o)*Xs:0;let a=r!==0||e!==0?Math.atan2(-e,-r)*Xs+90:0;return a<0&&(a+=360),[o,a,h]},s.cc=t,s.cd=Wn,s.ce=pe,s.cf=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},s.cg=function(r,e){return r.readFields(xv,{icons:[]},e)},s.ch=function(r){return r({pluginStatus:Ta,pluginURL:Xl}),Mu.on("pluginStateChange",r),r},s.ci=bf,s.cj=Yc,s.ck=pp,s.cl=Hr,s.cm=dh,s.cn=Ce,s.co=bo,s.cp=Ss,s.cq=function(r){const e=r.indexOf(kc);return e>=0?r.slice(0,e):r},s.cr=function(r){return r.indexOf(kc)>=0},s.cs=function(r){const e=r.indexOf(kc);return e>=0?r.slice(e+1):""},s.ct=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.cu=function(r,e,i,o){return r.type==="custom"?new ov(r,e):new _v[r.type](r,e,i,o)},s.cv=mr,s.cw=class extends ah{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},s.cx=Mu,s.cy=Mr,s.cz=Dd,s.d=function(r){return Bn.API_TILEJSON_REGEX.test(r)},s.d$=yy,s.d0=(r,e,i,o,h,a,d,_,w)=>{const M=r.transform,m=M.calculatePixelsToTileUnitsMatrix(e),E=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",I=M.pitch<15?cg(.07,.7,cn((14-M.zoom)/5,0,1)):.07;return{u_matrix:dg(r,e,i,o),u_pixels_to_tile_units:m,u_device_pixel_ratio:a,u_width_scale:d,u_floor_width_scale:_,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:pg(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:hg(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(E?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:t(e.tileID.canonical,0)}},s.d1=Ir,s.d2=Nh,s.d3=eg,s.d4=Cn,s.d5=Yd,s.d6=Gu,s.d7=450,s.d8=7,s.d9=sv,s.dA=Rs,s.dB=l,s.dC=pu,s.dD=function([r,e,i]){const o=Math.hypot(r,e,i),h=Math.atan2(r,i),a=.5*Math.PI-Math.acos(-e/o);return new as(un(h),un(a))},s.dE=Mp,s.dF=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(i){if(ui==null){const o=i.navigator?i.navigator.userAgent:null;ui=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return ui}(r)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dG=function(r,e){K=r,se=e},s.dH=Xa,s.dI=bl,s.dJ=function(r){const e=[0,0,0],i=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.multiply(i,r.pixelMatrix,r.globeMatrix),Pe.vec3.transformMat4(e,e,i),new Xi(e[0],e[1])},s.dK=function(r,e,i=!1){if(Ta===Ju||Ta===Mc||Ta===hh)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xl=Ee.resolveURL(r),Ta=Ju,ml=e,fh(),i||Qu()},s.dL=Ac,s.dM=function(){bf().acquire(kp)},s.dN=function(){const r=ad;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(kp),ad=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dO=bc,s.dP=function(r){const e=it();if(!e)return;const i=e.delete(Y);r&&i.catch(r).then(()=>r())},s.dQ=od,s.dR=ay,s.dS=function(r){qp=Ee.resolveURL(r),oh||(oh=new th(bf(),new sa)),oh.broadcast("setDracoUrl",qp)},s.dT=ly,s.dU=function(r){sh=Ee.resolveURL(r),oh||(oh=new th(bf(),new sa)),oh.broadcast("setMeshoptUrl",sh)},s.dV=on,s.dW=Vu,s.dX=Bl,s.dY=Xc,s.dZ=class{constructor(r,e){this.pos=r,this.dir=e}intersectsPlane(r,e,i){const o=Pe.vec2.dot(e,this.dir);if(Math.abs(o)<1e-6)return!1;const h=((r[0]-this.pos[0])*e[0]+(r[1]-this.pos[1])*e[1])/o;return i[0]=this.pos[0]+this.dir[0]*h,i[1]=this.pos[1]+this.dir[1]*h,!0}},s.d_=_y,s.da=gs,s.db=Ah,s.dc=256,s.dd=Us,s.de=_l,s.df=Yl,s.dg=Nc,s.dh=function(r,e,i,o,h){return cn((r-e)/(i-e)*(h-o)+o,o,h)},s.di=Ll,s.dj=Bu,s.dk=class{constructor(r,e,i,o){this.context=r,this.format=o,this.size=i,this.texture=r.gl.createTexture();const[h,a,d]=this.size,{gl:_}=r;_.bindTexture(_.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),_.texImage3D(_.TEXTURE_3D,0,this.format,h,a,d,0,Ep(this.format),Tp(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),r!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,r),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},s.dl=Ap,s.dm=[1,1,1],s.dn=eh,s.dp=Qc,s.dq=Wl,s.dr=Ou,s.ds=mu,s.dt=Fc,s.du=yl,s.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Xi(1/0,1/0),max:new Xi(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=Nm(new Xi(0,0),new Xi(mn,mn),r),o=[];if(e&&!Qf(i,this._globalClipBounds))return o;for(const h of this._activeRegions){if(h.hiddenByOverlap||!Qf(i,h))continue;const a=t0(h.min,h.max,r);o.push({min:a.min,max:a.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return o}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(o).buckets[e.layer];h&&h.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),o=r.getClipMask(),h=r.getClipScope();for(const a of e){if(!a.footprint)continue;const d=Nm(a.footprint.min,a.footprint.max,a.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:a.id,footprint:a.footprint,order:i,clipMask:o,clipScope:h})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||$d(e.min,i.min)||$d(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,h){const a=(d,_)=>d+_;return o.length-h.length||o.reduce(a,"").localeCompare(h.reduce(a,""))}(e.clipScope,i.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];r=i.priority!==o.priority||!zm(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!vs(i.clipScope,o.clipScope),++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==Xd&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const h=o[i].priority;for(;i<o.length&&o[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let h=i;const a=i;for(;h!==o;){const d=this._activeRegions[h];d.hiddenByOverlap=!1;for(let _=0;_<a;_++){const w=this._activeRegions[_];if(!w.hiddenByOverlap&&d.order===Xd&&Qf(d,w)&&(d.hiddenByOverlap=Bm(d.footprint,d.tileId,w.footprint,w.tileId),d.hiddenByOverlap))break}++h}i=o,o=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},s.dw=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new Dl,o=new na,h=[],a=r+1+2,d=e[0]+1,_=e[0]+1+(1+e.length),w=(M,m,E)=>{let I=M===a-1?M-2:M===0?M:M-1;return I+=E?24575:0,[I,m]};for(let M=0;M<a;++M)i.emplaceBack(...w(M,0,!0));for(let M=0;M<d;++M)for(let m=0;m<a;++m)i.emplaceBack(...w(m,M,(m===0||m===a-1)&&!0));for(let M=0;M<e.length;++M){const m=e[M];for(let E=0;E<a;++E)i.emplaceBack(...w(E,m,!0))}for(let M=0;M<e.length;++M){const m=o.length,E=e[M]+1+2,I=new na;for(let A=0;A<E-1;A++){const k=A===E-2,O=k?a*(_-e.length+M-A):a;for(let U=0;U<a-1;U++){const G=A*a+U;A===0||k||U===0||U===a-2?(I.emplaceBack(G+1,G,G+O),I.emplaceBack(G+O,G+O+1,G+1)):(o.emplaceBack(G+1,G,G+O),o.emplaceBack(G+O,G+O+1,G+1))}}const b=yo.simpleSegment(0,m,i.length,o.length-m);for(let A=0;A<I.uint16.length;A+=3)o.emplaceBack(I.uint16[A],I.uint16[A+1],I.uint16[A+2]);const T=yo.simpleSegment(0,m,i.length,o.length-m);h.push({withoutSkirts:b,withSkirts:T})}return{vertices:i,indices:o,segments:h}}_createGrid(r){const e=this._fillGridMeshWithLods(Nu,jc);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,lr.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new na;for(let d=0;d<=Nu;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new Yl,o=new Yl,h=new Yl,a=new Yl;this._poleSegments=[];for(let d=0,_=0;d<zu;d++){const w=360/(1<<d);i.emplaceBack(0,-_a,0,.5,0),o.emplaceBack(0,-_a,0,.5,1),h.emplaceBack(0,-_a,0,.5,.5),a.emplaceBack(0,-_a,0,.5,.5);for(let M=0;M<=Nu;M++){let m=M/Nu,E=0;const I=Ye(0,w,m),[b,T,A]=Fu(gu,wl,I,_a);i.emplaceBack(b,T,A,m,E),o.emplaceBack(b,T,A,m,1-E);const k=Sr(I);m=.5+.5*Math.sin(k),E=.5+.5*Math.cos(k),h.emplaceBack(b,T,A,m,E),a.emplaceBack(b,T,A,m,1-E)}this._poleSegments.push(yo.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,xr,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(o,xr,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(h,xr,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(a,xr,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},s.dx=Xd,s.dy=ls,s.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.e=Bn,s.e0=og,s.e1=Co,s.e2=ci,s.e3=Dg,s.e4=function(r,e,i,o,h,a,d,_,w,M,m=1,E,I){r.createArrays(),r.tilePixelRatio=mn/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const b=r.layers[0].layout,T=r.layers[0]._unevaluatedLayout._values,A={};A.scaleFactor=m,A.textSizeScaleRange=b.get("text-size-scale-range"),A.iconSizeScaleRange=b.get("icon-size-scale-range");const[k,O]=A.textSizeScaleRange,[U,G]=A.iconSizeScaleRange;if(A.textScaleFactor=cn(A.scaleFactor,k,O),A.iconScaleFactor=cn(A.scaleFactor,U,G),r.textSizeData.kind==="composite"){const{minZoom:ne,maxZoom:me}=r.textSizeData;A.compositeTextSizes=[T["text-size"].possiblyEvaluate(new Ws(ne),_),T["text-size"].possiblyEvaluate(new Ws(me),_)]}if(r.iconSizeData.kind==="composite"){const{minZoom:ne,maxZoom:me}=r.iconSizeData;A.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new Ws(ne),_),T["icon-size"].possiblyEvaluate(new Ws(me),_)]}A.layoutTextSize=T["text-size"].possiblyEvaluate(new Ws(w+1),_),A.layoutIconSize=T["icon-size"].possiblyEvaluate(new Ws(w+1),_),A.textMaxSize=T["text-size"].possiblyEvaluate(new Ws(18),_);const B=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point",H=b.get("text-size");let $=!1;for(const ne of r.features)if(ne.icon&&ne.icon.nameSecondary){$=!0;break}for(const ne of r.features){const me=b.get("text-font").evaluate(ne,{},_).join(","),de=H.evaluate(ne,{},_)*A.textScaleFactor,ue=A.layoutTextSize.evaluate(ne,{},_)*A.textScaleFactor,Fe=(A.layoutIconSize.evaluate(ne,{},_),{horizontal:{},vertical:void 0}),ye=ne.text;let Ve,$e=[0,0];if(ye){const ht=ye.toString(),wt=b.get("text-letter-spacing").evaluate(ne,{},_)*fa,st=b.get("text-line-height").evaluate(ne,{},_)*fa,Jt=Rl(ht)?wt:0,zi=b.get("text-anchor").evaluate(ne,{},_),Kt=b.get("text-variable-anchor");if(!Kt){const qn=b.get("text-radial-offset").evaluate(ne,{},_);$e=qn?Vg(zi,[qn*fa,mp]):b.get("text-offset").evaluate(ne,{},_).map(En=>En*fa)}let wn=B?"center":b.get("text-justify").evaluate(ne,{},_);const _n=b.get("symbol-placement")==="point",Wi=_n?b.get("text-max-width").evaluate(ne,{},_)*fa:1/0,Fi=qn=>{r.allowVerticalPlacement&&Da(ht)&&(Fe.vertical=dp(ye,e,i,h,me,Wi,st,zi,qn,Jt,$e,nl.vertical,!0,ue,de))};if(!B&&Kt){const qn=wn==="auto"?Kt.map(kn=>gp(kn)):[wn];let En=!1;for(let kn=0;kn<qn.length;kn++){const wr=qn[kn];if(!Fe.horizontal[wr])if(En)Fe.horizontal[wr]=Fe.horizontal[0];else{const zr=dp(ye,e,i,h,me,Wi,st,"center",wr,Jt,$e,nl.horizontal,!1,ue,de);zr&&(Fe.horizontal[wr]=zr,En=zr.positionedLines.length===1)}}Fi("left")}else{if(wn==="auto"&&(wn=gp(zi)),_n||b.get("text-writing-mode").indexOf("horizontal")>=0||!Da(ht)){const qn=dp(ye,e,i,h,me,Wi,st,zi,wn,Jt,$e,nl.horizontal,!1,ue,de);qn&&(Fe.horizontal[wn]=qn)}Fi(_n?"left":wn)}}let Ze=!1;if(ne.icon&&ne.icon.namePrimary){const ht=ap(r.iconSizeData,T["icon-size"],_,r.zoom,ne)*A.iconScaleFactor*E,wt=ne.icon.getPrimary().scaleSelf(ht).serialize(),st=o[wt];st&&(Ve=B0(h[wt],ne.icon.nameSecondary?h[ne.icon.getSecondary().scaleSelf(ht).serialize()]:void 0,b.get("icon-offset").evaluate(ne,{},_),b.get("icon-anchor").evaluate(ne,{},_)),Ze=st.sdf,r.sdfIcons===void 0?r.sdfIcons=st.sdf:r.sdfIcons!==st.sdf&&ur("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==r.pixelRatio||b.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const Qe=jg(Fe.horizontal)||Fe.vertical;r.iconsInText||(r.iconsInText=!!Qe&&Qe.iconsInText),(Qe||Ve)&&Z0(r,ne,Fe,Ve,o,A,ue,0,$e,Ze,d,_,M,I,$)}a&&r.generateCollisionDebugBuffers(w,r.collisionBoxArray,A.textScaleFactor)},s.e5=Mf,s.e6=cs,s.e7=Lm,s.e8=xg,s.e9=xn,s.ea=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==cy){const i=new Uint32Array(r,0,7),[,,o,h,a,d]=i;e=i.byteLength+h+a+d+a,(o!==r.byteLength||e>=r.byteLength)&&ur("Invalid b3dm header information.")}return py(r,e)},s.eb=function(r,e){const i=gy(r);for(const o of i){for(const h of o.meshes)bx(h);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(wx(o.lights,e)))}return i},s.ec=xf,s.ed=P_,s.ee=za,s.ef=function(r){Ne(),ce!=null&&ce.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-r;o++)e.delete(i[o])})})},s.f=function(r){return r.indexOf("mapbox:")===0},s.g=function(r,e){return Mr(Dn(r,{method:"GET"}),e)},s.h=Or,s.i=function(r){return Bn.API_STYLE_REGEX.test(r)&&!hs(r)},s.j=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},s.l=Dn,s.m=Et,s.n=function(r,e){return Mr(Dn(r,{type:"json"}),e)},s.o=rs,s.p=function(r,e){return Mr(Dn(r,{method:"POST"}),e)},s.q=Ee,s.r=aa,s.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}},s.t=oe,s.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},s.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},s.w=ur,s.x=function(){return Op||(Op=new bc),Op},s.y=wo,s.z=Oo}),Pi(["./shared"],function(s){function xn(gt){const q=gt?gt.url.toString():void 0;return q?performance.getEntriesByName(q):[]}function tn(gt){if(typeof gt=="number"||typeof gt=="boolean"||typeof gt=="string"||gt==null)return JSON.stringify(gt);if(Array.isArray(gt)){let ee="[";for(const oe of gt)ee+=`${tn(oe)},`;return`${ee}]`}let q="{";for(const ee of Object.keys(gt).sort())q+=`${ee}:${tn(gt[ee])},`;return`${q}}`}function ti(gt){let q="";for(const ee of s.bm)(gt.type!=="model"||ee!=="minzoom"&&ee!=="maxzoom")&&(q+=`/${tn(gt[ee])}`);return q}class $t{constructor(q){this.keyCache={},this._layers={},this._layerConfigs={},q&&this.replace(q)}replace(q,ee){this._layerConfigs={},this._layers={},this.update(q,[],ee)}update(q,ee,oe){this._options=oe;for(const be of q)this._layerConfigs[be.id]=be,(this._layers[be.id]=s.cu(be,this.scope,null,this._options)).compileFilter(oe),this.keyCache[be.id]&&delete this.keyCache[be.id];for(const be of ee)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const Ee=function(be,Ce){const Y={};for(let se=0;se<be.length;se++){const fe=be[se];let ce=Ce&&Ce[fe.id];!ce&&(ce=ti(fe),fe.type==="line"&&fe.paint)&&function it(Ne){return typeof Ne=="string"&&Ne==="line-progress"||(Array.isArray(Ne)?Ne.some(it):!(!Ne||typeof Ne!="object")&&Object.values(Ne).some(it))}(fe.paint["line-width"])&&(ce+=`/${tn(fe.paint["line-width"])}`),Ce&&(Ce[fe.id]=ce);let Se=Y[ce];Se||(Se=Y[ce]=[]),Se.push(fe)}const K=[];for(const se in Y)K.push(Y[se]);return K}(s.bj(this._layerConfigs),this.keyCache);for(const be of Ee){const Ce=be.map(Se=>this._layers[Se.id]),Y=Ce[0];if(Y.visibility==="none")continue;const K=Y.source||"";let se=this.familiesBySource[K];se||(se=this.familiesBySource[K]={});const fe=Y.sourceLayer||"_geojsonTileLayer";let ce=se[fe];ce||(ce=se[fe]=[]),ce.push(Ce)}}}const et=1*s.dX;class yi{constructor(q){const ee={},oe=[];for(const Y in q){const K=q[Y],se=ee[Y]={};for(const fe in K.glyphs){const ce=K.glyphs[+fe];if(!ce||ce.bitmap.width===0||ce.bitmap.height===0)continue;const Se=ce.metrics.localGlyph?et:1,it={x:0,y:0,w:ce.bitmap.width+2*Se,h:ce.bitmap.height+2*Se};oe.push(it),se[fe]=it}}const{w:Ee,h:be}=s.F(oe),Ce=new s.dW({width:Ee||1,height:be||1});for(const Y in q){const K=q[Y];for(const se in K.glyphs){const fe=K.glyphs[+se];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const ce=ee[Y][se],Se=fe.metrics.localGlyph?et:1;s.dW.copy(fe.bitmap,Ce,{x:0,y:0},{x:ce.x+Se,y:ce.y+Se},fe.bitmap)}}this.image=Ce,this.positions=ee}}s.dV(yi,"GlyphAtlas");const ct="3d_elevation_id",Qt="hd_road_elevation";class Ii{constructor(){this._valid=!1}reset(q){return this.feature=q,this._valid=!0,this._geometry=q.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(q,ee){return this._valid&&q(ee(this._geometry)),this}require(q,ee,oe){return this.get(q,!0,ee,oe)}optional(q,ee,oe){return this.get(q,!1,ee,oe)}success(){return this._valid}get(q,ee,oe,Ee){const be=this.feature.properties.hasOwnProperty(q)?+this.feature.properties[q]:void 0;return this._valid&&be!==void 0?oe(Ee?Ee(be):be):ee&&(this._valid=!1),this}}class Yi{constructor(q,ee){this.featureFunc=q,this.vertexFunc=ee}parseFeature(q,ee,oe){return this.featureFunc(q,ee,oe)}parseVertex(q,ee,oe){return this.vertexFunc(q,ee,oe)}}const We=new Yi((gt,q,ee)=>gt.reset(q).require(ct,oe=>{ee.id=oe}).optional("fixed_height_relative",oe=>{ee.constantHeight=oe},dt.decodeRelativeHeight).geometry(oe=>{ee.bounds=oe},dt.computeBounds).success(),(gt,q,ee)=>gt.reset(q).require(ct,oe=>{ee.id=oe}).require("elevation_idx",oe=>{ee.idx=oe}).require("extent",oe=>{ee.extent=oe}).require("height_relative",oe=>{ee.height=oe},dt.decodeRelativeHeight).geometry(oe=>{ee.position=oe},dt.getPoint).success()),ot=new Yi((gt,q,ee)=>gt.reset(q).require(ct,oe=>{ee.id=oe}).optional("fixed_height",oe=>{ee.constantHeight=oe},dt.decodeMetricHeight).geometry(oe=>{ee.bounds=oe},dt.computeBounds).success(),(gt,q,ee)=>gt.reset(q).require(ct,oe=>{ee.id=oe}).require("elevation_idx",oe=>{ee.idx=oe}).require("extent",oe=>{ee.extent=oe}).require("height",oe=>{ee.height=oe},dt.decodeMetricHeight).geometry(oe=>{ee.position=oe},dt.getPoint).success());class dt{static computeBounds(q){const ee=new s.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),oe=new s.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const Ee of q[0])ee.x>Ee.x&&(ee.x=Ee.x),ee.y>Ee.y&&(ee.y=Ee.y),oe.x<Ee.x&&(oe.x=Ee.x),oe.y<Ee.y&&(oe.y=Ee.y);return{min:ee,max:oe}}static getPoint(q){return s.ab.vec2.fromValues(q[0][0].x,q[0][0].y)}static decodeRelativeHeight(q){return 1e-4*q*5}static decodeMetricHeight(q){return 1e-4*q}static parse(q){const ee=[],oe=[],Ee=q.length,be=new Ii;for(let Y=0;Y<Ee;Y++){const K=q.feature(Y),se=K.properties.hasOwnProperty("version")?String(K.properties.version):void 0,fe=(Ce=se)?Ce==="1.0.1"?ot:void 0:We;if(fe===void 0){s.w(`Unknown elevation feature version number ${se||"(unknown)"}`);continue}const ce=K.properties.hasOwnProperty("type")?K.properties.type:void 0;if(ce){if(s.dY.VectorTileFeature.types[K.type]==="Point"&&ce==="curve_point"){const Se={};fe.parseVertex(be,K,Se)&&ee.push(Se)}else if(s.dY.VectorTileFeature.types[K.type]==="Polygon"&&ce==="curve_meta"){const Se={};fe.parseFeature(be,K,Se)&&oe.push(Se)}}}var Ce;return{vertices:ee,features:oe}}}class vt{constructor(q,ee,oe,Ee,be,Ce){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=q,this.heightRange={min:oe,max:oe},this.safeArea=ee,this.constantHeight=oe,this.constantHeight==null&&(this.constantHeight!=null||Ee.length!==0)){this.vertices=Ee,this.edges=be,this.edges=this.edges.filter(Y=>Y.a<this.vertices.length&&Y.b<this.vertices.length&&!s.ab.vec2.exactEquals(this.vertices[Y.a].position,this.vertices[Y.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const Y of this.vertices)this.vertexProps.push({dir:s.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,Y.height),this.heightRange.max=Math.max(this.heightRange.max,Y.height);for(const Y of this.edges){const K=this.vertices[Y.a].position,se=this.vertices[Y.b].position,fe=s.ab.vec2.subtract(s.ab.vec2.create(),se,K),ce=s.ab.vec2.length(fe),Se=s.ab.vec2.scale(s.ab.vec2.create(),fe,1/ce);this.edgeProps.push({vec:fe,dir:Se,len:ce});const it=this.vertexProps[Y.a].dir,Ne=this.vertexProps[Y.b].dir;s.ab.vec2.add(it,it,Se),s.ab.vec2.add(Ne,Ne,Se)}for(const Y of this.vertexProps)Y.dir[0]===0&&Y.dir[1]===0||s.ab.vec2.normalize(Y.dir,Y.dir);this.tessellate(Ce)}}pointElevation(q){if(this.constantHeight!=null)return this.constantHeight;const ee=this.getClosestEdge(q);if(ee==null)return 0;const[oe,Ee]=ee;return(1-(be=Ee))*this.vertices[this.edges[oe].a].height+be*this.vertices[this.edges[oe].b].height;var be}getClosestEdge(q){if(this.edges.length===0)return;let ee=0,oe=Number.POSITIVE_INFINITY,Ee=0;const be=s.ab.vec2.fromValues(q.x,q.y);for(let Ce=0;Ce<this.edges.length;Ce++){const Y=this.edges[Ce],K=this.edgeProps[Ce].dir,se=new s.dZ(be,this.edgeProps[Ce].dir),fe=this.vertices[Y.a].position,ce=this.vertices[Y.b].position,Se=s.ab.vec2.create(),it=s.ab.vec2.create(),Ne=se.intersectsPlane(fe,this.vertexProps[Y.a].dir,Se),ut=se.intersectsPlane(ce,this.vertexProps[Y.b].dir,it);if(!Ne||!ut)continue;const Et=s.ab.vec2.subtract(s.ab.vec2.create(),it,Se),xt=s.ab.vec2.subtract(s.ab.vec2.create(),be,Se),Xt=s.ab.vec2.dot(Et,Et),vn=Xt>0?s.ab.vec2.dot(xt,Et)/Xt:0,nn=s.aw(vn,0,1),Tn=Math.abs((vn-nn)*this.edgeProps[Ce].len),Kn=s.ab.vec2.subtract(s.ab.vec2.create(),be,fe),dr=Tn+Math.abs(s.ab.vec2.dot(Kn,s.ab.vec2.fromValues(K[1],-K[0])));dr<oe&&(ee=Ce,oe=dr,Ee=nn)}return[ee,Ee]}tessellate(q){for(let ee=this.edges.length-1;ee>=0;--ee){const oe=this.edges[ee].a,Ee=this.edges[ee].b,{position:be,height:Ce,extent:Y}=this.vertices[oe],{position:K,height:se,extent:fe}=this.vertices[Ee],ce=this.vertexProps[oe].dir,Se=this.vertexProps[Ee].dir,it=s.ab.vec3.fromValues(be[0]/q,be[1]/q,Ce),Ne=s.ab.vec3.fromValues(K[0]/q,K[1]/q,se),ut=s.ab.vec3.fromValues(ce[1],-ce[0],0);s.ab.vec3.scale(ut,ut,Y);const Et=s.ab.vec3.fromValues(Se[1],-Se[0],0);if(s.ab.vec3.scale(Et,Et,fe),this.distSqLines(s.ab.vec3.fromValues(it[0]+.5*ut[0],it[1]+.5*ut[1],it[2]+.5*ut[2]),s.ab.vec3.fromValues(Ne[0]-.5*Et[0],Ne[1]-.5*Et[1],Ne[2]-.5*Et[2]),s.ab.vec3.fromValues(it[0]-.5*ut[0],it[1]-.5*ut[1],it[2]-.5*ut[2]),s.ab.vec3.fromValues(Ne[0]+.5*Et[0],Ne[1]+.5*Et[1],Ne[2]+.5*Et[2]))<=.05*.05)continue;const xt=this.vertices.length,Xt=s.ab.vec2.add(s.ab.vec2.create(),be,K);this.vertices.push({position:s.ab.vec2.scale(Xt,Xt,.5),height:.5*(Ce+se),extent:.5*(Y+fe)});const vn=s.ab.vec2.add(s.ab.vec2.create(),ce,Se);this.vertexProps.push({dir:s.ab.vec2.normalize(vn,vn)}),this.edges.splice(ee,1),this.edgeProps.splice(ee,1),this.edges.push({a:oe,b:xt}),this.edges.push({a:xt,b:Ee});const nn=s.ab.vec2.subtract(s.ab.vec2.create(),this.vertices[xt].position,be),Tn=s.ab.vec2.length(nn),Kn={vec:nn,dir:s.ab.vec2.scale(s.ab.vec2.create(),nn,1/Tn),len:Tn};this.edgeProps.push(Kn),this.edgeProps.push(Kn)}}distSqLines(q,ee,oe,Ee){const be=s.ab.vec3.subtract(s.ab.vec3.create(),ee,q),Ce=s.ab.vec3.subtract(s.ab.vec3.create(),Ee,oe),Y=s.ab.vec3.subtract(s.ab.vec3.create(),q,oe),K=s.ab.vec3.dot(be,be),se=s.ab.vec3.dot(be,Ce),fe=s.ab.vec3.dot(be,Y),ce=s.ab.vec3.dot(Ce,Ce),Se=s.ab.vec3.dot(Ce,Y),it=K*ce-se*se;if(it===0){const Xt=s.ab.vec3.dot(Y,Ce)/s.ab.vec3.dot(Ce,Ce),vn=s.ab.vec3.lerp(s.ab.vec3.create(),oe,Ee,Xt);return s.ab.vec3.squaredDistance(vn,q)}const Ne=(se*Se-fe*ce)/it,ut=(K*Se-se*fe)/it,Et=s.ab.vec3.lerp(s.ab.vec3.create(),q,ee,Ne),xt=s.ab.vec3.lerp(s.ab.vec3.create(),oe,Ee,ut);return s.ab.vec3.squaredDistance(Et,xt)}}class Be{static parseFrom(q,ee){const oe=dt.parse(q);if(!oe)return[];let{vertices:Ee,features:be}=oe;const Ce=1/s.cc(ee);be.sort((fe,ce)=>fe.id-ce.id),Ee.sort((fe,ce)=>fe.id-ce.id||fe.idx-ce.idx),Ee=Ee.filter((fe,ce,Se)=>ce===Se.findIndex(it=>it.id===fe.id&&it.idx===fe.idx));const Y=new Array;let K=0;const se=Ee.length;for(const fe of be){if(fe.constantHeight){Y.push(new vt(fe.id,fe.bounds,fe.constantHeight));continue}for(;K!==se&&Ee[K].id<fe.id;)K++;if(K===se||Ee[K].id!==fe.id)continue;const ce=new Array,Se=new Array,it=K;for(;K!==se&&Ee[K].id===fe.id;){const Ne=Ee[K];if(ce.push({position:Ne.position,height:Ne.height,extent:Ne.extent}),K!==it&&Ee[K-1].idx===Ne.idx-1){const ut=K-it;Se.push({a:ut-1,b:ut})}K++}Y.push(new vt(fe.id,fe.bounds,void 0,ce,Se,Ce))}return Y}}s.dV(vt,"ElevationFeature");class Ie{constructor(q){this.tileID=new s.aG(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.lut=q.lut,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.scope=q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.request&&q.request.collectResourceTiming,this.promoteId=q.promoteId,this.isSymbolTile=q.isSymbolTile,this.tileTransform=s.aQ(q.tileID.canonical,q.projection),this.projection=q.projection,this.worldview=q.worldview,this.localizableLayerIds=q.localizableLayerIds,this.brightness=q.brightness,this.extraShadowCaster=!!q.extraShadowCaster,this.tessellationStep=q.tessellationStep,this.scaleFactor=q.scaleFactor}parse(q,ee,oe,Ee,be){this.status="parsing",this.data=q,this.collisionBoxArray=new s.aW;const Ce=new s.d_(Object.keys(q.layers).sort()),Y=new s.d$(this.tileID,this.promoteId);Y.bucketLayerIDs=[];const K={},se=new s.e0(256,256),fe={featureIndex:Y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:se,availableImages:oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ce=ee.familiesBySource[this.source];for(const Xt in ce){const vn=q.layers[Xt];if(!vn)continue;let nn=!1,Tn=!1,Kn=!1;for(const Mr of ce[Xt])Mr[0].type==="symbol"?nn=!0:Tn=!0,Mr[0].is3D()&&Mr[0].type!=="model"&&(Kn=!0);if(this.extraShadowCaster&&!Kn||this.isSymbolTile===!0&&!nn||this.isSymbolTile===!1&&!Tn)continue;vn.version===1&&s.w(`Vector tile source "${this.source}" layer "${Xt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const dr=Ce.encode(Xt),Vn=[];let Hr=!1;for(let Mr=0,zs=0;Mr<vn.length;Mr++){const Qs=vn.feature(Mr),xo=Y.getId(Qs,Xt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Xt)){const bs=Qs.properties?Qs.properties.worldview:null;if(this.worldview&&typeof bs=="string")if(bs==="all")Qs.properties.$localized=!0;else{if(!bs.split(",").includes(this.worldview))continue;Qs.properties.$localized=!0,Qs.properties.worldview=this.worldview}}!Hr&&Qs.properties&&Qs.properties.hasOwnProperty(ct)&&(Hr=!0),Vn.push({feature:Qs,id:xo,index:zs,sourceLayerIndex:dr}),zs++}Hr&&q.layers.hasOwnProperty(Qt)&&(fe.elevationFeatures=Be.parseFrom(q.layers[Qt],this.canonical));for(const Mr of ce[Xt]){const zs=Mr[0];(!this.extraShadowCaster||zs.is3D()&&zs.type!=="model")&&(this.isSymbolTile!==void 0&&zs.type==="symbol"!==this.isSymbolTile||zs.minzoom&&this.zoom<Math.floor(zs.minzoom)||zs.maxzoom&&this.zoom>=zs.maxzoom||zs.visibility!=="none"&&(Ue(Mr,this.zoom,fe.brightness,oe),(K[zs.id]=zs.createBucket({index:Y.bucketLayerIDs.length,layers:Mr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Vn,fe,this.tileID.canonical,this.tileTransform),Y.bucketLayerIDs.push(Mr.map(Qs=>s.aC(Qs.id,Qs.scope)))))}}let Se,it,Ne,ut;se.trim();const Et={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xt=()=>{if(Se)return this.status="done",be(Se);if(this.extraShadowCaster)this.status="done",be(null,{buckets:s.bj(K).filter(Xt=>!Xt.isEmpty()),featureIndex:Y,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:fe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(it&&Ne&&ut){const Xt=new yi(it),vn=new s.e3(Ne,ut,this.lut);for(const nn in K){const Tn=K[nn];Tn instanceof s.aX?(Ue(Tn.layers,this.zoom,fe.brightness,oe),s.e4(Tn,it,Xt.positions,Ne,vn.iconPositions,this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Tn.hasPattern&&(Tn instanceof s.b1||Tn instanceof s.b2||Tn instanceof s.d5)&&(Ue(Tn.layers,this.zoom,fe.brightness,oe),Tn.addFeatures(fe,this.tileID.canonical,vn.patternPositions,oe,this.tileTransform,this.brightness))}this.status="done",be(null,{buckets:s.bj(K).filter(nn=>!nn.isEmpty()),featureIndex:Y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Xt.image,lineAtlas:se,imageAtlas:vn,brightness:fe.brightness})}};if(!this.extraShadowCaster){const Xt=s.e1(fe.glyphDependencies,Tn=>Object.keys(Tn).map(Number));Object.keys(Xt).length?Ee.send("getGlyphs",{uid:this.uid,stacks:Xt,scope:this.scope},(Tn,Kn)=>{Se||(Se=Tn,it=Kn,xt())},void 0,!1,Et):it={};const vn=Object.keys(fe.iconDependencies);vn.length?Ee.send("getImages",{icons:vn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Tn,Kn)=>{if(Se)return;Se=Tn;const dr={};Object.values(Kn).some(Vn=>Vn.usvg)?this.rasterize(Ee,dr,Kn,fe.iconDependencies,()=>{Ne=dr,xt()}):(this.fillImageMap(dr,fe.iconDependencies,Kn),Ne=dr,xt())},void 0,!1,Et):Ne={};const nn=Object.keys(fe.patternDependencies);nn.length?Ee.send("getImages",{icons:nn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Tn,Kn)=>{if(!Se){Se=Tn;const dr={};Object.values(Kn).some(Vn=>Vn.usvg)?this.rasterize(Ee,dr,Kn,fe.patternDependencies,()=>{ut=dr,xt()}):(this.fillImageMap(dr,fe.patternDependencies,Kn),ut=dr,xt())}},void 0,!1,Et):ut={}}xt()}fillImageMap(q,ee,oe){for(const Ee in oe){const be=ee[Ee]||[];for(const Ce of be)oe[Ce.id].usvg||(q[Ce.serialize()]=oe[Ce.id])}}getImageTaskQueue(q,ee,oe){const Ee={};for(const be in ee){const Ce=oe[be]||[];for(const Y of Ce){const K=Y.serialize();ee[Y.id].usvg?Ee[K]||(Ee[K]=Y):q[K]=ee[Y.id]}}return Ee}rasterize(q,ee,oe,Ee,be){const Ce=this.getImageTaskQueue(ee,oe,Ee);this.rasterizeTask=q.send("rasterizeImages",{scope:this.scope,imageTasks:Ce},(Y,K)=>{if(!Y)for(const se in K){const{id:fe}=s.e2.deserializeFromString(se);ee[se]=Object.assign({},oe[fe],{data:K[se]})}be()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ue(gt,q,ee,oe){const Ee=new s.a8(q,{brightness:ee});for(const be of gt)be.recalculate(Ee,oe)}class qe extends s.E{constructor(q,ee,oe,Ee,be,Ce){super(),this.actor=q,this.layerIndex=ee,this.availableImages=oe,this.loadVectorData=be||s.aD,this.loading={},this.loaded={},this.deduped=new s.aB(q.scheduler),this.isSpriteLoaded=Ee,this.scheduler=q.scheduler,this.brightness=Ce}loadTile(q,ee){const oe=q.uid,Ee=q&&q.request,be=Ee&&Ee.collectResourceTiming,Ce=this.loading[oe]=new Ie(q);Ce.abort=this.loadVectorData(q,(Y,K)=>{const se=!this.loading[oe];if(delete this.loading[oe],Ce.cancelRasterize(),se||Y||!K)return Ce.status="done",se||(this.loaded[oe]=Ce),ee(Y);const fe=K.rawData,ce={};K.expires&&(ce.expires=K.expires),K.cacheControl&&(ce.cacheControl=K.cacheControl),Ce.vectorTile=K.vectorTile||new s.dY.VectorTile(new s.bh(fe));const Se=()=>{Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,(it,Ne)=>{if(it||!Ne)return ee(it);const ut={};if(be){const Et=xn(Ee);Et.length>0&&(ut.resourceTiming=JSON.parse(JSON.stringify(Et)))}ee(null,s.l({rawTileData:fe.slice(0)},Ne,ce,ut))})};this.isSpriteLoaded?Se():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Se,{type:"parseTile",isSymbolTile:q.isSymbolTile,zoom:q.tileZoom}):Se()}),this.loaded=this.loaded||{},this.loaded[oe]=Ce})}reloadTile(q,ee){const oe=this.loaded,Ee=q.uid;if(oe&&oe[Ee]){const be=oe[Ee];be.scaleFactor=q.scaleFactor,be.showCollisionBoxes=q.showCollisionBoxes,be.projection=q.projection,be.brightness=q.brightness,be.tileTransform=s.aQ(q.tileID.canonical,q.projection),be.extraShadowCaster=q.extraShadowCaster,be.lut=q.lut;const Ce=(Y,K)=>{const se=be.reloadCallback;se&&(delete be.reloadCallback,be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,se)),ee(Y,K)};be.status==="parsing"?be.reloadCallback=Ce:be.status==="done"&&(be.vectorTile?be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,Ce):Ce())}else ee(null,void 0)}abortTile(q,ee){const oe=q.uid,Ee=this.loading[oe];Ee&&(Ee.abort&&Ee.abort(),delete this.loading[oe]),ee()}removeTile(q,ee){const oe=this.loaded,Ee=q.uid;oe&&oe[Ee]&&delete oe[Ee],ee()}}class De{loadTile(q,ee){const{uid:oe,encoding:Ee,rawImageData:be,padding:Ce}=q,Y=ImageBitmap&&be instanceof ImageBitmap?this.getImageData(be,Ce):be;ee(null,new s.e5(oe,Y,Ee,Ce<1))}getImageData(q,ee){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const oe=this.offscreenCanvasContext.getImageData(-ee,-ee,q.width+2*ee,q.height+2*ee);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}s.bg.setPbf(s.bh);class je{decodeRasterArray({task:q,buffer:ee},oe){s.bg.performDecoding(ee,q).then(Ee=>{oe(null,Ee)},Ee=>{oe(Ee)})}}const Pt=s.dY.VectorTileFeature.prototype.toGeoJSON;class ki{constructor(q){this._feature=q,this.extent=s.ag,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))}loadGeometry(){if(this._feature.type===1){const q=[];for(const ee of this._feature.geometry)q.push([new s.P(ee[0],ee[1])]);return q}{const q=[];for(const ee of this._feature.geometry){const oe=[];for(const Ee of ee)oe.push(new s.P(Ee[0],Ee[1]));q.push(oe)}return q}}toGeoJSON(q,ee,oe){return Pt.call(this,q,ee,oe)}}class bi{constructor(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ag,this.length=q.length,this._features=q}feature(q){return new ki(this._features[q])}}const ji=64/4096,hr=128;class Xn{constructor(){this.features=new Map}clear(){this.features.clear()}load(q=[],ee){for(const oe of q){const Ee=oe.id;if(Ee==null)continue;let be=this.features.get(Ee);be&&this.updateCache(be,ee),oe.geometry?(be=Ot(oe),this.updateCache(be,ee),this.features.set(Ee,be)):this.features.delete(Ee),this.updateCache(be,ee)}}updateCache(q,ee){for(const{canonical:oe,uid:Ee}of Object.values(ee)){const{z:be,x:Ce,y:Y}=oe;rn(q,Math.pow(2,be),Ce,Y)&&delete ee[Ee]}}getTile(q,ee,oe){const Ee=Math.pow(2,q),be=[];for(const Ce of this.features.values())rn(Ce,Ee,ee,oe)&&be.push(vi(Ce,Ee,ee,oe));return{features:be}}getFeatures(){return[...this.features.values()]}}function rn({minX:gt,minY:q,maxX:ee,maxY:oe},Ee,be,Ce){return gt<(be+1+ji)/Ee&&q<(Ce+1+ji)/Ee&&ee>(be-ji)/Ee&&oe>(Ce-ji)/Ee}function Ot(gt){const{id:q,geometry:ee,properties:oe}=gt;if(!ee)return;if(ee.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ee,coordinates:be}=ee,Ce={id:q,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Y=Ce.geometry;if(Ee==="Point")at(be,Y,Ce);else if(Ee==="MultiPoint")for(const K of be)at(K,Y,Ce);else if(Ee==="LineString")Ce.type=2,Ht(be,Y,Ce);else if(Ee==="MultiLineString")Ce.type=2,Qi(be,Y,Ce);else if(Ee==="Polygon")Ce.type=3,Qi(be,Y,Ce,!0);else{if(Ee!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ce.type=3;for(const K of be)Qi(K,Y,Ce,!0)}return Ce}function at([gt,q],ee,oe){const Ee=s.at(gt);let be=s.aA(q);be=be<0?0:be>1?1:be,ee.push(Ee,be),oe.minX=Math.min(oe.minX,Ee),oe.minY=Math.min(oe.minY,be),oe.maxX=Math.max(oe.maxX,Ee),oe.maxY=Math.max(oe.maxY,be)}function Ht(gt,q,ee,oe=!1,Ee=!1){const be=[];for(const Ce of gt)at(Ce,be,ee);q.push(be),oe&&function(Ce,Y){let K=0;for(let se=0,fe=Ce.length,ce=fe-2;se<fe;ce=se,se+=2)K+=(Ce[se]-Ce[ce])*(Ce[se+1]+Ce[ce+1]);if(K>0===Y)for(let se=0,fe=Ce.length;se<fe/2;se+=2){const ce=Ce[se],Se=Ce[se+1];Ce[se]=Ce[fe-2-se],Ce[se+1]=Ce[fe-1-se],Ce[fe-2-se]=ce,Ce[fe-1-se]=Se}}(be,Ee)}function Qi(gt,q,ee,oe=!1){for(let Ee=0;Ee<gt.length;Ee++)Ht(gt[Ee],q,ee,oe,Ee===0)}function vi(gt,q,ee,oe){const{id:Ee,type:be,geometry:Ce,tags:Y}=gt,K=[];if(be===1)(function(se,fe,ce,Se,it){for(let Ne=0;Ne<se.length;Ne+=2){const ut=Math.round(s.ag*(se[Ne+0]*fe-ce)),Et=Math.round(s.ag*(se[Ne+1]*fe-Se));it.push([ut,Et])}})(Ce,q,ee,oe,K);else for(const se of Ce)Mn(se,q,ee,oe,K);return{id:Ee,type:be,geometry:K,tags:Y}}function Mn(gt,q,ee,oe,Ee){const be=-hr,Ce=s.ag+hr;let Y;for(let K=0;K<gt.length-2;K+=2){let se=Math.round(s.ag*(gt[K+0]*q-ee)),fe=Math.round(s.ag*(gt[K+1]*q-oe)),ce=Math.round(s.ag*(gt[K+2]*q-ee)),Se=Math.round(s.ag*(gt[K+3]*q-oe));const it=ce-se,Ne=Se-fe;se<be&&ce<be||(se<be?(fe+=Math.round(Ne*((be-se)/it)),se=be):ce<be&&(Se=fe+Math.round(Ne*((be-se)/it)),ce=be),fe<be&&Se<be||(fe<be?(se+=Math.round(it*((be-fe)/Ne)),fe=be):Se<be&&(ce=se+Math.round(it*((be-fe)/Ne)),Se=be),se>=Ce&&ce>=Ce||(se>=Ce?(fe+=Math.round(Ne*((Ce-se)/it)),se=Ce):ce>=Ce&&(Se=fe+Math.round(Ne*((Ce-se)/it)),ce=Ce),fe>=Ce&&Se>=Ce||(fe>=Ce?(se+=Math.round(it*((Ce-fe)/Ne)),fe=Ce):Se>=Ce&&(ce=se+Math.round(it*((Ce-fe)/Ne)),Se=Ce),Y&&se===Y[Y.length-1][0]&&fe===Y[Y.length-1][1]||(Y=[[se,fe]],Ee.push(Y)),Y.push([ce,Se])))))}}var gr,Hn,kr,Dt={exports:{}},Ls=function(){if(kr)return Dt.exports;kr=1;var gt=s.e8(),q=function(){if(Hn)return gr;Hn=1;var fe=s.e6(),ce=s.e7().VectorTileFeature;function Se(Ne,ut){this.options=ut||{},this.features=Ne,this.length=Ne.length}function it(Ne,ut){this.id=typeof Ne.id=="number"?Ne.id:void 0,this.type=Ne.type,this.rawGeometry=Ne.type===1?[Ne.geometry]:Ne.geometry,this.properties=Ne.tags,this.extent=ut||4096}return gr=Se,Se.prototype.feature=function(Ne){return new it(this.features[Ne],this.options.extent)},it.prototype.loadGeometry=function(){var Ne=this.rawGeometry;this.geometry=[];for(var ut=0;ut<Ne.length;ut++){for(var Et=Ne[ut],xt=[],Xt=0;Xt<Et.length;Xt++)xt.push(new fe(Et[Xt][0],Et[Xt][1]));this.geometry.push(xt)}return this.geometry},it.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ne=this.geometry,ut=1/0,Et=-1/0,xt=1/0,Xt=-1/0,vn=0;vn<Ne.length;vn++)for(var nn=Ne[vn],Tn=0;Tn<nn.length;Tn++){var Kn=nn[Tn];ut=Math.min(ut,Kn.x),Et=Math.max(Et,Kn.x),xt=Math.min(xt,Kn.y),Xt=Math.max(Xt,Kn.y)}return[ut,xt,Et,Xt]},it.prototype.toGeoJSON=ce.prototype.toGeoJSON,gr}();function ee(fe){var ce=new gt;return function(Se,it){for(var Ne in Se.layers)it.writeMessage(3,oe,Se.layers[Ne])}(fe,ce),ce.finish()}function oe(fe,ce){var Se;ce.writeVarintField(15,fe.version||1),ce.writeStringField(1,fe.name||""),ce.writeVarintField(5,fe.extent||4096);var it={keys:[],values:[],keycache:{},valuecache:{}};for(Se=0;Se<fe.length;Se++)it.feature=fe.feature(Se),ce.writeMessage(2,Ee,it);var Ne=it.keys;for(Se=0;Se<Ne.length;Se++)ce.writeStringField(3,Ne[Se]);var ut=it.values;for(Se=0;Se<ut.length;Se++)ce.writeMessage(4,se,ut[Se])}function Ee(fe,ce){var Se=fe.feature;Se.id!==void 0&&ce.writeVarintField(1,Se.id),ce.writeMessage(2,be,fe),ce.writeVarintField(3,Se.type),ce.writeMessage(4,K,Se)}function be(fe,ce){var Se=fe.feature,it=fe.keys,Ne=fe.values,ut=fe.keycache,Et=fe.valuecache;for(var xt in Se.properties){var Xt=Se.properties[xt],vn=ut[xt];if(Xt!==null){vn===void 0&&(it.push(xt),ut[xt]=vn=it.length-1),ce.writeVarint(vn);var nn=typeof Xt;nn!=="string"&&nn!=="boolean"&&nn!=="number"&&(Xt=JSON.stringify(Xt));var Tn=nn+":"+Xt,Kn=Et[Tn];Kn===void 0&&(Ne.push(Xt),Et[Tn]=Kn=Ne.length-1),ce.writeVarint(Kn)}}}function Ce(fe,ce){return(ce<<3)+(7&fe)}function Y(fe){return fe<<1^fe>>31}function K(fe,ce){for(var Se=fe.loadGeometry(),it=fe.type,Ne=0,ut=0,Et=Se.length,xt=0;xt<Et;xt++){var Xt=Se[xt],vn=1;it===1&&(vn=Xt.length),ce.writeVarint(Ce(1,vn));for(var nn=it===3?Xt.length-1:Xt.length,Tn=0;Tn<nn;Tn++){Tn===1&&it!==1&&ce.writeVarint(Ce(2,nn-1));var Kn=Xt[Tn].x-Ne,dr=Xt[Tn].y-ut;ce.writeVarint(Y(Kn)),ce.writeVarint(Y(dr)),Ne+=Kn,ut+=dr}it===3&&ce.writeVarint(Ce(7,1))}}function se(fe,ce){var Se=typeof fe;Se==="string"?ce.writeStringField(1,fe):Se==="boolean"?ce.writeBooleanField(7,fe):Se==="number"&&(fe%1!=0?ce.writeDoubleField(3,fe):fe<0?ce.writeSVarintField(6,fe):ce.writeVarintField(5,fe))}return Dt.exports=ee,Dt.exports.fromVectorTileJs=ee,Dt.exports.fromGeojsonVt=function(fe,ce){ce=ce||{};var Se={};for(var it in fe)Se[it]=new q(fe[it].features,ce),Se[it].name=it,Se[it].version=ce.version,Se[it].extent=ce.extent;return ee({layers:Se})},Dt.exports.GeoJSONWrapper=q,Dt.exports}(),Pe=s.e9(Ls);const $n={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:gt=>gt},lt=Math.fround||(cs=new Float32Array(1),gt=>(cs[0]=+gt,cs[0]));var cs;const Xi=3,vs=5,Bs=6;class Xs{constructor(q){this.options=Object.assign(Object.create($n),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:ee,minZoom:oe,maxZoom:Ee}=this.options;ee&&console.time("total time");const be=`prepare ${q.length} points`;ee&&console.time(be),this.points=q;const Ce=[];for(let K=0;K<q.length;K++){const se=q[K];if(!se.geometry)continue;const[fe,ce]=se.geometry.coordinates,Se=lt(ys(fe)),it=lt(Hs(ce));Ce.push(Se,it,1/0,K,-1,1),this.options.reduce&&Ce.push(0)}let Y=this.trees[Ee+1]=this._createTree(Ce);ee&&console.timeEnd(be);for(let K=Ee;K>=oe;K--){const se=+Date.now();Y=this.trees[K]=this._createTree(this._cluster(Y,K)),ee&&console.log("z%d: %d clusters in %dms",K,Y.numItems,+Date.now()-se)}return ee&&console.timeEnd("total time"),this}getClusters(q,ee){let oe=((q[0]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,q[1]));let be=q[2]===180?180:((q[2]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)oe=-180,be=180;else if(oe>be){const ce=this.getClusters([oe,Ee,180,Ce],ee),Se=this.getClusters([-180,Ee,be,Ce],ee);return ce.concat(Se)}const Y=this.trees[this._limitZoom(ee)],K=Y.range(ys(oe),Hs(Ce),ys(be),Hs(Ee)),se=Y.data,fe=[];for(const ce of K){const Se=this.stride*ce;fe.push(se[Se+vs]>1?Sr(se,Se,this.clusterProps):this.points[se[Se+Xi]])}return fe}getChildren(q){const ee=this._getOriginId(q),oe=this._getOriginZoom(q),Ee="No cluster with the specified id.",be=this.trees[oe];if(!be)throw new Error(Ee);const Ce=be.data;if(ee*this.stride>=Ce.length)throw new Error(Ee);const Y=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),K=be.within(Ce[ee*this.stride],Ce[ee*this.stride+1],Y),se=[];for(const fe of K){const ce=fe*this.stride;Ce[ce+4]===q&&se.push(Ce[ce+vs]>1?Sr(Ce,ce,this.clusterProps):this.points[Ce[ce+Xi]])}if(se.length===0)throw new Error(Ee);return se}getLeaves(q,ee,oe){const Ee=[];return this._appendLeaves(Ee,q,ee=ee||10,oe=oe||0,0),Ee}getTile(q,ee,oe){const Ee=this.trees[this._limitZoom(q)],be=Math.pow(2,q),{extent:Ce,radius:Y}=this.options,K=Y/Ce,se=(oe-K)/be,fe=(oe+1+K)/be,ce={features:[]};return this._addTileFeatures(Ee.range((ee-K)/be,se,(ee+1+K)/be,fe),Ee.data,ee,oe,be,ce),ee===0&&this._addTileFeatures(Ee.range(1-K/be,se,1,fe),Ee.data,be,oe,be,ce),ee===be-1&&this._addTileFeatures(Ee.range(0,se,K/be,fe),Ee.data,-1,oe,be,ce),ce.features.length?ce:null}getClusterExpansionZoom(q){let ee=this._getOriginZoom(q)-1;for(;ee<=this.options.maxZoom;){const oe=this.getChildren(q);if(ee++,oe.length!==1)break;q=oe[0].properties.cluster_id}return ee}_appendLeaves(q,ee,oe,Ee,be){const Ce=this.getChildren(ee);for(const Y of Ce){const K=Y.properties;if(K&&K.cluster?be+K.point_count<=Ee?be+=K.point_count:be=this._appendLeaves(q,K.cluster_id,oe,Ee,be):be<Ee?be++:q.push(Y),q.length===oe)break}return be}_createTree(q){const ee=new s.bE(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<q.length;oe+=this.stride)ee.add(q[oe],q[oe+1]);return ee.finish(),ee.data=q,ee}_addTileFeatures(q,ee,oe,Ee,be,Ce){for(const Y of q){const K=Y*this.stride,se=ee[K+vs]>1;let fe,ce,Se;if(se)fe=un(ee,K,this.clusterProps),ce=ee[K],Se=ee[K+1];else{const ut=this.points[ee[K+Xi]];fe=ut.properties;const[Et,xt]=ut.geometry.coordinates;ce=ys(Et),Se=Hs(xt)}const it={type:1,geometry:[[Math.round(this.options.extent*(ce*be-oe)),Math.round(this.options.extent*(Se*be-Ee))]],tags:fe};let Ne;Ne=se||this.options.generateId?ee[K+Xi]:this.points[ee[K+Xi]].id,Ne!==void 0&&(it.id=Ne),Ce.features.push(it)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,ee){const{radius:oe,extent:Ee,reduce:be,minPoints:Ce}=this.options,Y=oe/(Ee*Math.pow(2,ee)),K=q.data,se=[],fe=this.stride;for(let ce=0;ce<K.length;ce+=fe){if(K[ce+2]<=ee)continue;K[ce+2]=ee;const Se=K[ce],it=K[ce+1],Ne=q.within(K[ce],K[ce+1],Y),ut=K[ce+vs];let Et=ut;for(const xt of Ne){const Xt=xt*fe;K[Xt+2]>ee&&(Et+=K[Xt+vs])}if(Et>ut&&Et>=Ce){let xt,Xt=Se*ut,vn=it*ut,nn=-1;const Tn=(ce/fe<<5)+(ee+1)+this.points.length;for(const Kn of Ne){const dr=Kn*fe;if(K[dr+2]<=ee)continue;K[dr+2]=ee;const Vn=K[dr+vs];Xt+=K[dr]*Vn,vn+=K[dr+1]*Vn,K[dr+4]=Tn,be&&(xt||(xt=this._map(K,ce,!0),nn=this.clusterProps.length,this.clusterProps.push(xt)),be(xt,this._map(K,dr)))}K[ce+4]=Tn,se.push(Xt/Et,vn/Et,1/0,Tn,-1,Et),be&&se.push(nn)}else{for(let xt=0;xt<fe;xt++)se.push(K[ce+xt]);if(Et>1)for(const xt of Ne){const Xt=xt*fe;if(!(K[Xt+2]<=ee)){K[Xt+2]=ee;for(let vn=0;vn<fe;vn++)se.push(K[Xt+vn])}}}}return se}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,ee,oe){if(q[ee+vs]>1){const Ce=this.clusterProps[q[ee+Bs]];return oe?Object.assign({},Ce):Ce}const Ee=this.points[q[ee+Xi]].properties,be=this.options.map(Ee);return oe&&be===Ee?Object.assign({},be):be}}function Sr(gt,q,ee){return{type:"Feature",id:gt[q+Xi],properties:un(gt,q,ee),geometry:{type:"Point",coordinates:[(oe=gt[q],360*(oe-.5)),ls(gt[q+1])]}};var oe}function un(gt,q,ee){const oe=gt[q+vs],Ee=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,be=gt[q+Bs],Ce=be===-1?{}:Object.assign({},ee[be]);return Object.assign(Ce,{cluster:!0,cluster_id:gt[q+Xi],point_count:oe,point_count_abbreviated:Ee})}function ys(gt){return gt/360+.5}function Hs(gt){const q=Math.sin(gt*Math.PI/180),ee=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return ee<0?0:ee>1?1:ee}function ls(gt){const q=(180-360*gt)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function Rs(gt,q,ee,oe){let Ee=oe;const be=q+(ee-q>>1);let Ce,Y=ee-q;const K=gt[q],se=gt[q+1],fe=gt[ee],ce=gt[ee+1];for(let Se=q+3;Se<ee;Se+=3){const it=cn(gt[Se],gt[Se+1],K,se,fe,ce);if(it>Ee)Ce=Se,Ee=it;else if(it===Ee){const Ne=Math.abs(Se-be);Ne<Y&&(Ce=Se,Y=Ne)}}Ee>oe&&(Ce-q>3&&Rs(gt,q,Ce,oe),gt[Ce+2]=Ee,ee-Ce>3&&Rs(gt,Ce,ee,oe))}function cn(gt,q,ee,oe,Ee,be){let Ce=Ee-ee,Y=be-oe;if(Ce!==0||Y!==0){const K=((gt-ee)*Ce+(q-oe)*Y)/(Ce*Ce+Y*Y);K>1?(ee=Ee,oe=be):K>0&&(ee+=Ce*K,oe+=Y*K)}return Ce=gt-ee,Y=q-oe,Ce*Ce+Y*Y}function Jr(gt,q,ee,oe){const Ee={id:gt!=null?gt:null,type:q,geometry:ee,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(q==="Point"||q==="MultiPoint"||q==="LineString")Pr(Ee,ee);else if(q==="Polygon")Pr(Ee,ee[0]);else if(q==="MultiLineString")for(const be of ee)Pr(Ee,be);else if(q==="MultiPolygon")for(const be of ee)Pr(Ee,be[0]);return Ee}function Pr(gt,q){for(let ee=0;ee<q.length;ee+=3)gt.minX=Math.min(gt.minX,q[ee]),gt.minY=Math.min(gt.minY,q[ee+1]),gt.maxX=Math.max(gt.maxX,q[ee]),gt.maxY=Math.max(gt.maxY,q[ee+1])}function Ts(gt,q,ee,oe){if(!q.geometry)return;const Ee=q.geometry.coordinates;if(Ee&&Ee.length===0)return;const be=q.geometry.type,Ce=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2);let Y=[],K=q.id;if(ee.promoteId?K=q.properties[ee.promoteId]:ee.generateId&&(K=oe||0),be==="Point")Dn(Ee,Y);else if(be==="MultiPoint")for(const se of Ee)Dn(se,Y);else if(be==="LineString")xs(Ee,Y,Ce,!1);else if(be==="MultiLineString"){if(ee.lineMetrics){for(const se of Ee)Y=[],xs(se,Y,Ce,!1),gt.push(Jr(K,"LineString",Y,q.properties));return}Gn(Ee,Y,Ce,!1)}else if(be==="Polygon")Gn(Ee,Y,Ce,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(const se of q.geometry.geometries)Ts(gt,{id:K,geometry:se,properties:q.properties},ee,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const se of Ee){const fe=[];Gn(se,fe,Ce,!0),Y.push(fe)}}gt.push(Jr(K,be,Y,q.properties))}function Dn(gt,q){q.push(Ir(gt[0]),fo(gt[1]),0)}function xs(gt,q,ee,oe){let Ee,be,Ce=0;for(let K=0;K<gt.length;K++){const se=Ir(gt[K][0]),fe=fo(gt[K][1]);q.push(se,fe,0),K>0&&(Ce+=oe?(Ee*fe-se*be)/2:Math.sqrt(Math.pow(se-Ee,2)+Math.pow(fe-be,2))),Ee=se,be=fe}const Y=q.length-3;q[2]=1,Rs(q,0,Y,ee),q[Y+2]=1,q.size=Math.abs(Ce),q.start=0,q.end=q.size}function Gn(gt,q,ee,oe){for(let Ee=0;Ee<gt.length;Ee++){const be=[];xs(gt[Ee],be,ee,oe),q.push(be)}}function Ir(gt){return gt/360+.5}function fo(gt){const q=Math.sin(gt*Math.PI/180),ee=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return ee<0?0:ee>1?1:ee}function ms(gt,q,ee,oe,Ee,be,Ce,Y){if(oe/=q,be>=(ee/=q)&&Ce<oe)return gt;if(Ce<ee||be>=oe)return null;const K=[];for(const se of gt){const fe=se.geometry;let ce=se.type;const Se=Ee===0?se.minX:se.minY,it=Ee===0?se.maxX:se.maxY;if(Se>=ee&&it<oe){K.push(se);continue}if(it<ee||Se>=oe)continue;let Ne=[];if(ce==="Point"||ce==="MultiPoint")Co(fe,Ne,ee,oe,Ee);else if(ce==="LineString")mr(fe,Ne,ee,oe,Ee,!1,Y.lineMetrics);else if(ce==="MultiLineString")ks(fe,Ne,ee,oe,Ee,!1);else if(ce==="Polygon")ks(fe,Ne,ee,oe,Ee,!0);else if(ce==="MultiPolygon")for(const ut of fe){const Et=[];ks(ut,Et,ee,oe,Ee,!0),Et.length&&Ne.push(Et)}if(Ne.length){if(Y.lineMetrics&&ce==="LineString"){for(const ut of Ne)K.push(Jr(se.id,ce,ut,se.tags));continue}ce!=="LineString"&&ce!=="MultiLineString"||(Ne.length===1?(ce="LineString",Ne=Ne[0]):ce="MultiLineString"),ce!=="Point"&&ce!=="MultiPoint"||(ce=Ne.length===3?"Point":"MultiPoint"),K.push(Jr(se.id,ce,Ne,se.tags))}}return K.length?K:null}function Co(gt,q,ee,oe,Ee){for(let be=0;be<gt.length;be+=3){const Ce=gt[be+Ee];Ce>=ee&&Ce<=oe&&ur(q,gt[be],gt[be+1],gt[be+2])}}function mr(gt,q,ee,oe,Ee,be,Ce){let Y=Ss(gt);const K=Ee===0?_e:he;let se,fe,ce=gt.start;for(let Et=0;Et<gt.length-3;Et+=3){const xt=gt[Et],Xt=gt[Et+1],vn=gt[Et+2],nn=gt[Et+3],Tn=gt[Et+4],Kn=Ee===0?xt:Xt,dr=Ee===0?nn:Tn;let Vn=!1;Ce&&(se=Math.sqrt(Math.pow(xt-nn,2)+Math.pow(Xt-Tn,2))),Kn<ee?dr>ee&&(fe=K(Y,xt,Xt,nn,Tn,ee),Ce&&(Y.start=ce+se*fe)):Kn>oe?dr<oe&&(fe=K(Y,xt,Xt,nn,Tn,oe),Ce&&(Y.start=ce+se*fe)):ur(Y,xt,Xt,vn),dr<ee&&Kn>=ee&&(fe=K(Y,xt,Xt,nn,Tn,ee),Vn=!0),dr>oe&&Kn<=oe&&(fe=K(Y,xt,Xt,nn,Tn,oe),Vn=!0),!be&&Vn&&(Ce&&(Y.end=ce+se*fe),q.push(Y),Y=Ss(gt)),Ce&&(ce+=se)}let Se=gt.length-3;const it=gt[Se],Ne=gt[Se+1],ut=Ee===0?it:Ne;ut>=ee&&ut<=oe&&ur(Y,it,Ne,gt[Se+2]),Se=Y.length-3,be&&Se>=3&&(Y[Se]!==Y[0]||Y[Se+1]!==Y[1])&&ur(Y,Y[0],Y[1],Y[2]),Y.length&&q.push(Y)}function Ss(gt){const q=[];return q.size=gt.size,q.start=gt.start,q.end=gt.end,q}function ks(gt,q,ee,oe,Ee,be){for(const Ce of gt)mr(Ce,q,ee,oe,Ee,be,!1)}function ur(gt,q,ee,oe){gt.push(q,ee,oe)}function _e(gt,q,ee,oe,Ee,be){const Ce=(be-q)/(oe-q);return ur(gt,be,ee+(Ee-ee)*Ce,1),Ce}function he(gt,q,ee,oe,Ee,be){const Ce=(be-ee)/(Ee-ee);return ur(gt,q+(oe-q)*Ce,be,1),Ce}function pe(gt,q){const ee=[];for(let oe=0;oe<gt.length;oe++){const Ee=gt[oe],be=Ee.type;let Ce;if(be==="Point"||be==="MultiPoint"||be==="LineString")Ce=Re(Ee.geometry,q);else if(be==="MultiLineString"||be==="Polygon"){Ce=[];for(const Y of Ee.geometry)Ce.push(Re(Y,q))}else if(be==="MultiPolygon"){Ce=[];for(const Y of Ee.geometry){const K=[];for(const se of Y)K.push(Re(se,q));Ce.push(K)}}ee.push(Jr(Ee.id,be,Ce,Ee.tags))}return ee}function Re(gt,q){const ee=[];ee.size=gt.size,gt.start!==void 0&&(ee.start=gt.start,ee.end=gt.end);for(let oe=0;oe<gt.length;oe+=3)ee.push(gt[oe]+q,gt[oe+1],gt[oe+2]);return ee}function ke(gt,q){if(gt.transformed)return gt;const ee=1<<gt.z,oe=gt.x,Ee=gt.y;for(const be of gt.features){const Ce=be.geometry,Y=be.type;if(be.geometry=[],Y===1)for(let K=0;K<Ce.length;K+=2)be.geometry.push(ui(Ce[K],Ce[K+1],q,ee,oe,Ee));else for(let K=0;K<Ce.length;K++){const se=[];for(let fe=0;fe<Ce[K].length;fe+=2)se.push(ui(Ce[K][fe],Ce[K][fe+1],q,ee,oe,Ee));be.geometry.push(se)}}return gt.transformed=!0,gt}function ui(gt,q,ee,oe,Ee,be){return[Math.round(ee*(gt*oe-Ee)),Math.round(ee*(q*oe-be))]}function Vt(gt,q,ee,oe,Ee){const be=q===Ee.maxZoom?0:Ee.tolerance/((1<<q)*Ee.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:gt.length,source:null,x:ee,y:oe,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Y of gt)fi(Ce,Y,be,Ee);return Ce}function fi(gt,q,ee,oe){const Ee=q.geometry,be=q.type,Ce=[];if(gt.minX=Math.min(gt.minX,q.minX),gt.minY=Math.min(gt.minY,q.minY),gt.maxX=Math.max(gt.maxX,q.maxX),gt.maxY=Math.max(gt.maxY,q.maxY),be==="Point"||be==="MultiPoint")for(let Y=0;Y<Ee.length;Y+=3)Ce.push(Ee[Y],Ee[Y+1]),gt.numPoints++,gt.numSimplified++;else if(be==="LineString")Zt(Ce,Ee,gt,ee,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(let Y=0;Y<Ee.length;Y++)Zt(Ce,Ee[Y],gt,ee,be==="Polygon",Y===0);else if(be==="MultiPolygon")for(let Y=0;Y<Ee.length;Y++){const K=Ee[Y];for(let se=0;se<K.length;se++)Zt(Ce,K[se],gt,ee,!0,se===0)}if(Ce.length){let Y=q.tags||null;if(be==="LineString"&&oe.lineMetrics){Y={};for(const se in q.tags)Y[se]=q.tags[se];Y.mapbox_clip_start=Ee.start/Ee.size,Y.mapbox_clip_end=Ee.end/Ee.size}const K={geometry:Ce,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:Y};q.id!==null&&(K.id=q.id),gt.features.push(K)}}function Zt(gt,q,ee,oe,Ee,be){const Ce=oe*oe;if(oe>0&&q.size<(Ee?Ce:oe))return void(ee.numPoints+=q.length/3);const Y=[];for(let K=0;K<q.length;K+=3)(oe===0||q[K+2]>Ce)&&(ee.numSimplified++,Y.push(q[K],q[K+1])),ee.numPoints++;Ee&&function(K,se){let fe=0;for(let ce=0,Se=K.length,it=Se-2;ce<Se;it=ce,ce+=2)fe+=(K[ce]-K[it])*(K[ce+1]+K[it+1]);if(fe>0===se)for(let ce=0,Se=K.length;ce<Se/2;ce+=2){const it=K[ce],Ne=K[ce+1];K[ce]=K[Se-2-ce],K[ce+1]=K[Se-1-ce],K[Se-2-ce]=it,K[Se-1-ce]=Ne}}(Y,be),gt.push(Y)}const en={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Un{constructor(q,ee){const oe=(ee=this.options=function(be,Ce){for(const Y in Ce)be[Y]=Ce[Y];return be}(Object.create(en),ee)).debug;if(oe&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ee=function(be,Ce){const Y=[];if(be.type==="FeatureCollection")for(let K=0;K<be.features.length;K++)Ts(Y,be.features[K],Ce,K);else Ts(Y,be.type==="Feature"?be:{geometry:be},Ce);return Y}(q,ee);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ee=function(be,Ce){const Y=Ce.buffer/Ce.extent;let K=be;const se=ms(be,1,-1-Y,Y,0,-1,2,Ce),fe=ms(be,1,1-Y,2+Y,0,-1,2,Ce);return(se||fe)&&(K=ms(be,1,-Y,1+Y,0,-1,2,Ce)||[],se&&(K=pe(se,1).concat(K)),fe&&(K=K.concat(pe(fe,-1)))),K}(Ee,ee),Ee.length&&this.splitTile(Ee,0,0,0),oe&&(Ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(q,ee,oe,Ee,be,Ce,Y){const K=[q,ee,oe,Ee],se=this.options,fe=se.debug;for(;K.length;){Ee=K.pop(),oe=K.pop(),ee=K.pop(),q=K.pop();const ce=1<<ee,Se=Bn(ee,oe,Ee);let it=this.tiles[Se];if(!it&&(fe>1&&console.time("creation"),it=this.tiles[Se]=Vt(q,ee,oe,Ee,se),this.tileCoords.push({z:ee,x:oe,y:Ee}),fe)){fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,oe,Ee,it.numFeatures,it.numPoints,it.numSimplified),console.timeEnd("creation"));const Vn=`z${ee}`;this.stats[Vn]=(this.stats[Vn]||0)+1,this.total++}if(it.source=q,be==null){if(ee===se.indexMaxZoom||it.numPoints<=se.indexMaxPoints)continue}else{if(ee===se.maxZoom||ee===be)continue;if(be!=null){const Vn=be-ee;if(oe!==Ce>>Vn||Ee!==Y>>Vn)continue}}if(it.source=null,q.length===0)continue;fe>1&&console.time("clipping");const Ne=.5*se.buffer/se.extent,ut=.5-Ne,Et=.5+Ne,xt=1+Ne;let Xt=null,vn=null,nn=null,Tn=null,Kn=ms(q,ce,oe-Ne,oe+Et,0,it.minX,it.maxX,se),dr=ms(q,ce,oe+ut,oe+xt,0,it.minX,it.maxX,se);q=null,Kn&&(Xt=ms(Kn,ce,Ee-Ne,Ee+Et,1,it.minY,it.maxY,se),vn=ms(Kn,ce,Ee+ut,Ee+xt,1,it.minY,it.maxY,se),Kn=null),dr&&(nn=ms(dr,ce,Ee-Ne,Ee+Et,1,it.minY,it.maxY,se),Tn=ms(dr,ce,Ee+ut,Ee+xt,1,it.minY,it.maxY,se),dr=null),fe>1&&console.timeEnd("clipping"),K.push(Xt||[],ee+1,2*oe,2*Ee),K.push(vn||[],ee+1,2*oe,2*Ee+1),K.push(nn||[],ee+1,2*oe+1,2*Ee),K.push(Tn||[],ee+1,2*oe+1,2*Ee+1)}}getTile(q,ee,oe){q=+q,ee=+ee,oe=+oe;const Ee=this.options,{extent:be,debug:Ce}=Ee;if(q<0||q>24)return null;const Y=1<<q,K=Bn(q,ee=ee+Y&Y-1,oe);if(this.tiles[K])return ke(this.tiles[K],be);Ce>1&&console.log("drilling down to z%d-%d-%d",q,ee,oe);let se,fe=q,ce=ee,Se=oe;for(;!se&&fe>0;)fe--,ce>>=1,Se>>=1,se=this.tiles[Bn(fe,ce,Se)];return se&&se.source?(Ce>1&&(console.log("found parent tile z%d-%d-%d",fe,ce,Se),console.time("drilling down")),this.splitTile(se.source,fe,ce,Se,q,ee,oe),Ce>1&&console.timeEnd("drilling down"),this.tiles[K]?ke(this.tiles[K],be):null):null}}function Bn(gt,q,ee){return 32*((1<<gt)*ee+q)+gt}function Or(gt,q){const ee=gt.tileID.canonical;if(!this._geoJSONIndex)return void q(null,null);const oe=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!oe)return void q(null,null);const Ee=new bi(oe.features);let be=Pe(Ee);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),q(null,{vectorTile:Ee,rawData:be.buffer})}class hs extends qe{constructor(q,ee,oe,Ee,be,Ce){super(q,ee,oe,Ee,Or,Ce),be&&(this.loadGeoJSON=be),this._dynamicIndex=new Xn}loadData(q,ee){const oe=q&&q.request,Ee=oe&&oe.collectResourceTiming;this.loadGeoJSON(q,(be,Ce)=>{if(be||!Ce)return ee(be);if(typeof Ce!="object")return ee(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{try{if(q.filter){const K=s.U(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(K.result==="error")throw new Error(K.value.map(se=>`${se.key}: ${se.message}`).join(", "));Ce.features=Ce.features.filter(se=>K.value.evaluate({zoom:0},se))}q.dynamic?(Ce.type==="Feature"&&(Ce={type:"FeatureCollection",features:[Ce]}),q.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ce.features,this.loaded),q.cluster&&(Ce.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=q.cluster?new Xs(function({superclusterOptions:K,clusterProperties:se}){if(!se||!K)return K;const fe={},ce={},Se={accumulated:null,zoom:0},it={properties:null},Ne=Object.keys(se);for(const ut of Ne){const[Et,xt]=se[ut],Xt=s.U(xt),vn=s.U(typeof Et=="string"?[Et,["accumulated"],["get",ut]]:Et);fe[ut]=Xt.value,ce[ut]=vn.value}return K.map=ut=>{it.properties=ut;const Et={};for(const xt of Ne)Et[xt]=fe[xt].evaluate(Se,it);return Et},K.reduce=(ut,Et)=>{it.properties=Et;for(const xt of Ne)Se.accumulated=ut[xt],ut[xt]=ce[xt].evaluate(Se,it)},K}(q)).load(Ce.features):q.dynamic?this._dynamicIndex:function(K,se){return new Un(K,se)}(Ce,q.geojsonVtOptions)}catch(K){return ee(K)}const Y={};if(Ee){const K=xn(oe);K&&(Y.resourceTiming={},Y.resourceTiming[q.source]=JSON.parse(JSON.stringify(K)))}ee(null,Y)}})}reloadTile(q,ee){const oe=this.loaded;return oe&&oe[q.uid]?q.partial?ee(null,void 0):super.reloadTile(q,ee):this.loadTile(q,ee)}loadGeoJSON(q,ee){if(q.request)s.n(q.request,ee);else{if(typeof q.data!="string")return ee(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return ee(null,JSON.parse(q.data))}catch(oe){return ee(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,ee){try{ee(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(oe){ee(oe)}}getClusterChildren(q,ee){try{ee(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(oe){ee(oe)}}getClusterLeaves(q,ee){try{ee(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(oe){ee(oe)}}}class Vs{constructor(q,ee){this.tileID=new s.aG(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=q.projection,this.brightness=ee}parse(q,ee,oe,Ee){this.status="parsing";const be=new s.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),Ce=[],Y=ee.familiesBySource[oe.source],K=new s.d$(be,oe.promoteId);return K.bucketLayerIDs=[],K.is3DTile=!0,s.ea(q).then(se=>{if(!se)return Ee(new Error("Could not parse tile"));const fe=s.eb(se,1/s.cc(oe.tileID.canonical)),ce=se.json.extensionsUsed&&se.json.extensionsUsed.includes("MAPBOX_mesh_features")||se.json.asset.extras&&se.json.asset.extras.MAPBOX_mesh_features,Se=se.json.extensionsUsed&&se.json.extensionsUsed.includes("EXT_meshopt_compression"),it=new s.a8(this.zoom,{brightness:this.brightness});for(const Ne in Y)for(const ut of Y[Ne]){const Et=ut[0];K.bucketLayerIDs.push(ut.map(Xt=>s.aC(Xt.id,Xt.scope))),Et.recalculate(it,[]);const xt=new s.ec(ut,fe,be,ce,Se,this.brightness,K);ce||(xt.needsUpload=!0),Ce.push(xt),xt.evaluate(Et)}this.status="done",Ee(null,{buckets:Ce,featureIndex:K,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(se=>Ee(new Error(se.message)))}}class qr{constructor(q,ee,oe,Ee,be,Ce){this.actor=q,this.layerIndex=ee,this.availableImages=oe,this.brightness=Ce,this.loading={},this.loaded={}}loadTile(q,ee){const oe=q.uid,Ee=this.loading[oe]=new Vs(q,this.brightness);s.bi(q.request,(be,Ce)=>{const Y=!this.loading[oe];return delete this.loading[oe],Y||be?(Ee.status="done",Y||(this.loaded[oe]=Ee),ee(be)):Ce&&Ce.byteLength!==0?void Ee.parse(Ce,this.layerIndex,q,(K,se)=>{Ee.status="done",this.loaded=this.loaded||{},this.loaded[oe]=Ee,K||!se?ee(K):ee(null,se)}):(Ee.status="done",this.loaded[oe]=Ee,ee())})}reloadTile(q,ee){const oe=this.loaded,Ee=q.uid;if(oe&&oe[Ee]){const be=oe[Ee];be.projection=q.projection,be.brightness=q.brightness;const Ce=(Y,K)=>{be.reloadCallback&&(delete be.reloadCallback,this.loadTile(q,ee)),ee(Y,K)};be.status==="parsing"?be.reloadCallback=Ce:be.status==="done"&&this.loadTile(q,ee)}}abortTile(q,ee){const oe=q.uid;this.loading[oe]&&delete this.loading[oe],ee()}removeTile(q,ee){const oe=this.loaded,Ee=q.uid;oe&&oe[Ee]&&delete oe[Ee],ee()}}class ds{constructor(q){this.self=q,this.actor=new s.ed(q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new s.I,this.projections={},this.defaultProjection=s.bP({name:"mercator"}),this.workerSourceTypes={vector:qe,geojson:hs,"batched-model":qr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ee,oe)=>{if(this.workerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.workerSourceTypes[ee]=oe},this.self.registerRTLTextPlugin=ee=>{if(s.ee.isParsed())throw new Error("RTL text plugin already registered.");s.ee.applyArabicShaping=ee.applyArabicShaping,s.ee.processBidirectionalText=ee.processBidirectionalText,s.ee.processStyledBidirectionalText=ee.processStyledBidirectionalText}}clearCaches(q,ee,oe){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],delete this.rasterArrayWorkerSource,oe()}checkIfReady(q,ee,oe){oe()}setReferrer(q,ee){this.referrer=ee}spriteLoaded(q,{scope:ee,isLoaded:oe}){if(this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),this.isSpriteLoaded[q][ee]=oe,this.workerSources[q]&&this.workerSources[q][ee])for(const Ee in this.workerSources[q][ee]){const be=this.workerSources[q][ee][Ee];for(const Ce in be){const Y=be[Ce];Y instanceof qe&&(Y.isSpriteLoaded=oe,Y.fire(new s.z("isSpriteLoaded")))}}}setImages(q,{scope:ee,images:oe},Ee){if(this.availableImages[q]||(this.availableImages[q]={}),this.availableImages[q][ee]=oe,this.workerSources[q]&&this.workerSources[q][ee]){for(const be in this.workerSources[q][ee]){const Ce=this.workerSources[q][ee][be];for(const Y in Ce)Ce[Y].availableImages=oe}Ee()}else Ee()}setProjection(q,ee){this.projections[q]=s.bP(ee)}setBrightness(q,ee,oe){this.brightness=ee,oe()}setLayers(q,ee,oe){this.getLayerIndex(q,ee.scope).replace(ee.layers,ee.options),oe()}updateLayers(q,ee,oe){this.getLayerIndex(q,ee.scope).update(ee.layers,ee.removedIds,ee.options),oe()}loadTile(q,ee,oe){ee.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,ee.type,ee.source,ee.scope).loadTile(ee,oe)}loadDEMTile(q,ee,oe){this.getDEMWorkerSource(q,ee.source,ee.scope).loadTile(ee,oe)}decodeRasterArray(q,ee,oe){this.getRasterArrayWorkerSource().decodeRasterArray(ee,oe)}reloadTile(q,ee,oe){ee.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,ee.type,ee.source,ee.scope).reloadTile(ee,oe)}abortTile(q,ee,oe){this.getWorkerSource(q,ee.type,ee.source,ee.scope).abortTile(ee,oe)}removeTile(q,ee,oe){this.getWorkerSource(q,ee.type,ee.source,ee.scope).removeTile(ee,oe)}removeSource(q,ee,oe){if(!(this.workerSources[q]&&this.workerSources[q][ee.scope]&&this.workerSources[q][ee.scope][ee.type]&&this.workerSources[q][ee.scope][ee.type][ee.source]))return;const Ee=this.workerSources[q][ee.scope][ee.type][ee.source];delete this.workerSources[q][ee.scope][ee.type][ee.source],Ee.removeSource!==void 0?Ee.removeSource(ee,oe):oe()}loadWorkerSource(q,ee,oe){try{this.self.importScripts(ee.url),oe()}catch(Ee){oe(Ee.toString())}}syncRTLPluginState(q,ee,oe){try{s.ee.setState(ee);const Ee=s.ee.getPluginURL();if(s.ee.isLoaded()&&!s.ee.isParsed()&&Ee!=null){this.self.importScripts(Ee);const be=s.ee.isParsed();oe(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ee}`),be)}}catch(Ee){oe(Ee.toString())}}setDracoUrl(q,ee){this.dracoUrl=ee}getAvailableImages(q,ee){this.availableImages[q]||(this.availableImages[q]={});let oe=this.availableImages[q][ee];return oe||(oe=[]),oe}getLayerIndex(q,ee){this.layerIndexes[q]||(this.layerIndexes[q]={});let oe=this.layerIndexes[q][ee];return oe||(oe=this.layerIndexes[q][ee]=new $t,oe.scope=ee),oe}getWorkerSource(q,ee,oe,Ee){return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][Ee]||(this.workerSources[q][Ee]={}),this.workerSources[q][Ee][ee]||(this.workerSources[q][Ee][ee]={}),this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),this.workerSources[q][Ee][ee][oe]||(this.workerSources[q][Ee][ee][oe]=new this.workerSourceTypes[ee]({send:(be,Ce,Y,K,se,fe)=>{this.actor.send(be,Ce,Y,q,se,fe)},scheduler:this.actor.scheduler},this.getLayerIndex(q,Ee),this.getAvailableImages(q,Ee),this.isSpriteLoaded[q][Ee],void 0,this.brightness)),this.workerSources[q][Ee][ee][oe]}rasterizeImages(q,ee,oe){const{imageTasks:Ee,scope:be}=ee,Ce={};for(const Y in Ee){const{image:K,imageIdWithOptions:se}=Ee[Y];Ce[Y]=this.imageRasterizer.rasterize(se,K,be,q)}oe(void 0,Ce)}removeRasterizedImages(q,ee,oe){const{imageIds:Ee,scope:be}=ee;this.imageRasterizer.removeImagesFromCacheByIds(Ee,be,q),oe()}getDEMWorkerSource(q,ee,oe){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][oe]||(this.demWorkerSources[q][oe]={}),this.demWorkerSources[q][oe][ee]||(this.demWorkerSources[q][oe][ee]=new De),this.demWorkerSources[q][oe][ee]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new je),this.rasterArrayWorkerSource}enforceCacheSizeLimit(q,ee){s.ef(ee)}getWorkerPerformanceMetrics(q,ee,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ds(self)),ds}),Pi(["./shared"],function(s){var xn="3.10.0";const tn={create:"create",load:"load",fullLoad:"fullLoad"},ti={mark(l){performance.mark(l)},measure(l,t,n){performance.measure(l,t,n)}};function $t(l){const t=l.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var et,yi={},ct=function(){if(et)return yi;function l(u){return!t(u)}function t(u){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,S=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(S);try{x=new Worker(C),g=!0}catch(L){g=!1}return x&&x.terminate(),URL.revokeObjectURL(C),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var S=x.getImageData(0,0,1,1);return S&&S.width===g.width}()?(n[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(n[p]=function(g){var x,S=function(C){var L=document.createElement("canvas"),R=Object.create(l.webGLContextAttributes);return R.failIfMajorPerformanceCaveat=C,L.getContext("webgl2",R)}(g);if(!S)return!1;try{x=S.createShader(S.VERTEX_SHADER)}catch(C){return!1}return!(!x||S.isContextLost())&&(S.shaderSource(x,"void main() {}"),S.compileShader(x),S.getShaderParameter(x,S.COMPILE_STATUS)===!0)}(p)),n[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}et=1,yi.supported=l,yi.notSupportedReason=t;var n={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},yi}();function Qt(l,t,n){const u=document.createElement(l);return t!=null&&(u.className=t),n&&n.appendChild(u),u}function Ii(l,t,n){const u=document.createElementNS("http://www.w3.org/2000/svg",l);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return n&&n.appendChild(u),u}const Yi=typeof document!="undefined"?document.documentElement&&document.documentElement.style:null,We=Yi&&Yi.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ot;function dt(){Yi&&We&&(ot=Yi[We],Yi[We]="none")}function vt(){Yi&&We&&(Yi[We]=ot)}function Be(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",Be,!0)}function Ie(){window.addEventListener("click",Be,!0),window.setTimeout(()=>{window.removeEventListener("click",Be,!0)},0)}function Ue(l,t){const n=l.getBoundingClientRect();return je(l,n,t)}function qe(l,t){const n=l.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(je(l,n,t[p]));return u}function De(l){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&l.button===2&&l.ctrlKey?0:l.button}function je(l,t,n){const u=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new s.P((n.clientX-t.left)*u,(n.clientY-t.top)*u)}const Pt="01",ki="NO_ACCESS_TOKEN";class bi{constructor(t,n,u){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let u=0;u<10;u++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Pt,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!s.f(t))return t;const u=hr(t);return u.params.push(`sdk=js-${xn}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!s.f(t))return t;const u=hr(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeModelURL(t,n){if(!s.f(t))return t;const u=hr(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeSourceURL(t,n,u,p){if(!s.f(t))return t;const g=hr(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),u&&g.params.push(`language=${u}`),p&&g.params.push(`worldview=${p}`),this._makeAPIURL(g,this._customAccessToken||n)}normalizeIconsetURL(t,n){const u=hr(t);return s.f(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||n)):Xn(u)}normalizeSpriteURL(t,n,u,p){const g=hr(t);return s.f(t)?(g.path=`/styles/v1${g.path}/sprite${n}${u}`,this._makeAPIURL(g,this._customAccessToken||p)):(g.path+=`${n}${u}`,Xn(g))}normalizeTileURL(t,n,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.f(t))return t;const p=hr(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||u&&p.authority!=="raster"&&u===512?"@2x":""}${s.m.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${s.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${s.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${s.e.TILE_URL_VERSION}${p.path}`);const g=this._customAccessToken||function(x){for(const S of x){const C=S.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(p.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,g)}canonicalizeTileURL(t,n){const u=hr(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let g=u.params;return n&&(g=g.filter(x=>!x.match(/^access_token=/))),g.length&&(p+=`?${g.join("&")}`),p}canonicalizeTileset(t,n){const u=!!n&&s.f(n),p=[];for(const g of t.tiles||[])s.h(g)?p.push(this.canonicalizeTileURL(g,u)):p.push(g);return p}_makeAPIURL(t,n){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=hr(s.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Xn(t);if(n=n||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(g=>g.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),Xn(t)}}const ji=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function hr(l){const t=l.match(ji);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Xn(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const rn="mapbox.eventData";function Ot(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.j(t[1]))}catch(n){return null}}class at{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=Ot(s.e.ACCESS_TOKEN);let u="";return u=n&&n.u?s.k(n.u):s.e.ACCESS_TOKEN||"",t?`${rn}.${t}:${u}`:`${rn}:${u}`}fetchEventData(){const t=s.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(n);p&&(this.eventData=JSON.parse(p));const g=localStorage.getItem(u);g&&(this.anonId=g)}catch(p){s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch(g){s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,u,p){if(!s.e.EVENTS_URL)return;const g=hr(s.e.EVENTS_URL);g.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(t).toISOString()},S=n?s.l(x,n):x,C={url:Xn(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=s.p(C,L=>{this.pendingRequest=null,u(L),this.saveEventData(),this.processRequests(p)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Ht=new class extends at{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some(n=>s.f(n)||s.h(n))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ot(s.e.ACCESS_TOKEN),n=t?t.u:s.e.ACCESS_TOKEN;let u=n!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),x=new Date(p),S=(p-this.eventData.lastSuccess)/864e5;u=u||S>=1||S<-1||g.getDate()!==x.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:xn,skuId:Pt,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=n)},l):this.processRequests()}},Qi=Ht.postTurnstileEvent.bind(Ht),vi=new class extends at{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,n,u){this.skuToken=t,this.errorCb=u,s.e.EVENTS_URL&&(n||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},n):this.errorCb(new Error(ki)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:xn,skuId:Pt,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},l))}remove(){this.errorCb=null}},Mn=vi.postMapLoadEvent.bind(vi),gr=new class extends at{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=s.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:n,style:u,importedStyles:p}=t;if(!s.e.EVENTS_URL||!l&&!s.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(n),x={mapInstanceId:g,eventId:this.getEventId(g),style:u};p.length&&(x.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:x},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},l)}},Hn=gr.postStyleLoadEvent.bind(gr),kr=new class extends at{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){s.e.EVENTS_URL&&(l||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),u=function(p){const g=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),S=function(V){const J={};if(V){for(const X in V)if(X!=="other")for(const ie of V[X]){const te=`${X}ResolveRangeMin`,le=`${X}ResolveRangeMax`,we=`${X}RequestCount`,ve=`${X}RequestCachedCount`;J[te]=Math.min(J[te]||1/0,ie.startTime),J[le]=Math.max(J[le]||-1/0,ie.responseEnd);const ze=Ae=>{J[Ae]===void 0&&(J[Ae]=0),++J[Ae]};ie.transferSize!==void 0&&ie.transferSize===0&&ze(ve),ze(we)}}return J}(function(V,J){const X={};if(V)for(const ie of V){const te=J(ie);X[te]===void 0&&(X[te]=[]),X[te].push(ie)}return X}(g,$t)),C=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,R=L?L.effectiveType:void 0,z={counters:[],metadata:[],attributes:[]},N=(V,J,X)=>{X!=null&&V.push({name:J,value:X.toString()})};for(const V in S)N(z.counters,V,S[V]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(N(z.counters,"interactionRangeMin",p.interactionRange[0]),N(z.counters,"interactionRangeMax",p.interactionRange[1])),x)for(const V of Object.keys(tn)){const J=tn[V],X=x.find(ie=>ie.name===J);X&&N(z.counters,J,X.startTime)}return N(z.counters,"visibilityHidden",p.visibilityHidden),N(z.attributes,"style",function(V){if(V)for(const J of V){const X=J.name.split("?")[0];if(s.i(X)){const ie=X.split("/").slice(-2);if(ie.length===2)return`mapbox://styles/${ie[0]}/${ie[1]}`}}}(g)),N(z.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),N(z.attributes,"fogEnabled",p.fogEnabled?"true":"false"),N(z.attributes,"projection",p.projection),N(z.attributes,"zoom",p.zoom),N(z.metadata,"devicePixelRatio",C),N(z.metadata,"connectionEffectiveType",R),N(z.metadata,"navigatorUserAgent",navigator.userAgent),N(z.metadata,"screenWidth",window.screen.width),N(z.metadata,"screenHeight",window.screen.height),N(z.metadata,"windowWidth",window.innerWidth),N(z.metadata,"windowHeight",window.innerHeight),N(z.metadata,"mapWidth",p.width/C),N(z.metadata,"mapHeight",p.height/C),N(z.metadata,"webglRenderer",p.renderer),N(z.metadata,"webglVendor",p.vendor),N(z.metadata,"sdkVersion",xn),N(z.metadata,"sdkIdentifier","mapbox-gl-js"),z}(n);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},l)}},Dt=kr.postPerformanceEvent.bind(kr),Ls=new class extends at{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,n,u){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const p=hr(s.e.API_URL+s.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||s.e.ACCESS_TOKEN||""}`);const g={url:Xn(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(g,x=>{this.pendingRequest=null,n(x),this.saveEventData(),this.processRequests(u)})}getSessionAPI(l,t,n,u){this.skuToken=t,this.errorCb=u,s.e.SESSION_PATH&&s.e.API_URL&&(n||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},n):this.errorCb(new Error(ki)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},l)}remove(){this.errorCb=null}},Pe=Ls.getSessionAPI.bind(Ls),$n=new Set;function lt(l,t){t?$n.add(l):$n.delete(l)}class cs{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Xi(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class vs extends s.E{constructor(t){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.I),this._imageRasterizer}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new s.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,n){if(this.loaded[n]!==t&&(this.loaded[n]=t,t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,n,p);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images[n][t]}addImage(t,n,u){this._validate(t,u)&&(this.images[n][t]=u)}_validate(t,n){let u=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new s.y(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new s.y(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(n.content,n)||(this.fire(new s.y(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,n){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||n<p[1])return!1;u=p[1]}return!0}_validateContent(t,n){return t?t.length!==4||!n.usvg&&(t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,n,u){u.version=this.images[n][t].version+1,this.images[n][t]=u,this.updatedImages[n][t]=!0,this.removeFromImageRasterizerCache(t,n)}removeFromImageRasterizerCache(t,n){this.spriteFormat!=="raster"&&(s.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(t,n){const u=this.images[n][t];delete this.images[n][t],delete this.patterns[n][t],this.removeFromImageRasterizerCache(t,n),u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,n,u){let p=!0;const g=!!this.loaded[n];if(!g)for(const x of t)this.images[n][x]||(p=!1);g||p?this._notify(t,n,u):this.requestors.push({ids:t,scope:n,callback:u})}rasterizeImages({scope:t,imageTasks:n},u){const p={};for(const g in n){const x=n[g],S=this.getImage(x.id,t);S&&(p[g]={image:S,imageIdWithOptions:x})}s.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:p,scope:t},u):this.rasterizeImagesInMainThread({imageTasks:p,scope:t},u)}rasterizeImagesInMainThread(t,n){const{imageTasks:u,scope:p}=t,g={};for(const x in u){const{image:S,imageIdWithOptions:C}=u[x];g[x]=this.imageRasterizer.rasterize(C,S,p,"")}n(void 0,g)}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,n,u){const p={};for(const g of t){this.images[n][g]||this.fire(new s.z("styleimagemissing",{id:g}));const x=this.images[n][g];x?p[g]={data:x.usvg?null:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,usvg:x.usvg,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:s.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,p)}getPixelSize(t){const{width:n,height:u}=this.atlasImage[t];return{width:n,height:u}}getPattern(t,n,u){const p=this.patterns[n][t],g=this.getImage(t,n);if(!g)return null;if(p&&p.position.version===g.version)return p.position;if(p)p.position.version=g.version;else{g.usvg&&!g.data&&(g.data=this.imageRasterizer.rasterize(s.A.from(t).getPrimary(),g,n,""));const x={w:g.data.width+2*s.B,h:g.data.height+2*s.B,x:0,y:0},S=new s.C(x,g,s.B);this.patterns[n][t]={bin:x,position:S}}return this._updatePatternAtlas(n,u),this.patterns[n][t].position}bind(t,n){const u=t.gl;let p=this.atlasTexture[n];p?this.dirty&&(p.update(this.atlasImage[n]),this.dirty=!1):(p=new s.T(t,this.atlasImage[n],u.RGBA8),this.atlasTexture[n]=p),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const u=[];for(const S in this.patterns[t])u.push(this.patterns[t][S].bin);const{w:p,h:g}=s.F(u),x=this.atlasImage[t];x.resize({width:p||1,height:g||1});for(const S in this.patterns[t]){const{bin:C,position:L}=this.patterns[t][S];let R=L.padding;const z=C.x+R,N=C.y+R,V=this.images[t][S].data,J=V.width,X=V.height;R=R>1?R-1:R,s.r.copy(V,x,{x:0,y:0},{x:z,y:N},{width:J,height:X},n),s.r.copy(V,x,{x:0,y:X-R},{x:z,y:N-R},{width:J,height:R},n),s.r.copy(V,x,{x:0,y:0},{x:z,y:N+X},{width:J,height:R},n),s.r.copy(V,x,{x:J-R,y:0},{x:z-R,y:N},{width:R,height:X},n),s.r.copy(V,x,{x:0,y:0},{x:z+J,y:N},{width:R,height:X},n),s.r.copy(V,x,{x:J-R,y:X-R},{x:z-R,y:N-R},{width:R,height:R},n),s.r.copy(V,x,{x:0,y:X-R},{x:z+J,y:N-R},{width:R,height:R},n),s.r.copy(V,x,{x:0,y:0},{x:z+J,y:N+X},{width:R,height:R},n),s.r.copy(V,x,{x:J-R,y:0},{x:z-R,y:N+X},{width:R,height:R},n)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,n){for(const u of t){if(this.callbackDispatchedThisFrame[n][u])continue;this.callbackDispatchedThisFrame[n][u]=!0;const p=this.images[n][u];Xi(p)&&this.updateImage(u,n,p)}}}function Bs(l){const t=l.key,n=l.value,u=l.valueSpec||{},p=l.objectElementValidators||{},g=l.style,x=l.styleSpec;let S=[];const C=s.H(n);if(C!=="object")return[new s.V(t,n,`object expected, ${C} found`)];for(const L in n){const R=L.split(".")[0];let z;p[R]?z=p[R]:u[R]?z=ur:p["*"]?z=p["*"]:u["*"]&&(z=ur),z?S=S.concat(z({key:(t&&`${t}.`)+L,value:n[L],valueSpec:u[R]||u["*"],style:g,styleSpec:x,object:n,objectKey:L},n)):S.push(new s.G(t,n[L],`unknown property "${L}"`))}for(const L in u)p[L]||u[L].required&&u[L].default===void 0&&n[L]===void 0&&S.push(new s.V(t,n,`missing required property "${L}"`));return S}function Xs(l){const t=l.value,n=l.valueSpec,u=l.style,p=l.styleSpec,g=l.key,x=l.arrayElementValidator||ur;if(s.H(t)!=="array")return[new s.V(g,t,`array expected, ${s.H(t)} found`)];if(n.length&&t.length!==n.length)return[new s.V(g,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new s.V(g,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let S={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};p.$version<7&&(S.function=n.function),s.H(n.value)==="object"&&(S=n.value);let C=[];for(let L=0;L<t.length;L++)C=C.concat(x({array:t,arrayIndex:L,value:t[L],valueSpec:S,style:u,styleSpec:p,key:`${g}[${L}]`},!0));return C}function Sr(l){const t=l.key,n=l.value,u=l.valueSpec;let p=s.H(n);if(p==="number"&&n!=n&&(p="NaN"),p!=="number")return[new s.V(t,n,`number expected, ${p} found`)];if("minimum"in u){let g=u.minimum;if(s.H(u.minimum)==="array"&&(g=u.minimum[l.arrayIndex]),n<g)return[new s.V(t,n,`${n} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if(s.H(u.maximum)==="array"&&(g=u.maximum[l.arrayIndex]),n>g)return[new s.V(t,n,`${n} is greater than the maximum value ${g}`)]}return[]}function un(l){const t=l.valueSpec,n=s.K(l.value.type);let u,p,g,x={};const S=n!=="categorical"&&l.value.property===void 0,C=!S,L=s.H(l.value.stops)==="array"&&s.H(l.value.stops[0])==="array"&&s.H(l.value.stops[0][0])==="object",R=Bs({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(V){if(n==="identity")return[new s.V(V.key,V.value,'identity function may not have a "stops" property')];let J=[];const X=V.value;return J=J.concat(Xs({key:V.key,value:X,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:z})),s.H(X)==="array"&&X.length===0&&J.push(new s.V(V.key,X,"array must have at least one stop")),J},default:function(V){return ur({key:V.key,value:V.value,valueSpec:t,style:V.style,styleSpec:V.styleSpec})}}});return n==="identity"&&S&&R.push(new s.V(l.key,l.value,'missing required property "property"')),n==="identity"||l.value.stops||R.push(new s.V(l.key,l.value,'missing required property "stops"')),n==="exponential"&&l.valueSpec.expression&&!s.L(l.valueSpec)&&R.push(new s.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(C&&!s.M(l.valueSpec)?R.push(new s.V(l.key,l.value,"property functions not supported")):S&&!s.N(l.valueSpec)&&R.push(new s.V(l.key,l.value,"zoom functions not supported"))),n!=="categorical"&&!L||l.value.property!==void 0||R.push(new s.V(l.key,l.value,'"property" property is required')),R;function z(V){let J=[];const X=V.value,ie=V.key;if(s.H(X)!=="array")return[new s.V(ie,X,`array expected, ${s.H(X)} found`)];if(X.length!==2)return[new s.V(ie,X,`array length 2 expected, length ${X.length} found`)];if(L){if(s.H(X[0])!=="object")return[new s.V(ie,X,`object expected, ${s.H(X[0])} found`)];if(X[0].zoom===void 0)return[new s.V(ie,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new s.V(ie,X,"object stop key must have value")];const te=s.K(X[0].zoom);if(typeof te!="number")return[new s.V(ie,X[0].zoom,"stop zoom values must be numbers")];if(g&&g>te)return[new s.V(ie,X[0].zoom,"stop zoom values must appear in ascending order")];te!==g&&(g=te,p=void 0,x={}),J=J.concat(Bs({key:`${ie}[0]`,value:X[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Sr,value:N}}))}else J=J.concat(N({key:`${ie}[0]`,value:X[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},X));return s.O(s.Q(X[1]))?J.concat([new s.V(`${ie}[1]`,X[1],"expressions are not allowed in function stops.")]):J.concat(ur({key:`${ie}[1]`,value:X[1],valueSpec:t,style:V.style,styleSpec:V.styleSpec}))}function N(V,J){const X=s.H(V.value),ie=s.K(V.value),te=V.value!==null?V.value:J;if(u){if(X!==u)return[new s.V(V.key,te,`${X} stop domain type must match previous stop domain type ${u}`)]}else u=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof ie!="number"&&typeof ie!="string"&&typeof ie!="boolean")return[new s.V(V.key,te,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&n!=="categorical"){let le=`number expected, ${X} found`;return s.M(t)&&n===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(V.key,te,le)]}return n!=="categorical"||X!=="number"||typeof ie=="number"&&isFinite(ie)&&Math.floor(ie)===ie?n!=="categorical"&&X==="number"&&typeof ie=="number"&&typeof p=="number"&&p!==void 0&&ie<p?[new s.V(V.key,te,"stop domain values must appear in ascending order")]:(p=ie,n==="categorical"&&ie in x?[new s.V(V.key,te,"stop domain values must be unique")]:(x[ie]=!0,[])):[new s.V(V.key,te,`integer expected, found ${String(ie)}`)]}}function ys(l){const t=(l.expressionContext==="property"?s.S:s.U)(s.Q(l.value),l.valueSpec);if(t.result==="error")return t.value.map(u=>new s.V(`${l.key}${u.key}`,l.value,u.message));const n=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!n.outputDefined())return[new s.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!s.W(n))return[new s.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return Hs(n,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!s.X(n,["zoom","feature-state"]))return[new s.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!s.Y(n))return[new s.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hs(l,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)n.delete(p);if(n.size===0)return[];const u=[];return l instanceof s.Z&&n.has(l.name)?[new s.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild(p=>{u.push(...Hs(p,t))}),u)}function ls(l){const t=l.key,n=l.value,u=l.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(s.K(n))===-1&&p.push(new s.V(t,n,`expected one of [${u.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(u.values).indexOf(s.K(n))===-1&&p.push(new s.V(t,n,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(n)} found`)),p}function Rs(l){return s.$(s.Q(l.value))?ys(s.J({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):cn(l)}function cn(l){const t=l.value,n=l.key;if(s.H(t)!=="array")return[new s.V(n,t,`array expected, ${s.H(t)} found`)];const u=l.styleSpec;let p,g=[];if(t.length<1)return[new s.V(n,t,"filter array must have at least 1 element")];switch(g=g.concat(ls({key:`${n}[0]`,value:t[0],valueSpec:u.filter_operator,style:l.style,styleSpec:l.styleSpec})),s.K(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.K(t[1])==="$type"&&g.push(new s.V(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new s.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=s.H(t[1]),p!=="string"&&g.push(new s.V(`${n}[1]`,t[1],`string expected, ${p} found`)));for(let x=2;x<t.length;x++)p=s.H(t[x]),s.K(t[1])==="$type"?g=g.concat(ls({key:`${n}[${x}]`,value:t[x],valueSpec:u.geometry_type,style:l.style,styleSpec:l.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new s.V(`${n}[${x}]`,t[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)g=g.concat(cn({key:`${n}[${x}]`,value:t[x],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":p=s.H(t[1]),t.length!==2?g.push(new s.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new s.V(`${n}[1]`,t[1],`string expected, ${p} found`))}return g}function Jr(l,t){const n=l.key,u=l.style,p=l.layer,g=l.styleSpec,x=l.value,S=l.objectKey,C=g[`${t}_${l.layerType}`];if(!C)return[];const L=S.match(/^(.*)-use-theme$/);if(t==="paint"&&L&&C[L[1]])return s.O(x)?[].concat(ur({key:l.key,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:S})):ur({key:n,value:x,valueSpec:{type:"string"},style:u,styleSpec:g});const R=S.match(/^(.*)-transition$/);if(t==="paint"&&R&&C[R[1]]&&C[R[1]].transition)return ur({key:n,value:x,valueSpec:g.transition,style:u,styleSpec:g});const z=l.valueSpec||C[S];if(!z)return[new s.G(n,x,`unknown property "${S}"`)];let N;if(s.H(x)==="string"&&s.M(z)&&!z.tokens&&(N=/^{([^}]+)}$/.exec(x))){const J=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new s.V(n,x,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${J}.`)]}const V=[];if(l.layerType==="symbol")S!=="text-field"||!u||u.glyphs||u.imports||V.push(new s.V(n,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&s.a0(s.Q(x))&&s.K(x.type)==="identity"&&V.push(new s.V(n,x,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&s.M(z)&&(s.a1(z)||s.N(z))){const J=s.S(s.Q(x),z),X=J.value.expression||J.value._styleExpression.expression;X&&!s.X(X,["measure-light"])&&(S==="model-emissive-strength"&&s.Y(X)&&s.W(X)||V.push(new s.V(n,x,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return V.concat(ur({key:l.key,value:x,valueSpec:z,style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:S}))}function Pr(l){return Jr(l,"paint")}function Ts(l){return Jr(l,"layout")}function Dn(l){let t=[];const n=l.value,u=l.key,p=l.style,g=l.styleSpec;n.type||n.ref||t.push(new s.V(u,n,'either "type" or "ref" is required'));let x=s.K(n.type);const S=s.K(n.ref);if(n.id){const C=s.K(n.id);for(let L=0;L<l.arrayIndex;L++){const R=p.layers[L];s.K(R.id)===C&&t.push(new s.V(u,n.id,`duplicate layer id "${n.id}", previously used at line ${R.id.__line__}`))}}if("ref"in n){let C;["type","source","source-layer","filter","layout"].forEach(L=>{L in n&&t.push(new s.V(u,n[L],`"${L}" is prohibited for ref layers`))}),p.layers.forEach(L=>{s.K(L.id)===S&&(C=L)}),C?C.ref?t.push(new s.V(u,n.ref,"ref cannot reference another ref layer")):x=s.K(C.type):typeof S=="string"&&t.push(new s.V(u,n.ref,`ref layer "${S}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(n.source){const C=p.sources&&p.sources[n.source],L=C&&s.K(C.type);C?L==="vector"&&x==="raster"?t.push(new s.V(u,n.source,`layer "${n.id}" requires a raster source`)):L==="raster"&&x!=="raster"?t.push(new s.V(u,n.source,`layer "${n.id}" requires a vector source`)):L!=="vector"||n["source-layer"]?L==="raster-dem"&&x!=="hillshade"?t.push(new s.V(u,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||L==="geojson"&&C.lineMetrics?x==="raster-particle"&&L!=="raster-array"&&t.push(new s.V(u,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new s.V(u,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new s.V(u,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(u,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new s.V(u,n.source,`source "${n.source}" not found`))}else t.push(new s.V(u,n,'missing required property "source"'));return t=t.concat(Bs({key:u,value:n,valueSpec:g.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ur({key:`${u}.type`,value:n.type,valueSpec:g.layer.type,style:l.style,styleSpec:l.styleSpec,object:n,objectKey:"type"}),filter:C=>Rs(s.J({layerType:x},C)),layout:C=>Bs({layer:n,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":L=>Ts(s.J({layerType:x},L))}}),paint:C=>Bs({layer:n,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":L=>Pr(s.J({layerType:x,layer:n},L))}})}})),t}function xs(l){const t=l.value,n=l.key,u=s.H(t);return u!=="string"?[new s.V(n,t,`string expected, ${u} found`)]:[]}const Gn={promoteId:function l({key:t,value:n}){if(s.H(n)==="string")return xs({key:t,value:n});if(Array.isArray(n)){const u=[],p=s.Q(n),g=s.U(p);return g.result==="error"&&g.value.forEach(x=>{u.push(new s.V(`${t}${x.key}`,null,`${x.message}`))}),s.X(g.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const p in n)u.push(...l({key:`${t}.${p}`,value:n[p]}));return u}}};function Ir(l){const t=l.value,n=l.key,u=l.styleSpec,p=l.style;if(!t.type)return[new s.V(n,t,'"type" is required')];const g=s.K(t.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(t.url||t.tiles||x.push(new s.G(n,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Bs({key:n,value:t,valueSpec:u[`source_${g.replace("-","_")}`],style:l.style,styleSpec:u,objectElementValidators:Gn})),x;case"geojson":if(x=Bs({key:n,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:Gn}),t.cluster)for(const S in t.clusterProperties){const[C,L]=t.clusterProperties[S],R=typeof C=="string"?[C,["accumulated"],["get",S]]:C;x.push(...ys({key:`${n}.${S}.map`,value:L,expressionContext:"cluster-map"})),x.push(...ys({key:`${n}.${S}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return x;case"video":return Bs({key:n,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return Bs({key:n,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new s.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ls({key:`${n}.type`,value:t.type,valueSpec:{values:fo(u)},style:p,styleSpec:u})}}function fo(l){return l.source.reduce((t,n)=>{const u=l[n];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function ms(l){const t=l.value,n=l.styleSpec,u=n.light,p=l.style;let g=[];const x=s.H(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new s.V("light",t,`object expected, ${x} found`)]),g;for(const S in t){const C=S.match(/^(.*)-transition$/),L=S.match(/^(.*)-use-theme$/);g=g.concat(L&&u[L[1]]?ur({key:S,value:t[S],valueSpec:{type:"string"},style:p,styleSpec:n}):C&&u[C[1]]&&u[C[1]].transition?ur({key:S,value:t[S],valueSpec:n.transition,style:p,styleSpec:n}):u[S]?ur({key:S,value:t[S],valueSpec:u[S],style:p,styleSpec:n}):[new s.V(S,t[S],`unknown property "${S}"`)])}return g}function Co(l){const t=l.value;let n=[];if(!t)return n;const u=s.H(t);if(u!=="object")return n=n.concat([new s.V("light-3d",t,`object expected, ${u} found`)]),n;const p=l.styleSpec,g=p["light-3d"],x=l.key,S=l.style,C=l.style.lights;for(const z of["type","id"])if(!(z in t))return n=n.concat([new s.V("light-3d",t,`missing property ${z} on light`)]),n;if(t.type&&C)for(let z=0;z<l.arrayIndex;z++){const N=s.K(t.type),V=C[z];s.K(V.type)===N&&n.push(new s.V(x,t.id,`duplicate light type "${t.type}", previously defined at line ${V.id.__line__}`))}const L=`properties_light_${t.type}`;if(!(L in p))return n=n.concat([new s.V("light-3d",t,`Invalid light type ${t.type}`)]),n;const R=p[L];for(const z in t)if(z==="properties"){const N=t[z],V=s.H(N);if(V!=="object")return n=n.concat([new s.V("properties",N,`object expected, ${V} found`)]),n;for(const J in N)n=n.concat(R[J]?ur({key:J,value:N[J],valueSpec:R[J],style:S,styleSpec:p}):[new s.G(l.key,N[J],`unknown property "${J}"`)])}else{const N=z.match(/^(.*)-transition$/),V=z.match(/^(.*)-use-theme$/);n=n.concat(V&&g[V[1]]?ur({key:z,value:t[z],valueSpec:{type:"string"},style:S,styleSpec:p}):N&&g[N[1]]&&g[N[1]].transition?ur({key:z,value:t[z],valueSpec:p.transition,style:S,styleSpec:p}):g[z]?ur({key:z,value:t[z],valueSpec:g[z],style:S,styleSpec:p}):[new s.G(z,t[z],`unknown property "${z}"`)])}return n}function mr(l){const t=l.value,n=l.key,u=l.style,p=l.styleSpec,g=p.terrain;let x=[];const S=s.H(t);if(t===void 0||S==="null")return x;if(S!=="object")return x=x.concat([new s.V("terrain",t,`object expected, ${S} found`)]),x;for(const C in t){const L=C.match(/^(.*)-transition$/),R=C.match(/^(.*)-use-theme$/);x=x.concat(R&&g[R[1]]?ur({key:C,value:t[C],valueSpec:{type:"string"},style:u,styleSpec:p}):L&&g[L[1]]&&g[L[1]].transition?ur({key:C,value:t[C],valueSpec:p.transition,style:u,styleSpec:p}):g[C]?ur({key:C,value:t[C],valueSpec:g[C],style:u,styleSpec:p}):[new s.G(C,t[C],`unknown property "${C}"`)])}if(t.source){const C=u.sources&&u.sources[t.source],L=C&&s.K(C.type);C?L!=="raster-dem"&&x.push(new s.V(n,t.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):x.push(new s.V(n,t.source,`source "${t.source}" not found`))}else x.push(new s.V(n,t,'terrain is missing required property "source"'));return x}function Ss(l){const t=l.value,n=l.style,u=l.styleSpec,p=u.fog;let g=[];const x=s.H(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new s.V("fog",t,`object expected, ${x} found`)]),g;for(const S in t){const C=S.match(/^(.*)-transition$/),L=S.match(/^(.*)-use-theme$/);g=g.concat(L&&p[L[1]]?ur({key:S,value:t[S],valueSpec:{type:"string"},style:n,styleSpec:u}):C&&p[C[1]]&&p[C[1]].transition?ur({key:S,value:t[S],valueSpec:u.transition,style:n,styleSpec:u}):p[S]?ur({key:S,value:t[S],valueSpec:p[S],style:n,styleSpec:u}):[new s.G(S,t[S],`unknown property "${S}"`)])}return g}const ks={"*":()=>[],array:Xs,boolean:function(l){const t=l.value,n=l.key,u=s.H(t);return u!=="boolean"?[new s.V(n,t,`boolean expected, ${u} found`)]:[]},number:Sr,color:function(l){const t=l.key,n=l.value,u=s.H(n);return u!=="string"?[new s.V(t,n,`color expected, ${u} found`)]:s._.parseCSSColor(n)===null?[new s.V(t,n,`color expected, "${n}" found`)]:[]},enum:ls,filter:Rs,function:un,layer:Dn,object:Bs,source:Ir,model:s.a2,light:ms,"light-3d":Co,terrain:mr,fog:Ss,string:xs,formatted:function(l){return xs(l).length===0?[]:ys(l)},resolvedImage:function(l){return xs(l).length===0?[]:ys(l)},projection:function(l){const t=l.value,n=l.styleSpec,u=n.projection,p=l.style;let g=[];const x=s.H(t);if(x==="object")for(const S in t)g=g.concat(ur({key:S,value:t[S],valueSpec:u[S],style:p,styleSpec:n}));else x!=="string"&&(g=g.concat([new s.V("projection",t,`object or string expected, ${x} found`)]));return g},import:function(l){const{value:t,styleSpec:n}=l,x=t,{data:u}=x,p=rm(x,["data"]);Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let g=Bs(s.J({},l,{value:p,valueSpec:n.import}));return s.K(p.id)===""&&g.push(new s.V(`${l.key}.id`,p,"import id can't be an empty string")),u&&(g=g.concat(he(u,n,{key:`${l.key}.data`}))),g}};function ur(l,t=!1){const n=l.value,u=l.valueSpec,p=l.styleSpec;if(u.expression&&s.a0(s.K(n)))return un(l);if(u.expression&&s.O(s.Q(n)))return ys(l);if(u.type&&ks[u.type]){const g=ks[u.type](l);return t===!0&&g.length>0&&s.H(l.value)==="array"?ys(l):g}return Bs(s.J({},l,{valueSpec:u.type?p[u.type]:u}))}function _e(l){const t=l.value,n=l.key,u=xs(l);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new s.V(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new s.V(n,t,'"glyphs" url must include a "{range}" token'))),u}function he(l,t=s.a3,n={}){return ur({key:n.key||"",value:l,valueSpec:t.$root,styleSpec:t,style:l,objectElementValidators:{glyphs:_e,"*":()=>[]}})}function pe(l,t=s.a3){return qr(he(l,t))}const Re=l=>qr(Ir(l)),ke=l=>qr(ms(l)),ui=l=>qr(Co(l)),Vt=l=>qr(mr(l)),fi=l=>qr(Ss(l)),Zt=l=>qr(function(t){const n=t.value,u=t.style,p=t.styleSpec,g=p.snow;let x=[];const S=s.H(n);if(n===void 0)return x;if(S!=="object")return x=x.concat([new s.V("snow",n,`object expected, ${S} found`)]),x;for(const C in n){const L=C.match(/^(.*)-transition$/);x=x.concat(L&&g[L[1]]&&g[L[1]].transition?ur({key:C,value:n[C],valueSpec:p.transition,style:u,styleSpec:p}):g[C]?ur({key:C,value:n[C],valueSpec:g[C],style:u,styleSpec:p}):[new s.G(C,n[C],`unknown property "${C}"`)])}return x}(l)),en=l=>qr(function(t){const n=t.value,u=t.style,p=t.styleSpec,g=p.rain;let x=[];const S=s.H(n);if(n===void 0)return x;if(S!=="object")return x=x.concat([new s.V("rain",n,`object expected, ${S} found`)]),x;for(const C in n){const L=C.match(/^(.*)-transition$/);x=x.concat(L&&g[L[1]]&&g[L[1]].transition?ur({key:C,value:n[C],valueSpec:p.transition,style:u,styleSpec:p}):g[C]?ur({key:C,value:n[C],valueSpec:g[C],style:u,styleSpec:p}):[new s.G(C,n[C],`unknown property "${C}"`)])}return x}(l)),Un=l=>qr(Dn(l)),Bn=l=>qr(Rs(l)),Or=l=>qr(Pr(l)),hs=l=>qr(Ts(l)),Vs=l=>qr(s.a2(l));function qr(l){return l.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function ds(l,t){let n=!1;if(t&&t.length)for(const u of t)u instanceof s.G?s.w(u.message):(l.fire(new s.y(new Error(u.message))),n=!0);return n}let gt;class q extends s.E{constructor(t,n="flat"){super(),this._transitionable=new s.a4(gt||(gt=new s.a5({anchor:new s.a6(s.a3.light.anchor),position:new s.a7(s.a3.light.position),color:new s.a6(s.a3.light.color),intensity:new s.a6(s.a3.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,u={}){this._validate(ke,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&ds(this,t.call(pe,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a3})))}}let ee=class extends s.E{constructor(l,t,n,u){super(),this.scope=n,this._transitionable=new s.a4(new s.a5({source:new s.a6(s.a3.terrain.source),exaggeration:new s.a6(s.a3.terrain.exaggeration)}),n,u),this._transitionable.setTransitionOrValue(l,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new s.a8(l)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const l=this._transitionable._values.exaggeration;if(!l)return null;const t=l.value.expression;if(!t)return null;let n=-1,u=-1,p=1;for(const g of t.zoomStops)p=t.evaluate(new s.a8(g)),p>.01?(n=g,u=-1):u=g;return p<.01&&n>0&&u>n?[n,u]:null}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof s.a9}};const oe=45,Ee=65,be=.05;function Ce(l,t,n,u){const p=s.ac(oe,Ee,n),[g,x]=Y(l,u);let S=1-Math.min(1,Math.exp((t-g)/(x-g)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*p*l.alpha}function Y(l,t){const n=.5/Math.tan(.5*t);return[l.range[0]+n,l.range[1]+n]}function K(l,t,n,u,p){const g=s.ab.vec3.transformMat4([],[t,n,u],p.mercatorFogMatrix);return Ce(l,s.ab.vec3.length(g),p.pitch,p._fov)}function se(l,t,n,u,p,g,x){const S=[[n,u,0],[p,u,0],[p,g,0],[n,g,0]];let C=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const R of S){const z=s.ab.vec3.transformMat4([],R,t),N=s.ab.vec3.length(z);C=Math.min(C,N),L=Math.max(L,N)}return[Ce(l,C,x.pitch,x._fov),Ce(l,L,x.pitch,x._fov)]}class fe extends s.E{constructor(t,n,u,p){super();const g=new s.a5({range:new s.a6(s.a3.fog.range),color:new s.a6(s.a3.fog.color),"color-use-theme":new s.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a6(s.a3.fog["high-color"]),"high-color-use-theme":new s.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a6(s.a3.fog["space-color"]),"space-color-use-theme":new s.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a6(s.a3.fog["horizon-blend"]),"star-intensity":new s.a6(s.a3.fog["star-intensity"]),"vertical-range":new s.a6(s.a3.fog["vertical-range"])});this._transitionable=new s.a4(g,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new s.ad(g),this.scope=u}get state(){const t=this._transform,n=t.projection.name==="globe",u=s.ae(t.zoom),p=this.properties.get("range"),g=[.5,3];return{range:n?[s.af(g[0],p[0],u),s.af(g[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,u={}){if(this._validate(fi,t,u))return;const p=s.l({},t);for(const g of Object.keys(s.a3.fog))p[g]===void 0&&(p[g]=s.a3.fog[g].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ac(oe,Ee,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(u,p,g){const x=s.aa.fromLngLat(p),S=g.elevation?g.elevation.getAtPointOrZero(x):0;return K(u,x.x,x.y,S,g)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return se(this.state,n,0,0,s.ag,s.ag,this._transform)}getOpacityForBounds(t,n,u,p,g){return this._transform.projection.supportsFog?se(this.state,t,n,u,p,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Y(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const u of n){const p=t.points[u];let g;if(p[2]>=0)g=p;else{const x=t.points[u-4];g=s.ah(x,p,x[2]/(x[2]-p[2]))}if(K(this.state,g[0],g[1],0,this._transform)>=be)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&ds(this,t.call(pe,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a3})))}}let ce,Se,it,Ne,ut=class extends s.E{constructor(l,t,n,u){super();const p=ce||(ce=new s.a5({density:new s.a6(s.a3.snow.density),intensity:new s.a6(s.a3.snow.intensity),color:new s.a6(s.a3.snow.color),opacity:new s.a6(s.a3.snow.opacity),vignette:new s.a6(s.a3.snow.vignette),"vignette-color":new s.a6(s.a3.snow["vignette-color"]),"center-thinning":new s.a6(s.a3.snow["center-thinning"]),direction:new s.a6(s.a3.snow.direction),"flake-size":new s.a6(s.a3.snow["flake-size"])}));this._transitionable=new s.a4(p,n,new Map(u)),this.set(l,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ad(p),this.scope=n}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=s.ai(n[0]),p=-Math.max(s.ai(n[1]),.01),g=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],x=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.aj(t.r,t.g,t.b,t.a*l),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(l,t,n={}){if(this._validate(Zt,l,n))return;const u=s.l({},l);for(const p of Object.keys(s.a3.snow))u[p]===void 0&&(u[p]=s.a3.snow[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,n){return(!n||n.validate!==!1)&&ds(this,l.call(pe,s.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a3})))}},Et=class extends s.E{constructor(l,t,n,u){super();const p=Se||(Se=new s.a5({density:new s.a6(s.a3.rain.density),intensity:new s.a6(s.a3.rain.intensity),color:new s.a6(s.a3.rain.color),opacity:new s.a6(s.a3.rain.opacity),vignette:new s.a6(s.a3.rain.vignette),"vignette-color":new s.a6(s.a3.rain["vignette-color"]),"center-thinning":new s.a6(s.a3.rain["center-thinning"]),direction:new s.a6(s.a3.rain.direction),"droplet-size":new s.a6(s.a3.rain["droplet-size"]),"distortion-strength":new s.a6(s.a3.rain["distortion-strength"])}));this._transitionable=new s.a4(p,n,new Map(u)),this.set(l,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ad(p),this.scope=n}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=s.ai(n[0]),p=-Math.max(s.ai(n[1]),.01),g=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.aj(t.r,t.g,t.b,t.a*l),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(l,t,n={}){if(this._validate(en,l,n))return;const u=s.l({},l);for(const p of Object.keys(s.a3.rain))u[p]===void 0&&(u[p]=s.a3.rain[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,n){return(!n||n.validate!==!1)&&ds(this,l.call(pe,s.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a3})))}};class xt extends s.E{constructor(t,n,u,p){super(),this.scope=u,this._options=t,this.properties=new s.ad(n),this._transitionable=new s.a4(n,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Xt{constructor(t,n,u,p){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,n){let u,p;if(t instanceof s.P||typeof t[0]=="number"){const g=s.P.convert(t);u=[g],p=n.isPointAboveHorizon(g)}else{const g=s.P.convert(t[0]),x=s.P.convert(t[1]);u=[g,x],p=s.al(g,x).every(S=>n.isPointAboveHorizon(S))}return new Xt(u,n.getCameraPoint(),p,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],p=s.al(n,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(p[3]=this.cameraPoint)),s.am(p,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],p=s.al(n,u,t),g=this.cameraPoint.clone();switch(3*((g.y>n.y)+(g.y>u.y))+((g.x>n.x)+(g.x>u.x))){case 0:p[0]=g,p[4]=g.clone();break;case 1:p.splice(1,0,g);break;case 2:p[1]=g;break;case 3:p.splice(4,0,g);break;case 5:p.splice(2,0,g);break;case 6:p[3]=g;break;case 7:p.splice(3,0,g);break;case 8:p[2]=g}return p}containsTile(t,n,u,p=0){const g=t.queryPadding/n._pixelsPerMercatorPixel+1,x=u?this._bufferedCameraMercator(g,n):this._bufferedScreenMercator(g,n);let S=t.tileID.wrap+(x.unwrapped?p:0);const C=x.polygon.map(ie=>s.an(t.tileTransform,ie,S));if(!s.ao(C,0,0,s.ag,s.ag))return;S=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const L=this.screenGeometryMercator.polygon.map(ie=>s.ap(t.tileTransform,ie,S)),R=L.map(ie=>new s.P(ie[0],ie[1])),z=n.getFreeCameraOptions().position||new s.aa(0,0,0),N=s.ap(t.tileTransform,z,S),V=L.map(ie=>{const te=s.ab.vec3.sub(ie,ie,N);return s.ab.vec3.normalize(te,te),new s.aq(N,te)}),J=s.ar(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:V,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(X=s.as(C),X.min.x=s.aw(X.min.x,0,s.ag),X.min.y=s.aw(X.min.y,0,s.ag),X.max.x=s.aw(X.max.x,0,s.ag),X.max.y=s.aw(X.max.y,0,s.ag),X),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:J};var X}_bufferedScreenMercator(t,n){const u=Tn(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(g=>n.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,n){const u=Tn(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(g=>n.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,n){const u=function(g,x){const S=s.ab.mat4.multiply([],x.pixelMatrix,x.globeMatrix),C=[0,-s.ax,0,1],L=[0,s.ax,0,1],R=[0,0,0,1];s.ab.vec4.transformMat4(C,C,S),s.ab.vec4.transformMat4(L,L,S),s.ab.vec4.transformMat4(R,R,S);const z=new s.P(C[0]/C[3],C[1]/C[3]),N=new s.P(L[0]/L[3],L[1]/L[3]),V=s.au(g,z)&&C[3]<R[3],J=s.au(g,N)&&L[3]<R[3];if(!V&&!J)return null;const X=function(Le,Me,He){for(let tt=1;tt<Le.length;tt++){const Ft=nn(Me.pointCoordinate3D(Le[tt-1]).x),Mt=nn(Me.pointCoordinate3D(Le[tt]).x);if(He<0){if(Ft<Mt)return{idx:tt,t:-Ft/(Mt-1-Ft)}}else if(Mt<Ft)return{idx:tt,t:(1-Ft)/(Mt+1-Ft)}}return null}(g,x,V?-1:1);if(!X)return null;const{idx:ie,t:te}=X;let le=ie>1?vn(g.slice(0,ie),x):[],we=ie<g.length?vn(g.slice(ie),x):[];le=le.map(Le=>new s.P(nn(Le.x),Le.y)),we=we.map(Le=>new s.P(nn(Le.x),Le.y));const ve=[...le];ve.length===0&&ve.push(we[we.length-1]);const ze=s.af(ve[ve.length-1].y,(we.length===0?le[0]:we[0]).y,te);let Ae;return Ae=V?[new s.P(0,ze),new s.P(0,0),new s.P(1,0),new s.P(1,ze)]:[new s.P(1,ze),new s.P(1,1),new s.P(0,1),new s.P(0,ze)],ve.push(...Ae),we.length===0?ve.push(le[0]):ve.push(...we),{polygon:ve.map(Le=>new s.aa(Le.x,Le.y)),unwrapped:!1}}(t,n);if(u)return u;const p=function(g,x){let S=!1,C=-1/0,L=0;for(let z=0;z<g.length-1;z++)g[z].x>C&&(C=g[z].x,L=z);for(let z=0;z<g.length-1;z++){const N=(L+z)%(g.length-1),V=g[N],J=g[N+1];Math.abs(V.x-J.x)>.5&&(V.x<J.x?(V.x+=1,N===0&&(g[g.length-1].x+=1)):(J.x+=1,N+1===g.length-1&&(g[0].x+=1)),S=!0)}const R=s.at(x.center.lng);return S&&R<Math.abs(R-1)&&g.forEach(z=>{z.x-=1}),{polygon:g,unwrapped:S}}(vn(t,n).map(g=>new s.P(nn(g.x),g.y)),n);return{polygon:p.polygon.map(g=>new s.aa(g.x,g.y)),unwrapped:p.unwrapped}}}function vn(l,t){return s.av(l,n=>{const u=t.pointCoordinate3D(n);n.x=u.x,n.y=u.y},1/256)}function nn(l){return l<0?1+l%1:l%1}function Tn(l){return 100*l|0}function Kn(l,t,n,u,p){const g=function(S,C){if(S)return p(S);if(C){if(l.url&&C.tiles&&l.tiles&&delete l.tiles,C.variants){if(!Array.isArray(C.variants))return p(new Error("variants must be an array"));for(const R of C.variants){if(R==null||typeof R!="object"||R.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(R.capabilities))return p(new Error("capabilities must be an array"));if(R.capabilities.length===1&&R.capabilities[0]==="meshopt"){C=s.l(C,R);break}}}const L=s.ay(s.l({},C,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=t.canonicalizeTileset(L,l.url),p(null,L)}},x=function(S,C,L){if(!S)return null;if(!C&&!L)return S;L=L||S.worldview_default;const R=Object.values(S.language||{});if(R.length===0)return null;const z=Object.values(S.worldview||{});if(z.length===0)return null;const N=R.every(J=>J===C),V=z.every(J=>J===L);return N&&V?S:C in(S.language_options||{})||L in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null}(l.data,n,u);return x?s.q.frame(()=>g(null,x)):l.url?s.n(t.transformRequest(t.normalizeSourceURL(l.url,null,n,u),s.R.Source),g):s.q.frame(()=>{const L=l,{data:S}=L,C=rm(L,["data"]);g(null,C)})}class dr{constructor(t,n,u){this.bounds=s.az.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),u=Math.floor(s.at(this.bounds.getWest())*n),p=Math.floor(s.aA(this.bounds.getNorth())*n),g=Math.ceil(s.at(this.bounds.getEast())*n),x=Math.ceil(s.aA(this.bounds.getSouth())*n);return t.x>=u&&t.x<g&&t.y>=p&&t.y<x}}class Vn extends s.E{constructor(t,n,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.ay(n,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new s.aB}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Kn(this._options,this.map._requestManager,n,u,(p,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new s.y(p));else if(g){if(s.l(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const x of g.vector_layers)this.vectorLayerIds.push(x.id),g.worldview&&g.worldview[x.source]&&this.localizableLayerIds.add(x.id)}g.bounds&&(this.tileBounds=new dr(g.bounds,this.minzoom,this.maxzoom)),Qi(g.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(t,n){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),g=this.map._requestManager.transformRequest(p,s.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,S=x?{image:x.image.clone()}:null,C={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&s.f(u)&&(C.worldview=this.map.getWorldview()||this.worldviewDefault,C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",C,L.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",C,L.bind(this),void 0,!0);else{const R=s.aD.call({deduped:this._deduped},C,(z,N)=>{z||!N?L.call(this,z):(C.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},t.actor&&t.actor.send("loadTile",C,L.bind(this),void 0,!0))},!0);t.request={cancel:R}}function L(R,z){return delete t.request,t.aborted?n(null):R&&R.status!==404?n(R):(z&&z.resourceTiming&&(t.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&t.setExpiryData(z),t.loadVectorData(z,this.map.painter),s.aE(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Hr extends s.E{constructor(t,n,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},n),s.l(this,s.ay(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Kn(this._options,this.map._requestManager,null,null,(n,u)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new s.y(n)):u&&(s.l(this,u),u.raster_layers&&(this.rasterLayers=u.raster_layers,this.rasterLayerIds=this.rasterLayers.map(p=>p.id)),u.bounds&&(this.tileBounds=new dr(u.bounds,this.minzoom,this.maxzoom)),Qi(u.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const u=s.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=s.o(this.map._requestManager.transformRequest(p,s.R.Tile),(g,x,S,C)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):g?(t.state="errored",n(g)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:C}),t.setTexture(x,this.map.painter),t.state="loaded",s.aE(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Mr extends Hr{constructor(t,n,u,p){super(t,n,u,p),this.type="raster-array",this.maxzoom=22,this._options=s.l({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);n&&n.enabled&&u&&n._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,s.R.Tile);t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(g,x,S,C)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(g)return g.code===20?void 0:(t.state="errored",n(g));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:C}),t.state="empty",n(null)})}unloadTile(t,n){const u=t.texture;u&&u instanceof s.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,n,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(n,u,(p,g)=>{if(p)return t.state="errored",this.fire(new s.y(p)),void this.triggerRepaint(t);g&&(t.setTexture(g,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:g})=>g===t),u=n&&n.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,n,u){if(!t)return;const p=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let g=null;n instanceof s.aH?g=n.paint.get("raster-array-band"):n instanceof s.aI&&(g=n.paint.get("raster-particle-array-band"));const x=g||this.getInitialBand(p);if(x!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,x)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,x)}}const zs={vector:Vn,raster:Hr,"raster-dem":class extends Hr{constructor(l,t,n,u){super(l,t,n,u),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const n=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,g){p&&(l.state="errored",t(p)),g&&(l.dem=g,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=s.o(this.map._requestManager.transformRequest(n,s.R.Tile),function(p,g,x,S){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(p)l.state="errored",t(p);else if(g){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:x,expires:S});const C=ImageBitmap&&g instanceof ImageBitmap&&s.t(),L=1-(g.width-s.aF(g.width))/2;L<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const R=C?g:s.q.getImageData(g,L),z={uid:l.uid,coord:l.tileID,source:this.id,scope:this.scope,rawImageData:R,encoding:this.encoding,padding:L};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",z,u.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const t=l.canonical,n=Math.pow(2,t.z),u=(t.x-1+n)%n,p=t.x===0?l.wrap-1:l.wrap,g=(t.x+1+n)%n,x=t.x+1===n?l.wrap+1:l.wrap,S={};return S[new s.aG(l.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},S[new s.aG(l.overscaledZ,x,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(S[new s.aG(l.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},S[new s.aG(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new s.aG(l.overscaledZ,x,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<n&&(S[new s.aG(l.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},S[new s.aG(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new s.aG(l.overscaledZ,x,t.z,g,t.y+1).key]={backfilled:!1}),S}},"raster-array":Mr,geojson:class extends s.E{constructor(l,t,n,u){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(u),this._data=t.data,this._options=s.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=s.ag/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:s.ag,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.ag,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of l.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,n,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:n},u),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=s.l({append:l},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(s.q.resolveURL(n),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new s.y(u));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(g.resourceTiming=p.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new s.z("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const l=s.aC(this.id,this.scope);this.map.style.clearSource(l),this._updateWorkerData()}loadTile(l,t){const n=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,g=this._partialReload,x={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:g};l.request=this.actor.send(n,x,(S,C)=>g&&!C?(l.state="loaded",t(null)):(delete l.request,l.destroy(),l.aborted?t(null):S?t(S):(l.loadVectorData(C,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aJ{constructor(l,t,n,u){super(l,t,n,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aK(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new s.y(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aJ,model:class extends s.E{constructor(l,t,n,u){super(),this.id=l,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const l=[];for(const t in this._options.models){const n=this._options.models[t],u=s.aM(this.map._requestManager.transformRequest(n.uri,s.R.Model).url).then(p=>{if(!p)return;const g=s.aN(p),x=new s.aO(t,n.position,n.orientation,g);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(p=>{this.fire(new s.y(new Error(`Could not load model ${t} from ${n.uri}: ${p.message}`)))});l.push(u)}return Promise.allSettled(l).then(()=>{this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new s.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(l){this.map=l,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(l,t){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(l,t,n,u){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(l){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=Kn(this._options,this.map._requestManager,t,n,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new s.y(u))):p&&(s.l(this,p),p.bounds&&(this.tileBounds=new dr(p.bounds,this.minzoom,this.maxzoom)),Qi(p.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),l&&l(u)})}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const n=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(n,s.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const g=Object.values(l.buckets);for(const x of g)x.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",u,p.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(g,x){return l.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&x&&l.setExpiryData(x),l.loadModelData(x,this.map.painter),l.state="loaded",void t(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aJ{constructor(l,t,n,u){super(l,t,n,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(g=>typeof g!="number"))||this.fire(new s.y(new s.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof s.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends s.E{constructor(l,t,n,u){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new dr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.ay(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:n,z:u}=l.canonical;return this._implementation.hasTile({x:t,y:n,z:u})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:n,y:u,z:p}=l.tileID.canonical,g=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:n,y:u,z:p},{signal:g.signal})).then(function(x){return delete l.request,l.aborted?(l.state="unloaded",t(null)):x===void 0?(l.state="errored",t(null)):x===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(x)?(this.loadTileData(l,x),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(x=>{x.code!==20&&(l.state="errored",t(x))}),l.request.cancel=()=>g.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof s.T?(l.destroy(!0),l.texture&&l.texture instanceof s.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:n,y:u,z:p}=l.tileID.canonical;this._implementation.unloadTile({x:n,y:u,z:p})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){const l=s.aC(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},Qs=function(l,t,n,u){const p=new zs[t.type](l,t,n,u);if(p.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${p.id}`);return s.aP(["load","abort","unload","serialize","prepare"],p),p};function xo(l,t,n=""){return`${n}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:g}=u;return`featureset:${p}${g?`:import:${g}`:""}`}}(l.target)}`}function bs(l,t,n,u=""){if(l.uniqueFeatureID){const p=xo(l,t,u);if(n.has(p))return!0;n.add(p)}return!1}function to(l,t,n,u,p=!1){const g=t.sourceCache.transform,x=t.sourceCache.tilesIn(l,t.has3DLayers,p);x.sort(Qr);const S=[];for(const C of x){const L=C.tile.queryRenderedFeatures(t,C,n,u,g,p);Object.keys(L).length&&S.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:L})}return S.length===0?{}:function(C){const L={},R={};for(const z of C){const N=z.queryResults,V=z.wrappedTileID,J=R[V]=R[V]||{};for(const X in N){const ie=N[X],te=J[X]=J[X]||{},le=L[X]=L[X]||[];for(const we of ie)te[we.featureIndex]||(te[we.featureIndex]=!0,le.push(we))}}return L}(S)}function rs(l,t,n,u,p){const g={},x=u.queryRenderedSymbols(l),S=[];for(const C of Object.keys(x).map(Number))S.push(p[C]);S.sort(Qr);for(const C of S){const L=C.featureIndex.lookupSymbolFeatures(x[C.bucketInstanceId],C.bucketIndex,C.sourceLayerIndex,t,n);for(const R in L){const z=g[R]=g[R]||[],N=L[R];N.sort((V,J)=>{const X=C.featureSortOrder;if(X){const ie=X.indexOf(V.featureIndex);return X.indexOf(J.featureIndex)-ie}return J.featureIndex-V.featureIndex});for(const V of N)z.push(V)}}return g}function ws(l,t){const n=l.getRenderableIds().map(g=>l.getTileByID(g)),u=[],p={};for(let g=0;g<n.length;g++){const x=n[g],S=x.tileID.canonical.key;p[S]||(p[S]=!0,x.querySourceFeatures(u,t))}return u}function Qr(l,t){const n=l.tileID,u=t.tileID;return n.overscaledZ-u.overscaledZ||n.canonical.y-u.canonical.y||n.wrap-u.wrap||n.canonical.x-u.canonical.x}function Ho(l,t){const n={};if(!t)return n;for(const u of l){const p=u.layerIds.map(g=>t.getLayer(g)).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(g=>p.filter(x=>x.id===g)[0]));for(const g of p)n[g.fqid]=u}}return n}const io=32,ao=33,Po=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,n=0,u=0,p=0,g=0,x=0,S=0;for(1&t?p=g=x=io:n=u=S=io;(t>>=1)>1;){const L=n+p>>1,R=u+g>>1;1&t?(p=n,g=u,n=x,u=S):(n=p,u=g,p=x,g=S),x=L,S=R}const C=4*l;Po[C+0]=n,Po[C+1]=u,Po[C+2]=p,Po[C+3]=g}const Zo=new Uint16Array(2178),bo=new Uint8Array(1089),Oo=new Uint16Array(1089);function wo(l){return l===0?-.03125:l===32?.03125:0}const ma={type:2,extent:s.ag,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ag+1,0),new s.P(s.ag+1,s.ag+1),new s.P(0,s.ag+1),new s.P(0,0)]]};class Yo{constructor(t,n,u,p,g){this.tileID=t,this.uid=s.aV(),this.uses=0,this.tileSize=n,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<s.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Ho(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof s.aX){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof s.aX&&g.hasRTLText){this.hasRTLText=!0,s.aY();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p],x=n.style.getOwnLayer(p);if(!x)continue;const S=x.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,S)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.aW}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Ho(t.buckets,n.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const g=this.buckets[p];g.uploadPending()&&g.upload(t)}const n=t.gl,u=this.imageAtlas;if(u&&!u.uploaded){const p=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new s.T(t,u.image,n.RGBA8,{useMipmap:p}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=n.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,n,u,p,g,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const S=function(C,L){const R=s.ab.mat4.fromScaling([],[.5*C.width,.5*-C.height,1]);return s.ab.mat4.translate(R,R,[1,-1,0]),s.ab.mat4.multiply(R,R,C.calculateProjMatrix(L.toUnwrapped())),Float32Array.from(R)}(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:S,transform:p,availableImages:u,tileTransform:this.tileTransform})}querySourceFeatures(t,n){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),g=n?n.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;const S=s.aZ(n&&n.filter),{z:C,x:L,y:R}=this.tileID.canonical,z={z:C,x:L,y:R};for(let N=0;N<x.length;N++){const V=x.feature(N);if(S.needGeometry){const ie=s.a_(V,!0);if(!S.filter(new s.a8(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!S.filter(new s.a8(this.tileID.overscaledZ),V))continue;const J=u.getId(V,g),X=new s.a$(V,C,L,R,J);X.tile=z,t.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const u=s.b0(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(n)if(this.expirationTime<n)p=!0;else{const g=this.expirationTime-n;g?this.expirationTime=u+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,n){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),g=t.style.getBrightness();for(const x in this.buckets){if(!t.style.hasLayer(x))continue;const S=this.buckets[x],C=S.layers[0],L=C.sourceLayer||"_geojsonTileLayer",R=u[L],z=t.style.getLayerSourceCache(C);let N={};z&&(N=z._state.getState(L,void 0));const V=this.imageAtlas&&this.imageAtlas.patternPositions||{},J=Object.keys(N).length>0&&!n;J&&!S.stateDependentLayers.length&&!n||S.update(N,R,p,V,J?S.stateDependentLayers:S.layers,n,g),(S instanceof s.b1||S instanceof s.b2)&&t._terrain&&t._terrain.enabled&&z&&S.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(z.id,this.tileID);const X=t&&t.style&&t.style.getOwnLayer(x);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.q.now()+t}setTexture(t,n){const u=n.context,p=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,n){const u={};for(const p of n)u[p]=!0;this.dependencies[t]=u}hasDependency(t,n){for(const u of t){const p=this.dependencies[u];if(p){for(const g of n)if(p[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const u=s.b3(ma,this.tileID.canonical,this.tileTransform)[0],p=new s.b4,g=new s.b5;for(let x=0;x<u.length;x++){const{x:S,y:C}=u[x];p.emplaceBack(S,C),g.emplaceBack(x)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(p,s.b6.members),this._tileDebugSegments=s.b7.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const u=s.b3(ma,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const x=function(S,C){const L=s.aQ(S,C),R=Math.pow(2,S.z);for(let ie=0;ie<ao;ie++)for(let te=0;te<ao;te++){const le=s.aR((S.x+(te+wo(te))/io)/R),we=s.aS((S.y+(ie+wo(ie))/io)/R),ve=C.project(le,we),ze=ie*ao+te;Zo[2*ze+0]=Math.round((ve.x*L.scale-L.x)*s.ag),Zo[2*ze+1]=Math.round((ve.y*L.scale-L.y)*s.ag)}bo.fill(0),Oo.fill(0);for(let ie=2045;ie>=0;ie--){const te=4*ie,le=Po[te+0],we=Po[te+1],ve=Po[te+2],ze=Po[te+3],Ae=le+ve>>1,Le=we+ze>>1,Me=Ae+Le-we,He=Le+le-Ae,tt=we*ao+le,Ft=ze*ao+ve,Mt=Le*ao+Ae,ai=Math.hypot((Zo[2*tt+0]+Zo[2*Ft+0])/2-Zo[2*Mt+0],(Zo[2*tt+1]+Zo[2*Ft+1])/2-Zo[2*Mt+1])>=16;bo[Mt]=bo[Mt]||(ai?1:0),ie<1022&&(bo[Mt]=bo[Mt]||bo[(we+He>>1)*ao+(le+Me>>1)]||bo[(ze+He>>1)*ao+(ve+Me>>1)])}const z=new s.aT,N=new s.aU;let V=0;function J(ie,te){const le=te*ao+ie;return Oo[le]===0&&(z.emplaceBack(Zo[2*le+0],Zo[2*le+1],ie*s.ag/io,te*s.ag/io),Oo[le]=++V),Oo[le]-1}function X(ie,te,le,we,ve,ze){const Ae=ie+le>>1,Le=te+we>>1;if(Math.abs(ie-ve)+Math.abs(te-ze)>1&&bo[Le*ao+Ae])X(ve,ze,ie,te,Ae,Le),X(le,we,ve,ze,Ae,Le);else{const Me=J(ie,te),He=J(le,we),tt=J(ve,ze);N.emplaceBack(Me,He,tt)}}return X(0,0,io,io,io,0),X(io,io,0,0,0,io),{vertices:z,indices:N}}(this.tileID.canonical,n);p=x.vertices,g=x.indices}else{p=new s.aT,g=new s.aU;for(const{x:S,y:C}of u)p.emplaceBack(S,C,0,0);const x=s.b8(p.int16,void 0,4);for(let S=0;S<x.length;S+=3)g.emplaceBack(x[S],x[S+1],x[S+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,s.b9.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=s.b7.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(t,n){const u=n.projection;if(!u||u.name!=="globe"||n.freezeTileCoverage)return;const p=this.tileID.canonical,g=s.ba(p,n),x=s.bb(g),S=s.ae(n.zoom);let C;S>0&&(C=s.ab.mat4.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,n,x,C,S),this._makeGlobeTileDebugTextBuffer(t,p,n,x,C,S)}_globePoint(t,n,u,p,g,x,S){let C=s.bc(t,n,u);if(x){const L=1<<u.z,R=s.at(p.center.lng),z=s.aA(p.center.lat),N=(u.x+.5)/L-R;let V=0;N>.5?V=-1:N<-.5&&(V=1);let J=(t/s.ag+u.x)/L+V,X=(n/s.ag+u.y)/L;J=(J-R)*p._pixelsPerMercatorPixel+R,X=(X-z)*p._pixelsPerMercatorPixel+z;const ie=[J*p.worldSize,X*p.worldSize,0];s.ab.vec3.transformMat4(ie,ie,x),C=s.bd(C,ie,S)}return s.ab.vec3.transformMat4(C,C,g)}_makeGlobeTileDebugBorderBuffer(t,n,u,p,g,x){const S=new s.b4,C=new s.b5,L=new s.be,R=(N,V,J,X,ie)=>{const te=(J-N)/(ie-1),le=(X-V)/(ie-1),we=S.length;for(let ve=0;ve<ie;ve++){const ze=N+ve*te,Ae=V+ve*le;S.emplaceBack(ze,Ae);const Le=this._globePoint(ze,Ae,n,u,p,g,x);L.emplaceBack(Le[0],Le[1],Le[2]),C.emplaceBack(we+ve)}},z=s.ag;R(0,0,z,0,16),R(z,0,z,z,16),R(z,z,0,z,16),R(0,z,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(C),this._tileDebugBuffer=t.createVertexBuffer(S,s.b6.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(L,s.bf.members),this._tileDebugSegments=s.b7.simpleSegment(0,0,S.length,C.length)}_makeGlobeTileDebugTextBuffer(t,n,u,p,g,x){const S=s.ag/4,C=new s.b4,L=new s.aU,R=new s.be,z=25;L.reserve(32),C.reserve(z),R.reserve(z);const N=(V,J)=>z*V+J;for(let V=0;V<z;V++){const J=V*S;for(let X=0;X<z;X++){const ie=X*S;C.emplaceBack(ie,J);const te=this._globePoint(ie,J,n,u,p,g,x);R.emplaceBack(te[0],te[1],te[2])}}for(let V=0;V<4;V++)for(let J=0;J<4;J++){const X=N(V,J),ie=N(V,J+1),te=N(V+1,J),le=N(V+1,J+1);L.emplaceBack(X,ie,te),L.emplaceBack(te,ie,le)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(L),this._tileDebugTextBuffer=t.createVertexBuffer(C,s.b6.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(R,s.bf.members),this._tileDebugTextSegments=s.b7.simpleSegment(0,0,z,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bg.setPbf(s.bh);class sa extends Yo{constructor(t,n,u,p,g){super(t,n,u,p,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,n){const u=n.context,p=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t,{premultiply:!1}):this.texture=new s.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,n){const u=this._mrt=new s.bg(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.bi(p,(g,x,S,C)=>{if(g)n(g);else try{const L=u.getHeaderLength(x);if(L>t)return void(this.request=this.fetchHeader(L,n));u.parseHeader(x),this._isHeaderLoaded=!0;let R=0;for(const z of Object.values(u.layers))R=Math.max(R,z.dataIndex[z.dataIndex.length-1].last_byte);x.byteLength>=R&&(this.entireBuffer=x),n(null,this.entireBuffer||x,S,C)}catch(L){n(L)}}),this.request}fetchBand(t,n,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const g=this.actor;if(!g)return void u(new Error("Can't fetch tile band without an actor"));let x;const S=(z,N)=>{x.complete(z,N),z?u(z):(this.updateTextureDescriptor(t,n),u(null,this.textureDescriptor&&this.textureDescriptor.img))},C=(z,N)=>{if(z)return u(z);const V=g.send("decodeRasterArray",{buffer:N,task:x},S,void 0,!0);this._workQueue.push(()=>{V&&V.cancel(),x.cancel()})},L=p.getLayer(t);if(!L)return void u(new Error(`Unknown sourceLayer "${t}"`));if(L.hasDataForBand(n))return this.updateTextureDescriptor(t,n),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const R=L.getDataRange([n]);if(x=p.createDecodingTask(R),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)C(null,this.entireBuffer.slice(R.firstByte,R.lastByte+1));else{const z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${R.firstByte}-${R.lastByte}`}}),N=s.bi(z,C);this._fetchQueue.push(()=>{N.cancel(),x.cancel()})}else u(null)}updateNeeded(t,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,n){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(n)||!u.hasDataForBand(n))return;const{bytes:p,tileSize:g,buffer:x,offset:S,scale:C}=u.getBandView(n),L=g+2*x,R={data:p,width:L,height:L},z=this.texture;z&&z instanceof s.T&&z.update(R,{premultiply:!1}),this.textureDescriptor={layer:t,band:n,img:R,buffer:x,offset:S,tileSize:g,format:u.pixelFormat,mix:[C,256*C,65536*C,16777216*C]}}}class la{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:n,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},u)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const u=t.wrapped().key,p=n===void 0?0:this.data[u].indexOf(n),g=this.data[u][p];return this.data[u].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||n.push(p);for(const u of n)this.remove(u.value.tileID,u)}}class Is{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,u){const p=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},s.l(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])u[g]||(this.deletedStates[t][p][g]=null)}else for(const g in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,n,u){if(this.deletedStates[t]===null)return;const p=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&n!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,n){const u=this.state[t]||{},p=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(n!==void 0){const S=String(n),C=s.l({},u[S],p[S]);if(g){const L=g[n];if(L===null)return{};for(const R in L)delete C[R]}return C}const x=s.l({},u,p);if(g)for(const S in g)delete x[S];return x}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),s.l(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];u[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const x in this.state[p])g[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else if(this.state[p][x])for(const S of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][S];g[x]=this.state[p][x]}u[p]=u[p]||{},s.l(u[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(n)}}class D extends s.E{constructor(t,n,u){super(),this.id=t,this._onlySymbols=u,n.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new la(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Is,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const u=this._tiles[n];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.bj(this._tiles).map(t=>t.tileID).sort(W).map(t=>t.key)}getRenderableIds(t,n){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,n)&&u.push(this._tiles[p]);return t?u.sort((p,g)=>{const x=p.tileID,S=g.tileID,C=new s.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),L=new s.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-S.overscaledZ||L.y-C.y||L.x-C.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(W).map(p=>p.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=n),this._loadTile(u,this._tileLoaded.bind(this,u,t,n)))}_tileLoaded(t,n,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new s.y(p,{tile:t}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let p=0;p<n.length;p++){const g=n[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);u(t,x),u(x,t)}}function u(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x;const S=g.tileID.canonical.y-p.tileID.canonical.y,C=Math.pow(2,p.tileID.canonical.z),L=g.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+C)===1?x+=C:Math.abs(x-C)===1&&(x-=C)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,S),p.neighboringTiles&&p.neighboringTiles[L]&&(p.neighboringTiles[L].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,u,p){for(const g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=n||x.tileID.overscaledZ>u)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>n+1;){const L=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[L.key],x&&x.hasData()&&(S=L)}let C=S;for(;C.overscaledZ>n;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){p[S.key]=S;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=n?u:null}for(let u=t.overscaledZ-1;u>=n;u--){const p=t.scaledTo(u),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const u=Math.ceil(t.width/n)+1,p=Math.ceil(t.height/n)+1,g=Math.floor(u*p*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(S)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const u={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),u[g.tileID.key]=g}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,n,u,p){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const g=this._source.type==="batched-model";let x,S=this._source.maxzoom;const C=this.map&&this.map.painter?this.map.painter._terrain:null;if(C&&C.sourceCache===this&&C.attenuationRange()){const z=C.attenuationRange()[0],N=Math.floor(z)-Math.log2(C.getDemUpscale());S>N&&(S=N)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new s.aG(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y));else if(this.tileCoverLift!==0){const z=t.clone();z.tileCoverLift=this.tileCoverLift,x=z.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new s.aG(1,0,1,0,0)),x.push(new s.aG(1,0,1,1,0)),x.push(new s.aG(1,0,1,0,1)),x.push(new s.aG(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.hasTile){const z=this._source.hasTile.bind(this._source);x=x.filter(N=>z(N))}}else x=[];if(x.length>0&&this.castsShadows&&p&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ge(this._source.type)){const z=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),N=Math.min(z,this._source.maxzoom);if(g){const V=t.extendTileCover(x,N);for(const J of V)x.push(J)}else{const V=t.extendTileCover(x,N,p);for(const J of V)this._shadowCasterTiles[J.key]=!0,x.push(J)}}const L=this._updateRetainedTiles(x);if(Ge(this._source.type)&&x.length!==0){const z={},N={},V=Object.keys(L);for(const X of V){const ie=L[X],te=this._tiles[X];if(!te||te.fadeEndTime&&te.fadeEndTime<=s.q.now())continue;const le=this.findLoadedParent(ie,Math.max(ie.overscaledZ-D.maxOverzooming,this._source.minzoom));le&&(this._addTile(le.tileID),z[le.tileID.key]=le.tileID),N[X]=ie}const J=x[x.length-1].overscaledZ;for(const X in this._tiles){const ie=this._tiles[X];if(L[X]||!ie.hasData())continue;let te=ie.tileID;for(;te.overscaledZ>J;){te=te.scaledTo(te.overscaledZ-1);const le=this._tiles[te.key];if(le&&le.hasData()&&N[te.key]){L[X]=ie.tileID;break}}}for(const X in z)L[X]||(this._coveredTiles[X]=!0,L[X]=z[X])}for(const z in L)this._tiles[z].clearFadeHold();const R=s.bk(this._tiles,L);for(const z of R){const N=this._tiles[z];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const u={},p=t.reduce((L,R)=>Math.min(L,R.overscaledZ),1/0),g=t[0].overscaledZ,x=Math.max(g-D.maxOverzooming,this._source.minzoom),S=Math.max(g+D.maxUnderzooming,this._source.minzoom),C={};for(const L of t){const R=this._addTile(L);n[L.key]=L,R.hasData()||p<this._source.maxzoom&&(C[L.key]=L)}this._retainLoadedChildren(C,p,S,n);for(const L of t){let R=this._tiles[L.key];if(R.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const N=L.children(this._source.maxzoom)[0],V=this.getTile(N);if(V&&V.hasData()){n[N.key]=N;continue}}else{const N=L.children(this._source.maxzoom);if(n[N[0].key]&&n[N[1].key]&&n[N[2].key]&&n[N[3].key])continue}let z=R.wasRequested();for(let N=L.overscaledZ-1;N>=x;--N){const V=L.scaledTo(N);if(u[V.key]||(u[V.key]=!0,R=this.getTile(V),!R&&z&&(R=this._addTile(V)),R&&(n[V.key]=V,z=R.wasRequested(),R.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}n.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;p=g}for(const g of n)this._loadedParentTiles[g]=u}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const u=!!n;if(!u){const p=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new sa(t,g,this.transform.tileZoom,p,this._isRaster):new Yo(t,g,this.transform.tileZoom,p,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,u||this._source.fire(new s.z("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=n.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,u){const p=[],g=this.transform;if(!g)return p;const x=g.projection.name==="globe",S=s.at(g.center.lng);for(const C in this._tiles){const L=this._tiles[C];if(u&&L.clearQueryDebugViz(),L.holdingForFade())continue;let R;if(x){const z=L.tileID.canonical;if(z.z===0){const N=[Math.abs(s.aw(S,...Ye(z,-1))-S),Math.abs(s.aw(S,...Ye(z,1))-S)];R=[0,2*N.indexOf(Math.min(...N))-1]}else{const N=[Math.abs(s.aw(S,...Ye(z,-1))-S),Math.abs(s.aw(S,...Ye(z,0))-S),Math.abs(s.aw(S,...Ye(z,1))-S)];R=[N.indexOf(Math.min(...N))-1]}}else R=[0];for(const z of R){const N=t.containsTile(L,g,n,z);N&&p.push(N)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const u=this.getRenderableIds(t,n).map(g=>this._tiles[g].tileID),p=this.transform.projection.name==="globe";for(const g of u)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=p?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return u}sortCoordinatesByDistance(t){const n=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),g={};for(const x of n){const S=1/(1<<x.canonical.z);g[x.key]=((x.canonical.x+.5)*S+x.wrap-u[0])*p[0]+((x.canonical.y+.5)*S-u[1])*p[1]-u[2]*p[2]}return n.sort((x,S)=>g[x.key]-g[S.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Ge(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(t,n,u){this._state.updateState(t=t||"_geojsonTileLayer",n,u)}removeFeatureState(t,n,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,u)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,u){const p=this._tiles[t];p&&p.setDependencies(n,u)}reloadTilesForDependencies(t,n){for(const u in this._tiles)this._tiles[u].hasDependency(t,n)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(t,n))};return void this._source.on("data",C)}const u=new Map,p=Array.isArray(t)?t:[t],g=this.map.painter.terrain,x=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const C of p){const L=C.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of L)u.set(R.key,R);this.usedForTerrain&&C.updateElevation(!1)}const S=Array.from(u.values());s.bl(S,(C,L)=>{const R=new Yo(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,z=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),L(z,R)})},n)}}function W(l,t){const n=Math.abs(2*l.wrap)-+(l.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||u-n||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function Ge(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function Ye(l,t){const n=1<<l.z;return[l.x/n+t,(l.x+1)/n+t]}D.maxOverzooming=10,D.maxUnderzooming=3;class Bt{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:t,visibilityChanged:n});else if(p.type==="model"){const g=this.style.getLayerSource(p);g&&g.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const u=n.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&n.visible,n.visible=p}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const p of this.layers){const g=p.layer,x=this.style.getLayerSourceCache(g);let S=1;g.type==="fill-extrusion"&&(S=p.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let C=x?x.getTile(n):null;if(!C&&x&&n.canonical.z>x.getSource().minzoom){let L=n.scaledTo(Math.min(x.getSource().maxzoom,n.overscaledZ-1));for(;L.overscaledZ>=x.getSource().minzoom&&(C=x.getTile(L),!C&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:C?C.getBucket(g):null,tileID:C?C.tileID:n,verticalScale:S})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const g=t.symbolInstances.get(p),x=g.zOffset,S=this._getHeightAtTileOffset(n,g.tileAnchorX,g.tileAnchorY);g.zOffset=S!==Number.NEGATIVE_INFINITY?S:x,u||x===g.zOffset||(u=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,u,p){let g=n,x=u;if(t.canonical.z!==p.canonical.z){const S=p.canonical,C=1/(1<<t.canonical.z-S.z);g=(n+t.canonical.x*s.ag)*C-S.x*s.ag|0,x=(u+t.canonical.y*s.ag)*C-S.y*s.ag|0}return{tileX:g,tileY:x}}_getHeightAtTileOffset(t,n,u){let p,g;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;const{bucket:S,tileID:C,verticalScale:L}=this.currentBuildingBuckets[x];if(!S)continue;const{tileX:R,tileY:z}=this._mapCoordToOverlappingTile(t,n,u,C),N=S.getHeightAtTileCoord(R,z);N&&N.height!==void 0&&(N.hidden?p=N.height:g=Math.max(N.height*L,g||0))}if(g!==void 0)return g;for(let x=0;x<this.layers.length;++x){const S=this.layers[x];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:C,tileID:L}=this.currentBuildingBuckets[x];if(!C)continue;const{tileX:R,tileY:z}=this._mapCoordToOverlappingTile(t,n,u,L),N=C.getHeightAtTileCoord(R,z);if(N&&!N.hidden)return N.height===void 0&&p!==void 0?Math.min(N.maxHeight,p)*N.verticalScale:N.height?N.height*N.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ei(l,t){const n={};for(const u in l)u!=="ref"&&(n[u]=l[u]);return s.bm.forEach(u=>{u in t&&(n[u]=t[u])}),n}function Pn(l){l=l.slice();const t=Object.create(null);for(let n=0;n<l.length;n++)t[l[n].id]=l[n];for(let n=0;n<l.length;n++)"ref"in l[n]&&(l[n]=Ei(l[n],t[l[n].ref]));return l}const yn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function pr(l,t,n){n.push({command:yn.addSource,args:[l,t[l]]})}function Er(l,t,n){t.push({command:yn.removeSource,args:[l]}),n[l]=!0}function ft(l,t,n,u){Er(l,n,u),pr(l,t,n)}function mi(l,t,n){let u;for(u in l[n])if(l[n].hasOwnProperty(u)&&u!=="data"&&!s.bn(l[n][u],t[n][u]))return!1;for(u in t[n])if(t[n].hasOwnProperty(u)&&u!=="data"&&!s.bn(l[n][u],t[n][u]))return!1;return!0}function nt(l,t,n,u,p,g){let x;for(x in t=t||{},l=l||{})l.hasOwnProperty(x)&&(s.bn(l[x],t[x])||n.push({command:g,args:[u,x,t[x],p]}));for(x in t)t.hasOwnProperty(x)&&!l.hasOwnProperty(x)&&(s.bn(l[x],t[x])||n.push({command:g,args:[u,x,t[x],p]}))}function jt(l){return l.id}function Ti(l,t){return l[t.id]=t,l}class ni{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.aw(t,0,1);let n=1,u=this._distances[n];const p=t*this.paddedLength+this.padding;for(;u<p&&n<this._distances.length;)u=this._distances[++n];const g=n-1,x=this._distances[g],S=u-x,C=S>0?(p-x)/S:0;return this.points[g].mult(1-C).add(this.points[n].mult(C))}}class wi{constructor(t,n,u){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(n/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,u,p,g){this._forEachCell(n,u,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,n,u,p){this._forEachCell(n-p,u-p,n+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,n,u,p,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,n,u,p,g,x){this.circleCells[g].push(x)}_query(t,n,u,p,g,x){if(u<0||t>this.width||p<0||n>this.height)return!g&&[];const S=[];if(t<=0&&n<=0&&this.width<=u&&this.height<=p){if(g)return!0;for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const L=this.circles[3*C],R=this.circles[3*C+1],z=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:L-z,y1:R-z,x2:L+z,y2:R+z})}return x?S.filter(x):S}return this._forEachCell(t,n,u,p,this._queryCell,S,{hitTest:g,seenUids:{box:{},circle:{}}},x),g?S.length>0:S}_queryCircle(t,n,u,p,g){const x=t-u,S=t+u,C=n-u,L=n+u;if(S<0||x>this.width||L<0||C>this.height)return!p&&[];const R=[];return this._forEachCell(x,C,S,L,this._queryCellCircle,R,{hitTest:p,circle:{x:t,y:n,radius:u},seenUids:{box:{},circle:{}}},g),p?R.length>0:R}query(t,n,u,p,g){return this._query(t,n,u,p,!1,g)}hitTest(t,n,u,p,g){return this._query(t,n,u,p,!0,g)}hitTestCircle(t,n,u,p){return this._queryCircle(t,n,u,!0,p)}_queryCell(t,n,u,p,g,x,S,C){const L=S.seenUids,R=this.boxCells[g];if(R!==null){const N=this.bboxes;for(const V of R)if(!L.box[V]){L.box[V]=!0;const J=4*V;if(t<=N[J+2]&&n<=N[J+3]&&u>=N[J+0]&&p>=N[J+1]&&(!C||C(this.boxKeys[V]))){if(S.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[V],x1:N[J],y1:N[J+1],x2:N[J+2],y2:N[J+3]})}}}const z=this.circleCells[g];if(z!==null){const N=this.circles;for(const V of z)if(!L.circle[V]){L.circle[V]=!0;const J=3*V;if(this._circleAndRectCollide(N[J],N[J+1],N[J+2],t,n,u,p)&&(!C||C(this.circleKeys[V]))){if(S.hitTest)return x.push(!0),!0;{const X=N[J],ie=N[J+1],te=N[J+2];x.push({key:this.circleKeys[V],x1:X-te,y1:ie-te,x2:X+te,y2:ie+te})}}}}}_queryCellCircle(t,n,u,p,g,x,S,C){const L=S.circle,R=S.seenUids,z=this.boxCells[g];if(z!==null){const V=this.bboxes;for(const J of z)if(!R.box[J]){R.box[J]=!0;const X=4*J;if(this._circleAndRectCollide(L.x,L.y,L.radius,V[X+0],V[X+1],V[X+2],V[X+3])&&(!C||C(this.boxKeys[J])))return x.push(!0),!0}}const N=this.circleCells[g];if(N!==null){const V=this.circles;for(const J of N)if(!R.circle[J]){R.circle[J]=!0;const X=3*J;if(this._circlesCollide(V[X],V[X+1],V[X+2],L.x,L.y,L.radius)&&(!C||C(this.circleKeys[J])))return x.push(!0),!0}}}_forEachCell(t,n,u,p,g,x,S,C){const L=this._convertToXCellCoord(t),R=this._convertToYCellCoord(n),z=this._convertToXCellCoord(u),N=this._convertToYCellCoord(p);for(let V=L;V<=z;V++)for(let J=R;J<=N;J++)if(g.call(this,t,n,u,p,this.xCellCount*J+V,x,S,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,u,p,g,x){const S=p-t,C=g-n,L=u+x;return L*L>S*S+C*C}_circleAndRectCollide(t,n,u,p,g,x,S){const C=(x-p)/2,L=Math.abs(t-(p+C));if(L>C+u)return!1;const R=(S-g)/2,z=Math.abs(n-(g+R));if(z>R+u)return!1;if(L<=C||z<=R)return!0;const N=L-C,V=z-R;return N*N+V*V<=u*u}}const Mi={unknown:0,flipRequired:1,flipNotRequired:2},Li=Math.tan(85*Math.PI/180);function pt(l,t,n,u,p,g,x){const S=s.ab.mat4.create();if(n)if(g.name==="globe"){const C=s.bo(p,t);s.ab.mat4.multiply(S,S,C)}else{const C=s.ab.mat2.invert([],x);S[0]=C[0],S[1]=C[1],S[4]=C[2],S[5]=C[3],u||s.ab.mat4.rotateZ(S,S,p.angle)}else s.ab.mat4.multiply(S,p.labelPlaneMatrix,l);return S}function St(l,t,n,u,p,g,x){const S=pt(l,t,n,u,p,g,x);return g.name==="globe"&&n||(S[2]=S[6]=S[10]=S[14]=0),S}function zt(l,t,n,u,p,g,x){if(n){if(g.name==="globe"){const S=pt(l,t,n,u,p,g,x);return s.ab.mat4.invert(S,S),s.ab.mat4.multiply(S,l,S),S}{const S=s.ab.mat4.clone(l),C=s.ab.mat4.identity([]);return C[0]=x[0],C[1]=x[1],C[4]=x[2],C[5]=x[3],s.ab.mat4.multiply(S,S,C),u||s.ab.mat4.rotateZ(S,S,-p.angle),S}}return p.glCoordMatrix}function At(l,t,n,u){const p=[l,t,n,1];n?s.ab.vec4.transformMat4(p,p,u):li(p,p,u);const g=p[3];return p[0]/=g,p[1]/=g,p[2]/=g,p}function kt(l,t){return Math.min(.5+l/t*.5,1.5)}function Ci(l,t){const n=l[0]/l[3],u=l[1]/l[3];return n>=-t[0]&&n<=t[0]&&u>=-t[1]&&u<=t[1]}function Ke(l,t,n,u,p,g,x,S,C,L){const R=n.transform,z=u?l.textSizeData:l.iconSizeData,N=s.bp(z,n.transform.zoom),V=R.projection.name==="globe",J=[256/n.width*2+1,256/n.height*2+1],X=u?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;X.clear();let ie=null;V&&(ie=u?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const te=l.lineVertexArray,le=u?l.text.placedSymbolArray:l.icon.placedSymbolArray,we=n.transform.width/n.transform.height;let ve,ze=!1;for(let Ae=0;Ae<le.length;Ae++){const Le=le.get(Ae),{numGlyphs:Me,writingMode:He}=Le;if(He!==s.bq.vertical||ze||ve===s.bq.horizontal||(ze=!0),ve=He,(Le.hidden||He===s.bq.vertical)&&!ze){Di(Me,X);continue}ze=!1;const tt=new s.P(Le.tileAnchorX,Le.tileAnchorY);let{x:Ft,y:Mt,z:ai}=R.projection.projectTilePoint(tt.x,tt.y,L.canonical);if(C){const[di,$i,dn]=C(tt);Ft+=di,Mt+=$i,ai+=dn}const ei=[Ft,Mt,ai,1];if(s.ab.vec4.transformMat4(ei,ei,t),!Ci(ei,J)){Di(Me,X);continue}const yt=ei[3],Ut=kt(n.transform.getCameraToCenterDistance(R.projection),yt),Ui=s.br(z,N,Le),_t=x?Ui/Ut:Ui*Ut,_i=At(Ft,Mt,ai,p);if(_i[3]<=0){Di(Me,X);continue}let Gt={};const fn=x?null:C,Ri=ci(Le,_t,!1,S,t,p,g,l.glyphOffsetArray,te,X,ie,_i,tt,Gt,we,fn,R.projection,L,x);ze=Ri.useVertical,fn&&Ri.needsFlipping&&(Gt={}),(Ri.notEnoughRoom||ze||Ri.needsFlipping&&ci(Le,_t,!0,S,t,p,g,l.glyphOffsetArray,te,X,ie,_i,tt,Gt,we,fn,R.projection,L,x).notEnoughRoom)&&Di(Me,X)}u?(l.text.dynamicLayoutVertexBuffer.updateData(X),ie&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData(ie)):(l.icon.dynamicLayoutVertexBuffer.updateData(X),ie&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData(ie))}function It(l,t,n,u,p,g,x,S,C,L,R,z,N,V,J,X){const{lineStartIndex:ie,glyphStartIndex:te,segment:le}=S,we=te+S.numGlyphs,ve=ie+S.lineLength,ze=t.getoffsetX(te),Ae=t.getoffsetX(we-1),Le=si(l*ze,n,u,p,g,x,le,ie,ve,C,L,R,z,N,!0,V,J,X);if(!Le)return null;const Me=si(l*Ae,n,u,p,g,x,le,ie,ve,C,L,R,z,N,!0,V,J,X);return Me?{first:Le,last:Me}:null}function Nt(l,t,n,u){return l===s.bq.horizontal&&Math.abs(u)>Math.abs(n)?{useVertical:!0}:l===s.bq.vertical?u>0?{needsFlipping:!0}:null:t!==Mi.unknown&&function(p,g){return p===0||Math.abs(g/p)>Li}(n,u)?t===Mi.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function ci(l,t,n,u,p,g,x,S,C,L,R,z,N,V,J,X,ie,te,le){const we=t/24,ve=l.lineOffsetX*we,ze=l.lineOffsetY*we,{lineStartIndex:Ae,glyphStartIndex:Le,numGlyphs:Me,segment:He,writingMode:tt,flipState:Ft}=l,Mt=Ae+l.lineLength,ai=ei=>{if(R){const[_t,_i,Gt]=ei.up,fn=L.length;s.bs(R,fn+0,_t,_i,Gt),s.bs(R,fn+1,_t,_i,Gt),s.bs(R,fn+2,_t,_i,Gt),s.bs(R,fn+3,_t,_i,Gt)}const[yt,Ut,Ui]=ei.point;s.bt(L,yt,Ut,Ui,ei.angle)};if(Me>1){const ei=It(we,S,ve,ze,n,z,N,l,C,g,V,X,!1,ie,te,le);if(!ei)return{notEnoughRoom:!0};if(u&&!n){let[yt,Ut,Ui]=ei.first.point,[_t,_i,Gt]=ei.last.point;[yt,Ut]=At(yt,Ut,Ui,x),[_t,_i]=At(_t,_i,Gt,x);const fn=Nt(tt,Ft,(_t-yt)*J,_i-Ut);if(l.flipState=fn&&fn.needsFlipping?Mi.flipRequired:Mi.flipNotRequired,fn)return fn}ai(ei.first);for(let yt=Le+1;yt<Le+Me-1;yt++){const Ut=si(we*S.getoffsetX(yt),ve,ze,n,z,N,He,Ae,Mt,C,g,V,X,!1,!1,ie,te,le);if(!Ut)return L.length-=4*(yt-Le),{notEnoughRoom:!0};ai(Ut)}ai(ei.last)}else{if(u&&!n){const yt=At(N.x,N.y,0,p),Ut=Ae+He+1,Ui=new s.P(C.getx(Ut),C.gety(Ut)),_t=At(Ui.x,Ui.y,0,p),_i=_t[3]>0?_t:Ki(N,Ui,yt,1,p,void 0,ie,te.canonical),Gt=Nt(tt,Ft,(_i[0]-yt[0])*J,_i[1]-yt[1]);if(l.flipState=Gt&&Gt.needsFlipping?Mi.flipRequired:Mi.flipNotRequired,Gt)return Gt}const ei=si(we*S.getoffsetX(Le),ve,ze,n,z,N,He,Ae,Mt,C,g,V,X,!1,!1,ie,te,le);if(!ei)return{notEnoughRoom:!0};ai(ei)}return{}}function oi(l,t,n,u,p){const{x:g,y:x,z:S}=u.projectTilePoint(l.x,l.y,t);if(!p)return At(g,x,S,n);const[C,L,R]=p(l);return At(g+C,x+L,S+R,n)}function Ki(l,t,n,u,p,g,x,S){const C=oi(l.sub(t)._unit()._add(l),S,p,x,g);return s.ab.vec3.sub(C,n,C),s.ab.vec3.normalize(C,C),s.ab.vec3.scaleAndAdd(C,n,C,u)}function si(l,t,n,u,p,g,x,S,C,L,R,z,N,V,J,X,ie,te){const le=u?l-t:l+t;let we=le>0?1:-1,ve=0;u&&(we*=-1,ve=Math.PI),we<0&&(ve+=Math.PI);let ze=S+x+(we>0?0:1)|0,Ae=p,Le=p,Me=0,He=0;const tt=Math.abs(le),Ft=[],Mt=[];let ai=g,ei=ai;const yt=()=>Ki(ei,ai,Le,tt-Me+1,R,N,X,ie.canonical);for(;Me+He<=tt;){if(ze+=we,ze<S||ze>=C)return null;if(Le=Ae,ei=ai,Ft.push(Le),V&&Mt.push(ei),ai=new s.P(L.getx(ze),L.gety(ze)),Ae=z[ze],!Ae){const $i=oi(ai,ie.canonical,R,X,N);Ae=$i[3]>0?z[ze]=$i:yt()}Me+=He,He=s.ab.vec3.distance(Le,Ae)}J&&N&&(z[ze]&&(Ae=yt(),He=s.ab.vec3.distance(Le,Ae)),z[ze]=Ae);const Ut=(tt-Me)/He,Ui=ai.sub(ei)._mult(Ut)._add(ei),_t=s.ab.vec3.sub([],Ae,Le),_i=s.ab.vec3.scaleAndAdd([],Le,_t,Ut);let Gt=[0,0,1],fn=_t[0],Ri=_t[1];if(te&&(Gt=X.upVector(ie.canonical,Ui.x,Ui.y),Gt[0]!==0||Gt[1]!==0||Gt[2]!==1)){const $i=[Gt[2],0,-Gt[0]],dn=s.ab.vec3.cross([],Gt,$i);s.ab.vec3.normalize($i,$i),s.ab.vec3.normalize(dn,dn),fn=s.ab.vec3.dot(_t,$i),Ri=s.ab.vec3.dot(_t,dn)}if(n){const $i=s.ab.vec3.cross([],Gt,_t);s.ab.vec3.normalize($i,$i),s.ab.vec3.scaleAndAdd(_i,_i,$i,n*we)}const di=ve+Math.atan2(Ri,fn);return Ft.push(_i),V&&Mt.push(Ui),{point:_i,angle:di,path:Ft,tilePath:Mt,up:Gt}}function Di(l,t){const n=t.length,u=n+4*l;t.resize(u),t.float32.fill(-1/0,4*n,4*u)}function li(l,t,n){const u=t[0],p=t[1];return l[0]=n[0]*u+n[4]*p+n[12],l[1]=n[1]*u+n[5]*p+n[13],l[3]=n[3]*u+n[7]*p+n[15],l}const Oi=100;class Hi{constructor(t,n,u=new wi(t.width+200,t.height+200,25),p=new wi(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Oi,this.screenBottomBoundary=t.height+Oi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,u,p,g,x,S,C){let L=u.projectedAnchorX,R=u.projectedAnchorY,z=u.projectedAnchorZ;const N=u.elevation,V=u.tileID,J=t.getProjection();if(N&&V){const[Ae,Le,Me]=J.upVector(V.canonical,u.tileAnchorX,u.tileAnchorY),He=J.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=Ae*N*He,R+=Le*N*He,z+=Me*N*He}const X=this.projectAndGetPerspectiveRatio(S,L,R,z,u.tileID,J.name==="globe"||!!N||this.transform.pitch>0,J),ie=x*X.perspectiveRatio,te=(u.x1*n+p.x-u.padding)*ie+X.point.x,le=(u.y1*n+p.y-u.padding)*ie+X.point.y,we=(u.x2*n+p.x+u.padding)*ie+X.point.x,ve=(u.y2*n+p.y+u.padding)*ie+X.point.y,ze=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(te,le,we,ve)||!g&&this.grid.hitTest(te,le,we,ve,C)||ze?{box:[],offscreen:!1,occluded:X.occluded}:{box:[te,le,we,ve],offscreen:this.isOffscreen(te,le,we,ve),occluded:!1}}placeCollisionCircles(t,n,u,p,g,x,S,C,L,R,z,N,V,J,X){const ie=[],te=this.transform.elevation,le=t.getProjection(),we=te?te.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,le):null,ve=new s.P(u.tileAnchorX,u.tileAnchorY);let{x:ze,y:Ae,z:Le}=le.projectTilePoint(ve.x,ve.y,X.canonical);if(we){const[Ui,_t,_i]=we(ve);ze+=Ui,Ae+=_t,Le+=_i}const Me=le.name==="globe",He=this.projectAndGetPerspectiveRatio(S,ze,Ae,Le,X,Me||!!te||this.transform.pitch>0,le),{perspectiveRatio:tt}=He,Ft=(z?x/tt:x*tt)/s.bw,Mt=At(ze,Ae,Le,C),ai=He.signedDistanceFromCamera>0?It(Ft,g,u.lineOffsetX*Ft,u.lineOffsetY*Ft,!1,Mt,ve,u,p,C,{},te&&!z?we:null,z&&!!te,le,X,z):null;let ei=!1,yt=!1,Ut=!0;if(ai&&!He.occluded){const Ui=.5*V*tt+J,_t=new s.P(-100,-100),_i=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Gt=new ni,{first:fn,last:Ri}=ai,di=fn.path.length;let $i=[];for(let zn=di-1;zn>=1;zn--)$i.push(fn.path[zn]);for(let zn=1;zn<Ri.path.length;zn++)$i.push(Ri.path[zn]);const dn=2.5*Ui;L&&($i=$i.map(([zn,xr,sr],lr)=>(we&&!Me&&(sr=we(lr<di-1?fn.tilePath[di-1-lr]:Ri.tilePath[lr-di+2])[2]),At(zn,xr,sr,L))),$i.some(zn=>zn[3]<=0)&&($i=[]));let Cn=[];if($i.length>0){let zn=1/0,xr=-1/0,sr=1/0,lr=-1/0;for(const Tr of $i)zn=Math.min(zn,Tr[0]),sr=Math.min(sr,Tr[1]),xr=Math.max(xr,Tr[0]),lr=Math.max(lr,Tr[1]);xr>=_t.x&&zn<=_i.x&&lr>=_t.y&&sr<=_i.y&&(Cn=[$i.map(Tr=>new s.P(Tr[0],Tr[1]))],(zn<_t.x||xr>_i.x||sr<_t.y||lr>_i.y)&&(Cn=s.bu(Cn,_t.x,_t.y,_i.x,_i.y)))}for(const zn of Cn){Gt.reset(zn,.25*Ui);let xr=0;xr=Gt.length<=.5*Ui?1:Math.ceil(Gt.paddedLength/dn)+1;for(let sr=0;sr<xr;sr++){const lr=sr/Math.max(xr-1,1),Tr=Gt.lerp(lr),Yr=Tr.x+Oi,As=Tr.y+Oi;ie.push(Yr,As,Ui,0);const ho=Yr-Ui,Ks=As-Ui,Rr=Yr+Ui,ns=As+Ui;if(Ut=Ut&&this.isOffscreen(ho,Ks,Rr,ns),yt=yt||this.isInsideGrid(ho,Ks,Rr,ns),!n&&this.grid.hitTestCircle(Yr,As,Ui,N)&&(ei=!0,!R))return{circles:[],offscreen:!1,collisionDetected:ei,occluded:!1}}}}return{circles:!R&&ei||!yt?[]:ie,offscreen:Ut,collisionDetected:ei,occluded:He.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let u=1/0,p=1/0,g=-1/0,x=-1/0;for(const R of t){const z=new s.P(R.x+Oi,R.y+Oi);u=Math.min(u,z.x),p=Math.min(p,z.y),g=Math.max(g,z.x),x=Math.max(x,z.y),n.push(z)}const S=this.grid.query(u,p,g,x).concat(this.ignoredGrid.query(u,p,g,x)),C={},L={};for(const R of S){const z=R.key;if(C[z.bucketInstanceId]===void 0&&(C[z.bucketInstanceId]={}),C[z.bucketInstanceId][z.featureIndex])continue;const N=[new s.P(R.x1,R.y1),new s.P(R.x2,R.y1),new s.P(R.x2,R.y2),new s.P(R.x1,R.y2)];s.bv(n,N)&&(C[z.bucketInstanceId][z.featureIndex]=!0,L[z.bucketInstanceId]===void 0&&(L[z.bucketInstanceId]=[]),L[z.bucketInstanceId].push(z.featureIndex))}return L}insertCollisionBox(t,n,u,p,g){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,u,p,g){const x=n?this.ignoredGrid:this.grid,S={bucketInstanceId:u,featureIndex:p,collisionGroupID:g};for(let C=0;C<t.length;C+=4)x.insertCircle(S,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,n,u,p,g,x,S){const C=[n,u,p,1];let L=!1;p||this.transform.pitch>0?(s.ab.vec4.transformMat4(C,C,t),this.fogState&&g&&S.name!=="globe"&&(L=function(N,V,J,X,ie,te){const le=te.calculateFogTileMatrix(ie),we=[V,J,X];return s.ab.vec3.transformMat4(we,we,le),Ce(N,s.ab.vec3.length(we),te.pitch,te._fov)}(this.fogState,n,u,p,g.toUnwrapped(),this.transform)>.9)):li(C,C,t);const R=C[3];return{point:new s.P((C[0]/R+1)/2*this.transform.width+Oi,(-C[1]/R+1)/2*this.transform.height+Oi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/R*.5,1.5),signedDistanceFromCamera:R,occluded:x&&C[2]>R||L}}isOffscreen(t,n,u,p){return u<Oi||t>=this.screenRightBoundary||p<Oi||n>this.screenBottomBoundary}isInsideGrid(t,n,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=s.ab.mat4.identity([]);return s.ab.mat4.translate(t,t,[-100,-100,0]),t}}function Sn(l,t,n){const u=t.createTileMatrix(l,l.worldSize,n.toUnwrapped());return s.ab.mat4.multiply(new Float32Array(16),l.projMatrix,u)}function On(l,t,n){if(t.projection.name===n.projection.name)return l.projMatrix;const u=n.clone();return u.setProjection(t.projection),Sn(u,t.getProjection(),l)}function An(l,t,n){return t.name===n.projection.name?l.projMatrix:Sn(n,t,l)}class fr{constructor(t,n,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class mt{constructor(t,n,u,p,g,x=!1){this.text=new fr(t?t.text:null,n,u,g),this.icon=new fr(t?t.icon:null,n,p,g),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wt{constructor(t,n,u,p=!1){this.text=t,this.icon=n,this.skipFade=u,this.clipped=p}}class hi{constructor(){this.invProjMatrix=s.ab.mat4.create(),this.viewportMatrix=s.ab.mat4.create(),this.circles=[]}}class ln{constructor(t,n,u,p,g){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=g}}class bt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:u=>u.collisionGroupID===n}}return this.collisionGroups[t]}}function qt(l,t,n,u,p){const{horizontalAlign:g,verticalAlign:x}=s.bD(l),S=-(g-.5)*t,C=-(x-.5)*n,L=s.bC(l,u);return new s.P(S+L[0]*p,C+L[1]*p)}function Lt(l,t,n,u,p){const g=new s.P(l,t);return n&&g._rotate(u?p:-p),g}class Ai{constructor(t,n,u,p,g,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Hi(this.transform,g),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new bt(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,u,p,g=1){const x=u.getBucket(n),S=u.latestFeatureIndex;if(!x||!S||n.fqid!==x.layerIds[0])return;const C=x.layers[0].layout,L=x.layers[0].paint,R=u.collisionBoxArray,z=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),N=u.tileSize/s.ag,V=u.tileID.toUnwrapped();this.transform.setProjection(x.projection);const J=(X=u.tileID,ie=x.getProjection(),te=this.transform,ie.name===this.projection?te.calculateProjMatrix(X.toUnwrapped()):Sn(te,ie,X));var X,ie,te;const le=C.get("text-pitch-alignment")==="map",we=C.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const ve=n.dynamicFilter(),ze=n.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(u),Le=St(J,u.tileID.canonical,le,we,this.transform,x.getProjection(),Ae);let Me=null;if(le){const Ui=zt(J,u.tileID.canonical,le,we,this.transform,x.getProjection(),Ae);Me=s.ab.mat4.multiply([],this.transform.labelPlaneMatrix,Ui)}let He=null;ve&&u.latestFeatureIndex&&(He={unwrappedTileID:V,dynamicFilter:ve,dynamicFilterNeedsFeature:ze}),this.retainedQueryData[x.bucketInstanceId]=new ln(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,u.tileID);const[tt,Ft]=x.layers[0].layout.get("text-size-scale-range"),Mt=s.aw(g,tt,Ft),[ai,ei]=C.get("icon-size-scale-range"),yt=s.aw(g,ai,ei),Ut={bucket:x,layout:C,paint:L,posMatrix:J,textLabelPlaneMatrix:Le,labelToScreenMatrix:Me,clippingData:He,scale:z,textPixelRatio:N,holdingForFade:u.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:s.bp(x.textSizeData,this.transform.zoom,Mt),partiallyEvaluatedIconSize:s.bp(x.iconSizeData,this.transform.zoom,yt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const Ui of x.sortKeyRanges){const{sortKey:_t,symbolInstanceStart:_i,symbolInstanceEnd:Gt}=Ui;t.push({sortKey:_t,symbolInstanceStart:_i,symbolInstanceEnd:Gt,parameters:Ut})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Ut})}attemptAnchorPlacement(t,n,u,p,g,x,S,C,L,R,z,N,V,J,X,ie,te,le){const{textOffset0:we,textOffset1:ve,crossTileID:ze}=N,Ae=[we,ve],Le=qt(t,u,p,Ae,g),Me=this.collisionIndex.placeCollisionBox(J,g,n,Lt(Le.x,Le.y,x,S,this.transform.angle),z,C,L,R.predicate);if(ie){const He=J.getSymbolInstanceIconSize(le,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,He,ie,Lt(Le.x,Le.y,x,S,this.transform.angle),z,C,L,R.predicate).box.length===0)return}if(Me.box.length>0){let He;return this.prevPlacement&&this.prevPlacement.variableOffsets[ze]&&this.prevPlacement.placements[ze]&&this.prevPlacement.placements[ze].text&&(He=this.prevPlacement.variableOffsets[ze].anchor),this.variableOffsets[ze]={textOffset:Ae,width:u,height:p,anchor:t,textScale:g,prevAnchor:He},this.markUsedJustification(J,t,N,X),J.allowVerticalPlacement&&(this.markUsedOrientation(J,X,N),this.placedOrientations[ze]=X),{shift:Le,placedGlyphBoxes:Me}}}placeLayerBucketPart(t,n,u,p,g=1){const{bucket:x,layout:S,paint:C,posMatrix:L,textLabelPlaneMatrix:R,labelToScreenMatrix:z,clippingData:N,textPixelRatio:V,holdingForFade:J,collisionBoxArray:X,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:te,collisionGroup:le,latestFeatureIndex:we}=t.parameters,ve=S.get("text-optional"),ze=S.get("icon-optional"),Ae=S.get("text-allow-overlap"),Le=S.get("icon-allow-overlap"),Me=S.get("text-rotation-alignment")==="map",He=S.get("text-pitch-alignment")==="map",tt=S.get("symbol-z-elevate"),Ft=C.get("symbol-z-offset"),Mt=S.get("symbol-elevation-reference")==="sea",[ai,ei]=S.get("text-size-scale-range"),[yt,Ut]=S.get("icon-size-scale-range"),Ui=s.aw(g,ai,ei),_t=s.aw(g,yt,Ut);this.transform.setProjection(x.projection);let _i=Ae&&(Le||!x.hasIconData()||ze),Gt=Le&&(Ae||!x.hasTextData()||ve);const fn=!Ft.isConstant();!x.collisionArrays&&X&&x.deserializeCollisionBoxes(X),u&&p&&x.updateCollisionDebugBuffers(this.transform.zoom,X,Ui,_t);const Ri=(di,$i,dn)=>{const{crossTileID:Cn,numVerticalGlyphVertices:zn}=di;let xr=null;if(N&&N.dynamicFilterNeedsFeature||fn){const js=this.retainedQueryData[x.bucketInstanceId];xr=we.loadFeature({featureIndex:di.featureIndex,bucketIndex:js.bucketIndex,sourceLayerIndex:js.sourceLayerIndex,layoutVertexArrayOffset:0})}if(N&&!(0,N.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},xr,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new s.P(di.tileAnchorX,di.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[Cn]=new Wt(!1,!1,!1,!0),void n.add(Cn);const sr=Ft.evaluate(xr,{});if(n.has(Cn))return;if(J)return void(this.placements[Cn]=new Wt(!1,!1,!1));let lr=!1,Tr=!1,Yr=!0,As=!1,ho=!1,Ks=null,Rr={box:null,offscreen:null,occluded:null},ns={box:null,offscreen:null,occluded:null},Wn=null,$r=null,ps=null,_s=0,so=0,Xo=0;dn.textFeatureIndex?_s=dn.textFeatureIndex:di.useRuntimeCollisionCircles&&(_s=di.featureIndex),dn.verticalTextFeatureIndex&&(so=dn.verticalTextFeatureIndex);const Fo=js=>{js.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const Fs=this.transform.elevation;js.elevation=Mt?sr:sr+(Fs?Fs.getAtTileOffset(js.tileID,js.tileAnchorX,js.tileAnchorY):0),js.elevation+=di.zOffset},Bo=dn.textBox;if(Bo){Fo(Bo);const js=Kr=>{let Io=s.bq.horizontal;if(x.allowVerticalPlacement&&!Kr&&this.prevPlacement){const $o=this.prevPlacement.placedOrientations[Cn];$o&&(this.placedOrientations[Cn]=$o,Io=$o,this.markUsedOrientation(x,Io,di))}return Io},Fs=(Kr,Io)=>{if(x.allowVerticalPlacement&&zn>0&&dn.verticalTextBox){for(const $o of x.writingModes)if($o===s.bq.vertical?(Rr=Io(),ns=Rr):Rr=Kr(),Rr&&Rr.box&&Rr.box.length)break}else Rr=Kr()};if(S.get("text-variable-anchor")){let Kr=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Cn]){const Us=this.prevPlacement.variableOffsets[Cn];Kr.indexOf(Us.anchor)>0&&(Kr=Kr.filter(da=>da!==Us.anchor),Kr.unshift(Us.anchor))}const Io=(Us,da,Za)=>{const Ma=x.getSymbolInstanceTextSize(ie,di,this.transform.zoom,$i),ba=(Us.x2-Us.x1)*Ma+2*Us.padding,bl=(Us.y2-Us.y1)*Ma+2*Us.padding,Xa=di.hasIconTextFit&&!Le?da:null;Xa&&Fo(Xa);let Ua={box:[],offscreen:!1,occluded:!1};const gu=Ae?2*Kr.length:Kr.length;for(let wl=0;wl<gu;++wl){const _u=this.attemptAnchorPlacement(Kr[wl%Kr.length],Us,ba,bl,Ma,Me,He,V,L,le,wl>=Kr.length,di,$i,x,Za,Xa,ie,te);if(_u&&(Ua=_u.placedGlyphBoxes,Ua&&Ua.box&&Ua.box.length)){lr=!0,Ks=_u.shift;break}}return Ua};Fs(()=>Io(Bo,dn.iconBox,s.bq.horizontal),()=>{const Us=dn.verticalTextBox;return Us&&Fo(Us),x.allowVerticalPlacement&&!(Rr&&Rr.box&&Rr.box.length)&&zn>0&&Us?Io(Us,dn.verticalIconBox,s.bq.vertical):{box:null,offscreen:null,occluded:null}}),Rr&&(lr=Rr.box,Yr=Rr.offscreen,As=Rr.occluded);const $o=js(!(!Rr||!Rr.box));if(!lr&&this.prevPlacement){const Us=this.prevPlacement.variableOffsets[Cn];Us&&(this.variableOffsets[Cn]=Us,this.markUsedJustification(x,Us.anchor,di,$o))}}else{const Kr=(Io,$o)=>{const Us=x.getSymbolInstanceTextSize(ie,di,this.transform.zoom,$i,g),da=this.collisionIndex.placeCollisionBox(x,Us,Io,new s.P(0,0),Ae,V,L,le.predicate);return da&&da.box&&da.box.length&&(this.markUsedOrientation(x,$o,di),this.placedOrientations[Cn]=$o),da};Fs(()=>Kr(Bo,s.bq.horizontal),()=>{const Io=dn.verticalTextBox;return x.allowVerticalPlacement&&zn>0&&Io?(Fo(Io),Kr(Io,s.bq.vertical)):{box:null,offscreen:null,occluded:null}}),js(!!(Rr&&Rr.box&&Rr.box.length))}}if(Wn=Rr,lr=Wn&&Wn.box&&Wn.box.length>0,Yr=Wn&&Wn.offscreen,As=Wn&&Wn.occluded,di.useRuntimeCollisionCircles){const js=x.text.placedSymbolArray.get(di.centerJustifiedTextSymbolIndex>=0?di.centerJustifiedTextSymbolIndex:di.verticalPlacedTextSymbolIndex),Fs=s.br(x.textSizeData,ie,js),Kr=S.get("text-padding");$r=this.collisionIndex.placeCollisionCircles(x,Ae,js,x.lineVertexArray,x.glyphOffsetArray,Fs,L,R,z,u,He,le.predicate,di.collisionCircleDiameter*Fs/s.bw,Kr,this.retainedQueryData[x.bucketInstanceId].tileID),lr=Ae||$r.circles.length>0&&!$r.collisionDetected,Yr=Yr&&$r.offscreen,As=$r.occluded}if(dn.iconFeatureIndex&&(Xo=dn.iconFeatureIndex),dn.iconBox){const js=Fs=>{Fo(Fs);const Kr=di.hasIconTextFit&&Ks?Lt(Ks.x,Ks.y,Me,He,this.transform.angle):new s.P(0,0),Io=x.getSymbolInstanceIconSize(te,this.transform.zoom,di.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Io,Fs,Kr,Le,V,L,le.predicate)};ns&&ns.box&&ns.box.length&&dn.verticalIconBox?(ps=js(dn.verticalIconBox),Tr=ps.box.length>0):(ps=js(dn.iconBox),Tr=ps.box.length>0),Yr=Yr&&ps.offscreen,ho=ps.occluded}const Ba=ve||di.numHorizontalGlyphVertices===0&&zn===0,ha=ze||di.numIconVertices===0;if(Ba||ha?ha?Ba||(Tr=Tr&&lr):lr=Tr&&lr:Tr=lr=Tr&&lr,lr&&Wn&&Wn.box&&this.collisionIndex.insertCollisionBox(Wn.box,S.get("text-ignore-placement"),x.bucketInstanceId,ns&&ns.box&&so?so:_s,le.ID),Tr&&ps&&this.collisionIndex.insertCollisionBox(ps.box,S.get("icon-ignore-placement"),x.bucketInstanceId,Xo,le.ID),$r&&(lr&&this.collisionIndex.insertCollisionCircles($r.circles,S.get("text-ignore-placement"),x.bucketInstanceId,_s,le.ID),u)){const js=x.bucketInstanceId;let Fs=this.collisionCircleArrays[js];Fs===void 0&&(Fs=this.collisionCircleArrays[js]=new hi);for(let Kr=0;Kr<$r.circles.length;Kr+=4)Fs.circles.push($r.circles[Kr+0]),Fs.circles.push($r.circles[Kr+1]),Fs.circles.push($r.circles[Kr+2]),Fs.circles.push($r.collisionDetected?1:0)}const oo=x.projection.name!=="globe";_i=_i&&(oo||!As),Gt=Gt&&(oo||!ho),this.placements[Cn]=new Wt(lr||_i,Tr||Gt,Yr||x.justReloaded),n.add(Cn)};if(tt&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),x.sortFeaturesByY){const di=x.getSortedSymbolIndexes(this.transform.angle);for(let $i=di.length-1;$i>=0;--$i){const dn=di[$i];Ri(x.symbolInstances.get(dn),dn,x.collisionArrays[dn])}x.hasAnyZOffset&&s.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const di=x.getSortedIndexesByZOffset();for(let $i=0;$i<di.length;++$i){const dn=di[$i];Ri(x.symbolInstances.get(dn),dn,x.collisionArrays[dn])}}else for(let di=t.symbolInstanceStart;di<t.symbolInstanceEnd;di++)Ri(x.symbolInstances.get(di),di,x.collisionArrays[di]);if(u&&x.bucketInstanceId in this.collisionCircleArrays){const di=this.collisionCircleArrays[x.bucketInstanceId];s.ab.mat4.invert(di.invProjMatrix,L),di.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,n,u,p){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:C,crossTileID:L}=u,R=s.bB(n),z=p===s.bq.vertical?C:R==="left"?g:R==="center"?x:R==="right"?S:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=z>=0&&g!==z?0:L),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=z>=0&&x!==z?0:L),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=z>=0&&S!==z?0:L),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=z>=0&&C!==z?0:L)}markUsedOrientation(t,n,u){const p=n===s.bq.horizontal||n===s.bq.horizontalOnly?n:0,g=n===s.bq.vertical?n:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:L}=u,R=t.text.placedSymbolArray;x>=0&&(R.get(x).placedOrientation=p),S>=0&&(R.get(S).placedOrientation=p),C>=0&&(R.get(C).placedOrientation=p),L>=0&&(R.get(L).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let u=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const p=n?n.symbolFadeChange(t):1,g=n?n.opacities:{},x=n?n.variableOffsets:{},S=n?n.placedOrientations:{};for(const C in this.placements){const L=this.placements[C],R=g[C];R?(this.opacities[C]=new mt(R,p,L.text,L.icon,null,L.clipped),u=u||L.text!==R.text.placed||L.icon!==R.icon.placed):(this.opacities[C]=new mt(null,p,L.text,L.icon,L.skipFade,L.clipped),u=u||L.text||L.icon)}for(const C in g){const L=g[C];if(!this.opacities[C]){const R=new mt(L,p,!1,!1);R.isHidden()||(this.opacities[C]=R,u=u||L.text.placed||L.icon.placed)}}for(const C in x)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=x[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,u,p){const g=new Set;for(const x of n){const S=x.getBucket(t);S&&x.latestFeatureIndex&&t.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,g,x,x.collisionBoxArray,u,p,x.tileID,t.scope),S.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,x.tileID),S.updateZOffset()))}}updateBucketOpacities(t,n,u,p,g,x,S,C){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const L=t.layers[0].layout,R=t.layers[0].paint,z=!!t.layers[0].dynamicFilter(),N=new mt(null,0,!1,!1,!0),V=L.get("text-allow-overlap"),J=L.get("icon-allow-overlap"),X=L.get("text-variable-anchor"),ie=L.get("text-rotation-alignment")==="map",te=L.get("text-pitch-alignment")==="map",le=R.get("symbol-z-offset"),we=L.get("symbol-elevation-reference")==="sea",ve=!le.isConstant(),ze=new mt(null,0,V&&(J||!t.hasIconData()||L.get("icon-optional")),J&&(V||!t.hasTextData()||L.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const Ae=(Me,He,tt)=>{for(let Ft=0;Ft<He/4;Ft++)Me.opacityVertexArray.emplaceBack(tt)};let Le=0;x&&t.updateReplacement(S,x);for(let Me=0;Me<t.symbolInstances.length;Me++){const He=t.symbolInstances.get(Me),{numHorizontalGlyphVertices:tt,numVerticalGlyphVertices:Ft,crossTileID:Mt,numIconVertices:ai,tileAnchorX:ei,tileAnchorY:yt}=He;let Ut=null;const Ui=this.retainedQueryData[t.bucketInstanceId];ve&&He&&Ui&&(Ut=u.latestFeatureIndex.loadFeature({featureIndex:He.featureIndex,bucketIndex:Ui.bucketIndex,sourceLayerIndex:Ui.sourceLayerIndex,layoutVertexArrayOffset:0}));const _t=le.evaluate(Ut,{}),_i=n.has(Mt);let Gt=this.opacities[Mt];_i?Gt=N:Gt||(Gt=ze,this.opacities[Mt]=Gt),n.add(Mt);const fn=tt>0||Ft>0,Ri=ai>0,di=this.placedOrientations[Mt],$i=di===s.bq.vertical,dn=di===s.bq.horizontal||di===s.bq.horizontalOnly;!fn&&!Ri||Gt.isHidden()||Le++;let Cn=!1;if((fn||Ri)&&x)for(const zn of t.activeReplacements){if(s.bx(zn,g,s.by.Symbol,C)||zn.min.x>ei||ei>zn.max.x||zn.min.y>yt||yt>zn.max.y)continue;const xr=s.bz(ei,yt,S.canonical,zn.footprintTileId.canonical);if(Cn=s.bA(xr,zn.footprint),Cn)break}if(fn){const zn=Cn?rr:or(Gt.text);Ae(t.text,tt,$i?rr:zn),Ae(t.text,Ft,dn?rr:zn);const xr=Gt.text.isHidden(),{leftJustifiedTextSymbolIndex:sr,centerJustifiedTextSymbolIndex:lr,rightJustifiedTextSymbolIndex:Tr,verticalPlacedTextSymbolIndex:Yr}=He,As=t.text.placedSymbolArray,ho=xr||$i?1:0;sr>=0&&(As.get(sr).hidden=ho),lr>=0&&(As.get(lr).hidden=ho),Tr>=0&&(As.get(Tr).hidden=ho),Yr>=0&&(As.get(Yr).hidden=xr||dn?1:0);const Ks=this.variableOffsets[Mt];Ks&&this.markUsedJustification(t,Ks.anchor,He,di);const Rr=this.placedOrientations[Mt];Rr&&(this.markUsedJustification(t,"left",He,Rr),this.markUsedOrientation(t,Rr,He))}if(Ri){const zn=Cn?rr:or(Gt.icon),{placedIconSymbolIndex:xr,verticalPlacedIconSymbolIndex:sr}=He,lr=t.icon.placedSymbolArray,Tr=Gt.icon.isHidden()?1:0;xr>=0&&(Ae(t.icon,ai,$i?rr:zn),lr.get(xr).hidden=Tr),sr>=0&&(Ae(t.icon,He.numVerticalIconVertices,dn?rr:zn),lr.get(sr).hidden=Tr)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const zn=t.collisionArrays[Me];if(zn){let xr=new s.P(0,0),sr=!0;if(zn.textBox||zn.verticalTextBox){if(X){const Tr=this.variableOffsets[Mt];Tr?(xr=qt(Tr.anchor,Tr.width,Tr.height,Tr.textOffset,Tr.textScale),ie&&xr._rotate(te?this.transform.angle:-this.transform.angle)):sr=!1}z&&(sr=!Gt.clipped),zn.textBox&&Zi(t.textCollisionBox.collisionVertexArray,Gt.text.placed,!sr||$i,_t,we,xr.x,xr.y),zn.verticalTextBox&&Zi(t.textCollisionBox.collisionVertexArray,Gt.text.placed,!sr||dn,_t,we,xr.x,xr.y)}const lr=sr&&!!(!dn&&zn.verticalIconBox);zn.iconBox&&Zi(t.iconCollisionBox.collisionVertexArray,Gt.icon.placed,lr,_t,we,He.hasIconTextFit?xr.x:0,He.hasIconTextFit?xr.y:0),zn.verticalIconBox&&Zi(t.iconCollisionBox.collisionVertexArray,Gt.icon.placed,!lr,_t,we,He.hasIconTextFit?xr.x:0,He.hasIconTextFit?xr.y:0)}}}if(t.fullyClipped=Le===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Me.invProjMatrix,t.placementViewportMatrix=Me.viewportMatrix,t.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const u=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function Zi(l,t,n,u,p,g,x){l.emplaceBack(t?1:0,n?1:0,g||0,x||0,u,p?1:0),l.emplaceBack(t?1:0,n?1:0,g||0,x||0,u,p?1:0),l.emplaceBack(t?1:0,n?1:0,g||0,x||0,u,p?1:0),l.emplaceBack(t?1:0,n?1:0,g||0,x||0,u,p?1:0)}const Gi=Math.pow(2,25),Vi=Math.pow(2,24),gn=Math.pow(2,17),Nn=Math.pow(2,16),sn=Math.pow(2,9),nr=Math.pow(2,8),Fn=Math.pow(2,1);function or(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,n=Math.floor(127*l.opacity);return n*Gi+t*Vi+n*gn+t*Nn+n*sn+t*nr+n*Fn+t}const rr=0;class tr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,u,p,g,x){const S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(S,p,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((C,L)=>C.sortKey-L.sortKey));this._currentPartIndex<S.length;){const C=S[this._currentPartIndex];if(n.placeLayerBucketPart(C,this._seenCrossTileIDs,u,C.symbolInstanceStart===0,x),this._currentPartIndex++,g())return!0}return!1}}class yr{constructor(t,n,u,p,g,x,S,C,L){this.placement=new Ai(t,g,x,S,C,L),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,n,u,p,g){const x=s.q.now(),S=()=>{const C=s.q.now()-x;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=n[t[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=L)&&(!C.maxzoom||C.maxzoom>L)){const R=C,z=R.layout.get("symbol-z-elevate"),N=R.layout.get("symbol-sort-key").constantOr(1)!==void 0,V=R.layout.get("symbol-z-order"),J=V==="viewport-y"||V==="auto"&&!(V!=="viewport-y"&&N),X=R.layout.get("text-allow-overlap")||R.layout.get("icon-allow-overlap")||R.layout.get("text-ignore-placement")||R.layout.get("icon-ignore-placement"),ie=J&&X,te=this._inProgressLayer=this._inProgressLayer||new tr(R),le=s.aC(C.source,C.scope);if(te.continuePlacement(z||ie?p[le]:u[le],this.placement,this._showCollisionBoxes,C,S,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Wr=512/s.ag/2;class ss{constructor(t,n,u){this.tileID=t,this.bucketInstanceId=u,this.index=new s.bE(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*s.ag,g=t.canonical.y*s.ag;for(let x=0;x<n.length;x++){const{key:S,crossTileID:C,tileAnchorX:L,tileAnchorY:R}=n.get(x),z=Math.floor((p+L)*Wr),N=Math.floor((g+R)*Wr);this.index.add(z,N),this.keys.push(S),this.crossTileIDs.push(C)}this.index.finish()}findMatches(t,n,u){const p=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),g=Wr/Math.pow(2,n.canonical.z-this.tileID.canonical.z),x=n.canonical.x*s.ag,S=n.canonical.y*s.ag;for(let C=0;C<t.length;C++){const L=t.get(C);if(L.crossTileID)continue;const{key:R,tileAnchorX:z,tileAnchorY:N}=L,V=Math.floor((x+z)*g),J=Math.floor((S+N)*g),X=this.index.range(V-p,J-p,V+p,J+p);for(const ie of X){const te=this.crossTileIDs[ie];if(this.keys[ie]===R&&!u.has(te)){u.add(te),L.crossTileID=te;break}}}}}class Br{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const u in this.indexes){const p=this.indexes[u],g={};for(const x in p){const S=p[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+n),g[S.tileID.key]=S}this.indexes[u]=g}this.lng=t}addBucket(t,n,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<n.symbolInstances.length;g++)n.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const S in x){const C=x[S];C.tileID.isChildOf(t)&&C.findMatches(n.symbolInstances,t,p)}else{const S=x[t.scaledTo(Number(g)).key];S&&S.findMatches(n.symbolInstances,t,p)}}for(let g=0;g<n.symbolInstances.length;g++){const x=n.symbolInstances.get(g);x.crossTileID||(x.crossTileID=u.generate(),p.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ss(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const u of n.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let n=!1;for(const u in this.indexes){const p=this.indexes[u];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[g]),delete p[g],n=!0)}return n}}class Ms{constructor(){this.layerIndexes={},this.crossTileIDs=new Br,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,u,p){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new Gr);let x=!1;const S={};p.name!=="globe"&&g.handleWrapJump(u);for(const C of n){const L=C.getBucket(t);L&&t.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(C.tileID,L,this.crossTileIDs)&&(x=!0),S[L.bucketInstanceId]=!0)}return g.removeStaleBuckets(S)&&(x=!0),x}pruneUnusedLayers(t){const n={};t.forEach(u=>{n[u]=!0});for(const u in this.layerIndexes)n[u]||delete this.layerIndexes[u]}}const Os=771;class cr{constructor(t,n,u,p){this.blendFunction=t,this.blendColor=n,this.mask=u,this.blendEquation=p}}cr.Replace=[1,0,1,0],cr.disabled=new cr(cr.Replace,s.aj.transparent,[!1,!1,!1,!1]),cr.unblended=new cr(cr.Replace,s.aj.transparent,[!0,!0,!0,!0]),cr.alphaBlended=new cr([1,Os,1,Os],s.aj.transparent,[!0,!0,!0,!0]),cr.alphaBlendedNonPremultiplied=new cr([770,Os,770,Os],s.aj.transparent,[!0,!0,!0,!0]),cr.multiply=new cr([774,0,774,0],s.aj.transparent,[!0,!0,!0,!0]);class Ln{constructor(t,n,u){this.func=t,this.mask=n,this.range=u}}Ln.ReadOnly=!1,Ln.ReadWrite=!0,Ln.disabled=new Ln(519,Ln.ReadOnly,[0,1]);const $s=7680;class ar{constructor(t,n,u,p,g,x){this.test=t,this.ref=n,this.mask=u,this.fail=p,this.depthFail=g,this.pass=x}}ar.disabled=new ar({func:519,mask:0},0,0,$s,$s,$s);const po=1029,lo=2305;class Qn{constructor(t,n,u){this.enable=t,this.mode=n,this.frontFace=u}}function Lo(l,t){const n=s.bG(l,3);s.ab.mat4.fromQuat(l,t),s.bI(l,3,n)}function Go(l,t){const n=s.ab.quat.identity([]);return s.ab.quat.rotateZ(n,n,-t),s.ab.quat.rotateX(n,n,-l),n}function Aa(l,t){const n=[l[0],l[1],0],u=[t[0],t[1],0];if(s.ab.vec3.length(n)>=1e-15){const x=s.ab.vec3.normalize([],n);s.ab.vec3.scale(u,x,s.ab.vec3.dot(u,x)),t[0]=u[0],t[1]=u[1]}const p=s.ab.vec3.cross([],t,l);if(s.ab.vec3.len(p)<1e-15)return null;const g=Math.atan2(-p[1],p[0]);return Go(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),g)}Qn.disabled=new Qn(!1,po,lo),Qn.backCCW=new Qn(!0,po,lo),Qn.backCW=new Qn(!0,po,2304),Qn.frontCW=new Qn(!0,1028,2304),Qn.frontCCW=new Qn(!0,1028,lo);class Ca{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof s.aa?t:new s.aa(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=s.bF(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(s.aa.fromLngLat(t)):0,g=s.aa.fromLngLat(t,p),x=[g.x-u.x,g.y-u.y,g.z-u.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Aa(x,n)}setPitchBearing(t,n){this.orientation=Go(s.ai(t),s.ai(-n))}}class Ro{constructor(t,n){this._transform=s.ab.mat4.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new s.aa(t[0],t[1],t[2])}get position(){const t=s.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&s.bI(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.ab.quat.identity([]),t&&Lo(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=Go(t,n),Lo(this._transform,this._orientation)}forward(){const t=s.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const u=new Float64Array(16);return s.ab.mat4.invert(u,this.getWorldToCamera(t,n)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,u){const p=this.position;s.ab.vec3.scale(p,p,-t);const g=new Float64Array(16);return s.ab.mat4.fromScaling(g,[u,u,u]),s.ab.mat4.translate(g,g,p),g[10]*=n,g}getWorldToCamera(t,n){const u=new Float64Array(16),p=new Float64Array(4),g=this.position;return s.ab.quat.conjugate(p,this._orientation),s.ab.vec3.scale(g,g,-t),s.ab.mat4.fromQuat(u,p),s.ab.mat4.translate(u,u,g),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=n,u[9]*=n,u[10]*=n,u[11]*=n,u}getCameraToClipPerspective(t,n,u,p){const g=new Float64Array(16);return s.ab.mat4.perspective(g,t,n,u,p),g}getCameraToClipOrthographic(t,n,u,p,g,x){const S=new Float64Array(16);return s.ab.mat4.ortho(S,t,n,u,p,g,x),S}getDistanceToElevation(t,n=!1){const u=t===0?0:s.bH(t,n?s.aS(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new Ro([...this.position],[...this.orientation])}}const Eo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class mn{constructor(t=0,n=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=u,this.right=p}interpolate(t,n,u){return n.top!=null&&t.top!=null&&(this.top=s.af(t.top,n.top,u)),n.bottom!=null&&t.bottom!=null&&(this.bottom=s.af(t.bottom,n.bottom,u)),n.left!=null&&t.left!=null&&(this.left=s.af(t.left,n.left,u)),n.right!=null&&t.right!=null&&(this.right=s.af(t.right,n.right,u)),this}getCenter(t,n){const u=s.aw((this.left+t-this.right)/2,0,t),p=s.aw((this.top+n-this.bottom)/2,0,n);return new s.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new mn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ol=(l,t,n)=>(1-n)*l+n*t,$a=l=>l*l*l*l*l;class Pa{constructor(t,n,u,p,g,x,S){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=u!=null?u:0,this._maxPitch=p!=null?p:60,this.setProjection(x),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new s.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new mn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ro,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Pa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return s.ay(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=s.bP(this.projectionOptions);const u=this.getProjection(),p=!s.bn(n,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bP({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=s.ab.mat2.create(),s.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=s.aw(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.ai(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,g=0;for(let x=0;x<n.length;x++){const S=new s.P(n[x][0]*this.width,u+n[x][1]*(this.height-u)),C=t.pointCoordinate(S);if(!C)continue;const L=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);p+=C[3]*L,g+=L}return g===0?NaN:p/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*n,p=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),x=Math.max(p-u,g);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const p=s.ab.vec3.length(s.ab.vec3.sub([],this._camera.position,u));return s.aw(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!s.ab.quat.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];s.ab.vec3.exactEquals(u,this._camera.position)||(this._setCameraPosition(u),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new Ca;return n.position=new s.aa(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!s.ab.quat.length(t))return!1;s.ab.quat.normalize(t,t);const n=s.ab.vec3.transformQuat([],[0,0,-1],t),u=s.ab.vec3.transformQuat([],[0,-1,0],t);if(u[2]<0)return!1;const p=Aa(n,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=s.aw(t[2],p/u,p/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,u){this._unmodified=!1,this._edgeInsets.interpolate(t,n,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new s.bQ(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new s.P(0,0)),p=this.pointCoordinate(new s.P(this.width,0)),g=this.pointCoordinate(new s.P(this.width,this.height)),x=this.pointCoordinate(new s.P(0,this.height)),S=Math.floor(Math.min(u.x,p.x,g.x,x.x)),C=Math.floor(Math.max(u.x,p.x,g.x,x.x)),L=1;for(let R=S-L;R<=C+L;R++)R!==0&&n.push(new s.bQ(R,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,u){let p=[];const g=u!==void 0,x=!g;if(x&&this.zoom<n||g&&u[0]===0&&u[1]===0)return p;const S=new Set,C=(R,z,N,V,J)=>{const X=s.c5(z,R,N,V,J);S.has(X)||(p.push(new s.aG(R,z,N,V,J)),S.add(X))};for(let R=0;R<t.length;R++){const z=t[R];if(x&&z.canonical.z!==n)continue;const N=z.canonical,V=z.overscaledZ,J=z.wrap,X=1<<N.z,ie=N.x+1<X,te=N.x>0,le=N.y+1<X,we=N.y>0,ve=z.wrap-(te?0:1),ze=z.wrap+(ie?0:1),Ae=te?N.x-1:X-1,Le=ie?N.x+1:0;if(g)u[0]<0?(C(V,ze,N.z,Le,N.y),u[1]<0&&le&&(C(V,J,N.z,N.x,N.y+1),C(V,ze,N.z,Le,N.y+1)),u[1]>0&&we&&(C(V,J,N.z,N.x,N.y-1),C(V,ze,N.z,Le,N.y-1))):u[0]>0?(C(V,ve,N.z,Ae,N.y),u[1]<0&&le&&(C(V,J,N.z,N.x,N.y+1),C(V,ve,N.z,Ae,N.y+1)),u[1]>0&&we&&(C(V,J,N.z,N.x,N.y-1),C(V,ve,N.z,Ae,N.y-1))):u[1]<0&&le?C(V,J,N.z,N.x,N.y+1):we&&C(V,J,N.z,N.x,N.y-1);else{const Me=z.visibleQuadrants;1&Me&&(C(V,ve,N.z,Ae,N.y),we&&(C(V,J,N.z,N.x,N.y-1),C(V,ve,N.z,Ae,N.y-1))),2&Me&&(C(V,ze,N.z,Le,N.y),we&&(C(V,J,N.z,N.x,N.y-1),C(V,ze,N.z,Le,N.y-1))),4&Me&&(C(V,ve,N.z,Ae,N.y),le&&(C(V,J,N.z,N.x,N.y+1),C(V,ve,N.z,Ae,N.y+1))),8&Me&&(C(V,ze,N.z,Le,N.y),le&&(C(V,J,N.z,N.x,N.y+1),C(V,ze,N.z,Le,N.y+1)))}}const L=[];for(const R of p)p.some(z=>R.isChildOf(z))||L.push(R);if(p=L.filter(R=>!t.some(z=>!!(R.overscaledZ<n&&z.isChildOf(R))||R.equals(z)||R.isChildOf(z))),x){const R=1<<n,z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=[R*z.x,R*z.y],V=4,J=V*V;p=p.filter(X=>{const ie=X.canonical.x+.5-N[0],te=X.canonical.y+.5-N[1];return ie*ie+te*te<J})}return p}coveringTiles(t){let n=this.coveringZoomLevel(t);const u=n,p=this.elevation&&this.elevation.exaggeration(),g=p&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const S=this.locationCoordinate(this.center),C=this.center.lat,L=1<<n,R=[L*S.x,L*S.y,0],z=this.projection.name==="globe",N=!z,V=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,N),J=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=L*s.bH(1,this.center.lat),ie=this._camera.position[2]/s.bH(1,this.center.lat),te=[L*J.x,L*J.y,ie*(N?1:X)],le=z||p,we=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ve=this.isLODDisabled(!0)?n:0;let ze;if(this._elevation&&t.isTerrainDEM)ze=1e4*this._elevation.exaggeration();else if(this._elevation){const _t=this._elevation.getMinMaxForVisibleTiles();ze=_t?_t.max:this._centerAltitude}else ze=this._centerAltitude;const Ae=t.isTerrainDEM?-ze:this._elevation?this._elevation.getMinElevationBelowMSL():0,Le=this.projection.isReprojectedInTileSpace?s.bS(this):1,Me=_t=>{const Gt=new s.aa(_t.x+25e-6,_t.y,_t.z),fn=new s.aa(_t.x,_t.y+25e-6,_t.z),Ri=_t.toLngLat(),di=Gt.toLngLat(),$i=fn.toLngLat(),dn=this.locationCoordinate(Ri),Cn=this.locationCoordinate(di),zn=this.locationCoordinate($i),xr=Math.hypot(Cn.x-dn.x,Cn.y-dn.y),sr=Math.hypot(zn.x-dn.x,zn.y-dn.y);return Math.sqrt(xr*sr)*Le/25e-6},He=_t=>{const _i=ze,Gt=Ae;return{aabb:s.bV(this,L,0,0,0,_t,Gt,_i,this.projection),zoom:0,x:0,y:0,minZ:Gt,maxZ:_i,wrap:_t,fullyVisible:!1}},tt=[];let Ft=[];const Mt=n,ai=t.reparseOverscaled?u:n,ei=(ie-this._centerAltitude)*X,yt=_t=>{if(!this._elevation||!_t.tileID||!x)return;const _i=this._elevation.getMinMaxForTile(_t.tileID),Gt=_t.aabb;_i?(Gt.min[2]=_i.min,Gt.max[2]=_i.max,Gt.center[2]=(Gt.min[2]+Gt.max[2])/2):(_t.shouldSplit=Ui(_t),_t.shouldSplit||(Gt.min[2]=Gt.max[2]=Gt.center[2]=this._centerAltitude))},Ut=(_t,_i)=>{if(.707*_i<_t)return 1;const Gt=_i/_t;return Gt/(1.4144271570014144+(Math.pow(1.1,Gt-1.4144271570014144+1)-1)/(1.1-1)-1)},Ui=_t=>{if(_t.zoom<ve)return!0;if(_t.zoom===Mt)return!1;if(_t.shouldSplit!=null)return _t.shouldSplit;const _i=_t.aabb.distanceX(te),Gt=_t.aabb.distanceY(te);let fn=ei,Ri=1;if(z){fn=_t.aabb.distanceZ(te);const sr=Math.pow(2,_t.zoom),lr=s.aS((_t.y+1)/sr),Tr=s.aS(_t.y/sr),Yr=Math.min(Math.max(C,lr),Tr),As=s.c9(Yr)/s.c9(C);if(Ri=Yr===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,As/this._mercatorScaleRatio),this.zoom<=s.c6&&_t.zoom===Mt-1&&As>=.9)return!0}else if(g&&(fn=_t.aabb.distanceZ(te)*X),this.projection.isReprojectedInTileSpace&&u<=5){const sr=Math.pow(2,_t.zoom),lr=Me(new s.aa((_t.x+.5)/sr,(_t.y+.5)/sr));Ri=lr>.85?1:lr}if(!x){const sr=Math.sqrt(_i*_i+Gt*Gt+fn*fn);let lr=(1<<Mt-_t.zoom)*we*Ri;return lr*=Ut(Math.max(fn,ei),sr),sr<lr}let di=Number.MAX_VALUE,$i=0;const dn=_t.aabb.getCorners(),Cn=[];for(const sr of dn){s.ab.vec3.sub(Cn,sr,te),z||(g?Cn[2]*=X:Cn[2]=ei);const lr=s.ab.vec3.dot(Cn,this._camera.forward());lr<di&&(di=lr,$i=Math.abs(Cn[2]))}let zn=(1<<Mt-_t.zoom)*we*Ri;if(zn*=Ut(Math.max($i,ei),di),di<zn)return!0;const xr=_t.aabb.closestPoint(R);return xr[0]===R[0]&&xr[1]===R[1]};if(this.renderWorldCopies)for(let _t=1;_t<=3;_t++)tt.push(He(-_t)),tt.push(He(_t));for(tt.push(He(0));tt.length>0;){const _t=tt.pop(),_i=_t.x,Gt=_t.y;let fn=_t.fullyVisible;const Ri=()=>this.projection.name==="globe"&&(_t.y===0||_t.y===(1<<_t.zoom)-1);if(!fn){let di=le?_t.aabb.intersects(V):_t.aabb.intersectsFlat(V);if(di===0&&Ri()){const $i=new s.bT(_t.zoom,_i,Gt);di=s.bU(this,L,$i,!0).intersects(V)}if(di===0)continue;fn=di===2}if(_t.zoom!==Mt&&Ui(_t))for(let di=0;di<4;di++){const $i=(_i<<1)+di%2,dn=(Gt<<1)+(di>>1),Cn={aabb:x?_t.aabb.quadrant(di):s.bV(this,L,_t.zoom+1,$i,dn,_t.wrap,_t.minZ,_t.maxZ,this.projection),zoom:_t.zoom+1,x:$i,y:dn,wrap:_t.wrap,fullyVisible:fn,tileID:void 0,shouldSplit:void 0,minZ:_t.minZ,maxZ:_t.maxZ};g&&!z&&(Cn.tileID=new s.aG(_t.zoom+1===Mt?ai:_t.zoom+1,_t.wrap,_t.zoom+1,$i,dn),yt(Cn)),tt.push(Cn)}else{const di=_t.zoom===Mt?ai:_t.zoom;if(t.minzoom&&t.minzoom>di)continue;let $i=0;if(!fn){let xr=le?_t.aabb.intersectsPrecise(V):_t.aabb.intersectsPreciseFlat(V);if(xr===0&&Ri()){const sr=new s.bT(_t.zoom,_i,Gt);xr=s.bU(this,L,sr,!0).intersectsPrecise(V)}if(xr===0)continue;if(t.calculateQuadrantVisibility)if(V.containsPoint(_t.aabb.center))$i=15;else for(let sr=0;sr<4;sr++)_t.aabb.quadrant(sr).intersects(V)!==0&&($i|=1<<sr)}const dn=R[0]-(.5+_i+(_t.wrap<<_t.zoom))*(1<<n-_t.zoom),Cn=R[1]-.5-Gt,zn=_t.tileID?_t.tileID:new s.aG(di,_t.wrap,_t.zoom,_i,Gt);t.calculateQuadrantVisibility&&(zn.visibleQuadrants=$i),Ft.push({tileID:zn,distanceSq:dn*dn+Cn*Cn})}}if(this.fogCullDistSq){const _t=this.fogCullDistSq,_i=this.horizonLineFromTop();Ft=Ft.filter(Gt=>{const fn=[0,0,0,1],Ri=[s.ag,s.ag,0,1],di=this.calculateFogTileMatrix(Gt.tileID.toUnwrapped());s.ab.vec4.transformMat4(fn,fn,di),s.ab.vec4.transformMat4(Ri,Ri,di);const $i=s.ab.vec4.min([],fn,Ri),dn=s.ab.vec4.max([],fn,Ri),Cn=s.bW($i,dn);if(Cn===0)return!0;let zn=!1;const xr=this._elevation;if(xr&&Cn>_t&&_i!==0){const sr=this.calculateProjMatrix(Gt.tileID.toUnwrapped());let lr;t.isTerrainDEM||(lr=xr.getMinMaxForTile(Gt.tileID)),lr||(lr={min:Ae,max:ze});const Tr=s.c7(this.rotation),Yr=[Tr[0]*s.ag,Tr[1]*s.ag,lr.max];s.ab.vec3.transformMat4(Yr,Yr,sr),zn=(1-Yr[1])*this.height*.5<_i}return Cn<_t||zn})}return Ft.sort((_t,_i)=>_t.distanceSq-_i.distanceSq).map(_t=>_t.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=s.aw(t.lat,-s.bX,s.bX),u=this.projection.project(t.lng,n);return new s.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let u,p;const g=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;u=(n.x-g.x)/S,p=(n.y-g.y)/S}else{const S=this.pointCoordinate(n),C=this.pointCoordinate(g);u=S.x-C.x,p=S.y-C.y}const x=this.locationCoordinate(t);this.setLocation(new s.aa(x.x-u,x.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,n){const u=n?s.bH(n,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new s.aa(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const u=n!=null?n:this._centerAltitude,p=[t.x,t.y,0,1],g=[t.x,t.y,1,1];s.ab.vec4.transformMat4(p,p,this.pixelMatrixInverse),s.ab.vec4.transformMat4(g,g,this.pixelMatrixInverse);const x=g[3];s.ab.vec4.scale(p,p,1/p[3]),s.ab.vec4.scale(g,g,1/x);const S=p[2],C=g[2];return{p0:p,p1:g,t:S===C?0:(u-S)/(C-S)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return s.ab.vec4.transformMat4(n,n,this.pixelMatrixInverse),s.ab.vec4.transformMat4(u,u,this.pixelMatrixInverse),s.ab.vec4.scale(n,n,1/n[3]),s.ab.vec4.scale(u,u,1/u[3]),n[2]=s.bH(n[2],this._center.lat)*this.worldSize,u[2]=s.bH(u[2],this._center.lat)*this.worldSize,s.ab.vec4.scale(n,n,1/this.worldSize),s.ab.vec4.scale(u,u,1/this.worldSize),new s.aq([n[0],n[1],n[2]],s.ab.vec3.normalize([],s.ab.vec3.sub([],u,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:u,t:p}=t,g=s.bH(n[2],this._center.lat),x=s.bH(u[2],this._center.lat);return new s.aa(s.af(n[0],u[0],p)/this.worldSize,s.af(n[1],u[1],p)/this.worldSize,s.af(g,x,p))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new s.aa(n[0],n[1],n[2]);let u=0,p=this.horizonLineFromTop();if(t.y>p)return this.pointCoordinate(t);const g=.02*p,x=t.clone();for(let S=0;S<10&&p-u>g;S++){x.y=s.af(u,p,.66);const C=this.projection.pointCoordinate3D(this,x.x,x.y);C?(p=x.y,n=C):u=x.y}return n?new s.aa(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.bY)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const u=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return s.ab.vec4.transformMat4(p,p,this.pixelMatrix),p[3]>0?new s.P(p[0]/p[3],p[1]/p[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,g=this.pointLocation3D(new s.P(n,t)),x=this.pointLocation3D(new s.P(p,t)),S=this.pointLocation3D(new s.P(p,u)),C=this.pointLocation3D(new s.P(n,u));let L=Math.min(g.lng,x.lng,S.lng,C.lng),R=Math.max(g.lng,x.lng,S.lng,C.lng),z=Math.min(g.lat,x.lat,S.lat,C.lat),N=Math.max(g.lat,x.lat,S.lat,C.lat);const V=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,X=(ie,te,le,we,ve)=>{const ze=(ie+le)/2,Ae=(te+we)/2,Le=new s.P(ze,Ae),{lng:Me,lat:He}=this.pointLocation3D(Le),tt=Math.max(0,L-Me,z-He,Me-R,He-N);L=Math.min(L,Me),R=Math.max(R,Me),z=Math.min(z,He),N=Math.max(N,He),(ve<J||tt>V)&&(X(ie,te,ze,Ae,ve+1),X(ze,Ae,le,we,ve+1))};if(X(n,t,p,t,1),X(p,t,p,u,1),X(p,u,n,u,1),X(n,u,n,t,1),this.projection.name==="globe"){const[ie,te]=s.bZ(this);ie?(N=90,R=180,L=-180):te&&(z=-90,R=180,L=-180)}return new s.az(new s.bO(L,z),new s.bO(R,N))}_getBoundsRectangular(t,n){const{top:u,left:p}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=new s.P(p,u),C=new s.P(x,u),L=new s.P(x,g),R=new s.P(p,g);let z=this.pointCoordinate(S,t),N=this.pointCoordinate(C,t);const V=this.pointCoordinate(L,n),J=this.pointCoordinate(R,n),X=(ie,te)=>(te.y-ie.y)/(te.x-ie.x);return z.y>1&&N.y>=0?z=new s.aa((1-J.y)/X(J,z)+J.x,1):z.y<0&&N.y<=1&&(z=new s.aa(-J.y/X(J,z)+J.x,0)),N.y>1&&z.y>=0?N=new s.aa((1-V.y)/X(V,N)+V.x,1):N.y<0&&z.y<=1&&(N=new s.aa(-V.y/X(V,N)+V.x,0)),new s.az().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const g=p.dem.tree;u.min=Math.min(u.min,g.minimums[0]),u.max=Math.max(u.max,g.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.bX,this.maxLat=s.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.at(this.minLng)*this.tileSize,this.worldMaxX=s.at(this.maxLng)*this.tileSize,this.worldMinY=s.aA(this.maxLat)*this.tileSize,this.worldMaxY=s.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,u=this._distanceTileDataCache;if(u[n])return u[n];const p=t.canonical,g=1/this.height,x=this.cameraWorldSize,S=x/this.zoomScale(p.z),C=(p.x+Math.pow(2,p.z)*t.wrap)*S,L=p.y*S,R=this.point;R.x*=x/this.worldSize,R.y*=x/this.worldSize;const z=this.angle,N=Math.sin(-z),V=-Math.cos(-z);return u[n]={bearing:[N,V],center:[(R.x-C)*g,(R.y-L)*g],scale:S/s.ag*g},u[n]}calculateFogTileMatrix(t){const n=t.key,u=this._fogTileMatrixCache;if(u[n])return u[n];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.ab.mat4.multiply(p,this.worldToFogMatrix,p),u[n]=new Float32Array(p),u[n]}calculateProjMatrix(t,n=!1,u=!1){const p=t.key;let g;if(g=u?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,g[p])return g[p];const x=this.calculatePosMatrix(t,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,s.ab.mat4.multiply(x,S,x),g[p]=new Float32Array(x),g[p]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[n])return u[n];const p=s.b_(t,this);return u[n]=p,u[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=s.ab.mat4.fromScaling([],[t,t,t]);return s.ab.mat4.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=s.bH(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(n),p=this._camera.forward(),g=s.bH(1,this._center.lat);u[2]/=g,p[2]/=g,s.ab.vec3.normalize(p,p);const x=t.raycast(u,p,t.exaggeration());if(x){const S=s.ab.vec3.scaleAndAdd([],u,p,x),C=new s.aa(S[0],S[1],s.bH(S[2],s.aS(S[1]))),L=(C.z+s.ab.vec3.length([C.x-u[0],C.y-u[1],C.z-u[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,u=s.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),g=n.getAtPointOrZero(new s.aa(...p)),x=this.pixelsPerMeter/this.worldSize*g,S=this._minimumHeightOverTerrain(),C=p[2]-x;if(C<=S)if(C<0||t){const L=this.locationCoordinate(this._center,this._centerAltitude),R=[p[0],p[1],L.z-p[2]],z=s.ab.vec3.length(R);R[2]-=(S-C)/this._pixelsPerMercatorPixel;const N=s.ab.vec3.length(R);if(N===0)return;s.ab.vec3.scale(R,R,z/N*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],L.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const N=this.center;return N.lat=s.aw(N.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(N.lng=s.aw(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}const n=this._unmodified,{x:u,y:p}=this.point;let g=0,x=u,S=p;const C=this.width/2,L=this.height/2,R=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(p-L<R&&(S=R+L),p+L>z&&(S=z-L),z-R<this.height&&(g=Math.max(g,this.height/(z-R)),S=(z+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const N=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,J=this.worldSize/2-(N+V)/2;x=(u+J+this.worldSize)%this.worldSize-J,x-C<N&&(x=N+C),x+C>V&&(x=V-C),V-N<this.width&&(g=Math.max(g,this.width/(V-N)),x=(V+N)/2)}x===u&&S===p||(this.center=this.unproject(new s.P(x,S))),g&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bH(1,this.center.lat)/s.bH(1,s.c8));const p=s.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?u:1,x=this._camera.getWorldToCamera(this.worldSize,g);let S;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-t.x/this.width,C[9]=2*t.y/this.height,this.isOrthographic){let He=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),tt=He*this.aspect,Ft=-tt,Mt=-He;tt-=t.x,Ft-=t.x,He+=t.y,Mt+=t.y,S=this._camera.getCameraToClipOrthographic(Ft,tt,Mt,He,this._nearZ,this._farZ),((ai,ei,yt,Ut)=>{for(let Ui=0;Ui<16;Ui++)ai[Ui]=ol(ei[Ui],yt[Ui],Ut)})(S,S,C,$a(this.pitch>=15?1:this.pitch/15))}else S=C;const L=s.ab.mat4.mul([],C,x);let R=s.ab.mat4.mul([],S,x);if(this.projection.isReprojectedInTileSpace){const He=this.locationCoordinate(this.center),tt=s.ab.mat4.identity([]);s.ab.mat4.translate(tt,tt,[He.x*this.worldSize,He.y*this.worldSize,0]),s.ab.mat4.multiply(tt,tt,s.c0(this)),s.ab.mat4.translate(tt,tt,[-He.x*this.worldSize,-He.y*this.worldSize,0]),s.ab.mat4.multiply(R,R,tt),s.ab.mat4.multiply(L,L,tt),this.inverseAdjustmentMatrix=s.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.ab.mat4.scale([],R,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=R,this.invProjMatrix=s.ab.mat4.invert(new Float64Array(16),this.projMatrix),n){const He=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);He[8]=2*-t.x/this.width,He[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.ab.mat4.mul([],He,x)}else this.expandedFarZProjMatrix=this.projMatrix;const z=s.ab.mat4.invert([],S);this.frustumCorners=s.c2.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const N=new Float32Array(16);s.ab.mat4.identity(N),s.ab.mat4.scale(N,N,[1,-1,1]),s.ab.mat4.rotateX(N,N,this._pitch),s.ab.mat4.rotateZ(N,N,this.angle);const V=s.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.ab.mat4.clone(V);const J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-t.x/this.width,V[9]=2*(t.y+J)/this.height,this.skyboxMatrix=s.ab.mat4.multiply(N,V,N);const X=this.point,ie=X.x,te=X.y,le=this.width%2/2,we=this.height%2/2,ve=Math.cos(this.angle),ze=Math.sin(this.angle),Ae=ie-Math.round(ie)+ve*le+ze*we,Le=te-Math.round(te)+ve*we+ze*le,Me=new Float64Array(R);if(s.ab.mat4.translate(Me,Me,[Ae>.5?Ae-1:Ae,Le>.5?Le-1:Le,0]),this.alignedProjMatrix=Me,R=s.ab.mat4.create(),s.ab.mat4.scale(R,R,[this.width/2,-this.height/2,1]),s.ab.mat4.translate(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=s.ab.mat4.create(),s.ab.mat4.scale(R,R,[1,-1,1]),s.ab.mat4.translate(R,R,[-1,-1,0]),s.ab.mat4.scale(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=s.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},R=s.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.c3(this);const He=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ab.vec3.transformMat4(He,He,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,n];s.ab.vec3.scale(g,g,p),s.ab.vec3.scale(u,u,-1),s.ab.vec3.multiply(u,u,g);const x=s.ab.mat4.create();s.ab.mat4.translate(x,x,u),s.ab.mat4.scale(x,x,g),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,p)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*g,p.y/this.worldSize-u[1]*g,t/this.worldSize*this._centerAltitude-u[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(g=Math.min((n-u)/p,1)),this._camera.position=s.ab.vec3.scaleAndAdd([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),g=s.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.ai(this._maxPitch)),S=Math.max((t[2]-g)/Math.cos(u),x),C=this._zoomFromMercatorZ(S);s.ab.vec3.scaleAndAdd(t,t,n,S),this._pitch=s.aw(u,s.ai(this.minPitch),s.ai(this.maxPitch)),this.angle=s.bF(p,-Math.PI,Math.PI),this._setZoom(s.aw(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.aa(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,u=s.bY,p=0,g=1/0;for(;u-n>1e-6&&u>n;){const x=n+.5*(u-n),S=this.tileSize*Math.pow(2,x),C=this.getCameraToCenterDistance(this.projection,x,S),L=this.scaleZoom(C/(t*this.tileSize)),R=Math.abs(x-L);R<g&&(g=R,p=x),x<L?n=x:u=x}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const u=Math.min(t.x,n.x),p=Math.max(t.x,n.x),g=Math.min(t.y,n.y),x=Math.max(t.y,n.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new s.P(u,g),new s.P(p,x),new s.P(u,x),new s.P(p,g)],C=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const R of S){const z=this.pointRayIntersection(R);if(z.t<0)return!0;const N=this.rayIntersectionCoordinate(z);if(N.x<C||N.y<0||N.x>L||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,n){const u=s.ab.vec3.length(s.ab.vec3.sub([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+n;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,u,p],g){const x=[n,u,p,1];s.ab.vec4.transformMat4(x,x,g);const S=x[3]=Math.max(x[3],1e-6);return x[0]/=S,x[1]/=S,x[2]/=S,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,u=this.worldSize){const p=s.b$(t,n,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,u,p);let x=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(x=ol(1,x,$a(this.pitch>=15?1:this.pitch/15))),x}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.ab.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const La=(l,t)=>{if(t>0&&l.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=l.transform,u=Math.max(Math.abs(n._zoom-(l.minCutoffZoom-1)),1),p=n.isLODDisabled(!1)?s.ac(60,45,n.pitch):s.ac(30,15,n.pitch),g=n._farZ-n._nearZ,x=t*n.height,S=((1-(C=p))*n.cameraToCenterDistance+C*(n._farZ+x))*u;var C;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(S-n._nearZ)/g,(S-x-n._nearZ)/g]}}},_o={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Qo{constructor(t,n){this.aabb=t,this.lastCascade=n}}class Wa{add(t,n){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],n.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],n.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],n.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],n.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],n.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],n.max[2])):this.receivers[t.key]=new Qo(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,u){const p=s.cd.fromPoints(t.points);let g=0;for(const x in this.receivers){const S=this.receivers[x];if(!S||!p.intersectsAabb(S.aabb))continue;S.aabb.min=p.closestPoint(S.aabb.min),S.aabb.max=p.closestPoint(S.aabb.max);const C=S.aabb.getCorners();for(let L=0;L<u.length;L++){let R=!0;for(const z of C){const N=[z[0]*n,z[1]*n,z[2]];if(s.ab.vec3.transformMat4(N,N,u[L].matrix),N[0]<-1||N[0]>1||N[1]<-1||N[1]>1){R=!1;break}}if(S.lastCascade=L,g=Math.max(g,L),R)break}}return g+1}}class va{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Wa,this._depthMode=new Ln(t.context.gl.LEQUAL,Ln.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(_o,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(_o,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(_o,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const p=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((J,X)=>{const ie=u.style._mergedLayers[X];return J+(ie.hasShadowPass()&&!ie.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=u.context,x=_o.shadowMapResolution,S=_o.shadowMapResolution;if(this._cascades.length===0||_o.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let J=0;J<_o.cascadeCount;++J){const X=u._shadowMapDebug,ie=g.gl,te=g.createFramebuffer(x,S,X,"texture"),le=new s.T(g,{width:x,height:S,data:null},ie.DEPTH_COMPONENT16);if(te.depthAttachment.set(le.texture),X){const we=new s.T(g,{width:x,height:S,data:null},ie.RGBA8);te.colorAttachment.set(we.texture)}this._cascades.push({framebuffer:te,texture:le,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bR,scale:0})}}this.shadowDirection=ua(n);let C=0;if(t.elevation){const J=t.elevation,X=[1e4,-1e4];J.visibleDemTiles.filter(ie=>ie.dem).forEach(ie=>{const te=ie.dem.tree;X[0]=Math.min(X[0],te.minimums[0]),X[1]=Math.max(X[1],te.maximums[0])}),X[0]!==1e4&&(C=(X[1]-X[0])*J.exaggeration())}const L=1.5*t.cameraToCenterDistance,R=3*L,z=new Float64Array(16);for(let J=0;J<this._cascades.length;++J){const X=this._cascades[J];let ie=t.height/50,te=1;_o.cascadeCount===1?te=R:J===0?te=L:(ie=L,te=R);const[le,we]=wa(t,this.shadowDirection,ie,te,_o.shadowMapResolution,C);X.scale=t.scale,X.matrix=le,X.boundingSphereRadius=we,s.ab.mat4.invert(z,X.matrix),X.frustum=s.bR.fromInvProjectionMatrix(z,1,0,!0),X.far=te}const N=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[N].far,this._cascades[N].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/_o.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=_o.shadowMapResolution,this._uniformValues.u_shadowmap_0=Eo.ShadowMap0,this._uniformValues.u_shadowmap_1=Eo.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const V=u.transform.elevation;for(const J of this._groundShadowTiles){let X={min:0,max:0};if(V){const ie=V.getMinMaxForTile(J);ie&&(X=ie)}this.addShadowReceiver(J.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,_o.shadowMapResolution,_o.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){u.currentShadowCascade=g,p.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),p.clear({color:s.aj.white,depth:1});for(const x of t.order){const S=t._mergedLayers[x];if(!S.hasShadowPass()||S.isHidden(u.transform.zoom))continue;const C=t.getLayerSourceCache(S),L=C?n[C.id]:void 0;(S.type==="model"||L&&L.length)&&u.renderLayer(u,C,S,L)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,u=t.context,p=n.directionalLight,g=n.ambientLight;if(!p||!g)return;const x=[],S=La(t,t.longestCutoffRange);S.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");const C=Ns(n,p,g),L=new Ln(u.gl.LEQUAL,Ln.ReadOnly,t.depthRangeFor3D);for(const R of this._groundShadowTiles){const z=R.toUnwrapped(),N=t.isTileAffectedByFog(R),V=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:N});this.setupShadows(z,V),t.uploadCommonUniforms(u,V,z,null,S);const J={u_matrix:t.transform.calculateProjMatrix(z),u_ground_shadow_factor:C};V.draw(t,u.gl.TRIANGLES,L,ar.disabled,cr.multiply,Qn.disabled,J,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?cr.unblended:cr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,u=n.calculatePosMatrix(t,n.worldSize);return s.ab.mat4.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return s.ab.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,u,p=0){if(!this.enabled)return;const g=this.painter.transform,x=this.painter.context,S=x.gl,C=this._uniformValues,L=new Float64Array(16),R=g.calculatePosMatrix(t,g.worldSize);for(let z=0;z<this._cascades.length;z++)s.ab.mat4.multiply(L,this._cascades[z].matrix,R),C[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),x.activeTexture.set(S.TEXTURE0+Eo.ShadowMap0+z),this._cascades[z].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const z=s.cc(t.canonical),N=2/g.tileSize*s.ag/_o.shadowMapResolution,V=N*this._cascades[0].boundingSphereRadius,J=N*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-g.zoom+Math.floor(g.zoom)));C.u_shadow_normal_offset=[z,V*X,J*X],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(x,C)}setupShadowsFromMatrix(t,n,u=!1){if(!this.enabled)return;const p=this.painter.context,g=p.gl,x=this._uniformValues,S=new Float64Array(16);for(let C=0;C<_o.cascadeCount;C++)s.ab.mat4.multiply(S,this._cascades[C].matrix,t),x[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),p.activeTexture.set(g.TEXTURE0+Eo.ShadowMap0+C),this._cascades[C].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);if(this.useNormalOffset=u,u){const C=_o.normalOffset;x.u_shadow_normal_offset=[1,C,C],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(p,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,u,p){if(p[2]>=0)return{};const g=function(C,L,R){const z=R/(1<<C.canonical.z);return new s.cd([C.canonical.x*z+C.wrap*R,C.canonical.y*z+C.wrap*R,0],[(C.canonical.x+1)*z+C.wrap*R,(C.canonical.y+1)*z+C.wrap*R,L])}(t,n,u).getCorners(),x=n/-p[2];p[0]<0?(s.ab.vec3.add(g[0],g[0],[p[0]*x,0,0]),s.ab.vec3.add(g[3],g[3],[p[0]*x,0,0])):p[0]>0&&(s.ab.vec3.add(g[1],g[1],[p[0]*x,0,0]),s.ab.vec3.add(g[2],g[2],[p[0]*x,0,0])),p[1]<0?(s.ab.vec3.add(g[0],g[0],[0,p[1]*x,0]),s.ab.vec3.add(g[1],g[1],[0,p[1]*x,0])):p[1]>0&&(s.ab.vec3.add(g[2],g[2],[0,p[1]*x,0]),s.ab.vec3.add(g[3],g[3],[0,p[1]*x,0]));const S={};return S.vertices=g,S.planes=[xa(g[1],g[0],g[4]),xa(g[2],g[1],g[5]),xa(g[3],g[2],g[6]),xa(g[0],g[3],g[7])],S}addShadowReceiver(t,n,u){this._receivers.add(t,s.cd.fromTileIdAndHeight(t,n,u))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function xa(l,t,n){const u=s.ab.vec3.sub([],n,t),p=s.ab.vec3.sub([],l,t),g=s.ab.vec3.cross([],u,p),x=s.ab.vec3.length(g);return x===0?[0,0,1,0]:(s.ab.vec3.scale(g,g,1/x),[g[0],g[1],g[2],-s.ab.vec3.dot(g,t)])}function ua(l){const t=l.properties.get("direction"),n=s.cb(t.x,t.y,t.z);n[2]=s.aw(n[2],0,75);const u=s.ce([n[0],n[1],n[2]]);return s.ab.vec3.fromValues(u.x,u.y,u.z)}function Ns(l,t,n){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),g=t.properties.get("intensity"),x=t.properties.get("direction"),S=[x.x,x.y,x.z],C=n.properties.get("color-use-theme")==="none",L=n.properties.get("color"),R=n.properties.get("intensity"),z=Math.max(s.ab.vec3.dot([0,0,1],S),0),N=[0,0,0];s.ab.vec3.scale(N,L.toRenderColor(C?null:l.getLut(t.scope)).toArray01Linear().slice(0,3),R);const V=[0,0,0];return s.ab.vec3.scale(V,p.toRenderColor(u?null:l.getLut(n.scope)).toArray01Linear().slice(0,3),z*g),s.cf([N[0]>0?N[0]/(N[0]+V[0]):0,N[1]>0?N[1]/(N[1]+V[1]):0,N[2]>0?N[2]/(N[2]+V[2]):0])}function wa(l,t,n,u,p,g){const x=l.zoom,S=l.scale,C=l.worldSize,L=1/C,R=l.aspect,z=Math.sqrt(1+R*R)*Math.tan(.5*l.fovX),N=z*z,V=u-n,J=u+n;let X,ie;N>V/J?(X=u,ie=u*z):(X=.5*J*(1+N),ie=.5*Math.sqrt(V*V+2*(u*u+n*n)*N+J*J*N*N));const te=l.projection.pixelsPerMeter(l.center.lat,C),le=l._camera.getCameraToWorldMercator(),we=[0,0,-X*L];s.ab.vec3.transformMat4(we,we,le);let ve=ie*L;const ze=l._edgeInsets;if(!(ze.left===0&&ze.top===0&&ze.right===0&&ze.bottom===0||ze.left===ze.right&&ze.top===ze.bottom)){const fn=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?te:1),Ri=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,n,u);Ri[8]=2*-l.centerOffset.x/l.width,Ri[9]=2*l.centerOffset.y/l.height;const di=new Float64Array(16);s.ab.mat4.mul(di,Ri,fn);const $i=new Float64Array(16);s.ab.mat4.invert($i,di);const dn=s.bR.fromInvProjectionMatrix($i,C,x,!0);for(const Cn of dn.points){const zn=((Ae=Cn)[0]/=S,Ae[1]/=S,Ae[2]=s.bH(Ae[2],l._center.lat),Ae);ve=Math.max(ve,s.ab.vec3.len(s.ab.vec3.subtract([],we,zn)))}}var Ae;ve*=p/(p-1);const Le=Math.acos(t[2]),Me=Math.atan2(-t[0],-t[1]),He=new Ro;He.position=we,He.setPitchBearing(Le,Me);const tt=He.getWorldToCamera(C,te),Ft=ve*C,Mt=Math.min(l._mercatorZfromZoom(17)*C*-2,-2*Ft),ai=He.getCameraToClipOrthographic(-Ft,Ft,-Ft,Ft,Mt,(Ft+g*te)/t[2]),ei=new Float64Array(16);s.ab.mat4.multiply(ei,ai,tt);const yt=s.ab.vec3.fromValues(Math.floor(1e6*we[0])/1e6*C,Math.floor(1e6*we[1])/1e6*C,0),Ut=.5*p,Ui=[0,0,0];s.ab.vec3.transformMat4(Ui,yt,ei),s.ab.vec3.scale(Ui,Ui,Ut);const _t=[Math.floor(Ui[0]),Math.floor(Ui[1]),Math.floor(Ui[2])],_i=[0,0,0];s.ab.vec3.sub(_i,Ui,_t),s.ab.vec3.scale(_i,_i,-1/Ut);const Gt=new Float64Array(16);return s.ab.mat4.identity(Gt),s.ab.mat4.translate(Gt,Gt,_i),s.ab.mat4.multiply(ei,Gt,ei),[ei,Ft]}class Il extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,n){return s.aM(this.requestManager.transformRequest(n,s.R.Model).url).then(u=>{if(!u)return;const p=s.aN(u),g=new s.aO(t,void 0,void 0,p);return g.computeBoundsAndApplyParent(),g}).catch(u=>{if(u&&u.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${t} from ${n}: ${u.message}`)))})}load(t,n,u={keepNumReferences:!1}){this.models[n]||(this.models[n]={});const p=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+p.length;const g=[];for(const x of p)g.push(this.loadModel(x,t[x]));Promise.allSettled(g).then(x=>{for(let S=0;S<x.length;S++){const{status:C,value:L}=x[S];if(C==="fulfilled"&&L){const R=this.models[n][p[S]];this.models[n][p[S]]={model:L,numReferences:u.keepNumReferences&&R?R.numReferences:1}}}this.numModelsLoading[n]-=p.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(x=>{this.fire(new s.y(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}addModel(t,n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={}),this.hasModel(t,u)&&this.models[u][t].numReferences++,this.modelUris[u][t]=this.requestManager.normalizeModelURL(n),this.load({[t]:this.modelUris[u][t]},u)}addModels(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u=this.modelUris[n];for(const p in t)this.models[n][p]={},u[p]=this.requestManager.normalizeModelURL(t[p]);this.load(u,n,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u={};for(const p of t)this.hasModel(p,n)?this.models[n][p].numReferences++:(this.modelUris[n][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[n][p]);this.load(u,n)}removeModel(t,n){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0)){const u=this.models[n][t].model;delete this.models[n][t],delete this.modelUris[n][t],u.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const u in this.models[n])this.models[n][u].model&&this.models[n][u].model.upload(t.context)}}const Ml=new s.a5({data:new s.a6(s.a3.colorTheme.data)}),oa={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function ea(l){return l=l||{},Object.assign(l,oa)}class v extends s.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},s.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(x,S){const[C,L]=x,{center:R,radius:z}=S,[N,V]=R,J=Math.abs(C-N);return Math.sqrt(lh(J>180?360-J:J,2)+lh(L-V,2))<=z}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.z("floorplangone")));const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=new s.P(this._map.transform.width/2,this._map.transform.height/2),p=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(t?p:u,n);g.length>0&&(this._selectedFloorplan&&g[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=g[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(g){const[[x,S],[C,L]]=g,R=(C-x+360)%360,z=R>180?360-R:R;return{center:[(x+z/2+360)%360,(S+L)/2],radius:Math.sqrt(lh(z,2)+lh(L-S,2))/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const n=this._floorplanStates[this._indoorData.id].selectedBuilding,u=this._floorplanStates[this._indoorData.id].selectedLevel;let p;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const g of this._indoorData.levels)g.id===this._selectedLevel.id&&(p=g.id);if(this.fire(new s.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:p})),n){const g=this._indoorData.buildings.find(x=>x.id===n);this._buildingSelected(g,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(u){const g=this._indoorData.levels.find(x=>x.id===u);this._updateLevels(g,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,n){n&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new s.z("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const n=this._indoorData.levels.find(u=>u.id===t);this._updateLevels(n,!0)}this.fire(new s.z("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,n){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(n&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function u(L){const R=L.indexOf("/floor/");if(R===-1)return L;const z=R+7,N=L.indexOf("/",z);return N===-1?L.slice(z):L.slice(z,N)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const p=[],g={},x={},S={},C={};for(const L of this._indoorData.levels)if(p.push(L.id),g[L.id]=L.height,x[L.id]=L.base,t){if(this.mergeFloors){const R=u(t.id),z=u(L.id);S[L.id]=z===R?"true":"false"}else S[L.id]=L.id===t.id?"true":"false";C[L.id]=L.base<t.base?"true":"false"}else C[L.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",C]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),n&&t.extent)){const L=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),R=this._map.getZoom(),z=L.zoom?Math.abs(R-L.zoom):0;this._map.fitBounds(t.extent,z>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:R})}}selectFloorplan(t){const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(u,n);if(p.length>0){for(const g of p)if(JSON.parse(g.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=g,this._floorplanSelected(!0);break}}}selectBuilding(t){const n=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(n,!0)}selectLevel(t){this._levelSelected(t)}}function c(l){if(!l.metadata||!l.metadata.content_area)return;const t=s.q.devicePixelRatio,{left:n,top:u,width:p,height:g}=l.metadata.content_area,x=n*t,S=u*t;return[x,S,x+p*t,S+g*t]}function f(l){if(l)return l.map(([t,n])=>[t*s.q.devicePixelRatio,n*s.q.devicePixelRatio])}const y=(l,t)=>ds(l,t&&t.filter(n=>n.identifier!=="source.canvas")),P=s.ay(yn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),F=s.ay(yn,["setCenter","setZoom","setBearing","setPitch"]),Z=new Set(["background","sky","slot","custom"]),re={version:8,layers:[],sources:{}},Te={duration:300,delay:0};class Xe extends s.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=s.l({},Te),this._buildingIndex=new Bt(this),this.crossTileSymbolIndex=new Ms,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new cs,this.dispatcher=n.dispatcher?n.dispatcher:new s.D(s.ci(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new vs(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new s.cj(t._requestManager,n.localFontFamily?s.ck.all:n.localIdeographFontFamily?s.ck.ideographs:s.ck.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new Il(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",s.cl());const u=this;this._rtlTextPluginCallback=Xe.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,x)=>{if(s.cm(g),x&&x.every(S=>S))for(const S in u._sourceCaches){const C=u._sourceCaches[S],L=C.getSource().type;L!=="vector"&&L!=="geojson"||C.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.getOwnSource(p.sourceId);if(g&&g.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===g.id&&this._validateLayer(S)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.f(t))return t;const n=s.cn(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch(u){return n}return n}return`json://${s.co(JSON.stringify(t))}`}_diffStyle(t,n,u){this.globalId=this._getGlobalId(t);const p=(g,x)=>{try{x(null,this.setState(g,u))}catch(S){x(S,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(g,s.R.Style);s.n(x,(S,C)=>{S?this.fire(new s.y(S)):C&&p(C,n)})}else typeof t=="object"&&p(t,n)}loadURL(t,n={}){this.fire(new s.z("dataloading",{dataType:"style"}));const u=typeof n.validate=="boolean"?n.validate:!s.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const g=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.n(g,(x,S)=>{if(this._request=null,x)this.fire(new s.y(x));else if(S)return this.importsCache.set(t,S),this._load(S,u)})}loadJSON(t,n={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.q.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(re,!1)}_loadImports(t,n,u){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const g of t){const x=this._createFragmentStyle(g),S=new Promise(R=>{x.once("style.import.load",R),x.once("error",R)}).then(()=>this.mergeAll());if(p.push(S),this.resolvedImports.has(g.url)){x.loadEmpty();continue}const C=g.data||this.importsCache.get(g.url);C?(x.loadJSON(C,{validate:n}),this._isInternalStyle(C)&&(x.globalId=null)):g.url?x.loadURL(g.url,{validate:n}):x.loadEmpty();const L={style:x,id:g.id,config:g.config};if(u){const R=this.fragments.findIndex(({id:z})=>z===u);this.fragments=this.fragments.slice(0,R).concat(L).concat(this.fragments.slice(R))}else this.fragments.push(L)}return Promise.allSettled(p)}getImportGlobalIds(t=this,n=new Set){for(const u of t.fragments)u.style.globalId&&n.add(u.style.globalId),this.getImportGlobalIds(u.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?s.aC(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[n];(t.config||p)&&(u=s.l({},t.config,p));const g=new Xe(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){const u=t.indoor?ea(t.schema):t.schema;if(this._isInternalStyle(t)){const x=s.l({},re,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(x,n)}if(this.updateConfig(this._config,u),n&&y(this,pe(t)))return;this._loaded=!0,this.stylesheet=s.cp(t);const p=()=>{for(const L in t.sources)this.addSource(L,t.sources[L],{validate:!1,isInitialLoad:!0});t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const x=Pn(this.stylesheet.layers);if(this._order=x.map(L=>L.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new q(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new q(this.stylesheet.light)),this._layers={};for(const L of x){const R=s.cu(L,this.scope,this._styleColorTheme.lut,this.options);R.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid),R.setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R;const z=this.getOwnLayerSourceCache(R),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&R.canCastShadows()&&N&&(z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const C=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new s.z(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const x=this._evaluateColorThemeData(g);this._loadColorTheme(x).then(()=>{p()}).catch(S=>{s.w(`Couldn't load color theme from the stylesheet: ${S}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,u,p,g,x,S,C,L,R;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(N=>{if(N.stylesheet){if(N.light!=null&&(t=N.light),N.stylesheet.lights)for(const V of N.stylesheet.lights)V.type==="ambient"&&N.ambientLight!=null&&(n=N.ambientLight),V.type==="directional"&&N.directionalLight!=null&&(u=N.directionalLight);p=this._prioritizeTerrain(p,N.terrain,N.stylesheet.terrain),N.stylesheet.fog&&N.fog!=null&&(g=N.fog),N.stylesheet.snow&&N.snow!=null&&(x=N.snow),N.stylesheet.rain&&N.rain!=null&&(S=N.rain),N.stylesheet.camera!=null&&(R=N.stylesheet.camera),N.stylesheet.projection!=null&&(C=N.stylesheet.projection),N.stylesheet.transition!=null&&(L=N.stylesheet.transition),z[N.scope]=N._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=u,this.fog=g,this.snow=x,this.rain=S,this._styleColorThemeForScope=z,p===null?delete this.terrain:this.terrain=p,this.camera=R||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=s.l({},Te,L),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=u=>{for(const p of u.fragments)n(p.style);t(u)};n(this)}_prioritizeTerrain(t,n,u){const p=t&&t.drapeRenderMode===0;return u===null?n&&n.drapeRenderMode===0?n:p?t:null:n!=null&&(!t||p||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},u={};this.forEachFragmentStyle(p=>{for(const g in p._sourceCaches){const x=s.aC(g,p.scope);t[x]=p._sourceCaches[g]}for(const g in p._otherSourceCaches){const x=s.aC(g,p.scope);n[x]=p._otherSourceCaches[g]}for(const g in p._symbolSourceCaches){const x=s.aC(g,p.scope);u[x]=p._symbolSourceCaches[g]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},n=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(const x of g._order){const S=g._layers[x];if(S.type==="slot"){const C=s.cq(x);if(t[C])continue;t[C]=[]}S.slot&&t[S.slot]?t[S.slot].push(S):n.push(S)}}),this._mergedOrder=[];const p=(g=[])=>{for(const x of g)if(x.type==="slot"){const S=s.cq(x.id);t[S]&&p(t[S]),this._mergedSlots.push(S)}else{const S=s.aC(x.id,x.scope);this._mergedOrder.push(S),u[S]=x,x.is3D()&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};p(n),this._mergedOrder.sort((g,x)=>{const S=u[g],C=u[x];return S.hasInitialOcclusionOpacityProperties?C.is3D()?1:0:S.is3D()&&C.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=s.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,u,p){const g=s.l({},u);for(const S of Object.keys(s.a3.colorTheme))g[S]===void 0&&(g[S]=s.a3.colorTheme[S].default);const x=new s.a4(Ml,n,new Map(p));return x.setTransitionOrValue(g,p),x.untransitioned().possiblyEvaluate(new s.a8(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let x=t;x.startsWith(g)||(x=g+x);const S="mapbox-reserved-lut",C=new Image;C.src=x,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void u();this._styleColorTheme.lutLoading=!1;const{width:L,height:R,data:z}=s.q.getImageData(C);if(R>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==R*R)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new s.r({width:L,height:R},z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const N=this.imageManager.getImage(S,this.scope);N?(this._styleColorTheme.lut={image:N.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,u,p){let g,x,S;const C=s.q.devicePixelRatio>1?"@2x":"";let L=s.n(u.transformRequest(u.normalizeSpriteURL(n,C,".json"),s.R.SpriteJSON),(N,V)=>{L=null,S||(S=N,g=V,z())}),R=s.o(u.transformRequest(u.normalizeSpriteURL(n,C,".png"),s.R.SpriteImage),(N,V)=>{R=null,S||(S=N,x=V,z())});function z(){if(S)p(S);else if(g&&x){const N=s.q.getImageData(x),V={};for(const J in g){const{width:X,height:ie,x:te,y:le,sdf:we,pixelRatio:ve,stretchX:ze,stretchY:Ae,content:Le}=g[J],Me=new s.r({width:X,height:ie});s.r.copy(N,Me,{x:te,y:le},{x:0,y:0},{width:X,height:ie},null),V[J]={data:Me,pixelRatio:ve,sdf:we,stretchX:ze,stretchY:Ae,content:Le,usvg:!1}}p(null,V)}}return{cancel(){L&&(L.cancel(),L=null),R&&(R.cancel(),R=null)}}}(t,this.map._requestManager,(n,u)=>{if(this._spriteRequest=null,n)this.fire(new s.y(n));else if(u)for(const p in u)this.imageManager.addImage(p,this.scope,u[p]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}_loadIconset(t){if(!s.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const n=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(g,x)=>{if(this._spriteRequest=null,g)n?this._loadSprite(t):this.fire(new s.y(g));else if(x)for(const S in x)this.imageManager.addImage(S,this.scope,x[S]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bi((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),s.R.Iconset),(g,x)=>{if(g)return void p(g);const S={},C=s.cg(new s.bh(x));for(const L of C.icons){const R={version:1,pixelRatio:s.q.devicePixelRatio,content:c(L),stretchX:L.metadata?f(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?f(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};S[L.name]=R}p(null,S)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const u=t.sourceLayer;u&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.y(new Error(`Source layer "${u}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const u=this.fragments[n];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const u=this._sourceCaches[n].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const n=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&n.push(p.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new s.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new s.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const g=t.getProgramIds();if(g)for(const x of g){const S=t.getDefaultProgramParams(x,n.zoom,this._styleColorTheme.lut);S&&(u.style=this,this.fog&&(u._fogVisible=!0,S.overrideFog=!0,u.getOrCreateProgram(x,S)),u._fogVisible=!1,S.overrideFog=!1,u.getOrCreateProgram(x,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,u.getOrCreateProgram(x,S)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const x=this._changes.getLayerUpdatesByScope();for(const S in x){const{updatedIds:C,removedIds:L}=x[S];(C||L)&&(this._updateWorkerLayers(S,C,L),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const x in this._mergedSourceCaches){const S=this._mergedSourceCaches[x];g[x]=S.used,S.used=!1,S.tileCoverLift=0}for(const x of this._mergedOrder){const S=this._mergedLayers[x];if(S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)){const C=this.getLayerSourceCache(S);C&&(C.used=!0,C.tileCoverLift=Math.max(C.tileCoverLift,S.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(S,t)}):this.precompilePrograms(S,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();for(const x in g){const S=this._mergedSourceCaches[x];g[x]!==S.used&&S.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new s.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,n,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:n?p._serializeLayers(n):[],scope:t,removedIds:u||[],options:p.options})}setState(t,n){if(this._checkLoaded(),y(this,pe(t)))return!1;(t=s.cp(t)).layers=Pn(t.layers);const u=function(x,S){if(!x)return[{command:yn.setStyle,args:[S]}];let C=[];try{if(!s.bn(x.version,S.version))return[{command:yn.setStyle,args:[S]}];if(s.bn(x.center,S.center)||C.push({command:yn.setCenter,args:[S.center]}),s.bn(x.zoom,S.zoom)||C.push({command:yn.setZoom,args:[S.zoom]}),s.bn(x.bearing,S.bearing)||C.push({command:yn.setBearing,args:[S.bearing]}),s.bn(x.pitch,S.pitch)||C.push({command:yn.setPitch,args:[S.pitch]}),s.bn(x.sprite,S.sprite)||C.push({command:yn.setSprite,args:[S.sprite]}),s.bn(x.glyphs,S.glyphs)||C.push({command:yn.setGlyphs,args:[S.glyphs]}),s.bn(x.imports,S.imports)||function(V=[],J=[],X){J=J||[];const ie=(V=V||[]).map(jt),te=J.map(jt),le=V.reduce(Ti,{}),we=J.reduce(Ti,{}),ve=ie.slice();let ze,Ae,Le,Me;for(ze=0,Ae=0;ze<ie.length;ze++)Le=ie[ze],we.hasOwnProperty(Le)?Ae++:(X.push({command:yn.removeImport,args:[Le]}),ve.splice(ve.indexOf(Le,Ae),1));for(ze=0,Ae=0;ze<te.length;ze++)Le=te[te.length-1-ze],ve[ve.length-1-ze]!==Le&&(le.hasOwnProperty(Le)?(X.push({command:yn.removeImport,args:[Le]}),ve.splice(ve.lastIndexOf(Le,ve.length-Ae),1)):Ae++,Me=ve[ve.length-ze],X.push({command:yn.addImport,args:[we[Le],Me]}),ve.splice(ve.length-ze,0,Le));for(const He of J){const tt=le[He.id];tt&&!s.bn(tt,He)&&X.push({command:yn.updateImport,args:[He.id,He]})}}(x.imports,S.imports,C),s.bn(x.transition,S.transition)||C.push({command:yn.setTransition,args:[S.transition]}),s.bn(x.light,S.light)||C.push({command:yn.setLight,args:[S.light]}),s.bn(x.fog,S.fog)||C.push({command:yn.setFog,args:[S.fog]}),s.bn(x.snow,S.snow)||C.push({command:yn.setSnow,args:[S.snow]}),s.bn(x.rain,S.rain)||C.push({command:yn.setRain,args:[S.rain]}),s.bn(x.projection,S.projection)||C.push({command:yn.setProjection,args:[S.projection]}),s.bn(x.lights,S.lights)||C.push({command:yn.setLights,args:[S.lights]}),s.bn(x.camera,S.camera)||C.push({command:yn.setCamera,args:[S.camera]}),!s.bn(x["color-theme"],S["color-theme"]))return[{command:yn.setStyle,args:[S]}];const L={},R=[];(function(V,J,X,ie){let te;for(te in J=J||{},V=V||{})V.hasOwnProperty(te)&&(J.hasOwnProperty(te)||Er(te,X,ie));for(te in J){if(!J.hasOwnProperty(te))continue;const le=J[te];V.hasOwnProperty(te)?s.bn(V[te],le)||(V[te].type==="geojson"&&le.type==="geojson"&&mi(V,J,te)?X.push({command:yn.setGeoJSONSourceData,args:[te,le.data]}):ft(te,J,X,ie)):pr(te,J,X)}})(x.sources,S.sources,R,L);const z=[];x.layers&&x.layers.forEach(V=>{V.source&&L[V.source]?C.push({command:yn.removeLayer,args:[V.id]}):z.push(V)});let N=x.terrain;N&&L[N.source]&&(C.push({command:yn.setTerrain,args:[void 0]}),N=void 0),C=C.concat(R),s.bn(N,S.terrain)||C.push({command:yn.setTerrain,args:[S.terrain]}),function(V,J,X){J=J||[];const ie=(V=V||[]).map(jt),te=J.map(jt),le=V.reduce(Ti,{}),we=J.reduce(Ti,{}),ve=ie.slice(),ze=Object.create(null);let Ae,Le,Me,He,tt,Ft,Mt;for(Ae=0,Le=0;Ae<ie.length;Ae++)Me=ie[Ae],we.hasOwnProperty(Me)?Le++:(X.push({command:yn.removeLayer,args:[Me]}),ve.splice(ve.indexOf(Me,Le),1));for(Ae=0,Le=0;Ae<te.length;Ae++)Me=te[te.length-1-Ae],ve[ve.length-1-Ae]!==Me&&(le.hasOwnProperty(Me)?(X.push({command:yn.removeLayer,args:[Me]}),ve.splice(ve.lastIndexOf(Me,ve.length-Le),1)):Le++,Ft=ve[ve.length-Ae],X.push({command:yn.addLayer,args:[we[Me],Ft]}),ve.splice(ve.length-Ae,0,Me),ze[Me]=!0);for(Ae=0;Ae<te.length;Ae++)if(Me=te[Ae],He=le[Me],tt=we[Me],!ze[Me]&&!s.bn(He,tt))if(s.bn(He.source,tt.source)&&s.bn(He["source-layer"],tt["source-layer"])&&s.bn(He.type,tt.type)){for(Mt in nt(He.layout,tt.layout,X,Me,null,yn.setLayoutProperty),nt(He.paint,tt.paint,X,Me,null,yn.setPaintProperty),s.bn(He.slot,tt.slot)||X.push({command:yn.setSlot,args:[Me,tt.slot]}),s.bn(He.filter,tt.filter)||X.push({command:yn.setFilter,args:[Me,tt.filter]}),s.bn(He.minzoom,tt.minzoom)&&s.bn(He.maxzoom,tt.maxzoom)||X.push({command:yn.setLayerZoomRange,args:[Me,tt.minzoom,tt.maxzoom]}),He)He.hasOwnProperty(Mt)&&Mt!=="layout"&&Mt!=="paint"&&Mt!=="filter"&&Mt!=="metadata"&&Mt!=="minzoom"&&Mt!=="maxzoom"&&Mt!=="slot"&&(Mt.indexOf("paint.")===0?nt(He[Mt],tt[Mt],X,Me,Mt.slice(6),yn.setPaintProperty):s.bn(He[Mt],tt[Mt])||X.push({command:yn.setLayerProperty,args:[Me,Mt,tt[Mt]]}));for(Mt in tt)tt.hasOwnProperty(Mt)&&!He.hasOwnProperty(Mt)&&Mt!=="layout"&&Mt!=="paint"&&Mt!=="filter"&&Mt!=="metadata"&&Mt!=="minzoom"&&Mt!=="maxzoom"&&Mt!=="slot"&&(Mt.indexOf("paint.")===0?nt(He[Mt],tt[Mt],X,Me,Mt.slice(6),yn.setPaintProperty):s.bn(He[Mt],tt[Mt])||X.push({command:yn.setLayerProperty,args:[Me,Mt,tt[Mt]]}))}else X.push({command:yn.removeLayer,args:[Me]}),Ft=ve[ve.lastIndexOf(Me)+1],X.push({command:yn.addLayer,args:[tt,Ft]})}(z,S.layers,C)}catch(L){console.warn("Unable to compute style diff:",L),C=[{command:yn.setStyle,args:[S]}]}return C}(this.serialize(),t).filter(x=>!(x.command in F));if(u.length===0)return!1;const p=u.filter(x=>!(x.command in P));if(p.length>0)throw new Error(`Unimplemented: ${p.map(x=>x.command).join(", ")}.`);const g=[];return u.forEach(x=>{g.push(this[x.command].apply(this,x.args))}),n&&Promise.all(g).then(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,n){return this.getImage(t)?this.fire(new s.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,n),this._afterImageUpdated(t),this)}updateImage(t,n,u=!1){this.imageManager.updateImage(t,this.scope,n),u&&this._afterImageUpdated(t)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new s.y(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,u={}){return this._checkLoaded(),this._validate(Vs,`models.${t}`,n,null,u)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(Re,`sources.${t}`,n,null,u))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const p=Qs(t,n,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const g=x=>{const S=(x?"symbol:":"other:")+p.id,C=s.aC(S,this.scope),L=this._sourceCaches[S]=new D(C,p,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=L,L.onAdd(this.map)};g(!1),n.type!=="vector"&&n.type!=="geojson"||g(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const u=this.getOwnSourceCaches(t);for(const p of u){const g=s.cq(p.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(p.id),p.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const u=this.getOwnSourceCache(n);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const u=t[n]._tiles;for(const p in u){const g=u[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const p of t){if(this._validate(ui,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const g=this.ambientLight;g.set(p),g.updateTransitions(n)}else this.ambientLight=new xt(p,it||(it=new s.a5({color:new s.a6(s.a3.properties_light_ambient.color),"color-use-theme":new s.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a6(s.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const g=this.directionalLight;g.set(p),g.updateTransitions(n)}else this.directionalLight=new xt(p,Ne||(Ne=new s.a5({direction:new s.ak(s.a3.properties_light_directional.direction),color:new s.a6(s.a3.properties_light_directional.color),"color-use-theme":new s.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a6(s.a3.properties_light_directional.intensity),"cast-shadows":new s.a6(s.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a6(s.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a6(s.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=new s.a8(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const u=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),p=t.properties.get("color").toRenderColor(null).toArray01(),g=t.properties.get("intensity"),x=t.properties.get("direction"),S=1-s.cb(x.x,x.y,x.z)[2]/90,C=u(p)*g*S,L=n.properties.get("color").toRenderColor(null).toArray01(),R=n.properties.get("intensity"),z=u(L)*R;return Number(((C+z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(s.cr(t)){const n=s.cs(t),u=this.fragments.find(({id:g})=>g===n);if(!u)throw new Error(`Style import '${t}' not found`);const p=s.cq(t);return u.style.getFragmentStyle(p)}{const n=this.fragments.find(({id:u})=>u===t);return n?n.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},u=(p,g="")=>`${p}::${g}`;this._featuresetSelectors={};for(const p in t){const g=this._featuresetSelectors[p]=[];for(const x of t[p].selectors){if(x.featureNamespace){const C=this.getOwnLayer(x.layer);if(!C){s.w(`Layer is undefined for selector: ${x.layer}`);continue}const L=u(C.source,C.sourceLayer);if(L in n&&n[L]!==x.featureNamespace){s.w(`"featureNamespace ${x.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}n[L]=x.featureNamespace}let S;if(x.properties)for(const C in x.properties){const L=s.U(x.properties[C]);L.result==="success"&&(S=S||{},S[C]=L.value)}g.push({layerId:x.layer,namespace:x.featureNamespace,properties:S,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const u=[];for(const p in n.stylesheet.featuresets)u.push({featuresetId:p,importId:n.scope?n.scope:void 0});return u}getFeaturesetLayers(t,n){const u=this.getFragmentStyle(n),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new s.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const x of p[t].selectors){const S=u.getOwnLayer(x.layer);S&&g.push(S)}return g}getConfigProperty(t,n){const u=this.getFragmentStyle(t);if(!u)return null;const p=s.aC(n,u.scope),g=u.options.get(p),x=g?g.value||g.default:null;return x?x.serialize():null}setConfigProperty(t,n,u){const p=this.getFragmentStyle(t);if(!p)return;const g=p.stylesheet.indoor?ea(p.stylesheet.schema):p.stylesheet.schema;if(!g||!g[n])return;const x=s.U(u);if(x.result!=="success")return void y(this,x.value);const S=x.value.expression,C=s.aC(n,p.scope),L=p.options.get(C);if(!L)return;let R;const{minValue:z,maxValue:N,stepValue:V,type:J,values:X}=g[n],ie=s.U(g[n].default);ie.result==="success"&&(R=ie.value.expression),R?(this.options.set(C,Object.assign({},L,{value:S,default:R,minValue:z,maxValue:N,stepValue:V,type:J,values:X})),this.updateConfigDependencies(n)):this.fire(new s.y(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const u=n.stylesheet.schema;if(!u)return null;const p={};for(const g in u){const x=s.aC(g,n.scope),S=n.options.get(x),C=S?S.value||S.default:null;p[g]=C?C.serialize():null}return p}setConfig(t,n){const u=this.getFragmentStyle(t);u&&(u.updateConfig(n,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=n,u.updateConfig(u._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const u in n){let p,g;const x=s.U(n[u].default);if(x.result==="success"&&(p=x.value.expression),t&&t[u]!==void 0){const N=s.U(t[u]);N.result==="success"&&(g=N.value.expression)}const{minValue:S,maxValue:C,stepValue:L,type:R,values:z}=n[u];if(p){const N=s.aC(u,this.scope);this.options.set(N,{default:p,value:g,minValue:S,maxValue:C,stepValue:L,type:R,values:z})}else this.fire(new s.y(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const n of this._configDependentLayers){const u=this.getLayer(n);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const u=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(u){const p=n._evaluateColorThemeData(u);(!n._styleColorTheme.lut&&p!==""||n._styleColorTheme.lut&&p!==n._styleColorTheme.lut.data)&&n.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,n,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new s.y(new Error(`Layer with id "${p}" already exists on this map`)));let g;if(t.type==="custom"){if(y(this,s.ct(t)))return;g=s.cu(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=s.cp(t),t=s.l(t,{source:p})),this._validate(Un,`layers.${p}`,t,{arrayIndex:-1},u))return;g=s.cu(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}})}g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid);let x=this._order.length;if(n){const R=this._order.indexOf(n);if(R===-1)return void this.fire(new s.y(new Error(`Layer with id "${n}" does not exist on this map.`)));g.slot===this._layers[n].slot?x=R:s.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=g;const S=this.getOwnLayerSourceCache(g),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&g.canCastShadows()&&C&&(S.castsShadows=!0);const L=this._changes.getRemovedLayer(g);if(L&&g.source&&S&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const R=s.aC(g.source,g.scope);L.type!==g.type?this._changes.updateSourceCache(R,"clear"):(this._changes.updateSourceCache(R,"reload"),S.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===n)return;const p=this._order.indexOf(t);this._order.splice(p,1);let g=this._order.length;if(n){const x=this._order.indexOf(n);if(x===-1)return void this.fire(new s.y(new Error(`Layer with id "${n}" does not exist on this map.`)));u.slot===this._layers[n].slot?g=x:s.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const p=this.getOwnLayerSourceCache(n);if(p&&p.castsShadows){let g=!1;for(const x in this._layers)if(this._layers[x].source===n.source&&this._layers[x].canCastShadows()){g=!0;break}p.castsShadows=g}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===n&&p.maxzoom===u||(n!=null&&(p.minzoom=n),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==n&&(u.slot=n,this._updateLayer(u))}setFilter(t,n,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!s.bn(p.filter,n))return n==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Bn,`layers.${p.id}.filter`,n,{layerType:p.type},u)||(p.filter=s.cp(n),this._updateLayer(p)))}getFilter(t){const n=this._checkLayer(t);if(n)return s.cp(n.filter)}setLayoutProperty(t,n,u,p={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!s.bn(g.getLayoutProperty(n),u)){if(u!=null&&(!p||p.validate!==!1)&&y(g,hs.call(pe,{key:`layers.${t}.layout.${n}`,layerType:g.type,objectKey:n,value:u,styleSpec:s.a3,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(n,u),g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(t,n){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(n)}setPaintProperty(t,n,u,p={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||s.bn(g.getPaintProperty(n),u)||u!=null&&(!p||p.validate!==!1)&&y(g,Or.call(pe,{key:`layers.${t}.paint.${n}`,layerType:g.type,objectKey:n,value:u,styleSpec:s.a3})))return;const x=g.setPaintProperty(n,u);g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),x&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,n){const u=this._checkLayer(t);if(u)return u.getPaintProperty(n)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:L}=t.target,R=this.getFragmentStyle(L),z=R.getFeaturesetLayers(C);for(const{source:N,sourceLayer:V}of z)R.setFeatureState({id:t.id,source:N,sourceLayer:V},n)}else if("layerId"in t.target){const{layerId:C}=t.target,L=this.getLayer(C);this.setFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},n)}return}const u=t.source,p=t.sourceLayer,g=this._checkSource(u);if(!g)return;const x=g.type;if(x==="geojson"&&p)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!p)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(u);for(const C of S)C.setFeatureState(p,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:L}=t.target,R=this.getFragmentStyle(L),z=R.getFeaturesetLayers(C);for(const{source:N,sourceLayer:V}of z)R.removeFeatureState({id:t.id,source:N,sourceLayer:V},n)}else if("layerId"in t.target){const{layerId:C}=t.target,L=this.getLayer(C);this.removeFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},n)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const g=p.type,x=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!x)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(u);for(const C of S)C.removeFeatureState(x,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:x,importId:S}=t.target,C=this.getFragmentStyle(S),L=C.getFeaturesetLayers(x);for(const{source:R,sourceLayer:z}of L){const N=C.getFeatureState({id:t.id,source:R,sourceLayer:z});if(N&&!g)g=N;else if(!s.bn(g,N))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:x}=t.target,S=this.getLayer(x);g=this.getFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer})}return g}const n=t.source,u=t.sourceLayer,p=this._checkSource(n);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(u,t.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=s.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),u=s.aC(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=S=>this._mergedLayers[S].is3D(),u=this.order,p={},g=[];for(let S=u.length-1;S>=0;S--){const C=u[S];if(n(C)){p[C]=S;for(const L of t){const R=L[C];if(R)for(const z of R)g.push(z)}}}g.sort((S,C)=>C.intersectionZ-S.intersectionZ);const x=[];for(let S=u.length-1;S>=0;S--){const C=u[S];if(n(C))for(let L=g.length-1;L>=0;L--){const R=g[L].feature;if(R.layer&&p[R.layer.id]<S)break;x.push(R),g.pop()}else for(const L of t){const R=L[C];if(R)for(const z of R)x.push(z.feature)}}return x}queryRenderedFeatures(t,n,u){let p;n&&!Array.isArray(n)&&n.filter&&(this._validate(Bn,"queryRenderedFeatures.filter",n.filter,null,n),p=s.aZ(n.filter));const g={},x=R=>{if(Z.has(R.type))return;const z=this.getOwnLayerSourceCache(R),N=g[z.id]=g[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};R.is3D()&&(N.has3DLayers=!0),N.layers[R.fqid]=N.layers[R.fqid]||{styleLayer:R,targets:[]},N.layers[R.fqid].targets.push({filter:p})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const R of n.layers){const z=this._layers[R];if(!z)return this.fire(new s.y(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];x(z)}}else for(const R in this._layers)x(this._layers[R]);const S=this._queryRenderedFeatures(t,g,u),C=this._flattenAndSortRenderedFeatures(S),L=[];for(const R of C)s.cs(R.layer.id)===this.scope&&L.push(R);return L}queryRenderedFeatureset(t,n,u){let p;n&&!Array.isArray(n)&&n.filter&&(this._validate(Bn,"queryRenderedFeatures.filter",n.filter,null,n),p=s.aZ(n.filter));const g="mock",x=[];if(n&&n.target)x.push(Object.assign({},n,{targetId:g,filter:p}));else{const R=this.getFeaturesetDescriptors();for(const z of R)x.push({targetId:g,filter:p,target:z});for(const{style:z}of this.fragments){const N=z.getFeaturesetDescriptors();for(const V of N)x.push({targetId:g,filter:p,target:V})}}const S=this.queryRenderedTargets(t,x,u),C=[],L=new Set;for(const R of S)for(const z of R.variants[g])bs(z,R,L)||C.push(new s.cw(R,z));return C}queryRenderedTargets(t,n,u){const p={},g=(S,C,L,R)=>{const z=p[C.id]=p[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(z.layers[S.fqid]=z.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D()&&(z.has3DLayers=!0),!R)return L.uniqueFeatureID=!1,void z.layers[S.fqid].targets.push(L);z.layers[S.fqid].targets.push(Object.assign({},L,{namespace:R.namespace,properties:R.properties,uniqueFeatureID:R.uniqueFeatureID}))};for(const S of n)if("featuresetId"in S.target){const{featuresetId:C,importId:L}=S.target,R=this.getFragmentStyle(L);if(!R||!R._featuresetSelectors)continue;const z=R._featuresetSelectors[C];if(!z){this.fire(new s.y(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const N of z){const V=R.getOwnLayer(N.layerId);V&&!Z.has(V.type)&&g(V,R.getOwnLayerSourceCache(V),S,N)}}else if("layerId"in S.target){const{layerId:C}=S.target,L=this.getLayer(C);if(!L||Z.has(L.type))continue;g(L,this.getLayerSourceCache(L),S)}const x=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,n,u){const p=[],g=!!this.map._showQueryGeometry,x=Xt.createFromScreenPoints(t,u);for(const S in n){const C=to(x,n[S],this._availableImages,u,g);Object.keys(C).length&&p.push(C)}if(this.placement)for(const S in n){if(!n[S].sourceCache._onlySymbols)continue;const C=rs(x.screenGeometry,n[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(C).length&&p.push(C)}return p}querySourceFeatures(t,n){const u=n&&n.filter;u&&this._validate(Bn,"querySourceFeatures.filter",u,null,n);let p=[];const g=this.getOwnSourceCaches(t);for(const x of g)p=p.concat(ws(x,n));return p}addSourceType(t,n,u){return Xe.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(Xe.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,u={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const S in t)if(!s.bn(t[S],p[S])){g=!0;break}if(!g)return;const x=this._getTransitionParameters();this.light.setLight(t,n,u),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const S="terrain-dem-src";this.addSource(S,u.source),u=s.cp(u),u=s.l(u,{source:S})}const g=s.l({},u),x={};if(this.terrain&&p){g.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(x.style=S.serialize())}if(this._validate(Vt,"terrain",g,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&n!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,n),this.fire(new s.z("data",{dataType:"style"}))}else{const g=this.terrain,x=g.get();for(const S of Object.keys(s.a3.terrain))!u.hasOwnProperty(S)&&s.a3.terrain[S].default&&(u[S]=s.a3.terrain[S].default);for(const S in t)if(!s.bn(t[S],x[S])){g.set(t,this.options),this.stylesheet.terrain=t;const C=this._getTransitionParameters({duration:0});g.updateTransitions(C),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new fe(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createSnow(t){const n=this.snow=new ut(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createRain(t){const n=this.rain=new Et(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!s.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!s.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!s.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(n);this._loadColorTheme(u).then(()=>{this.fire(new s.z("colorthemeset")),t()}).catch(p=>{s.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,n){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=n,u._reloadColorTheme())}_getTransitionParameters(t){return{now:s.q.now(),transition:s.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):n.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const u=this.terrain=new ee(t,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,u,p,g={}){if(g&&g.validate===!1)return!1;const x=s.l({},this.serialize());return y(this,t.call(pe,s.l({key:n,style:x,value:u,styleSpec:s.a3},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const u of n)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const u of n)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let n;this.directionalLight&&(n=ua(this.directionalLight));for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,u,p,g,x,S=!1){let C=!1,L=!1;const R={},z={};for(const N of this._mergedOrder){const V=this._mergedLayers[N];if(V.type!=="symbol")continue;const J=s.aC(V.source,V.scope);let X=R[J];if(!X){const te=this.getLayerSourceCache(V);if(!te)continue;const le=te.getRenderableIds(!0).map(we=>te.getTileByID(we));z[J]=le.slice(),X=R[J]=le.sort((we,ve)=>ve.tileID.overscaledZ-we.tileID.overscaledZ||(we.tileID.isLessThan(ve.tileID)?-1:1))}const ie=this.crossTileSymbolIndex.addLayer(V,X,n.center.lng,n.projection);C=C||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new s.z("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),n.zoom))&&(this.pauseablePlacement=new yr(n,this._mergedOrder,S,u,p,g,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,R,z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),L=!0),C&&this.pauseablePlacement.placement.setStale()),L||C){this._buildingIndex.onNewFrame(n.zoom);for(let N=0;N<this._mergedOrder.length;N++){const V=this._mergedLayers[this._mergedOrder[N]];if(V.type!=="symbol")continue;const J=this.isLayerClipped(V);this.placement.updateLayerOpacities(V,R[s.aC(V.source,V.scope)],N,J?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:g})=>g===t.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:g})=>g===n);return p===-1&&this.fire(new s.y(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==u[p].url&&this.setImportUrl(t,n.url),s.bn(n.config,u[p].config)||this.setImportConfig(t,n.config,n.data.schema),s.bn(n.data,u[p].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const g=this.getImportIndex(n);if(g===-1)return this;const x=u[p],S=this.fragments[p];return u=u.filter(({id:C})=>C!==t),this.fragments=this.fragments.filter(({id:C})=>C!==t),this.stylesheet.imports=u.slice(0,g).concat(x).concat(u.slice(g)),this.fragments=this.fragments.slice(0,g).concat(S).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=n;const g=this.fragments[p];return g.style=this._createFragmentStyle(u[p]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:n?(this.fragments[u].style.setState(n),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,n,u){this._checkLoaded();const p=this.getImportIndex(t),g=this.stylesheet.imports||[];if(p===-1)return this;n?g[p].config=n:delete g[p].config;const x=this.fragments[p];u&&x.style.stylesheet&&(x.style.stylesheet.schema=u);const S=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=n,x.style.updateConfig(n,S),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(n.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return n===-1&&this.fire(new s.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[n];u&&t.push(u.getSource())}return t}getSource(t,n){const u=this.getSourceCache(t,n);return u&&u.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const u=s.aC(t,n);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const n=s.aC(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const u=t[n];u==="reload"?this.reloadSource(n):u==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const u of n){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getImages(t,n,u){this.imageManager.getImages(n.icons,n.scope,u),this._updateTilesForChangedImages();const p=g=>{g&&g.setDependencies(n.tileID.key,n.type,n.icons)};p(this._otherSourceCaches[n.source]),p(this._symbolSourceCaches[n.source])}rasterizeImages(t,n,u){this.imageManager.rasterizeImages(n,u)}getGlyphs(t,n,u){this.glyphManager.getGlyphs(n.stacks,n.scope,u)}getResource(t,n,u){return s.cy(n,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${t}'`))),!1):n.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(u||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xe.getSourceType=function(l){return zs[l]},Xe.setSourceType=function(l,t){zs[l]=t},Xe.registerForPluginStateChange=s.ch;var Yt=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Si=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,bn=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Jn="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",br=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Dr=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ts=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,os=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ds=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,mo=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,uo=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ta=[];ka(Yt,ta),ka(bn,ta),ka(Si,ta);const ga={"_prelude_fog.vertex.glsl":Dr,"_prelude_terrain.vertex.glsl":br,"_prelude_shadow.vertex.glsl":mo,"_prelude_fog.fragment.glsl":ts,"_prelude_shadow.fragment.glsl":uo,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":os,"_prelude_raster_particle.glsl":Ds},ja={};jr("",br),jr(ts,Dr),jr(uo,mo),jr(os,""),jr(Ds,"");const al=jr(Si,bn),Ya=Yt;var Ra={background:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:jr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:jr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:jr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:jr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:jr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:jr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:jr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:jr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:jr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:jr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:jr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:jr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:jr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:jr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:jr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jn),skyboxGradient:jr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jn),skyboxCapture:jr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:jr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:jr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:jr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:jr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:jr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:jr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ka(l,t){const n=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of n)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const g of p)t.includes(g)||t.push(g)}}function jr(l,t){const n=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(L=>{const R=L.split(" ");return R[R.length-1]}),p=[...new Set(p)]);const g={},x=[],S=[];if(l=l.replace(n,(L,R)=>(S.push(R),"")),(t=t.replace(n,(L,R)=>(x.push(R),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...ta];ka(l,C),ka(t,C);for(const L of[...x,...S])ga[L]||console.error(`Undefined include: ${L}`),ja[L]||(ja[L]=[],ka(ga[L],ja[L])),C=[...C,...ja[L]];return{fragmentSource:l=l.replace(u,(L,R,z,N,V)=>(g[V]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${z} ${N} ${V};
#else
uniform ${z} ${N} u_${V};
#endif
`:R==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${z} ${N} ${V} = u_${V};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${z} ${N} ${V};
#endif
`:R==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(L,R,z,N,V)=>{const J=N==="float"?"vec2":N,X=V.match(/color/)?"color":J;return R==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${z} ${N} a_${V};
#endif
`:g[V]?R==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${z} ${J} a_${V};
out ${z} ${N} ${V};
#else
uniform ${z} ${N} u_${V};
#endif
`:R==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${z} ${N} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${X}(a_${V}, u_${V}_t);
#else
    ${z} ${N} ${V} = u_${V};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${z} ${N} a_${V};
    out ${z} ${N} ${V};
#endif
`:R==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:R==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${z} ${J} a_${V};
#else
uniform ${z} ${N} u_${V};
#endif
`:R==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${z} ${N} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${J} a_${V};
#else
uniform ${z} ${N} u_${V};
#endif
`:R==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${z} ${N} ${V} = a_${V};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${N} ${V} = a_${V};
#else
    ${z} ${N} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${N} ${V} = unpack_mix_${X}(a_${V}, u_${V}_t);
#else
    ${z} ${N} ${V} = u_${V};
#endif
`}),staticAttributes:p,usedDefines:C,vertexIncludes:x,fragmentIncludes:S}}class ll{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,u,p,g,x,S,C){this.context=t;let L=this.boundPaintVertexBuffers.length!==p.length;for(let z=0;!L&&z<p.length;z++)this.boundPaintVertexBuffers[z]!==p[z]&&(L=!0);let R=this.boundDynamicVertexBuffers.length!==S.length;for(let z=0;!R&&z<S.length;z++)this.boundDynamicVertexBuffers[z]!==S[z]&&(R=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==u||L||R||this.boundIndexBuffer!==g||this.boundVertexOffset!==x)this.freshBind(n,u,p,g,x,S,C);else{t.bindVertexArrayOES.set(this.vao);for(const z of S)z&&(z.bind(),C&&z.instanceCount&&z.setVertexAttribDivisor(t.gl,n,C));g&&g.dynamicDraw&&g.bind()}}freshBind(t,n,u,p,g,x,S){const C=t.numAttributes,L=this.context,R=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=x,n.enableAttributes(R,t),n.bind(),n.setVertexAttribPointers(R,t,g);for(const z of u)z.enableAttributes(R,t),z.bind(),z.setVertexAttribPointers(R,t,g);for(const z of x)z&&(z.enableAttributes(R,t),z.bind(),z.setVertexAttribPointers(R,t,g),S&&z.instanceCount&&z.setVertexAttribDivisor(R,t,S));p&&p.bind(),L.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Oa(l,t){const n=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new s.aa(0,u/n).toLngLat().lat,new s.aa(0,(u+1)/n).toLngLat().lat]}function iu(l,t,n,u,p,g,x){const S=l.context,C=S.gl,L=n.hillshadeFBO;if(!L)return;l.prepareDrawTile();const R=l.isTileAffectedByFog(t),z=l.getOrCreateProgram("hillshade",{overrideFog:R});S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,L.colorAttachment.get());const N=((ie,te,le,we)=>{const ve=le.paint.get("hillshade-shadow-color"),ze=le.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=le.paint.get("hillshade-highlight-color"),Le=le.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Me=le.paint.get("hillshade-accent-color"),He=le.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",tt=le.paint.get("hillshade-emissive-strength");let Ft=s.ai(le.paint.get("hillshade-illumination-direction"));if(le.paint.get("hillshade-illumination-anchor")==="viewport")Ft-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const ai=ie.style.directionalLight.properties.get("direction"),ei=s.cb(ai.x,ai.y,ai.z);Ft=s.ai(ei[1])}const Mt=!ie.options.moving;return{u_matrix:we||ie.transform.calculateProjMatrix(te.tileID.toUnwrapped(),Mt),u_image:0,u_latrange:Oa(0,te.tileID),u_light:[le.paint.get("hillshade-exaggeration"),Ft],u_shadow:ve.toRenderColor(ze?null:le.lut),u_highlight:Ae.toRenderColor(Le?null:le.lut),u_emissive_strength:tt,u_accent:Me.toRenderColor(He?null:le.lut)}})(l,n,u,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(S,z,t.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:J,tileBoundsSegments:X}=l.getTileBoundsBuffers(n);z.draw(l,C.TRIANGLES,p,g,x,Qn.disabled,N,u.id,V,J,X)}function ul(l,t,n){if(!t.needsDEMTextureUpload)return;const u=l.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(n.stride);const g=n.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new s.T(u,g,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function vu(l,t,n){const u=l.context,p=u.gl;if(!t.dem)return;const g=t.dem;if(u.activeTexture.set(p.TEXTURE1),ul(l,t,g),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const x=g.dim;u.activeTexture.set(p.TEXTURE0);let S=t.hillshadeFBO;if(!S){const N=new s.T(u,{width:x,height:x,data:null},p.RGBA8);N.bind(p.LINEAR,p.CLAMP_TO_EDGE),S=t.hillshadeFBO=u.createFramebuffer(x,x,!0,"renderbuffer"),S.colorAttachment.set(N.texture)}u.bindFramebuffer.set(S.framebuffer),u.viewport.set([0,0,x,x]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:L,tileBoundsSegments:R}=l.getMercatorTileBoundsBuffers(),z=[];l.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),l.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(l,p.TRIANGLES,Ln.disabled,ar.disabled,cr.unblended,Qn.disabled,((N,V)=>{const J=V.stride,X=s.ab.mat4.create();return s.ab.mat4.ortho(X,0,s.ag,-s.ag,0,0,1),s.ab.mat4.translate(X,X,[0,-s.ag,0]),{u_matrix:X,u_image:1,u_dimension:[J,J],u_zoom:N.overscaledZ}})(t.tileID,g),n.id,C,L,R),t.needsHillshadePrepare=!1}class Gs{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class cl extends Gs{getDefault(){return s.aj.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class nu extends Gs{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ka extends Gs{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class xu extends Gs{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ql extends Gs{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Al extends Gs{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ru extends Gs{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Cl extends Gs{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ja extends Gs{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class bu extends Gs{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ia extends Gs{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class su extends Gs{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class hl extends Gs{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class ou extends Gs{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class dl extends Gs{getDefault(){return s.aj.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class wu extends Gs{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Pl extends Gs{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Eu extends Gs{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ea extends Gs{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Hl=class extends Gs{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class au extends Gs{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Tu extends Gs{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class qa extends Gs{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class lu extends Gs{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Qa extends Gs{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Su extends Gs{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Yu extends Gs{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ku extends Gs{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Iu extends Gs{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class fl extends Gs{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Zl extends Gs{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ll extends Gs{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Je extends Ll{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ri extends Ll{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class In extends Ll{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class j extends ri{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Q=(l,t,n)=>({u_matrix:l,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),ae=(l,t,n,u,p,g,x,S,C,L,R,z,N,V,J,X)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:n,u_zoom_transition:p,u_merc_center:g,u_image0:0,u_frustum_tl:x,u_frustum_tr:S,u_frustum_br:C,u_frustum_bl:L,u_globe_pos:R,u_globe_radius:z,u_viewport:N,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:J});function ge(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const Oe=new class{constructor(){this.operations={}}newMorphing(l,t,n,u,p){if(l in this.operations){const g=this.operations[l];g.to.tileID.key!==n.tileID.key&&(g.queued=n)}else this.operations[l]={startTime:u,phase:0,duration:p,from:t,to:n,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const n=this.operations[t];for(n.phase=(l-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},rt={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Rt(l,t,n){if(t===0)return 0;const u=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*u}function gi(l,t){const n=1<<l.z;return!t&&(l.x===0||l.x===n-1)||l.y===0||l.y===n-1}const Ni=l=>({u_matrix:l});function qi(l,t,n,u,p){if(p>0){const g=s.q.now(),x=(g-l.timeAdded)/p,S=t?(g-t.timeAdded)/p:-1,C=n.getSource(),L=u.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),R=!t||Math.abs(t.tileID.overscaledZ-L)>Math.abs(l.tileID.overscaledZ-L),z=R&&l.refreshedUponExpiration?1:s.aw(R?x:1-S,0,1);return l.refreshedUponExpiration&&x>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class ii extends D{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new s.D(s.ci(),null),p=Qs("mock-dem",n,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class Bi extends D{constructor(t){const n=Qs("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new s.D(s.ci(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,x)=>{if(g[x.key]="",!this._tiles[x.key]){const S=new Yo(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);S.state="loaded",this._tiles[x.key]=S}return g},{});for(const g in this._tiles)g in p||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const u=Object.values(n);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xi extends s.aG{constructor(t,n,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=u}}class Ji extends s.cJ{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,g]=function(C){const L=new s.b4,R=new s.aU,z=131;L.reserve(17161),R.reserve(33800);const N=s.ag/128,V=s.ag+N/2,J=V+N;for(let ie=-N;ie<J;ie+=N)for(let te=-N;te<J;te+=N){const le=te<0||te>V||ie<0||ie>V?24575:0,we=s.aw(Math.round(te),0,s.ag),ve=s.aw(Math.round(ie),0,s.ag);L.emplaceBack(we+le,ve)}const X=(ie,te)=>{const le=te*z+ie;R.emplaceBack(le+1,le,le+z),R.emplaceBack(le+z,le+z+1,le+1)};for(let ie=1;ie<129;ie++)for(let te=1;te<129;te++)X(te,ie);return[0,129].forEach(ie=>{for(let te=0;te<130;te++)X(te,ie),X(ie,te)}),[L,R,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(u,s.b6.members),this.gridIndexBuffer=x.createIndexBuffer(p),this.gridSegments=s.b7.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=s.b7.simpleSegment(0,0,u.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Bi(n.map),this.orthoMatrix=s.ab.mat4.create(),s.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ag,0,s.ag,0,1);const S=x.gl;this._overlapStencilMode=new ar({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ii(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,g=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const S=t.terrain&&t.terrain.scope,C=p.get("source"),L=g?this._mockSourceCache:t.getSourceCache(C,S);if(!L)return void s.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=L,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(n):p.get("exaggeration"),!n.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const R=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.getScaledDemTileSize();this.sourceCache.update(n,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),n.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=n!=null?u-n:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const g=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(g);let S=g-this._previousZoom;const C=this._previousUpdateTimestamp;let L=g;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(g-L)>.5&&(S=.5*(g-L+S)),S*p<0&&(L+=S)),this._evaluationZoom=L;const R=x.getExaggeration(L),z=R===x.getExaggeration(Math.max(0,L-.1));if(z&&Math.abs(R-this._exaggeration)<.01)return R;let N=Math.min(.1,.00375*(this._updateTimestamp-C));return(z||R<.1||Math.abs(S)<1e-4)&&(N=Math.min(.2,4*N)),s.af(this._exaggeration,R,N)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(s.aa.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=n.getIds().map(C=>{const L=n.getTileByID(C).tileID;return L.projMatrix=u.calculateProjMatrix(L.toUnwrapped()),L});(function(C,L){const R=L.transform.pointCoordinate(L.transform.getCameraPoint()),z=new s.P(R.x,R.y);C.sort((N,V)=>{if(V.overscaledZ-N.overscaledZ)return V.overscaledZ-N.overscaledZ;const J=new s.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),X=new s.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),ie=z.mult(1<<N.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(J)-ie.distSqr(X)})})(p,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},p.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const C in x){const L=x[C];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,t[C],g),L.usedForTerrain))continue;const R=t[C];L.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[n.id]=p.map(C=>new xi(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const L=this.terrainTileForTile[C.key];if(!L)continue;const R=L.tileID.key;R in S||(this._visibleDemTiles.push(L),S[R]=R)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const u=this._findTileCoveringTileID(n,this.sourceCache);u&&(this.terrainTileForTile[n.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],g=p.dem;!g||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),ul(this.painter,p,g))}}_prepareDemTileUniforms(t,n,u,p){if(!n||n.demTexture==null)return!1;const g=t.tileID.canonical,x=Math.pow(2,n.tileID.canonical.z-g.z),S=p||"";return u[`u_dem_tl${S}`]=[g.x*x%1,g.y*x%1],u[`u_dem_scale${S}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const g=p.dem.tree.minimums[0];return g>0&&t++,u+g},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new s.cK({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(p,{premultiply:!1}):g=this._emptyDEMTexture=new s.T(t,p,n.R32F,{premultiply:!1}),g}setupElevationDraw(t,n,u){const p=this.painter.context,g=p.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let S=null,C=null,L=1;if(u&&u.morphing&&this._useVertexMorphing){const V=u.morphing.srcDemTile,J=u.morphing.dstDemTile;L=u.morphing.phase,V&&J&&(this._prepareDemTileUniforms(t,V,x,"_prev")&&(C=V),this._prepareDemTileUniforms(t,J,x)&&(S=J))}const R=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let z=null;var N;if(this.enabled?C&&S?(z=S.demTexture,p.activeTexture.set(g.TEXTURE4),C.demTexture.bind(R(C),g.CLAMP_TO_EDGE),x.u_dem_lerp=L):(S=this.terrainTileForTile[t.tileID.key],z=this._prepareDemTileUniforms(t,S,x)?S.demTexture:this.emptyDEMTexture):z=this.emptyDEMTexture,p.activeTexture.set(g.TEXTURE2),z&&(x.u_dem_size=(N=z).size[0]===1?1:N.size[0]-2,z.bind(R(S),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,n,x),u&&u.useMeterToDem&&S){const V=(1<<S.tileID.canonical.z)*s.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=V}if(u&&u.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),n.setTerrainUniformValues(p,x),this.painter.transform.projection.name==="globe"){const V=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);n.setGlobeUniformValues(p,V)}}globeUniformValues(t,n,u){const p=t.projection;return{u_tile_tl_up:p.upVector(n,0,0),u_tile_tr_up:p.upVector(n,s.ag,0),u_tile_br_up:p.upVector(n,s.ag,s.ag),u_tile_bl_up:p.upVector(n,0,s.ag),u_tile_up_scale:u?s.cL(1):p.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,g,x,S,C){if(p.transform.projection.name==="globe")(function(L,R,z,N,V){const J=L.context,X=J.gl;let ie,te;const le=L.transform,we=s.cC(L,J,le),ve=(ai,ei)=>{if(te===ei)return;const yt=[rt[ei],"PROJECTION_GLOBE_VIEW"];we&&yt.push("CUSTOM_ANTIALIASING");const Ut=L.isTileAffectedByFog(ai);ie=L.getOrCreateProgram("globeRaster",{defines:yt,overrideFog:Ut}),te=ei},ze=L.colorModeForRenderPass(),Ae=new Ln(X.LEQUAL,Ln.ReadWrite,L.depthRangeFor3D);Oe.update(V);const Le=s.cD(le),Me=[s.at(le.center.lng),s.aA(le.center.lat)],He=L.globeSharedBuffers,tt=[le.width*s.q.devicePixelRatio,le.height*s.q.devicePixelRatio],Ft=Float32Array.from(le.globeMatrix),Mt={useDenormalizedUpVectorScale:!0};{const ai=L.transform,ei=Rt(ai.zoom,R.exaggeration(),R.sourceCache._source.tileSize);te=-1;const yt=X.TRIANGLES;for(const Ut of N){const Ui=z.getTile(Ut),_t=ar.disabled,_i=R.prevTerrainTileForTile[Ut.key],Gt=R.terrainTileForTile[Ut.key];ge(_i,Gt)&&Oe.newMorphing(Ut.key,_i,Gt,V,250),J.activeTexture.set(X.TEXTURE0),Ui.texture&&Ui.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const fn=Oe.getMorphValuesForProxy(Ut.key),Ri=fn?1:0;fn&&s.J(Mt,{morphing:{srcDemTile:fn.from,dstDemTile:fn.to,phase:s.cB(fn.phase)}});const di=s.cE(Ut.canonical),$i=s.cF(di.getCenter().lat),dn=s.cG(Ut.canonical,di,$i,ai.worldSize/ai._pixelsPerMercatorPixel),Cn=s.bb(s.cH(Ut.canonical)),zn=ae(ai.expandedFarZProjMatrix,Ft,Le,Cn,s.ae(ai.zoom),Me,ai.frustumCorners.TL,ai.frustumCorners.TR,ai.frustumCorners.BR,ai.frustumCorners.BL,ai.globeCenterInViewSpace,ai.globeRadius,tt,ei,ai._farZ,dn);if(ve(Ut,Ri),ie&&(R.setupElevationDraw(Ui,ie,Mt),L.uploadCommonUniforms(J,ie,Ut.toUnwrapped()),He)){const[xr,sr,lr]=He.getGridBuffers($i,ei!==0);ie.draw(L,yt,Ae,_t,ze,Qn.backCCW,zn,"globe_raster",xr,sr,lr)}}}if(He&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const ai=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];we&&ai.push("CUSTOM_ANTIALIASING"),ie=L.getOrCreateProgram("globeRaster",{defines:ai});for(const ei of N){const{x:yt,y:Ut,z:Ui}=ei.canonical,_t=Ut===0,_i=Ut===(1<<Ui)-1,[Gt,fn,Ri,di]=He.getPoleBuffers(Ui,!1);if(di&&(_t||_i)){const $i=z.getTile(ei);J.activeTexture.set(X.TEXTURE0),$i.texture&&$i.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let dn=s.cI(Ui,yt,le);const Cn=s.bb(s.cH(ei.canonical)),zn=(xr,sr)=>xr.draw(L,X.TRIANGLES,Ae,ar.disabled,ze,Qn.disabled,ae(le.expandedFarZProjMatrix,dn,dn,Cn,0,Me,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,tt,0,le._farZ),"globe_pole_raster",sr,Ri,di);R.setupElevationDraw($i,ie,Mt),L.uploadCommonUniforms(J,ie,ei.toUnwrapped()),_t&&L.renderDefaultNorthPole&&zn(ie,Gt),_i&&L.renderDefaultSouthPole&&(dn=s.ab.mat4.scale(s.ab.mat4.create(),dn,[1,-1,1]),zn(ie,fn))}}}})(p,g,x,S,C);else{const L=p.context,R=L.gl;let z,N;const V=p.shadowRenderer,J=La(p,p.longestCutoffRange),X=ze=>{if(N===ze)return;const Ae=[];Ae.push(rt[ze]),J.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),V&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&Ae.push("NORMAL_OFFSET")),z=p.getOrCreateProgram("terrainRaster",{defines:Ae}),N=ze},ie=p.colorModeForRenderPass(),te=new Ln(R.LEQUAL,Ln.ReadWrite,p.depthRangeFor3D);Oe.update(C);const le=p.transform,we=Rt(le.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let ve=[0,0,0];if(V){const ze=p.style.directionalLight,Ae=p.style.ambientLight;ze&&Ae&&(ve=Ns(p.style,ze,Ae))}{N=-1;const ze=R.TRIANGLES,[Ae,Le]=[g.gridIndexBuffer,g.gridSegments];for(const Me of S){const He=x.getTile(Me),tt=ar.disabled,Ft=g.prevTerrainTileForTile[Me.key],Mt=g.terrainTileForTile[Me.key];ge(Ft,Mt)&&Oe.newMorphing(Me.key,Ft,Mt,C,250),L.activeTexture.set(R.TEXTURE0),He.texture&&He.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const ai=Oe.getMorphValuesForProxy(Me.key),ei=ai?1:0;let yt;ai&&(yt={morphing:{srcDemTile:ai.from,dstDemTile:ai.to,phase:s.cB(ai.phase)}});const Ut=Q(Me.projMatrix,gi(Me.canonical,le.renderWorldCopies)?we/10:we,ve);if(X(ei),!z)continue;g.setupElevationDraw(He,z,yt);const Ui=Me.toUnwrapped();V&&V.setupShadows(Ui,z),p.uploadCommonUniforms(L,z,Ui,null,J),z.draw(p,ze,te,tt,ie,Qn.backCCW,Ut,"terrain_raster",g.gridBuffer,Ae,Le)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,u=this.painter.context,p=this.proxySourceCache,g=this.proxiedCoords[p.id],x=this._drapedRenderBatches.shift(),S=n.style.order,C=[];let L=0;for(const R of g){const z=p.getTileByID(R.proxyTileKey),N=p.proxyCachedFBO[R.key]?p.proxyCachedFBO[R.key][t]:void 0,V=N!==void 0?p.renderCache[N]:this.pool[L++],J=N!==void 0;if(z.texture=V.tex,J&&!V.dirty){C.push(z.tileID);continue}let X;u.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(u.clear({color:s.aj.transparent,stencil:0}),V.dirty=!1);for(let ie=x.start;ie<=x.end;++ie){const te=n.style._mergedLayers[S[ie]];if(te.isHidden(n.transform.zoom))continue;const le=n.style.getLayerSourceCache(te),we=le?this.proxyToSource[R.key][le.id]:[R];if(!we)continue;const ve=we;u.viewport.set([0,0,V.fb.width,V.fb.height]),X!==(le?le.id:null)&&(this._setupStencil(V,we,te,le),X=le?le.id:null),n.renderLayer(n,le,te,ve)}if(this._drapedRenderBatches.length===0)for(const ie of this._pendingGroundEffectLayers){const te=n.style._mergedLayers[S[ie]];if(te.isHidden(n.transform.zoom))continue;const le=n.style.getLayerSourceCache(te),we=le?this.proxyToSource[R.key][le.id]:[R];if(!we)continue;const ve=we;u.viewport.set([0,0,V.fb.width,V.fb.height]),X!==(le?le.id:null)&&(this._setupStencil(V,we,te,le),X=le?le.id:null),n.renderLayer(n,le,te,ve)}this.renderedToTile?(V.dirty=!0,C.push(z.tileID)):J||--L,L===5&&(L=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let u=-1,p=n;for(let g=0;g<n;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?u=Math.max(u,g):p=Math.min(p,g);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const x=g.tileID,S=1<<x.overscaledZ,{x:C,y:L}=x.canonical,R=C/S,z=(C+1)/S,N=L/S,V=(L+1)/S;return{minx:R,miny:N,maxx:z,maxy:V,t:g.dem.tree.raycastRoot(R,N,z,V,t,n,u),tile:g}});p.sort((g,x)=>(g.t!==null?g.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const g of p){if(g.t==null)return null;const x=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,n,u);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,n=t.gl,u=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const p=new s.T(t,{width:u[0],height:u[1],data:null},n.RGBA8);p.bind(n.LINEAR,n.CLAMP_TO_EDGE);const g=t.createFramebuffer(u[0],u[1],!0,null);return g.colorAttachment.set(p.texture),g.depthAttachment=new j(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],u=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!u&&n.shouldRedrape():!u&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof Vn){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(p);if(g&&!n[g.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof s.a9){n[g.id]=!0;for(const x of this.proxyCoords){const S=this.proxyToSource[x.key][g.id];if(S)for(const C of S)this._clearRenderCacheForTile(g.id,C)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof Hr){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(p);if(!g||n[g.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const x=p.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][g.id];if(C)for(const L of C){const R=qi(g.getTile(L),g.findLoadedParent(L,0),g,this.painter.transform,x);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(g.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(n===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,g=0,x=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++g<n;)x=this._style._mergedLayers[t[g]];for(;g<n;++g){const S=this._style._mergedLayers[t[g]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?p===void 0&&(p=g):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),p!==void 0&&(u.push({start:p,end:g-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:g-1}),u.length!==0){const S=u[u.length-1];this._pendingGroundEffectLayers.every(C=>C>S.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const x=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let S=0;S<x.length;++S){const C=Object.values(x[S]);n.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let x=u.length-1;x>=0;x--){const S=u[x];if(n.getTileByID(S.key),n.proxyCachedFBO[S.key]!==void 0){const C=t[S.key],L=this.proxyToSource[S.key];let R=0;for(const z in L){const N=L[z],V=C[z];if(!V||V.length!==N.length||N.some((J,X)=>J!==V[X]||p[z]&&p[z].hasOwnProperty(J.key))){R=-1;break}++R}for(const z in n.proxyCachedFBO[S.key])n.renderCache[n.proxyCachedFBO[S.key][z]].dirty=R<0||R!==Object.values(C).length}}const g=[...this._drapedRenderBatches];g.sort((x,S)=>S.end-S.start-(x.end-x.start));for(const x of g)for(const S of u){if(n.proxyCachedFBO[S.key])continue;let C=n.renderCachePool.pop();C===void 0&&n.renderCache.length<50&&(C=n.renderCache.length,n.renderCache.push(this._createFBO())),C!==void 0&&(n.proxyCachedFBO[S.key]={},n.proxyCachedFBO[S.key][x.start]=C,n.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,x=g.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let S;if(u.isTileClipped())S=n.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):ar.disabled}_renderTileClippingMasks(t,n){const u=this.painter,p=this.painter.context,g=p.gl;u._tileClippingMaskIDs={},p.setColorMode(cr.disabled),p.setDepthMode(Ln.disabled);const x=u.getOrCreateProgram("clippingMask");for(const S of t){const C=u._tileClippingMaskIDs[S.key]=--n;x.draw(u,g.TRIANGLES,Ln.disabled,new ar({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),cr.disabled,Qn.disabled,Ni(S.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const u=[t.x,t.y,1,1];s.ab.vec4.transformMat4(u,u,n.pixelMatrixInverse),s.ab.vec4.scale(u,u,1/u[3]),u[0]/=n.worldSize,u[1]/=n.worldSize;const p=n._camera.position,g=s.bH(1,n.center.lat),x=[p[0],p[1],p[2]/g,0],S=s.ab.vec3.subtract([],u.slice(0,3),x);s.ab.vec3.normalize(S,S);const C=this.raycast(x,S,this._exaggeration);return C!==null&&C?(s.ab.vec3.scaleAndAdd(x,x,S,C),x[3]=x[2],x[2]*=g,x):null}_setupProxiedCoordsForOrtho(t,n,u){if(t.getSource()instanceof s.aJ)return this._setupProxiedCoordsForImageSource(t,n,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let C=0;C<g.length;C++){const L=g[C],R=this._findTileCoveringTileID(L,t);if(R){const z=this._createProxiedId(L,R,u[L.key]&&u[L.key][t.id]);p.push(z),this.proxyToSource[L.key][t.id]=[z]}}let x=!1;const S=new Set;for(let C=0;C<n.length;C++){const L=t.getTile(n[C]);if(!L||!L.hasData())continue;const R=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==L.tileID.canonical.z){const z=this.proxyToSource[R.tileID.key][t.id],N=this._createProxiedId(R.tileID,L,u[R.tileID.key]&&u[R.tileID.key][t.id]);z?z.splice(z.length-1,0,N):this.proxyToSource[R.tileID.key][t.id]=[N];const V=this.proxyToSource[R.tileID.key][t.id];S.has(V)||S.add(V),p.push(N),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const C of S)C.sort((L,R)=>R.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],g=this.proxyCoords,x=t.getSource(),S=x.tileID;if(!S)return;const C=new s.P(S.x,S.y)._div(1<<S.z),L=x.coordinates.map(s.aa.fromLngLat).reduce((z,N)=>(z.min.x=Math.min(z.min.x,N.x-C.x),z.min.y=Math.min(z.min.y,N.y-C.y),z.max.x=Math.max(z.max.x,N.x-C.x),z.max.y=Math.max(z.max.y,N.y-C.y),z),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(z,N)=>{const V=z.wrap+z.canonical.x/(1<<z.canonical.z),J=z.canonical.y/(1<<z.canonical.z),X=s.ag/(1<<z.canonical.z),ie=N.wrap+N.canonical.x/(1<<N.canonical.z),te=N.canonical.y/(1<<N.canonical.z);return V+X<ie+L.min.x||V>ie+L.max.x||J+X<te+L.min.y||J>te+L.max.y};for(let z=0;z<g.length;z++){const N=g[z];for(let V=0;V<n.length;V++){const J=t.getTile(n[V]);if(!J||!J.hasData()||R(N,J.tileID))continue;const X=this._createProxiedId(N,J,u[N.key]&&u[N.key][t.id]),ie=this.proxyToSource[N.key][t.id];ie?ie.push(X):this.proxyToSource[N.key][t.id]=[X],p.push(X)}}}_createProxiedId(t,n,u){let p=this.orthoMatrix;if(u){const g=u.find(x=>x.key===n.tileID.key);if(g)return g}if(n.tileID.key!==t.key){const g=t.canonical.z-n.tileID.canonical.z;let x,S,C;p=s.ab.mat4.create();const L=n.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(x=s.ag>>g,S=x*((n.tileID.canonical.x<<g)-t.canonical.x+L),C=x*((n.tileID.canonical.y<<g)-t.canonical.y)):(x=s.ag<<-g,S=s.ag*(n.tileID.canonical.x-(t.canonical.x+L<<-g)),C=s.ag*(n.tileID.canonical.y-(t.canonical.y<<-g))),s.ab.mat4.ortho(p,0,x,0,x,0,1),s.ab.mat4.translate(p,p,[S,C,0])}return new xi(n.tileID,t.key,p)}_findTileCoveringTileID(t,n){let u=n.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[n.id],g=p[t.key];if(u=g?n.getTileByID(g):null,u&&u.hasData()||g===null)return u;let x=u?u.tileID:t,S=x.overscaledZ;const C=n.getSource().minzoom,L=[];if(!g){const z=n.getSource().maxzoom;if(t.canonical.z>=z){const N=t.canonical.z-z;n.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,n.transform.tileZoom),x=new s.aG(S,t.wrap,z,t.canonical.x>>N,t.canonical.y>>N)):N!==0&&(S=z,x=new s.aG(S,t.wrap,z,t.canonical.x>>N,t.canonical.y>>N))}x.key!==t.key&&(L.push(x.key),u=n.getTile(x))}const R=z=>{L.forEach(N=>{p[N]=z}),L.length=0};for(S-=1;S>=C&&(!u||!u.hasData());S--){u&&R(u.tileID.key);const z=x.calculateScaledKey(S);if(u=n.getTileByID(z),u&&u.hasData())break;const N=p[z];if(N===null)break;N===void 0?L.push(z):u=n.getTileByID(N)}return R(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[n.key]=!0}}function pn(l,t,n){const u=function(S,C,L){const R=s.ab.vec3.dot(C,S),z=s.ab.vec3.dot(L,[.2126,.7152,.0722]),N=(J,X,ie)=>(1-ie)*J+ie*X,V=N(1-.3*Math.min(z,1),1,Math.min(R+1,1));return N(.92,1,Math.asin(s.aw(C[2],-1,1))/Math.PI+.5)*V}(l,[0,0,1],t),p=[0,0,0];s.ab.vec3.scale(p,n.slice(0,3),u);const g=[0,0,0];s.ab.vec3.scale(g,t.slice(0,3),l[2]);const x=[0,0,0];return s.ab.vec3.add(x,p,g),s.cf(x)}const Zn=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],vr=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Lr{static cacheKey(t,n,u,p){let g=`${n}${p?p.cacheKey:""}`;for(const x of u)t.usedDefines.includes(x)&&(g+=`/${x}`);return g}constructor(t,n,u,p,g,x){const S=t.gl;this.program=S.createProgram(),this.configuration=p,this.name=n,this.fixedDefines=[...x];const C=p?p.getBinderAttributes():[],L=(u.staticAttributes||[]).concat(C);let R=p?p.defines():[];R=R.concat(x.map(ie=>`#define ${ie}`));const z=`#version 300 es
`;let N=z+R.concat("precision mediump float;",Ya,al.fragmentSource).join(`
`);for(const ie of u.fragmentIncludes)N+=`
${ga[ie]}`;N+=`
${u.fragmentSource}`;let V=z+R.concat("precision highp float;",Ya,al.vertexSource).join(`
`);for(const ie of u.vertexIncludes)V+=`
${ga[ie]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(V+=`
uniform int u_instanceID;
`),V+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(V=V.replaceAll("gl_InstanceID","u_instanceID"));const J=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(J,N),S.compileShader(J),S.attachShader(this.program,J);const X=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(X,V),S.compileShader(X),S.attachShader(this.program,X),this.attributes={},this.numAttributes=L.length;for(let ie=0;ie<this.numAttributes;ie++)if(L[ie]){const te=L[ie].startsWith("a_")?L[ie]:`a_${L[ie]}`;S.bindAttribLocation(this.program,ie,te),this.attributes[te]=ie}S.linkProgram(this.program),S.deleteShader(X),S.deleteShader(J),this.fixedUniforms=g(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ie=>({u_instanceID:new s.bN(ie)}))(t)),(x.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=(ie=>({u_dem:new s.bN(ie),u_dem_prev:new s.bN(ie),u_dem_tl:new s.bK(ie),u_dem_scale:new s.bM(ie),u_dem_tl_prev:new s.bK(ie),u_dem_scale_prev:new s.bM(ie),u_dem_size:new s.bM(ie),u_dem_lerp:new s.bM(ie),u_exaggeration:new s.bM(ie),u_depth:new s.bN(ie),u_depth_size_inv:new s.bK(ie),u_depth_range_unpack:new s.bK(ie),u_occluder_half_size:new s.bM(ie),u_occlusion_depth_offset:new s.bM(ie),u_meter_to_dem:new s.bM(ie),u_label_plane_matrix_inv:new s.bJ(ie)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new s.bL(ie),u_tile_tr_up:new s.bL(ie),u_tile_br_up:new s.bL(ie),u_tile_bl_up:new s.bL(ie),u_tile_up_scale:new s.bM(ie)}))(t)),x.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new s.bJ(ie),u_fog_range:new s.bK(ie),u_fog_color:new s.ca(ie),u_fog_horizon_blend:new s.bM(ie),u_fog_vertical_limit:new s.bK(ie),u_fog_temporal_offset:new s.bM(ie),u_frustum_tl:new s.bL(ie),u_frustum_tr:new s.bL(ie),u_frustum_br:new s.bL(ie),u_frustum_bl:new s.bL(ie),u_globe_pos:new s.bL(ie),u_globe_radius:new s.bM(ie),u_globe_transition:new s.bM(ie),u_is_globe:new s.bN(ie),u_viewport:new s.bK(ie)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new s.ca(ie)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new s.bL(ie),u_lighting_directional_dir:new s.bL(ie),u_lighting_directional_color:new s.bL(ie),u_ground_radiance:new s.bL(ie)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new s.bJ(ie),u_light_matrix_1:new s.bJ(ie),u_fade_range:new s.bK(ie),u_shadow_normal_offset:new s.bL(ie),u_shadow_intensity:new s.bM(ie),u_shadow_texel_size:new s.bM(ie),u_shadow_map_resolution:new s.bM(ie),u_shadow_direction:new s.bL(ie),u_shadow_bias:new s.bL(ie),u_shadowmap_0:new s.bN(ie),u_shadowmap_1:new s.bN(ie)}))(t))}}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p]&&u[p].set(this.program,p,n[p])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p]&&u[p].set(this.program,p,n[p])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}_drawDebugWireframe(t,n,u,p,g,x,S,C,L,R){const z=t.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;const N=t.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||t._terrain&&t._terrain.renderingToTexture||!Zn.includes(this.name))||!(!z.layers3D||!vr.includes(this.name))))return;const V=N.gl,J=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,N);if(!J)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const ie=t.getOrCreateProgram(this.name,{config:this.configuration,defines:X});N.program.set(ie.program);const te=(ve,ze,Ae)=>{if(ze[ve]&&Ae[ve])for(const Le in ze[ve])Ae[ve][Le]&&Ae[ve][Le].set(Ae.program,Le,ze[ve][Le].current)};L&&L.setUniforms(ie.program,N,ie.binderUniforms,S,{zoom:C}),te("fixedUniforms",this,ie),te("terrainUniforms",this,ie),te("globeUniforms",this,ie),te("fogUniforms",this,ie),te("lightsUniforms",this,ie),te("shadowUniforms",this,ie),J.bind(),N.setColorMode(new cr([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],s.aj.transparent,[!0,!0,!0,!1])),N.setDepthMode(new Ln(n.func===V.LESS?V.LEQUAL:n.func,Ln.ReadOnly,n.range)),N.setStencilMode(ar.disabled);const le=3*x.primitiveLength*2,we=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ve=R||1;for(let ze=0;ze<ve;++ze)ie.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ze),V.drawElements(V.LINES,le,V.UNSIGNED_SHORT,we)}else R&&R>1?V.drawElementsInstanced(V.LINES,le,V.UNSIGNED_SHORT,we,R):V.drawElements(V.LINES,le,V.UNSIGNED_SHORT,we);g.bind(),N.program.set(this.program),N.setDepthMode(n),N.setStencilMode(u),N.setColorMode(p)}checkUniforms(t,n,u){if(this.fixedDefines.includes(n)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${n} being defined`)}}draw(t,n,u,p,g,x,S,C,L,R,z,N,V,J,X,ie){const te=t.context,le=te.gl;if(this.failedToCreate)return;te.program.set(this.program),te.setDepthMode(u),te.setStencilMode(p),te.setColorMode(g),te.setCullFace(x);for(const ze of Object.keys(this.fixedUniforms))this.fixedUniforms[ze].set(this.program,ze,S[ze]);J&&J.setUniforms(this.program,te,this.binderUniforms,N,{zoom:V});const we={[le.POINTS]:1,[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[n];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const ve=ie&&ie>0?1:void 0;for(const ze of z.get()){const Ae=ze.vaos||(ze.vaos={});if((Ae[C]||(Ae[C]=new ll)).bind(te,this,L,J?J.getPaintVertexBuffers():[],R,ze.vertexOffset,X||[],ve),this.forceManualRenderingForInstanceIDShaders){const Le=ie||1;for(let Me=0;Me<Le;++Me)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Me),R?le.drawElements(n,ze.primitiveLength*we,le.UNSIGNED_SHORT,ze.primitiveOffset*we*2):le.drawArrays(n,ze.vertexOffset,ze.vertexLength)}else ie&&ie>1?le.drawElementsInstanced(n,ze.primitiveLength*we,le.UNSIGNED_SHORT,ze.primitiveOffset*we*2,ie):R?le.drawElements(n,ze.primitiveLength*we,le.UNSIGNED_SHORT,ze.primitiveOffset*we*2):le.drawArrays(n,ze.vertexOffset,ze.vertexLength);n===le.TRIANGLES&&R&&this._drawDebugWireframe(t,u,p,g,R,ze,N,V,J,ie)}}}function Ar(l,t){const n=Math.pow(2,t.tileID.overscaledZ),u=t.tileSize*Math.pow(2,l.transform.tileZoom)/n,p=u*(t.tileID.canonical.x+t.tileID.wrap*n),g=u*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ar(t,1,l.transform.tileZoom),u_pixel_coord_upper:[p>>16,g>>16],u_pixel_coord_lower:[65535&p,65535&g]}}const er={terrain:0,flat:1},es=s.ab.mat4.create(),Zs=(l,t,n,u,p,g,x,S,C,L,R,z,N,V,J,X,ie,te)=>{const le=t.style.light,we=le.properties.get("position"),ve=[we.x,we.y,we.z],ze=s.ab.mat3.create();le.properties.get("anchor")==="viewport"&&(s.ab.mat3.fromRotation(ze,-t.transform.angle),s.ab.vec3.transformMat3(ve,ve,ze));const Ae=le.properties.get("color"),Le=t.transform,Me={u_matrix:l,u_lightpos:ve,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+n,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:es,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:er[L],u_base_type:er[R],u_ao:p,u_edge_radius:g,u_width_scale:x,u_flood_light_color:J,u_vertical_scale:X,u_flood_light_intensity:ie,u_ground_shadow_factor:te};return Le.projection.name==="globe"&&(Me.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],Me.u_zoom_transition=z,Me.u_inv_rot_matrix=V,Me.u_merc_center=N,Me.u_up_dir=Le.projection.upVector(new s.bT(0,0,0),N[0]*s.ag,N[1]*s.ag),Me.u_height_lift=C),Me},Vr=(l,t,n,u,p,g)=>({u_matrix:l,u_edge_radius:t,u_width_scale:n,u_vertical_scale:u,u_height_type:er[p],u_base_type:er[g]}),fs=(l,t,n,u,p,g,x,S,C,L,R,z,N,V,J,X,ie)=>{const te=Zs(l,t,n,u,p,g,x,S,L,R,z,N,V,J,X,ie,1,[0,0,0]),le={u_height_factor:-Math.pow(2,S.overscaledZ)/C.tileSize/8};return s.l(te,Ar(t,C),le)},us=(l,t)=>({u_matrix:l,u_emissive_strength:t}),is=(l,t,n,u)=>s.l(us(l,t),Ar(n,u)),To=(l,t,n)=>({u_matrix:l,u_world:n,u_emissive_strength:t}),co=(l,t,n,u,p)=>s.l(is(l,t,n,u),{u_world:p}),Do=(l,t,n,u)=>{const p=s.ag/n.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},zo=(l,t,n=1)=>({u_matrix:l,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:n}),_r=s.ab.mat4.create(),on=(l,t,n,u,p,g,x)=>{const S=l.transform,C=S.projection.name==="globe",L=C?s.cN(S.zoom,t.canonical)*S._pixelsPerMercatorPixel:s.ar(n,1,g),R={u_matrix:t.projMatrix,u_extrude_scale:L,u_intensity:x,u_inv_rot_matrix:_r,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){R.u_inv_rot_matrix=u,R.u_merc_center=p,R.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],R.u_zoom_transition=s.ae(S.zoom);const z=p[0]*s.ag,N=p[1]*s.ag;R.u_up_dir=S.projection.upVector(new s.bT(0,0,0),z,N)}return R};function no(l,[t,n,u,p],[g,x]){if(g===x)return[0,0,0,0];const S=255*(l-1)/(l*(x-g));return[t*S,n*S,u*S,p*S]}function jo(l,t,[n,u]){return n===u?0:.5/l+(t-n)*(l-1)/(l*(u-n))}const No=(l,t,n,u,p,g,x,S,C,L,R,z,N,V,J,X,ie,te,le,we,ve)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:L,u_fade_t:R.mix,u_opacity:R.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:s.cO(z.paint.get("raster-saturation")),u_contrast_factor:s.cP(z.paint.get("raster-contrast")),u_spin_weights:Ko(z.paint.get("raster-hue-rotate")),u_perspective_transform:N,u_raster_elevation:V,u_zoom_transition:x,u_merc_center:S,u_cutoff_params:C,u_colorization_mix:no(s.cQ,X,te),u_colorization_offset:jo(s.cQ,ie,te),u_color_ramp:J,u_texture_offset:[we/(le+2*we),le/(le+2*we)],u_texture_res:[le+2*we,le+2*we],u_emissive_strength:ve});function Ko(l){l*=Math.PI/180;const t=Math.sin(l),n=Math.cos(l);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const jn=.05,Da=(l,t,n,u,p,g,x,S,C,L,R,z)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:L,u_fade_t:R.mix,u_opacity:R.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:x,u_merc_center:S,u_cutoff_params:C}),Rl=(l,t,n,u,p,g,x,S,C,L)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:u,u_color_ramp:g,u_velocity_res:p,u_max_speed:x,u_uv_offset:S,u_data_scale:[255*C[0],255*C[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[jn,jn]}),el=(l,t,n,u,p,g,x,S,C,L)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:u,u_max_speed:p,u_speed_factor:g,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*C[0],255*C[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[jn,jn]}),kl=s.ab.mat4.create(),pl=(l,t,n,u,p,g,x,S,C,L,R,z,N,V,J,X,ie,te,le,we,ve,ze)=>{const Ae=p.transform,Le={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Ae.getCameraToCenterDistance(le),u_rotate_symbol:+n,u_aspect_ratio:Ae.width/Ae.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:S,u_is_text:+L,u_elevation_from_sea:C?1:0,u_pitch_with_map:+u,u_texsize:R,u_texsize_icon:z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:kl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:kl,u_up_vector:[0,-1,0],u_color_adj_mat:we,u_icon_transition:ve||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(le)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:+N,u_scale_factor:ze||1};return le.name==="globe"&&(Le.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],Le.u_zoom_transition=J,Le.u_inv_rot_matrix=ie,Le.u_merc_center=X,Le.u_camera_forward=Ae._camera.forward(),Le.u_ecef_origin=s.cR(Ae.globeMatrix,V.toUnwrapped()),Le.u_tile_matrix=Float32Array.from(Ae.globeMatrix),Le.u_up_vector=te),Le},uh=(l,t,n,u)=>({u_matrix:l,u_emissive_strength:t,u_opacity:n,u_color:u}),vd=(l,t,n,u,p,g,x,S,C)=>s.l(function(L,R,z,N,V,J){const{width:X,height:ie}=N.imageManager.getPixelSize(R),te=Math.pow(2,J.tileID.overscaledZ),le=J.tileSize*Math.pow(2,N.transform.tileZoom)/te,we=le*(J.tileID.canonical.x+J.tileID.wrap*te),ve=le*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[X,ie],u_pattern_size:z.displaySize,u_pattern_units_to_pixels:V?[N.transform.width,-1*N.transform.height]:[1/s.ar(J,1,N.transform.tileZoom),1/s.ar(J,1,N.transform.tileZoom)],u_pixel_coord_upper:[we>>16,ve>>16],u_pixel_coord_lower:[65535&we,65535&ve]}}(0,g,x,u,S,C),{u_matrix:l,u_emissive_strength:t,u_opacity:n}),ch=new Float32Array(s.ab.mat4.identity([])),Ju=(l,t,n,u,p,g,x,S,C,L,R,z,N,V=[0,0,0],J)=>{const X=p.style.light,ie=X.properties.get("position"),te=[-ie.x,-ie.y,ie.z],le=s.ab.mat3.create();X.properties.get("anchor")==="viewport"&&(s.ab.mat3.fromRotation(le,-p.transform.angle),s.ab.vec3.transformMat3(te,te,le));const we=R.alphaMode==="MASK",ve=X.properties.get("color").toRenderColor(null),ze=N.paint.get("model-ambient-occlusion-intensity"),Ae=N.paint.get("model-color").constantOr(s.aj.white).toRenderColor(null),Le=N.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:u||ch,u_lightpos:te,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_camera_pos:V,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+we,u_alphaCutoff:R.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[S[0],S[1],S[2],1],u_metallicFactor:C,u_roughnessFactor:L,u_baseColorTexture:Eo.BaseColor,u_metallicRoughnessTexture:Eo.MetallicRoughness,u_normalTexture:Eo.Normal,u_occlusionTexture:Eo.Occlusion,u_emissionTexture:Eo.Emission,u_lutTexture:Eo.LUT,u_color_mix:[Ae.r,Ae.g,Ae.b,Le],u_aoIntensity:ze,u_emissive_strength:z,u_occlusionTextureTransform:J||[0,0,0,0]}},Mc=(l,t=ch,n=ch)=>({u_matrix:l,u_instance:t,u_node_matrix:n}),hh={fillExtrusion:l=>({u_matrix:new s.bJ(l),u_lightpos:new s.bL(l),u_lightintensity:new s.bM(l),u_lightcolor:new s.bL(l),u_vertical_gradient:new s.bM(l),u_opacity:new s.bM(l),u_edge_radius:new s.bM(l),u_width_scale:new s.bM(l),u_ao:new s.bK(l),u_height_type:new s.bN(l),u_base_type:new s.bN(l),u_tile_id:new s.bL(l),u_zoom_transition:new s.bM(l),u_inv_rot_matrix:new s.bJ(l),u_merc_center:new s.bK(l),u_up_dir:new s.bL(l),u_height_lift:new s.bM(l),u_flood_light_color:new s.bL(l),u_vertical_scale:new s.bM(l),u_flood_light_intensity:new s.bM(l),u_ground_shadow_factor:new s.bL(l)}),fillExtrusionDepth:l=>({u_matrix:new s.bJ(l),u_edge_radius:new s.bM(l),u_width_scale:new s.bM(l),u_vertical_scale:new s.bM(l),u_height_type:new s.bN(l),u_base_type:new s.bN(l)}),fillExtrusionPattern:l=>({u_matrix:new s.bJ(l),u_lightpos:new s.bL(l),u_lightintensity:new s.bM(l),u_lightcolor:new s.bL(l),u_vertical_gradient:new s.bM(l),u_height_factor:new s.bM(l),u_edge_radius:new s.bM(l),u_width_scale:new s.bM(l),u_ao:new s.bK(l),u_height_type:new s.bN(l),u_base_type:new s.bN(l),u_tile_id:new s.bL(l),u_zoom_transition:new s.bM(l),u_inv_rot_matrix:new s.bJ(l),u_merc_center:new s.bK(l),u_up_dir:new s.bL(l),u_height_lift:new s.bM(l),u_image:new s.bN(l),u_texsize:new s.bK(l),u_pixel_coord_upper:new s.bK(l),u_pixel_coord_lower:new s.bK(l),u_tile_units_to_pixels:new s.bM(l),u_opacity:new s.bM(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new s.bJ(l),u_opacity:new s.bM(l),u_ao_pass:new s.bM(l),u_meter_to_tile:new s.bM(l),u_ao:new s.bK(l),u_flood_light_intensity:new s.bM(l),u_flood_light_color:new s.bL(l),u_attenuation:new s.bM(l),u_edge_radius:new s.bM(l),u_fb:new s.bN(l),u_fb_size:new s.bM(l),u_dynamic_offset:new s.bM(l)}),fill:l=>({u_matrix:new s.bJ(l),u_emissive_strength:new s.bM(l)}),fillPattern:l=>({u_matrix:new s.bJ(l),u_emissive_strength:new s.bM(l),u_image:new s.bN(l),u_texsize:new s.bK(l),u_pixel_coord_upper:new s.bK(l),u_pixel_coord_lower:new s.bK(l),u_tile_units_to_pixels:new s.bM(l)}),fillOutline:l=>({u_matrix:new s.bJ(l),u_emissive_strength:new s.bM(l),u_world:new s.bK(l)}),fillOutlinePattern:l=>({u_matrix:new s.bJ(l),u_emissive_strength:new s.bM(l),u_world:new s.bK(l),u_image:new s.bN(l),u_texsize:new s.bK(l),u_pixel_coord_upper:new s.bK(l),u_pixel_coord_lower:new s.bK(l),u_tile_units_to_pixels:new s.bM(l)}),circle:s.cS,collisionBox:l=>({u_matrix:new s.bJ(l),u_camera_to_center_distance:new s.bM(l),u_extrude_scale:new s.bK(l)}),collisionCircle:l=>({u_matrix:new s.bJ(l),u_inv_matrix:new s.bJ(l),u_camera_to_center_distance:new s.bM(l),u_viewport_size:new s.bK(l)}),debug:l=>({u_color:new s.cz(l),u_matrix:new s.bJ(l),u_overlay:new s.bN(l),u_overlay_scale:new s.bM(l)}),clippingMask:l=>({u_matrix:new s.bJ(l)}),heatmap:l=>({u_extrude_scale:new s.bM(l),u_intensity:new s.bM(l),u_matrix:new s.bJ(l),u_inv_rot_matrix:new s.bJ(l),u_merc_center:new s.bK(l),u_tile_id:new s.bL(l),u_zoom_transition:new s.bM(l),u_up_dir:new s.bL(l)}),heatmapTexture:l=>({u_image:new s.bN(l),u_color_ramp:new s.bN(l),u_opacity:new s.bM(l)}),hillshade:l=>({u_matrix:new s.bJ(l),u_image:new s.bN(l),u_latrange:new s.bK(l),u_light:new s.bK(l),u_shadow:new s.cz(l),u_highlight:new s.cz(l),u_emissive_strength:new s.bM(l),u_accent:new s.cz(l)}),hillshadePrepare:l=>({u_matrix:new s.bJ(l),u_image:new s.bN(l),u_dimension:new s.bK(l),u_zoom:new s.bM(l)}),line:s.cT,linePattern:s.cU,raster:l=>({u_matrix:new s.bJ(l),u_normalize_matrix:new s.bJ(l),u_globe_matrix:new s.bJ(l),u_merc_matrix:new s.bJ(l),u_grid_matrix:new s.cA(l),u_tl_parent:new s.bK(l),u_scale_parent:new s.bM(l),u_fade_t:new s.bM(l),u_opacity:new s.bM(l),u_image0:new s.bN(l),u_image1:new s.bN(l),u_brightness_low:new s.bM(l),u_brightness_high:new s.bM(l),u_saturation_factor:new s.bM(l),u_contrast_factor:new s.bM(l),u_spin_weights:new s.bL(l),u_perspective_transform:new s.bK(l),u_raster_elevation:new s.bM(l),u_zoom_transition:new s.bM(l),u_merc_center:new s.bK(l),u_cutoff_params:new s.ca(l),u_colorization_mix:new s.ca(l),u_colorization_offset:new s.bM(l),u_color_ramp:new s.bN(l),u_texture_offset:new s.bK(l),u_texture_res:new s.bK(l),u_emissive_strength:new s.bM(l)}),rasterParticle:l=>({u_matrix:new s.bJ(l),u_normalize_matrix:new s.bJ(l),u_globe_matrix:new s.bJ(l),u_merc_matrix:new s.bJ(l),u_grid_matrix:new s.cA(l),u_tl_parent:new s.bK(l),u_scale_parent:new s.bM(l),u_fade_t:new s.bM(l),u_opacity:new s.bM(l),u_image0:new s.bN(l),u_image1:new s.bN(l),u_raster_elevation:new s.bM(l),u_zoom_transition:new s.bM(l),u_merc_center:new s.bK(l),u_cutoff_params:new s.ca(l)}),rasterParticleTexture:l=>({u_texture:new s.bN(l),u_opacity:new s.bM(l)}),rasterParticleDraw:l=>({u_particle_texture:new s.bN(l),u_particle_texture_side_len:new s.bM(l),u_tile_offset:new s.bK(l),u_velocity:new s.bN(l),u_color_ramp:new s.bN(l),u_velocity_res:new s.bK(l),u_max_speed:new s.bM(l),u_uv_offset:new s.bK(l),u_data_scale:new s.bK(l),u_data_offset:new s.bM(l),u_particle_pos_scale:new s.bM(l),u_particle_pos_offset:new s.bK(l)}),rasterParticleUpdate:l=>({u_particle_texture:new s.bN(l),u_particle_texture_side_len:new s.bM(l),u_velocity:new s.bN(l),u_velocity_res:new s.bK(l),u_max_speed:new s.bM(l),u_speed_factor:new s.bM(l),u_reset_rate:new s.bM(l),u_rand_seed:new s.bM(l),u_uv_offset:new s.bK(l),u_data_scale:new s.bK(l),u_data_offset:new s.bM(l),u_particle_pos_scale:new s.bM(l),u_particle_pos_offset:new s.bK(l)}),symbol:l=>({u_is_size_zoom_constant:new s.bN(l),u_is_size_feature_constant:new s.bN(l),u_size_t:new s.bM(l),u_size:new s.bM(l),u_camera_to_center_distance:new s.bM(l),u_rotate_symbol:new s.bN(l),u_aspect_ratio:new s.bM(l),u_fade_change:new s.bM(l),u_matrix:new s.bJ(l),u_label_plane_matrix:new s.bJ(l),u_coord_matrix:new s.bJ(l),u_is_text:new s.bN(l),u_elevation_from_sea:new s.bN(l),u_pitch_with_map:new s.bN(l),u_texsize:new s.bK(l),u_texsize_icon:new s.bK(l),u_texture:new s.bN(l),u_texture_icon:new s.bN(l),u_gamma_scale:new s.bM(l),u_device_pixel_ratio:new s.bM(l),u_tile_id:new s.bL(l),u_zoom_transition:new s.bM(l),u_inv_rot_matrix:new s.bJ(l),u_merc_center:new s.bK(l),u_camera_forward:new s.bL(l),u_tile_matrix:new s.bJ(l),u_up_vector:new s.bL(l),u_ecef_origin:new s.bL(l),u_is_halo:new s.bN(l),u_icon_transition:new s.bM(l),u_color_adj_mat:new s.bJ(l),u_scale_factor:new s.bM(l)}),background:l=>({u_matrix:new s.bJ(l),u_emissive_strength:new s.bM(l),u_opacity:new s.bM(l),u_color:new s.cz(l)}),backgroundPattern:l=>({u_matrix:new s.bJ(l),u_emissive_strength:new s.bM(l),u_opacity:new s.bM(l),u_image:new s.bN(l),u_pattern_tl:new s.bK(l),u_pattern_br:new s.bK(l),u_texsize:new s.bK(l),u_pattern_size:new s.bK(l),u_pixel_coord_upper:new s.bK(l),u_pixel_coord_lower:new s.bK(l),u_pattern_units_to_pixels:new s.bK(l)}),terrainRaster:l=>({u_matrix:new s.bJ(l),u_image0:new s.bN(l),u_skirt_height:new s.bM(l),u_ground_shadow_factor:new s.bL(l)}),skybox:l=>({u_matrix:new s.bJ(l),u_sun_direction:new s.bL(l),u_cubemap:new s.bN(l),u_opacity:new s.bM(l),u_temporal_offset:new s.bM(l)}),skyboxGradient:l=>({u_matrix:new s.bJ(l),u_color_ramp:new s.bN(l),u_center_direction:new s.bL(l),u_radius:new s.bM(l),u_opacity:new s.bM(l),u_temporal_offset:new s.bM(l)}),skyboxCapture:l=>({u_matrix_3f:new s.cA(l),u_sun_direction:new s.bL(l),u_sun_intensity:new s.bM(l),u_color_tint_r:new s.ca(l),u_color_tint_m:new s.ca(l),u_luminance:new s.bM(l)}),globeRaster:l=>({u_proj_matrix:new s.bJ(l),u_globe_matrix:new s.bJ(l),u_normalize_matrix:new s.bJ(l),u_merc_matrix:new s.bJ(l),u_zoom_transition:new s.bM(l),u_merc_center:new s.bK(l),u_image0:new s.bN(l),u_grid_matrix:new s.cA(l),u_skirt_height:new s.bM(l),u_far_z_cutoff:new s.bM(l),u_frustum_tl:new s.bL(l),u_frustum_tr:new s.bL(l),u_frustum_br:new s.bL(l),u_frustum_bl:new s.bL(l),u_globe_pos:new s.bL(l),u_globe_radius:new s.bM(l),u_viewport:new s.bK(l)}),globeAtmosphere:l=>({u_frustum_tl:new s.bL(l),u_frustum_tr:new s.bL(l),u_frustum_br:new s.bL(l),u_frustum_bl:new s.bL(l),u_horizon:new s.bM(l),u_transition:new s.bM(l),u_fadeout_range:new s.bM(l),u_color:new s.ca(l),u_high_color:new s.ca(l),u_space_color:new s.ca(l),u_temporal_offset:new s.bM(l),u_horizon_angle:new s.bM(l)}),model:l=>({u_matrix:new s.bJ(l),u_lighting_matrix:new s.bJ(l),u_normal_matrix:new s.bJ(l),u_node_matrix:new s.bJ(l),u_lightpos:new s.bL(l),u_lightintensity:new s.bM(l),u_lightcolor:new s.bL(l),u_camera_pos:new s.bL(l),u_opacity:new s.bM(l),u_baseColorFactor:new s.ca(l),u_emissiveFactor:new s.ca(l),u_metallicFactor:new s.bM(l),u_roughnessFactor:new s.bM(l),u_baseTextureIsAlpha:new s.bN(l),u_alphaMask:new s.bN(l),u_alphaCutoff:new s.bM(l),u_baseColorTexture:new s.bN(l),u_metallicRoughnessTexture:new s.bN(l),u_normalTexture:new s.bN(l),u_occlusionTexture:new s.bN(l),u_emissionTexture:new s.bN(l),u_lutTexture:new s.bN(l),u_color_mix:new s.ca(l),u_aoIntensity:new s.bM(l),u_emissive_strength:new s.bM(l),u_occlusionTextureTransform:new s.ca(l)}),modelDepth:l=>({u_matrix:new s.bJ(l),u_instance:new s.bJ(l),u_node_matrix:new s.bJ(l)}),groundShadow:l=>({u_matrix:new s.bJ(l),u_ground_shadow_factor:new s.bL(l)}),stars:l=>({u_matrix:new s.bJ(l),u_up:new s.bL(l),u_right:new s.bL(l),u_intensity_multiplier:new s.bM(l)}),snowParticle:l=>({u_modelview:new s.bJ(l),u_projection:new s.bJ(l),u_time:new s.bM(l),u_cam_pos:new s.bL(l),u_velocityConeAperture:new s.bM(l),u_velocity:new s.bM(l),u_horizontalOscillationRadius:new s.bM(l),u_horizontalOscillationRate:new s.bM(l),u_boxSize:new s.bM(l),u_billboardSize:new s.bM(l),u_simpleShapeParameters:new s.bK(l),u_screenSize:new s.bK(l),u_thinningCenterPos:new s.bK(l),u_thinningShape:new s.bL(l),u_thinningAffectedRatio:new s.bM(l),u_thinningParticleOffset:new s.bM(l),u_particleColor:new s.ca(l),u_direction:new s.bL(l)}),rainParticle:l=>({u_modelview:new s.bJ(l),u_projection:new s.bJ(l),u_time:new s.bM(l),u_cam_pos:new s.bL(l),u_texScreen:new s.bN(l),u_velocityConeAperture:new s.bM(l),u_velocity:new s.bM(l),u_boxSize:new s.bM(l),u_rainDropletSize:new s.bK(l),u_distortionStrength:new s.bM(l),u_rainDirection:new s.bL(l),u_color:new s.ca(l),u_screenSize:new s.bK(l),u_thinningCenterPos:new s.bK(l),u_thinningShape:new s.bL(l),u_thinningAffectedRatio:new s.bM(l),u_thinningParticleOffset:new s.bM(l),u_shapeDirectionalPower:new s.bM(l),u_shapeNormalPower:new s.bM(l),u_mode:new s.bM(l)}),vignette:l=>({u_vignetteShape:new s.bL(l),u_vignetteColor:new s.ca(l)}),occlusion:l=>({u_matrix:new s.bJ(l),u_anchorPos:new s.bL(l),u_screenSizePx:new s.bK(l),u_occluderSizePx:new s.bK(l),u_color:new s.ca(l)})};class ml{constructor(t,n,u,p){this.id=ml.uniqueIdxCounter,ml.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||p||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=ml.uniqueIdxCounter,ml.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ml.uniqueIdxCounter=0;const Ta={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xl{constructor(t,n,u,p,g,x){this.length=n.length,this.attributes=u,this.itemSize=n.bytesPerElement,this.dynamicDraw=p,this.instanceCount=x,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||g||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let u=0;u<this.attributes.length;u++){const p=n.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,n,u){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],x=n.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[Ta[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,n,u){for(let p=0;p<this.attributes.length;p++){const g=n.attributes[this.attributes[p].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class dh{constructor(t,n,u,p,g){this.context=t,this.width=n,this.height=u;const x=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new Je(t,x)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new ri(t,x):new In(t,x))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class fh{constructor(t,n){this.gl=t,this.clearColor=new cl(this),this.clearDepth=new nu(this),this.clearStencil=new Ka(this),this.colorMask=new xu(this),this.depthMask=new ql(this),this.stencilMask=new Al(this),this.stencilFunc=new ru(this),this.stencilOp=new Cl(this),this.stencilTest=new Ja(this),this.depthRange=new bu(this),this.depthTest=new ia(this),this.depthFunc=new su(this),this.blend=new hl(this),this.blendFunc=new ou(this),this.blendColor=new dl(this),this.blendEquation=new wu(this),this.cullFace=new Pl(this),this.cullFaceSide=new Eu(this),this.frontFace=new Ea(this),this.program=new Hl(this),this.activeTexture=new au(this),this.viewport=new Tu(this),this.bindFramebuffer=new qa(this),this.bindRenderbuffer=new lu(this),this.bindTexture=new Qa(this),this.bindVertexBuffer=new Su(this),this.bindElementBuffer=new Yu(this),this.bindVertexArrayOES=new Ku(this),this.pixelStoreUnpack=new Iu(this),this.pixelStoreUnpackPremultiplyAlpha=new fl(this),this.pixelStoreUnpackFlipY=new Zl(this),this.options=n?Object.assign({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,u){return new ml(this,t,n,u)}createVertexBuffer(t,n,u,p,g){return new Xl(this,t,n,u,p,g)}createRenderbuffer(t,n,u){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,n,u),this.bindRenderbuffer.set(null),g}createFramebuffer(t,n,u,p){return new dh(this,t,n,u,p)}clear({color:t,depth:n,stencil:u,colorMask:p}){const g=this.gl;let x=0;t&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(p||[!0,!0,!0,!0])),n!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),u!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),g.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bn(t.blendFunction,cr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Mu;function Ac(l,t,n,u,p,g,x){const S=l.context,C=S.gl,L=l.transform,R=l.getOrCreateProgram("collisionBox"),z=[];let N=0,V=0;for(let ve=0;ve<u.length;ve++){const ze=u[ve],Ae=t.getTile(ze),Le=Ae.getBucket(n);if(!Le)continue;const Me=On(ze,Le,L);let He=Me;p[0]===0&&p[1]===0||(He=l.translatePosMatrix(Me,Ae,p,g));const tt=x?Le.textCollisionBox:Le.iconCollisionBox,Ft=Le.collisionCircleArray;if(Ft.length>0){const Mt=s.ab.mat4.create(),ai=He;s.ab.mat4.mul(Mt,Le.placementInvProjMatrix,L.glCoordMatrix),s.ab.mat4.mul(Mt,Mt,Le.placementViewportMatrix),z.push({circleArray:Ft,circleOffset:V,transform:ai,invTransform:Mt,projection:Le.getProjection()}),N+=Ft.length/4,V=N}tt&&(l.terrain&&l.terrain.setupElevationDraw(Ae,R),R.draw(l,C.LINES,Ln.disabled,ar.disabled,l.colorModeForRenderPass(),Qn.disabled,Do(He,L,Ae,Le.getProjection()),n.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,null,L.zoom,null,[tt.collisionVertexBuffer,tt.collisionVertexBufferExt]))}if(!x||!z.length)return;const J=l.getOrCreateProgram("collisionCircle"),X=new s.cV;X.resize(4*N),X._trim();let ie=0;for(const ve of z)for(let ze=0;ze<ve.circleArray.length/4;ze++){const Ae=4*ze,Le=ve.circleArray[Ae+0],Me=ve.circleArray[Ae+1],He=ve.circleArray[Ae+2],tt=ve.circleArray[Ae+3];X.emplace(ie++,Le,Me,He,tt,0),X.emplace(ie++,Le,Me,He,tt,1),X.emplace(ie++,Le,Me,He,tt,2),X.emplace(ie++,Le,Me,He,tt,3)}(!Mu||Mu.length<2*N)&&(Mu=function(ve){const ze=2*ve,Ae=new s.aU;Ae.resize(ze),Ae._trim();for(let Le=0;Le<ze;Le++){const Me=6*Le;Ae.uint16[Me+0]=4*Le+0,Ae.uint16[Me+1]=4*Le+1,Ae.uint16[Me+2]=4*Le+2,Ae.uint16[Me+3]=4*Le+2,Ae.uint16[Me+4]=4*Le+3,Ae.uint16[Me+5]=4*Le+0}return Ae}(N));const te=S.createIndexBuffer(Mu,!0),le=S.createVertexBuffer(X,s.cW.members,!0);for(const ve of z){const ze={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(we=L).getCameraToCenterDistance(ve.projection),u_viewport_size:[we.width,we.height]};J.draw(l,C.TRIANGLES,Ln.disabled,ar.disabled,l.colorModeForRenderPass(),Qn.disabled,ze,n.id,le,te,s.b7.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,L.zoom)}var we;le.destroy(),te.destroy()}const Qu=s.ab.mat4.create();function za(l){const t=l._camera.getWorldToCamera(l.worldSize,1),n=s.ab.mat4.multiply([],t,l.globeMatrix);s.ab.mat4.invert(n,n);const u=[0,0,0],p=[0,1,0,0];return s.ab.vec4.transformMat4(p,p,n),u[0]=p[0],u[1]=p[1],u[2]=p[2],s.ab.vec3.normalize(u,u),u}function Ws({width:l,height:t,anchor:n,textOffset:u,textScale:p},g){const{horizontalAlign:x,verticalAlign:S}=s.bD(n),C=-(x-.5)*l,L=-(S-.5)*t,R=s.bC(n,u);return new s.P((C/p+R[0])*g,(L/p+R[1])*g)}function Cc(l,t,n,u,p,g,x,S,C,L,R){const z=l.text.placedSymbolArray,N=l.text.dynamicLayoutVertexArray,V=l.icon.dynamicLayoutVertexArray,J={},X=l.getProjection(),ie=An(S,X,g),te=g.elevation,le=X.upVectorScale(S.canonical,g.center.lat,g.worldSize).metersToTile;N.clear();for(let we=0;we<z.length;we++){const ve=z.get(we),{tileAnchorX:ze,tileAnchorY:Ae,numGlyphs:Le}=ve,Me=ve.hidden||!ve.crossTileID||l.allowVerticalPlacement&&!ve.placedOrientation?null:u[ve.crossTileID];if(Me){let He=0,tt=0,Ft=0;if(te){const Gt=te?te.getAtTileOffset(S,ze,Ae):0,[fn,Ri,di]=X.upVector(S.canonical,ze,Ae);He=Gt*fn*le,tt=Gt*Ri*le,Ft=Gt*di*le}let[Mt,ai,ei,yt]=At(ve.projectedAnchorX+He,ve.projectedAnchorY+tt,ve.projectedAnchorZ+Ft,n?ie:x);const Ut=kt(g.getCameraToCenterDistance(X),yt);let Ui=p.evaluateSizeForFeature(l.textSizeData,L,ve)*Ut/s.bw;n&&(Ui*=l.tilePixelRatio/C);const _t=Ws(Me,Ui);n?({x:Mt,y:ai,z:ei}=X.projectTilePoint(ze+_t.x,Ae+_t.y,S.canonical),[Mt,ai,ei]=At(Mt+He,ai+tt,ei+Ft,x)):(t&&_t._rotate(-g.angle),Mt+=_t.x,ai+=_t.y,ei=0);const _i=l.allowVerticalPlacement&&ve.placedOrientation===s.bq.vertical?Math.PI/2:0;for(let Gt=0;Gt<Le;Gt++)s.bt(N,Mt,ai,ei,_i);R&&ve.associatedIconIndex>=0&&(J[ve.associatedIconIndex]={x:Mt,y:ai,z:ei,angle:_i})}else Di(Le,N)}if(R){V.clear();const we=l.icon.placedSymbolArray;for(let ve=0;ve<we.length;ve++){const ze=we.get(ve),{numGlyphs:Ae}=ze,Le=J[ve];if(ze.hidden||!Le)Di(Ae,V);else{const{x:Me,y:He,z:tt,angle:Ft}=Le;for(let Mt=0;Mt<Ae;Mt++)s.bt(V,Me,He,tt,Ft)}}l.icon.dynamicLayoutVertexBuffer.updateData(V)}l.text.dynamicLayoutVertexBuffer.updateData(N)}function ec(l,t,n,u,p,g,x={}){const S=n.paint.get("icon-translate"),C=n.paint.get("text-translate"),L=n.paint.get("icon-translate-anchor"),R=n.paint.get("text-translate-anchor"),z=n.layout.get("icon-rotation-alignment"),N=n.layout.get("text-rotation-alignment"),V=n.layout.get("icon-pitch-alignment"),J=n.layout.get("text-pitch-alignment"),X=n.layout.get("icon-keep-upright"),ie=n.layout.get("text-keep-upright"),te=n.paint.get("icon-color-saturation"),le=n.paint.get("icon-color-contrast"),we=n.paint.get("icon-color-brightness-min"),ve=n.paint.get("icon-color-brightness-max"),ze=n.layout.get("symbol-elevation-reference")==="sea",Ae=l.context,Le=Ae.gl,Me=l.transform,He=z==="map",tt=N==="map",Ft=V==="map",Mt=J==="map",ai=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ei=!1;const yt=l.depthModeForSublayer(0,Ln.ReadOnly),Ut=[s.at(Me.center.lng),s.aA(Me.center.lat)],Ui=n.layout.get("text-variable-anchor"),_t=Me.projection.name==="globe",_i=[],Gt=[0,-1,0];for(const fn of u){const Ri=t.getTile(fn),di=Ri.getBucket(n);if(!di||di.projection.name==="mercator"&&_t||di.fullyClipped)continue;const $i=di.projection.name==="globe",dn=$i?s.ae(Me.zoom):0,Cn=An(fn,di.getProjection(),Me),zn=Me.calculatePixelsToTileUnitsMatrix(Ri),xr=Ui&&di.hasTextData(),sr=di.hasIconTextFit()&&xr&&di.hasIconData(),lr=di.getProjection().createInversionMatrix(Me,fn.canonical),Tr=ps=>{Me.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||l.terrain)&&(ps.push("DEPTH_D24"),ps.push("DEPTH_OCCLUSION"))},Yr=()=>{const ps=He&&n.layout.get("symbol-placement")!=="point",_s=[];Tr(_s);const so=ps||sr,Xo=n.paint.get("icon-image-cross-fade").constantOr(0);l.terrainRenderModeElevated()&&Ft&&_s.push("PITCH_WITH_MAP_TERRAIN"),$i&&(_s.push("PROJECTION_GLOBE_VIEW"),so&&_s.push("PROJECTED_POS_ON_VIEWPORT")),Xo>0&&_s.push("ICON_TRANSITION"),di.icon.zOffsetVertexBuffer&&_s.push("Z_OFFSET"),te===0&&le===0&&we===0&&ve===1||_s.push("COLOR_ADJUSTMENT"),di.sdfIcons&&_s.push("RENDER_SDF");const Fo=di.icon.programConfigurations.get(n.id),Bo=l.getOrCreateProgram("symbol",{config:Fo,defines:_s}),Ba=Ri.imageAtlasTexture?Ri.imageAtlasTexture.size:[0,0],ha=di.iconSizeData,oo=s.bp(ha,Me.zoom),js=Ft||Me.pitch!==0,Fs=pt(Cn,Ri.tileID.canonical,Ft,He,Me,di.getProjection(),zn),Kr=zt(Cn,Ri.tileID.canonical,Ft,He,Me,di.getProjection(),zn),Io=l.translatePosMatrix(Kr,Ri,S,L,!0),$o=l.translatePosMatrix(Cn,Ri,S,L),Us=so?Qu:Fs,da=He&&!Ft&&!ps;let Za=Gt;!_t&&!Me.mercatorFromTransition||He||(Za=za(Me));const Ma=$i?Za:Gt,ba=n.getColorAdjustmentMatrix(te,le,we,ve),bl=pl(ha.kind,oo,da,Ft,l,$o,Us,Io,ze,!1,Ba,[0,0],!0,fn,dn,Ut,lr,Ma,di.getProjection(),ba,Xo),Xa=Ri.imageAtlasTexture?Ri.imageAtlasTexture:null,Ua=n.layout.get("icon-size").constantOr(0)!==1||di.iconsNeedLinear,gu=di.sdfIcons||l.options.rotating||l.options.zooming||Ua||js?Le.LINEAR:Le.NEAREST,wl=di.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,_u=l.terrain&&Ft&&ps?s.ab.mat4.invert(s.ab.mat4.create(),Fs):Qu;if(ps&&di.icon){const Uu=Me.elevation,Hc=Uu?Uu.getAtTileOffsetFunc(fn,Me.center.lat,Me.worldSize,di.getProjection()):null,zh=St(Cn,Ri.tileID.canonical,Ft,He,Me,di.getProjection(),zn);Ke(di,Cn,l,!1,zh,Kr,Ft,X,Hc,fn)}return{program:Bo,buffers:di.icon,uniformValues:bl,atlasTexture:Xa,atlasTextureIcon:null,atlasInterpolation:gu,atlasInterpolationIcon:null,isSDF:di.sdfIcons,hasHalo:wl,tile:Ri,labelPlaneMatrixInv:_u}},As=()=>{const ps=tt&&n.layout.get("symbol-placement")!=="point",_s=[],so=ps||Ui||sr;l.terrainRenderModeElevated()&&Mt&&_s.push("PITCH_WITH_MAP_TERRAIN"),$i&&(_s.push("PROJECTION_GLOBE_VIEW"),so&&_s.push("PROJECTED_POS_ON_VIEWPORT")),di.text.zOffsetVertexBuffer&&_s.push("Z_OFFSET"),di.iconsInText&&_s.push("RENDER_TEXT_AND_SYMBOL"),_s.push("RENDER_SDF"),Tr(_s);const Xo=di.text.programConfigurations.get(n.id),Fo=l.getOrCreateProgram("symbol",{config:Xo,defines:_s});let Bo,Ba=[0,0],ha=null;const oo=di.textSizeData;di.iconsInText&&(Ba=Ri.imageAtlasTexture?Ri.imageAtlasTexture.size:[0,0],ha=Ri.imageAtlasTexture?Ri.imageAtlasTexture:null,Bo=Mt||Me.pitch!==0||l.options.rotating||l.options.zooming||oo.kind==="composite"||oo.kind==="camera"?Le.LINEAR:Le.NEAREST);const js=Ri.glyphAtlasTexture?Ri.glyphAtlasTexture.size:[0,0],Fs=n.layout.get("text-size-scale-range"),Kr=s.aw(l.scaleFactor,Fs[0],Fs[1]),Io=s.bp(oo,Me.zoom,Kr),$o=pt(Cn,Ri.tileID.canonical,Mt,tt,Me,di.getProjection(),zn),Us=zt(Cn,Ri.tileID.canonical,Mt,tt,Me,di.getProjection(),zn),da=l.translatePosMatrix(Us,Ri,C,R,!0),Za=l.translatePosMatrix(Cn,Ri,C,R),Ma=so?Qu:$o,ba=tt&&!Mt&&!ps;let bl=Gt;!_t&&!Me.mercatorFromTransition||tt||(bl=za(Me));const Xa=pl(oo.kind,Io,ba,Mt,l,Za,Ma,da,ze,!0,js,Ba,!0,fn,dn,Ut,lr,$i?bl:Gt,di.getProjection(),null,null,Kr),Ua=Ri.glyphAtlasTexture?Ri.glyphAtlasTexture:null,gu=Le.LINEAR,wl=n.paint.get("text-halo-width").constantOr(1)!==0,_u=l.terrain&&Mt&&ps?s.ab.mat4.invert(s.ab.mat4.create(),$o):Qu;if(ps&&di.text){const Uu=Me.elevation,Hc=Uu?Uu.getAtTileOffsetFunc(fn,Me.center.lat,Me.worldSize,di.getProjection()):null,zh=St(Cn,Ri.tileID.canonical,Mt,tt,Me,di.getProjection(),zn);Ke(di,Cn,l,!0,zh,Us,Mt,ie,Hc,fn)}return{program:Fo,buffers:di.text,uniformValues:Xa,atlasTexture:Ua,atlasTextureIcon:ha,atlasInterpolation:gu,atlasInterpolationIcon:Bo,isSDF:!0,hasHalo:wl,tile:Ri,labelPlaneMatrixInv:_u}},ho=di.icon.segments.get().length,Ks=di.text.segments.get().length,Rr=ho&&!x.onlyText?Yr():null,ns=Ks&&!x.onlyIcons?As():null,Wn=n.paint.get("icon-opacity").constantOr(1),$r=n.paint.get("text-opacity").constantOr(1);if(ai&&di.canOverlap){ei=!0;const ps=Wn&&!x.onlyText?di.icon.segments.get():[],_s=$r&&!x.onlyIcons?di.text.segments.get():[];for(const so of ps)_i.push({segments:new s.b7([so]),sortKey:so.sortKey,state:Rr});for(const so of _s)_i.push({segments:new s.b7([so]),sortKey:so.sortKey,state:ns})}else x.onlyText||_i.push({segments:Wn?di.icon.segments:new s.b7([]),sortKey:0,state:Rr}),x.onlyIcons||_i.push({segments:$r?di.text.segments:new s.b7([]),sortKey:0,state:ns})}ei&&_i.sort((fn,Ri)=>fn.sortKey-Ri.sortKey);for(const fn of _i){const Ri=fn.state;if(Ri)if(l.terrain?l.terrain.setupElevationDraw(Ri.tile,Ri.program,{useDepthForOcclusion:Me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ri.labelPlaneMatrixInv}):l.setupDepthForOcclusion(Me.depthOcclusionForSymbolsAndCircles,Ri.program),Ae.activeTexture.set(Le.TEXTURE0),Ri.atlasTexture&&Ri.atlasTexture.bind(Ri.atlasInterpolation,Le.CLAMP_TO_EDGE,!0),Ri.atlasTextureIcon&&(Ae.activeTexture.set(Le.TEXTURE1),Ri.atlasTextureIcon&&Ri.atlasTextureIcon.bind(Ri.atlasInterpolationIcon,Le.CLAMP_TO_EDGE,!0)),l.uploadCommonLightUniforms(l.context,Ri.program),Ri.hasHalo){const di=Ri.uniformValues;di.u_is_halo=1,Pc(Ri.buffers,fn.segments,n,l,Ri.program,yt,p,g,di,2),di.u_is_halo=0}else{if(Ri.isSDF){const di=Ri.uniformValues;Ri.hasHalo&&(di.u_is_halo=1,Pc(Ri.buffers,fn.segments,n,l,Ri.program,yt,p,g,di,1)),di.u_is_halo=0}Pc(Ri.buffers,fn.segments,n,l,Ri.program,yt,p,g,Ri.uniformValues,1)}}}function Pc(l,t,n,u,p,g,x,S,C,L){const R=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,g,x,S,Qn.disabled,C,n.id,l.layoutVertexBuffer,l.indexBuffer,t,n.paint,u.transform.zoom,l.programConfigurations.get(n.id),R,L)}function ph(l,t,n,u,p,g,x){const S=l.context.gl,C=n.paint.get("fill-pattern"),L=n.is3D(),R=L?l.stencilModeFor3D():ar.disabled,z=C&&C.constantOr(1);let N,V,J,X,ie;x?(V=z&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=S.LINES):(V=z?"fillPattern":"fill",N=S.TRIANGLES);for(const te of u){const le=t.getTile(te);if(z&&!le.patternsLoaded())continue;const we=le.getBucket(n);if(!we)continue;l.prepareDrawTile();const ve=we.programConfigurations.get(n.id),ze=l.isTileAffectedByFog(te),Ae=l.getOrCreateProgram(V,{config:ve,overrideFog:ze});z&&(l.context.activeTexture.set(S.TEXTURE0),le.imageAtlasTexture&&le.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ve.updatePaintBuffers());const Le=C.constantOr(null);if(Le&&le.imageAtlas){const tt=le.imageAtlas,Ft=s.A.from(Le).getPrimary().scaleSelf(s.q.devicePixelRatio).serialize(),Mt=tt.patternPositions[Ft];Mt&&ve.setConstantPatternPositions(Mt)}const Me=l.translatePosMatrix(te.projMatrix,le,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),He=n.paint.get("fill-emissive-strength");if(x){X=we.indexBuffer2,ie=we.segments2;const tt=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];J=V==="fillOutlinePattern"&&z?co(Me,He,l,le,tt):To(Me,He,tt)}else X=we.indexBuffer,ie=we.segments,J=z?is(Me,He,l,le):us(Me,He);l.uploadCommonUniforms(l.context,Ae,te.toUnwrapped()),Ae.draw(l,N,p,L?R:l.stencilModeForClipping(te),g,Qn.disabled,J,n.id,we.layoutVertexBuffer,X,ie,n.paint,l.transform.zoom,ve,void 0)}}function tc(l,t,n,u,p,g,x,S){n.resetLayerRenderingStats(l);const C=l.context,L=C.gl,R=l.transform,z=n.paint.get("fill-extrusion-pattern"),N=z.constantOr(1),V=n.paint.get("fill-extrusion-opacity"),J=l.style.enable3dLights(),X=n.paint.get(J&&!N?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],te=n.layout.get("fill-extrusion-edge-radius"),le=te>0&&!n.paint.get("fill-extrusion-rounded-roof"),we=le?0:te,ve=R.projection.name==="globe"?s.d3():0,ze=R.projection.name==="globe",Ae=ze?s.ae(R.zoom):0,Le=[s.at(R.center.lng),s.aA(R.center.lat)],Me=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",He=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(Me?null:n.lut).toArray01().slice(0,3),tt=n.paint.get("fill-extrusion-flood-light-intensity"),Ft=n.paint.get("fill-extrusion-vertical-scale"),Mt=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ai=n.paint.get("fill-extrusion-height-alignment"),ei=n.paint.get("fill-extrusion-base-alignment"),yt=La(l,n.paint.get("fill-extrusion-cutoff-fade-range")),Ut=[];let Ui;ze&&Ut.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&Ut.push("FAUX_AO"),le&&Ut.push("ZERO_ROOF_RADIUS"),S&&Ut.push("HAS_CENTROID"),tt>0&&Ut.push("FLOOD_LIGHT"),yt.shouldRenderCutoff&&Ut.push("RENDER_CUTOFF"),Mt&&Ut.push("RENDER_WALL_MODE");const _t=l.renderPass==="shadow",_i=l.shadowRenderer,Gt=_t&&!!_i;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let fn=[0,0,0];if(_i){const $i=l.style.directionalLight,dn=l.style.ambientLight;$i&&dn&&(fn=Ns(l.style,$i,dn)),_t||(Ut.push("RENDER_SHADOWS","DEPTH_TEXTURE"),_i.useNormalOffset&&Ut.push("NORMAL_OFFSET")),Ui=Ut.concat(["SHADOWS_SINGLE_CASCADE"])}const Ri=Gt?"fillExtrusionDepth":N?"fillExtrusionPattern":"fillExtrusion",di=n.getLayerRenderingStats();for(const $i of u){const dn=t.getTile($i),Cn=dn.getBucket(n);if(!Cn||Cn.projection.name!==R.projection.name)continue;let zn=!1;_i&&(zn=_i.getMaxCascadeForTile($i.toUnwrapped())===0);const xr=l.isTileAffectedByFog($i),sr=Cn.programConfigurations.get(n.id),lr=l.getOrCreateProgram(Ri,{config:sr,defines:zn?Ui:Ut,overrideFog:xr});if(l.terrain&&l.terrain.setupElevationDraw(dn,lr,{useMeterToDem:!0}),!Cn.centroidVertexBuffer){const ns=lr.attributes.a_centroid_pos;ns!==void 0&&L.vertexAttrib2f(ns,0,0)}!_t&&_i&&_i.setupShadows(dn.tileID.toUnwrapped(),lr,"vector-tile",dn.tileID.overscaledZ),N&&(l.context.activeTexture.set(L.TEXTURE0),dn.imageAtlasTexture&&dn.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),sr.updatePaintBuffers());const Tr=z.constantOr(null);if(Tr&&dn.imageAtlas){const ns=dn.imageAtlas,Wn=s.A.from(Tr).getPrimary().scaleSelf(s.q.devicePixelRatio),$r=ns.patternPositions[Wn.serialize()];$r&&sr.setConstantPatternPositions($r)}const Yr=n.paint.get("fill-extrusion-vertical-gradient"),As=1/Cn.tileToMeter;let ho;if(_t&&_i){if(Lu(dn.tileID,Cn,l))continue;const ns=_i.calculateShadowPassMatrixFromTile(dn.tileID.toUnwrapped());ho=Vr(ns,we,As,Ft,ai,ei)}else{const ns=l.translatePosMatrix($i.expandedProjMatrix,dn,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Wn=R.projection.createInversionMatrix(R,$i.canonical);ho=N?fs(ns,l,Yr,V,ie,we,As,$i,dn,ve,ai,ei,Ae,Le,Wn,He,Ft):Zs(ns,l,Yr,V,ie,we,As,$i,ve,ai,ei,Ae,Le,Wn,He,Ft,tt,fn)}l.uploadCommonUniforms(C,lr,$i.toUnwrapped(),null,yt);let Ks=Cn.segments;if(R.projection.name==="mercator"&&!_t&&(Ks=Cn.getVisibleSegments(dn.tileID,l.terrain,l.transform.getFrustum(0)),!Ks.get().length))continue;if(di)if(_t)for(const ns of Ks.get())di.numRenderedVerticesInShadowPass+=ns.primitiveLength;else for(const ns of Ks.get())di.numRenderedVerticesInTransparentPass+=ns.primitiveLength;const Rr=[];(l.terrain||S)&&Rr.push(Cn.centroidVertexBuffer),ze&&Rr.push(Cn.layoutVertexExtBuffer),Mt&&Rr.push(Cn.wallVertexBuffer),lr.draw(l,C.gl.TRIANGLES,p,g,x,Qn.backCCW,ho,n.id,Cn.layoutVertexBuffer,Cn.indexBuffer,Ks,n.paint,l.transform.zoom,sr,Rr)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}function Au(l,t,n,u,p,g,x,S,C,L,R,z,N,V,J,X,ie,te,le){const we=l.context,ve=we.gl,ze=l.transform,Ae=l.transform.zoom,Le=[],Me=La(l,n.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(Le.push("CLEAR_SUBPASS"),le&&(Le.push("CLEAR_FROM_TEXTURE"),we.activeTexture.set(ve.TEXTURE0),le.bind(ve.LINEAR,ve.CLAMP_TO_EDGE))):L==="sdf"&&Le.push("SDF_SUBPASS"),ie&&Le.push("HAS_CENTROID"),Me.shouldRenderCutoff&&Le.push("RENDER_CUTOFF");const He=n.layout.get("fill-extrusion-edge-radius"),tt=(Ft,Mt,ai,ei,yt)=>{const Ut=Mt.programConfigurations.get(n.id),Ui=l.isTileAffectedByFog(Ft),_t=l.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ut,defines:Le,overrideFog:Ui}),_i=((fn,Ri,di,$i,dn,Cn,zn,xr,sr,lr,Tr)=>({u_matrix:Ri,u_opacity:di,u_ao_pass:$i?1:0,u_meter_to_tile:dn,u_ao:Cn,u_flood_light_intensity:zn,u_flood_light_color:xr,u_attenuation:sr,u_edge_radius:lr,u_fb:0,u_fb_size:Tr,u_dynamic_offset:1}))(0,ei,R,C,yt,[z,N*yt],V,J,X,Ae>=17?0:He*yt,le?le.size[0]:0),Gt=[];ie&&Gt.push(Mt.hiddenByLandmarkVertexBuffer),l.uploadCommonUniforms(we,_t,Ft.toUnwrapped(),null,Me),_t.draw(l,we.gl.TRIANGLES,p,g,x,S,_i,n.id,Mt.vertexBuffer,Mt.indexBuffer,ai,n.paint,Ae,Ut,Gt)};for(const Ft of u){const Mt=t.getTile(Ft),ai=Mt.getBucket(n);if(!ai||ai.projection.name!==ze.projection.name||!ai.groundEffect||ai.groundEffect&&!ai.groundEffect.hasData())continue;const ei=ai.groundEffect,yt=1/ai.tileToMeter;{const Ut=l.translatePosMatrix(Ft.projMatrix,Mt,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Ui=ei.getDefaultSegment();tt(Ft,ei,Ui,Ut,yt)}if(te)for(let Ut=0;Ut<4;Ut++){const Ui=s.d4[Ut](Ft),_t=t.getTile(Ui);if(!_t)continue;const _i=_t.getBucket(n);if(!_i||_i.projection.name!==ze.projection.name||!_i.groundEffect||_i.groundEffect&&!_i.groundEffect.hasData())continue;const Gt=_i.groundEffect;let fn,Ri;Ut===0?(fn=[-s.ag,0,0],Ri=1):Ut===1?(fn=[s.ag,0,0],Ri=0):Ut===2?(fn=[0,-s.ag,0],Ri=3):(fn=[0,s.ag,0],Ri=2);const di=Gt.regionSegments[Ri];if(!di)continue;const $i=new Float32Array(16);s.ab.mat4.translate($i,Ft.projMatrix,fn),tt(Ft,Gt,di,l.translatePosMatrix($i,Mt,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),yt)}}}function Cu(l,t,n,u,p,g,x){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const S=g?g.findDEMTileFor(n):null;if(!(S&&S.dem||x))return;g&&S&&S.dem&&u.selfDEMTileTimestamp!==S.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=S.dem._timestamp);const C=te=>new s.P(Math.ceil((te+s.d7)*s.d8),0),L=te=>{const le=t.getSource().minzoom,we=ze=>{const Ae=t.getTileByID(ze);if(Ae&&Ae.hasData())return Ae.getBucket(p)},ve=[0,-1,1];for(const ze of ve){if(te.overscaledZ+ze<le)continue;const Ae=we(te.calculateScaledKey(te.overscaledZ+ze));if(Ae)return Ae}},R=[0,0,0],z=(te,le)=>(R[0]=Math.min(te.min.y,le.min.y),R[1]=Math.max(te.max.y,le.max.y),R[2]=s.ag-le.min.x>te.max.x?le.min.x-s.ag:te.max.x,R),N=(te,le)=>(R[0]=Math.min(te.min.x,le.min.x),R[1]=Math.max(te.max.x,le.max.x),R[2]=s.ag-le.min.y>te.max.y?le.min.y-s.ag:te.max.y,R),V=[(te,le)=>z(te,le),(te,le)=>z(le,te),(te,le)=>N(te,le),(te,le)=>N(le,te)],J=(te,le,we,ve,ze,Ae,Le)=>{if(!g)return 0;const Me=[[Ae?we:te,Ae?te:we,0],[Ae?we:le,Ae?le:we,0]],He=Le<0?s.ag+Le:Le,tt=[Ae?He:(te+le)/2,Ae?(te+le)/2:He,0];return we===0&&Le<0||we!==0&&Le>0?g.getForTilePoints(ze,[tt],!0,ve):Me.push(tt),g.getForTilePoints(n,Me,!0,S),Math.max(Me[0][2],Me[1][2],tt[2])/g.exaggeration()};for(let te=0;te<4;te++){const le=u.borderFeatureIndices[te];if(le.length===0)continue;const we=s.d4[te](n),ve=L(we);if(!(ve&&ve instanceof s.d5))continue;const ze=g?g.findDEMTileFor(we):null;if(!(ze&&ze.dem||x)||(g&&ze&&ze.dem&&u.borderDEMTileTimestamp[te]!==ze.dem._timestamp&&(u.borderDoneWithNeighborZ[te]=-1,u.borderDEMTileTimestamp[te]=ze.dem._timestamp),u.borderDoneWithNeighborZ[te]===ve.canonical.z))continue;ve.centroidVertexArray.length===0&&ve.createCentroidsBuffer();const Ae=(te<2?1:5)-te,Le=ve.borderDoneWithNeighborZ[Ae]!==u.canonical.z,Me=ve.borderFeatureIndices[Ae];let He=0;if(u.canonical.z!==ve.canonical.z){for(const tt of le)u.showCentroid(u.featuresOnBorder[tt]);if(Le)for(const tt of Me)ve.showCentroid(ve.featuresOnBorder[tt]);u.borderDoneWithNeighborZ[te]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ae]=u.canonical.z}for(const tt of le){const Ft=u.featuresOnBorder[tt],Mt=u.centroidData[Ft.centroidDataIndex],ai=Ft.borders[te];let ei;for(;He<Me.length;){ei=ve.featuresOnBorder[Me[He]];const yt=ei.borders[Ae];if(yt[1]>ai[0]+3||yt[0]>ai[0]-3)break;ve.showCentroid(ei),He++}if(ei&&He<Me.length){const yt=He;let Ut=0;for(;!(ei.borders[Ae][0]>ai[1]-3)&&(Ut++,++He!==Me.length);)ei=ve.featuresOnBorder[Me[He]];ei=ve.featuresOnBorder[Me[yt]];let Ui=!1;if(Ut>=1){const Gt=ei.borders[Ae];Math.abs(ai[0]-Gt[0])<3&&Math.abs(ai[1]-Gt[1])<3&&(Ut=1,Ui=!0,He=yt+1)}else if(Ut===0){u.showCentroid(Ft);continue}const _t=ve.centroidData[ei.centroidDataIndex];x&&Ui&&(((X=Mt).flags|(ie=_t).flags)&s.d6?(X.flags|=s.d6,ie.flags|=s.d6):(X.flags&=~s.d6,ie.flags&=~s.d6));const _i=Ft.intersectsCount()>1||ei.intersectsCount()>1;if(Ut>1)He=yt,Mt.centroidXY=_t.centroidXY=new s.P(0,0);else if(ze&&ze.dem&&!_i){const Gt=V[te](Mt,_t),fn=te%2?s.ag-1:0,Ri=J(Gt[0],Math.min(s.ag-1,Gt[1]),fn,ze,we,te<2,Gt[2]);Mt.centroidXY=_t.centroidXY=C(Ri)}else _i?Mt.centroidXY=_t.centroidXY=new s.P(0,0):(Mt.centroidXY=u.encodeBorderCentroid(Ft),_t.centroidXY=ve.encodeBorderCentroid(ei));u.writeCentroidToBuffer(Mt),ve.writeCentroidToBuffer(_t)}else u.showCentroid(Ft)}u.borderDoneWithNeighborZ[te]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ae]=u.canonical.z}var X,ie;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(l)}const Pu=[1,0,0],an=[0,1,0],Rn=[0,0,1];function Lu(l,t,n){const u=n.transform,p=n.shadowRenderer;if(!p)return!0;const g=l.toUnwrapped(),x=u.tileSize*p._cascades[n.currentShadowCascade].scale;let S=t.maxHeight;if(u.elevation){const X=u.elevation.getMinMaxForTile(l);X&&(S+=X.max)}const C=[...p.shadowDirection];C[2]=-C[2];const L=p.computeSimplifiedTileShadowVolume(g,S,x,C);if(!L)return!1;const R=[Pu,an,Rn,C,[C[0],0,C[2]],[0,C[1],C[2]]],z=u.projection.name==="globe",N=u.scaleZoom(x),V=s.bR.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,N,!z),J=p.getCurrentCascadeFrustum();return V.intersectsPrecise(L.vertices,L.planes,R)===0||J.intersectsPrecise(L.vertices,L.planes,R)===0}function ro(l){return[l[0]*s.d9,l[1]*s.d9,l[2]*s.d9,0]}function Ct(l,t,n,u,p,g,x,S,C){const L=u.getSource(),R=n.globeSharedBuffers;if(!R)return;let z,N,V;if(t&&(z=u.getTile(t)),L instanceof s.aJ?(N=L.texture,V=s.cI(0,0,n.transform)):z&&t&&(N=z.texture,V=s.cI(t.canonical.z,t.canonical.x,n.transform)),!N||!V)return;l||(V=s.ab.mat4.scale(s.ab.mat4.create(),V,[1,-1,1]));const J=n.context,X=J.gl,ie=p.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR,te=n.colorModeForDrapableLayerRenderPass(g),le=x.defines;le.push("GLOBE_POLES");const we=new Ln(X.LEQUAL,Ln.ReadWrite,n.depthRangeFor3D),ve=Float32Array.from(n.transform.expandedFarZProjMatrix),ze=Float32Array.from(s.bb(s.cH(new s.bT(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),J.activeTexture.set(X.TEXTURE0),N.bind(ie,X.CLAMP_TO_EDGE),J.activeTexture.set(X.TEXTURE1),N.bind(ie,X.CLAMP_TO_EDGE),N.useMipmap&&J.extTextureFilterAnisotropic&&n.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const[Ae,Le,Me,He]=t?R.getPoleBuffers(t.canonical.z,!1):R.getPoleBuffers(0,!0),tt=p.paint.get("raster-elevation");let Ft;l?(Ft=Ae,n.renderDefaultNorthPole=tt!==0):(Ft=Le,n.renderDefaultSouthPole=tt!==0);const Mt=ro(x.mix),ai=((yt,Ut,Ui,_t,_i,Gt,fn,Ri,di,$i,dn,Cn,zn)=>No(yt,Ut,Ui,new Float32Array(16),new Float32Array(9),[0,0],_t,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Gt,[0,0],Ri,2,$i,dn,Cn,1,0,zn))(ve,ze,V,s.ae(n.transform.zoom),0,p,0,tt,0,Mt,x.offset,x.range,g),ei=n.getOrCreateProgram("raster",{defines:le});n.uploadCommonUniforms(J,ei,null),ei.draw(n,X.TRIANGLES,we,C,te,S,ai,p.id,Ft,Me,He)}function xd(l){const t=l._nearZ,n=l.projection.farthestPixelDistance(l),u=n-t,p=.2*l.height,g=t+p;return[t,n,(g-p-t)/u,(g-t)/u]}function Lc(l,t,n,u){if(l)return t instanceof Mr&&l instanceof sa?t.getTextureDescriptor(l,n,!0):{texture:l.texture,mix:ro(u.mix),offset:u.offset,buffer:0,tileSize:1}}var mh=s.da([{name:"a_index",type:"Int16",components:1}]);class bd{constructor(t,n,u,p){const g={width:u[0],height:u[1],data:null},x=t.gl;this.targetColorTexture=new s.T(t,g,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,g,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,p),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=n.width*n.height;this.particleTexture0=new s.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1});const g=new s.db;g.reserve(p);for(let x=0;x<p;x++)g.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(g,mh.members,!0),this.particleSegment=s.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function wd(l,t,n){if(!l)return null;const u=t.getTextureDescriptor(l,n,!0);if(!u)return null;let{texture:p,mix:g,offset:x,tileSize:S,buffer:C,format:L}=u;if(!p||!L)return null;let R=!1;return L==="uint32"&&(R=!0,g[3]=0,g=no(s.dc,g,[0,n.paint.get("raster-particle-max-speed")]),x=jo(s.dc,x,[0,n.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[C/(S+2*C),S/(S+2*C)],tileSize:S,scalarData:R,scale:g,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function Ed(l){const t=l._nearZ,n=l.projection.farthestPixelDistance(l),u=n-t,p=.2*l.height,g=t+p;return[t,n,(g-p-t)/u,(g-t)/u]}const Ru=new s.aj(1,0,0,1),Lf=new s.aj(0,1,0,1),Rf=new s.aj(0,0,1,1),Td=new s.aj(1,0,1,1),Rc=new s.aj(0,1,1,1);function $l(l,t,n,u,p,g,x){const S=l.context,C=l.transform,L=S.gl,R=C.projection.name==="globe",z=R?["PROJECTION_GLOBE_VIEW"]:[];let N=s.ab.mat4.clone(n.projMatrix);if(R&&s.ae(C.zoom)>0){const Mt=s.ba(n.canonical,C),ai=s.dd(Mt);N=s.ab.mat4.multiply(new Float32Array(16),C.globeMatrix,ai),s.ab.mat4.multiply(N,C.projMatrix,N)}const V=s.ab.mat4.create();V[12]+=2*p/(s.q.devicePixelRatio*C.width),V[13]+=2*g/(s.q.devicePixelRatio*C.height),s.ab.mat4.multiply(N,V,N);const J=l.getOrCreateProgram("debug",{defines:z}),X=t.getTileByID(n.key);l.terrain&&l.terrain.setupElevationDraw(X,J);const ie=Ln.disabled,te=ar.disabled,le=l.colorModeForRenderPass(),we="$debug";S.activeTexture.set(L.TEXTURE0),l.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),R?X._makeGlobeTileDebugBuffers(l.context,C):X._makeDebugTileBoundsBuffers(l.context,C.projection);const ve=X._tileDebugBuffer||l.debugBuffer,ze=X._tileDebugIndexBuffer||l.debugIndexBuffer,Ae=X._tileDebugSegments||l.debugSegments;if(J.draw(l,L.LINE_STRIP,ie,te,le,Qn.disabled,zo(N,u),we,ve,ze,Ae,null,null,null,[X._globeTileDebugBorderBuffer]),x){const Mt=X.latestRawTileData,ai=Math.floor((Mt&&Mt.byteLength||0)/1024);let ei=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(ei+=` => ${n.overscaledZ}`),ei+=` ${X.state}`,ei+=` ${ai}kb`,function(yt,Ut){yt.initDebugOverlayCanvas();const Ui=yt.debugOverlayCanvas,_t=yt.context.gl,_i=yt.debugOverlayCanvas.getContext("2d");_i.clearRect(0,0,Ui.width,Ui.height),_i.shadowColor="white",_i.shadowBlur=2,_i.lineWidth=1.5,_i.strokeStyle="white",_i.textBaseline="top",_i.font="bold 36px Open Sans, sans-serif",_i.fillText(Ut,5,5),_i.strokeText(Ut,5,5),yt.debugOverlayTexture.update(Ui),yt.debugOverlayTexture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE)}(l,ei)}const Le=t.getTile(n).tileSize,Me=512/Math.min(Le,512)*(n.overscaledZ/C.zoom)*.5,He=X._tileDebugTextBuffer||l.debugBuffer,tt=X._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,Ft=X._tileDebugTextSegments||l.debugSegments;J.draw(l,L.TRIANGLES,ie,te,cr.alphaBlended,Qn.disabled,zo(N,s.aj.transparent,Me),we,He,tt,Ft,null,null,null,[X._globeTileDebugTextBuffer])}function gh(l,t,n,u){uu(l,0,t+n/2,l.transform.width,n,u)}function _h(l,t,n,u){uu(l,t-n/2,0,n,l.transform.height,u)}function uu(l,t,n,u,p,g){const x=l.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*s.q.devicePixelRatio,n*s.q.devicePixelRatio,u*s.q.devicePixelRatio,p*s.q.devicePixelRatio),x.clear({color:g}),S.disable(S.SCISSOR_TEST)}const kc=s.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:gl}=kc;function Ol(l,t,n,u){l.emplaceBack(t,n,u)}class Sd{constructor(t){this.vertexArray=new s.de,this.indices=new s.aU,Ol(this.vertexArray,-1,-1,1),Ol(this.vertexArray,1,-1,1),Ol(this.vertexArray,-1,1,1),Ol(this.vertexArray,1,1,1),Ol(this.vertexArray,-1,-1,-1),Ol(this.vertexArray,1,-1,-1),Ol(this.vertexArray,-1,1,-1),Ol(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,gl),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.b7.simpleSegment(0,0,36,12)}}function Jo(l,t,n,u,p,g){const x=l.context.gl,S=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),L=t.paint.get("sky-atmosphere-sun-intensity"),R=((z,N,V,J,X)=>({u_matrix_3f:z,u_sun_direction:N,u_sun_intensity:V,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(s.ab.mat3.fromMat4(s.ab.mat3.create(),u),p,L,S,C);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),n.draw(l,x.TRIANGLES,Ln.disabled,ar.disabled,cr.unblended,Qn.frontCW,R,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const kf=s.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ic{constructor(t){const n=new s.df;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const u=new s.aU;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,kf.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=s.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ys=s.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class gs{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Id{constructor(t){this.colorModeAlphaBlendedWriteRGB=new cr([1,Os,1,Os],s.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new cr([1,0,1,0],s.aj.transparent,[!1,!1,!1,!0]),this.params=new gs,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ic(n);const u=this.params.sizeRange,p=this.params.intensityRange,g=function(R){const z=s.di(30),N=[];for(let V=0;V<R;++V){const J=2*Math.PI*z(),X=Math.acos(1-2*z())-.5*Math.PI;N.push(s.ab.vec3.fromValues(Math.cos(X)*Math.cos(J),Math.cos(X)*Math.sin(J),Math.sin(X)))}return N}(this.params.starsCount),x=s.di(300),S=new s.dg,C=new s.aU;let L=0;for(let R=0;R<g.length;++R){const z=s.ab.vec3.scale([],g[R],200),N=Math.max(0,1+.01*u*(1*x()-.5)),V=Math.max(0,1+.01*p*(1*x()-.5));S.emplaceBack(z[0],z[1],z[2],-1,-1,N,V),S.emplaceBack(z[0],z[1],z[2],1,-1,N,V),S.emplaceBack(z[0],z[1],z[2],1,1,N,V),S.emplaceBack(z[0],z[1],z[2],-1,1,N,V),C.emplaceBack(L+0,L+1,L+2),C.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=n.createVertexBuffer(S,Ys.members),this.starsIdx=n.createIndexBuffer(C),this.starsSegments=s.b7.simpleSegment(0,0,S.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const u=t.context,p=u.gl,g=t.transform,x=new Ln(p.LEQUAL,Ln.ReadOnly,[0,1]),S=s.ae(g.zoom),C=t.style.getLut(n.scope),L=n.properties.get("color-use-theme")==="none",R=n.properties.get("color").toRenderColor(L?null:C).toArray01(),z=n.properties.get("high-color-use-theme")==="none",N=n.properties.get("high-color").toRenderColor(z?null:C).toArray01(),V=n.properties.get("space-color-use-theme")==="none",J=n.properties.get("space-color").toRenderColor(V?null:C).toArray01PremultipliedAlpha(),X=5e-4,ie=s.dh(n.properties.get("horizon-blend"),0,1,X,.25),te=s.cC(t,u,g)&&ie===X?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,le=t.frameCounter/1e3%1,we=s.ab.vec3.length(g.globeCenterInViewSpace),ve=Math.sqrt(Math.pow(we,2)-Math.pow(te,2)),ze=Math.acos(ve/we),Ae=Le=>{const Me=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Le&&Me.push("ALPHA_PASS");const He=t.getOrCreateProgram("globeAtmosphere",{defines:Me}),tt=((Mt,ai,ei,yt,Ut,Ui,_t,_i,Gt,fn,Ri,di)=>({u_frustum_tl:Mt,u_frustum_tr:ai,u_frustum_br:ei,u_frustum_bl:yt,u_horizon:Ut,u_transition:Ui,u_fadeout_range:_t,u_color:_i,u_high_color:Gt,u_space_color:fn,u_temporal_offset:Ri,u_horizon_angle:di}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,S,ie,R,N,J,le,ze);t.uploadCommonUniforms(u,He);const Ft=this.atmosphereBuffer;Ft&&He.draw(t,p.TRIANGLES,x,ar.disabled,Le?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Qn.backCW,tt,Le?"atmosphere_glow_alpha":"atmosphere_glow",Ft.vertexBuffer,Ft.indexBuffer,Ft.segments)};Ae(!1),Ae(!0)}drawStars(t,n){const u=s.aw(n.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,g=p.gl,x=t.transform,S=t.getOrCreateProgram("stars"),C=s.ab.quat.identity([]);s.ab.quat.rotateX(C,C,-x._pitch),s.ab.quat.rotateZ(C,C,-x.angle),s.ab.quat.rotateX(C,C,s.ai(x._center.lat)),s.ab.quat.rotateY(C,C,-s.ai(x._center.lng));const L=s.ab.mat4.fromQuat(new Float32Array(16),C),R=s.ab.mat4.multiply([],x.starsProjMatrix,L),z=s.ab.mat3.fromMat4([],L),N=s.ab.mat3.invert([],z),V=[0,1,0];s.ab.vec3.transformMat3(V,V,N),s.ab.vec3.scale(V,V,this.params.sizeMultiplier);const J=[1,0,0];s.ab.vec3.transformMat3(J,J,N),s.ab.vec3.scale(J,J,this.params.sizeMultiplier);const X=(ie=V,te=J,le=u,{u_matrix:Float32Array.from(R),u_up:ie,u_right:te,u_intensity_multiplier:le});var ie,te,le;t.uploadCommonUniforms(p,S),this.starsVx&&this.starsIdx&&S.draw(t,g.TRIANGLES,Ln.disabled,ar.disabled,this.colorModeAlphaBlendedWriteRGB,Qn.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Dl(l,t){const n=[...l],u=t.cameraWorldSizeForFog/t.worldSize,p=s.ab.mat4.identity([]);return s.ab.mat4.scale(p,p,[u,u,1]),s.ab.mat4.multiply(n,p,n),s.ab.mat4.multiply(n,t.worldToFogMatrix,n),n}function ku(l,t,n,u,p){const g=n.material,x=u.context,{baseColorTexture:S,metallicRoughnessTexture:C}=g.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:R,emissionTexture:z}=g;function N(J,X,ie){if(J&&(l.push(X),x.activeTexture.set(x.gl.TEXTURE0+ie),J.gfxTexture)){const{minFilter:te,magFilter:le,wrapS:we,wrapT:ve}=J.sampler;J.gfxTexture.bindExtraParam(te,le,we,ve)}}N(S,"HAS_TEXTURE_u_baseColorTexture",Eo.BaseColor),N(C,"HAS_TEXTURE_u_metallicRoughnessTexture",Eo.MetallicRoughness),N(L,"HAS_TEXTURE_u_normalTexture",Eo.Normal),N(R,"HAS_TEXTURE_u_occlusionTexture",Eo.Occlusion),N(z,"HAS_TEXTURE_u_emissionTexture",Eo.Emission),p&&(p.texture||(p.texture=new s.dk(u.context,p.image,[p.image.height,p.image.height,p.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+Eo.LUT),p.texture&&p.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(l.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||l.push("DIFFUSE_SHADED");const V=u.shadowRenderer;V&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&l.push("NORMAL_OFFSET"))}function zl(l,t,n,u,p,g){const x=n.paint.get("model-opacity").constantOr(1),S=t.context,C=new Ln(t.context.gl.LEQUAL,Ln.ReadWrite,t.depthRangeFor3D),L=t.transform,R=l.mesh,z=R.material,N=z.pbrMetallicRoughness,V=t.style.fog;let J;J=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:s.ab.mat4.multiply([],u.zScaleMatrix,l.nodeModelMatrix),s.ab.mat4.multiply(J,u.negCameraPosMatrix,J);const X=s.ab.mat4.invert([],J);s.ab.mat4.transpose(X,X);const ie=n.paint.get("model-color-use-theme").constantOr("default")==="none",te=n.paint.get("model-emissive-strength").constantOr(0),le=Ju(new Float32Array(l.worldViewProjection),new Float32Array(J),new Float32Array(X),null,t,x,N.baseColorFactor.toRenderColor(null),z.emissiveFactor,N.metallicFactor,N.roughnessFactor,z,te,n),we={defines:[]},ve=[],ze=t.shadowRenderer;ze&&(ze.useNormalOffset=!1),ku(we.defines,ve,R,t,ie?null:n.lut);let Ae=null;if(V){const He=Dl(l.nodeModelMatrix,t.transform);if(Ae=new Float32Array(He),L.projection.name!=="globe"){const tt=R.aabb.min,Ft=R.aabb.max,[Mt,ai]=V.getOpacityForBounds(He,tt[0],tt[1],Ft[0],Ft[1]);we.overrideFog=Mt>=be||ai>=be}}const Le=La(t,n.paint.get("model-cutoff-fade-range"));Le.shouldRenderCutoff&&we.defines.push("RENDER_CUTOFF");const Me=t.getOrCreateProgram("model",we);t.uploadCommonUniforms(S,Me,null,Ae,Le),t.renderPass!=="shadow"&&ze&&ze.setupShadowsFromMatrix(l.nodeModelMatrix,Me),Me.draw(t,S.gl.TRIANGLES,C,p,g,R.material.doubleSided?Qn.disabled:Qn.backCCW,le,n.id,R.vertexBuffer,R.indexBuffer,R.segments,n.paint,t.transform.zoom,void 0,ve)}function Oc(l,t,n,u,p,g,x){let S;S=l.projection.name==="globe"?s.dl(n,l):[...n],s.ab.mat4.multiply(S,S,t.matrix);const C=s.ab.mat4.multiply([],u,S);if(t.meshes)for(const L of t.meshes){if(L.material.alphaMode!=="BLEND"){x.push({mesh:L,depth:0,modelIndex:p,worldViewProjection:C,nodeModelMatrix:S});continue}const R=s.ab.vec3.transformMat4([],L.centroid,C);!l.isOrthographic&&R[2]<=0||g.push({mesh:L,depth:R[2],modelIndex:p,worldViewProjection:C,nodeModelMatrix:S})}if(t.children)for(const L of t.children)Oc(l,L,n,u,p,g,x)}function nc(l,t,n,u){const p=n.shadowRenderer;if(!p)return;const g=p.getShadowPassDepthMode(),x=p.getShadowPassColorMode(),S=p.calculateShadowPassMatrixFromMatrix(t),C=Mc(S);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,g,ar.disabled,x,Qn.backCCW,C,u.id,l.vertexBuffer,l.indexBuffer,l.segments,u.paint,n.transform.zoom,void 0,void 0)}function _l(l,t,n){const u=t.updateZoomBasedPaintProperties(),p=function(g,x,S){let C,L,R,z=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&z>0){const N=g.terrain,V=N.findDEMTileFor(S);V&&V.dem?C=s.dn.create(N,S,V):z=0}if(z===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),z===x.validForExaggeration&&(z===0||C&&C._demTile&&C._demTile.tileID===x.validForDEMTile.id&&C._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const N in x.instancesPerModel){const V=x.instancesPerModel[N];for(let J=0;J<V.instancedDataArray.length;++J){const X=(C?z*C.getElevationAt(0|V.instancedDataArray.float32[16*J],0|V.instancedDataArray.float32[16*J+1],!0,!0):0)+V.instancesEvaluatedElevation[J];V.instancedDataArray.float32[16*J+6]=X,L=L?Math.min(x.terrainElevationMin,X):X,R=R?Math.max(x.terrainElevationMax,X):X}}return x.terrainElevationMin=L||0,x.terrainElevationMax=R||0,x.validForExaggeration=z,x.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(l,t,n);(u||p)&&(t.uploaded=!1,t.upload(l.context))}const ca={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.cd([0,0,0],[s.ag,s.ag,0])};function Dc(l,t){const n=1<<l.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,g=l.canonical.x/n,x=(l.canonical.x+1)/n,S=l.canonical.y/n,C=(l.canonical.y+1)/n;let L=t._centerAltitude;if(p){const V=p.getMinMaxForTile(l);V&&V.max>L&&(L=V.max)}const R=s.aw(u.x,g,x)-u.x,z=s.aw(u.y,S,C)-u.y,N=s.bH(L,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(R*R+z*z+N*N))}function rc(l,t,n,u,p,g,x){const S=l.context,C=l.renderPass==="shadow",L=l.shadowRenderer,R=C&&L?L.getShadowPassDepthMode():new Ln(S.gl.LEQUAL,Ln.ReadWrite,l.depthRangeFor3D),z=l.isTileAffectedByFog(g);if(n.meshes)for(const N of n.meshes){const V=["MODEL_POSITION_ON_GPU"],J=[];let X,ie,te;u.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");const le=La(l,t.paint.get("model-cutoff-fade-range"));if(le.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),C&&L)X=l.getOrCreateProgram("modelDepth",{defines:V}),ie=Mc(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(n.matrix)),te=L.getShadowPassColorMode();else{ku(V,J,N,l,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),X=l.getOrCreateProgram("model",{defines:V,overrideFog:z});const ve=N.material,ze=ve.pbrMetallicRoughness,Ae=t.paint.get("model-opacity").constantOr(1),Le=t.paint.get("model-emissive-strength").constantOr(0);ie=Ju(g.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,l,Ae,ze.baseColorFactor.toRenderColor(null),ve.emissiveFactor,ze.metallicFactor,ze.roughnessFactor,ve,Le,t,p),L&&(x.shadowUniformsInitialized?X.setShadowUniformValues(S,L.getShadowUniformValues()):(L.setupShadows(g.toUnwrapped(),X,"model-tile",g.overscaledZ),x.shadowUniformsInitialized=!0)),te=le.shouldRenderCutoff||Ae<1||ve.alphaMode!=="OPAQUE"?cr.alphaBlended:cr.unblended}l.uploadCommonUniforms(S,X,g.toUnwrapped(),null,le);const we=N.material.doubleSided?Qn.disabled:Qn.backCCW;if(u.instancedDataArray.length>20)J.push(u.instancedDataBuffer),X.draw(l,S.gl.TRIANGLES,R,ar.disabled,te,we,ie,t.id,N.vertexBuffer,N.indexBuffer,N.segments,t.paint,l.transform.zoom,void 0,J,u.instancedDataArray.length);else{const ve=C?"u_instance":"u_normal_matrix";for(let ze=0;ze<u.instancedDataArray.length;++ze)ie[ve]=new Float32Array(u.instancedDataArray.arrayBuffer,64*ze,16),X.draw(l,S.gl.TRIANGLES,R,ar.disabled,te,we,ie,t.id,N.vertexBuffer,N.indexBuffer,N.segments,t.paint,l.transform.zoom,void 0,J)}}if(n.children)for(const N of n.children)rc(l,t,N,u,p,g,x)}const yh=[1,-1,1];function vh(l,t,n,u){if(!n.modelManager)return!0;const p=n.modelManager;if(!n.shadowRenderer)return!0;const g=n.shadowRenderer,x=t.aabb;let S=!0,C=l.maxHeight;if(C===0){let R=0;for(const z in l.instancesPerModel){const N=p.getModel(z,u);N?R=Math.max(R,Math.max(Math.max(N.aabb.max[0],N.aabb.max[1]),N.aabb.max[2])):S=!1}C=l.maxScale*R*1.41+l.maxVerticalOffset,S&&(l.maxHeight=C)}x.max[2]=C,x.min[2]+=l.terrainElevationMin,x.max[2]+=l.terrainElevationMax,s.ab.vec3.transformMat4(x.min,x.min,t.tileMatrix),s.ab.vec3.transformMat4(x.max,x.max,t.tileMatrix);const L=x.intersects(g.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=L===2),L===0}function cu(l,t){const n=l.uniformValues.u_cutoff_params[0],u=l.uniformValues.u_cutoff_params[1],p=l.uniformValues.u_cutoff_params[2],g=l.uniformValues.u_cutoff_params[3];return u===n||g===p?1:s.aw(((t-n)/(u-n)-p)/(g-p),0,1)}function xh(l,t,n,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();s.ab.mat4.multiply(p,p,l);const g=s.ab.vec4.fromValues(n.min[0],n.min[1],n.min[2],1);let x=s.ab.vec4.transformMat4(s.ab.vec4.create(),g,p),S=x,C=x;g[1]=n.max[1],x=s.ab.vec4.transformMat4(s.ab.vec4.create(),g,p),S=x[1]<S[1]?x:S,C=x[1]>C[1]?x:C,g[0]=n.max[0],x=s.ab.vec4.transformMat4(s.ab.vec4.create(),g,p),S=x[1]<S[1]?x:S,C=x[1]>C[1]?x:C,g[1]=n.min[1],x=s.ab.vec4.transformMat4(s.ab.vec4.create(),g,p),S=x[1]<S[1]?x:S,C=x[1]>C[1]?x:C;const L=s.aw(u[0],0,1),R=100*t.pixelsPerMeter*s.aw(u[1],0,1),z=s.aw(u[2],0,1),N=s.ab.vec4.lerp(s.ab.vec4.create(),S,C,L),V=Math.tan(.5*t.fovX),J=-N[2]*V;if(R===0)return N[1]<-Math.abs(J)?z:1;const X=(-Math.abs(J)-N[1])/R,ie=(le,we,ve)=>(1-ve)*le+ve*we,te=s.aw(ie(1,z,X),z,1);return ie(1,te,s.aw((t.pitch-20)/20,0,1))}class Wl{}class bh{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,u){{const z=this._storage.get(n.id);if(z)return z.lastUsedFrameIdx=t,z.buf}const p=u.gl,g=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),x=new ArrayBuffer(g),S=new Int16Array(x);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const C=new s.dq;for(let z=0;z<g/2;z+=3){const N=S[z],V=S[z+1],J=S[z+2];C.emplaceBack(N,V),C.emplaceBack(V,J),C.emplaceBack(J,N)}const L=u.bindVertexArrayOES.current,R=new Wl;return R.buf=new ml(u,C),R.lastUsedFrameIdx=t,this._storage.set(n.id,R),u.bindVertexArrayOES.set(L),R.buf}update(t){for(const[n,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class zc{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const wh=s.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Eh{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class na{constructor(t,n){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...n,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...n,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Th=s.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Sh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const x=new s.dr,S=new s.aU;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,Th.members),this.vignetteIdx=t.context.createIndexBuffer(S)}const p=s.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const x={u_vignetteShape:(g={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,Ln.disabled,ar.disabled,cr.alphaBlended,Qn.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,p,{})}var g}}class sc{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),g=u.toLngLat(),x=s.ai(g.lng),S=s.ai(g.lat),C=t.pixelsPerMeter/n,L=x*s.ds,R=s.ds*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const z=-this._offsetYPrev+R,N=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*C,this._accumulatedOffsetY+=z*C,this._accumulatedElevation+=N*C,this._offsetXPrev=L,this._offsetYPrev=R,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Yl(l,t){return[-(l[0]-Math.floor(l[0]/t)*t),-(l[1]-Math.floor(l[1]/t)*t),-(l[2]-Math.floor(l[2]/t)*t)]}function Nc(l){const t=s.di(1323123451230),n=[];for(let u=0;u<l;++u){const p=2*t()-1,g=2*t()-1,x=2*t()-1;n.push(s.ab.vec3.fromValues(p,g,x))}return n}function yl(l,t,n,u,p){const g=s.aw((p-n)/(u-n),0,1);return(1-g)*l+g*t}class Fc{constructor(t){this._movement=new sc,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Sh,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,g=s.ab.quat.identity([]);s.ab.quat.rotateX(g,g,s.ai(90)-u._pitch),s.ab.quat.rotateZ(g,g,-u.angle);const x=s.ab.mat4.fromQuat(new Float32Array(16),g),S=s.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=s.ab.mat4.transpose([],S),L=s.ab.mat4.multiply([],C,x),R=Date.now()/1e3;return this._accumulatedTimeFromStart+=(R-this._prevTime)*n,this._prevTime=R,{projectionMatrix:p,modelviewMatrix:L}}}class Ou extends Fc{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new na(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=Nc(this.particlesCount),p=new s.dt,g=new s.aU;let x=0;const S=s.di(1323123451230);for(let C=0;C<u.length;++C){const L=u[C],R=[2*S()-1,S(),S(),S()];p.emplaceBack(L[0],L[1],L[2],-1,-1,...R),p.emplaceBack(L[0],L[1],L[2],1,-1,...R),p.emplaceBack(L[0],L[1],L[2],1,1,...R),p.emplaceBack(L[0],L[1],L[2],-1,1,...R),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=n.createVertexBuffer(p,wh.members),this.particlesIdx=n.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(n.revealStart>u)return;const p=yl(0,1,n.revealStart,n.revealStart+n.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let x=[-g.direction.x,g.direction.y,-100];s.ab.vec3.normalize(x,x);const S=structuredClone(this._vignetteParams);S.strength*=p,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(t.style.rain.state.vignetteColor));const C=this.updateOnRender(t,g.timeFactor),L=t.context,R=L.gl,z=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(L,{width:t.width,height:t.height,data:null},R.RGBA8)),g.distortionStrength>0&&(L.activeTexture.set(R.TEXTURE0),this.screenTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),R.copyTexSubImage2D(R.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const N=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(L,N),L.activeTexture.set(R.TEXTURE0),this.screenTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const V=[g.color.r,g.color.g,g.color.b,g.color.a],J=(X,ie)=>{const te=Yl(this._movement.getPosition(),X),le=g.dropletSizeX,we=g.dropletSizeX*g.dropletSizeYScale,ve=t.width/2,ze=t.height/2,Ae=yl(0,g.screenThinning.start,0,1,g.screenThinning.intensity),Le=yl(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),Me=yl(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),He=(tt={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:X,rainDropletSize:[le,we],distortionStrength:g.distortionStrength,rainDirection:x,color:V,screenSize:[z.width,z.height],thinningCenterPos:[ve,ze],thinningShape:[Ae,Le,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:Me,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:ie?0:1},{u_modelview:Float32Array.from(tt.modelview),u_projection:Float32Array.from(tt.projection),u_time:tt.time,u_cam_pos:tt.camPos,u_texScreen:0,u_velocityConeAperture:tt.velocityConeAperture,u_velocity:tt.velocity,u_boxSize:tt.boxSize,u_rainDropletSize:tt.rainDropletSize,u_distortionStrength:tt.distortionStrength,u_rainDirection:tt.rainDirection,u_color:tt.color,u_screenSize:tt.screenSize,u_thinningCenterPos:tt.thinningCenterPos,u_thinningShape:tt.thinningShape,u_thinningAffectedRatio:tt.thinningAffectedRatio,u_thinningParticleOffset:tt.thinningParticleOffset,u_shapeDirectionalPower:tt.shapeDirectionalPower,u_shapeNormalPower:tt.shapeNormalPower,u_mode:tt.mode});var tt;const Ft=Math.round(g.intensity*this.particlesCount),Mt=s.b7.simpleSegment(0,0,4*Ft,2*Ft);N.draw(t,R.TRIANGLES,Ln.disabled,ar.disabled,cr.alphaBlended,Qn.disabled,He,"rain_particles",this.particlesVx,this.particlesIdx,Mt,{})};g.distortionStrength>0&&J(g.boxSize,!0),J(g.boxSize,!1),this._vignette.draw(t,S)}}const Ih=s.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Mh extends Fc{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new na(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=Nc(this.particlesCount),p=new s.du,g=new s.aU;let x=0;const S=s.di(1323123451230);for(let C=0;C<u.length;++C){const L=u[C],R=S(),z=S(),N=S(),V=[C/u.length,R,z,N],J=[S(),S()];p.emplaceBack(L[0],L[1],L[2],-1,-1,...V,...J),p.emplaceBack(L[0],L[1],L[2],1,-1,...V,...J),p.emplaceBack(L[0],L[1],L[2],1,1,...V,...J),p.emplaceBack(L[0],L[1],L[2],-1,1,...V,...J),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=n.createVertexBuffer(p,Ih.members),this.particlesIdx=n.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let u=[-n.direction.x,n.direction.y,-100];s.ab.vec3.normalize(u,u);const p=structuredClone(this._vignetteParams),g=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(g.revealStart>x)return;const S=yl(0,1,g.revealStart,g.revealStart+g.revealRange,x);p.strength*=S,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const C=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=t.context,R=L.gl,z=t.transform,N=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(L,N),((V,J,X)=>{const ie=Yl(this._movement.getPosition(),V),te=z.width/2,le=z.height/2,we=yl(0,X.screenThinning.start,0,1,X.screenThinning.intensity),ve=yl(.001,X.screenThinning.range,0,1,X.screenThinning.intensity),ze=yl(0,X.screenThinning.particleOffset,0,1,X.screenThinning.intensity),Ae=(Le={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:X.velocityConeAperture,velocity:X.velocity,horizontalOscillationRadius:X.horizontalOscillationRadius,horizontalOscillationRate:X.horizontalOscillationRate,boxSize:V,billboardSize:1*X.billboardSize,simpleShapeParameters:[X.shapeFadeStart,X.shapeFadePower],screenSize:[z.width,z.height],thinningCenterPos:[te,le],thinningShape:[we,ve,Math.pow(10,X.screenThinning.fadePower)],thinningAffectedRatio:X.screenThinning.affectedRatio,thinningParticleOffset:ze,color:[X.color.r,X.color.g,X.color.b,X.color.a],direction:u},{u_modelview:Float32Array.from(Le.modelview),u_projection:Float32Array.from(Le.projection),u_time:Le.time,u_cam_pos:Le.camPos,u_velocityConeAperture:Le.velocityConeAperture,u_velocity:Le.velocity,u_horizontalOscillationRadius:Le.horizontalOscillationRadius,u_horizontalOscillationRate:Le.horizontalOscillationRate,u_boxSize:Le.boxSize,u_billboardSize:Le.billboardSize,u_simpleShapeParameters:Le.simpleShapeParameters,u_screenSize:Le.screenSize,u_thinningCenterPos:Le.thinningCenterPos,u_thinningShape:Le.thinningShape,u_thinningAffectedRatio:Le.thinningAffectedRatio,u_thinningParticleOffset:Le.thinningParticleOffset,u_particleColor:Le.color,u_direction:Le.direction});var Le;const Me=Math.round(X.intensity*this.particlesCount),He=s.b7.simpleSegment(0,0,4*Me,2*Me);this.particlesVx&&this.particlesIdx&&N.draw(t,R.TRIANGLES,Ln.disabled,ar.disabled,cr.alphaBlended,Qn.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,He,{})})(n.boxSize,0,n),this._vignette.draw(t,p)}}const oc={symbol:function(l,t,n,u,p){if(l.renderPass!=="translucent")return;const g=ar.disabled,x=l.colorModeForRenderPass(),S=n.layout.get("text-variable-anchor"),C=n.layout.get("text-size-scale-range"),L=s.aw(l.scaleFactor,C[0],C[1]);S&&function(N,V,J,X,ie,te,le,we){const ve=V.transform,ze=ie==="map",Ae=te==="map";for(const Le of N){const Me=X.getTile(Le),He=Me.getBucket(J);if(!He||!He.text||!He.text.segments.get().length)continue;const tt=s.bp(He.textSizeData,ve.zoom,we),Ft=An(Le,He.getProjection(),ve),Mt=ve.calculatePixelsToTileUnitsMatrix(Me),ai=pt(Ft,Me.tileID.canonical,Ae,ze,ve,He.getProjection(),Mt),ei=He.hasIconTextFit()&&He.hasIconData();if(tt){const yt=Math.pow(2,ve.zoom-Me.tileID.overscaledZ);Cc(He,ze,Ae,le,s.cX,ve,ai,Le,yt,tt,ei)}}}(u,l,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),p,L);const R=n.paint.get("icon-opacity").constantOr(1)!==0,z=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(R||z)?ec(l,t,n,u,g,x):(R&&ec(l,t,n,u,g,x,{onlyIcons:!0}),z&&ec(l,t,n,u,g,x,{onlyText:!0})),t.map.showCollisionBoxes&&(Ac(l,t,n,u,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Ac(l,t,n,u,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,n,u){if(l.renderPass!=="translucent")return;const p=n.paint.get("circle-opacity"),g=n.paint.get("circle-stroke-width"),x=n.paint.get("circle-stroke-opacity"),S=n.layout.get("circle-sort-key").constantOr(1)!==void 0,C=n.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const L=l.context,R=L.gl,z=l.transform,N=l.depthModeForSublayer(0,Ln.ReadOnly),V=ar.disabled,J=l.colorModeForDrapableLayerRenderPass(C),X=z.projection.name==="globe",ie=[s.at(z.center.lng),s.aA(z.center.lat)],te=[];for(let we=0;we<u.length;we++){const ve=u[we],ze=t.getTile(ve),Ae=ze.getBucket(n);if(!Ae||Ae.projection.name!==z.projection.name)continue;const Le=Ae.programConfigurations.get(n.id),Me=s.cY(n),He=l.isTileAffectedByFog(ve);X&&Me.push("PROJECTION_GLOBE_VIEW"),Me.push("DEPTH_D24"),l.terrain&&z.depthOcclusionForSymbolsAndCircles&&Me.push("DEPTH_OCCLUSION");const tt=l.getOrCreateProgram("circle",{config:Le,defines:Me,overrideFog:He}),Ft=Ae.layoutVertexBuffer,Mt=Ae.globeExtVertexBuffer,ai=Ae.indexBuffer,ei=z.projection.createInversionMatrix(z,ve.canonical),yt={programConfiguration:Le,program:tt,layoutVertexBuffer:Ft,globeExtVertexBuffer:Mt,indexBuffer:ai,uniformValues:s.cZ(l,ve,ze,ei,ie,n),tile:ze};if(S){const Ut=Ae.segments.get();for(const Ui of Ut)te.push({segments:new s.b7([Ui]),sortKey:Ui.sortKey,state:yt})}else te.push({segments:Ae.segments,sortKey:0,state:yt})}S&&te.sort((we,ve)=>we.sortKey-ve.sortKey);const le={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(const we of te){const{programConfiguration:ve,program:ze,layoutVertexBuffer:Ae,globeExtVertexBuffer:Le,indexBuffer:Me,uniformValues:He,tile:tt}=we.state,Ft=we.segments;l.terrain&&l.terrain.setupElevationDraw(tt,ze,le),l.uploadCommonUniforms(L,ze,tt.tileID.toUnwrapped()),ze.draw(l,R.TRIANGLES,N,V,J,Qn.disabled,He,n.id,Ae,Me,Ft,n.paint,z.zoom,ve,[Le])}},heatmap:function(l,t,n,u){if(n.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const p=l.context,g=p.gl,x=ar.disabled,S=new cr([g.ONE,g.ONE,g.ONE,g.ONE],s.aj.transparent,[!0,!0,!0,!0]);(function(V,J,X,ie){const te=V.gl,le=J.width*ie,we=J.height*ie;V.activeTexture.set(te.TEXTURE1),V.viewport.set([0,0,le,we]);let ve=X.heatmapFbo;if(!ve||ve&&(ve.width!==le||ve.height!==we)){ve&&ve.destroy();const ze=te.createTexture();te.bindTexture(te.TEXTURE_2D,ze),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),ve=X.heatmapFbo=V.createFramebuffer(le,we,!0,null),function(Ae,Le,Me,He,tt,Ft){const Mt=Ae.gl;Mt.texImage2D(Mt.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?Mt.RGBA16F:Mt.RGBA,tt,Ft,0,Mt.RGBA,Ae.extRenderToTextureHalfFloat?Mt.HALF_FLOAT:Mt.UNSIGNED_BYTE,null),He.colorAttachment.set(Me)}(V,0,ze,ve,le,we)}else te.bindTexture(te.TEXTURE_2D,ve.colorAttachment.get()),V.bindFramebuffer.set(ve.framebuffer)})(p,l,n,l.transform.projection.name==="globe"?.5:.25),p.clear({color:s.aj.transparent});const C=l.transform,L=C.projection.name==="globe",R=L?["PROJECTION_GLOBE_VIEW"]:[],z=L?Qn.frontCCW:Qn.disabled,N=[s.at(C.center.lng),s.aA(C.center.lat)];for(let V=0;V<u.length;V++){const J=u[V];if(t.hasRenderableParent(J))continue;const X=t.getTile(J),ie=X.getBucket(n);if(!ie||ie.projection.name!==C.projection.name)continue;const te=l.isTileAffectedByFog(J),le=ie.programConfigurations.get(n.id),we=l.getOrCreateProgram("heatmap",{config:le,defines:R,overrideFog:te}),{zoom:ve}=l.transform;l.terrain&&l.terrain.setupElevationDraw(X,we),l.uploadCommonUniforms(p,we,J.toUnwrapped());const ze=C.projection.createInversionMatrix(C,J.canonical);we.draw(l,g.TRIANGLES,Ln.disabled,x,S,z,on(l,J,X,ze,N,ve,n.paint.get("heatmap-intensity")),n.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,n.paint,l.transform.zoom,le,L?[ie.globeExtVertexBuffer]:null)}p.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(p,g){const x=p.context,S=x.gl,C=g.heatmapFbo;if(!C)return;x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),x.activeTexture.set(S.TEXTURE1);let L=g.colorRampTexture;L||(L=g.colorRampTexture=new s.T(x,g.colorRamp,S.RGBA8)),L.bind(S.LINEAR,S.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,S.TRIANGLES,Ln.disabled,ar.disabled,p.colorModeForRenderPass(),Qn.disabled,((R,z,N,V)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,g),g.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,g.paint,p.transform.zoom)}(l,n))},line:function(l,t,n,u){if(l.renderPass!=="translucent")return;const p=n.paint.get("line-opacity"),g=n.paint.get("line-width");if(p.constantOr(1)===0||g.constantOr(1)===0)return;const x=n.paint.get("line-emissive-strength"),S=n.paint.get("line-occlusion-opacity"),C=n.layout.get("line-elevation-reference"),L=n.layout.get("line-width-unit")==="meters",R=C==="sea",z=l.context,N=z.gl;if(n.hasElevatedBuckets&&l.transform.projection.name==="globe")return;const V=n.layout.get("line-cross-slope"),J=V!==void 0,X=V<1,ie=l.colorModeForDrapableLayerRenderPass(x),te=l.terrain&&l.terrain.renderingToTexture,le=te?1:s.q.devicePixelRatio,we=n.paint.get("line-dasharray"),ve=we.constantOr(1),ze=n.layout.get("line-cap"),Ae=we.constantOr(null),Le=ze.constantOr(null),Me=n.paint.get("line-pattern"),He=Me.constantOr(1),tt=Me.constantOr(null),Ft=n.paint.get("line-opacity").constantOr(1);let Mt=!He&&Ft!==1||l.depthOcclusion&&S>0&&S<1;const ai=n.paint.get("line-gradient"),ei=He?"linePattern":"line",yt=s.c_(n);let Ut;if(te&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(Mt=!1),S!==0&&l.depthOcclusion){const _t=n.paint._values["line-opacity"];_t&&_t.value&&_t.value.kind==="constant"?Ut=_t.value:s.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&yt.push("VARIABLE_LINE_WIDTH");const Ui=(_t,_i,Gt,fn,Ri)=>{for(const di of _t){const $i=t.getTile(di);if(He&&!$i.patternsLoaded())continue;const dn=$i.getBucket(n);if(!dn||dn.hasZOffset&&!Ri||!dn.hasZOffset&&Ri)continue;l.prepareDrawTile();const Cn=dn.programConfigurations.get(n.id),zn=l.isTileAffectedByFog(di),xr=l.getOrCreateProgram(ei,{config:Cn,defines:_i,overrideFog:zn,overrideRtt:!Ri&&void 0});if(tt&&$i.imageAtlas){const Rr=s.A.from(tt).getPrimary().scaleSelf(le).serialize(),ns=$i.imageAtlas.patternPositions[Rr];ns&&Cn.setConstantPatternPositions(ns)}if(!He&&Ae&&Le&&$i.lineAtlas){const Rr=$i.lineAtlas.getDash(Ae,Le);Rr&&Cn.setConstantPatternPositions(Rr)}let[sr,lr]=n.paint.get("line-trim-offset");(Le==="round"||Le==="square")&&sr!==lr&&(sr===0&&(sr-=1),lr===1&&(lr+=1));const Tr=te?di.projMatrix:null,Yr=L?1/dn.tileToMeter/s.ar($i,1,l.transform.zoom):1,As=L?1/dn.tileToMeter/s.ar($i,1,Math.floor(l.transform.zoom)):1,ho=He?s.c$(l,$i,n,Tr,le,Yr,As,[sr,lr]):s.d0(l,$i,n,Tr,dn.lineClipsArray.length,le,Yr,As,[sr,lr]);if(ai){const Rr=dn.gradients[n.id];let ns=Rr.texture;if(n.gradientVersion!==Rr.version){let Wn=256;if(n.stepInterpolant){const $r=t.getSource().maxzoom,ps=di.canonical.z===$r?Math.ceil(1<<l.transform.maxZoom-di.canonical.z):1;Wn=s.aw(s.d1(dn.maxLineLength/s.ag*1024*ps),256,z.maxTextureSize)}Rr.gradient=s.d2({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:Wn,image:Rr.gradient||void 0,clips:dn.lineClipsArray}),Rr.texture?Rr.texture.update(Rr.gradient):Rr.texture=new s.T(z,Rr.gradient,N.RGBA8),Rr.version=n.gradientVersion,ns=Rr.texture}z.activeTexture.set(N.TEXTURE1),ns.bind(n.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}ve&&(z.activeTexture.set(N.TEXTURE0),$i.lineAtlasTexture&&$i.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),Cn.updatePaintBuffers()),He&&(z.activeTexture.set(N.TEXTURE0),$i.imageAtlasTexture&&$i.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Cn.updatePaintBuffers()),Ri&&!R&&l.terrain.setupElevationDraw($i,xr),l.uploadCommonUniforms(z,xr,di.toUnwrapped());const Ks=Rr=>{Ut!=null&&(Ut.value=Ft*S),xr.draw(l,N.TRIANGLES,Gt,Rr,ie,Qn.disabled,ho,n.id,dn.layoutVertexBuffer,dn.indexBuffer,dn.segments,n.paint,l.transform.zoom,Cn,[dn.layoutVertexBuffer2,dn.patternVertexBuffer,dn.zOffsetVertexBuffer]),Ut!=null&&(Ut.value=Ft)};if(Mt&&!Ri){const Rr=l.stencilModeForClipping(di).ref;Rr===0&&te&&z.clear({stencil:0});const ns={func:N.EQUAL,mask:255};ho.u_alpha_discard_threshold=.8,Ks(new ar(ns,Rr,255,N.KEEP,N.KEEP,N.INVERT)),ho.u_alpha_discard_threshold=0,Ks(new ar(ns,Rr,255,N.KEEP,N.KEEP,N.KEEP))}else Mt&&Ri&&(ho.u_alpha_discard_threshold=.001),Ks(Ri?fn:l.stencilModeForClipping(di))}};if(n.hasNonElevatedBuckets){const _t=!te&&l.terrain;S!==0&&_t?s.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):_t?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):Ui(u,yt,l.depthModeForSublayer(0,Ln.ReadOnly),ar.disabled,!1)}if(n.hasElevatedBuckets){yt.push("ELEVATED"),J&&yt.push(X?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),R&&yt.push("ELEVATION_REFERENCE_SEA");const _t=Mt?l.stencilModeFor3D():ar.disabled,_i=new Ln(l.depthOcclusion?N.GREATER:N.LEQUAL,Ln.ReadOnly,l.depthRangeFor3D);l.forceTerrainMode=!0,Ui(u,yt,_i,_t,!0),l.forceTerrainMode=!1}Mt&&(l.resetStencilClippingMasks(),te&&z.clear({stencil:0})),S===0||l.depthOcclusion||te||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,n,u){const p=n.paint.get("fill-color"),g=n.paint.get("fill-opacity"),x=n.is3D(),S=new Ln(l.context.gl.LEQUAL,Ln.ReadWrite,l.depthRangeFor3D);if(g.constantOr(1)===0)return;const C=n.paint.get("fill-emissive-strength"),L=l.colorModeForDrapableLayerRenderPass(C),R=n.paint.get("fill-pattern"),z=l.opaquePassEnabledForLayer()&&!R.constantOr(1)&&p.constantOr(s.aj.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===z){const N=x?S:l.depthModeForSublayer(1,l.renderPass==="opaque"?Ln.ReadWrite:Ln.ReadOnly);ph(l,t,n,u,N,L,!1)}if(!x&&l.renderPass==="translucent"&&n.paint.get("fill-antialias")){const N=x?S:l.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Ln.ReadOnly);ph(l,t,n,u,N,L,!0)}},"fill-extrusion":function(l,t,n,u){const p=n.paint.get("fill-extrusion-opacity"),g=l.context,x=g.gl,S=l.terrain,C=S&&S.renderingToTexture;if(p===0)return;const L=l.conflationActive&&l.style.isLayerClipped(n,t.getSource()),R=l.style.order.indexOf(n.fqid);if(L&&function(z,N,V,J,X){for(const ie of J){const te=N.getTile(ie).getBucket(V);te&&(te.updateReplacement(ie,z.replacementSource,X),te.uploadCentroid(z.context))}}(l,t,n,u,R),S||L)for(const z of u){const N=t.getTile(z).getBucket(n);N&&Cu(l.context,t,z,N,n,S,L)}if(l.renderPass==="shadow"&&l.shadowRenderer){const z=l.shadowRenderer;if(S&&p<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.a9)return;const N=z.getShadowPassDepthMode(),V=z.getShadowPassColorMode();tc(l,t,n,u,N,ar.disabled,V,L)}else if(l.renderPass==="translucent"){const z=!n.paint.get("fill-extrusion-pattern").constantOr(1),N=n.paint.get("fill-extrusion-color").constantOr(s.aj.white);if(!C&&N.a!==0){const V=new Ln(l.context.gl.LEQUAL,Ln.ReadWrite,l.depthRangeFor3D);p===1&&z?tc(l,t,n,u,V,ar.disabled,cr.unblended,L):(tc(l,t,n,u,V,ar.disabled,cr.disabled,L),tc(l,t,n,u,V,l.stencilModeFor3D(),l.colorModeForRenderPass(),L),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&z&&(!S&&l.transform.projection.name!=="globe"||C)){const V=n.paint.get("fill-extrusion-opacity"),J=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=n.paint.get("fill-extrusion-flood-light-intensity"),te=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",le=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(te?null:n.lut).toArray01().slice(0,3),we=J>0&&X>0,ve=ie>0,ze=(Le,Me,He)=>(1-He)*Le+He*Me,Ae=Le=>{const Me=l.depthModeForSublayer(1,Ln.ReadOnly,x.LEQUAL,!0),He=n.paint.get(Le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),tt=ze(.1,3,He),Ft=l._showOverdrawInspector;if(!Ft){const Mt=new ar({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),ai=new cr([x.ONE,x.ONE,x.ONE,x.ONE],s.aj.transparent,[!1,!1,!1,!0],x.MIN);Au(l,t,n,u,Me,Mt,ai,Qn.disabled,Le,"sdf",V,J,X,ie,le,tt,L,!1)}{const Mt=Ft?ar.disabled:new ar({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),ai=Ft?l.colorModeForRenderPass():new cr([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],s.aj.transparent,[!0,!0,!0,!0]);Au(l,t,n,u,Me,Mt,ai,Qn.disabled,Le,"color",V,J,X,ie,le,tt,L,!1)}};if(C){const Le=(Me,He,tt)=>{const Ft=l.depthModeForSublayer(1,Ln.ReadOnly,x.LEQUAL,!1),Mt=n.paint.get(Me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ai=ze(.1,3,Mt);{const ei=new cr([x.ONE,x.ONE,x.ONE,x.ONE],s.aj.transparent,[!1,!1,!1,!0]);Au(l,t,n,u,Ft,ar.disabled,ei,Qn.disabled,Me,"clear",V,J,X,ie,le,ai,L,He)}{const ei=new ar({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),yt=new cr([x.ONE,x.ONE,x.ONE,x.ONE],s.aj.transparent,[!1,!1,!1,!0],x.MIN);Au(l,t,n,u,Ft,ei,yt,Qn.disabled,Me,"sdf",V,J,X,ie,le,ai,L,He)}{const ei=Me?x.ZERO:x.ONE_MINUS_DST_ALPHA,yt=new ar({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ut=new cr([ei,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],s.aj.transparent,[!0,!0,!0,!0]);Au(l,t,n,u,Ft,yt,Ut,Qn.disabled,Me,"color",V,J,X,ie,le,ai,L,He)}{const ei=new cr([x.ONE,x.ONE,x.ONE,Me?x.ZERO:x.ONE],s.aj.transparent,[!1,!1,!1,!0],Me?x.FUNC_ADD:x.MAX);Au(l,t,n,u,Ft,ar.disabled,ei,Qn.disabled,Me,"clear",V,J,X,ie,le,ai,L,He,tt)}};if(we||ve){let Me;if(l.prepareDrawTile(),S){const He=S.drapeBufferSize[0],tt=S.drapeBufferSize[1];Me=S.framebufferCopyTexture,Me&&(!Me||Me.size[0]===He&&Me.size[1]===tt)||(Me&&Me.destroy(),Me=S.framebufferCopyTexture=new s.T(g,new s.r({width:He,height:tt}),x.RGBA8)),Me.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,He,tt)}we&&Le(!0,!1,Me),ve&&Le(!1,!0,Me)}}else we&&Ae(!0),ve&&Ae(!1),(we||ve)&&l.resetStencilClippingMasks()}}},hillshade:function(l,t,n,u){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const p=l.context,g=l.terrain&&l.terrain.renderingToTexture,[x,S]=l.renderPass!=="translucent"||g?[{},u]:l.stencilConfigForOverlap(u);for(const C of S){const L=t.getTile(C);if(L.needsHillshadePrepare&&l.renderPass==="offscreen")vu(l,L,n);else if(l.renderPass==="translucent"){const R=l.depthModeForSublayer(0,Ln.ReadOnly),z=n.paint.get("hillshade-emissive-strength"),N=l.colorModeForDrapableLayerRenderPass(z),V=g&&l.terrain?l.terrain.stencilModeForRTTOverlap(C):x[C.overscaledZ];iu(l,C,L,n,R,V,N)}}p.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,n,u,p,g){if(l.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const x=l.transform.projection.name==="globe",S=n.paint.get("raster-elevation")!==0,C=S&&x;if(l.renderElevatedRasterBackface&&!C)return;const L=l.context,R=L.gl,z=t.getSource(),N=function(Ae,Le,Me,He){const tt=Le.paint.get("raster-color"),Ft=Ae.type==="raster-array",Mt=[],ai=Le.paint.get("raster-resampling"),ei=Le.paint.get("raster-color-mix");let yt=Le.paint.get("raster-color-range");const Ut=[ei[0],ei[1],ei[2],0],Ui=ei[3];let _t=ai==="nearest"?He.NEAREST:He.LINEAR;if(Ft&&(Mt.push("RASTER_ARRAY"),tt||Mt.push("RASTER_COLOR"),ai==="linear"&&Mt.push("RASTER_ARRAY_LINEAR"),_t=He.NEAREST,!yt&&Ae.rasterLayers)){const _i=Ae.rasterLayers.find(({id:Gt})=>Gt===Le.sourceLayer);_i&&_i.fields&&_i.fields.range&&(yt=_i.fields.range)}if(yt=yt||[0,1],tt){Mt.push("RASTER_COLOR"),Me.activeTexture.set(He.TEXTURE2),Le.updateColorRamp(yt);let _i=Le.colorRampTexture;_i||(_i=Le.colorRampTexture=new s.T(Me,Le.colorRamp,He.RGBA8)),_i.bind(He.LINEAR,He.CLAMP_TO_EDGE)}return{mix:Ut,range:yt,offset:Ui,defines:Mt,resampling:_t}}(z,n,L,R);if(z instanceof s.aJ&&!u.length&&!x)return;const V=n.paint.get("raster-emissive-strength"),J=l.colorModeForDrapableLayerRenderPass(V),X=l.terrain&&l.terrain.renderingToTexture,ie=!l.options.moving,te=n.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;if(z instanceof s.aJ&&!u.length&&(z.onNorthPole||z.onSouthPole)){const Ae=S?l.stencilModeFor3D():ar.disabled;return void Ct(!!z.onNorthPole,null,l,t,n,V,N,Qn.disabled,Ae)}if(!u.length)return;const[le,we]=z instanceof s.aJ||X?[{},u]:l.stencilConfigForOverlap(u),ve=we[we.length-1].overscaledZ;C&&N.defines.push("PROJECTION_GLOBE_VIEW"),S&&N.defines.push("RENDER_CUTOFF");const ze=(Ae,Le,Me)=>{for(const He of Ae){const tt=He.toUnwrapped(),Ft=t.getTile(He);if(X&&(!Ft||!Ft.hasData()))continue;L.activeTexture.set(R.TEXTURE0);const Mt=Lc(Ft,z,n,N);if(!Mt||!Mt.texture)continue;const{texture:ai,mix:ei,offset:yt,tileSize:Ut,buffer:Ui}=Mt;let _t,_i;X?(_t=Ln.disabled,_i=He.projMatrix):S?(_t=new Ln(R.LEQUAL,Ln.ReadWrite,l.depthRangeFor3D),_i=x?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(tt,ie)):(_t=l.depthModeForSublayer(He.overscaledZ-ve,n.paint.get("raster-opacity")===1?Ln.ReadWrite:Ln.ReadOnly,R.LESS),_i=l.transform.calculateProjMatrix(tt,ie));const Gt=l.terrain&&X?l.terrain.stencilModeForRTTOverlap(He):le[He.overscaledZ],fn=g?0:n.paint.get("raster-fade-duration");Ft.registerFadeDuration(fn);const Ri=t.findLoadedParent(He,0),di=qi(Ft,Ri,t,l.transform,fn);let $i,dn;l.terrain&&l.terrain.prepareDrawTile(),L.activeTexture.set(R.TEXTURE0),ai.bind(te,R.CLAMP_TO_EDGE),L.activeTexture.set(R.TEXTURE1),Ri?(Ri.texture&&Ri.texture.bind(te,R.CLAMP_TO_EDGE),$i=Math.pow(2,Ri.tileID.overscaledZ-Ft.tileID.overscaledZ),dn=[Ft.tileID.canonical.x*$i%1,Ft.tileID.canonical.y*$i%1]):ai.bind(te,R.CLAMP_TO_EDGE),ai.useMipmap&&L.extTextureFilterAnisotropic&&l.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Cn=l.transform;let zn;const xr=S?xd(Cn):[0,0,0,0];let sr,lr,Tr,Yr,As,ho=0;if(C&&z instanceof s.aJ&&z.coordinates.length>3)sr=Float32Array.from(s.bb(s.cH(new s.bT(0,0,0)))),lr=Float32Array.from(Cn.globeMatrix),Tr=Float32Array.from(s.cD(Cn)),Yr=[s.at(Cn.center.lng),s.aA(Cn.center.lat)],zn=z.elevatedGlobePerspectiveTransform,As=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const Wn=s.cE(He.canonical);ho=s.cF(Wn.getCenter().lat),sr=Float32Array.from(s.bb(s.cH(He.canonical))),lr=Float32Array.from(Cn.globeMatrix),Tr=Float32Array.from(s.cD(Cn)),Yr=[s.at(Cn.center.lng),s.aA(Cn.center.lat)],zn=[0,0],As=Float32Array.from(s.cG(He.canonical,Wn,ho,Cn.worldSize/Cn._pixelsPerMercatorPixel))}else zn=z instanceof s.aJ?z.perspectiveTransform:[0,0],sr=new Float32Array(16),lr=new Float32Array(9),Tr=new Float32Array(16),Yr=[0,0],As=new Float32Array(9);const Ks=No(_i,sr,lr,Tr,As,dn||[0,0],s.ae(l.transform.zoom),Yr,xr,$i||1,di,n,zn,S?n.paint.get("raster-elevation"):0,2,ei,yt,N.range,Ut,Ui,V),Rr=l.isTileAffectedByFog(He),ns=l.getOrCreateProgram("raster",{defines:N.defines,overrideFog:Rr});if(l.uploadCommonUniforms(L,ns,tt),z instanceof s.aJ){const Wn=z.elevatedGlobeVertexBuffer,$r=z.elevatedGlobeIndexBuffer;if(X||!x)z.boundsBuffer&&z.boundsSegments&&ns.draw(l,R.TRIANGLES,_t,ar.disabled,J,Qn.disabled,Ks,n.id,z.boundsBuffer,l.quadTriangleIndexBuffer,z.boundsSegments);else if(Wn&&$r){const ps=Cn.zoom<=s.c6?z.elevatedGlobeSegments:z.getSegmentsForLongitude(Cn.center.lng);ps&&ns.draw(l,R.TRIANGLES,_t,ar.disabled,J,Le,Ks,n.id,Wn,$r,ps)}}else if(C){_t=new Ln(R.LEQUAL,Ln.ReadOnly,l.depthRangeFor3D);const Wn=l.globeSharedBuffers;if(Wn){const[$r,ps,_s]=Wn.getGridBuffers(ho,!1);ns.draw(l,R.TRIANGLES,_t,Me||Gt,l.colorModeForRenderPass(),Le,Ks,n.id,$r,ps,_s)}}else{const{tileBoundsBuffer:Wn,tileBoundsIndexBuffer:$r,tileBoundsSegments:ps}=l.getTileBoundsBuffers(Ft);ns.draw(l,R.TRIANGLES,_t,Gt,J,Qn.disabled,Ks,n.id,Wn,$r,ps)}}if(!(z instanceof s.aJ)&&C)for(const He of Ae){const tt=He.canonical.y===(1<<He.canonical.z)-1;He.canonical.y===0&&Ct(!0,He,l,t,n,V,N,Le,Me||ar.disabled),tt&&Ct(!1,He,l,t,n,V,N,Le===Qn.frontCW?Qn.backCW:Qn.frontCW,Me||ar.disabled)}};C?ze(we,l.renderElevatedRasterBackface?Qn.backCW:Qn.frontCW,l.stencilModeFor3D()):ze(we,Qn.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,n,u,p,g){l.renderPass==="offscreen"&&function(x,S,C,L){if(!L.length)return;const R=x.context,z=R.gl,N=S.getSource();if(!(N instanceof Mr))return;const V=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let J=C.particlePositionRGBAImage;if(!J||J.width!==V){const we=function(ve){const ze=ve*ve,Ae=new Uint8Array(4*ze),Le=function(He){return He|=0,He=Math.imul(2747636419^He,2654435769),He=Math.imul(He^He>>>16,2654435769),((He=Math.imul(He^He>>>16,2654435769))>>>0)/4294967296},Me=1/1.1;for(let He=0;He<ze;He++){const tt=Me*(Le(2*He+0)+jn),Ft=Me*(Le(2*He+1)+jn),Mt=255*tt%1,ai=255*Ft%1,ei=Mt,yt=Ft-ai/255,Ut=ai;Ae[4*He+0]=255*(tt-Mt/255),Ae[4*He+1]=255*ei,Ae[4*He+2]=255*yt,Ae[4*He+3]=255*Ut}return Ae}(V);J=C.particlePositionRGBAImage=new s.r({width:V,height:V},we)}let X=C.particleFramebuffer;X?X.width!==V&&(X.destroy(),X=C.particleFramebuffer=R.createFramebuffer(V,V,!0,null)):X=C.particleFramebuffer=R.createFramebuffer(V,V,!0,null);const ie=[];for(const we of L){const ve=S.getTile(we);if(!(ve instanceof sa))continue;const ze=wd(ve,N,C);if(!ze)continue;const Ae=[ve.tileSize,ve.tileSize];let Le=C.tileFramebuffer;Le||(Le=C.tileFramebuffer=R.createFramebuffer(Ae[0],Ae[1],!0,null));let Me=ve.rasterParticleState;Me||(Me=ve.rasterParticleState=new bd(R,we,Ae,J));const He=Me.update(C.lastInvalidatedAt);Me.particleTextureDimension!==V&&Me.updateParticleTexture(we,J);const tt=Me.targetColorTexture;Me.targetColorTexture=Me.backgroundColorTexture,Me.backgroundColorTexture=tt;const Ft=Me.particleTexture0;Me.particleTexture0=Me.particleTexture1,Me.particleTexture1=Ft,ie.push([we,ze,Me,He])}if(ie.length===0)return;const te=s.q.now(),le=C.previousDrawTimestamp?.001*(te-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=te,C.hasColorMap()){R.activeTexture.set(z.TEXTURE0+2);let we=C.colorRampTexture;we||(we=C.colorRampTexture=new s.T(R,C.colorRamp,z.RGBA8)),we.bind(z.LINEAR,z.CLAMP_TO_EDGE)}R.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(we,ve,ze){const Ae=we.context,Le=Ae.gl,Me=ve.tileFramebuffer;Ae.activeTexture.set(Le.TEXTURE0);const He={u_texture:0,u_opacity:1.05*(Ft=ve.paint.get("raster-particle-fade-opacity-factor"))/(Ft+.05)},tt=we.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ft;for(const Mt of ze){const[,,ai,ei]=Mt;Me.colorAttachment.set(ai.targetColorTexture.texture),Ae.viewport.set([0,0,Me.width,Me.height]),Ae.clear({color:s.aj.transparent}),ei&&(ai.backgroundColorTexture.bind(Le.NEAREST,Le.CLAMP_TO_EDGE),tt.draw(we,Le.TRIANGLES,Ln.disabled,ar.disabled,cr.alphaBlended,Qn.disabled,He,ve.id,we.viewportBuffer,we.quadTriangleIndexBuffer,we.viewportSegments))}}(x,C,ie),function(we,ve,ze,Ae){const Le=we.context,Me=Le.gl,He=ze.tileFramebuffer,tt=we.transform.projection.name==="globe",Ft=ze.paint.get("raster-particle-max-speed");for(const Mt of Ae){const[ai,ei,yt]=Mt;Le.activeTexture.set(Me.TEXTURE0+0),ei.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),He.colorAttachment.set(yt.targetColorTexture.texture);const Ut=we.getOrCreateProgram("rasterParticleDraw",{defines:ei.defines,overrideFog:!1});Le.activeTexture.set(Me.TEXTURE0+1);const Ui=ei.scalarData?[]:[0,1,2,3].map(Gt=>s.d4[Gt](ai));Ui.push(ai);const _t=ai.canonical.x,_i=ai.canonical.y;for(const Gt of Ui){const fn=ve.getTile(tt?Gt.wrapped():Gt);if(!fn)continue;const Ri=fn.rasterParticleState;if(!Ri)continue;const di=Gt.canonical.x+(1<<Gt.canonical.z)*(Gt.wrap-ai.wrap),$i=Gt.canonical.y;Ri.particleTexture0.bind(Me.NEAREST,Me.CLAMP_TO_EDGE);const dn=Rl(1,Ri.particleTexture0.size[0],[di-_t,$i-_i],0,ei.texture.size,2,Ft,ei.textureOffset,ei.scale,ei.offset);Ut.draw(we,Me.POINTS,Ln.disabled,ar.disabled,cr.alphaBlended,Qn.disabled,dn,ze.id,Ri.particleIndexBuffer,void 0,Ri.particleSegment)}}}(x,S,C,ie),R.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(we,ve,ze,Ae){const Le=we.context,Me=Le.gl,He=ve.paint.get("raster-particle-max-speed"),tt=Ae*ve.paint.get("raster-particle-speed-factor")*.15,Ft=function(ai){return Math.pow(ai,6)}(.01+1*ve.paint.get("raster-particle-reset-rate-factor")),Mt=ve.particleFramebuffer;Le.viewport.set([0,0,Mt.width,Mt.height]);for(const ai of ze){const[,ei,yt]=ai;Le.activeTexture.set(Me.TEXTURE0+0),ei.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),Le.activeTexture.set(Me.TEXTURE0+1);const Ut=yt.particleTexture0;Ut.bind(Me.NEAREST,Me.CLAMP_TO_EDGE);const Ui=el(1,Ut.size[0],0,ei.texture.size,He,tt,Ft,ei.textureOffset,ei.scale,ei.offset);Mt.colorAttachment.set(yt.particleTexture1.texture),Le.clear({color:s.aj.transparent}),we.getOrCreateProgram("rasterParticleUpdate",{defines:ei.defines}).draw(we,Me.TRIANGLES,Ln.disabled,ar.disabled,cr.unblended,Qn.disabled,Ui,ve.id,we.viewportBuffer,we.quadTriangleIndexBuffer,we.viewportSegments)}}(x,C,ie,le)}(l,t,n,u),l.renderPass==="translucent"&&(function(x,S,C,L,R){const z=x.context,N=z.gl,V=S.getSource().tileSize,J=5*(1-s.ac(s.bY,s.bY+1,x.transform.zoom))*V+C.paint.get("raster-particle-elevation"),X=!x.options.moving,ie=x.transform.projection.name==="globe";if(!L.length)return;const[te,le]=x.stencilConfigForOverlap(L),we=[];ie&&we.push("PROJECTION_GLOBE_VIEW");const ve=x.stencilModeFor3D();for(const ze of le){const Ae=ze.toUnwrapped(),Le=S.getTile(ze);if(!Le.rasterParticleState)continue;const Me=Le.rasterParticleState,He=100;Le.registerFadeDuration(He);const tt=S.findLoadedParent(ze,0),Ft=qi(Le,tt,S,x.transform,He);let Mt,ai;x.terrain&&x.terrain.prepareDrawTile(),z.activeTexture.set(N.TEXTURE0),Me.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),z.activeTexture.set(N.TEXTURE1),tt&&tt.rasterParticleState?(tt.rasterParticleState.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Mt=Math.pow(2,tt.tileID.overscaledZ-Le.tileID.overscaledZ),ai=[Le.tileID.canonical.x*Mt%1,Le.tileID.canonical.y*Mt%1]):Me.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const ei=ie?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(Ae,X),yt=x.transform,Ut=Ed(yt),Ui=s.cE(ze.canonical),_t=s.cF(Ui.getCenter().lat);let _i,Gt,fn,Ri,di;ie?(_i=Float32Array.from(s.bb(s.cH(ze.canonical))),Gt=Float32Array.from(yt.globeMatrix),fn=Float32Array.from(s.cD(yt)),Ri=[s.at(yt.center.lng),s.aA(yt.center.lat)],di=Float32Array.from(s.cG(ze.canonical,Ui,_t,yt.worldSize/yt._pixelsPerMercatorPixel))):(_i=new Float32Array(16),Gt=new Float32Array(9),fn=new Float32Array(16),Ri=[0,0],di=new Float32Array(9));const $i=Da(ei,_i,Gt,fn,di,ai||[0,0],s.ae(x.transform.zoom),Ri,Ut,Mt||1,Ft,J),dn=x.isTileAffectedByFog(ze),Cn=x.getOrCreateProgram("rasterParticle",{defines:we,overrideFog:dn});if(x.uploadCommonUniforms(z,Cn,Ae),ie){const zn=new Ln(N.LEQUAL,Ln.ReadOnly,x.depthRangeFor3D),xr=0,sr=x.globeSharedBuffers;if(sr){const[lr,Tr,Yr]=sr.getGridBuffers(_t,xr!==0);Cn.draw(x,N.TRIANGLES,zn,ve,cr.alphaBlended,x.renderElevatedRasterBackface?Qn.frontCCW:Qn.backCCW,$i,C.id,lr,Tr,Yr)}}else{const zn=x.depthModeForSublayer(0,Ln.ReadOnly),xr=te[ze.overscaledZ],{tileBoundsBuffer:sr,tileBoundsIndexBuffer:lr,tileBoundsSegments:Tr}=x.getTileBoundsBuffers(Le);Cn.draw(x,N.TRIANGLES,zn,xr,cr.alphaBlended,Qn.disabled,$i,C.id,sr,lr,Tr)}}x.resetStencilClippingMasks()}(l,t,n,u),l.style.map.triggerRepaint())},background:function(l,t,n,u){const p=n.paint.get("background-color"),g=n.paint.get("background-color-use-theme").constantOr("default")==="none",x=n.paint.get("background-opacity"),S=n.paint.get("background-emissive-strength"),C=n.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const L=l.context,R=L.gl,z=l.transform,N=z.tileSize,V=n.paint.get("background-pattern");let J;if(V!==void 0&&(V===null||(J=l.imageManager.getPattern(V.toString(),n.scope,l.style.getLut(n.scope)),!J)))return;const X=!V&&p.a===1&&x===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==X)return;const ie=ar.disabled,te=l.depthModeForSublayer(0,X==="opaque"?Ln.ReadWrite:Ln.ReadOnly),le=l.colorModeForDrapableLayerRenderPass(S),we=V?"backgroundPattern":"background";let ve,ze=u;if(ze||(ve=l.getBackgroundTiles(),ze=Object.values(ve).map(Ae=>Ae.tileID)),V&&(L.activeTexture.set(R.TEXTURE0),l.imageManager.bind(l.context,n.scope)),C){const Ae=l.getOrCreateProgram(we,{overrideFog:!1,overrideRtt:!0}),Le=new Float32Array(s.ab.mat4.identity([])),Me=new s.aG(0,0,0,0,0),He=V?vd(Le,S,x,l,0,n.scope,J,C,{tileID:Me,tileSize:N}):uh(Le,S,x,p.toRenderColor(g?null:n.lut));Ae.draw(l,R.TRIANGLES,te,ie,le,Qn.disabled,He,n.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const Ae of ze){const Le=l.isTileAffectedByFog(Ae),Me=l.getOrCreateProgram(we,{overrideFog:Le}),He=Ae.toUnwrapped(),tt=u?Ae.projMatrix:l.transform.calculateProjMatrix(He);l.prepareDrawTile();const Ft=t?t.getTile(Ae):ve?ve[Ae.key]:new Yo(Ae,N,z.zoom,l),Mt=V?vd(tt,S,x,l,0,n.scope,J,C,{tileID:Ae,tileSize:N}):uh(tt,S,x,p.toRenderColor(g?null:n.lut));l.uploadCommonUniforms(L,Me,He);const{tileBoundsBuffer:ai,tileBoundsIndexBuffer:ei,tileBoundsSegments:yt}=l.getTileBoundsBuffers(Ft);Me.draw(l,R.TRIANGLES,te,ie,le,Qn.disabled,Mt,n.id,ai,ei,yt)}},sky:function(l,t,n){const u=l._atmosphere?s.ae(l.transform.zoom):1,p=n.paint.get("sky-opacity")*u;if(p===0)return;const g=l.context,x=n.paint.get("sky-type"),S=new Ln(g.gl.LEQUAL,Ln.ReadOnly,[0,1]),C=l.frameCounter/1e3%1;x==="atmosphere"?l.renderPass==="offscreen"?n.needsSkyboxCapture(l)&&(function(L,R,z,N){const V=L.context,J=V.gl;let X=R.skyboxFbo;if(!X){X=R.skyboxFbo=V.createFramebuffer(32,32,!0,null),R.skyboxGeometry=new Sd(V),R.skyboxTexture=V.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,R.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let we=0;we<6;++we)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+we,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(X.framebuffer),V.viewport.set([0,0,32,32]);const ie=R.getCenter(L,!0),te=L.getOrCreateProgram("skyboxCapture"),le=new Float64Array(16);s.ab.mat4.identity(le),s.ab.mat4.rotateY(le,le,.5*-Math.PI),Jo(L,R,te,le,ie,0),s.ab.mat4.identity(le),s.ab.mat4.rotateY(le,le,.5*Math.PI),Jo(L,R,te,le,ie,1),s.ab.mat4.identity(le),s.ab.mat4.rotateX(le,le,.5*-Math.PI),Jo(L,R,te,le,ie,2),s.ab.mat4.identity(le),s.ab.mat4.rotateX(le,le,.5*Math.PI),Jo(L,R,te,le,ie,3),s.ab.mat4.identity(le),Jo(L,R,te,le,ie,4),s.ab.mat4.identity(le),s.ab.mat4.rotateY(le,le,Math.PI),Jo(L,R,te,le,ie,5),V.viewport.set([0,0,L.width,L.height])}(l,n),n.markSkyboxValid(l)):l.renderPass==="sky"&&function(L,R,z,N,V){const J=L.context,X=J.gl,ie=L.transform,te=L.getOrCreateProgram("skybox");J.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,R.skyboxTexture);const le=((we,ve,ze,Ae,Le)=>({u_matrix:we,u_sun_direction:ve,u_cubemap:0,u_opacity:Ae,u_temporal_offset:Le}))(ie.skyboxMatrix,R.getCenter(L,!1),0,N,V);L.uploadCommonUniforms(J,te),te.draw(L,X.TRIANGLES,z,ar.disabled,L.colorModeForRenderPass(),Qn.backCW,le,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(l,n,S,p,C):x==="gradient"&&l.renderPass==="sky"&&function(L,R,z,N,V){const J=L.context,X=J.gl,ie=L.transform,te=L.getOrCreateProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Sd(J)),J.activeTexture.set(X.TEXTURE0);let le=R.colorRampTexture;le||(le=R.colorRampTexture=new s.T(J,R.colorRamp,X.RGBA8)),le.bind(X.LINEAR,X.CLAMP_TO_EDGE);const we=((ve,ze,Ae,Le,Me)=>({u_matrix:ve,u_color_ramp:0,u_center_direction:ze,u_radius:s.ai(Ae),u_opacity:Le,u_temporal_offset:Me}))(ie.skyboxMatrix,R.getCenter(L,!1),R.paint.get("sky-gradient-radius"),N,V);L.uploadCommonUniforms(J,te),te.draw(L,X.TRIANGLES,z,ar.disabled,L.colorModeForRenderPass(),Qn.backCW,we,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(l,n,S,p,C)},debug:function(l,t,n,u,p,g){for(let x=0;x<n.length;x++)if(p){const L=new s.aj(u.r*.8,u.g*.8,u.b*.8,1);$l(l,t,n[x],u,-1,-1,g),$l(l,t,n[x],u,-1,1,g),$l(l,t,n[x],u,1,1,g),$l(l,t,n[x],u,1,-1,g),$l(l,t,n[x],L,0,0,g)}else $l(l,t,n[x],u,0,0,g)},custom:function(l,t,n,u){const p=l.context,g=n.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&n.isDraped(t)){if(l.renderPass==="offscreen"){const x=g.prerender;if(x){if(l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const S=l.transform.pointMerc;x.call(g,p.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.ae(l.transform.zoom),[S.x,S.y],l.transform.pixelsPerMeterRatio)}else x.call(g,p.gl,l.transform.customLayerMatrix());p.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const S=g.renderToTile;if(S){const C=u[0].canonical,L=new s.aa(C.x+u[0].wrap*(1<<C.z),C.y,C.z);p.setDepthMode(Ln.disabled),p.setStencilMode(ar.disabled),p.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),S.call(g,p.gl,L),p.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),p.setStencilMode(ar.disabled);const x=g.renderingMode==="3d"?new Ln(l.context.gl.LEQUAL,Ln.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,Ln.ReadOnly);if(p.setDepthMode(x),l.transform.projection.name==="globe"){const S=l.transform.pointMerc;g.render(p.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.ae(l.transform.zoom),[S.x,S.y],l.transform.pixelsPerMeterRatio)}else g.render(p.gl,l.transform.customLayerMatrix());p.setDirty(),l.setBaseState(),p.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,n,u){if(l.renderPass==="opaque")return;const p=n.paint.get("model-opacity").constantOr(1);if(p===0)return;const g=n.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!g||l.terrain&&p<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof s.a9))return;const x=l.shadowRenderer,S=n.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,S||(x.enabled=!1));const C=()=>{x&&(x.useNormalOffset=!0,S||(x.enabled=!0))},L=t.getSource();if(l.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(te,le,we,ve,ze){const Ae=te.transform;if(Ae.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${Ae.projection.name} projection is not yet implemented`);const Le=Ae.getFreeCameraOptions().position;if(!te.modelManager)return;const Me=te.modelManager;we.modelManager=Me;const He=te.shadowRenderer;if(!we._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const tt=we._unevaluatedLayout._values["model-id"],Ft=Object.assign({},we.layout.get("model-id").parameters),Mt=te.style.order.indexOf(we.fqid);for(const ai of ve){const ei=le.getTile(ai).getBucket(we);if(!ei||ei.projection.name!==Ae.projection.name)continue;const yt=ei.getModelUris();yt&&!ei.modelsRequested&&(Me.addModelsFromBucket(yt,ze),ei.modelsRequested=!0);const Ut=Dc(ai,Ae);Ft.zoom=Ut;const Ui=tt.possiblyEvaluate(Ft);if(_l(te,ei,ai),ca.shadowUniformsInitialized=!1,ca.useSingleShadowCascade=!!He&&He.getMaxCascadeForTile(ai.toUnwrapped())===0,te.renderPass==="shadow"&&He){if(te.currentShadowCascade===1&&ei.isInsideFirstShadowMapFrustum)continue;const Gt=Ae.calculatePosMatrix(ai.toUnwrapped(),Ae.worldSize);if(ca.tileMatrix.set(Gt),ca.shadowTileMatrix=Float32Array.from(He.calculateShadowPassMatrixFromMatrix(Gt)),ca.aabb.min.fill(0),ca.aabb.max[0]=ca.aabb.max[1]=s.ag,ca.aabb.max[2]=0,vh(ei,ca,te,we.scope))continue}const _t=1<<ai.canonical.z,_i=[((Le.x-ai.wrap)*_t-ai.canonical.x)*s.ag,(Le.y*_t-ai.canonical.y)*s.ag,Le.z*_t*s.ag];te.conflationActive&&Object.keys(ei.instancesPerModel).length>0&&te.style.isLayerClipped(we,le.getSource())&&ei.updateReplacement(ai,te.replacementSource,Mt,ze)&&(ei.uploaded=!1,ei.upload(te.context));for(let Gt in ei.instancesPerModel){const fn=ei.instancesPerModel[Gt];fn.features.length>0&&(Gt=Ui.evaluate(fn.features[0].feature,{}));const Ri=Me.getModel(Gt,ze);if(Ri&&Ri.uploaded)for(const di of Ri.nodes)rc(te,we,di,fn,_i,ai,ca)}}}(l,t,n,u,L.type==="vector"?n.scope:""),void C();if(!L.loaded())return;if(L.type==="batched-model")return function(te,le,we,ve){we.resetLayerRenderingStats(te);const ze=te.context,Ae=te.transform,Le=te.style.fog,Me=te.shadowRenderer;if(Ae.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${Ae.projection.name} projection is not yet implemented`);const He=te.transform.getFreeCameraOptions().position,tt=s.ab.vec3.scale([],[He.x,He.y,He.z],te.transform.worldSize),Ft=s.ab.vec3.negate([],tt),Mt=s.ab.mat4.identity([]),ai=s.dj(Ae.center.lat,Ae.zoom),ei=s.ab.mat4.fromScaling([],[1,1,1/ai]);s.ab.mat4.translate(Mt,Mt,Ft);const yt=we.paint.get("model-opacity").constantOr(1),Ut=new Ln(ze.gl.LEQUAL,Ln.ReadWrite,te.depthRangeFor3D),Ui=new Ln(ze.gl.LEQUAL,Ln.ReadOnly,te.depthRangeFor3D),_t=new s.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),_i=te.renderPass==="shadow",Gt=_i&&Me?Me.getCurrentCascadeFrustum():Ae.getFrustum(Ae.scaleZoom(Ae.worldSize)),fn=we.paint.get("model-front-cutoff"),Ri=fn[2]<1,di=La(te,we.paint.get("model-cutoff-fade-range")),$i=we.getLayerRenderingStats();(function(dn,Cn,zn,xr){const sr=dn.terrain?dn.terrain.exaggeration():0,lr=dn.transform.zoom;for(const Tr of xr){const Yr=Cn.getTile(Tr).getBucket(zn);Yr&&(dn.conflationActive&&Yr.updateReplacement(Tr,dn.replacementSource),Yr.evaluateScale(dn,zn),dn.terrain&&sr>0&&Yr.elevationUpdate(dn.terrain,sr,Tr,zn.source),Yr.needsReEvaluation(dn,lr,zn)&&Yr.evaluate(zn))}})(te,le,we,ve),function(){let dn,Cn,zn;Ri?(dn=ve.length-1,Cn=-1,zn=-1):(dn=0,Cn=ve.length,zn=1);const xr=new Float64Array(16),sr=s.ab.vec3.create(),lr=new s.P(0,0);for(let Tr=dn;Tr!==Cn;Tr+=zn){const Yr=ve[Tr],As=le.getTile(Yr).getBucket(we);if(!As||!As.uploaded)continue;let ho=!1;Me&&(ho=Me.getMaxCascadeForTile(Yr.toUnwrapped())===0);const Ks=Ae.calculatePosMatrix(Yr.toUnwrapped(),Ae.worldSize),Rr=As.modelTraits;!_i&&Ri&&(s.ab.mat4.invert(xr,Ks),s.ab.vec3.transformMat4(sr,tt,xr),lr.x=sr[0],lr.y=sr[1]);const ns=[];for(const Wn of As.getNodesInfo()){if(Wn.hiddenByReplacement||!Wn.node.meshes)continue;const $r=Wn.node;let ps=0;te.terrain&&$r.elevation&&(ps=$r.elevation*te.terrain.exaggeration());const _s=(()=>{const Kr=Wn.aabb;return _t.min=[...Kr.min],_t.max=[...Kr.max],_t.min[2]+=ps,_t.max[2]+=ps,s.ab.vec3.transformMat4(_t.min,_t.min,Ks),s.ab.vec3.transformMat4(_t.max,_t.max,Ks),_t})(),so=Wn.evaluatedScale;if(so[0]<=1&&so[1]<=1&&so[2]<=1&&_s.intersects(Gt)===0)continue;if(!_i&&Ri){const Kr=.16666666666666666;Wn.cameraCollisionOpacity=tt[0]>_s.min[0]&&tt[0]<_s.max[0]&&tt[1]>_s.min[1]&&tt[1]<_s.max[1]&&tt[2]*ai<_s.max[2]&&$r.footprint&&s.bA(lr,$r.footprint)?Math.max(Wn.cameraCollisionOpacity-Kr,0):Math.min(1,Wn.cameraCollisionOpacity+Kr)}const Xo=[...Ks],Fo=$r.anchor?$r.anchor[0]:0,Bo=$r.anchor?$r.anchor[1]:0;s.ab.mat4.translate(Xo,Xo,[Fo*(so[0]-1),Bo*(so[1]-1),ps]),s.ab.vec3.exactEquals(so,s.dm)||s.ab.mat4.scale(Xo,Xo,so);const Ba=s.ab.mat4.multiply([],Xo,$r.matrix),ha=s.ab.mat4.multiply([],Ae.expandedFarZProjMatrix,Ba),oo=s.ab.mat4.multiply([],Ae.expandedFarZProjMatrix,Xo),js=s.ab.vec4.transformMat4([],[Fo,Bo,ps,1],ha)[2];$r.hidden=!1;let Fs=yt;_i||(Ri&&(Fs*=Wn.cameraCollisionOpacity,Fs*=xh(Xo,Ae,Wn.aabb,fn)),Fs*=cu(di,js)),Fs!==0?ns.push({nodeInfo:Wn,depth:js,opacity:Fs,wvpForNode:ha,wvpForTile:oo,nodeModelMatrix:Ba,tileModelMatrix:Xo}):$r.hidden=!0}_i||ns.sort((Wn,$r)=>!Ri||Wn.opacity===1&&$r.opacity===1?Wn.depth<$r.depth?-1:1:Wn.opacity===1?-1:$r.opacity===1?1:Wn.depth>$r.depth?-1:1);for(const Wn of ns){const $r=Wn.nodeInfo,ps=$r.node;let _s=s.ab.mat4.multiply([],ei,Wn.tileModelMatrix);s.ab.mat4.multiply(_s,Mt,_s);const so=s.ab.mat4.invert([],_s);s.ab.mat4.transpose(so,so),s.ab.mat4.scale(so,so,yh),_s=s.ab.mat4.multiply(_s,_s,ps.matrix);const Xo=te.renderPass==="light-beam",Fo=we.paint.get("model-color-use-theme").constantOr("default")==="none",Bo=Rr&s.dp.HasMapboxMeshFeatures,Ba=Bo?0:$r.evaluatedRMEA[0][2];for(let ha=0;ha<ps.meshes.length;++ha){const oo=ps.meshes[ha],js=ha===ps.lightMeshIndex;let Fs=Wn.wvpForNode;if(js){if(!Xo&&!te.terrain&&te.shadowRenderer){te.currentLayer<te.firstLightBeamLayer&&(te.firstLightBeamLayer=te.currentLayer);continue}Fs=Wn.wvpForTile}else if(Xo)continue;const Kr={defines:[]},Io=[];if(!_i&&Me&&(Me.useNormalOffset=!!oo.normalBuffer),ku(Kr.defines,Io,oo,te,Fo?null:we.lut),Bo||Kr.defines.push("DIFFUSE_SHADED"),ho&&Kr.defines.push("SHADOWS_SINGLE_CASCADE"),$i&&(_i?$i.numRenderedVerticesInShadowPass+=oo.vertexArray.length:$i.numRenderedVerticesInTransparentPass+=oo.vertexArray.length),_i){nc(oo,Wn.nodeModelMatrix,te,we);continue}let $o=null;if(Le){const bl=Dl(Wn.nodeModelMatrix,te.transform);if($o=new Float32Array(bl),Ae.projection.name!=="globe"){const Xa=oo.aabb.min,Ua=oo.aabb.max,[gu,wl]=Le.getOpacityForBounds(bl,Xa[0],Xa[1],Ua[0],Ua[1]);Kr.overrideFog=gu>=be||wl>=be}}const Us=oo.material;let da;Us.occlusionTexture&&Us.occlusionTexture.offsetScale&&(da=Us.occlusionTexture.offsetScale,Kr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Za=te.getOrCreateProgram("model",Kr);!_i&&Me&&Me.setupShadowsFromMatrix(Wn.tileModelMatrix,Za,Me.useNormalOffset),te.uploadCommonUniforms(ze,Za,null,$o);const Ma=Us.pbrMetallicRoughness;Ma.metallicFactor=.9,Ma.roughnessFactor=.5;const ba=Ju(new Float32Array(Fs),new Float32Array(_s),new Float32Array(so),new Float32Array(ps.matrix),te,Wn.opacity,Ma.baseColorFactor.toRenderColor(null),Us.emissiveFactor,Ma.metallicFactor,Ma.roughnessFactor,Us,Ba,we,[0,0,0],da);!js&&($r.hasTranslucentParts||Wn.opacity<1)&&Za.draw(te,ze.gl.TRIANGLES,Ut,ar.disabled,cr.disabled,Qn.backCCW,ba,we.id,oo.vertexBuffer,oo.indexBuffer,oo.segments,we.paint,te.transform.zoom,void 0,Io),Za.draw(te,ze.gl.TRIANGLES,js?Ui:Ut,ar.disabled,js||Wn.opacity<1||$r.hasTranslucentParts?cr.alphaBlended:cr.unblended,Qn.backCCW,ba,we.id,oo.vertexBuffer,oo.indexBuffer,oo.segments,we.paint,te.transform.zoom,void 0,Io)}}}}()}(l,t,n,u),void C();if(L.type!=="model")return;const R=L.getModels(),z=[],N=l.transform.getFreeCameraOptions().position,V=s.ab.vec3.scale([],[N.x,N.y,N.z],l.transform.worldSize);s.ab.vec3.negate(V,V);const J=[],X=[];let ie=0;for(const te of R){const le=n.paint.get("model-rotation").constantOr(null),we=n.paint.get("model-scale").constantOr(null),ve=n.paint.get("model-translation").constantOr(null);te.computeModelMatrix(l,le,we,ve,!0,!0,!1);const ze=s.ab.mat4.identity([]),Ae=s.dj(te.position.lat,l.transform.zoom),Le=s.ab.mat4.fromScaling([],[1,1,1/Ae]);s.ab.mat4.translate(ze,ze,V),z.push({zScaleMatrix:Le,negCameraPosMatrix:ze});for(const Me of te.nodes)Oc(l.transform,Me,te.matrix,l.transform.expandedFarZProjMatrix,ie,J,X);ie++}if(J.sort((te,le)=>le.depth-te.depth),l.renderPass!=="shadow"){if(p===1)for(const te of X)zl(te,l,n,z[te.modelIndex],ar.disabled,l.colorModeForRenderPass());else{for(const te of X)zl(te,l,n,z[te.modelIndex],ar.disabled,cr.disabled);for(const te of X)zl(te,l,n,z[te.modelIndex],l.stencilModeFor3D(),l.colorModeForRenderPass());l.resetStencilClippingMasks()}for(const te of J)zl(te,l,n,z[te.modelIndex],ar.disabled,l.colorModeForRenderPass());C()}else{for(const te of X)nc(te.mesh,te.nodeModelMatrix,l,n);for(const te of J)nc(te.mesh,te.nodeModelMatrix,l,n);C()}}},ac={line:function(l,t,n){if(l.hasElevatedBuckets=!1,l.hasNonElevatedBuckets=!1,l._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||l._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const g=t.getTile(p).getBucket(l);if(g&&(g.hasZOffset?l.hasElevatedBuckets=!0:l.hasNonElevatedBuckets=!0,l.hasElevatedBuckets&&l.hasNonElevatedBuckets))break}}}else l.hasNonElevatedBuckets=!0},model:function(l,t,n){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,u.type==="vector"?l.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const g of p)g.upload(n.context)},raster:function(l,t,n){const u=t.getSource();if(!(u instanceof Mr&&u.loaded()))return;const p=l.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const g=l.paint.get("raster-array-band")||u.getInitialBand(p);if(g==null)return;const x=t.getIds().map(S=>t.getTileByID(S));for(const S of x)S.updateNeeded(p,g)&&u.prepareTile(S,p,g)},"raster-particle":function(l,t,n){const u=t.getSource();if(!(u instanceof Mr&&u.loaded()))return;const p=l.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const g=l.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(g==null)return;const x=t.getIds().map(S=>t.getTileByID(S));for(const S of x)S.updateNeeded(p,g)&&u.prepareTile(S,p,g)}};class Ah{constructor(t,n,u,p,g){this.context=new fh(t,n),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const C of x)this._debugParams.enabledLayers[C]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const C of x)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],C);this.occlusionParams=new zc(g),this.setup(),this.numSublayers=D.maxUnderzooming+D.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new va(this),this._wireframeDebugCache=new bh,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,S,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p}updateTerrain(t,n){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ji(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,n),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=n.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const g=u+.78*(p-u);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ji(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*s.q.devicePixelRatio,this.height=n*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,n=new s.b4;n.emplaceBack(0,0),n.emplaceBack(s.ag,0),n.emplaceBack(0,s.ag),n.emplaceBack(s.ag,s.ag),this.tileExtentBuffer=t.createVertexBuffer(n,s.b6.members),this.tileExtentSegments=s.b7.simpleSegment(0,0,4,2);const u=new s.b4;u.emplaceBack(0,0),u.emplaceBack(s.ag,0),u.emplaceBack(0,s.ag),u.emplaceBack(s.ag,s.ag),this.debugBuffer=t.createVertexBuffer(u,s.b6.members),this.debugSegments=s.b7.simpleSegment(0,0,4,5);const p=new s.b4;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,s.b6.members),this.viewportSegments=s.b7.simpleSegment(0,0,4,2);const g=new s.aT;g.emplaceBack(0,0,0,0),g.emplaceBack(s.ag,0,s.ag,0),g.emplaceBack(0,s.ag,0,s.ag),g.emplaceBack(s.ag,s.ag,s.ag,s.ag),this.mercatorBoundsBuffer=t.createVertexBuffer(g,s.b9.members),this.mercatorBoundsSegments=s.b7.simpleSegment(0,0,4,2);const x=new s.aU;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const S=new s.b5;for(const L of[0,1,3,2,0])S.emplaceBack(L);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new s.T(t,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.ab.mat4.create();const C=this.context.gl;this.stencilClearMode=new ar({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Ln.disabled,this.stencilClearMode,cr.disabled,Qn.disabled,Ni(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,u){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const C of u)if(this._tileClippingMaskIDs[C.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=n.id;const p=this.context,g=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(cr.disabled),p.setDepthMode(Ln.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of u){const C=n.getTile(S),L=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:z,tileBoundsSegments:N}=this.getTileBoundsBuffers(C);x.draw(this,g.TRIANGLES,Ln.disabled,new ar({func:g.ALWAYS,mask:0},L,255,g.KEEP,g.KEEP,g.REPLACE),cr.disabled,Qn.disabled,Ni(S.projMatrix),"$clipping",R,z,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new ar({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new ar({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,u=t.sort((x,S)=>S.overscaledZ-x.overscaledZ),p=u[u.length-1].overscaledZ,g=u[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let S=0;S<g;S++)x[S+p]=new ar({func:n.GEQUAL,mask:255},S+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=g,[x,u]}return[{[p]:ar.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new cr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?cr.unblended:cr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new cr([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new s.aj(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,u,p=!1){if(this.depthOcclusion)return new Ln(this.context.gl.GREATER,Ln.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return Ln.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ln(u||this.context.gl.LEQUAL,n,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&u!==0&&(this.depthFBO=new dh(this.context,n,u,!1,"texture"),this.depthTexture=new s.T(this.context,{width:n,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,u,0,0,n,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const u=s.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const p=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(g).filter(yt=>{const Ut=p[yt];return!(Ut.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ut.type]});let S=x(),C=!1,L=!1;for(const yt of S){const Ut=p[yt];Ut.type==="circle"&&(C=!0),Ut.type==="symbol"&&(Ut.hasInitialOcclusionOpacityProperties?L=!0:C=!0)}let R=S.map(yt=>p[yt]);const z=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let N=0,V=!1;for(const yt in z){const Ut=z[yt];Ut.used&&(Ut.prepare(this.context),Ut.getSource().usedInConflation&&++N)}let J=!1;for(const yt of R)yt.isHidden(this.transform.zoom)||(yt.type==="clip"&&(J=!0),this.prepareLayer(yt));const X={},ie={},te={},le={},we={};for(const yt in z){const Ut=z[yt];X[yt]=Ut.getVisibleCoordinates(),ie[yt]=X[yt].slice().reverse(),te[yt]=Ut.getVisibleCoordinates(!0).reverse(),le[yt]=Ut.getShadowCasterCoordinates(),we[yt]=Ut.sortCoordinatesByDistance(X[yt])}const ve=yt=>{const Ut=this.style.getLayerSourceCache(yt);return Ut&&Ut.used?Ut.getSource():null};if(N||J||this._clippingActiveLastFrame){const yt=[],Ut=[];let Ui=0;for(const _t of R)this.isSourceForClippingOrConflation(_t,ve(_t))&&(yt.push(_t),Ut.push(Ui)),Ui++;if(yt&&(J||yt.length>1)||this._clippingActiveLastFrame){J=!1;const _t=[];for(let _i=0;_i<yt.length;_i++){const Gt=yt[_i],fn=Ut[_i],Ri=this.style.getLayerSourceCache(Gt);if(!Ri||!Ri.used||!Ri.getSource().usedInConflation&&Gt.type!=="clip")continue;let di=s.dx,$i=s.by.None;const dn=[];let Cn=!0;if(Gt.type==="clip"){di=fn;for(const zn of Gt.layout.get("clip-layer-types"))$i|=zn==="model"?s.by.Model:zn==="symbol"?s.by.Symbol:s.by.FillExtrusion;for(const zn of Gt.layout.get("clip-layer-scope"))dn.push(zn);Gt.isHidden(this.transform.zoom)?Cn=!1:J=!0}Cn&&_t.push({layer:Gt.fqid,cache:Ri,order:di,clipMask:$i,clipScope:dn})}this.replacementSource.setSources(_t),V=!0}}this._clippingActiveLastFrame=J,V||this.replacementSource.clear(),this.conflationActive=V,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let yt=0;yt<R.length;yt++){const Ut=R[yt],Ui=Ut.cutoffRange();if(this.longestCutoffRange=Math.max(Ui,this.longestCutoffRange),Ui>0){const _t=ve(Ut);_t&&(this.minCutoffZoom=Math.max(_t.minzoom,this.minCutoffZoom)),Ut.minzoom&&(this.minCutoffZoom=Math.max(Ut.minzoom,this.minCutoffZoom))}Ut.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=yt),this._lastOcclusionLayer=yt)}const ze=this.style&&this.style.fog;ze?(this._fogVisible=ze.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ze.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(te),this.opaquePassCutoff=0,S=x(),R=S.map(yt=>p[yt]));const Ae=this._shadowRenderer;if(Ae){Ae.updateShadowParameters(this.transform,this.style.directionalLight);for(const yt in z)for(const Ut of X[yt]){let Ui={min:0,max:0};this.terrain&&(Ui=this.terrain.getMinMaxForTile(Ut)||Ui),Ae.addShadowReceiver(Ut.toUnwrapped(),Ui.min,Ui.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Id(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Le=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Le&&!this._snow&&(this._snow=new Mh(this)),!Le&&this._snow&&(this._snow.destroy(),delete this._snow),Me&&!this._rain&&(this._rain=new Ou(this)),!Me&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!$n.has(this.context.gl))return;this.renderPass="offscreen";for(const yt of R){const Ut=t.getLayerSourceCache(yt);if(!yt.hasOffscreenPass()||yt.isHidden(this.transform.zoom))continue;const Ui=Ut?ie[Ut.id]:void 0;(yt.type==="custom"||yt.type==="raster"||yt.type==="raster-particle"||yt.isSky()||Ui&&Ui.length)&&this.renderLayer(this,Ut,yt,Ui)}this.depthRangeFor3D=[0,1-(R.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,le)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const He=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),tt=(()=>{if(n.showOverdrawInspector)return s.aj.black;const yt=this.style.fog;if(yt&&this.transform.projection.supportsFog){const Ut=this.style.getLut(yt.scope);if(!He){const Ui=yt.properties.get("color-use-theme")==="none",_t=yt.properties.get("color").toRenderColor(Ui?null:Ut).toArray01();return new s.aj(..._t)}if(He){const Ui=yt.properties.get("space-color-use-theme")==="none",_t=yt.properties.get("space-color").toRenderColor(Ui?null:Ut).toArray01();return new s.aj(..._t)}}return s.aj.transparent})();if(this.context.clear({color:tt,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&He&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const yt=R[this.currentLayer],Ut=t.getLayerSourceCache(yt);if(yt.isSky())continue;const Ui=Ut?(yt.is3D()?we:ie)[Ut.id]:void 0;this._renderTileClippingMasks(yt,Ut,Ui),this.renderLayer(this,Ut,yt,Ui)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&He&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const yt=R[this.currentLayer],Ut=t.getLayerSourceCache(yt);yt.isSky()&&this.renderLayer(this,Ut,yt,Ut?ie[Ut.id]:void 0)}function Ft(yt,Ut){let Ui;return Ut&&(Ui=(yt.type==="symbol"?te:yt.is3D()?we:ie)[Ut.id]),Ui}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const yt=R[this.currentLayer];if(yt.type==="raster"||yt.type==="raster-particle"){const Ut=t.getLayerSourceCache(yt);this.renderLayer(this,Ut,yt,Ft(yt,Ut))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Mt=0;Ae&&(Mt=Ae.getShadowCastingLayerCount());let ai=!1,ei=-1;for(let yt=0;yt<S.length;++yt){const Ut=R[yt];Ut.isHidden(this.transform.zoom)||Ut.is3D()&&(ei=yt)}for(L&&ei===-1&&(C=!0);this.currentLayer<S.length;){const yt=R[this.currentLayer],Ut=t.getLayerSourceCache(yt);if(yt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(yt)){if(yt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(C&&!ai&&this.terrain&&!this.transform.isOrthographic&&(ai=!0,this.blitDepth()),L&&ei!==-1&&this.currentLayer===ei+1&&!this.transform.isOrthographic&&this.blitDepth(),yt.is3D()||this.terrain||this._renderTileClippingMasks(yt,Ut,Ut?X[Ut.id]:void 0),this.renderLayer(this,Ut,yt,Ft(yt,Ut)),!this.terrain&&Ae&&Mt>0&&yt.hasShadowPass()&&--Mt==0&&(Ae.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ui=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ui;this.currentLayer++){const _t=R[this.currentLayer];if(!_t.hasLightBeamPass())continue;const _i=t.getLayerSourceCache(_t);this.renderLayer(this,_i,_t,_i?ie[_i.id]:void 0)}this.currentLayer=Ui,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ui=this.currentLayer;this.depthOcclusion=!0;for(const _t of this.layersWithOcclusionOpacity){this.currentLayer=_t;const _i=R[this.currentLayer],Gt=t.getLayerSourceCache(_i),fn=Gt?ie[Gt.id]:void 0;_i.is3D()||this.terrain||this._renderTileClippingMasks(_i,Gt,Gt?X[Gt.id]:void 0),this.renderLayer(this,Gt,_i,fn)}this.depthOcclusion=!1,this.currentLayer=Ui,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let yt=null;R.forEach(Ut=>{const Ui=t.getLayerSourceCache(Ut);Ui&&!Ut.isHidden(this.transform.zoom)&&Ui.getVisibleCoordinates().length&&(!yt||yt.getSource().maxzoom<Ui.getSource().maxzoom)&&(yt=Ui)}),yt&&this.options.showTileBoundaries&&oc.debug(this,yt,yt.getVisibleCoordinates(),s.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&oc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(yt){const Ut=yt.transform.padding;gh(yt,yt.transform.height-(Ut.top||0),3,Ru),gh(yt,Ut.bottom||0,3,Lf),_h(yt,Ut.left||0,3,Rf),_h(yt,yt.transform.width-(Ut.right||0),3,Td);const Ui=yt.transform.centerPoint;(function(_t,_i,Gt,fn){uu(_t,_i-1,Gt-10,2,20,fn),uu(_t,_i-10,Gt-1,20,2,fn)})(yt,Ui.x,yt.transform.height-Ui.y,Rc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),V||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,u=!n||!n.includes(t.type);if(ac[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);ac[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,n,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||oc[u.type](t,n,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(n.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,u=n.createQuery();this.deferredRenderGpuTimeQueries.push(u),n.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const u in t){const p=t[u],g=this.context.extTimerQuery,x=g.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(p.query),n[u]=x}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let u=0;for(const p of t)u+=n.getQueryParameter(p,n.QUERY_RESULT)/1e6,n.deleteQuery(p);return u}translatePosMatrix(t,n,u,p,g){if(!u[0]&&!u[1])return t;const x=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const L=Math.sin(x),R=Math.cos(x);u=[u[0]*R-u[1]*L,u[0]*L+u[1]*R]}const S=[g?u[0]:s.ar(n,u[0],this.transform.zoom),g?u[1]:s.ar(n,u[1],this.transform.zoom),0],C=new Float32Array(16);return s.ab.mat4.translate(C,t,S),C}saveTileTexture(t){const n=t.size[0],u=this._tileTextures[n];u?u.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||p||n!==void 0&&!n||g.push("FOG","FOG_DITHERING"),p&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,n){this.cache=this.cache||{};const u=n&&n.defines||[],p=n&&n.config,g=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(u),x=Lr.cacheKey(Ra[t],t,g,p);return this.cache[x]||(this.cache[x]=new Lr(this.context,t,Ra[t],p,hh[t],g)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const g=((x,S,C)=>{const L=x.properties.get("direction"),R=x.properties.get("color-use-theme")==="none",z=x.properties.get("color").toRenderColor(R?null:C.getLut(x.scope)).toArray01(),N=x.properties.get("intensity"),V=S.properties.get("color-use-theme")==="none",J=S.properties.get("color").toRenderColor(V?null:C.getLut(S.scope)).toArray01(),X=S.properties.get("intensity"),ie=[L.x,L.y,L.z],te=s.cM(J,X),le=s.cM(z,N);return{u_lighting_ambient_color:te,u_lighting_directional_dir:ie,u_lighting_directional_color:le,u_ground_radiance:pn(ie,le,te)}})(u,p,this.style);n.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,n,u,p,g){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const S=x.getOpacity(this.transform.pitch),C=((L,R,z,N,V,J,X,ie,te,le,we,ve)=>{const ze=L.transform,Ae=R.properties.get("color-use-theme")==="none",Le=R.properties.get("color").toRenderColor(Ae?null:L.style.getLut(R.scope)).toArray01();Le[3]=N;const Me=L.frameCounter/1e3%1,[He,tt]=R.properties.get("vertical-range");return{u_fog_matrix:z?ze.calculateFogTileMatrix(z):ve||L.identityMat,u_fog_range:R.getFovAdjustedRange(ze._fov),u_fog_color:Le,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(He,tt),tt],u_fog_temporal_offset:Me,u_frustum_tl:V,u_frustum_tr:J,u_frustum_br:X,u_frustum_bl:ie,u_globe_pos:te,u_globe_radius:le,u_viewport:we,u_globe_transition:s.ae(ze.zoom),u_is_globe:+(ze.projection.name==="globe")}})(this,x,u,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],p);n.setFogUniformValues(t,C)}g&&n.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)n[p.key]=t[p.key]||new Yo(p,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=be||n[1]>=be}setupDepthForOcclusion(t,n,u){const p=this.context,g=p.gl,x=!!u;var S;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),p.activeTexture.set(g.TEXTURE0),x||n.setTerrainUniformValues(p,u)}}function Bc(l,t){let n=!1,u=null;const p=()=>{u=null,n&&(l(),u=setTimeout(p,t),n=!1)};return()=>(n=!0,u||p(),u)}class Md{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Bc(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=Ch(t);if(this._hashName){const u=this._hashName;let p=!1;const g=location.hash.slice(1).split("&").map(x=>{const S=x.split("=")[0];return S===u?(p=!0,`${S}=${n}`):x}).filter(x=>x);return p||g.push(`${u}=${n}`),`#${g.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(n=u)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(u=>isNaN(u))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ch(l,t){const n=l.getCenter(),u=Math.round(100*l.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),x=Math.round(n.lng*g)/g,S=Math.round(n.lat*g)/g,C=l.getBearing(),L=l.getPitch();let R=t?`/${x}/${S}/${u}`:`${u}/${S}/${x}`;return(C||L)&&(R+="/"+Math.round(10*C)/10),L&&(R+=`/${Math.round(L)}`),R}const lc={linearity:.3,easing:s.dy(0,0,.3,1)},Ad=s.l({deceleration:2500,maxSpeed:1400},lc),Cd=s.l({deceleration:20,maxSpeed:1400},lc),Pd=s.l({deceleration:1e3,maxSpeed:360},lc),Ld=s.l({deceleration:1e3,maxSpeed:90},lc);class Rd{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=s.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)n.zoom+=g.zoomDelta||0,n.bearing+=g.bearingDelta||0,n.pitch+=g.pitchDelta||0,g.panDelta&&n.pan._add(g.panDelta),g.around&&(n.around=g.around),g.pinchAround&&(n.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(n.pan.mag()){const g=cc(n.pan.mag(),u,s.l({},Ad,t||{}));p.offset=n.pan.mult(g.amount/n.pan.mag()),p.center=this._map.transform.center,uc(p,g)}if(n.zoom){const g=cc(n.zoom,u,Cd);p.zoom=this._map.transform.zoom+g.amount,uc(p,g)}if(n.bearing){const g=cc(n.bearing,u,Pd);p.bearing=this._map.transform.bearing+s.aw(g.amount,-179,179),uc(p,g)}if(n.pitch){const g=cc(n.pitch,u,Ld);p.pitch=this._map.transform.pitch+g.amount,uc(p,g)}if(p.zoom||p.bearing){const g=n.pinchAround===void 0?n.around:n.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function uc(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function cc(l,t,n){const{maxSpeed:u,linearity:p,deceleration:g}=n,x=s.aw(l*p/(t/1e3),-u,u),S=Math.abs(x)/(g*p);return{easing:n.easing,duration:1e3*S,amount:x*(S/2)}}class Sa extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u,p={}){const g=Ue(n.getCanvasContainer(),u),x=n.unproject(g);super(t,s.l({point:g,lngLat:x,originalEvent:u},p)),this._defaultPrevented=!1,this.target=n}}class hc extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u){const p=t==="touchend"?u.changedTouches:u.touches,g=qe(n.getCanvasContainer(),p),x=g.map(C=>n.unproject(C)),S=g.reduce((C,L,R,z)=>C.add(L.div(z.length)),new s.P(0,0));super(t,{points:g,point:S,lngLats:x,lngLat:n.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class kd extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class Of{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new kd(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Sa(t.type,this._map,t))}mouseup(t){this._map.fire(new Sa(t.type,this._map,t))}preclick(t){const n=s.l({},t);n.type="preclick",this._map.fire(new Sa(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Sa(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Sa(t.type,this._map,t))}mouseover(t){this._map.fire(new Sa(t.type,this._map,t))}mouseout(t){this._map.fire(new Sa(t.type,this._map,t))}touchstart(t){return this._firePreventable(new hc(t.type,this._map,t))}touchmove(t){this._map.fire(new hc(t.type,this._map,t))}touchend(t){this._map.fire(new hc(t.type,this._map,t))}touchcancel(t){this._map.fire(new hc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Df{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Sa(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Sa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Sa(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yo{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(dt(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const u=n,p=this._startPos,g=this._lastPos;if(!p||!g||g.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=Qt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(p.x,u.x),S=Math.max(p.x,u.x),C=Math.min(p.y,u.y),L=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${C}px)`,this._box.style.width=S-x+"px",this._box.style.height=L-C+"px")})}mouseupWindow(t,n){if(!this._active)return;const u=this._startPos,p=n;if(u&&t.button===0){if(this.reset(),Ie(),u.x!==p.x||u.y!==p.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),vt(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new s.z(t,{originalEvent:n}))}}function Uc(l,t){const n={};for(let u=0;u<l.length;u++)n[l[u].identifier]=t[u];return n}class zf{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const g=new s.P(0,0);for(const x of p)g._add(x);return g.div(p.length)}(n),this.touches=Uc(u,n)))}touchmove(t,n,u){if(this.aborted||!this.centroid)return;const p=Uc(u,n);for(const g in this.touches){const x=p[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,n,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Ph{constructor(t){this.singleTap=new zf(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,u){this.singleTap.touchstart(t,n,u)}touchmove(t,n,u){this.singleTap.touchmove(t,n,u)}touchend(t,n,u){const p=this.singleTap.touchend(t,n,u);if(p){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class dc{constructor(){this._zoomIn=new Ph({numTouches:1,numTaps:2}),this._zoomOut=new Ph({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,u){this._zoomIn.touchstart(t,n,u),this._zoomOut.touchstart(t,n,u)}touchmove(t,n,u){this._zoomIn.touchmove(t,n,u),this._zoomOut.touchmove(t,n,u)}touchend(t,n,u){const p=this._zoomIn.touchend(t,n,u),g=this._zoomOut.touchend(t,n,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Od={0:1,2:2};class fc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const u=De(t);this._correctButton(t,u)&&(this._lastPoint=n,this._eventButton=u)}mousemoveWindow(t,n){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,g){const x=Od[g];return p.buttons===void 0||(p.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(u,n)}}mouseupWindow(t){this._lastPoint&&De(t)===this._eventButton&&(this._moved&&Ie(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vc extends fc{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class vl extends fc{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const u=.8*(n.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){t.preventDefault()}}class pc extends fc{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const u=-.5*(n.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){t.preventDefault()}}class So{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),s.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,n,u){return this._calculateTransform(t,n,u)}touchmove(t,n,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!s.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,u)}}touchend(t,n,u){this._calculateTransform(t,n,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,u){u.length>0&&(this._active=!0);const p=Uc(u,n),g=new s.P(0,0),x=new s.P(0,0);let S=0;for(const L in p){const R=p[L],z=this._touches[L];z&&(g._add(R),x._add(R.sub(z)),S++,p[L]=R)}if(this._touches=p,S<this._minTouches||!x.mag())return;const C=x.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Qt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ha{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,u){return{}}touchstart(t,n,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[g,x]=p,S=Du(u,n,g),C=Du(u,n,x);if(!S||!C)return;const L=this._aroundCenter?null:S.add(C).div(2);return this._move([S,C],L,t)}touchend(t,n,u){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,x=Du(u,n,p),S=Du(u,n,g);x&&S||(this._active&&Ie(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Du(l,t,n){for(let u=0;u<l.length;u++)if(l[u].identifier===n)return t[u]}function mc(l,t){return Math.log(l/t)/Math.LN2}class Dd extends Ha{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(mc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:mc(this._distance,u),pinchAround:n}}}function zd(l,t){return 180*l.angleWith(t)/Math.PI}class gc extends Ha{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:zd(this._vector,u),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=zd(t,u);return Math.abs(p)<n}}function Lh(l){return Math.abs(l.y)>Math.abs(l.x)}class Nf extends Ha{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Lh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,u){const p=this._lastPoints;if(!p)return;const g=t[0].sub(p[0]),x=t[1].sub(p[1]);return this._map._cooperativeGestures&&!s.dz()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(g,x,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5})}gestureBeginsVertically(t,n,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=n.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=t.y>0==n.y>0;return Lh(t)&&Lh(n)&&x}}const Rh={panStep:100,bearingStep:15,pitchStep:10};class kh{constructor(){const t=Rh;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,u=0,p=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:S=>{const C=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:hu,zoom:n?Math.round(C)+n*(t.shiftKey?2:1):C,bearing:S.getBearing()+u*this._bearingStep,pitch:S.getPitch()+p*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hu(l){return l*(2-l)}const du=4.000244140625,Nl=1/450;class tl{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Nl,s.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=s.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,n!==0&&n%du==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Ue(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>du?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&R!==0&&(R=1/R);const z=n(),N=Math.pow(2,z),V=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(V*R))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:n(),p=this._startZoom,g=this._easing;let x,S=!1;if(this._type==="wheel"&&p&&g){const L=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),R=g(L);x=s.af(p,u,R),L<1?this._frameId||(this._frameId=!0):S=!0}else x=u,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=x-n();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=s.dA;if(this._prevEase){const u=this._prevEase,p=(s.q.now()-u.start)/u.duration,g=u.easing(p+.01)-u.easing(p),x=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-x*x);n=s.dy(x,S,.25,1)}return this._prevEase={start:s.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Qt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Kl{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jl{constructor(){this._tap=new Ph({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=n[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,n,u))}touchmove(t,n,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=n[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,n,u)}touchend(t,n,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,n,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ff{constructor(t,n,u){this._el=t,this._mousePan=n,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bf{constructor(t,n,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Uf{constructor(t,n,u,p){this._el=t,this._touchZoom=n,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Gc=l=>l.zoom||l.drag||l.pitch||l.rotate;class Nd extends s.z{}class _a{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const u=s.ab.vec3.sub([],n,t);this.radius=s.ab.vec3.length(u[2]<0?s.ab.vec3.div([],u,this.constants):[u[0],u[1],0])}projectRay(t){s.ab.vec3.div(t,t,this.constants),s.ab.vec3.normalize(t,t),s.ab.vec3.mul(t,t,this.constants);const n=s.ab.vec3.scale([],t,this.radius);if(n[2]>0){const u=s.ab.vec3.scale([],[0,0,1],s.ab.vec3.dot(n,[0,0,1])),p=s.ab.vec3.scale([],s.ab.vec3.normalize([],[n[0],n[1],0]),this.radius),g=s.ab.vec3.add([],n,s.ab.vec3.scale([],s.ab.vec3.sub([],s.ab.vec3.add([],p,u),n),2));n[0]=g[0],n[1]=g[1]}return n}}function zu(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Fd{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rd(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new _a,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),s.aP(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,x]of this._listeners){const S=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(g,S,x)}}destroy(){for(const[t,n,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,p,u)}}_addDefaultHandlers(t){const n=this._map,u=n.getCanvasContainer();this._add("mapEvent",new Of(n,t));const p=n.boxZoom=new yo(n,t);this._add("boxZoom",p);const g=new dc,x=new fu;n.doubleClickZoom=new Kl(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const S=new Jl;this._add("tapDragZoom",S);const C=n.touchPitch=new Nf(n);this._add("touchPitch",C);const L=new vl(t),R=new pc(t);n.dragRotate=new Bf(t,L,R),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const z=new Vc(t),N=new So(n,t);n.dragPan=new Ff(u,z,N),this._add("mousePan",z),this._add("touchPan",N,["touchZoom","touchRotate"]);const V=new gc,J=new Dd;n.touchZoomRotate=new Uf(u,J,V,S),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Df(n));const X=n.scrollZoom=new tl(n,this);this._add("scrollZoom",X,["mousePan"]);const ie=n.keyboard=new kh;this._add("keyboard",ie);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[te]&&n[te].enable(t[te])}_add(t,n,u){this._handlers.push({handlerName:t,handler:n,allowed:u}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,u){for(const p in t)if(p!==u&&(!n||n.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const u of t)this._el.contains(u.target)&&n.push(u);return n}handleEvent(t,n){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,g={needsRenderFrame:!1},x={},S={},C=t.touches?this._getMapTouches(t.touches):void 0,L=C?qe(this._el,C):u?void 0:Ue(this._el,t);for(const{handlerName:N,handler:V,allowed:J}of this._handlers){if(!V.isEnabled())continue;let X;this._blockedByActive(S,J,N)?V.reset():V[n||t.type]&&(X=V[n||t.type](t,L,C),this.mergeHandlerResult(g,x,X,N,p),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||V.isActive())&&(S[N]=V)}const R={};for(const N in this._previousActiveHandlers)S[N]||(R[N]=p);this._previousActiveHandlers=S,(Object.keys(R).length||zu(g))&&(this._changes.push([g,x,R]),this._triggerRenderFrame()),(Object.keys(S).length||zu(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=g;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(t,n,u,p,g){if(!u)return;s.l(t,u);const x={handlerName:p,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(n.zoom=x),u.panDelta!==void 0&&(n.drag=x),u.pitchDelta!==void 0&&(n.pitch=x),u.bearingDelta!==void 0&&(n.rotate=x)}_applyChanges(){const t={},n={},u={};for(const[p,g,x]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),s.l(n,g),s.l(u,x);this._updateMapTransform(t,n,u),this._changes=[]}_updateMapTransform(t,n,u){const p=this._map,g=p.transform,x=le=>[le.x,le.y,le.z];if((le=>{const we=this._eventsInProgress.drag;return we&&!this._handlersById[we.handlerName].isActive()})()&&!zu(t)){const le=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),le!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&p._stop(!0),!zu(t))return void this._fireEvents(n,u,!0);let{panDelta:S,zoomDelta:C,bearingDelta:L,pitchDelta:R,around:z,aroundCoord:N,pinchAround:V}=t;g._isCameraConstrained&&(C>0&&(C=0),g._isCameraConstrained=!1),V!==void 0&&(z=V),(C||(le=>n[le]&&!this._eventsInProgress[le])("drag"))&&z&&(this._dragOrigin=x(g.pointCoordinate3D(z)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",p._stop(!0),z=z||p.transform.centerPoint,L&&(g.bearing+=L),R&&(g.pitch+=R),g._updateCameraState();const J=[0,0,0];if(S)if(g.projection.name==="mercator"){const le=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(z).dir),we=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(z.sub(S)).dir);J[0]=we[0]-le[0],J[1]=we[1]-le[1]}else{const le=g.pointCoordinate(z);if(g.projection.name==="globe"){S=S.rotate(-g.angle);const we=g._pixelsPerMercatorPixel/g.worldSize;J[0]=-S.x*s.dB(s.aS(le.y))*we,J[1]=-S.y*s.dB(g.center.lat)*we}else{const we=g.pointCoordinate(z.sub(S));le&&we&&(J[0]=we.x-le.x,J[1]=we.y-le.y)}}const X=g.zoom,ie=[0,0,0];if(C){const le=x(N||g.pointCoordinate3D(z)),we={dir:s.ab.vec3.normalize([],s.ab.vec3.sub([],le,g._camera.position))};if(we.dir[2]<0){const ve=g.zoomDeltaToMovement(le,C);s.ab.vec3.scale(ie,we.dir,ve)}}const te=s.ab.vec3.add(J,J,ie);g._translateCameraConstrained(te),C&&Math.abs(g.zoom-X)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,u,!0)}_fireEvents(t,n,u){const p=Gc(this._eventsInProgress),g=Gc(t),x={};for(const R in t){const{originalEvent:z}=t[R];this._eventsInProgress[R]||(x[`${R}start`]=z),this._eventsInProgress[R]=t[R]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const R in x)this._fireEvent(R,x[R]);g&&this._fireEvent("move",g.originalEvent);for(const R in t){const{originalEvent:z}=t[R];this._fireEvent(R,z)}const S={};let C;for(const R in this._eventsInProgress){const{handlerName:z,originalEvent:N}=this._eventsInProgress[R];this._handlersById[z].isActive()||(delete this._eventsInProgress[R],C=n[z]||N,S[`${R}end`]=C)}for(const R in S)this._fireEvent(R,S[R]);const L=Gc(this._eventsInProgress);if(u&&(p||g)&&!L){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;R?(z(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:C})):(this._map.fire(new s.z("moveend",{originalEvent:C})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new s.z(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Nd("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Bd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Nu extends s.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,s.aP(["_renderFrameCallback"],this)}getCenter(){return new s.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,u){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.l({offset:t},n),u)}panTo(t,n,u){return this.easeTo(s.l({center:t},n),u)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,u){return this.easeTo(s.l({zoom:t},n),u)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,u){return this.easeTo(s.l({bearing:t},n),u)}resetNorth(t,n){return this.rotateTo(0,s.l({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=s.az.convert(t);const u=n&&n.bearing||0,p=n&&n.pitch||0,g=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,g,x,u,p,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?s.l({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:s.l({},n,t)}_extendCameraOptions(t){return(t=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const u=n.max[0]-n.min[0],p=n.max[1]-n.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,u,p,g,x){const S=t.clone(),C=this._extendCameraOptions(x);S.bearing=p,S.pitch=g;const L=s.bO.convert(n),R=s.bO.convert(u),z=.5*(L.lat+R.lat),N=.5*(L.lng+R.lng),V=s.dC(z,N),J=s.ab.vec3.normalize([],V),X=s.ab.vec3.normalize([],s.ab.vec3.cross([],J,[0,1,0])),ie=s.ab.vec3.cross([],X,J),te=[X[0],X[1],X[2],0,ie[0],ie[1],ie[2],0,J[0],J[1],J[2],0,0,0,0,1],le=[V,s.dC(L.lat,L.lng),s.dC(R.lat,L.lng),s.dC(R.lat,R.lng),s.dC(L.lat,R.lng),s.dC(z,L.lng),s.dC(z,R.lng),s.dC(L.lat,N),s.dC(R.lat,N)];let we=s.cd.fromPoints(le.map(Gt=>[s.ab.vec3.dot(X,Gt),s.ab.vec3.dot(ie,Gt),s.ab.vec3.dot(J,Gt)]));const ve=s.ab.vec3.transformMat4([],we.center,te);s.ab.vec3.squaredLength(ve)===0&&s.ab.vec3.set(ve,0,0,1),s.ab.vec3.normalize(ve,ve),s.ab.vec3.scale(ve,ve,s.ax),S.center=s.dD(ve);const ze=S.getWorldToCameraMatrix(),Ae=s.ab.mat4.invert(new Float64Array(16),ze);we=s.cd.applyTransform(we,s.ab.mat4.multiply([],ze,te));const Le=this._extendAABB(we,S,C,p);if(!Le)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");we=Le,s.ab.vec3.transformMat4(ve,ve,ze);const Me=.5*(we.max[2]-we.min[2]),He=this._minimumAABBFrustumDistance(S,we),tt=s.ab.vec3.scale([],[0,0,1],Me),Ft=s.ab.vec3.add(tt,ve,tt),Mt=He+(S.pitch===0?0:s.ab.vec3.distance(ve,Ft)),ai=S.globeCenterInViewSpace,ei=s.ab.vec3.sub([],ve,[ai[0],ai[1],ai[2]]);s.ab.vec3.normalize(ei,ei),s.ab.vec3.scale(ei,ei,Mt);const yt=s.ab.vec3.add([],ve,ei);s.ab.vec3.transformMat4(yt,yt,Ae);const Ut=s.ds/s.ax,Ui=s.ab.vec3.length(yt),_t=s.bH(Math.max(Ui*Ut-s.ds,Number.EPSILON),0),_i=Math.min(S.zoomFromMercatorZAdjusted(_t),C.maxZoom);return _i>.5*(s.c6+s.bY)?(S.setProjection({name:"mercator"}),S.zoom=_i,this._cameraForBounds(S,n,u,p,g,x)):{center:S.center,zoom:_i,bearing:p,pitch:g}}_extendAABB(t,n,u,p){const g=.5*((u.padding.left||0)+(u.padding.right||0)),x=.5*((u.padding.top||0)+(u.padding.bottom||0)),S=x,C=g,L=g,R=x,z=n.width-(C+L),N=n.height-(S+R),V=s.ab.vec3.sub([],t.max,t.min),J=Math.min(z/V[0],N/V[1]),X=Math.min(n.scaleZoom(n.scale*J),u.maxZoom);if(isNaN(X))return null;const ie=n.scale/n.zoomScale(X),te=new s.cd([t.min[0]-C*ie,t.min[1]-R*ie,t.min[2]],[t.max[0]+L*ie,t.max[1]+S*ie,t.max[2]]),le=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new s.P(u.offset.x,u.offset.y):s.P.convert(u.offset)).rotate(-s.ai(p));return te.center[0]-=le.x*ie,te.center[1]+=le.y*ie,te}queryTerrainElevation(t,n){const u=this.transform.elevation;return u?(n=s.l({},{exaggerated:!0},n),u.getAtPoint(s.aa.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,u,p,g,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,u,p,g,x);const S=t.clone(),C=this._extendCameraOptions(x);S.bearing=p,S.pitch=g;const L=s.bO.convert(n),R=s.bO.convert(u),z=new s.bO(L.lng,R.lat),N=new s.bO(R.lng,L.lat),V=S.project(L),J=S.project(R),X=this.queryTerrainElevation(L),ie=this.queryTerrainElevation(R),te=this.queryTerrainElevation(z),le=this.queryTerrainElevation(N),we=[[V.x,V.y,Math.min(X||0,ie||0,te||0,le||0)],[J.x,J.y,Math.max(X||0,ie||0,te||0,le||0)]];let ve=s.cd.fromPoints(we);const ze=S.getWorldToCameraMatrix(),Ae=s.ab.mat4.invert(new Float64Array(16),ze);ve=s.cd.applyTransform(ve,ze);const Le=this._extendAABB(ve,S,C,p);if(!Le)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=Le;const Me=.5*s.ab.vec3.sub([],ve.max,ve.min)[2],He=this._minimumAABBFrustumDistance(S,ve),tt=[0,0,1,0];s.ab.vec4.transformMat4(tt,tt,ze),s.ab.vec4.normalize(tt,tt);const Ft=s.ab.vec3.scale([],tt,He+Me),Mt=s.ab.vec3.add([],ve.center,Ft);s.ab.vec3.transformMat4(ve.center,ve.center,Ae),s.ab.vec3.transformMat4(Mt,Mt,Ae);const ai=S.unproject(new s.P(ve.center[0],ve.center[1])),ei=s.dE(S.projection,ai),yt=Math.pow(2,ei),Ut=Math.min(S._zoomFromMercatorZ(Mt[2]*S.pixelsPerMeter*yt/S.worldSize),C.maxZoom);return S.mercatorFromTransition&&Ut<.5*(s.c6+s.bY)?(S.setProjection({name:"globe"}),S.zoom=Ut,this._cameraForBounds(S,n,u,p,g,x)):{center:ai,zoom:Ut,bearing:p,pitch:g}}fitBounds(t,n,u){const p=this.cameraForBounds(t,n);return this._fitInternal(p,n,u)}fitScreenCoordinates(t,n,u,p,g){const x=s.P.convert(t),S=s.P.convert(n),C=new s.P(Math.min(x.x,S.x),Math.min(x.y,S.y)),L=new s.P(Math.max(x.x,S.x),Math.max(x.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,S))return this;const R=this.transform.pointLocation3D(C),z=this.transform.pointLocation3D(L),N=this.transform.pointLocation3D(new s.P(C.x,L.y)),V=this.transform.pointLocation3D(new s.P(L.x,C.y)),J=[Math.min(R.lng,z.lng,N.lng,V.lng),Math.min(R.lat,z.lat,N.lat,V.lat)],X=[Math.max(R.lng,z.lng,N.lng,V.lng),Math.max(R.lat,z.lat,N.lat,V.lat)],ie=p&&p.pitch?p.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,J,X,u,ie,p);return this._fitInternal(te,p,g)}_fitInternal(t,n,u){return t?(n=s.l(t,n)).linear?this.easeTo(n,u):this.flyTo(n,u):this}jumpTo(t,n){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,g=!1,x=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=s.bO.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(g=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(x=!0,u.pitch=+t.pitch);const S=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(S))if(t.retainPadding===!1){const C=u.clone();C.padding=S,u.setLocationAtPoint(u.center,C.centerPoint)}else u.padding=S;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new s.z("movestart",n)).fire(new s.z("move",n)),p&&this.fire(new s.z("zoomstart",n)).fire(new s.z("zoom",n)).fire(new s.z("zoomend",n)),g&&this.fire(new s.z("rotatestart",n)).fire(new s.z("rotate",n)).fire(new s.z("rotateend",n)),x&&this.fire(new s.z("pitchstart",n)).fire(new s.z("pitch",n)).fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Bd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const u=this.transform;if(!u.projection.supportsFreeCamera)return s.w(Bd),this;this.stop();const p=u.zoom,g=u.pitch,x=u.bearing;u.setFreeCameraOptions(t);const S=p!==u.zoom,C=g!==u.pitch,L=x!==u.bearing;return this.fire(new s.z("movestart",n)).fire(new s.z("move",n)),S&&this.fire(new s.z("zoomstart",n)).fire(new s.z("zoom",n)).fire(new s.z("zoomend",n)),L&&this.fire(new s.z("rotatestart",n)).fire(new s.z("rotate",n)).fire(new s.z("rotateend",n)),C&&this.fire(new s.z("pitchstart",n)).fire(new s.z("pitch",n)).fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=s.l({offset:[0,0],duration:500,easing:s.dA},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),S=this.getPadding(),C="zoom"in t?+t.zoom:p,L="bearing"in t?this._normalizeBearing(t.bearing,g):g,R="pitch"in t?+t.pitch:x,z=this._extendPadding(t.padding),N=s.P.convert(t.offset);let V,J,X;if(u.projection.name==="globe"){const tt=s.aa.fromLngLat(u.center),Ft=N.rotate(-u.angle);tt.x+=Ft.x/u.worldSize,tt.y+=Ft.y/u.worldSize;const Mt=tt.toLngLat(),ai=s.bO.convert(t.center||Mt);this._normalizeCenter(ai),V=u.centerPoint.add(Ft),J=new s.P(tt.x,tt.y).mult(u.worldSize),X=new s.P(s.at(ai.lng),s.aA(ai.lat)).mult(u.worldSize).sub(J)}else{V=u.centerPoint.add(N);const tt=u.pointLocation(V),Ft=s.bO.convert(t.center||tt);this._normalizeCenter(Ft),J=u.project(tt),X=u.project(Ft).sub(J)}const ie=u.zoomScale(C-p);let te,le;t.around&&(te=s.bO.convert(t.around),le=u.locationPoint(te));const we=this._zooming||C!==p,ve=this._rotating||g!==L,ze=this._pitching||R!==x,Ae=!u.isPaddingEqual(z),Le=t.retainPadding===!1?u.clone():u,Me=tt=>Ft=>{if(we&&(tt.zoom=s.af(p,C,Ft)),ve&&(tt.bearing=s.af(g,L,Ft)),ze&&(tt.pitch=s.af(x,R,Ft)),Ae&&(Le.interpolatePadding(S,z,Ft),V=Le.centerPoint.add(N)),te)tt.setLocationAtPoint(te,le);else{const Mt=tt.zoomScale(tt.zoom-p),ai=C>p?Math.min(2,ie):Math.max(.5,ie),ei=Math.pow(ai,1-Ft),yt=tt.unproject(J.add(X.mult(Ft*ei)).mult(Mt));tt.setLocationAtPoint(tt.renderWorldCopies?yt.wrap():yt,V)}return t.preloadOnly||this._fireMoveEvents(n),tt};if(t.preloadOnly){const tt=this._emulate(Me,t.duration,u);return this._preloadTiles(tt),this}const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=we,this._rotating=ve,this._pitching=ze,this._padding=Ae,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,He),this._ease(Me(u),tt=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(n,tt)},t),this}_prepareEase(t,n,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||u.moving||this.fire(new s.z("movestart",t)),this._zooming&&!u.zooming&&this.fire(new s.z("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new s.z("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new s.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.z("move",t)),this._zooming&&this.fire(new s.z("zoom",t)),this._rotating&&this.fire(new s.z("rotate",t)),this._pitching&&this.fire(new s.z("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new s.z("zoomend",t)),p&&this.fire(new s.z("rotateend",t)),g&&this.fire(new s.z("pitchend",t)),this.fire(new s.z("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const Gt=s.ay(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Gt,n)}this.stop(),t=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dA},t);const u=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),S=this.getPadding(),C="zoom"in t?s.aw(+t.zoom,u.minZoom,u.maxZoom):p,L="bearing"in t?this._normalizeBearing(t.bearing,g):g,R="pitch"in t?+t.pitch:x,z=this._extendPadding(t.padding),N=u.zoomScale(C-p),V=s.P.convert(t.offset);let J=u.centerPoint.add(V);const X=u.pointLocation(J),ie=s.bO.convert(t.center||X);this._normalizeCenter(ie);const te=u.project(X),le=u.project(ie).sub(te);let we=t.curve;const ve=Math.max(u.width,u.height),ze=ve/N,Ae=le.mag();if("minZoom"in t){const Gt=s.aw(Math.min(t.minZoom,p,C),u.minZoom,u.maxZoom),fn=ve/u.zoomScale(Gt-p);we=Math.sqrt(fn/Ae*2)}const Le=we*we;function Me(Gt){const fn=(ze*ze-ve*ve+(Gt?-1:1)*Le*Le*Ae*Ae)/(2*(Gt?ze:ve)*Le*Ae);return Math.log(Math.sqrt(fn*fn+1)-fn)}function He(Gt){return(Math.exp(Gt)-Math.exp(-Gt))/2}function tt(Gt){return(Math.exp(Gt)+Math.exp(-Gt))/2}const Ft=Me(0);let Mt=function(Gt){return tt(Ft)/tt(Ft+we*Gt)},ai=function(Gt){return ve*((tt(Ft)*(He(fn=Ft+we*Gt)/tt(fn))-He(Ft))/Le)/Ae;var fn},ei=(Me(1)-Ft)/we;if(Math.abs(Ae)<1e-6||!isFinite(ei)){if(Math.abs(ve-ze)<1e-6)return this.easeTo(t,n);const Gt=ze<ve?-1:1;ei=Math.abs(Math.log(ze/ve))/we,ai=function(){return 0},Mt=function(fn){return Math.exp(Gt*we*fn)}}t.duration="duration"in t?+t.duration:1e3*ei/("screenSpeed"in t?+t.screenSpeed/we:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const yt=g!==L,Ut=R!==x,Ui=!u.isPaddingEqual(z),_t=t.retainPadding===!1?u.clone():u,_i=Gt=>fn=>{const Ri=fn*ei,di=1/Mt(Ri);Gt.zoom=fn===1?C:p+Gt.scaleZoom(di),yt&&(Gt.bearing=s.af(g,L,fn)),Ut&&(Gt.pitch=s.af(x,R,fn)),Ui&&(_t.interpolatePadding(S,z,fn),J=_t.centerPoint.add(V));const $i=fn===1?ie:Gt.unproject(te.add(le.mult(ai(Ri))).mult(di));return Gt.setLocationAtPoint(Gt.renderWorldCopies?$i.wrap():$i,J),Gt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),Gt};if(t.preloadOnly){const Gt=this._emulate(_i,t.duration,u);return this._preloadTiles(Gt),this}return this._zooming=!0,this._rotating=yt,this._pitching=Ut,this._padding=Ui,this._prepareEase(n,!1),this._ease(_i(u),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,n)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,n,u){u.animate===!1||u.duration===0?(t(1),n()):(this._easeStart=s.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=s.bF(t,-180,180);const u=Math.abs(t-n);return Math.abs(t-360-n)<u&&(t-=360),Math.abs(t+360-n)<u&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const u=t.lng-n.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,u){const p=Math.ceil(15*n/1e3),g=[],x=t(u.clone());for(let S=0;S<=p;S++){const C=x(S/p);g.push(C.clone())}return g}_preloadTiles(t,n){}}class jc{constructor(t={}){this.options=t,s.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Qt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Qt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=Qt("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=Qt("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const u=n.reduce((p,g,x)=>(g.value&&(p+=`${g.key}=${g.value}${x<n.length-1?"&":""}`),p),"?");t.href=`${s.e.FEEDBACK_URL}/${u}#${Ch(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const n=this._map.style._mergedSourceCaches;for(const p in n){const g=n[p];if(g.used){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Na{constructor(){s.aP(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Qt("div","mapboxgl-ctrl");const n=Qt("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const u=t[n].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class Fa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,u=n?this._queue.concat(n):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const u of n)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Fu{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=s.cB((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,u){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+u}}const pu={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class mu extends s.z{constructor(t,n,u,p){const{point:g,lngLat:x,originalEvent:S,target:C}=t;super(t.type,{point:g,lngLat:x,originalEvent:S,target:C}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=u,this.feature=p}}class Oh{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=n.filter;let p=n.type;u&&this.filters.set(t,s.aZ(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const g=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):g.size===0&&this.map.on(p,this.handleType),g.size===0&&this.interactionsByType.set(p,g),g.set(t,n),this.typeById.set(t,p)}get(t){const n=this.typeById.get(t);if(!n)return;const u=this.interactionsByType.get(n);return u?u.get(t):void 0}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(n);u&&(u.delete(t),n==="mouseenter"||n==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(n,this.handleType))}queryTargets(t,n){const u=[];for(const[p,g]of n)g.target&&u.push({targetId:p,target:g.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const n=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());n.length&&(t.type="mouseenter",this.handleType(t,n));const u=new Map;for(const[p,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(g.id,g);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const n=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);n.length&&(t.type="mouseleave",this.handleType(t,n)),this.hoveredFeatures.clear()}handleType(t,n){const u=Array.from(this.interactionsByType.get(t.type)).reverse(),p=!!n;n=n||this.queryTargets(t.point,u);const g=t.type==="mouseenter";let x=!1;const S=new Set;for(const C of n){for(const[L,R]of u){if(!R.target)continue;const z=C.variants?C.variants[L]:null;if(z){for(const N of z){if(bs(N,C,S,L))continue;const V=new s.cw(C,N),J=xo(N,C,L);p&&(V.state=this.map.getFeatureState(V));const X=g?this.prevHoveredFeatures.get(J):null,ie=new mu(t,L,R,V),te=X?X.stop:R.handler(ie);if(g&&this.hoveredFeatures.set(J,{feature:C,stop:te}),te!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(const[C,L]of u){const{handler:R,target:z}=L;if(!z&&R(new mu(t,C,L,null))!==!1)break}}}function as(l,t){if(Array.isArray(l)&&Array.isArray(t)){const n=new Set(l),u=new Set(t);return n.size===u.size&&l.every(p=>u.has(p))}return s.bn(l,t)}const Ql={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Vf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Gf{constructor(t,n,u=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new vl({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new pc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),dt()}move(t,n){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,n),g=p&&p.bearingDelta;if(g&&u.setBearing(u.getBearing()+g),this.mousePitch){const x=this.mousePitch.mousemoveWindow(t,n),S=x&&x.pitchDelta;S&&u.setPitch(u.getPitch()+S)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){vt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(s.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ue(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ue(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=qe(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=qe(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function qc(l,t,n){if(l=new s.bO(l.lng,l.lat),t){const u=new s.bO(l.lng-360,l.lat),p=new s.bO(l.lng+360,l.lat),g=360*Math.ceil(Math.abs(l.lng-n.center.lng)/360),x=n.locationPoint(l).distSqr(t),S=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(u).distSqr(t)<x&&(S||Math.abs(u.lng-n.center.lng)<g)?l=u:n.locationPoint(p).distSqr(t)<x&&(S||Math.abs(p.lng-n.center.lng)<g)&&(l=p)}for(;Math.abs(l.lng-n.center.lng)>180;){const u=n.locationPoint(l);if(u.x>=0&&u.y>=0&&u.x<=n.width&&u.y<=n.height)break;l.lng>n.center.lng?l.lng-=360:l.lng+=360}return l}const xl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class il extends s.E{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=s.l({element:t},n)),s.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Qt("div");const g=41,x=27,S=Ii("svg",{display:"block",height:g*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${g}`},this._element),C=Ii("radialGradient",{id:"shadowGradient"},Ii("defs",{},S));Ii("stop",{offset:"10%","stop-opacity":.4},C),Ii("stop",{offset:"100%","stop-opacity":.05},C),Ii("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),Ii("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),Ii("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),Ii("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=s.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const u=this._element.classList;for(const g in xl)u.remove(`mapboxgl-marker-anchor-${g}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`);const p=t&&t.className?t.className.trim().split(/\s+/):[];u.add(...p),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,u=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,u=this._element;this._popup&&(n===u||u.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const u=t.unproject(n),p=t.getFreeCameraOptions();if(!p.position)return!1;const g=p.position.toLngLat();return g.distanceTo(u)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(n);let p;t._showingGlobe()&&s.dH(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${xl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,u=this.getPitchAlignment();if(!n||!t||u!=="map")return"";if(!n._showingGlobe()){const C=n.getPitch();return C?`rotateX(${C}deg)`:""}const p=s.c4(s.dI(n.transform,this._lngLat)),g=t.sub(s.dJ(n.transform)),x=Math.abs(g.x)+Math.abs(g.y);if(x===0)return"";const S=p/x;return`rotateX(${-g.y*S}deg) rotateY(${g.x*S}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(n._showingGlobe()){const g=n.project(new s.bO(this._lngLat.lng,this._lngLat.lat+.001)),x=n.project(new s.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(g);u=s.c4(Math.atan2(x.y,x.x))-90}else u=-n.getBearing();else if(p==="horizon"){const g=s.ac(4,6,n.getZoom()),x=s.dJ(n.transform);x.y+=g*n.transform.height;const S=t.sub(x),C=s.c4(Math.atan2(S.y,S.x));u=(C>90?C-270:C+90)*(1-g)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=qc(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const g=this._clickTolerance||n._clickTolerance;if(t.point.dist(u)<g)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,u=this._pos;n&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ya={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ia={maxWidth:100,unit:"metric"},ra={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ud={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},vo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Dh(l=new s.P(0,0),t="bottom"){if(typeof l=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new s.P(0,l);case"top-left":return new s.P(n,n);case"top-right":return new s.P(-n,n);case"bottom":return new s.P(0,-l);case"bottom-left":return new s.P(n,-n);case"bottom-right":return new s.P(-n,-n);case"left":return new s.P(l,0);case"right":return new s.P(-l,0)}return new s.P(0,0)}return l instanceof s.P||Array.isArray(l)?s.P.convert(l):s.P.convert(l[t]||[0,0])}return{version:xn,supported:ct.supported,setRTLTextPlugin:s.dK,getRTLTextPluginStatus:s.dL,Map:class extends Nu{constructor(l){ti.mark(tn.create);const t=l;if((l=s.l({},Ql,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&s.dF(window)&&(l.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Pa(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new Fa,this._domRenderTaskQueue=new Fa,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aV(),this._locale=s.l({},pu,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Fu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new bi(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?Object.assign({},l.contextCreateOptions):{},typeof l.container=="string"){const n=document.getElementById(l.container);if(!n)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=n}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._spriteFormat=l.spriteFormat,s.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Eh),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Fd(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||s.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this.indoor=new v(this),l.hash&&(this._hash=new Md(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const n=l.bounds;n&&(this.resize(),this.fitBounds(n,s.l({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new jc({customAttribution:l.customAttribution})),this._logoControl=new Na,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new s.z(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.z(`${n.dataType}dataloading`,n))}),this._interactions=new Oh(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=l.onAdd(this);this._controls.push(l);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(n,u.firstChild):u.appendChild(n),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.z("movestart",l)).fire(new s.z("move",l)),this.fire(new s.z("resize",l)),t&&this.fire(new s.z("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(s.az.convert(l)),this._update()}setMinZoom(l){if((l=l!=null?l:-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l!=null?l:22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l!=null?l:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l!=null?l:85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(t=>t==="auto"?navigator.language:t):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let n;t==="globe"&&l.zoom>=s.bY?(l.setMercatorFromTransition(),n=!0):t==="mercator"&&l.zoom<s.bY&&(l.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;return t=l.name==="globe"&&this.transform.zoom>=s.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l){return this.transform.locationPoint3D(s.bO.convert(l))}unproject(l){return this.transform.pointLocation3D(s.P.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,n){const u=p=>{let g=[];if(Array.isArray(t)){const x=t.filter(S=>this.getLayer(S));g=x.length?this.queryRenderedFeatures(p,{layers:x}):[]}else g=this.queryRenderedFeatures(p,{target:t});return g};if(l==="mouseenter"||l==="mouseover"){let p=!1;return{listener:n,targets:t,delegates:{mousemove:x=>{const S=u(x.point);S.length?p||(p=!0,n.call(this,new Sa(l,this,x.originalEvent,{features:S}))):p=!1},mouseout:()=>{p=!1}}}}if(l==="mouseleave"||l==="mouseout"){let p=!1;return{listener:n,targets:t,delegates:{mousemove:S=>{u(S.point).length?p=!0:p&&(p=!1,n.call(this,new Sa(l,this,S.originalEvent)))},mouseout:S=>{p&&(p=!1,n.call(this,new Sa(l,this,S.originalEvent)))}}}}{const p=g=>{const x=u(g.point);x.length&&(g.features=x,n.call(this,g),delete g.features)};return{listener:n,targets:t,delegates:{[l]:p}}}}on(l,t,n){if(typeof t=="function"||n===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(l,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(l,t,n){if(typeof t=="function"||n===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(l,t,n);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(l,t,n){if(typeof t=="function"||n===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[l]:void 0;return u&&(p=>{for(let g=0;g<p.length;g++){const x=p[g];if(x.listener===n&&as(x.targets,t)){for(const S in x.delegates)this.off(S,x.delegates[S]);return p.splice(g,1),this}}})(u),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(l===void 0||l instanceof s.P||Array.isArray(l)||t!==void 0||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(l,void 0,this.transform),x=this.style.queryRenderedFeatureset(l,void 0,this.transform);return g.concat(x)}let n=!0;if(t.target&&(n=this._isTargetValid(t.target),n&&!t.layers))return this.style.queryRenderedFeatureset(l,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(l,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(l,t,this.transform))),n&&(p=p.concat(this.style.queryRenderedFeatureset(l,t,this.transform))),p}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}setStyle(l,t){return t=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,(n,u)=>{n?(s.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(l,t)):u&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const n=s.l({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new Xe(this,n).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xe(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.cr(l)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isTargetValid(l){return"featuresetId"in l?this._isValidId("importId"in l?l.importId:l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(const t of l)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,n)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:n=1,sdf:u=!1,stretchX:p,stretchY:g,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:S,height:C,data:L}=s.q.getImageData(t);this.style.addImage(l,{data:new s.r({width:S,height:C},L),pixelRatio:n,stretchX:p,stretchY:g,content:x,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:C}=t,L=t;this.style.addImage(l,{data:new s.r({width:S,height:C},new Uint8Array(L.data)),pixelRatio:n,stretchX:p,stretchY:g,content:x,sdf:u,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const n=this.style.getImage(l);if(!n)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.q.getImageData(t):t,{width:p,height:g,data:x}=u;if(p===void 0||g===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==(n.usvg?n.icon.usvg_tree.width:n.data.width)||g!==(n.usvg?n.icon.usvg_tree.height:n.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${p}, ${g})
                must be that same as the previous version of the image
                (${n.data.width}, ${n.data.height})`)));const S=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let C=!1;n.usvg?(n.data=new s.r({width:p,height:g},new Uint8Array(x)),n.usvg=!1,n.icon=void 0,C=!0):n.data.replace(x,S),this.style.updateImage(l,n,C)}hasImage(l){return l?!!this.style&&!!this.style.getImage(l):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,t){s.o(this._requestManager.transformRequest(l,s.R.Image),(n,u)=>{t(n,u instanceof HTMLImageElement?s.q.getImageData(u):u)})}listImages(){return this.style.listImages()}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,n){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,n),this._update(!0)):this}setFilter(l,t,n={}){return this._isValidId(l)?(this.style.setFilter(l,t,n),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,n,u={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,n,u),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,n,u={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,n,u),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,n){return this.style.setConfigProperty(l,t,n),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(l){return this._lazyInitEmptyStyle(),this.style.setSnow(l),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(l){return this._lazyInitEmptyStyle(),this.style.setRain(l),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setImportColorTheme(l,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(l,t),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bO.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,u,p,g=this._container;for(;g&&(!u||!p);){const x=window.getComputedStyle(g).transform;x&&x!=="none"&&(n=x.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(u=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(p=n[3])),g=g.parentElement}this._containerWidth=u?Math.abs(l/u):l,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=Qt("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Qt("div","mapboxgl-canvas-container",l);this._canvas=Qt("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Qt("div","mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=Qt("div",`mapboxgl-ctrl-${p}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const n=s.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(l),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=s.l({},ct.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(lt(t,!0),this.painter=new Ah(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(t)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new s.z("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,u=s.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,R=this.transform.pitch,z=s.q.now(),N=new s.a8(L,{now:z,fadeDuration:g,pitch:R,transition:this.style.transition});this.style.update(N)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(u),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(u);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ti.mark(tn.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const L=s.q.now()-u;p.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const R=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new s.z("gpu-timing-frame",{cpuTime:L,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(L);this.fire(new s.z("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(L);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:R}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(C||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(x=this._updateAverageElevation(u,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,ti.mark(tn.fullLoad),this._performanceMetricsCollection&&Dt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const n=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const p=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=l;const x=Math.abs(p-g);if(x>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(g),n(g);this._averageElevation.easeTo(g,l,300)}else if(x>1e-4)return this._averageElevation.jumpTo(g),n(g)}return!!this._averageElevation.isEasing(l)&&n(this._averageElevation.getValue(l))}_authenticate(){Pe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===ki||l.status===401)){const t=this.painter.context.gl;lt(t,!1),this._logoControl instanceof Na&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Mn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Hn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,u=n.createFramebuffer();function p(g){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,g,0);const x=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,x),x}return n.bindFramebuffer(n.FRAMEBUFFER,u),this._canvasPixelComparison(p(l),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(l,t,n){let u=n[1]-n[0];const p=l.length/4;for(let g=0;g<t.length;g++){const x=t[g];let S=0;for(let C=0;C<x.length;C+=4)x[C]===l[C]&&x[C+1]===l[C+1]&&x[C+2]===l[C+2]&&x[C+3]===l[C+3]&&(S+=1);u+=(n[g+2]-n[g+1])*(1-S/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),$n.delete(this.painter.context.gl),Ls.remove(),vi.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=s.q.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return s.bl(t,(n,u)=>n._preloadTiles(l,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this._tp.refreshUI(),l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,this._tp.refreshUI(),l&&this._update())}_setCacheLimits(l,t){s.dG(l,t)}get version(){return xn}},NavigationControl:class{constructor(l={}){this.options=s.l({},Vf,l),this._container=Qt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Qt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Qt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=Qt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),n=t===l.getMaxZoom(),u=t===l.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gf(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const n=Qt("button",l,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(l,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",n),l.firstElementChild&&l.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends s.E{constructor(l={}){super();const t=navigator.geolocation;this.options=s.l({geolocation:t},ya,l),s.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Bc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=Qt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,l(n)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),n=l.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",l)),this._finish()}}_updateCamera(l){const t=new s.bO(l.coords.longitude,l.coords.latitude),n=l.coords.accuracy,u=this._map.getBearing(),p=s.l({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),p,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new s.bO(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=s.bH(1,l._center.lat)*l.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Qt("button","mapboxgl-ctrl-geolocate",this._container),Qt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Qt("div","mapboxgl-user-location"),this._dotElement.appendChild(Qt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Qt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new il({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Qt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new il({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent!="undefined"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:jc,ScaleControl:class{constructor(l={}){this.options=s.l({},Ia,l),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(t){return!1}}(),s.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,u=t._containerWidth/2-l/2,p=t.unproject([u,n]),g=t.unproject([u+l,n]),x=p.distanceTo(g);if(this.options.unit==="imperial"){const S=3.2808*x;S>5280?this._setScale(l,S/5280,"mile"):this._setScale(l,S,"foot")}else this.options.unit==="nautical"?this._setScale(l,x/1852,"nautical-mile"):x>=1e3?this._setScale(l,x/1e3,"kilometer"):this._setScale(l,x,"meter")}_setScale(l,t,n){this._map._requestDomTask(()=>{const u=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let S=g/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const L=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*L)/L}(S),x*S}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(u):`${u}&nbsp;${ra[n]}`,this._container.style.width=l*p+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=Qt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:s.w("Full screen control 'container' must be a DOM element.")),s.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=Qt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=Qt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Qt("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(l){super(),this.options=s.l(Object.create(Ud),l),s.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=s.bO.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),n=document.createElement("body");let u;for(n.innerHTML=l;u=n.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Qt("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const n=this._closeButton=Qt("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.innerHTML='<span aria-hidden="true">&#215;</span>',n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,u=this._pos;if(!t||!n||!u)return"bottom";const p=n.offsetWidth,g=n.offsetHeight,x=u.x<p/2,S=u.x>t.transform.width-p/2;if(u.y+l<g)return x?"top-left":S?"top-right":"top";if(u.y>t.transform.height-g){if(x)return"bottom-left";if(S)return"bottom-right"}return x?"left":S?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let u=this._container;if(u||(u=this._container=Qt("div","mapboxgl-popup",t.getContainer()),this._tip=Qt("div","mapboxgl-popup-tip",u),u.appendChild(n)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=qc(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const p=this._pos=this._trackPointer&&l instanceof s.P?l:t.project(this._lngLat),g=Dh(this.options.offset),x=this._anchor=this._getAnchor(g.y),S=Dh(this.options.offset,x),C=p.add(S).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${xl[x]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=s.dH(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(vo);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:il,Style:Xe,LngLat:s.bO,LngLatBounds:s.az,Point:s.P,MercatorCoordinate:s.aa,FreeCameraOptions:Ca,Evented:s.E,config:s.e,prewarm:s.dM,clearPrewarmedResources:s.dN,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(l){s.e.ACCESS_TOKEN=l},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(l){s.e.API_URL=l},get workerCount(){return s.dO.workerCount},set workerCount(l){s.dO.workerCount=l},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){s.dP(l)},get workerUrl(){return s.dQ.workerUrl},set workerUrl(l){s.dQ.workerUrl=l},get workerClass(){return s.dQ.workerClass},set workerClass(l){s.dQ.workerClass=l},get workerParams(){return s.dQ.workerParams},set workerParams(l){s.dQ.workerParams=l},get dracoUrl(){return s.dR()},set dracoUrl(l){s.dS(l)},get meshoptUrl(){return s.dT()},set meshoptUrl(l){s.dU(l)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var hn=xe;return hn})},79204:function(ir){(function(Yn,Tt){ir.exports=Tt()})(this,function(){"use strict";function Yn(We,ot,dt,vt,Be){(function Ie(Ue,qe,De,je,Pt){for(;je>De;){if(je-De>600){var ki=je-De+1,bi=qe-De+1,ji=Math.log(ki),hr=.5*Math.exp(2*ji/3),Xn=.5*Math.sqrt(ji*hr*(ki-hr)/ki)*(bi-ki/2<0?-1:1),rn=Math.max(De,Math.floor(qe-bi*hr/ki+Xn)),Ot=Math.min(je,Math.floor(qe+(ki-bi)*hr/ki+Xn));Ie(Ue,qe,rn,Ot,Pt)}var at=Ue[qe],Ht=De,Qi=je;for(Tt(Ue,De,qe),Pt(Ue[je],at)>0&&Tt(Ue,De,je);Ht<Qi;){for(Tt(Ue,Ht,Qi),Ht++,Qi--;Pt(Ue[Ht],at)<0;)Ht++;for(;Pt(Ue[Qi],at)>0;)Qi--}Pt(Ue[De],at)===0?Tt(Ue,De,Qi):Tt(Ue,++Qi,je),Qi<=qe&&(De=Qi+1),qe<=Qi&&(je=Qi-1)}})(We,ot,dt||0,vt||We.length-1,Be||xe)}function Tt(We,ot,dt){var vt=We[ot];We[ot]=We[dt],We[dt]=vt}function xe(We,ot){return We<ot?-1:We>ot?1:0}var Pi=function(We){We===void 0&&(We=9),this._maxEntries=Math.max(4,We),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function hn(We,ot,dt){if(!dt)return ot.indexOf(We);for(var vt=0;vt<ot.length;vt++)if(dt(We,ot[vt]))return vt;return-1}function s(We,ot){xn(We,0,We.children.length,ot,We)}function xn(We,ot,dt,vt,Be){Be||(Be=Ii(null)),Be.minX=1/0,Be.minY=1/0,Be.maxX=-1/0,Be.maxY=-1/0;for(var Ie=ot;Ie<dt;Ie++){var Ue=We.children[Ie];tn(Be,We.leaf?vt(Ue):Ue)}return Be}function tn(We,ot){return We.minX=Math.min(We.minX,ot.minX),We.minY=Math.min(We.minY,ot.minY),We.maxX=Math.max(We.maxX,ot.maxX),We.maxY=Math.max(We.maxY,ot.maxY),We}function ti(We,ot){return We.minX-ot.minX}function $t(We,ot){return We.minY-ot.minY}function et(We){return(We.maxX-We.minX)*(We.maxY-We.minY)}function yi(We){return We.maxX-We.minX+(We.maxY-We.minY)}function ct(We,ot){return We.minX<=ot.minX&&We.minY<=ot.minY&&ot.maxX<=We.maxX&&ot.maxY<=We.maxY}function Qt(We,ot){return ot.minX<=We.maxX&&ot.minY<=We.maxY&&ot.maxX>=We.minX&&ot.maxY>=We.minY}function Ii(We){return{children:We,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Yi(We,ot,dt,vt,Be){for(var Ie=[ot,dt];Ie.length;)if(!((dt=Ie.pop())-(ot=Ie.pop())<=vt)){var Ue=ot+Math.ceil((dt-ot)/vt/2)*vt;Yn(We,Ue,ot,dt,Be),Ie.push(ot,Ue,Ue,dt)}}return Pi.prototype.all=function(){return this._all(this.data,[])},Pi.prototype.search=function(We){var ot=this.data,dt=[];if(!Qt(We,ot))return dt;for(var vt=this.toBBox,Be=[];ot;){for(var Ie=0;Ie<ot.children.length;Ie++){var Ue=ot.children[Ie],qe=ot.leaf?vt(Ue):Ue;Qt(We,qe)&&(ot.leaf?dt.push(Ue):ct(We,qe)?this._all(Ue,dt):Be.push(Ue))}ot=Be.pop()}return dt},Pi.prototype.collides=function(We){var ot=this.data;if(!Qt(We,ot))return!1;for(var dt=[];ot;){for(var vt=0;vt<ot.children.length;vt++){var Be=ot.children[vt],Ie=ot.leaf?this.toBBox(Be):Be;if(Qt(We,Ie)){if(ot.leaf||ct(We,Ie))return!0;dt.push(Be)}}ot=dt.pop()}return!1},Pi.prototype.load=function(We){if(!We||!We.length)return this;if(We.length<this._minEntries){for(var ot=0;ot<We.length;ot++)this.insert(We[ot]);return this}var dt=this._build(We.slice(),0,We.length-1,0);if(this.data.children.length)if(this.data.height===dt.height)this._splitRoot(this.data,dt);else{if(this.data.height<dt.height){var vt=this.data;this.data=dt,dt=vt}this._insert(dt,this.data.height-dt.height-1,!0)}else this.data=dt;return this},Pi.prototype.insert=function(We){return We&&this._insert(We,this.data.height-1),this},Pi.prototype.clear=function(){return this.data=Ii([]),this},Pi.prototype.remove=function(We,ot){if(!We)return this;for(var dt,vt,Be,Ie=this.data,Ue=this.toBBox(We),qe=[],De=[];Ie||qe.length;){if(Ie||(Ie=qe.pop(),vt=qe[qe.length-1],dt=De.pop(),Be=!0),Ie.leaf){var je=hn(We,Ie.children,ot);if(je!==-1)return Ie.children.splice(je,1),qe.push(Ie),this._condense(qe),this}Be||Ie.leaf||!ct(Ie,Ue)?vt?(dt++,Ie=vt.children[dt],Be=!1):Ie=null:(qe.push(Ie),De.push(dt),dt=0,vt=Ie,Ie=Ie.children[0])}return this},Pi.prototype.toBBox=function(We){return We},Pi.prototype.compareMinX=function(We,ot){return We.minX-ot.minX},Pi.prototype.compareMinY=function(We,ot){return We.minY-ot.minY},Pi.prototype.toJSON=function(){return this.data},Pi.prototype.fromJSON=function(We){return this.data=We,this},Pi.prototype._all=function(We,ot){for(var dt=[];We;)We.leaf?ot.push.apply(ot,We.children):dt.push.apply(dt,We.children),We=dt.pop();return ot},Pi.prototype._build=function(We,ot,dt,vt){var Be,Ie=dt-ot+1,Ue=this._maxEntries;if(Ie<=Ue)return s(Be=Ii(We.slice(ot,dt+1)),this.toBBox),Be;vt||(vt=Math.ceil(Math.log(Ie)/Math.log(Ue)),Ue=Math.ceil(Ie/Math.pow(Ue,vt-1))),(Be=Ii([])).leaf=!1,Be.height=vt;var qe=Math.ceil(Ie/Ue),De=qe*Math.ceil(Math.sqrt(Ue));Yi(We,ot,dt,De,this.compareMinX);for(var je=ot;je<=dt;je+=De){var Pt=Math.min(je+De-1,dt);Yi(We,je,Pt,qe,this.compareMinY);for(var ki=je;ki<=Pt;ki+=qe){var bi=Math.min(ki+qe-1,Pt);Be.children.push(this._build(We,ki,bi,vt-1))}}return s(Be,this.toBBox),Be},Pi.prototype._chooseSubtree=function(We,ot,dt,vt){for(;vt.push(ot),!ot.leaf&&vt.length-1!==dt;){for(var Be=1/0,Ie=1/0,Ue=void 0,qe=0;qe<ot.children.length;qe++){var De=ot.children[qe],je=et(De),Pt=(ki=We,bi=De,(Math.max(bi.maxX,ki.maxX)-Math.min(bi.minX,ki.minX))*(Math.max(bi.maxY,ki.maxY)-Math.min(bi.minY,ki.minY))-je);Pt<Ie?(Ie=Pt,Be=je<Be?je:Be,Ue=De):Pt===Ie&&je<Be&&(Be=je,Ue=De)}ot=Ue||ot.children[0]}var ki,bi;return ot},Pi.prototype._insert=function(We,ot,dt){var vt=dt?We:this.toBBox(We),Be=[],Ie=this._chooseSubtree(vt,this.data,ot,Be);for(Ie.children.push(We),tn(Ie,vt);ot>=0&&Be[ot].children.length>this._maxEntries;)this._split(Be,ot),ot--;this._adjustParentBBoxes(vt,Be,ot)},Pi.prototype._split=function(We,ot){var dt=We[ot],vt=dt.children.length,Be=this._minEntries;this._chooseSplitAxis(dt,Be,vt);var Ie=this._chooseSplitIndex(dt,Be,vt),Ue=Ii(dt.children.splice(Ie,dt.children.length-Ie));Ue.height=dt.height,Ue.leaf=dt.leaf,s(dt,this.toBBox),s(Ue,this.toBBox),ot?We[ot-1].children.push(Ue):this._splitRoot(dt,Ue)},Pi.prototype._splitRoot=function(We,ot){this.data=Ii([We,ot]),this.data.height=We.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},Pi.prototype._chooseSplitIndex=function(We,ot,dt){for(var vt,Be,Ie,Ue,qe,De,je,Pt=1/0,ki=1/0,bi=ot;bi<=dt-ot;bi++){var ji=xn(We,0,bi,this.toBBox),hr=xn(We,bi,dt,this.toBBox),Xn=(Be=ji,Ie=hr,Ue=void 0,qe=void 0,De=void 0,je=void 0,Ue=Math.max(Be.minX,Ie.minX),qe=Math.max(Be.minY,Ie.minY),De=Math.min(Be.maxX,Ie.maxX),je=Math.min(Be.maxY,Ie.maxY),Math.max(0,De-Ue)*Math.max(0,je-qe)),rn=et(ji)+et(hr);Xn<Pt?(Pt=Xn,vt=bi,ki=rn<ki?rn:ki):Xn===Pt&&rn<ki&&(ki=rn,vt=bi)}return vt||dt-ot},Pi.prototype._chooseSplitAxis=function(We,ot,dt){var vt=We.leaf?this.compareMinX:ti,Be=We.leaf?this.compareMinY:$t;this._allDistMargin(We,ot,dt,vt)<this._allDistMargin(We,ot,dt,Be)&&We.children.sort(vt)},Pi.prototype._allDistMargin=function(We,ot,dt,vt){We.children.sort(vt);for(var Be=this.toBBox,Ie=xn(We,0,ot,Be),Ue=xn(We,dt-ot,dt,Be),qe=yi(Ie)+yi(Ue),De=ot;De<dt-ot;De++){var je=We.children[De];tn(Ie,We.leaf?Be(je):je),qe+=yi(Ie)}for(var Pt=dt-ot-1;Pt>=ot;Pt--){var ki=We.children[Pt];tn(Ue,We.leaf?Be(ki):ki),qe+=yi(Ue)}return qe},Pi.prototype._adjustParentBBoxes=function(We,ot,dt){for(var vt=dt;vt>=0;vt--)tn(ot[vt],We)},Pi.prototype._condense=function(We){for(var ot=We.length-1,dt=void 0;ot>=0;ot--)We[ot].children.length===0?ot>0?(dt=We[ot-1].children).splice(dt.indexOf(We[ot]),1):this.clear():s(We[ot],this.toBBox)},Pi})},1129:function(ir){ir.exports.RADIUS=6378137,ir.exports.FLATTENING=1/298.257223563,ir.exports.POLAR_RADIUS=63567523142e-4},38498:function(ir,Yn,Tt){var xe=Tt(78770);function Pi(hn){if(Array.isArray(hn))return xe(hn)}ir.exports=Pi,ir.exports.__esModule=!0,ir.exports.default=ir.exports},20698:function(ir){function Yn(Tt){if(typeof Symbol!="undefined"&&Tt[Symbol.iterator]!=null||Tt["@@iterator"]!=null)return Array.from(Tt)}ir.exports=Yn,ir.exports.__esModule=!0,ir.exports.default=ir.exports},91162:function(ir){function Yn(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}ir.exports=Yn,ir.exports.__esModule=!0,ir.exports.default=ir.exports},67825:function(ir,Yn,Tt){var xe=Tt(64382);function Pi(hn,s){if(hn==null)return{};var xn=xe(hn,s),tn,ti;if(Object.getOwnPropertySymbols){var $t=Object.getOwnPropertySymbols(hn);for(ti=0;ti<$t.length;ti++)tn=$t[ti],!(s.indexOf(tn)>=0)&&Object.prototype.propertyIsEnumerable.call(hn,tn)&&(xn[tn]=hn[tn])}return xn}ir.exports=Pi,ir.exports.__esModule=!0,ir.exports.default=ir.exports},64382:function(ir){function Yn(Tt,xe){if(Tt==null)return{};var Pi={},hn=Object.keys(Tt),s,xn;for(xn=0;xn<hn.length;xn++)s=hn[xn],!(xe.indexOf(s)>=0)&&(Pi[s]=Tt[s]);return Pi}ir.exports=Yn,ir.exports.__esModule=!0,ir.exports.default=ir.exports},15558:function(ir,Yn,Tt){var xe=Tt(38498),Pi=Tt(20698),hn=Tt(31479),s=Tt(91162);function xn(tn){return xe(tn)||Pi(tn)||hn(tn)||s()}ir.exports=xn,ir.exports.__esModule=!0,ir.exports.default=ir.exports},60738:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{Z:function(){return Is}});var xe={};Tt.r(xe),Tt.d(xe,{LAT_MAX:function(){return Ie},LAT_MIN:function(){return vt},LAT_RENDERED_MAX:function(){return Ue},LAT_RENDERED_MIN:function(){return Be},LNG_MAX:function(){return De},LNG_MIN:function(){return qe},activeStates:function(){return ot},classes:function(){return ti},cursors:function(){return et},events:function(){return Ii},geojsonTypes:function(){return ct},interactions:function(){return dt},meta:function(){return We},modes:function(){return Qt},sources:function(){return $t},types:function(){return yi},updateActions:function(){return Yi}});var Pi={};Tt.r(Pi),Tt.d(Pi,{isActiveFeature:function(){return Bn},isEnterKey:function(){return q},isEscapeKey:function(){return gt},isFeature:function(){return Vs},isInactiveFeature:function(){return Or},isOfMetaType:function(){return en},isShiftDown:function(){return ds},isShiftMousedown:function(){return Un},isTrue:function(){return ee},isVertex:function(){return qr},noTarget:function(){return hs}});var hn={};Tt.r(hn),Tt.d(hn,{CommonSelectors:function(){return Pi},ModeHandler:function(){return xn},StringSet:function(){return rn},constrainFeatureMovement:function(){return Xt},createMidPoint:function(){return Y},createSupplementaryPoints:function(){return se},createVertex:function(){return Ce},doubleClickZoom:function(){return fe},euclideanDistance:function(){return gr},featuresAt:function(){return at},getFeatureAtAndSetCursors:function(){return Mn},isClick:function(){return Ls},isEventAtCoordinates:function(){return xo},isTap:function(){return lt},mapEventToBoundingBox:function(){return hr},moveFeatures:function(){return vn},sortFeatures:function(){return bi},stringSetsAreEqual:function(){return wo},theme:function(){return Zt},toDenseArray:function(){return ks}});var xn=function(D,W){const Ge={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Ye={on(Ei,Pn,yn){if(Ge[Ei]===void 0)throw new Error(`Invalid event type: ${Ei}`);Ge[Ei].push({selector:Pn,fn:yn})},render(Ei){W.store.featureChanged(Ei)}},Bt=function(Ei,Pn){const yn=Ge[Ei];let pr=yn.length;for(;pr--;){const Er=yn[pr];if(Er.selector(Pn)){Er.fn.call(Ye,Pn)||W.store.render(),W.ui.updateMapClasses();break}}};return D.start.call(Ye),{render:D.render,stop(){D.stop&&D.stop()},trash(){D.trash&&(D.trash(),W.store.render())},combineFeatures(){D.combineFeatures&&D.combineFeatures()},uncombineFeatures(){D.uncombineFeatures&&D.uncombineFeatures()},drag(Ei){Bt("drag",Ei)},click(Ei){Bt("click",Ei)},mousemove(Ei){Bt("mousemove",Ei)},mousedown(Ei){Bt("mousedown",Ei)},mouseup(Ei){Bt("mouseup",Ei)},mouseout(Ei){Bt("mouseout",Ei)},keydown(Ei){Bt("keydown",Ei)},keyup(Ei){Bt("keyup",Ei)},touchstart(Ei){Bt("touchstart",Ei)},touchmove(Ei){Bt("touchmove",Ei)},touchend(Ei){Bt("touchend",Ei)},tap(Ei){Bt("tap",Ei)}}},tn=Tt(12398);const ti={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},$t={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},et={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},yi={POLYGON:"polygon",LINE:"line_string",POINT:"point"},ct={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Qt={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},Ii={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Yi={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},We={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},ot={ACTIVE:"true",INACTIVE:"false"},dt=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],vt=-90,Be=-85,Ie=90,Ue=85,qe=-270,De=270,je={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Pt(D,W){const Ge=je[D.geometry.type]-je[W.geometry.type];return Ge===0&&D.geometry.type===ct.POLYGON?D.area-W.area:Ge}function ki(D){return D.map(W=>(W.geometry.type===ct.POLYGON&&(W.area=tn.geometry({type:ct.FEATURE,property:{},geometry:W.geometry})),W)).sort(Pt).map(W=>(delete W.area,W))}var bi=ki;function ji(D,W=0){return[[D.point.x-W,D.point.y-W],[D.point.x+W,D.point.y+W]]}var hr=ji;function Xn(D){if(this._items={},this._nums={},this._length=D?D.length:0,!!D)for(let W=0,Ge=D.length;W<Ge;W++)this.add(D[W]),D[W]!==void 0&&(typeof D[W]=="string"?this._items[D[W]]=W:this._nums[D[W]]=W)}Xn.prototype.add=function(D){return this.has(D)?this:(this._length++,typeof D=="string"?this._items[D]=this._length:this._nums[D]=this._length,this)},Xn.prototype.delete=function(D){return this.has(D)===!1?this:(this._length--,delete this._items[D],delete this._nums[D],this)},Xn.prototype.has=function(D){return typeof D!="string"&&typeof D!="number"?!1:this._items[D]!==void 0||this._nums[D]!==void 0},Xn.prototype.values=function(){const D=[];return Object.keys(this._items).forEach(W=>{D.push({k:W,v:this._items[W]})}),Object.keys(this._nums).forEach(W=>{D.push({k:JSON.parse(W),v:this._nums[W]})}),D.sort((W,Ge)=>W.v-Ge.v).map(W=>W.k)},Xn.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var rn=Xn;const Ot=[We.FEATURE,We.MIDPOINT,We.VERTEX];var at={click:Ht,touch:Qi};function Ht(D,W,Ge){return vi(D,W,Ge,Ge.options.clickBuffer)}function Qi(D,W,Ge){return vi(D,W,Ge,Ge.options.touchBuffer)}function vi(D,W,Ge,Ye){if(Ge.map===null)return[];const Bt=D?hr(D,Ye):W,Ei={};Ge.options.styles&&(Ei.layers=Ge.options.styles.map(Er=>Er.id).filter(Er=>Ge.map.getLayer(Er)!=null));const Pn=Ge.map.queryRenderedFeatures(Bt,Ei).filter(Er=>Ot.indexOf(Er.properties.meta)!==-1),yn=new rn,pr=[];return Pn.forEach(Er=>{const ft=Er.properties.id;yn.has(ft)||(yn.add(ft),pr.push(Er))}),bi(pr)}function Mn(D,W){const Ge=at.click(D,null,W),Ye={mouse:et.NONE};return Ge[0]&&(Ye.mouse=Ge[0].properties.active===ot.ACTIVE?et.MOVE:et.POINTER,Ye.feature=Ge[0].properties.meta),W.events.currentModeName().indexOf("draw")!==-1&&(Ye.mouse=et.ADD),W.ui.queueMapClasses(Ye),W.ui.updateMapClasses(),Ge[0]}function gr(D,W){const Ge=D.x-W.x,Ye=D.y-W.y;return Math.sqrt(Ge*Ge+Ye*Ye)}const Hn=4,kr=12,Dt=500;function Ls(D,W,Ge={}){const Ye=Ge.fineTolerance!=null?Ge.fineTolerance:Hn,Bt=Ge.grossTolerance!=null?Ge.grossTolerance:kr,Ei=Ge.interval!=null?Ge.interval:Dt;D.point=D.point||W.point,D.time=D.time||W.time;const Pn=gr(D.point,W.point);return Pn<Ye||Pn<Bt&&W.time-D.time<Ei}const Pe=25,$n=250;function lt(D,W,Ge={}){const Ye=Ge.tolerance!=null?Ge.tolerance:Pe,Bt=Ge.interval!=null?Ge.interval:$n;return D.point=D.point||W.point,D.time=D.time||W.time,gr(D.point,W.point)<Ye&&W.time-D.time<Bt}let cs="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Xi=(D,W=21)=>(Ge=W)=>{let Ye="",Bt=Ge|0;for(;Bt--;)Ye+=D[Math.random()*D.length|0];return Ye},vs=(D=21)=>{let W="",Ge=D|0;for(;Ge--;)W+=cs[Math.random()*64|0];return W};const Bs=Xi("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function Xs(){return Bs()}const Sr=function(D,W){this.ctx=D,this.properties=W.properties||{},this.coordinates=W.geometry.coordinates,this.id=W.id||Xs(),this.type=W.geometry.type};Sr.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Sr.prototype.incomingCoords=function(D){this.setCoordinates(D)},Sr.prototype.setCoordinates=function(D){this.coordinates=D,this.changed()},Sr.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Sr.prototype.setProperty=function(D,W){this.properties[D]=W},Sr.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:ct.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Sr.prototype.internal=function(D){const W={id:this.id,meta:We.FEATURE,"meta:type":this.type,active:ot.INACTIVE,mode:D};if(this.ctx.options.userProperties)for(const Ge in this.properties)W[`user_${Ge}`]=this.properties[Ge];return{type:ct.FEATURE,properties:W,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var un=Sr;const ys=function(D,W){un.call(this,D,W)};ys.prototype=Object.create(un.prototype),ys.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},ys.prototype.updateCoordinate=function(D,W,Ge){arguments.length===3?this.coordinates=[W,Ge]:this.coordinates=[D,W],this.changed()},ys.prototype.getCoordinate=function(){return this.getCoordinates()};var Hs=ys;const ls=function(D,W){un.call(this,D,W)};ls.prototype=Object.create(un.prototype),ls.prototype.isValid=function(){return this.coordinates.length>1},ls.prototype.addCoordinate=function(D,W,Ge){this.changed();const Ye=parseInt(D,10);this.coordinates.splice(Ye,0,[W,Ge])},ls.prototype.getCoordinate=function(D){const W=parseInt(D,10);return JSON.parse(JSON.stringify(this.coordinates[W]))},ls.prototype.removeCoordinate=function(D){this.changed(),this.coordinates.splice(parseInt(D,10),1)},ls.prototype.updateCoordinate=function(D,W,Ge){const Ye=parseInt(D,10);this.coordinates[Ye]=[W,Ge],this.changed()};var Rs=ls;const cn=function(D,W){un.call(this,D,W),this.coordinates=this.coordinates.map(Ge=>Ge.slice(0,-1))};cn.prototype=Object.create(un.prototype),cn.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(D=>D.length>2)},cn.prototype.incomingCoords=function(D){this.coordinates=D.map(W=>W.slice(0,-1)),this.changed()},cn.prototype.setCoordinates=function(D){this.coordinates=D,this.changed()},cn.prototype.addCoordinate=function(D,W,Ge){this.changed();const Ye=D.split(".").map(Ei=>parseInt(Ei,10));this.coordinates[Ye[0]].splice(Ye[1],0,[W,Ge])},cn.prototype.removeCoordinate=function(D){this.changed();const W=D.split(".").map(Ye=>parseInt(Ye,10)),Ge=this.coordinates[W[0]];Ge&&(Ge.splice(W[1],1),Ge.length<3&&this.coordinates.splice(W[0],1))},cn.prototype.getCoordinate=function(D){const W=D.split(".").map(Ye=>parseInt(Ye,10)),Ge=this.coordinates[W[0]];return JSON.parse(JSON.stringify(Ge[W[1]]))},cn.prototype.getCoordinates=function(){return this.coordinates.map(D=>D.concat([D[0]]))},cn.prototype.updateCoordinate=function(D,W,Ge){this.changed();const Ye=D.split("."),Bt=parseInt(Ye[0],10),Ei=parseInt(Ye[1],10);this.coordinates[Bt]===void 0&&(this.coordinates[Bt]=[]),this.coordinates[Bt][Ei]=[W,Ge]};var Jr=cn;const Pr={MultiPoint:Hs,MultiLineString:Rs,MultiPolygon:Jr},Ts=(D,W,Ge,Ye,Bt)=>{const Ei=Ge.split("."),Pn=parseInt(Ei[0],10),yn=Ei[1]?Ei.slice(1).join("."):null;return D[Pn][W](yn,Ye,Bt)},Dn=function(D,W){if(un.call(this,D,W),delete this.coordinates,this.model=Pr[W.geometry.type],this.model===void 0)throw new TypeError(`${W.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(W.geometry.coordinates)};Dn.prototype=Object.create(un.prototype),Dn.prototype._coordinatesToFeatures=function(D){const W=this.model.bind(this);return D.map(Ge=>new W(this.ctx,{id:Xs(),type:ct.FEATURE,properties:{},geometry:{coordinates:Ge,type:this.type.replace("Multi","")}}))},Dn.prototype.isValid=function(){return this.features.every(D=>D.isValid())},Dn.prototype.setCoordinates=function(D){this.features=this._coordinatesToFeatures(D),this.changed()},Dn.prototype.getCoordinate=function(D){return Ts(this.features,"getCoordinate",D)},Dn.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(D=>D.type===ct.POLYGON?D.getCoordinates():D.coordinates)))},Dn.prototype.updateCoordinate=function(D,W,Ge){Ts(this.features,"updateCoordinate",D,W,Ge),this.changed()},Dn.prototype.addCoordinate=function(D,W,Ge){Ts(this.features,"addCoordinate",D,W,Ge),this.changed()},Dn.prototype.removeCoordinate=function(D){Ts(this.features,"removeCoordinate",D),this.changed()},Dn.prototype.getFeatures=function(){return this.features};var xs=Dn;function Gn(D){this.map=D.map,this.drawConfig=JSON.parse(JSON.stringify(D.options||{})),this._ctx=D}Gn.prototype.setSelected=function(D){return this._ctx.store.setSelected(D)},Gn.prototype.setSelectedCoordinates=function(D){this._ctx.store.setSelectedCoordinates(D),D.reduce((W,Ge)=>(W[Ge.feature_id]===void 0&&(W[Ge.feature_id]=!0,this._ctx.store.get(Ge.feature_id).changed()),W),{})},Gn.prototype.getSelected=function(){return this._ctx.store.getSelected()},Gn.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Gn.prototype.isSelected=function(D){return this._ctx.store.isSelected(D)},Gn.prototype.getFeature=function(D){return this._ctx.store.get(D)},Gn.prototype.select=function(D){return this._ctx.store.select(D)},Gn.prototype.deselect=function(D){return this._ctx.store.deselect(D)},Gn.prototype.deleteFeature=function(D,W={}){return this._ctx.store.delete(D,W)},Gn.prototype.addFeature=function(D,W={}){return this._ctx.store.add(D,W)},Gn.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Gn.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Gn.prototype.setActionableState=function(D={}){const W={trash:D.trash||!1,combineFeatures:D.combineFeatures||!1,uncombineFeatures:D.uncombineFeatures||!1};return this._ctx.events.actionable(W)},Gn.prototype.changeMode=function(D,W={},Ge={}){return this._ctx.events.changeMode(D,W,Ge)},Gn.prototype.fire=function(D,W){return this._ctx.events.fire(D,W)},Gn.prototype.updateUIClasses=function(D){return this._ctx.ui.queueMapClasses(D)},Gn.prototype.activateUIButton=function(D){return this._ctx.ui.setActiveButton(D)},Gn.prototype.featuresAt=function(D,W,Ge="click"){if(Ge!=="click"&&Ge!=="touch")throw new Error("invalid buffer type");return at[Ge](D,W,this._ctx)},Gn.prototype.newFeature=function(D){const W=D.geometry.type;return W===ct.POINT?new Hs(this._ctx,D):W===ct.LINE_STRING?new Rs(this._ctx,D):W===ct.POLYGON?new Jr(this._ctx,D):new xs(this._ctx,D)},Gn.prototype.isInstanceOf=function(D,W){if(D===ct.POINT)return W instanceof Hs;if(D===ct.LINE_STRING)return W instanceof Rs;if(D===ct.POLYGON)return W instanceof Jr;if(D==="MultiFeature")return W instanceof xs;throw new Error(`Unknown feature class: ${D}`)},Gn.prototype.doRender=function(D){return this._ctx.store.featureChanged(D)};var Ir=Gn;Gn.prototype.onSetup=function(){},Gn.prototype.onDrag=function(){},Gn.prototype.onClick=function(){},Gn.prototype.onMouseMove=function(){},Gn.prototype.onMouseDown=function(){},Gn.prototype.onMouseUp=function(){},Gn.prototype.onMouseOut=function(){},Gn.prototype.onKeyUp=function(){},Gn.prototype.onKeyDown=function(){},Gn.prototype.onTouchStart=function(){},Gn.prototype.onTouchMove=function(){},Gn.prototype.onTouchEnd=function(){},Gn.prototype.onTap=function(){},Gn.prototype.onStop=function(){},Gn.prototype.onTrash=function(){},Gn.prototype.onCombineFeature=function(){},Gn.prototype.onUncombineFeature=function(){},Gn.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const fo={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},ms=Object.keys(fo);function Co(D){const W=Object.keys(D);return function(Ge,Ye={}){let Bt={};const Ei=W.reduce((yn,pr)=>(yn[pr]=D[pr],yn),new Ir(Ge));function Pn(yn){return pr=>Ei[yn](Bt,pr)}return{start(){Bt=Ei.onSetup(Ye),ms.forEach(yn=>{const pr=fo[yn];let Er=()=>!1;D[pr]&&(Er=()=>!0),this.on(yn,Er,Pn(pr))})},stop(){Ei.onStop(Bt)},trash(){Ei.onTrash(Bt)},combineFeatures(){Ei.onCombineFeatures(Bt)},uncombineFeatures(){Ei.onUncombineFeatures(Bt)},render(yn,pr){Ei.toDisplayFeatures(Bt,yn,pr)}}}}function mr(D){const W=Object.keys(D.options.modes).reduce((nt,jt)=>(nt[jt]=Co(D.options.modes[jt]),nt),{});let Ge={},Ye={};const Bt={};let Ei=null,Pn=null;Bt.drag=function(nt,jt){jt({point:nt.point,time:new Date().getTime()})?(D.ui.queueMapClasses({mouse:et.DRAG}),Pn.drag(nt)):nt.originalEvent.stopPropagation()},Bt.mousedrag=function(nt){Bt.drag(nt,jt=>!Ls(Ge,jt))},Bt.touchdrag=function(nt){Bt.drag(nt,jt=>!lt(Ye,jt))},Bt.mousemove=function(nt){if((nt.originalEvent.buttons!==void 0?nt.originalEvent.buttons:nt.originalEvent.which)===1)return Bt.mousedrag(nt);const Ti=Mn(nt,D);nt.featureTarget=Ti,Pn.mousemove(nt)},Bt.mousedown=function(nt){Ge={time:new Date().getTime(),point:nt.point};const jt=Mn(nt,D);nt.featureTarget=jt,Pn.mousedown(nt)},Bt.mouseup=function(nt){const jt=Mn(nt,D);nt.featureTarget=jt,Ls(Ge,{point:nt.point,time:new Date().getTime()})?Pn.click(nt):Pn.mouseup(nt)},Bt.mouseout=function(nt){Pn.mouseout(nt)},Bt.touchstart=function(nt){if(!D.options.touchEnabled)return;Ye={time:new Date().getTime(),point:nt.point};const jt=at.touch(nt,null,D)[0];nt.featureTarget=jt,Pn.touchstart(nt)},Bt.touchmove=function(nt){if(D.options.touchEnabled)return Pn.touchmove(nt),Bt.touchdrag(nt)},Bt.touchend=function(nt){if(nt.originalEvent.preventDefault(),!D.options.touchEnabled)return;const jt=at.touch(nt,null,D)[0];nt.featureTarget=jt,lt(Ye,{time:new Date().getTime(),point:nt.point})?Pn.tap(nt):Pn.touchend(nt)};const yn=nt=>!(nt===8||nt===46||nt>=48&&nt<=57);Bt.keydown=function(nt){(nt.srcElement||nt.target).classList.contains(ti.CANVAS)&&((nt.keyCode===8||nt.keyCode===46)&&D.options.controls.trash?(nt.preventDefault(),Pn.trash()):yn(nt.keyCode)?Pn.keydown(nt):nt.keyCode===49&&D.options.controls.point?pr(Qt.DRAW_POINT):nt.keyCode===50&&D.options.controls.line_string?pr(Qt.DRAW_LINE_STRING):nt.keyCode===51&&D.options.controls.polygon&&pr(Qt.DRAW_POLYGON))},Bt.keyup=function(nt){yn(nt.keyCode)&&Pn.keyup(nt)},Bt.zoomend=function(){D.store.changeZoom()},Bt.data=function(nt){if(nt.dataType==="style"){const{setup:jt,map:Ti,options:ni,store:wi}=D;ni.styles.some(Li=>Ti.getLayer(Li.id))||(jt.addLayers(),wi.setDirty(),wi.render())}};function pr(nt,jt,Ti={}){Pn.stop();const ni=W[nt];if(ni===void 0)throw new Error(`${nt} is not valid`);Ei=nt;const wi=ni(D,jt);Pn=xn(wi,D),Ti.silent||D.map.fire(Ii.MODE_CHANGE,{mode:nt}),D.store.setDirty(),D.store.render()}const Er={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function ft(nt){let jt=!1;Object.keys(nt).forEach(Ti=>{if(Er[Ti]===void 0)throw new Error("Invalid action type");Er[Ti]!==nt[Ti]&&(jt=!0),Er[Ti]=nt[Ti]}),jt&&D.map.fire(Ii.ACTIONABLE,{actions:Er})}return{start(){Ei=D.options.defaultMode,Pn=xn(W[Ei](D),D)},changeMode:pr,actionable:ft,currentModeName(){return Ei},currentModeRender(nt,jt){return Pn.render(nt,jt)},fire(nt,jt){D.map&&D.map.fire(nt,jt)},addEventListeners(){D.map.on("mousemove",Bt.mousemove),D.map.on("mousedown",Bt.mousedown),D.map.on("mouseup",Bt.mouseup),D.map.on("data",Bt.data),D.map.on("touchmove",Bt.touchmove),D.map.on("touchstart",Bt.touchstart),D.map.on("touchend",Bt.touchend),D.container.addEventListener("mouseout",Bt.mouseout),D.options.keybindings&&(D.container.addEventListener("keydown",Bt.keydown),D.container.addEventListener("keyup",Bt.keyup))},removeEventListeners(){D.map.off("mousemove",Bt.mousemove),D.map.off("mousedown",Bt.mousedown),D.map.off("mouseup",Bt.mouseup),D.map.off("data",Bt.data),D.map.off("touchmove",Bt.touchmove),D.map.off("touchstart",Bt.touchstart),D.map.off("touchend",Bt.touchend),D.container.removeEventListener("mouseout",Bt.mouseout),D.options.keybindings&&(D.container.removeEventListener("keydown",Bt.keydown),D.container.removeEventListener("keyup",Bt.keyup))},trash(nt){Pn.trash(nt)},combineFeatures(){Pn.combineFeatures()},uncombineFeatures(){Pn.uncombineFeatures()},getMode(){return Ei}}}function Ss(D){return[].concat(D).filter(W=>W!==void 0)}var ks=Ss;function ur(){const D=this;if(!(D.ctx.map&&D.ctx.map.getSource($t.HOT)!==void 0))return pr();const Ge=D.ctx.events.currentModeName();D.ctx.ui.queueMapClasses({mode:Ge});let Ye=[],Bt=[];D.isDirty?Bt=D.getAllIds():(Ye=D.getChangedIds().filter(Er=>D.get(Er)!==void 0),Bt=D.sources.hot.filter(Er=>Er.properties.id&&Ye.indexOf(Er.properties.id)===-1&&D.get(Er.properties.id)!==void 0).map(Er=>Er.properties.id)),D.sources.hot=[];const Ei=D.sources.cold.length;D.sources.cold=D.isDirty?[]:D.sources.cold.filter(Er=>{const ft=Er.properties.id||Er.properties.parent;return Ye.indexOf(ft)===-1});const Pn=Ei!==D.sources.cold.length||Bt.length>0;Ye.forEach(Er=>yn(Er,"hot")),Bt.forEach(Er=>yn(Er,"cold"));function yn(Er,ft){const nt=D.get(Er).internal(Ge);D.ctx.events.currentModeRender(nt,jt=>{jt.properties.mode=Ge,D.sources[ft].push(jt)})}Pn&&D.ctx.map.getSource($t.COLD).setData({type:ct.FEATURE_COLLECTION,features:D.sources.cold}),D.ctx.map.getSource($t.HOT).setData({type:ct.FEATURE_COLLECTION,features:D.sources.hot}),pr();function pr(){D.isDirty=!1,D.clearChangedIds()}}function _e(D){this._features={},this._featureIds=new rn,this._selectedFeatureIds=new rn,this._selectedCoordinates=[],this._changedFeatureIds=new rn,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=D,this.sources={hot:[],cold:[]};let W;this.render=()=>{W||(W=requestAnimationFrame(()=>{W=null,ur.call(this),this._emitSelectionChange&&(this.ctx.events.fire(Ii.SELECTION_CHANGE,{features:this.getSelected().map(Ge=>Ge.toGeoJSON()),points:this.getSelectedCoordinates().map(Ge=>({type:ct.FEATURE,properties:{},geometry:{type:ct.POINT,coordinates:Ge.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(Ii.RENDER,{})}))},this.isDirty=!1}_e.prototype.createRenderBatch=function(){const D=this.render;let W=0;return this.render=function(){W++},()=>{this.render=D,W>0&&this.render()}},_e.prototype.setDirty=function(){return this.isDirty=!0,this},_e.prototype.featureCreated=function(D,W={}){if(this._changedFeatureIds.add(D),(W.silent!=null?W.silent:this.ctx.options.suppressAPIEvents)!==!0){const Ye=this.get(D);this.ctx.events.fire(Ii.CREATE,{features:[Ye.toGeoJSON()]})}return this},_e.prototype.featureChanged=function(D,W={}){return this._changedFeatureIds.add(D),(W.silent!=null?W.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(Ii.UPDATE,{action:W.action?W.action:Yi.CHANGE_COORDINATES,features:[this.get(D).toGeoJSON()]}),this},_e.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},_e.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},_e.prototype.getAllIds=function(){return this._featureIds.values()},_e.prototype.add=function(D,W={}){return this._features[D.id]=D,this._featureIds.add(D.id),this.featureCreated(D.id,{silent:W.silent}),this},_e.prototype.delete=function(D,W={}){const Ge=[];return ks(D).forEach(Ye=>{this._featureIds.has(Ye)&&(this._featureIds.delete(Ye),this._selectedFeatureIds.delete(Ye),W.silent||Ge.indexOf(this._features[Ye])===-1&&Ge.push(this._features[Ye].toGeoJSON()),delete this._features[Ye],this.isDirty=!0)}),Ge.length&&this.ctx.events.fire(Ii.DELETE,{features:Ge}),he(this,W),this},_e.prototype.get=function(D){return this._features[D]},_e.prototype.getAll=function(){return Object.keys(this._features).map(D=>this._features[D])},_e.prototype.select=function(D,W={}){return ks(D).forEach(Ge=>{this._selectedFeatureIds.has(Ge)||(this._selectedFeatureIds.add(Ge),this._changedFeatureIds.add(Ge),W.silent||(this._emitSelectionChange=!0))}),this},_e.prototype.deselect=function(D,W={}){return ks(D).forEach(Ge=>{this._selectedFeatureIds.has(Ge)&&(this._selectedFeatureIds.delete(Ge),this._changedFeatureIds.add(Ge),W.silent||(this._emitSelectionChange=!0))}),he(this,W),this},_e.prototype.clearSelected=function(D={}){return this.deselect(this._selectedFeatureIds.values(),{silent:D.silent}),this},_e.prototype.setSelected=function(D,W={}){return D=ks(D),this.deselect(this._selectedFeatureIds.values().filter(Ge=>D.indexOf(Ge)===-1),{silent:W.silent}),this.select(D.filter(Ge=>!this._selectedFeatureIds.has(Ge)),{silent:W.silent}),this},_e.prototype.setSelectedCoordinates=function(D){return this._selectedCoordinates=D,this._emitSelectionChange=!0,this},_e.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},_e.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},_e.prototype.getSelected=function(){return this.getSelectedIds().map(D=>this.get(D))},_e.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(W=>({coordinates:this.get(W.feature_id).getCoordinate(W.coord_path)}))},_e.prototype.isSelected=function(D){return this._selectedFeatureIds.has(D)},_e.prototype.setFeatureProperty=function(D,W,Ge,Ye={}){this.get(D).setProperty(W,Ge),this.featureChanged(D,{silent:Ye.silent,action:Yi.CHANGE_PROPERTIES})};function he(D,W={}){const Ge=D._selectedCoordinates.filter(Ye=>D._selectedFeatureIds.has(Ye.feature_id));D._selectedCoordinates.length!==Ge.length&&!W.silent&&(D._emitSelectionChange=!0),D._selectedCoordinates=Ge}_e.prototype.storeMapConfig=function(){dt.forEach(D=>{this.ctx.map[D]&&(this._mapInitialConfig[D]=this.ctx.map[D].isEnabled())})},_e.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(D=>{this._mapInitialConfig[D]?this.ctx.map[D].enable():this.ctx.map[D].disable()})},_e.prototype.getInitialConfigValue=function(D){return this._mapInitialConfig[D]!==void 0?this._mapInitialConfig[D]:!0};const pe=["mode","feature","mouse"];function Re(D){const W={};let Ge=null,Ye={mode:null,feature:null,mouse:null},Bt={mode:null,feature:null,mouse:null};function Ei(){Pn({mode:null,feature:null,mouse:null}),yn()}function Pn(jt){Bt=Object.assign(Bt,jt)}function yn(){if(!D.container)return;const jt=[],Ti=[];pe.forEach(ni=>{Bt[ni]!==Ye[ni]&&(jt.push(`${ni}-${Ye[ni]}`),Bt[ni]!==null&&Ti.push(`${ni}-${Bt[ni]}`))}),jt.length>0&&D.container.classList.remove(...jt),Ti.length>0&&D.container.classList.add(...Ti),Ye=Object.assign(Ye,Bt)}function pr(jt,Ti={}){const ni=document.createElement("button");return ni.className=`${ti.CONTROL_BUTTON} ${Ti.className}`,ni.setAttribute("title",Ti.title),Ti.container.appendChild(ni),ni.addEventListener("click",wi=>{if(wi.preventDefault(),wi.stopPropagation(),wi.target===Ge){Er(),Ti.onDeactivate();return}ft(jt),Ti.onActivate()},!0),ni}function Er(){Ge&&(Ge.classList.remove(ti.ACTIVE_BUTTON),Ge=null)}function ft(jt){Er();const Ti=W[jt];Ti&&Ti&&jt!=="trash"&&(Ti.classList.add(ti.ACTIVE_BUTTON),Ge=Ti)}function mi(){const jt=D.options.controls,Ti=document.createElement("div");return Ti.className=`${ti.CONTROL_GROUP} ${ti.CONTROL_BASE}`,jt&&(jt[yi.LINE]&&(W[yi.LINE]=pr(yi.LINE,{container:Ti,className:ti.CONTROL_BUTTON_LINE,title:`LineString tool ${D.options.keybindings?"(l)":""}`,onActivate:()=>D.events.changeMode(Qt.DRAW_LINE_STRING),onDeactivate:()=>D.events.trash()})),jt[yi.POLYGON]&&(W[yi.POLYGON]=pr(yi.POLYGON,{container:Ti,className:ti.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${D.options.keybindings?"(p)":""}`,onActivate:()=>D.events.changeMode(Qt.DRAW_POLYGON),onDeactivate:()=>D.events.trash()})),jt[yi.POINT]&&(W[yi.POINT]=pr(yi.POINT,{container:Ti,className:ti.CONTROL_BUTTON_POINT,title:`Marker tool ${D.options.keybindings?"(m)":""}`,onActivate:()=>D.events.changeMode(Qt.DRAW_POINT),onDeactivate:()=>D.events.trash()})),jt.trash&&(W.trash=pr("trash",{container:Ti,className:ti.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{D.events.trash()}})),jt.combine_features&&(W.combine_features=pr("combineFeatures",{container:Ti,className:ti.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{D.events.combineFeatures()}})),jt.uncombine_features&&(W.uncombine_features=pr("uncombineFeatures",{container:Ti,className:ti.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{D.events.uncombineFeatures()}}))),Ti}function nt(){Object.keys(W).forEach(jt=>{const Ti=W[jt];Ti.parentNode&&Ti.parentNode.removeChild(Ti),delete W[jt]})}return{setActiveButton:ft,queueMapClasses:Pn,updateMapClasses:yn,clearMapClasses:Ei,addButtons:mi,removeButtons:nt}}function ke(D){let W=null,Ge=null;const Ye={onRemove(){return D.map.off("load",Ye.connect),clearInterval(Ge),Ye.removeLayers(),D.store.restoreMapConfig(),D.ui.removeButtons(),D.events.removeEventListeners(),D.ui.clearMapClasses(),D.boxZoomInitial&&D.map.boxZoom.enable(),D.map=null,D.container=null,D.store=null,W&&W.parentNode&&W.parentNode.removeChild(W),W=null,this},connect(){D.map.off("load",Ye.connect),clearInterval(Ge),Ye.addLayers(),D.store.storeMapConfig(),D.events.addEventListeners()},onAdd(Bt){if(D.map=Bt,D.events=mr(D),D.ui=Re(D),D.container=Bt.getContainer(),D.store=new _e(D),W=D.ui.addButtons(),D.options.boxSelect){D.boxZoomInitial=Bt.boxZoom.isEnabled(),Bt.boxZoom.disable();const Ei=Bt.dragPan.isEnabled();Bt.dragPan.disable(),Bt.dragPan.enable(),Ei||Bt.dragPan.disable()}return Bt.loaded()?Ye.connect():(Bt.on("load",Ye.connect),Ge=setInterval(()=>{Bt.loaded()&&Ye.connect()},16)),D.events.start(),W},addLayers(){D.map.addSource($t.COLD,{data:{type:ct.FEATURE_COLLECTION,features:[]},type:"geojson"}),D.map.addSource($t.HOT,{data:{type:ct.FEATURE_COLLECTION,features:[]},type:"geojson"}),D.options.styles.forEach(Bt=>{D.map.addLayer(Bt)}),D.store.setDirty(!0),D.store.render()},removeLayers(){D.options.styles.forEach(Bt=>{D.map.getLayer(Bt.id)&&D.map.removeLayer(Bt.id)}),D.map.getSource($t.COLD)&&D.map.removeSource($t.COLD),D.map.getSource($t.HOT)&&D.map.removeSource($t.HOT)}};return D.setup=Ye,Ye}const ui="#3bb2d0",Vt="#fbb03b",fi="#fff";var Zt=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],Vt,ui],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],Vt,ui],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":fi}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],Vt,ui]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":fi}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":Vt}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":Vt}}];function en(D){return function(W){const Ge=W.featureTarget;return!Ge||!Ge.properties?!1:Ge.properties.meta===D}}function Un(D){return!D.originalEvent||!D.originalEvent.shiftKey?!1:D.originalEvent.button===0}function Bn(D){return!D.featureTarget||!D.featureTarget.properties?!1:D.featureTarget.properties.active===ot.ACTIVE&&D.featureTarget.properties.meta===We.FEATURE}function Or(D){return!D.featureTarget||!D.featureTarget.properties?!1:D.featureTarget.properties.active===ot.INACTIVE&&D.featureTarget.properties.meta===We.FEATURE}function hs(D){return D.featureTarget===void 0}function Vs(D){return!D.featureTarget||!D.featureTarget.properties?!1:D.featureTarget.properties.meta===We.FEATURE}function qr(D){const W=D.featureTarget;return!W||!W.properties?!1:W.properties.meta===We.VERTEX}function ds(D){return D.originalEvent?D.originalEvent.shiftKey===!0:!1}function gt(D){return D.keyCode===27}function q(D){return D.keyCode===13}function ee(){return!0}function oe(D,W){this.x=D,this.y=W}oe.prototype={clone(){return new oe(this.x,this.y)},add(D){return this.clone()._add(D)},sub(D){return this.clone()._sub(D)},multByPoint(D){return this.clone()._multByPoint(D)},divByPoint(D){return this.clone()._divByPoint(D)},mult(D){return this.clone()._mult(D)},div(D){return this.clone()._div(D)},rotate(D){return this.clone()._rotate(D)},rotateAround(D,W){return this.clone()._rotateAround(D,W)},matMult(D){return this.clone()._matMult(D)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(D){return this.x===D.x&&this.y===D.y},dist(D){return Math.sqrt(this.distSqr(D))},distSqr(D){const W=D.x-this.x,Ge=D.y-this.y;return W*W+Ge*Ge},angle(){return Math.atan2(this.y,this.x)},angleTo(D){return Math.atan2(this.y-D.y,this.x-D.x)},angleWith(D){return this.angleWithSep(D.x,D.y)},angleWithSep(D,W){return Math.atan2(this.x*W-this.y*D,this.x*D+this.y*W)},_matMult(D){const W=D[0]*this.x+D[1]*this.y,Ge=D[2]*this.x+D[3]*this.y;return this.x=W,this.y=Ge,this},_add(D){return this.x+=D.x,this.y+=D.y,this},_sub(D){return this.x-=D.x,this.y-=D.y,this},_mult(D){return this.x*=D,this.y*=D,this},_div(D){return this.x/=D,this.y/=D,this},_multByPoint(D){return this.x*=D.x,this.y*=D.y,this},_divByPoint(D){return this.x/=D.x,this.y/=D.y,this},_unit(){return this._div(this.mag()),this},_perp(){const D=this.y;return this.y=this.x,this.x=-D,this},_rotate(D){const W=Math.cos(D),Ge=Math.sin(D),Ye=W*this.x-Ge*this.y,Bt=Ge*this.x+W*this.y;return this.x=Ye,this.y=Bt,this},_rotateAround(D,W){const Ge=Math.cos(D),Ye=Math.sin(D),Bt=W.x+Ge*(this.x-W.x)-Ye*(this.y-W.y),Ei=W.y+Ye*(this.x-W.x)+Ge*(this.y-W.y);return this.x=Bt,this.y=Ei,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:oe},oe.convert=function(D){if(D instanceof oe)return D;if(Array.isArray(D))return new oe(+D[0],+D[1]);if(D.x!==void 0&&D.y!==void 0)return new oe(+D.x,+D.y);throw new Error("Expected [x, y] or {x, y} point format")};function Ee(D,W){const Ge=W.getBoundingClientRect();return new oe(D.clientX-Ge.left-(W.clientLeft||0),D.clientY-Ge.top-(W.clientTop||0))}var be=Ee;function Ce(D,W,Ge,Ye){return{type:ct.FEATURE,properties:{meta:We.VERTEX,parent:D,coord_path:Ge,active:Ye?ot.ACTIVE:ot.INACTIVE},geometry:{type:ct.POINT,coordinates:W}}}function Y(D,W,Ge){const Ye=W.geometry.coordinates,Bt=Ge.geometry.coordinates;if(Ye[1]>Ue||Ye[1]<Be||Bt[1]>Ue||Bt[1]<Be)return null;const Ei={lng:(Ye[0]+Bt[0])/2,lat:(Ye[1]+Bt[1])/2};return{type:ct.FEATURE,properties:{meta:We.MIDPOINT,parent:D,lng:Ei.lng,lat:Ei.lat,coord_path:Ge.properties.coord_path},geometry:{type:ct.POINT,coordinates:[Ei.lng,Ei.lat]}}}function K(D,W={},Ge=null){const{type:Ye,coordinates:Bt}=D.geometry,Ei=D.properties&&D.properties.id;let Pn=[];Ye===ct.POINT?Pn.push(Ce(Ei,Bt,Ge,pr(Ge))):Ye===ct.POLYGON?Bt.forEach((ft,mi)=>{yn(ft,Ge!==null?`${Ge}.${mi}`:String(mi))}):Ye===ct.LINE_STRING?yn(Bt,Ge):Ye.indexOf(ct.MULTI_PREFIX)===0&&Er();function yn(ft,mi){let nt="",jt=null;ft.forEach((Ti,ni)=>{const wi=mi!=null?`${mi}.${ni}`:String(ni),Mi=Ce(Ei,Ti,wi,pr(wi));if(W.midpoints&&jt){const pt=Y(Ei,jt,Mi);pt&&Pn.push(pt)}jt=Mi;const Li=JSON.stringify(Ti);nt!==Li&&Pn.push(Mi),ni===0&&(nt=Li)})}function pr(ft){return W.selectedPaths?W.selectedPaths.indexOf(ft)!==-1:!1}function Er(){const ft=Ye.replace(ct.MULTI_PREFIX,"");Bt.forEach((mi,nt)=>{const jt={type:ct.FEATURE,properties:D.properties,geometry:{type:ft,coordinates:mi}};Pn=Pn.concat(K(jt,W,nt))})}return Pn}var se=K,fe={enable(D){setTimeout(()=>{!D.map||!D.map.doubleClickZoom||!D._ctx||!D._ctx.store||!D._ctx.store.getInitialConfigValue||D._ctx.store.getInitialConfigValue("doubleClickZoom")&&D.map.doubleClickZoom.enable()},0)},disable(D){setTimeout(()=>{!D.map||!D.map.doubleClickZoom||D.map.doubleClickZoom.disable()},0)}};const{LAT_MIN:ce,LAT_MAX:Se,LAT_RENDERED_MIN:it,LAT_RENDERED_MAX:Ne,LNG_MIN:ut,LNG_MAX:Et}=xe;function xt(D){const W={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[D.geometry.type],Ge=[D.geometry.coordinates].flat(W),Ye=Ge.map(yn=>yn[0]),Bt=Ge.map(yn=>yn[1]),Ei=yn=>Math.min.apply(null,yn),Pn=yn=>Math.max.apply(null,yn);return[Ei(Ye),Ei(Bt),Pn(Ye),Pn(Bt)]}function Xt(D,W){let Ge=ce,Ye=Se,Bt=ce,Ei=Se,Pn=Et,yn=ut;D.forEach(Er=>{const ft=xt(Er),mi=ft[1],nt=ft[3],jt=ft[0],Ti=ft[2];mi>Ge&&(Ge=mi),nt<Ye&&(Ye=nt),nt>Bt&&(Bt=nt),mi<Ei&&(Ei=mi),jt<Pn&&(Pn=jt),Ti>yn&&(yn=Ti)});const pr=W;return Ge+pr.lat>Ne&&(pr.lat=Ne-Ge),Bt+pr.lat>Se&&(pr.lat=Se-Bt),Ye+pr.lat<it&&(pr.lat=it-Ye),Ei+pr.lat<ce&&(pr.lat=ce-Ei),Pn+pr.lng<=ut&&(pr.lng+=Math.ceil(Math.abs(pr.lng)/360)*360),yn+pr.lng>=Et&&(pr.lng-=Math.ceil(Math.abs(pr.lng)/360)*360),pr}function vn(D,W){const Ge=Xt(D.map(Ye=>Ye.toGeoJSON()),W);D.forEach(Ye=>{const Bt=Ye.getCoordinates(),Ei=Er=>{const ft={lng:Er[0]+Ge.lng,lat:Er[1]+Ge.lat};return[ft.lng,ft.lat]},Pn=Er=>Er.map(ft=>Ei(ft)),yn=Er=>Er.map(ft=>Pn(ft));let pr;Ye.type===ct.POINT?pr=Ei(Bt):Ye.type===ct.LINE_STRING||Ye.type===ct.MULTI_POINT?pr=Bt.map(Ei):Ye.type===ct.POLYGON||Ye.type===ct.MULTI_LINE_STRING?pr=Bt.map(Pn):Ye.type===ct.MULTI_POLYGON&&(pr=Bt.map(yn)),Ye.incomingCoords(pr)})}const nn={};nn.onSetup=function(D){const W={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:D.featureIds||[]};return this.setSelected(W.initiallySelectedFeatureIds.filter(Ge=>this.getFeature(Ge)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),W},nn.fireUpdate=function(){this.fire(Ii.UPDATE,{action:Yi.MOVE,features:this.getSelected().map(D=>D.toGeoJSON())})},nn.fireActionable=function(){const D=this.getSelected(),W=D.filter(Ei=>this.isInstanceOf("MultiFeature",Ei));let Ge=!1;if(D.length>1){Ge=!0;const Ei=D[0].type.replace("Multi","");D.forEach(Pn=>{Pn.type.replace("Multi","")!==Ei&&(Ge=!1)})}const Ye=W.length>0,Bt=D.length>0;this.setActionableState({combineFeatures:Ge,uncombineFeatures:Ye,trash:Bt})},nn.getUniqueIds=function(D){return D.length?D.map(Ge=>Ge.properties.id).filter(Ge=>Ge!==void 0).reduce((Ge,Ye)=>(Ge.add(Ye),Ge),new rn).values():[]},nn.stopExtendedInteractions=function(D){D.boxSelectElement&&(D.boxSelectElement.parentNode&&D.boxSelectElement.parentNode.removeChild(D.boxSelectElement),D.boxSelectElement=null),(D.canDragMove||D.canBoxSelect)&&D.initialDragPanState===!0&&this.map.dragPan.enable(),D.boxSelecting=!1,D.canBoxSelect=!1,D.dragMoving=!1,D.canDragMove=!1},nn.onStop=function(){fe.enable(this)},nn.onMouseMove=function(D,W){return Vs(W)&&D.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(D),!0},nn.onMouseOut=function(D){return D.dragMoving?this.fireUpdate():!0},nn.onTap=nn.onClick=function(D,W){if(hs(W))return this.clickAnywhere(D,W);if(en(We.VERTEX)(W))return this.clickOnVertex(D,W);if(Vs(W))return this.clickOnFeature(D,W)},nn.clickAnywhere=function(D){const W=this.getSelectedIds();W.length&&(this.clearSelectedFeatures(),W.forEach(Ge=>this.doRender(Ge))),fe.enable(this),this.stopExtendedInteractions(D)},nn.clickOnVertex=function(D,W){this.changeMode(Qt.DIRECT_SELECT,{featureId:W.featureTarget.properties.parent,coordPath:W.featureTarget.properties.coord_path,startPos:W.lngLat}),this.updateUIClasses({mouse:et.MOVE})},nn.startOnActiveFeature=function(D,W){this.stopExtendedInteractions(D),this.map.dragPan.disable(),this.doRender(W.featureTarget.properties.id),D.canDragMove=!0,D.dragMoveLocation=W.lngLat},nn.clickOnFeature=function(D,W){fe.disable(this),this.stopExtendedInteractions(D);const Ge=ds(W),Ye=this.getSelectedIds(),Bt=W.featureTarget.properties.id,Ei=this.isSelected(Bt);if(!Ge&&Ei&&this.getFeature(Bt).type!==ct.POINT)return this.changeMode(Qt.DIRECT_SELECT,{featureId:Bt});Ei&&Ge?(this.deselect(Bt),this.updateUIClasses({mouse:et.POINTER}),Ye.length===1&&fe.enable(this)):!Ei&&Ge?(this.select(Bt),this.updateUIClasses({mouse:et.MOVE})):!Ei&&!Ge&&(Ye.forEach(Pn=>this.doRender(Pn)),this.setSelected(Bt),this.updateUIClasses({mouse:et.MOVE})),this.doRender(Bt)},nn.onMouseDown=function(D,W){if(D.initialDragPanState=this.map.dragPan.isEnabled(),Bn(W))return this.startOnActiveFeature(D,W);if(this.drawConfig.boxSelect&&Un(W))return this.startBoxSelect(D,W)},nn.startBoxSelect=function(D,W){this.stopExtendedInteractions(D),this.map.dragPan.disable(),D.boxSelectStartLocation=be(W.originalEvent,this.map.getContainer()),D.canBoxSelect=!0},nn.onTouchStart=function(D,W){if(Bn(W))return this.startOnActiveFeature(D,W)},nn.onDrag=function(D,W){if(D.canDragMove)return this.dragMove(D,W);if(this.drawConfig.boxSelect&&D.canBoxSelect)return this.whileBoxSelect(D,W)},nn.whileBoxSelect=function(D,W){D.boxSelecting=!0,this.updateUIClasses({mouse:et.ADD}),D.boxSelectElement||(D.boxSelectElement=document.createElement("div"),D.boxSelectElement.classList.add(ti.BOX_SELECT),this.map.getContainer().appendChild(D.boxSelectElement));const Ge=be(W.originalEvent,this.map.getContainer()),Ye=Math.min(D.boxSelectStartLocation.x,Ge.x),Bt=Math.max(D.boxSelectStartLocation.x,Ge.x),Ei=Math.min(D.boxSelectStartLocation.y,Ge.y),Pn=Math.max(D.boxSelectStartLocation.y,Ge.y),yn=`translate(${Ye}px, ${Ei}px)`;D.boxSelectElement.style.transform=yn,D.boxSelectElement.style.WebkitTransform=yn,D.boxSelectElement.style.width=`${Bt-Ye}px`,D.boxSelectElement.style.height=`${Pn-Ei}px`},nn.dragMove=function(D,W){D.dragMoving=!0,W.originalEvent.stopPropagation();const Ge={lng:W.lngLat.lng-D.dragMoveLocation.lng,lat:W.lngLat.lat-D.dragMoveLocation.lat};vn(this.getSelected(),Ge),D.dragMoveLocation=W.lngLat},nn.onTouchEnd=nn.onMouseUp=function(D,W){if(D.dragMoving)this.fireUpdate();else if(D.boxSelecting){const Ge=[D.boxSelectStartLocation,be(W.originalEvent,this.map.getContainer())],Ye=this.featuresAt(null,Ge,"click"),Bt=this.getUniqueIds(Ye).filter(Ei=>!this.isSelected(Ei));Bt.length&&(this.select(Bt),Bt.forEach(Ei=>this.doRender(Ei)),this.updateUIClasses({mouse:et.MOVE}))}this.stopExtendedInteractions(D)},nn.toDisplayFeatures=function(D,W,Ge){W.properties.active=this.isSelected(W.properties.id)?ot.ACTIVE:ot.INACTIVE,Ge(W),this.fireActionable(),!(W.properties.active!==ot.ACTIVE||W.geometry.type===ct.POINT)&&se(W).forEach(Ge)},nn.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},nn.onCombineFeatures=function(){const D=this.getSelected();if(D.length===0||D.length<2)return;const W=[],Ge=[],Ye=D[0].type.replace("Multi","");for(let Bt=0;Bt<D.length;Bt++){const Ei=D[Bt];if(Ei.type.replace("Multi","")!==Ye)return;Ei.type.includes("Multi")?Ei.getCoordinates().forEach(Pn=>{W.push(Pn)}):W.push(Ei.getCoordinates()),Ge.push(Ei.toGeoJSON())}if(Ge.length>1){const Bt=this.newFeature({type:ct.FEATURE,properties:Ge[0].properties,geometry:{type:`Multi${Ye}`,coordinates:W}});this.addFeature(Bt),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Bt.id]),this.fire(Ii.COMBINE_FEATURES,{createdFeatures:[Bt.toGeoJSON()],deletedFeatures:Ge})}this.fireActionable()},nn.onUncombineFeatures=function(){const D=this.getSelected();if(D.length===0)return;const W=[],Ge=[];for(let Ye=0;Ye<D.length;Ye++){const Bt=D[Ye];this.isInstanceOf("MultiFeature",Bt)&&(Bt.getFeatures().forEach(Ei=>{this.addFeature(Ei),Ei.properties=Bt.properties,W.push(Ei.toGeoJSON()),this.select([Ei.id])}),this.deleteFeature(Bt.id,{silent:!0}),Ge.push(Bt.toGeoJSON()))}W.length>1&&this.fire(Ii.UNCOMBINE_FEATURES,{createdFeatures:W,deletedFeatures:Ge}),this.fireActionable()};var Tn=nn;const Kn=en(We.VERTEX),dr=en(We.MIDPOINT),Vn={};Vn.fireUpdate=function(){this.fire(Ii.UPDATE,{action:Yi.CHANGE_COORDINATES,features:this.getSelected().map(D=>D.toGeoJSON())})},Vn.fireActionable=function(D){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:D.selectedCoordPaths.length>0})},Vn.startDragging=function(D,W){D.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),D.canDragMove=!0,D.dragMoveLocation=W.lngLat},Vn.stopDragging=function(D){D.canDragMove&&D.initialDragPanState===!0&&this.map.dragPan.enable(),D.dragMoving=!1,D.canDragMove=!1,D.dragMoveLocation=null},Vn.onVertex=function(D,W){this.startDragging(D,W);const Ge=W.featureTarget.properties,Ye=D.selectedCoordPaths.indexOf(Ge.coord_path);!ds(W)&&Ye===-1?D.selectedCoordPaths=[Ge.coord_path]:ds(W)&&Ye===-1&&D.selectedCoordPaths.push(Ge.coord_path);const Bt=this.pathsToCoordinates(D.featureId,D.selectedCoordPaths);this.setSelectedCoordinates(Bt)},Vn.onMidpoint=function(D,W){this.startDragging(D,W);const Ge=W.featureTarget.properties;D.feature.addCoordinate(Ge.coord_path,Ge.lng,Ge.lat),this.fireUpdate(),D.selectedCoordPaths=[Ge.coord_path]},Vn.pathsToCoordinates=function(D,W){return W.map(Ge=>({feature_id:D,coord_path:Ge}))},Vn.onFeature=function(D,W){D.selectedCoordPaths.length===0?this.startDragging(D,W):this.stopDragging(D)},Vn.dragFeature=function(D,W,Ge){vn(this.getSelected(),Ge),D.dragMoveLocation=W.lngLat},Vn.dragVertex=function(D,W,Ge){const Ye=D.selectedCoordPaths.map(Pn=>D.feature.getCoordinate(Pn)),Bt=Ye.map(Pn=>({type:ct.FEATURE,properties:{},geometry:{type:ct.POINT,coordinates:Pn}})),Ei=Xt(Bt,Ge);for(let Pn=0;Pn<Ye.length;Pn++){const yn=Ye[Pn];D.feature.updateCoordinate(D.selectedCoordPaths[Pn],yn[0]+Ei.lng,yn[1]+Ei.lat)}},Vn.clickNoTarget=function(){this.changeMode(Qt.SIMPLE_SELECT)},Vn.clickInactive=function(){this.changeMode(Qt.SIMPLE_SELECT)},Vn.clickActiveFeature=function(D){D.selectedCoordPaths=[],this.clearSelectedCoordinates(),D.feature.changed()},Vn.onSetup=function(D){const W=D.featureId,Ge=this.getFeature(W);if(!Ge)throw new Error("You must provide a featureId to enter direct_select mode");if(Ge.type===ct.POINT)throw new TypeError("direct_select mode doesn't handle point features");const Ye={featureId:W,feature:Ge,dragMoveLocation:D.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:D.coordPath?[D.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(W,Ye.selectedCoordPaths)),this.setSelected(W),fe.disable(this),this.setActionableState({trash:!0}),Ye},Vn.onStop=function(){fe.enable(this),this.clearSelectedCoordinates()},Vn.toDisplayFeatures=function(D,W,Ge){D.featureId===W.properties.id?(W.properties.active=ot.ACTIVE,Ge(W),se(W,{map:this.map,midpoints:!0,selectedPaths:D.selectedCoordPaths}).forEach(Ge)):(W.properties.active=ot.INACTIVE,Ge(W)),this.fireActionable(D)},Vn.onTrash=function(D){D.selectedCoordPaths.sort((W,Ge)=>Ge.localeCompare(W,"en",{numeric:!0})).forEach(W=>D.feature.removeCoordinate(W)),this.fireUpdate(),D.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(D),D.feature.isValid()===!1&&(this.deleteFeature([D.featureId]),this.changeMode(Qt.SIMPLE_SELECT,{}))},Vn.onMouseMove=function(D,W){const Ge=Bn(W),Ye=Kn(W),Bt=dr(W),Ei=D.selectedCoordPaths.length===0;return Ge&&Ei?this.updateUIClasses({mouse:et.MOVE}):Ye&&!Ei?this.updateUIClasses({mouse:et.MOVE}):this.updateUIClasses({mouse:et.NONE}),(Ye||Ge||Bt)&&D.dragMoving&&this.fireUpdate(),this.stopDragging(D),!0},Vn.onMouseOut=function(D){return D.dragMoving&&this.fireUpdate(),!0},Vn.onTouchStart=Vn.onMouseDown=function(D,W){if(Kn(W))return this.onVertex(D,W);if(Bn(W))return this.onFeature(D,W);if(dr(W))return this.onMidpoint(D,W)},Vn.onDrag=function(D,W){if(D.canDragMove!==!0)return;D.dragMoving=!0,W.originalEvent.stopPropagation();const Ge={lng:W.lngLat.lng-D.dragMoveLocation.lng,lat:W.lngLat.lat-D.dragMoveLocation.lat};D.selectedCoordPaths.length>0?this.dragVertex(D,W,Ge):this.dragFeature(D,W,Ge),D.dragMoveLocation=W.lngLat},Vn.onClick=function(D,W){if(hs(W))return this.clickNoTarget(D,W);if(Bn(W))return this.clickActiveFeature(D,W);if(Or(W))return this.clickInactive(D,W);this.stopDragging(D)},Vn.onTap=function(D,W){if(hs(W))return this.clickNoTarget(D,W);if(Bn(W))return this.clickActiveFeature(D,W);if(Or(W))return this.clickInactive(D,W)},Vn.onTouchEnd=Vn.onMouseUp=function(D){D.dragMoving&&this.fireUpdate(),this.stopDragging(D)};var Hr=Vn;const Mr={};Mr.onSetup=function(){const D=this.newFeature({type:ct.FEATURE,properties:{},geometry:{type:ct.POINT,coordinates:[]}});return this.addFeature(D),this.clearSelectedFeatures(),this.updateUIClasses({mouse:et.ADD}),this.activateUIButton(yi.POINT),this.setActionableState({trash:!0}),{point:D}},Mr.stopDrawingAndRemove=function(D){this.deleteFeature([D.point.id],{silent:!0}),this.changeMode(Qt.SIMPLE_SELECT)},Mr.onTap=Mr.onClick=function(D,W){this.updateUIClasses({mouse:et.MOVE}),D.point.updateCoordinate("",W.lngLat.lng,W.lngLat.lat),this.fire(Ii.CREATE,{features:[D.point.toGeoJSON()]}),this.changeMode(Qt.SIMPLE_SELECT,{featureIds:[D.point.id]})},Mr.onStop=function(D){this.activateUIButton(),D.point.getCoordinate().length||this.deleteFeature([D.point.id],{silent:!0})},Mr.toDisplayFeatures=function(D,W,Ge){const Ye=W.properties.id===D.point.id;if(W.properties.active=Ye?ot.ACTIVE:ot.INACTIVE,!Ye)return Ge(W)},Mr.onTrash=Mr.stopDrawingAndRemove,Mr.onKeyUp=function(D,W){if(gt(W)||q(W))return this.stopDrawingAndRemove(D,W)};var zs=Mr;function Qs(D,W){return D.lngLat?D.lngLat.lng===W[0]&&D.lngLat.lat===W[1]:!1}var xo=Qs;const bs={};bs.onSetup=function(){const D=this.newFeature({type:ct.FEATURE,properties:{},geometry:{type:ct.POLYGON,coordinates:[[]]}});return this.addFeature(D),this.clearSelectedFeatures(),fe.disable(this),this.updateUIClasses({mouse:et.ADD}),this.activateUIButton(yi.POLYGON),this.setActionableState({trash:!0}),{polygon:D,currentVertexPosition:0}},bs.clickAnywhere=function(D,W){if(D.currentVertexPosition>0&&xo(W,D.polygon.coordinates[0][D.currentVertexPosition-1]))return this.changeMode(Qt.SIMPLE_SELECT,{featureIds:[D.polygon.id]});this.updateUIClasses({mouse:et.ADD}),D.polygon.updateCoordinate(`0.${D.currentVertexPosition}`,W.lngLat.lng,W.lngLat.lat),D.currentVertexPosition++,D.polygon.updateCoordinate(`0.${D.currentVertexPosition}`,W.lngLat.lng,W.lngLat.lat)},bs.clickOnVertex=function(D){return this.changeMode(Qt.SIMPLE_SELECT,{featureIds:[D.polygon.id]})},bs.onMouseMove=function(D,W){D.polygon.updateCoordinate(`0.${D.currentVertexPosition}`,W.lngLat.lng,W.lngLat.lat),qr(W)&&this.updateUIClasses({mouse:et.POINTER})},bs.onTap=bs.onClick=function(D,W){return qr(W)?this.clickOnVertex(D,W):this.clickAnywhere(D,W)},bs.onKeyUp=function(D,W){gt(W)?(this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Qt.SIMPLE_SELECT)):q(W)&&this.changeMode(Qt.SIMPLE_SELECT,{featureIds:[D.polygon.id]})},bs.onStop=function(D){this.updateUIClasses({mouse:et.NONE}),fe.enable(this),this.activateUIButton(),this.getFeature(D.polygon.id)!==void 0&&(D.polygon.removeCoordinate(`0.${D.currentVertexPosition}`),D.polygon.isValid()?this.fire(Ii.CREATE,{features:[D.polygon.toGeoJSON()]}):(this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Qt.SIMPLE_SELECT,{},{silent:!0})))},bs.toDisplayFeatures=function(D,W,Ge){const Ye=W.properties.id===D.polygon.id;if(W.properties.active=Ye?ot.ACTIVE:ot.INACTIVE,!Ye)return Ge(W);if(W.geometry.coordinates.length===0)return;const Bt=W.geometry.coordinates[0].length;if(!(Bt<3)){if(W.properties.meta=We.FEATURE,Ge(Ce(D.polygon.id,W.geometry.coordinates[0][0],"0.0",!1)),Bt>3){const Ei=W.geometry.coordinates[0].length-3;Ge(Ce(D.polygon.id,W.geometry.coordinates[0][Ei],`0.${Ei}`,!1))}if(Bt<=4){const Ei=[[W.geometry.coordinates[0][0][0],W.geometry.coordinates[0][0][1]],[W.geometry.coordinates[0][1][0],W.geometry.coordinates[0][1][1]]];if(Ge({type:ct.FEATURE,properties:W.properties,geometry:{coordinates:Ei,type:ct.LINE_STRING}}),Bt===3)return}return Ge(W)}},bs.onTrash=function(D){this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Qt.SIMPLE_SELECT)};var to=bs;const rs={};rs.onSetup=function(D){D=D||{};const W=D.featureId;let Ge,Ye,Bt="forward";if(W){if(Ge=this.getFeature(W),!Ge)throw new Error("Could not find a feature with the provided featureId");let Ei=D.from;if(Ei&&Ei.type==="Feature"&&Ei.geometry&&Ei.geometry.type==="Point"&&(Ei=Ei.geometry),Ei&&Ei.type==="Point"&&Ei.coordinates&&Ei.coordinates.length===2&&(Ei=Ei.coordinates),!Ei||!Array.isArray(Ei))throw new Error("Please use the `from` property to indicate which point to continue the line from");const Pn=Ge.coordinates.length-1;if(Ge.coordinates[Pn][0]===Ei[0]&&Ge.coordinates[Pn][1]===Ei[1])Ye=Pn+1,Ge.addCoordinate(Ye,...Ge.coordinates[Pn]);else if(Ge.coordinates[0][0]===Ei[0]&&Ge.coordinates[0][1]===Ei[1])Bt="backwards",Ye=0,Ge.addCoordinate(Ye,...Ge.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else Ge=this.newFeature({type:ct.FEATURE,properties:{},geometry:{type:ct.LINE_STRING,coordinates:[]}}),Ye=0,this.addFeature(Ge);return this.clearSelectedFeatures(),fe.disable(this),this.updateUIClasses({mouse:et.ADD}),this.activateUIButton(yi.LINE),this.setActionableState({trash:!0}),{line:Ge,currentVertexPosition:Ye,direction:Bt}},rs.clickAnywhere=function(D,W){if(D.currentVertexPosition>0&&xo(W,D.line.coordinates[D.currentVertexPosition-1])||D.direction==="backwards"&&xo(W,D.line.coordinates[D.currentVertexPosition+1]))return this.changeMode(Qt.SIMPLE_SELECT,{featureIds:[D.line.id]});this.updateUIClasses({mouse:et.ADD}),D.line.updateCoordinate(D.currentVertexPosition,W.lngLat.lng,W.lngLat.lat),D.direction==="forward"?(D.currentVertexPosition++,D.line.updateCoordinate(D.currentVertexPosition,W.lngLat.lng,W.lngLat.lat)):D.line.addCoordinate(0,W.lngLat.lng,W.lngLat.lat)},rs.clickOnVertex=function(D){return this.changeMode(Qt.SIMPLE_SELECT,{featureIds:[D.line.id]})},rs.onMouseMove=function(D,W){D.line.updateCoordinate(D.currentVertexPosition,W.lngLat.lng,W.lngLat.lat),qr(W)&&this.updateUIClasses({mouse:et.POINTER})},rs.onTap=rs.onClick=function(D,W){if(qr(W))return this.clickOnVertex(D,W);this.clickAnywhere(D,W)},rs.onKeyUp=function(D,W){q(W)?this.changeMode(Qt.SIMPLE_SELECT,{featureIds:[D.line.id]}):gt(W)&&(this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Qt.SIMPLE_SELECT))},rs.onStop=function(D){fe.enable(this),this.activateUIButton(),this.getFeature(D.line.id)!==void 0&&(D.line.removeCoordinate(`${D.currentVertexPosition}`),D.line.isValid()?this.fire(Ii.CREATE,{features:[D.line.toGeoJSON()]}):(this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Qt.SIMPLE_SELECT,{},{silent:!0})))},rs.onTrash=function(D){this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Qt.SIMPLE_SELECT)},rs.toDisplayFeatures=function(D,W,Ge){const Ye=W.properties.id===D.line.id;if(W.properties.active=Ye?ot.ACTIVE:ot.INACTIVE,!Ye)return Ge(W);W.geometry.coordinates.length<2||(W.properties.meta=We.FEATURE,Ge(Ce(D.line.id,W.geometry.coordinates[D.direction==="forward"?W.geometry.coordinates.length-2:1],`${D.direction==="forward"?W.geometry.coordinates.length-2:1}`,!1)),Ge(W))};var ws=rs,Qr={simple_select:Tn,direct_select:Hr,draw_point:zs,draw_polygon:to,draw_line_string:ws};const Ho={defaultMode:Qt.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Zt,modes:Qr,controls:{},userProperties:!1,suppressAPIEvents:!0},io={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ao={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Po(D,W){return D.map(Ge=>Ge.source?Ge:Object.assign({},Ge,{id:`${Ge.id}.${W}`,source:W==="hot"?$t.HOT:$t.COLD}))}function Zo(D={}){let W=Object.assign({},D);return D.controls||(W.controls={}),D.displayControlsDefault===!1?W.controls=Object.assign({},ao,D.controls):W.controls=Object.assign({},io,D.controls),W=Object.assign({},Ho,W),W.styles=Po(W.styles,"cold").concat(Po(W.styles,"hot")),W}var bo=Tt(3341),Oo=Tt(74444);function wo(D,W){return D.length!==W.length?!1:JSON.stringify(D.map(Ge=>Ge).sort())===JSON.stringify(W.map(Ge=>Ge).sort())}const ma={Polygon:Jr,LineString:Rs,Point:Hs,MultiPolygon:xs,MultiLineString:xs,MultiPoint:xs};function Yo(D,W){W.modes=Qt;const Ge=D.options.suppressAPIEvents!==void 0?!!D.options.suppressAPIEvents:!0;return W.getFeatureIdsAt=function(Ye){return at.click({point:Ye},null,D).map(Ei=>Ei.properties.id)},W.getSelectedIds=function(){return D.store.getSelectedIds()},W.getSelected=function(){return{type:ct.FEATURE_COLLECTION,features:D.store.getSelectedIds().map(Ye=>D.store.get(Ye)).map(Ye=>Ye.toGeoJSON())}},W.getSelectedPoints=function(){return{type:ct.FEATURE_COLLECTION,features:D.store.getSelectedCoordinates().map(Ye=>({type:ct.FEATURE,properties:{},geometry:{type:ct.POINT,coordinates:Ye.coordinates}}))}},W.set=function(Ye){if(Ye.type===void 0||Ye.type!==ct.FEATURE_COLLECTION||!Array.isArray(Ye.features))throw new Error("Invalid FeatureCollection");const Bt=D.store.createRenderBatch();let Ei=D.store.getAllIds().slice();const Pn=W.add(Ye),yn=new rn(Pn);return Ei=Ei.filter(pr=>!yn.has(pr)),Ei.length&&W.delete(Ei),Bt(),Pn},W.add=function(Ye){const Ei=JSON.parse(JSON.stringify(Oo(Ye))).features.map(Pn=>{if(Pn.id=Pn.id||Xs(),Pn.geometry===null)throw new Error("Invalid geometry: null");if(D.store.get(Pn.id)===void 0||D.store.get(Pn.id).type!==Pn.geometry.type){const yn=ma[Pn.geometry.type];if(yn===void 0)throw new Error(`Invalid geometry type: ${Pn.geometry.type}.`);const pr=new yn(D,Pn);D.store.add(pr,{silent:Ge})}else{const yn=D.store.get(Pn.id),pr=yn.properties;yn.properties=Pn.properties,bo(pr,Pn.properties)||D.store.featureChanged(yn.id,{silent:Ge}),bo(yn.getCoordinates(),Pn.geometry.coordinates)||yn.incomingCoords(Pn.geometry.coordinates)}return Pn.id});return D.store.render(),Ei},W.get=function(Ye){const Bt=D.store.get(Ye);if(Bt)return Bt.toGeoJSON()},W.getAll=function(){return{type:ct.FEATURE_COLLECTION,features:D.store.getAll().map(Ye=>Ye.toGeoJSON())}},W.delete=function(Ye){return D.store.delete(Ye,{silent:Ge}),W.getMode()===Qt.DIRECT_SELECT&&!D.store.getSelectedIds().length?D.events.changeMode(Qt.SIMPLE_SELECT,void 0,{silent:Ge}):D.store.render(),W},W.deleteAll=function(){return D.store.delete(D.store.getAllIds(),{silent:Ge}),W.getMode()===Qt.DIRECT_SELECT?D.events.changeMode(Qt.SIMPLE_SELECT,void 0,{silent:Ge}):D.store.render(),W},W.changeMode=function(Ye,Bt={}){return Ye===Qt.SIMPLE_SELECT&&W.getMode()===Qt.SIMPLE_SELECT?(wo(Bt.featureIds||[],D.store.getSelectedIds())||(D.store.setSelected(Bt.featureIds,{silent:Ge}),D.store.render()),W):(Ye===Qt.DIRECT_SELECT&&W.getMode()===Qt.DIRECT_SELECT&&Bt.featureId===D.store.getSelectedIds()[0]||D.events.changeMode(Ye,Bt,{silent:Ge}),W)},W.getMode=function(){return D.events.getMode()},W.trash=function(){return D.events.trash({silent:Ge}),W},W.combineFeatures=function(){return D.events.combineFeatures({silent:Ge}),W},W.uncombineFeatures=function(){return D.events.uncombineFeatures({silent:Ge}),W},W.setFeatureProperty=function(Ye,Bt,Ei){return D.store.setFeatureProperty(Ye,Bt,Ei,{silent:Ge}),W},W}const sa=function(D,W){D=Zo(D);const Ge={options:D};W=Yo(Ge,W),Ge.api=W;const Ye=ke(Ge);return W.onAdd=Ye.onAdd,W.onRemove=Ye.onRemove,W.types=yi,W.options=D,W};function la(D){sa(D,this)}la.modes=Qr,la.constants=xe,la.lib=hn;var Is=la},23139:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{$:function(){return et}});var xe=Tt(61764),Pi=Tt(55230);function hn(ct,Qt,Ii={}){if(Ii.final===!0)return s(ct,Qt);const Yi=(0,Pi.c9)(ct),We=(0,Pi.c9)(Qt),ot=(0,xe.Ht)(Yi[0]),dt=(0,xe.Ht)(We[0]),vt=(0,xe.Ht)(Yi[1]),Be=(0,xe.Ht)(We[1]),Ie=Math.sin(dt-ot)*Math.cos(Be),Ue=Math.cos(vt)*Math.sin(Be)-Math.sin(vt)*Math.cos(Be)*Math.cos(dt-ot);return(0,xe.vi)(Math.atan2(Ie,Ue))}function s(ct,Qt){let Ii=hn(Qt,ct);return Ii=(Ii+180)%360,Ii}var xn=null;function tn(ct,Qt,Ii,Yi={}){const We=(0,Pi.c9)(ct),ot=(0,xe.Ht)(We[0]),dt=(0,xe.Ht)(We[1]),vt=(0,xe.Ht)(Ii),Be=(0,xe.lF)(Qt,Yi.units),Ie=Math.asin(Math.sin(dt)*Math.cos(Be)+Math.cos(dt)*Math.sin(Be)*Math.cos(vt)),Ue=ot+Math.atan2(Math.sin(vt)*Math.sin(Be)*Math.cos(dt),Math.cos(Be)-Math.sin(dt)*Math.sin(Ie)),qe=(0,xe.vi)(Ue),De=(0,xe.vi)(Ie);return(0,xe.xm)([qe,De],Yi.properties)}var ti=null,$t=Tt(17269);function et(ct,Qt,Ii={}){const We=(0,Pi.wA)(ct).coordinates;let ot=0;for(let dt=0;dt<We.length&&!(Qt>=ot&&dt===We.length-1);dt++)if(ot>=Qt){const vt=Qt-ot;if(vt){const Be=hn(We[dt],We[dt-1])-180;return tn(We[dt],vt,Be,Ii)}else return(0,xe.xm)(We[dt])}else ot+=(0,$t.T)(We[dt],We[dt+1],Ii);return(0,xe.xm)(We[We.length-1])}var yi=null},26659:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{S:function(){return hn}});var xe=Tt(61764),Pi=Tt(59738);function hn(yi){return(0,Pi.mm)(yi,(ct,Qt)=>ct+s(Qt),0)}function s(yi){let ct=0,Qt;switch(yi.type){case"Polygon":return xn(yi.coordinates);case"MultiPolygon":for(Qt=0;Qt<yi.coordinates.length;Qt++)ct+=xn(yi.coordinates[Qt]);return ct;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function xn(yi){let ct=0;if(yi&&yi.length>0){ct+=Math.abs($t(yi[0]));for(let Qt=1;Qt<yi.length;Qt++)ct-=Math.abs($t(yi[Qt]))}return ct}var tn=xe.rQ*xe.rQ/2,ti=Math.PI/180;function $t(yi){const ct=yi.length-1;if(ct<=2)return 0;let Qt=0,Ii=0;for(;Ii<ct;){const Yi=yi[Ii],We=yi[Ii+1===ct?0:Ii+1],ot=yi[Ii+2>=ct?(Ii+2)%ct:Ii+2],dt=Yi[0]*ti,vt=We[1]*ti,Be=ot[0]*ti;Qt+=(Be-dt)*Math.sin(vt),Ii++}return Qt*tn}var et=null},37615:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{b:function(){return Pi}});var xe=Tt(61764);function Pi(s,xn={}){const tn=Number(s[0]),ti=Number(s[1]),$t=Number(s[2]),et=Number(s[3]);if(s.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const yi=[tn,ti],ct=[tn,et],Qt=[$t,et],Ii=[$t,ti];return(0,xe.yu)([[yi,Ii,Qt,ct,yi]],xn.properties,{bbox:s,id:xn.id})}var hn=null},5073:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{V:function(){return Pi}});var xe=Tt(59738);function Pi(s,xn={}){if(s.bbox!=null&&xn.recompute!==!0)return s.bbox;const tn=[1/0,1/0,-1/0,-1/0];return(0,xe.pZ)(s,ti=>{tn[0]>ti[0]&&(tn[0]=ti[0]),tn[1]>ti[1]&&(tn[1]=ti[1]),tn[2]<ti[0]&&(tn[2]=ti[0]),tn[3]<ti[1]&&(tn[3]=ti[1])}),tn}var hn=null},29623:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{$Z:function(){return xn}});var xe=Tt(5073),Pi=Tt(87123),hn=Tt(45149),s=Tt(55230);function xn(vt,Be){const Ie=(0,s.wA)(vt),Ue=(0,s.wA)(Be),qe=Ie.type,De=Ue.type,je=Ie.coordinates,Pt=Ue.coordinates;switch(qe){case"Point":switch(De){case"Point":return We(je,Pt);default:throw new Error("feature2 "+De+" geometry not supported")}case"MultiPoint":switch(De){case"Point":return ti(Ie,Ue);case"MultiPoint":return $t(Ie,Ue);default:throw new Error("feature2 "+De+" geometry not supported")}case"LineString":switch(De){case"Point":return(0,hn.D)(Ue,Ie,{ignoreEndVertices:!0});case"LineString":return ct(Ie,Ue);case"MultiPoint":return et(Ie,Ue);default:throw new Error("feature2 "+De+" geometry not supported")}case"Polygon":switch(De){case"Point":return(0,Pi.F)(Ue,Ie,{ignoreBoundary:!0});case"LineString":return Qt(Ie,Ue);case"Polygon":return Ii(Ie,Ue);case"MultiPoint":return yi(Ie,Ue);default:throw new Error("feature2 "+De+" geometry not supported")}case"MultiPolygon":switch(De){case"Polygon":return tn(Ie,Ue);default:throw new Error("feature2 "+De+" geometry not supported")}default:throw new Error("feature1 "+qe+" geometry not supported")}}function tn(vt,Be){return vt.coordinates.some(Ie=>Ii({type:"Polygon",coordinates:Ie},Be))}function ti(vt,Be){let Ie,Ue=!1;for(Ie=0;Ie<vt.coordinates.length;Ie++)if(We(vt.coordinates[Ie],Be.coordinates)){Ue=!0;break}return Ue}function $t(vt,Be){for(const Ie of Be.coordinates){let Ue=!1;for(const qe of vt.coordinates)if(We(Ie,qe)){Ue=!0;break}if(!Ue)return!1}return!0}function et(vt,Be){let Ie=!1;for(const Ue of Be.coordinates)if((0,hn.D)(Ue,vt,{ignoreEndVertices:!0})&&(Ie=!0),!(0,hn.D)(Ue,vt))return!1;return!!Ie}function yi(vt,Be){for(const Ie of Be.coordinates)if(!(0,Pi.F)(Ie,vt,{ignoreBoundary:!0}))return!1;return!0}function ct(vt,Be){let Ie=!1;for(const Ue of Be.coordinates)if((0,hn.D)({type:"Point",coordinates:Ue},vt,{ignoreEndVertices:!0})&&(Ie=!0),!(0,hn.D)({type:"Point",coordinates:Ue},vt,{ignoreEndVertices:!1}))return!1;return Ie}function Qt(vt,Be){let Ie=!1,Ue=0;const qe=(0,xe.V)(vt),De=(0,xe.V)(Be);if(!Yi(qe,De))return!1;for(Ue;Ue<Be.coordinates.length-1;Ue++){const je=ot(Be.coordinates[Ue],Be.coordinates[Ue+1]);if((0,Pi.F)({type:"Point",coordinates:je},vt,{ignoreBoundary:!0})){Ie=!0;break}}return Ie}function Ii(vt,Be){if(vt.type==="Feature"&&vt.geometry===null||Be.type==="Feature"&&Be.geometry===null)return!1;const Ie=(0,xe.V)(vt),Ue=(0,xe.V)(Be);if(!Yi(Ie,Ue))return!1;const qe=(0,s.wA)(Be).coordinates;for(const De of qe)for(const je of De)if(!(0,Pi.F)(je,vt))return!1;return!0}function Yi(vt,Be){return!(vt[0]>Be[0]||vt[2]<Be[2]||vt[1]>Be[1]||vt[3]<Be[3])}function We(vt,Be){return vt[0]===Be[0]&&vt[1]===Be[1]}function ot(vt,Be){return[(vt[0]+Be[0])/2,(vt[1]+Be[1])/2]}var dt=null},55644:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{H:function(){return Ie}});var xe=Tt(87123),Pi=Tt(98562),hn=Tt(59738),s=Tt(61764),xn=Tt(55230);function tn(qe,De={}){const je=(0,xn.wA)(qe);switch(!De.properties&&qe.type==="Feature"&&(De.properties=qe.properties),je.type){case"Polygon":return ti(je,De);case"MultiPolygon":return $t(je,De);default:throw new Error("invalid poly")}}function ti(qe,De={}){const Pt=(0,xn.wA)(qe).coordinates,ki=De.properties?De.properties:qe.type==="Feature"?qe.properties:{};return et(Pt,ki)}function $t(qe,De={}){const Pt=(0,xn.wA)(qe).coordinates,ki=De.properties?De.properties:qe.type==="Feature"?qe.properties:{},bi=[];return Pt.forEach(ji=>{bi.push(et(ji,ki))}),(0,s.uf)(bi)}function et(qe,De){return qe.length>1?(0,s._R)(qe,De):(0,s.Tu)(qe[0],De)}var yi=null;function ct(qe,De,{ignoreSelfIntersections:je=!0}={ignoreSelfIntersections:!0}){let Pt=!0;return(0,hn.nG)(qe,ki=>{(0,hn.nG)(De,bi=>{if(Pt===!1)return!1;Pt=Qt(ki.geometry,bi.geometry,je)})}),Pt}function Qt(qe,De,je){switch(qe.type){case"Point":switch(De.type){case"Point":return!vt(qe.coordinates,De.coordinates);case"LineString":return!Ii(De,qe);case"Polygon":return!(0,xe.F)(qe,De)}break;case"LineString":switch(De.type){case"Point":return!Ii(qe,De);case"LineString":return!Yi(qe,De,je);case"Polygon":return!We(De,qe,je)}break;case"Polygon":switch(De.type){case"Point":return!(0,xe.F)(De,qe);case"LineString":return!We(qe,De,je);case"Polygon":return!ot(De,qe,je)}}return!1}function Ii(qe,De){for(let je=0;je<qe.coordinates.length-1;je++)if(dt(qe.coordinates[je],qe.coordinates[je+1],De.coordinates))return!0;return!1}function Yi(qe,De,je){return(0,Pi.H)(qe,De,{ignoreSelfIntersections:je}).features.length>0}function We(qe,De,je){for(const ki of De.coordinates)if((0,xe.F)(ki,qe))return!0;return(0,Pi.H)(De,tn(qe),{ignoreSelfIntersections:je}).features.length>0}function ot(qe,De,je){for(const ki of qe.coordinates[0])if((0,xe.F)(ki,De))return!0;for(const ki of De.coordinates[0])if((0,xe.F)(ki,qe))return!0;return(0,Pi.H)(tn(qe),tn(De),{ignoreSelfIntersections:je}).features.length>0}function dt(qe,De,je){const Pt=je[0]-qe[0],ki=je[1]-qe[1],bi=De[0]-qe[0],ji=De[1]-qe[1];return Pt*ji-ki*bi!==0?!1:Math.abs(bi)>=Math.abs(ji)?bi>0?qe[0]<=je[0]&&je[0]<=De[0]:De[0]<=je[0]&&je[0]<=qe[0]:ji>0?qe[1]<=je[1]&&je[1]<=De[1]:De[1]<=je[1]&&je[1]<=qe[1]}function vt(qe,De){return qe[0]===De[0]&&qe[1]===De[1]}var Be=null;function Ie(qe,De,{ignoreSelfIntersections:je=!0}={}){let Pt=!1;return(0,hn.nG)(qe,ki=>{(0,hn.nG)(De,bi=>{if(Pt===!0)return!0;Pt=!ct(ki.geometry,bi.geometry,{ignoreSelfIntersections:je})})}),Pt}var Ue=null},99835:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{l:function(){return Xn}});var xe=Tt(59738),Pi=Tt(55230),hn=Tt(79204),s=Tt(61764),xn=Tt(5073);function tn(Ot){var at=new hn(Ot);return at.insert=function(Ht){if(Ht.type!=="Feature")throw new Error("invalid feature");return Ht.bbox=Ht.bbox?Ht.bbox:(0,xn.V)(Ht),hn.prototype.insert.call(this,Ht)},at.load=function(Ht){var Qi=[];return Array.isArray(Ht)?Ht.forEach(function(vi){if(vi.type!=="Feature")throw new Error("invalid features");vi.bbox=vi.bbox?vi.bbox:(0,xn.V)(vi),Qi.push(vi)}):(0,xe.By)(Ht,function(vi){if(vi.type!=="Feature")throw new Error("invalid features");vi.bbox=vi.bbox?vi.bbox:(0,xn.V)(vi),Qi.push(vi)}),hn.prototype.load.call(this,Qi)},at.remove=function(Ht,Qi){if(Ht.type!=="Feature")throw new Error("invalid feature");return Ht.bbox=Ht.bbox?Ht.bbox:(0,xn.V)(Ht),hn.prototype.remove.call(this,Ht,Qi)},at.clear=function(){return hn.prototype.clear.call(this)},at.search=function(Ht){var Qi=hn.prototype.search.call(this,this.toBBox(Ht));return(0,s.uf)(Qi)},at.collides=function(Ht){return hn.prototype.collides.call(this,this.toBBox(Ht))},at.all=function(){var Ht=hn.prototype.all.call(this);return(0,s.uf)(Ht)},at.toJSON=function(){return hn.prototype.toJSON.call(this)},at.fromJSON=function(Ht){return hn.prototype.fromJSON.call(this,Ht)},at.toBBox=function(Ht){var Qi;if(Ht.bbox)Qi=Ht.bbox;else if(Array.isArray(Ht)&&Ht.length===4)Qi=Ht;else if(Array.isArray(Ht)&&Ht.length===6)Qi=[Ht[0],Ht[1],Ht[3],Ht[4]];else if(Ht.type==="Feature")Qi=(0,xn.V)(Ht);else if(Ht.type==="FeatureCollection")Qi=(0,xn.V)(Ht);else throw new Error("invalid geojson");return{minX:Qi[0],minY:Qi[1],maxX:Qi[2],maxY:Qi[3]}},at}var ti=null;function $t(Ot){if(!Ot)throw new Error("geojson is required");const at=[];return(0,xe.nG)(Ot,Ht=>{et(Ht,at)}),(0,s.uf)(at)}function et(Ot,at){let Ht=[];const Qi=Ot.geometry;if(Qi!==null){switch(Qi.type){case"Polygon":Ht=(0,Pi.r7)(Qi);break;case"LineString":Ht=[(0,Pi.r7)(Qi)]}Ht.forEach(vi=>{yi(vi,Ot.properties).forEach(gr=>{gr.id=at.length,at.push(gr)})})}}function yi(Ot,at){const Ht=[];return Ot.reduce((Qi,vi)=>{const Mn=(0,s.Tu)([Qi,vi],at);return Mn.bbox=ct(Qi,vi),Ht.push(Mn),vi}),Ht}function ct(Ot,at){const Ht=Ot[0],Qi=Ot[1],vi=at[0],Mn=at[1],gr=Ht<vi?Ht:vi,Hn=Qi<Mn?Qi:Mn,kr=Ht>vi?Ht:vi,Dt=Qi>Mn?Qi:Mn;return[gr,Hn,kr,Dt]}var Qt=null,Ii=Tt(72735),Yi=Tt(45149),We=Tt(3341);function ot(Ot,at,Ht={}){if(Ht=Ht||{},!(0,s.Kn)(Ht))throw new Error("options is invalid");var Qi=Ht.tolerance||0,vi=[],Mn=tn();const gr=$t(Ot);Mn.load(gr);var Hn;let kr=[];return(0,xe.Vf)(at,function(Dt){var Ls=!1;Dt&&((0,xe.By)(Mn.search(Dt),function(Pe){if(Ls===!1){var $n=(0,Pi.r7)(Dt).sort(),lt=(0,Pi.r7)(Pe).sort();if(We($n,lt))Ls=!0,Hn?Hn=dt(Hn,Dt)||Hn:Hn=Dt;else if(Qi===0?(0,Yi.D)($n[0],Pe)&&(0,Yi.D)($n[1],Pe):(0,Ii.J)(Pe,$n[0]).properties.dist<=Qi&&(0,Ii.J)(Pe,$n[1]).properties.dist<=Qi)Ls=!0,Hn?Hn=dt(Hn,Dt)||Hn:Hn=Dt;else if(Qi===0?(0,Yi.D)(lt[0],Dt)&&(0,Yi.D)(lt[1],Dt):(0,Ii.J)(Dt,lt[0]).properties.dist<=Qi&&(0,Ii.J)(Dt,lt[1]).properties.dist<=Qi)if(Hn){const cs=dt(Hn,Pe);cs?Hn=cs:kr.push(Pe)}else Hn=Pe}}),Ls===!1&&Hn&&(vi.push(Hn),kr.length&&(vi=vi.concat(kr),kr=[]),Hn=void 0))}),Hn&&vi.push(Hn),(0,s.uf)(vi)}function dt(Ot,at){var Ht=(0,Pi.r7)(at),Qi=(0,Pi.r7)(Ot),vi=Qi[0],Mn=Qi[Qi.length-1],gr=Ot.geometry.coordinates;if(We(Ht[0],vi))gr.unshift(Ht[1]);else if(We(Ht[0],Mn))gr.push(Ht[1]);else if(We(Ht[1],vi))gr.unshift(Ht[0]);else if(We(Ht[1],Mn))gr.push(Ht[0]);else return;return Ot}var vt=null,Be=Tt(98562),Ie=Object.defineProperty,Ue=(Ot,at)=>Ie(Ot,"name",{value:at,configurable:!0}),qe=class{constructor(at){this.direction=!1,this.compareProperties=!0;var Ht,Qi,vi;this.precision=lh(10,-((Ht=at==null?void 0:at.precision)!=null?Ht:17)),this.direction=(Qi=at==null?void 0:at.direction)!=null?Qi:!1,this.compareProperties=(vi=at==null?void 0:at.compareProperties)!=null?vi:!0}compare(at,Ht){if(at.type!==Ht.type||!je(at,Ht))return!1;switch(at.type){case"Point":return this.compareCoord(at.coordinates,Ht.coordinates);case"LineString":return this.compareLine(at.coordinates,Ht.coordinates);case"Polygon":return this.comparePolygon(at,Ht);case"GeometryCollection":return this.compareGeometryCollection(at,Ht);case"Feature":return this.compareFeature(at,Ht);case"FeatureCollection":return this.compareFeatureCollection(at,Ht);default:if(at.type.startsWith("Multi")){const Qi=Pt(at),vi=Pt(Ht);return Qi.every(Mn=>vi.some(gr=>this.compare(Mn,gr)))}}return!1}compareCoord(at,Ht){return at.length===Ht.length&&at.every((Qi,vi)=>Math.abs(Qi-Ht[vi])<this.precision)}compareLine(at,Ht,Qi=0,vi=!1){if(!je(at,Ht))return!1;const Mn=at;let gr=Ht;if(vi&&!this.compareCoord(Mn[0],gr[0])){const kr=this.fixStartIndex(gr,Mn);if(kr)gr=kr;else return!1}const Hn=this.compareCoord(Mn[Qi],gr[Qi]);return this.direction||Hn?this.comparePath(Mn,gr):this.compareCoord(Mn[Qi],gr[gr.length-(1+Qi)])?this.comparePath(Mn.slice().reverse(),gr):!1}fixStartIndex(at,Ht){let Qi,vi=-1;for(let Mn=0;Mn<at.length;Mn++)if(this.compareCoord(at[Mn],Ht[0])){vi=Mn;break}return vi>=0&&(Qi=[].concat(at.slice(vi,at.length),at.slice(1,vi+1))),Qi}comparePath(at,Ht){return at.every((Qi,vi)=>this.compareCoord(Qi,Ht[vi]))}comparePolygon(at,Ht){if(this.compareLine(at.coordinates[0],Ht.coordinates[0],1,!0)){const Qi=at.coordinates.slice(1,at.coordinates.length),vi=Ht.coordinates.slice(1,Ht.coordinates.length);return Qi.every(Mn=>vi.some(gr=>this.compareLine(Mn,gr,1,!0)))}return!1}compareGeometryCollection(at,Ht){return je(at.geometries,Ht.geometries)&&this.compareBBox(at,Ht)&&at.geometries.every((Qi,vi)=>this.compare(Qi,Ht.geometries[vi]))}compareFeature(at,Ht){return at.id===Ht.id&&(this.compareProperties?bi(at.properties,Ht.properties):!0)&&this.compareBBox(at,Ht)&&this.compare(at.geometry,Ht.geometry)}compareFeatureCollection(at,Ht){return je(at.features,Ht.features)&&this.compareBBox(at,Ht)&&at.features.every((Qi,vi)=>this.compare(Qi,Ht.features[vi]))}compareBBox(at,Ht){return!at.bbox&&!Ht.bbox||(at.bbox&&Ht.bbox?this.compareCoord(at.bbox,Ht.bbox):!1)}};Ue(qe,"GeojsonEquality");var De=qe;function je(Ot,at){return Ot.coordinates?Ot.coordinates.length===at.coordinates.length:Ot.length===at.length}Ue(je,"sameLength");function Pt(Ot){return Ot.coordinates.map(at=>({type:Ot.type.replace("Multi",""),coordinates:at}))}Ue(Pt,"explode");function ki(Ot,at,Ht){return new De(Ht).compare(Ot,at)}Ue(ki,"geojsonEquality");function bi(Ot,at){if(Ot===null&&at===null)return!0;if(Ot===null||at===null)return!1;const Ht=Object.keys(Ot),Qi=Object.keys(at);if(Ht.length!==Qi.length)return!1;for(var vi of Ht){const Mn=Ot[vi],gr=at[vi],Hn=ji(Mn)&&ji(gr);if(Hn&&!bi(Mn,gr)||!Hn&&Mn!==gr)return!1}return!0}Ue(bi,"equal");var ji=Ue(Ot=>Ot!=null&&typeof Ot=="object","isObject"),hr=null;function Xn(Ot,at){const Ht=(0,Pi.wA)(Ot),Qi=(0,Pi.wA)(at),vi=Ht.type,Mn=Qi.type;if(vi==="MultiPoint"&&Mn!=="MultiPoint"||(vi==="LineString"||vi==="MultiLineString")&&Mn!=="LineString"&&Mn!=="MultiLineString"||(vi==="Polygon"||vi==="MultiPolygon")&&Mn!=="Polygon"&&Mn!=="MultiPolygon")throw new Error("features must be of the same type");if(vi==="Point")throw new Error("Point geometry not supported");if(ki(Ot,at,{precision:6}))return!1;let gr=0;switch(vi){case"MultiPoint":for(var Hn=0;Hn<Ht.coordinates.length;Hn++)for(var kr=0;kr<Qi.coordinates.length;kr++){var Dt=Ht.coordinates[Hn],Ls=Qi.coordinates[kr];if(Dt[0]===Ls[0]&&Dt[1]===Ls[1])return!0}return!1;case"LineString":case"MultiLineString":(0,xe.Vf)(Ot,Pe=>{(0,xe.Vf)(at,$n=>{ot(Pe,$n).features.length&&gr++})});break;case"Polygon":case"MultiPolygon":(0,xe.Vf)(Ot,Pe=>{(0,xe.Vf)(at,$n=>{(0,Be.H)(Pe,$n).features.length&&gr++})});break}return gr>0}var rn=null},87123:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{F:function(){return yn}});const xe=11102230246251565e-32,Pi=134217729,hn=(3+8*xe)*xe;function s(ft,mi,nt,jt,Ti){let ni,wi,Mi,Li,pt=mi[0],St=jt[0],zt=0,At=0;St>pt==St>-pt?(ni=pt,pt=mi[++zt]):(ni=St,St=jt[++At]);let kt=0;if(zt<ft&&At<nt)for(St>pt==St>-pt?(wi=pt+ni,Mi=ni-(wi-pt),pt=mi[++zt]):(wi=St+ni,Mi=ni-(wi-St),St=jt[++At]),ni=wi,Mi!==0&&(Ti[kt++]=Mi);zt<ft&&At<nt;)St>pt==St>-pt?(wi=ni+pt,Li=wi-ni,Mi=ni-(wi-Li)+(pt-Li),pt=mi[++zt]):(wi=ni+St,Li=wi-ni,Mi=ni-(wi-Li)+(St-Li),St=jt[++At]),ni=wi,Mi!==0&&(Ti[kt++]=Mi);for(;zt<ft;)wi=ni+pt,Li=wi-ni,Mi=ni-(wi-Li)+(pt-Li),pt=mi[++zt],ni=wi,Mi!==0&&(Ti[kt++]=Mi);for(;At<nt;)wi=ni+St,Li=wi-ni,Mi=ni-(wi-Li)+(St-Li),St=jt[++At],ni=wi,Mi!==0&&(Ti[kt++]=Mi);return(ni!==0||kt===0)&&(Ti[kt++]=ni),kt}function xn(ft,mi,nt,jt,Ti,ni,wi,Mi){return s(s(ft,mi,nt,jt,wi),wi,Ti,ni,Mi)}function tn(ft,mi,nt,jt){let Ti,ni,wi,Mi,Li,pt,St,zt,At,kt,Ci;St=Pi*nt,kt=St-(St-nt),Ci=nt-kt;let Ke=mi[0];Ti=Ke*nt,St=Pi*Ke,zt=St-(St-Ke),At=Ke-zt,wi=At*Ci-(Ti-zt*kt-At*kt-zt*Ci);let It=0;wi!==0&&(jt[It++]=wi);for(let Nt=1;Nt<ft;Nt++)Ke=mi[Nt],Mi=Ke*nt,St=Pi*Ke,zt=St-(St-Ke),At=Ke-zt,Li=At*Ci-(Mi-zt*kt-At*kt-zt*Ci),ni=Ti+Li,pt=ni-Ti,wi=Ti-(ni-pt)+(Li-pt),wi!==0&&(jt[It++]=wi),Ti=Mi+ni,wi=ni-(Ti-Mi),wi!==0&&(jt[It++]=wi);return(Ti!==0||It===0)&&(jt[It++]=Ti),It}function ti(ft,mi){for(let nt=0;nt<ft;nt++)mi[nt]=-mi[nt];return ft}function $t(ft,mi){let nt=mi[0];for(let jt=1;jt<ft;jt++)nt+=mi[jt];return nt}function et(ft){return new Float64Array(ft)}const yi=(3+16*xe)*xe,ct=(2+12*xe)*xe,Qt=(9+64*xe)*xe*xe,Ii=et(4),Yi=et(8),We=et(12),ot=et(16),dt=et(4);function vt(ft,mi,nt,jt,Ti,ni,wi){let Mi,Li,pt,St,zt,At,kt,Ci,Ke,It,Nt,ci,oi,Ki,si,Di,li,Oi;const Hi=ft-Ti,Sn=nt-Ti,On=mi-ni,An=jt-ni;Ki=Hi*An,At=Pi*Hi,kt=At-(At-Hi),Ci=Hi-kt,At=Pi*An,Ke=At-(At-An),It=An-Ke,si=Ci*It-(Ki-kt*Ke-Ci*Ke-kt*It),Di=On*Sn,At=Pi*On,kt=At-(At-On),Ci=On-kt,At=Pi*Sn,Ke=At-(At-Sn),It=Sn-Ke,li=Ci*It-(Di-kt*Ke-Ci*Ke-kt*It),Nt=si-li,zt=si-Nt,Ii[0]=si-(Nt+zt)+(zt-li),ci=Ki+Nt,zt=ci-Ki,oi=Ki-(ci-zt)+(Nt-zt),Nt=oi-Di,zt=oi-Nt,Ii[1]=oi-(Nt+zt)+(zt-Di),Oi=ci+Nt,zt=Oi-ci,Ii[2]=ci-(Oi-zt)+(Nt-zt),Ii[3]=Oi;let fr=$t(4,Ii),mt=ct*wi;if(fr>=mt||-fr>=mt||(zt=ft-Hi,Mi=ft-(Hi+zt)+(zt-Ti),zt=nt-Sn,pt=nt-(Sn+zt)+(zt-Ti),zt=mi-On,Li=mi-(On+zt)+(zt-ni),zt=jt-An,St=jt-(An+zt)+(zt-ni),Mi===0&&Li===0&&pt===0&&St===0)||(mt=Qt*wi+hn*Math.abs(fr),fr+=Hi*St+An*Mi-(On*pt+Sn*Li),fr>=mt||-fr>=mt))return fr;Ki=Mi*An,At=Pi*Mi,kt=At-(At-Mi),Ci=Mi-kt,At=Pi*An,Ke=At-(At-An),It=An-Ke,si=Ci*It-(Ki-kt*Ke-Ci*Ke-kt*It),Di=Li*Sn,At=Pi*Li,kt=At-(At-Li),Ci=Li-kt,At=Pi*Sn,Ke=At-(At-Sn),It=Sn-Ke,li=Ci*It-(Di-kt*Ke-Ci*Ke-kt*It),Nt=si-li,zt=si-Nt,dt[0]=si-(Nt+zt)+(zt-li),ci=Ki+Nt,zt=ci-Ki,oi=Ki-(ci-zt)+(Nt-zt),Nt=oi-Di,zt=oi-Nt,dt[1]=oi-(Nt+zt)+(zt-Di),Oi=ci+Nt,zt=Oi-ci,dt[2]=ci-(Oi-zt)+(Nt-zt),dt[3]=Oi;const Wt=s(4,Ii,4,dt,Yi);Ki=Hi*St,At=Pi*Hi,kt=At-(At-Hi),Ci=Hi-kt,At=Pi*St,Ke=At-(At-St),It=St-Ke,si=Ci*It-(Ki-kt*Ke-Ci*Ke-kt*It),Di=On*pt,At=Pi*On,kt=At-(At-On),Ci=On-kt,At=Pi*pt,Ke=At-(At-pt),It=pt-Ke,li=Ci*It-(Di-kt*Ke-Ci*Ke-kt*It),Nt=si-li,zt=si-Nt,dt[0]=si-(Nt+zt)+(zt-li),ci=Ki+Nt,zt=ci-Ki,oi=Ki-(ci-zt)+(Nt-zt),Nt=oi-Di,zt=oi-Nt,dt[1]=oi-(Nt+zt)+(zt-Di),Oi=ci+Nt,zt=Oi-ci,dt[2]=ci-(Oi-zt)+(Nt-zt),dt[3]=Oi;const hi=s(Wt,Yi,4,dt,We);Ki=Mi*St,At=Pi*Mi,kt=At-(At-Mi),Ci=Mi-kt,At=Pi*St,Ke=At-(At-St),It=St-Ke,si=Ci*It-(Ki-kt*Ke-Ci*Ke-kt*It),Di=Li*pt,At=Pi*Li,kt=At-(At-Li),Ci=Li-kt,At=Pi*pt,Ke=At-(At-pt),It=pt-Ke,li=Ci*It-(Di-kt*Ke-Ci*Ke-kt*It),Nt=si-li,zt=si-Nt,dt[0]=si-(Nt+zt)+(zt-li),ci=Ki+Nt,zt=ci-Ki,oi=Ki-(ci-zt)+(Nt-zt),Nt=oi-Di,zt=oi-Nt,dt[1]=oi-(Nt+zt)+(zt-Di),Oi=ci+Nt,zt=Oi-ci,dt[2]=ci-(Oi-zt)+(Nt-zt),dt[3]=Oi;const ln=s(hi,We,4,dt,ot);return ot[ln-1]}function Be(ft,mi,nt,jt,Ti,ni){const wi=(mi-ni)*(nt-Ti),Mi=(ft-Ti)*(jt-ni),Li=wi-Mi,pt=Math.abs(wi+Mi);return Math.abs(Li)>=yi*pt?Li:-vt(ft,mi,nt,jt,Ti,ni,pt)}function Ie(ft,mi,nt,jt,Ti,ni){return(mi-ni)*(nt-Ti)-(ft-Ti)*(jt-ni)}const Ue=(7+56*xe)*xe,qe=(3+28*xe)*xe,De=(26+288*xe)*xe*xe,je=et(4),Pt=et(4),ki=et(4),bi=et(4),ji=et(4),hr=et(4),Xn=et(4),rn=et(4),Ot=et(4),at=et(8),Ht=et(8),Qi=et(8),vi=et(4),Mn=et(8),gr=et(8),Hn=et(8),kr=et(12);let Dt=et(192),Ls=et(192);function Pe(ft,mi,nt){ft=sum(ft,Dt,mi,nt,Ls);const jt=Dt;return Dt=Ls,Ls=jt,ft}function $n(ft,mi,nt,jt,Ti,ni,wi,Mi){let Li,pt,St,zt,At,kt,Ci,Ke,It,Nt,ci,oi,Ki,si,Di,li;return ft===0?mi===0?(wi[0]=0,Mi[0]=0,1):(li=-mi,ci=li*nt,pt=splitter*li,St=pt-(pt-li),zt=li-St,pt=splitter*nt,At=pt-(pt-nt),kt=nt-At,wi[0]=zt*kt-(ci-St*At-zt*At-St*kt),wi[1]=ci,ci=mi*Ti,pt=splitter*mi,St=pt-(pt-mi),zt=mi-St,pt=splitter*Ti,At=pt-(pt-Ti),kt=Ti-At,Mi[0]=zt*kt-(ci-St*At-zt*At-St*kt),Mi[1]=ci,2):mi===0?(ci=ft*jt,pt=splitter*ft,St=pt-(pt-ft),zt=ft-St,pt=splitter*jt,At=pt-(pt-jt),kt=jt-At,wi[0]=zt*kt-(ci-St*At-zt*At-St*kt),wi[1]=ci,li=-ft,ci=li*ni,pt=splitter*li,St=pt-(pt-li),zt=li-St,pt=splitter*ni,At=pt-(pt-ni),kt=ni-At,Mi[0]=zt*kt-(ci-St*At-zt*At-St*kt),Mi[1]=ci,2):(ci=ft*jt,pt=splitter*ft,St=pt-(pt-ft),zt=ft-St,pt=splitter*jt,At=pt-(pt-jt),kt=jt-At,oi=zt*kt-(ci-St*At-zt*At-St*kt),Ki=mi*nt,pt=splitter*mi,St=pt-(pt-mi),zt=mi-St,pt=splitter*nt,At=pt-(pt-nt),kt=nt-At,si=zt*kt-(Ki-St*At-zt*At-St*kt),Ci=oi-si,Li=oi-Ci,wi[0]=oi-(Ci+Li)+(Li-si),Ke=ci+Ci,Li=Ke-ci,Nt=ci-(Ke-Li)+(Ci-Li),Ci=Nt-Ki,Li=Nt-Ci,wi[1]=Nt-(Ci+Li)+(Li-Ki),Di=Ke+Ci,Li=Di-Ke,wi[2]=Ke-(Di-Li)+(Ci-Li),wi[3]=Di,ci=mi*Ti,pt=splitter*mi,St=pt-(pt-mi),zt=mi-St,pt=splitter*Ti,At=pt-(pt-Ti),kt=Ti-At,oi=zt*kt-(ci-St*At-zt*At-St*kt),Ki=ft*ni,pt=splitter*ft,St=pt-(pt-ft),zt=ft-St,pt=splitter*ni,At=pt-(pt-ni),kt=ni-At,si=zt*kt-(Ki-St*At-zt*At-St*kt),Ci=oi-si,Li=oi-Ci,Mi[0]=oi-(Ci+Li)+(Li-si),Ke=ci+Ci,Li=Ke-ci,Nt=ci-(Ke-Li)+(Ci-Li),Ci=Nt-Ki,Li=Nt-Ci,Mi[1]=Nt-(Ci+Li)+(Li-Ki),Di=Ke+Ci,Li=Di-Ke,Mi[2]=Ke-(Di-Li)+(Ci-Li),Mi[3]=Di,4)}function lt(ft,mi,nt,jt,Ti){let ni,wi,Mi,Li,pt,St,zt,At,kt,Ci,Ke,It,Nt;return Ke=mi*nt,wi=splitter*mi,Mi=wi-(wi-mi),Li=mi-Mi,wi=splitter*nt,pt=wi-(wi-nt),St=nt-pt,It=Li*St-(Ke-Mi*pt-Li*pt-Mi*St),wi=splitter*jt,pt=wi-(wi-jt),St=jt-pt,zt=It*jt,wi=splitter*It,Mi=wi-(wi-It),Li=It-Mi,vi[0]=Li*St-(zt-Mi*pt-Li*pt-Mi*St),At=Ke*jt,wi=splitter*Ke,Mi=wi-(wi-Ke),Li=Ke-Mi,Ci=Li*St-(At-Mi*pt-Li*pt-Mi*St),kt=zt+Ci,ni=kt-zt,vi[1]=zt-(kt-ni)+(Ci-ni),Nt=At+kt,vi[2]=kt-(Nt-At),vi[3]=Nt,ft=Pe(ft,4,vi),Ti!==0&&(wi=splitter*Ti,pt=wi-(wi-Ti),St=Ti-pt,zt=It*Ti,wi=splitter*It,Mi=wi-(wi-It),Li=It-Mi,vi[0]=Li*St-(zt-Mi*pt-Li*pt-Mi*St),At=Ke*Ti,wi=splitter*Ke,Mi=wi-(wi-Ke),Li=Ke-Mi,Ci=Li*St-(At-Mi*pt-Li*pt-Mi*St),kt=zt+Ci,ni=kt-zt,vi[1]=zt-(kt-ni)+(Ci-ni),Nt=At+kt,vi[2]=kt-(Nt-At),vi[3]=Nt,ft=Pe(ft,4,vi)),ft}function cs(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt,At){let kt,Ci,Ke,It,Nt,ci,oi,Ki,si,Di,li,Oi,Hi,Sn,On,An,fr,mt,Wt,hi,ln,bt,qt,Lt,Ai;const Zi=ft-pt,Gi=jt-pt,Vi=wi-pt,gn=mi-St,Nn=Ti-St,sn=Mi-St,nr=nt-zt,Fn=ni-zt,or=Li-zt;ln=Gi*sn,Oi=splitter*Gi,Hi=Oi-(Oi-Gi),Sn=Gi-Hi,Oi=splitter*sn,On=Oi-(Oi-sn),An=sn-On,bt=Sn*An-(ln-Hi*On-Sn*On-Hi*An),qt=Vi*Nn,Oi=splitter*Vi,Hi=Oi-(Oi-Vi),Sn=Vi-Hi,Oi=splitter*Nn,On=Oi-(Oi-Nn),An=Nn-On,Lt=Sn*An-(qt-Hi*On-Sn*On-Hi*An),fr=bt-Lt,li=bt-fr,je[0]=bt-(fr+li)+(li-Lt),mt=ln+fr,li=mt-ln,hi=ln-(mt-li)+(fr-li),fr=hi-qt,li=hi-fr,je[1]=hi-(fr+li)+(li-qt),Ai=mt+fr,li=Ai-mt,je[2]=mt-(Ai-li)+(fr-li),je[3]=Ai,ln=Vi*gn,Oi=splitter*Vi,Hi=Oi-(Oi-Vi),Sn=Vi-Hi,Oi=splitter*gn,On=Oi-(Oi-gn),An=gn-On,bt=Sn*An-(ln-Hi*On-Sn*On-Hi*An),qt=Zi*sn,Oi=splitter*Zi,Hi=Oi-(Oi-Zi),Sn=Zi-Hi,Oi=splitter*sn,On=Oi-(Oi-sn),An=sn-On,Lt=Sn*An-(qt-Hi*On-Sn*On-Hi*An),fr=bt-Lt,li=bt-fr,Pt[0]=bt-(fr+li)+(li-Lt),mt=ln+fr,li=mt-ln,hi=ln-(mt-li)+(fr-li),fr=hi-qt,li=hi-fr,Pt[1]=hi-(fr+li)+(li-qt),Ai=mt+fr,li=Ai-mt,Pt[2]=mt-(Ai-li)+(fr-li),Pt[3]=Ai,ln=Zi*Nn,Oi=splitter*Zi,Hi=Oi-(Oi-Zi),Sn=Zi-Hi,Oi=splitter*Nn,On=Oi-(Oi-Nn),An=Nn-On,bt=Sn*An-(ln-Hi*On-Sn*On-Hi*An),qt=Gi*gn,Oi=splitter*Gi,Hi=Oi-(Oi-Gi),Sn=Gi-Hi,Oi=splitter*gn,On=Oi-(Oi-gn),An=gn-On,Lt=Sn*An-(qt-Hi*On-Sn*On-Hi*An),fr=bt-Lt,li=bt-fr,ki[0]=bt-(fr+li)+(li-Lt),mt=ln+fr,li=mt-ln,hi=ln-(mt-li)+(fr-li),fr=hi-qt,li=hi-fr,ki[1]=hi-(fr+li)+(li-qt),Ai=mt+fr,li=Ai-mt,ki[2]=mt-(Ai-li)+(fr-li),ki[3]=Ai,kt=sum(sum(scale(4,je,nr,Mn),Mn,scale(4,Pt,Fn,gr),gr,Hn),Hn,scale(4,ki,or,Mn),Mn,Dt);let rr=estimate(kt,Dt),tr=qe*At;if(rr>=tr||-rr>=tr||(li=ft-Zi,Ci=ft-(Zi+li)+(li-pt),li=jt-Gi,Ke=jt-(Gi+li)+(li-pt),li=wi-Vi,It=wi-(Vi+li)+(li-pt),li=mi-gn,Nt=mi-(gn+li)+(li-St),li=Ti-Nn,ci=Ti-(Nn+li)+(li-St),li=Mi-sn,oi=Mi-(sn+li)+(li-St),li=nt-nr,Ki=nt-(nr+li)+(li-zt),li=ni-Fn,si=ni-(Fn+li)+(li-zt),li=Li-or,Di=Li-(or+li)+(li-zt),Ci===0&&Ke===0&&It===0&&Nt===0&&ci===0&&oi===0&&Ki===0&&si===0&&Di===0)||(tr=De*At+resulterrbound*Math.abs(rr),rr+=nr*(Gi*oi+sn*Ke-(Nn*It+Vi*ci))+Ki*(Gi*sn-Nn*Vi)+Fn*(Vi*Nt+gn*It-(sn*Ci+Zi*oi))+si*(Vi*gn-sn*Zi)+or*(Zi*ci+Nn*Ci-(gn*Ke+Gi*Nt))+Di*(Zi*Nn-gn*Gi),rr>=tr||-rr>=tr))return rr;const yr=$n(Ci,Nt,Gi,Nn,Vi,sn,bi,ji),Wr=$n(Ke,ci,Vi,sn,Zi,gn,hr,Xn),ss=$n(It,oi,Zi,gn,Gi,Nn,rn,Ot),Br=sum(Wr,hr,ss,Ot,at);kt=Pe(kt,scale(Br,at,nr,Hn),Hn);const Gr=sum(ss,rn,yr,ji,Ht);kt=Pe(kt,scale(Gr,Ht,Fn,Hn),Hn);const Ms=sum(yr,bi,Wr,Xn,Qi);return kt=Pe(kt,scale(Ms,Qi,or,Hn),Hn),Ki!==0&&(kt=Pe(kt,scale(4,je,Ki,kr),kr),kt=Pe(kt,scale(Br,at,Ki,Hn),Hn)),si!==0&&(kt=Pe(kt,scale(4,Pt,si,kr),kr),kt=Pe(kt,scale(Gr,Ht,si,Hn),Hn)),Di!==0&&(kt=Pe(kt,scale(4,ki,Di,kr),kr),kt=Pe(kt,scale(Ms,Qi,Di,Hn),Hn)),Ci!==0&&(ci!==0&&(kt=lt(kt,Ci,ci,or,Di)),oi!==0&&(kt=lt(kt,-Ci,oi,Fn,si))),Ke!==0&&(oi!==0&&(kt=lt(kt,Ke,oi,nr,Ki)),Nt!==0&&(kt=lt(kt,-Ke,Nt,or,Di))),It!==0&&(Nt!==0&&(kt=lt(kt,It,Nt,Fn,si)),ci!==0&&(kt=lt(kt,-It,ci,nr,Ki))),Dt[kt-1]}function Xi(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt){const At=ft-pt,kt=jt-pt,Ci=wi-pt,Ke=mi-St,It=Ti-St,Nt=Mi-St,ci=nt-zt,oi=ni-zt,Ki=Li-zt,si=kt*Nt,Di=Ci*It,li=Ci*Ke,Oi=At*Nt,Hi=At*It,Sn=kt*Ke,On=ci*(si-Di)+oi*(li-Oi)+Ki*(Hi-Sn),An=(Math.abs(si)+Math.abs(Di))*Math.abs(ci)+(Math.abs(li)+Math.abs(Oi))*Math.abs(oi)+(Math.abs(Hi)+Math.abs(Sn))*Math.abs(Ki),fr=Ue*An;return On>fr||-On>fr?On:cs(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt,An)}function vs(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt){const At=ft-pt,kt=jt-pt,Ci=wi-pt,Ke=mi-St,It=Ti-St,Nt=Mi-St,ci=nt-zt,oi=ni-zt,Ki=Li-zt;return At*(It*Ki-oi*Nt)+kt*(Nt*ci-Ki*Ke)+Ci*(Ke*oi-ci*It)}const Bs=(10+96*xe)*xe,Xs=(4+48*xe)*xe,Sr=(44+576*xe)*xe*xe,un=et(4),ys=et(4),Hs=et(4),ls=et(4),Rs=et(4),cn=et(4),Jr=et(4),Pr=et(4),Ts=et(8),Dn=et(8),xs=et(8),Gn=et(8),Ir=et(8),fo=et(8),ms=et(8),Co=et(8),mr=et(8),Ss=et(4),ks=et(4),ur=et(4),_e=et(8),he=et(16),pe=et(16),Re=et(16),ke=et(32),ui=et(32),Vt=et(48),fi=et(64);let Zt=et(1152),en=et(1152);function Un(ft,mi,nt){ft=sum(ft,Zt,mi,nt,en);const jt=Zt;return Zt=en,en=jt,ft}function Bn(ft,mi,nt,jt,Ti,ni,wi,Mi,Li){let pt,St,zt,At,kt,Ci,Ke,It,Nt,ci,oi,Ki,si,Di,li,Oi,Hi,Sn,On,An,fr,mt,Wt,hi,ln,bt,qt,Lt,Ai,Zi,Gi,Vi,gn,Nn,sn;const nr=ft-wi,Fn=nt-wi,or=Ti-wi,rr=mi-Mi,tr=jt-Mi,yr=ni-Mi;Gi=Fn*yr,Wt=splitter*Fn,hi=Wt-(Wt-Fn),ln=Fn-hi,Wt=splitter*yr,bt=Wt-(Wt-yr),qt=yr-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=or*tr,Wt=splitter*or,hi=Wt-(Wt-or),ln=or-hi,Wt=splitter*tr,bt=Wt-(Wt-tr),qt=tr-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi-Nn,mt=Vi-Lt,un[0]=Vi-(Lt+mt)+(mt-Nn),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi-gn,mt=Zi-Lt,un[1]=Zi-(Lt+mt)+(mt-gn),sn=Ai+Lt,mt=sn-Ai,un[2]=Ai-(sn-mt)+(Lt-mt),un[3]=sn,Gi=or*rr,Wt=splitter*or,hi=Wt-(Wt-or),ln=or-hi,Wt=splitter*rr,bt=Wt-(Wt-rr),qt=rr-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=nr*yr,Wt=splitter*nr,hi=Wt-(Wt-nr),ln=nr-hi,Wt=splitter*yr,bt=Wt-(Wt-yr),qt=yr-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi-Nn,mt=Vi-Lt,ys[0]=Vi-(Lt+mt)+(mt-Nn),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi-gn,mt=Zi-Lt,ys[1]=Zi-(Lt+mt)+(mt-gn),sn=Ai+Lt,mt=sn-Ai,ys[2]=Ai-(sn-mt)+(Lt-mt),ys[3]=sn,Gi=nr*tr,Wt=splitter*nr,hi=Wt-(Wt-nr),ln=nr-hi,Wt=splitter*tr,bt=Wt-(Wt-tr),qt=tr-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=Fn*rr,Wt=splitter*Fn,hi=Wt-(Wt-Fn),ln=Fn-hi,Wt=splitter*rr,bt=Wt-(Wt-rr),qt=rr-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi-Nn,mt=Vi-Lt,Hs[0]=Vi-(Lt+mt)+(mt-Nn),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi-gn,mt=Zi-Lt,Hs[1]=Zi-(Lt+mt)+(mt-gn),sn=Ai+Lt,mt=sn-Ai,Hs[2]=Ai-(sn-mt)+(Lt-mt),Hs[3]=sn,pt=sum(sum(sum(scale(scale(4,un,nr,_e),_e,nr,he),he,scale(scale(4,un,rr,_e),_e,rr,pe),pe,ke),ke,sum(scale(scale(4,ys,Fn,_e),_e,Fn,he),he,scale(scale(4,ys,tr,_e),_e,tr,pe),pe,ui),ui,fi),fi,sum(scale(scale(4,Hs,or,_e),_e,or,he),he,scale(scale(4,Hs,yr,_e),_e,yr,pe),pe,ke),ke,Zt);let Wr=estimate(pt,Zt),ss=Xs*Li;if(Wr>=ss||-Wr>=ss||(mt=ft-nr,St=ft-(nr+mt)+(mt-wi),mt=mi-rr,kt=mi-(rr+mt)+(mt-Mi),mt=nt-Fn,zt=nt-(Fn+mt)+(mt-wi),mt=jt-tr,Ci=jt-(tr+mt)+(mt-Mi),mt=Ti-or,At=Ti-(or+mt)+(mt-wi),mt=ni-yr,Ke=ni-(yr+mt)+(mt-Mi),St===0&&zt===0&&At===0&&kt===0&&Ci===0&&Ke===0)||(ss=Sr*Li+resulterrbound*Math.abs(Wr),Wr+=(nr*nr+rr*rr)*(Fn*Ke+yr*zt-(tr*At+or*Ci))+2*(nr*St+rr*kt)*(Fn*yr-tr*or)+((Fn*Fn+tr*tr)*(or*kt+rr*At-(yr*St+nr*Ke))+2*(Fn*zt+tr*Ci)*(or*rr-yr*nr))+((or*or+yr*yr)*(nr*Ci+tr*St-(rr*zt+Fn*kt))+2*(or*At+yr*Ke)*(nr*tr-rr*Fn)),Wr>=ss||-Wr>=ss))return Wr;if((zt!==0||Ci!==0||At!==0||Ke!==0)&&(Gi=nr*nr,Wt=splitter*nr,hi=Wt-(Wt-nr),ln=nr-hi,Vi=ln*ln-(Gi-hi*hi-(hi+hi)*ln),gn=rr*rr,Wt=splitter*rr,hi=Wt-(Wt-rr),ln=rr-hi,Nn=ln*ln-(gn-hi*hi-(hi+hi)*ln),Lt=Vi+Nn,mt=Lt-Vi,ls[0]=Vi-(Lt-mt)+(Nn-mt),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi+gn,mt=Lt-Zi,ls[1]=Zi-(Lt-mt)+(gn-mt),sn=Ai+Lt,mt=sn-Ai,ls[2]=Ai-(sn-mt)+(Lt-mt),ls[3]=sn),(At!==0||Ke!==0||St!==0||kt!==0)&&(Gi=Fn*Fn,Wt=splitter*Fn,hi=Wt-(Wt-Fn),ln=Fn-hi,Vi=ln*ln-(Gi-hi*hi-(hi+hi)*ln),gn=tr*tr,Wt=splitter*tr,hi=Wt-(Wt-tr),ln=tr-hi,Nn=ln*ln-(gn-hi*hi-(hi+hi)*ln),Lt=Vi+Nn,mt=Lt-Vi,Rs[0]=Vi-(Lt-mt)+(Nn-mt),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi+gn,mt=Lt-Zi,Rs[1]=Zi-(Lt-mt)+(gn-mt),sn=Ai+Lt,mt=sn-Ai,Rs[2]=Ai-(sn-mt)+(Lt-mt),Rs[3]=sn),(St!==0||kt!==0||zt!==0||Ci!==0)&&(Gi=or*or,Wt=splitter*or,hi=Wt-(Wt-or),ln=or-hi,Vi=ln*ln-(Gi-hi*hi-(hi+hi)*ln),gn=yr*yr,Wt=splitter*yr,hi=Wt-(Wt-yr),ln=yr-hi,Nn=ln*ln-(gn-hi*hi-(hi+hi)*ln),Lt=Vi+Nn,mt=Lt-Vi,cn[0]=Vi-(Lt-mt)+(Nn-mt),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi+gn,mt=Lt-Zi,cn[1]=Zi-(Lt-mt)+(gn-mt),sn=Ai+Lt,mt=sn-Ai,cn[2]=Ai-(sn-mt)+(Lt-mt),cn[3]=sn),St!==0&&(It=scale(4,un,St,Ts),pt=Un(pt,sum_three(scale(It,Ts,2*nr,he),he,scale(scale(4,cn,St,_e),_e,tr,pe),pe,scale(scale(4,Rs,St,_e),_e,-yr,Re),Re,ke,Vt),Vt)),kt!==0&&(Nt=scale(4,un,kt,Dn),pt=Un(pt,sum_three(scale(Nt,Dn,2*rr,he),he,scale(scale(4,Rs,kt,_e),_e,or,pe),pe,scale(scale(4,cn,kt,_e),_e,-Fn,Re),Re,ke,Vt),Vt)),zt!==0&&(ci=scale(4,ys,zt,xs),pt=Un(pt,sum_three(scale(ci,xs,2*Fn,he),he,scale(scale(4,ls,zt,_e),_e,yr,pe),pe,scale(scale(4,cn,zt,_e),_e,-rr,Re),Re,ke,Vt),Vt)),Ci!==0&&(oi=scale(4,ys,Ci,Gn),pt=Un(pt,sum_three(scale(oi,Gn,2*tr,he),he,scale(scale(4,cn,Ci,_e),_e,nr,pe),pe,scale(scale(4,ls,Ci,_e),_e,-or,Re),Re,ke,Vt),Vt)),At!==0&&(Ki=scale(4,Hs,At,Ir),pt=Un(pt,sum_three(scale(Ki,Ir,2*or,he),he,scale(scale(4,Rs,At,_e),_e,rr,pe),pe,scale(scale(4,ls,At,_e),_e,-tr,Re),Re,ke,Vt),Vt)),Ke!==0&&(si=scale(4,Hs,Ke,fo),pt=Un(pt,sum_three(scale(si,fo,2*yr,he),he,scale(scale(4,ls,Ke,_e),_e,Fn,pe),pe,scale(scale(4,Rs,Ke,_e),_e,-nr,Re),Re,ke,Vt),Vt)),St!==0||kt!==0){if(zt!==0||Ci!==0||At!==0||Ke!==0?(Gi=zt*yr,Wt=splitter*zt,hi=Wt-(Wt-zt),ln=zt-hi,Wt=splitter*yr,bt=Wt-(Wt-yr),qt=yr-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=Fn*Ke,Wt=splitter*Fn,hi=Wt-(Wt-Fn),ln=Fn-hi,Wt=splitter*Ke,bt=Wt-(Wt-Ke),qt=Ke-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi+Nn,mt=Lt-Vi,Jr[0]=Vi-(Lt-mt)+(Nn-mt),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi+gn,mt=Lt-Zi,Jr[1]=Zi-(Lt-mt)+(gn-mt),sn=Ai+Lt,mt=sn-Ai,Jr[2]=Ai-(sn-mt)+(Lt-mt),Jr[3]=sn,Gi=At*-tr,Wt=splitter*At,hi=Wt-(Wt-At),ln=At-hi,Wt=splitter*-tr,bt=Wt-(Wt- -tr),qt=-tr-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=or*-Ci,Wt=splitter*or,hi=Wt-(Wt-or),ln=or-hi,Wt=splitter*-Ci,bt=Wt-(Wt- -Ci),qt=-Ci-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi+Nn,mt=Lt-Vi,Pr[0]=Vi-(Lt-mt)+(Nn-mt),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi+gn,mt=Lt-Zi,Pr[1]=Zi-(Lt-mt)+(gn-mt),sn=Ai+Lt,mt=sn-Ai,Pr[2]=Ai-(sn-mt)+(Lt-mt),Pr[3]=sn,li=sum(4,Jr,4,Pr,Co),Gi=zt*Ke,Wt=splitter*zt,hi=Wt-(Wt-zt),ln=zt-hi,Wt=splitter*Ke,bt=Wt-(Wt-Ke),qt=Ke-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=At*Ci,Wt=splitter*At,hi=Wt-(Wt-At),ln=At-hi,Wt=splitter*Ci,bt=Wt-(Wt-Ci),qt=Ci-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi-Nn,mt=Vi-Lt,ks[0]=Vi-(Lt+mt)+(mt-Nn),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi-gn,mt=Zi-Lt,ks[1]=Zi-(Lt+mt)+(mt-gn),sn=Ai+Lt,mt=sn-Ai,ks[2]=Ai-(sn-mt)+(Lt-mt),ks[3]=sn,Sn=4):(Co[0]=0,li=1,ks[0]=0,Sn=1),St!==0){const Br=scale(li,Co,St,Re);pt=Un(pt,sum(scale(It,Ts,St,he),he,scale(Br,Re,2*nr,ke),ke,Vt),Vt);const Gr=scale(Sn,ks,St,_e);pt=Un(pt,sum_three(scale(Gr,_e,2*nr,he),he,scale(Gr,_e,St,pe),pe,scale(Br,Re,St,ke),ke,ui,fi),fi),Ci!==0&&(pt=Un(pt,scale(scale(4,cn,St,_e),_e,Ci,he),he)),Ke!==0&&(pt=Un(pt,scale(scale(4,Rs,-St,_e),_e,Ke,he),he))}if(kt!==0){const Br=scale(li,Co,kt,Re);pt=Un(pt,sum(scale(Nt,Dn,kt,he),he,scale(Br,Re,2*rr,ke),ke,Vt),Vt);const Gr=scale(Sn,ks,kt,_e);pt=Un(pt,sum_three(scale(Gr,_e,2*rr,he),he,scale(Gr,_e,kt,pe),pe,scale(Br,Re,kt,ke),ke,ui,fi),fi)}}if(zt!==0||Ci!==0){if(At!==0||Ke!==0||St!==0||kt!==0?(Gi=At*rr,Wt=splitter*At,hi=Wt-(Wt-At),ln=At-hi,Wt=splitter*rr,bt=Wt-(Wt-rr),qt=rr-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=or*kt,Wt=splitter*or,hi=Wt-(Wt-or),ln=or-hi,Wt=splitter*kt,bt=Wt-(Wt-kt),qt=kt-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi+Nn,mt=Lt-Vi,Jr[0]=Vi-(Lt-mt)+(Nn-mt),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi+gn,mt=Lt-Zi,Jr[1]=Zi-(Lt-mt)+(gn-mt),sn=Ai+Lt,mt=sn-Ai,Jr[2]=Ai-(sn-mt)+(Lt-mt),Jr[3]=sn,An=-yr,fr=-Ke,Gi=St*An,Wt=splitter*St,hi=Wt-(Wt-St),ln=St-hi,Wt=splitter*An,bt=Wt-(Wt-An),qt=An-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=nr*fr,Wt=splitter*nr,hi=Wt-(Wt-nr),ln=nr-hi,Wt=splitter*fr,bt=Wt-(Wt-fr),qt=fr-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi+Nn,mt=Lt-Vi,Pr[0]=Vi-(Lt-mt)+(Nn-mt),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi+gn,mt=Lt-Zi,Pr[1]=Zi-(Lt-mt)+(gn-mt),sn=Ai+Lt,mt=sn-Ai,Pr[2]=Ai-(sn-mt)+(Lt-mt),Pr[3]=sn,Oi=sum(4,Jr,4,Pr,mr),Gi=At*kt,Wt=splitter*At,hi=Wt-(Wt-At),ln=At-hi,Wt=splitter*kt,bt=Wt-(Wt-kt),qt=kt-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=St*Ke,Wt=splitter*St,hi=Wt-(Wt-St),ln=St-hi,Wt=splitter*Ke,bt=Wt-(Wt-Ke),qt=Ke-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi-Nn,mt=Vi-Lt,ur[0]=Vi-(Lt+mt)+(mt-Nn),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi-gn,mt=Zi-Lt,ur[1]=Zi-(Lt+mt)+(mt-gn),sn=Ai+Lt,mt=sn-Ai,ur[2]=Ai-(sn-mt)+(Lt-mt),ur[3]=sn,On=4):(mr[0]=0,Oi=1,ur[0]=0,On=1),zt!==0){const Br=scale(Oi,mr,zt,Re);pt=Un(pt,sum(scale(ci,xs,zt,he),he,scale(Br,Re,2*Fn,ke),ke,Vt),Vt);const Gr=scale(On,ur,zt,_e);pt=Un(pt,sum_three(scale(Gr,_e,2*Fn,he),he,scale(Gr,_e,zt,pe),pe,scale(Br,Re,zt,ke),ke,ui,fi),fi),Ke!==0&&(pt=Un(pt,scale(scale(4,ls,zt,_e),_e,Ke,he),he)),kt!==0&&(pt=Un(pt,scale(scale(4,cn,-zt,_e),_e,kt,he),he))}if(Ci!==0){const Br=scale(Oi,mr,Ci,Re);pt=Un(pt,sum(scale(oi,Gn,Ci,he),he,scale(Br,Re,2*tr,ke),ke,Vt),Vt);const Gr=scale(On,ur,Ci,_e);pt=Un(pt,sum_three(scale(Gr,_e,2*tr,he),he,scale(Gr,_e,Ci,pe),pe,scale(Br,Re,Ci,ke),ke,ui,fi),fi)}}if(At!==0||Ke!==0){if(St!==0||kt!==0||zt!==0||Ci!==0?(Gi=St*tr,Wt=splitter*St,hi=Wt-(Wt-St),ln=St-hi,Wt=splitter*tr,bt=Wt-(Wt-tr),qt=tr-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=nr*Ci,Wt=splitter*nr,hi=Wt-(Wt-nr),ln=nr-hi,Wt=splitter*Ci,bt=Wt-(Wt-Ci),qt=Ci-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi+Nn,mt=Lt-Vi,Jr[0]=Vi-(Lt-mt)+(Nn-mt),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi+gn,mt=Lt-Zi,Jr[1]=Zi-(Lt-mt)+(gn-mt),sn=Ai+Lt,mt=sn-Ai,Jr[2]=Ai-(sn-mt)+(Lt-mt),Jr[3]=sn,An=-rr,fr=-kt,Gi=zt*An,Wt=splitter*zt,hi=Wt-(Wt-zt),ln=zt-hi,Wt=splitter*An,bt=Wt-(Wt-An),qt=An-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=Fn*fr,Wt=splitter*Fn,hi=Wt-(Wt-Fn),ln=Fn-hi,Wt=splitter*fr,bt=Wt-(Wt-fr),qt=fr-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi+Nn,mt=Lt-Vi,Pr[0]=Vi-(Lt-mt)+(Nn-mt),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi+gn,mt=Lt-Zi,Pr[1]=Zi-(Lt-mt)+(gn-mt),sn=Ai+Lt,mt=sn-Ai,Pr[2]=Ai-(sn-mt)+(Lt-mt),Pr[3]=sn,Di=sum(4,Jr,4,Pr,ms),Gi=St*Ci,Wt=splitter*St,hi=Wt-(Wt-St),ln=St-hi,Wt=splitter*Ci,bt=Wt-(Wt-Ci),qt=Ci-bt,Vi=ln*qt-(Gi-hi*bt-ln*bt-hi*qt),gn=zt*kt,Wt=splitter*zt,hi=Wt-(Wt-zt),ln=zt-hi,Wt=splitter*kt,bt=Wt-(Wt-kt),qt=kt-bt,Nn=ln*qt-(gn-hi*bt-ln*bt-hi*qt),Lt=Vi-Nn,mt=Vi-Lt,Ss[0]=Vi-(Lt+mt)+(mt-Nn),Ai=Gi+Lt,mt=Ai-Gi,Zi=Gi-(Ai-mt)+(Lt-mt),Lt=Zi-gn,mt=Zi-Lt,Ss[1]=Zi-(Lt+mt)+(mt-gn),sn=Ai+Lt,mt=sn-Ai,Ss[2]=Ai-(sn-mt)+(Lt-mt),Ss[3]=sn,Hi=4):(ms[0]=0,Di=1,Ss[0]=0,Hi=1),At!==0){const Br=scale(Di,ms,At,Re);pt=Un(pt,sum(scale(Ki,Ir,At,he),he,scale(Br,Re,2*or,ke),ke,Vt),Vt);const Gr=scale(Hi,Ss,At,_e);pt=Un(pt,sum_three(scale(Gr,_e,2*or,he),he,scale(Gr,_e,At,pe),pe,scale(Br,Re,At,ke),ke,ui,fi),fi),kt!==0&&(pt=Un(pt,scale(scale(4,Rs,At,_e),_e,kt,he),he)),Ci!==0&&(pt=Un(pt,scale(scale(4,ls,-At,_e),_e,Ci,he),he))}if(Ke!==0){const Br=scale(Di,ms,Ke,Re);pt=Un(pt,sum(scale(si,fo,Ke,he),he,scale(Br,Re,2*yr,ke),ke,Vt),Vt);const Gr=scale(Hi,Ss,Ke,_e);pt=Un(pt,sum_three(scale(Gr,_e,2*yr,he),he,scale(Gr,_e,Ke,pe),pe,scale(Br,Re,Ke,ke),ke,ui,fi),fi)}}return Zt[pt-1]}function Or(ft,mi,nt,jt,Ti,ni,wi,Mi){const Li=ft-wi,pt=nt-wi,St=Ti-wi,zt=mi-Mi,At=jt-Mi,kt=ni-Mi,Ci=pt*kt,Ke=St*At,It=Li*Li+zt*zt,Nt=St*zt,ci=Li*kt,oi=pt*pt+At*At,Ki=Li*At,si=pt*zt,Di=St*St+kt*kt,li=It*(Ci-Ke)+oi*(Nt-ci)+Di*(Ki-si),Oi=(Math.abs(Ci)+Math.abs(Ke))*It+(Math.abs(Nt)+Math.abs(ci))*oi+(Math.abs(Ki)+Math.abs(si))*Di,Hi=Bs*Oi;return li>Hi||-li>Hi?li:Bn(ft,mi,nt,jt,Ti,ni,wi,Mi,Oi)}function hs(ft,mi,nt,jt,Ti,ni,wi,Mi){const Li=ft-wi,pt=mi-Mi,St=nt-wi,zt=jt-Mi,At=Ti-wi,kt=ni-Mi,Ci=Li*zt-St*pt,Ke=St*kt-At*zt,It=At*pt-Li*kt,Nt=Li*Li+pt*pt,ci=St*St+zt*zt,oi=At*At+kt*kt;return Nt*Ke+ci*It+oi*Ci}const Vs=(16+224*xe)*xe,qr=(5+72*xe)*xe,ds=(71+1408*xe)*xe*xe,gt=et(4),q=et(4),ee=et(4),oe=et(4),Ee=et(4),be=et(4),Ce=et(4),Y=et(4),K=et(4),se=et(4),fe=et(24),ce=et(24),Se=et(24),it=et(24),Ne=et(24),ut=et(24),Et=et(24),xt=et(24),Xt=et(24),vn=et(24),nn=et(1152),Tn=et(1152),Kn=et(1152),dr=et(1152),Vn=et(1152),Hr=et(2304),Mr=et(2304),zs=et(3456),Qs=et(5760),xo=et(8),bs=et(8),to=et(8),rs=et(16),ws=et(24),Qr=et(48),Ho=et(48),io=et(96),ao=et(192),Po=et(384),Zo=et(384),bo=et(384),Oo=et(768);function wo(ft,mi,nt,jt,Ti,ni,wi){return sum_three(scale(4,ft,jt,xo),xo,scale(4,mi,Ti,bs),bs,scale(4,nt,ni,to),to,rs,wi)}function ma(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt){const At=sum(sum(ft,mi,nt,jt,Qr),Qr,negate(sum(Ti,ni,wi,Mi,Ho),Ho),Ho,io);return sum_three(scale(scale(At,io,Li,ao),ao,Li,Po),Po,scale(scale(At,io,pt,ao),ao,pt,Zo),Zo,scale(scale(At,io,St,ao),ao,St,bo),bo,Oo,zt)}function Yo(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt,At,kt,Ci){let Ke,It,Nt,ci,oi,Ki,si,Di,li,Oi,Hi,Sn,On,An;Oi=ft*Ti,It=splitter*ft,Nt=It-(It-ft),ci=ft-Nt,It=splitter*Ti,oi=It-(It-Ti),Ki=Ti-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=jt*mi,It=splitter*jt,Nt=It-(It-jt),ci=jt-Nt,It=splitter*mi,oi=It-(It-mi),Ki=mi-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,gt[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,gt[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,gt[2]=Di-(An-Ke)+(si-Ke),gt[3]=An,Oi=jt*Mi,It=splitter*jt,Nt=It-(It-jt),ci=jt-Nt,It=splitter*Mi,oi=It-(It-Mi),Ki=Mi-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=wi*Ti,It=splitter*wi,Nt=It-(It-wi),ci=wi-Nt,It=splitter*Ti,oi=It-(It-Ti),Ki=Ti-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,q[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,q[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,q[2]=Di-(An-Ke)+(si-Ke),q[3]=An,Oi=wi*St,It=splitter*wi,Nt=It-(It-wi),ci=wi-Nt,It=splitter*St,oi=It-(It-St),Ki=St-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=pt*Mi,It=splitter*pt,Nt=It-(It-pt),ci=pt-Nt,It=splitter*Mi,oi=It-(It-Mi),Ki=Mi-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,ee[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,ee[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,ee[2]=Di-(An-Ke)+(si-Ke),ee[3]=An,Oi=pt*kt,It=splitter*pt,Nt=It-(It-pt),ci=pt-Nt,It=splitter*kt,oi=It-(It-kt),Ki=kt-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=At*St,It=splitter*At,Nt=It-(It-At),ci=At-Nt,It=splitter*St,oi=It-(It-St),Ki=St-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,oe[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,oe[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,oe[2]=Di-(An-Ke)+(si-Ke),oe[3]=An,Oi=At*mi,It=splitter*At,Nt=It-(It-At),ci=At-Nt,It=splitter*mi,oi=It-(It-mi),Ki=mi-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=ft*kt,It=splitter*ft,Nt=It-(It-ft),ci=ft-Nt,It=splitter*kt,oi=It-(It-kt),Ki=kt-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,Ee[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,Ee[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,Ee[2]=Di-(An-Ke)+(si-Ke),Ee[3]=An,Oi=ft*Mi,It=splitter*ft,Nt=It-(It-ft),ci=ft-Nt,It=splitter*Mi,oi=It-(It-Mi),Ki=Mi-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=wi*mi,It=splitter*wi,Nt=It-(It-wi),ci=wi-Nt,It=splitter*mi,oi=It-(It-mi),Ki=mi-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,be[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,be[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,be[2]=Di-(An-Ke)+(si-Ke),be[3]=An,Oi=jt*St,It=splitter*jt,Nt=It-(It-jt),ci=jt-Nt,It=splitter*St,oi=It-(It-St),Ki=St-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=pt*Ti,It=splitter*pt,Nt=It-(It-pt),ci=pt-Nt,It=splitter*Ti,oi=It-(It-Ti),Ki=Ti-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,Ce[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,Ce[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,Ce[2]=Di-(An-Ke)+(si-Ke),Ce[3]=An,Oi=wi*kt,It=splitter*wi,Nt=It-(It-wi),ci=wi-Nt,It=splitter*kt,oi=It-(It-kt),Ki=kt-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=At*Mi,It=splitter*At,Nt=It-(It-At),ci=At-Nt,It=splitter*Mi,oi=It-(It-Mi),Ki=Mi-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,Y[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,Y[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,Y[2]=Di-(An-Ke)+(si-Ke),Y[3]=An,Oi=pt*mi,It=splitter*pt,Nt=It-(It-pt),ci=pt-Nt,It=splitter*mi,oi=It-(It-mi),Ki=mi-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=ft*St,It=splitter*ft,Nt=It-(It-ft),ci=ft-Nt,It=splitter*St,oi=It-(It-St),Ki=St-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,K[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,K[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,K[2]=Di-(An-Ke)+(si-Ke),K[3]=An,Oi=At*Ti,It=splitter*At,Nt=It-(It-At),ci=At-Nt,It=splitter*Ti,oi=It-(It-Ti),Ki=Ti-oi,Hi=ci*Ki-(Oi-Nt*oi-ci*oi-Nt*Ki),Sn=jt*kt,It=splitter*jt,Nt=It-(It-jt),ci=jt-Nt,It=splitter*kt,oi=It-(It-kt),Ki=kt-oi,On=ci*Ki-(Sn-Nt*oi-ci*oi-Nt*Ki),si=Hi-On,Ke=Hi-si,se[0]=Hi-(si+Ke)+(Ke-On),Di=Oi+si,Ke=Di-Oi,li=Oi-(Di-Ke)+(si-Ke),si=li-Sn,Ke=li-si,se[1]=li-(si+Ke)+(Ke-Sn),An=Di+si,Ke=An-Di,se[2]=Di-(An-Ke)+(si-Ke),se[3]=An;const fr=wo(gt,q,be,Li,nt,-ni,fe),mt=wo(q,ee,Ce,zt,ni,-Li,ce),Wt=wo(ee,oe,Y,Ci,Li,-zt,Se),hi=wo(oe,Ee,K,nt,zt,-Ci,it),ln=wo(Ee,gt,se,ni,Ci,-nt,Ne),bt=wo(gt,Ce,K,zt,nt,ni,ut),qt=wo(q,Y,se,Ci,ni,Li,Et),Lt=wo(ee,K,be,nt,Li,zt,xt),Ai=wo(oe,se,Ce,ni,zt,Ci,Xt),Zi=wo(Ee,be,Y,Li,Ci,nt,vn),Gi=sum_three(ma(Wt,Se,qt,Et,Ai,Xt,mt,ce,ft,mi,nt,nn),nn,ma(hi,it,Lt,xt,Zi,vn,Wt,Se,jt,Ti,ni,Tn),Tn,sum_three(ma(ln,Ne,Ai,Xt,bt,ut,hi,it,wi,Mi,Li,Kn),Kn,ma(fr,fe,Zi,vn,qt,Et,ln,Ne,pt,St,zt,dr),dr,ma(mt,ce,bt,ut,Lt,xt,fr,fe,At,kt,Ci,Vn),Vn,Mr,zs),zs,Hr,Qs);return Qs[Gi-1]}const sa=et(96),la=et(96),Is=et(96),D=et(1152);function W(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt){const St=wo(ft,mi,nt,jt,Ti,ni,ws);return sum_three(scale(scale(St,ws,wi,Qr),Qr,wi,sa),sa,scale(scale(St,ws,Mi,Qr),Qr,Mi,la),la,scale(scale(St,ws,Li,Qr),Qr,Li,Is),Is,ao,pt)}function Ge(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt,At,kt,Ci,Ke){let It,Nt,ci,oi,Ki,si,Di,li,Oi,Hi,Sn,On,An,fr,mt,Wt,hi,ln,bt,qt,Lt,Ai,Zi,Gi,Vi,gn,Nn,sn,nr,Fn,or;const rr=ft-At,tr=jt-At,yr=wi-At,Wr=pt-At,ss=mi-kt,Br=Ti-kt,Gr=Mi-kt,Ms=St-kt,Os=nt-Ci,cr=ni-Ci,Ln=Li-Ci,$s=zt-Ci;sn=rr*Br,qt=splitter*rr,Lt=qt-(qt-rr),Ai=rr-Lt,qt=splitter*Br,Zi=qt-(qt-Br),Gi=Br-Zi,nr=Ai*Gi-(sn-Lt*Zi-Ai*Zi-Lt*Gi),Fn=tr*ss,qt=splitter*tr,Lt=qt-(qt-tr),Ai=tr-Lt,qt=splitter*ss,Zi=qt-(qt-ss),Gi=ss-Zi,or=Ai*Gi-(Fn-Lt*Zi-Ai*Zi-Lt*Gi),Vi=nr-or,bt=nr-Vi,gt[0]=nr-(Vi+bt)+(bt-or),gn=sn+Vi,bt=gn-sn,Nn=sn-(gn-bt)+(Vi-bt),Vi=Nn-Fn,bt=Nn-Vi,gt[1]=Nn-(Vi+bt)+(bt-Fn),It=gn+Vi,bt=It-gn,gt[2]=gn-(It-bt)+(Vi-bt),gt[3]=It,sn=tr*Gr,qt=splitter*tr,Lt=qt-(qt-tr),Ai=tr-Lt,qt=splitter*Gr,Zi=qt-(qt-Gr),Gi=Gr-Zi,nr=Ai*Gi-(sn-Lt*Zi-Ai*Zi-Lt*Gi),Fn=yr*Br,qt=splitter*yr,Lt=qt-(qt-yr),Ai=yr-Lt,qt=splitter*Br,Zi=qt-(qt-Br),Gi=Br-Zi,or=Ai*Gi-(Fn-Lt*Zi-Ai*Zi-Lt*Gi),Vi=nr-or,bt=nr-Vi,q[0]=nr-(Vi+bt)+(bt-or),gn=sn+Vi,bt=gn-sn,Nn=sn-(gn-bt)+(Vi-bt),Vi=Nn-Fn,bt=Nn-Vi,q[1]=Nn-(Vi+bt)+(bt-Fn),Nt=gn+Vi,bt=Nt-gn,q[2]=gn-(Nt-bt)+(Vi-bt),q[3]=Nt,sn=yr*Ms,qt=splitter*yr,Lt=qt-(qt-yr),Ai=yr-Lt,qt=splitter*Ms,Zi=qt-(qt-Ms),Gi=Ms-Zi,nr=Ai*Gi-(sn-Lt*Zi-Ai*Zi-Lt*Gi),Fn=Wr*Gr,qt=splitter*Wr,Lt=qt-(qt-Wr),Ai=Wr-Lt,qt=splitter*Gr,Zi=qt-(qt-Gr),Gi=Gr-Zi,or=Ai*Gi-(Fn-Lt*Zi-Ai*Zi-Lt*Gi),Vi=nr-or,bt=nr-Vi,ee[0]=nr-(Vi+bt)+(bt-or),gn=sn+Vi,bt=gn-sn,Nn=sn-(gn-bt)+(Vi-bt),Vi=Nn-Fn,bt=Nn-Vi,ee[1]=Nn-(Vi+bt)+(bt-Fn),ci=gn+Vi,bt=ci-gn,ee[2]=gn-(ci-bt)+(Vi-bt),ee[3]=ci,sn=Wr*ss,qt=splitter*Wr,Lt=qt-(qt-Wr),Ai=Wr-Lt,qt=splitter*ss,Zi=qt-(qt-ss),Gi=ss-Zi,nr=Ai*Gi-(sn-Lt*Zi-Ai*Zi-Lt*Gi),Fn=rr*Ms,qt=splitter*rr,Lt=qt-(qt-rr),Ai=rr-Lt,qt=splitter*Ms,Zi=qt-(qt-Ms),Gi=Ms-Zi,or=Ai*Gi-(Fn-Lt*Zi-Ai*Zi-Lt*Gi),Vi=nr-or,bt=nr-Vi,K[0]=nr-(Vi+bt)+(bt-or),gn=sn+Vi,bt=gn-sn,Nn=sn-(gn-bt)+(Vi-bt),Vi=Nn-Fn,bt=Nn-Vi,K[1]=Nn-(Vi+bt)+(bt-Fn),oi=gn+Vi,bt=oi-gn,K[2]=gn-(oi-bt)+(Vi-bt),K[3]=oi,sn=rr*Gr,qt=splitter*rr,Lt=qt-(qt-rr),Ai=rr-Lt,qt=splitter*Gr,Zi=qt-(qt-Gr),Gi=Gr-Zi,nr=Ai*Gi-(sn-Lt*Zi-Ai*Zi-Lt*Gi),Fn=yr*ss,qt=splitter*yr,Lt=qt-(qt-yr),Ai=yr-Lt,qt=splitter*ss,Zi=qt-(qt-ss),Gi=ss-Zi,or=Ai*Gi-(Fn-Lt*Zi-Ai*Zi-Lt*Gi),Vi=nr-or,bt=nr-Vi,be[0]=nr-(Vi+bt)+(bt-or),gn=sn+Vi,bt=gn-sn,Nn=sn-(gn-bt)+(Vi-bt),Vi=Nn-Fn,bt=Nn-Vi,be[1]=Nn-(Vi+bt)+(bt-Fn),Ki=gn+Vi,bt=Ki-gn,be[2]=gn-(Ki-bt)+(Vi-bt),be[3]=Ki,sn=tr*Ms,qt=splitter*tr,Lt=qt-(qt-tr),Ai=tr-Lt,qt=splitter*Ms,Zi=qt-(qt-Ms),Gi=Ms-Zi,nr=Ai*Gi-(sn-Lt*Zi-Ai*Zi-Lt*Gi),Fn=Wr*Br,qt=splitter*Wr,Lt=qt-(qt-Wr),Ai=Wr-Lt,qt=splitter*Br,Zi=qt-(qt-Br),Gi=Br-Zi,or=Ai*Gi-(Fn-Lt*Zi-Ai*Zi-Lt*Gi),Vi=nr-or,bt=nr-Vi,Ce[0]=nr-(Vi+bt)+(bt-or),gn=sn+Vi,bt=gn-sn,Nn=sn-(gn-bt)+(Vi-bt),Vi=Nn-Fn,bt=Nn-Vi,Ce[1]=Nn-(Vi+bt)+(bt-Fn),si=gn+Vi,bt=si-gn,Ce[2]=gn-(si-bt)+(Vi-bt),Ce[3]=si;const ar=sum(sum(negate(W(q,ee,Ce,$s,cr,-Ln,rr,ss,Os,nn),nn),nn,W(ee,K,be,Os,Ln,$s,tr,Br,cr,Tn),Tn,Hr),Hr,sum(negate(W(K,gt,Ce,cr,$s,Os,yr,Gr,Ln,Kn),Kn),Kn,W(gt,q,be,Ln,Os,-cr,Wr,Ms,$s,dr),dr,Mr),Mr,D);let po=estimate(ar,D),lo=qr*Ke;if(po>=lo||-po>=lo||(bt=ft-rr,Di=ft-(rr+bt)+(bt-At),bt=mi-ss,Sn=mi-(ss+bt)+(bt-kt),bt=nt-Os,mt=nt-(Os+bt)+(bt-Ci),bt=jt-tr,li=jt-(tr+bt)+(bt-At),bt=Ti-Br,On=Ti-(Br+bt)+(bt-kt),bt=ni-cr,Wt=ni-(cr+bt)+(bt-Ci),bt=wi-yr,Oi=wi-(yr+bt)+(bt-At),bt=Mi-Gr,An=Mi-(Gr+bt)+(bt-kt),bt=Li-Ln,hi=Li-(Ln+bt)+(bt-Ci),bt=pt-Wr,Hi=pt-(Wr+bt)+(bt-At),bt=St-Ms,fr=St-(Ms+bt)+(bt-kt),bt=zt-$s,ln=zt-($s+bt)+(bt-Ci),Di===0&&Sn===0&&mt===0&&li===0&&On===0&&Wt===0&&Oi===0&&An===0&&hi===0&&Hi===0&&fr===0&&ln===0))return po;lo=ds*Ke+resulterrbound*Math.abs(po);const Qn=rr*On+Br*Di-(ss*li+tr*Sn),Lo=tr*An+Gr*li-(Br*Oi+yr*On),Go=yr*fr+Ms*Oi-(Gr*Hi+Wr*An),Aa=Wr*Sn+ss*Hi-(Ms*Di+rr*fr),Ca=rr*An+Gr*Di-(ss*Oi+yr*Sn),Ro=tr*fr+Ms*li-(Br*Hi+Wr*On);return po+=(tr*tr+Br*Br+cr*cr)*(Ln*Aa+$s*Ca+Os*Go+(hi*oi+ln*Ki+mt*ci))+(Wr*Wr+Ms*Ms+$s*$s)*(Os*Lo-cr*Ca+Ln*Qn+(mt*Nt-Wt*Ki+hi*It))-((rr*rr+ss*ss+Os*Os)*(cr*Go-Ln*Ro+$s*Lo+(Wt*ci-hi*si+ln*Nt))+(yr*yr+Gr*Gr+Ln*Ln)*($s*Qn+Os*Ro+cr*Aa+(ln*It+mt*si+Wt*oi)))+2*((tr*li+Br*On+cr*Wt)*(Ln*oi+$s*Ki+Os*ci)+(Wr*Hi+Ms*fr+$s*ln)*(Os*Nt-cr*Ki+Ln*It)-((rr*Di+ss*Sn+Os*mt)*(cr*ci-Ln*si+$s*Nt)+(yr*Oi+Gr*An+Ln*hi)*($s*It+Os*si+cr*oi))),po>=lo||-po>=lo?po:Yo(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt,At,kt,Ci)}function Ye(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt,At,kt,Ci){const Ke=ft-At,It=jt-At,Nt=wi-At,ci=pt-At,oi=mi-kt,Ki=Ti-kt,si=Mi-kt,Di=St-kt,li=nt-Ci,Oi=ni-Ci,Hi=Li-Ci,Sn=zt-Ci,On=Ke*Ki,An=It*oi,fr=On-An,mt=It*si,Wt=Nt*Ki,hi=mt-Wt,ln=Nt*Di,bt=ci*si,qt=ln-bt,Lt=ci*oi,Ai=Ke*Di,Zi=Lt-Ai,Gi=Ke*si,Vi=Nt*oi,gn=Gi-Vi,Nn=It*Di,sn=ci*Ki,nr=Nn-sn,Fn=Ke*Ke+oi*oi+li*li,or=It*It+Ki*Ki+Oi*Oi,rr=Nt*Nt+si*si+Hi*Hi,tr=ci*ci+Di*Di+Sn*Sn,yr=rr*(Sn*fr+li*nr+Oi*Zi)-tr*(li*hi-Oi*gn+Hi*fr)+(Fn*(Oi*qt-Hi*nr+Sn*hi)-or*(Hi*Zi+Sn*gn+li*qt)),Wr=Math.abs(li),ss=Math.abs(Oi),Br=Math.abs(Hi),Gr=Math.abs(Sn),Ms=Math.abs(On)+Math.abs(An),Os=Math.abs(mt)+Math.abs(Wt),cr=Math.abs(ln)+Math.abs(bt),Ln=Math.abs(Lt)+Math.abs(Ai),$s=Math.abs(Gi)+Math.abs(Vi),ar=Math.abs(Nn)+Math.abs(sn),po=(cr*ss+ar*Br+Os*Gr)*Fn+(Ln*Br+$s*Gr+cr*Wr)*or+(Ms*Gr+ar*Wr+Ln*ss)*rr+(Os*Wr+$s*ss+Ms*Br)*tr,lo=Vs*po;return yr>lo||-yr>lo?yr:-Ge(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt,At,kt,Ci,po)}function Bt(ft,mi,nt,jt,Ti,ni,wi,Mi,Li,pt,St,zt,At,kt,Ci){const Ke=ft-At,It=jt-At,Nt=wi-At,ci=pt-At,oi=mi-kt,Ki=Ti-kt,si=Mi-kt,Di=St-kt,li=nt-Ci,Oi=ni-Ci,Hi=Li-Ci,Sn=zt-Ci,On=Ke*Ki-It*oi,An=It*si-Nt*Ki,fr=Nt*Di-ci*si,mt=ci*oi-Ke*Di,Wt=Ke*si-Nt*oi,hi=It*Di-ci*Ki,ln=li*An-Oi*Wt+Hi*On,bt=Oi*fr-Hi*hi+Sn*An,qt=Hi*mt+Sn*Wt+li*fr,Lt=Sn*On+li*hi+Oi*mt,Ai=Ke*Ke+oi*oi+li*li,Zi=It*It+Ki*Ki+Oi*Oi,Gi=Nt*Nt+si*si+Hi*Hi,Vi=ci*ci+Di*Di+Sn*Sn;return Gi*Lt-Vi*ln+(Ai*bt-Zi*qt)}function Ei(ft,mi){var nt,jt,Ti=0,ni,wi,Mi,Li,pt,St,zt,At=ft[0],kt=ft[1],Ci=mi.length;for(nt=0;nt<Ci;nt++){jt=0;var Ke=mi[nt],It=Ke.length-1;if(St=Ke[0],St[0]!==Ke[It][0]&&St[1]!==Ke[It][1])throw new Error("First and last coordinates in a ring must be the same");for(wi=St[0]-At,Mi=St[1]-kt,jt;jt<It;jt++){if(zt=Ke[jt+1],Li=zt[0]-At,pt=zt[1]-kt,Mi===0&&pt===0){if(Li<=0&&wi>=0||wi<=0&&Li>=0)return 0}else if(pt>=0&&Mi<=0||pt<=0&&Mi>=0){if(ni=Be(wi,Li,Mi,pt,0,0),ni===0)return 0;(ni>0&&pt>0&&Mi<=0||ni<0&&pt<=0&&Mi>0)&&Ti++}St=zt,Mi=pt,wi=Li}}return Ti%2!==0}var Pn=Tt(55230);function yn(ft,mi,nt={}){if(!ft)throw new Error("point is required");if(!mi)throw new Error("polygon is required");const jt=(0,Pn.c9)(ft),Ti=(0,Pn.wA)(mi),ni=Ti.type,wi=mi.bbox;let Mi=Ti.coordinates;if(wi&&pr(jt,wi)===!1)return!1;ni==="Polygon"&&(Mi=[Mi]);let Li=!1;for(var pt=0;pt<Mi.length;++pt){const St=Ei(jt,Mi[pt]);if(St===0)return!nt.ignoreBoundary;St&&(Li=!0)}return Li}function pr(ft,mi){return mi[0]<=ft[0]&&mi[1]<=ft[1]&&mi[2]>=ft[0]&&mi[3]>=ft[1]}var Er=null},45149:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{D:function(){return Pi}});var xe=Tt(55230);function Pi(xn,tn,ti={}){const $t=(0,xe.c9)(xn),et=(0,xe.r7)(tn);for(let yi=0;yi<et.length-1;yi++){let ct=!1;if(ti.ignoreEndVertices&&(yi===0&&(ct="start"),yi===et.length-2&&(ct="end"),yi===0&&yi+1===et.length-1&&(ct="both")),hn(et[yi],et[yi+1],$t,ct,typeof ti.epsilon=="undefined"?null:ti.epsilon))return!0}return!1}function hn(xn,tn,ti,$t,et){const yi=ti[0],ct=ti[1],Qt=xn[0],Ii=xn[1],Yi=tn[0],We=tn[1],ot=ti[0]-Qt,dt=ti[1]-Ii,vt=Yi-Qt,Be=We-Ii,Ie=ot*Be-dt*vt;if(et!==null){if(Math.abs(Ie)>et)return!1}else if(Ie!==0)return!1;if(Math.abs(vt)===Math.abs(Be)&&Math.abs(vt)===0)return $t?!1:ti[0]===xn[0]&&ti[1]===xn[1];if($t){if($t==="start")return Math.abs(vt)>=Math.abs(Be)?vt>0?Qt<yi&&yi<=Yi:Yi<=yi&&yi<Qt:Be>0?Ii<ct&&ct<=We:We<=ct&&ct<Ii;if($t==="end")return Math.abs(vt)>=Math.abs(Be)?vt>0?Qt<=yi&&yi<Yi:Yi<yi&&yi<=Qt:Be>0?Ii<=ct&&ct<We:We<ct&&ct<=Ii;if($t==="both")return Math.abs(vt)>=Math.abs(Be)?vt>0?Qt<yi&&yi<Yi:Yi<yi&&yi<Qt:Be>0?Ii<ct&&ct<We:We<ct&&ct<Ii}else return Math.abs(vt)>=Math.abs(Be)?vt>0?Qt<=yi&&yi<=Yi:Yi<=yi&&yi<=Qt:Be>0?Ii<=ct&&ct<=We:We<=ct&&ct<=Ii;return!1}var s=null},7219:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{F:function(){return xn}});var xe=Tt(5073),Pi=Tt(45149),hn=Tt(87123),s=Tt(55230);function xn(dt,vt){var Be=(0,s.wA)(dt),Ie=(0,s.wA)(vt),Ue=Be.type,qe=Ie.type;switch(Ue){case"Point":switch(qe){case"MultiPoint":return tn(Be,Ie);case"LineString":return(0,Pi.D)(Be,Ie,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return(0,hn.F)(Be,Ie,{ignoreBoundary:!0});default:throw new Error("feature2 "+qe+" geometry not supported")}case"MultiPoint":switch(qe){case"MultiPoint":return ti(Be,Ie);case"LineString":return $t(Be,Ie);case"Polygon":case"MultiPolygon":return et(Be,Ie);default:throw new Error("feature2 "+qe+" geometry not supported")}case"LineString":switch(qe){case"LineString":return yi(Be,Ie);case"Polygon":case"MultiPolygon":return ct(Be,Ie);default:throw new Error("feature2 "+qe+" geometry not supported")}case"Polygon":switch(qe){case"Polygon":case"MultiPolygon":return Qt(Be,Ie);default:throw new Error("feature2 "+qe+" geometry not supported")}default:throw new Error("feature1 "+Ue+" geometry not supported")}}function tn(dt,vt){var Be,Ie=!1;for(Be=0;Be<vt.coordinates.length;Be++)if(Yi(vt.coordinates[Be],dt.coordinates)){Ie=!0;break}return Ie}function ti(dt,vt){for(var Be=0;Be<dt.coordinates.length;Be++){for(var Ie=!1,Ue=0;Ue<vt.coordinates.length;Ue++)Yi(dt.coordinates[Be],vt.coordinates[Ue])&&(Ie=!0);if(!Ie)return!1}return!0}function $t(dt,vt){for(var Be=!1,Ie=0;Ie<dt.coordinates.length;Ie++){if(!(0,Pi.D)(dt.coordinates[Ie],vt))return!1;Be||(Be=(0,Pi.D)(dt.coordinates[Ie],vt,{ignoreEndVertices:!0}))}return Be}function et(dt,vt){for(var Be=!0,Ie=!1,Ue=!1,qe=0;qe<dt.coordinates.length;qe++){if(Ue=(0,hn.F)(dt.coordinates[qe],vt),!Ue){Be=!1;break}Ie||(Ue=(0,hn.F)(dt.coordinates[qe],vt,{ignoreBoundary:!0}))}return Be&&Ue}function yi(dt,vt){for(var Be=0;Be<dt.coordinates.length;Be++)if(!(0,Pi.D)(dt.coordinates[Be],vt))return!1;return!0}function ct(dt,vt){var Be=(0,xe.V)(vt),Ie=(0,xe.V)(dt);if(!Ii(Be,Ie))return!1;for(var Ue=!1,qe=0;qe<dt.coordinates.length;qe++){if(!(0,hn.F)(dt.coordinates[qe],vt))return!1;if(Ue||(Ue=(0,hn.F)(dt.coordinates[qe],vt,{ignoreBoundary:!0})),!Ue&&qe<dt.coordinates.length-1){var De=We(dt.coordinates[qe],dt.coordinates[qe+1]);Ue=(0,hn.F)(De,vt,{ignoreBoundary:!0})}}return Ue}function Qt(dt,vt){var Be=(0,xe.V)(dt),Ie=(0,xe.V)(vt);if(!Ii(Ie,Be))return!1;for(var Ue=0;Ue<dt.coordinates[0].length;Ue++)if(!(0,hn.F)(dt.coordinates[0][Ue],vt))return!1;return!0}function Ii(dt,vt){return!(dt[0]>vt[0]||dt[2]<vt[2]||dt[1]>vt[1]||dt[3]<vt[3])}function Yi(dt,vt){return dt[0]===vt[0]&&dt[1]===vt[1]}function We(dt,vt){return[(dt[0]+vt[0])/2,(dt[1]+vt[1])/2]}var ot=null},54315:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{f:function(){return Iu}});var xe=Tt(64030),Pi=Tt(31054),hn=Tt(59738);function s(){return new xn}function xn(){this.reset()}xn.prototype={constructor:xn,reset:function(){this.s=this.t=0},add:function(j){ti(tn,j,this.t),ti(this,tn.s,this.s),this.s?this.t+=tn.t:this.s=tn.t},valueOf:function(){return this.s}};var tn=new xn;function ti(j,Q,ae){var ge=j.s=Q+ae,Oe=ge-Q,rt=ge-Oe;j.t=Q-rt+(ae-Oe)}var $t=1e-6,et=1e-12,yi=Math.PI,ct=yi/2,Qt=yi/4,Ii=yi*2,Yi=180/yi,We=yi/180,ot=Math.abs,dt=Math.atan,vt=Math.atan2,Be=Math.cos,Ie=Math.ceil,Ue=Math.exp,qe=Math.floor,De=Math.log,je=Math.pow,Pt=Math.sin,ki=Math.sign||function(j){return j>0?1:j<0?-1:0},bi=Math.sqrt,ji=Math.tan;function hr(j){return j>1?0:j<-1?yi:Math.acos(j)}function Xn(j){return j>1?ct:j<-1?-ct:Math.asin(j)}function rn(j){return(j=Pt(j/2))*j}function Ot(){}function at(j,Q){j&&Qi.hasOwnProperty(j.type)&&Qi[j.type](j,Q)}var Ht={Feature:function(j,Q){at(j.geometry,Q)},FeatureCollection:function(j,Q){for(var ae=j.features,ge=-1,Oe=ae.length;++ge<Oe;)at(ae[ge].geometry,Q)}},Qi={Sphere:function(j,Q){Q.sphere()},Point:function(j,Q){j=j.coordinates,Q.point(j[0],j[1],j[2])},MultiPoint:function(j,Q){for(var ae=j.coordinates,ge=-1,Oe=ae.length;++ge<Oe;)j=ae[ge],Q.point(j[0],j[1],j[2])},LineString:function(j,Q){vi(j.coordinates,Q,0)},MultiLineString:function(j,Q){for(var ae=j.coordinates,ge=-1,Oe=ae.length;++ge<Oe;)vi(ae[ge],Q,0)},Polygon:function(j,Q){Mn(j.coordinates,Q)},MultiPolygon:function(j,Q){for(var ae=j.coordinates,ge=-1,Oe=ae.length;++ge<Oe;)Mn(ae[ge],Q)},GeometryCollection:function(j,Q){for(var ae=j.geometries,ge=-1,Oe=ae.length;++ge<Oe;)at(ae[ge],Q)}};function vi(j,Q,ae){var ge=-1,Oe=j.length-ae,rt;for(Q.lineStart();++ge<Oe;)rt=j[ge],Q.point(rt[0],rt[1],rt[2]);Q.lineEnd()}function Mn(j,Q){var ae=-1,ge=j.length;for(Q.polygonStart();++ae<ge;)vi(j[ae],Q,1);Q.polygonEnd()}function gr(j,Q){j&&Ht.hasOwnProperty(j.type)?Ht[j.type](j,Q):at(j,Q)}var Hn=s(),kr=s(),Dt,Ls,Pe,$n,lt,cs={point:Ot,lineStart:Ot,lineEnd:Ot,polygonStart:function(){Hn.reset(),cs.lineStart=Xi,cs.lineEnd=vs},polygonEnd:function(){var j=+Hn;kr.add(j<0?Ii+j:j),this.lineStart=this.lineEnd=this.point=Ot},sphere:function(){kr.add(Ii)}};function Xi(){cs.point=Bs}function vs(){Xs(Dt,Ls)}function Bs(j,Q){cs.point=Xs,Dt=j,Ls=Q,j*=We,Q*=We,Pe=j,$n=Be(Q=Q/2+Qt),lt=Pt(Q)}function Xs(j,Q){j*=We,Q*=We,Q=Q/2+Qt;var ae=j-Pe,ge=ae>=0?1:-1,Oe=ge*ae,rt=Be(Q),Rt=Pt(Q),gi=lt*Rt,Ni=$n*rt+gi*Be(Oe),qi=gi*ge*Pt(Oe);Hn.add(vt(qi,Ni)),Pe=j,$n=rt,lt=Rt}function Sr(j){return kr.reset(),stream(j,cs),kr*2}function un(j){return[vt(j[1],j[0]),Xn(j[2])]}function ys(j){var Q=j[0],ae=j[1],ge=Be(ae);return[ge*Be(Q),ge*Pt(Q),Pt(ae)]}function Hs(j,Q){return j[0]*Q[0]+j[1]*Q[1]+j[2]*Q[2]}function ls(j,Q){return[j[1]*Q[2]-j[2]*Q[1],j[2]*Q[0]-j[0]*Q[2],j[0]*Q[1]-j[1]*Q[0]]}function Rs(j,Q){j[0]+=Q[0],j[1]+=Q[1],j[2]+=Q[2]}function cn(j,Q){return[j[0]*Q,j[1]*Q,j[2]*Q]}function Jr(j){var Q=bi(j[0]*j[0]+j[1]*j[1]+j[2]*j[2]);j[0]/=Q,j[1]/=Q,j[2]/=Q}var Pr,Ts,Dn,xs,Gn,Ir,fo,ms,Co=s(),mr,Ss,ks={point:ur,lineStart:he,lineEnd:pe,polygonStart:function(){ks.point=Re,ks.lineStart=ke,ks.lineEnd=ui,Co.reset(),cs.polygonStart()},polygonEnd:function(){cs.polygonEnd(),ks.point=ur,ks.lineStart=he,ks.lineEnd=pe,Hn<0?(Pr=-(Dn=180),Ts=-(xs=90)):Co>$t?xs=90:Co<-$t&&(Ts=-90),Ss[0]=Pr,Ss[1]=Dn}};function ur(j,Q){mr.push(Ss=[Pr=j,Dn=j]),Q<Ts&&(Ts=Q),Q>xs&&(xs=Q)}function _e(j,Q){var ae=ys([j*We,Q*We]);if(ms){var ge=ls(ms,ae),Oe=[ge[1],-ge[0],0],rt=ls(Oe,ge);Jr(rt),rt=un(rt);var Rt=j-Gn,gi=Rt>0?1:-1,Ni=rt[0]*Yi*gi,qi,ii=ot(Rt)>180;ii^(gi*Gn<Ni&&Ni<gi*j)?(qi=rt[1]*Yi,qi>xs&&(xs=qi)):(Ni=(Ni+360)%360-180,ii^(gi*Gn<Ni&&Ni<gi*j)?(qi=-rt[1]*Yi,qi<Ts&&(Ts=qi)):(Q<Ts&&(Ts=Q),Q>xs&&(xs=Q))),ii?j<Gn?Vt(Pr,j)>Vt(Pr,Dn)&&(Dn=j):Vt(j,Dn)>Vt(Pr,Dn)&&(Pr=j):Dn>=Pr?(j<Pr&&(Pr=j),j>Dn&&(Dn=j)):j>Gn?Vt(Pr,j)>Vt(Pr,Dn)&&(Dn=j):Vt(j,Dn)>Vt(Pr,Dn)&&(Pr=j)}else mr.push(Ss=[Pr=j,Dn=j]);Q<Ts&&(Ts=Q),Q>xs&&(xs=Q),ms=ae,Gn=j}function he(){ks.point=_e}function pe(){Ss[0]=Pr,Ss[1]=Dn,ks.point=ur,ms=null}function Re(j,Q){if(ms){var ae=j-Gn;Co.add(ot(ae)>180?ae+(ae>0?360:-360):ae)}else Ir=j,fo=Q;cs.point(j,Q),_e(j,Q)}function ke(){cs.lineStart()}function ui(){Re(Ir,fo),cs.lineEnd(),ot(Co)>$t&&(Pr=-(Dn=180)),Ss[0]=Pr,Ss[1]=Dn,ms=null}function Vt(j,Q){return(Q-=j)<0?Q+360:Q}function fi(j,Q){return j[0]-Q[0]}function Zt(j,Q){return j[0]<=j[1]?j[0]<=Q&&Q<=j[1]:Q<j[0]||j[1]<Q}function en(j){var Q,ae,ge,Oe,rt,Rt,gi;if(xs=Dn=-(Pr=Ts=1/0),mr=[],stream(j,ks),ae=mr.length){for(mr.sort(fi),Q=1,ge=mr[0],rt=[ge];Q<ae;++Q)Oe=mr[Q],Zt(ge,Oe[0])||Zt(ge,Oe[1])?(Vt(ge[0],Oe[1])>Vt(ge[0],ge[1])&&(ge[1]=Oe[1]),Vt(Oe[0],ge[1])>Vt(ge[0],ge[1])&&(ge[0]=Oe[0])):rt.push(ge=Oe);for(Rt=-1/0,ae=rt.length-1,Q=0,ge=rt[ae];Q<=ae;ge=Oe,++Q)Oe=rt[Q],(gi=Vt(ge[1],Oe[0]))>Rt&&(Rt=gi,Pr=Oe[0],Dn=ge[1])}return mr=Ss=null,Pr===1/0||Ts===1/0?[[NaN,NaN],[NaN,NaN]]:[[Pr,Ts],[Dn,xs]]}var Un,Bn,Or,hs,Vs,qr,ds,gt,q,ee,oe,Ee,be,Ce,Y,K,se={sphere:Ot,point:fe,lineStart:Se,lineEnd:ut,polygonStart:function(){se.lineStart=Et,se.lineEnd=xt},polygonEnd:function(){se.lineStart=Se,se.lineEnd=ut}};function fe(j,Q){j*=We,Q*=We;var ae=Be(Q);ce(ae*Be(j),ae*Pt(j),Pt(Q))}function ce(j,Q,ae){++Un,Or+=(j-Or)/Un,hs+=(Q-hs)/Un,Vs+=(ae-Vs)/Un}function Se(){se.point=it}function it(j,Q){j*=We,Q*=We;var ae=Be(Q);Ce=ae*Be(j),Y=ae*Pt(j),K=Pt(Q),se.point=Ne,ce(Ce,Y,K)}function Ne(j,Q){j*=We,Q*=We;var ae=Be(Q),ge=ae*Be(j),Oe=ae*Pt(j),rt=Pt(Q),Rt=vt(bi((Rt=Y*rt-K*Oe)*Rt+(Rt=K*ge-Ce*rt)*Rt+(Rt=Ce*Oe-Y*ge)*Rt),Ce*ge+Y*Oe+K*rt);Bn+=Rt,qr+=Rt*(Ce+(Ce=ge)),ds+=Rt*(Y+(Y=Oe)),gt+=Rt*(K+(K=rt)),ce(Ce,Y,K)}function ut(){se.point=fe}function Et(){se.point=Xt}function xt(){vn(Ee,be),se.point=fe}function Xt(j,Q){Ee=j,be=Q,j*=We,Q*=We,se.point=vn;var ae=Be(Q);Ce=ae*Be(j),Y=ae*Pt(j),K=Pt(Q),ce(Ce,Y,K)}function vn(j,Q){j*=We,Q*=We;var ae=Be(Q),ge=ae*Be(j),Oe=ae*Pt(j),rt=Pt(Q),Rt=Y*rt-K*Oe,gi=K*ge-Ce*rt,Ni=Ce*Oe-Y*ge,qi=bi(Rt*Rt+gi*gi+Ni*Ni),ii=Xn(qi),Bi=qi&&-ii/qi;q+=Bi*Rt,ee+=Bi*gi,oe+=Bi*Ni,Bn+=ii,qr+=ii*(Ce+(Ce=ge)),ds+=ii*(Y+(Y=Oe)),gt+=ii*(K+(K=rt)),ce(Ce,Y,K)}function nn(j){Un=Bn=Or=hs=Vs=qr=ds=gt=q=ee=oe=0,stream(j,se);var Q=q,ae=ee,ge=oe,Oe=Q*Q+ae*ae+ge*ge;return Oe<epsilon2&&(Q=qr,ae=ds,ge=gt,Bn<epsilon&&(Q=Or,ae=hs,ge=Vs),Oe=Q*Q+ae*ae+ge*ge,Oe<epsilon2)?[NaN,NaN]:[atan2(ae,Q)*degrees,asin(ge/sqrt(Oe))*degrees]}function Tn(j,Q){function ae(ge,Oe){return ge=j(ge,Oe),Q(ge[0],ge[1])}return j.invert&&Q.invert&&(ae.invert=function(ge,Oe){return ge=Q.invert(ge,Oe),ge&&j.invert(ge[0],ge[1])}),ae}function Kn(j,Q){return[j>yi?j-Ii:j<-yi?j+Ii:j,Q]}Kn.invert=Kn;function dr(j,Q,ae){return(j%=Ii)?Q||ae?Tn(Hr(j),Mr(Q,ae)):Hr(j):Q||ae?Mr(Q,ae):Kn}function Vn(j){return function(Q,ae){return Q+=j,[Q>yi?Q-Ii:Q<-yi?Q+Ii:Q,ae]}}function Hr(j){var Q=Vn(j);return Q.invert=Vn(-j),Q}function Mr(j,Q){var ae=Be(j),ge=Pt(j),Oe=Be(Q),rt=Pt(Q);function Rt(gi,Ni){var qi=Be(Ni),ii=Be(gi)*qi,Bi=Pt(gi)*qi,xi=Pt(Ni),Ji=xi*ae+ii*ge;return[vt(Bi*Oe-Ji*rt,ii*ae-xi*ge),Xn(Ji*Oe+Bi*rt)]}return Rt.invert=function(gi,Ni){var qi=Be(Ni),ii=Be(gi)*qi,Bi=Pt(gi)*qi,xi=Pt(Ni),Ji=xi*Oe-Bi*rt;return[vt(Bi*Oe+xi*rt,ii*ae+Ji*ge),Xn(Ji*ae-ii*ge)]},Rt}function zs(j){j=dr(j[0]*radians,j[1]*radians,j.length>2?j[2]*radians:0);function Q(ae){return ae=j(ae[0]*radians,ae[1]*radians),ae[0]*=degrees,ae[1]*=degrees,ae}return Q.invert=function(ae){return ae=j.invert(ae[0]*radians,ae[1]*radians),ae[0]*=degrees,ae[1]*=degrees,ae},Q}function Qs(j,Q,ae,ge,Oe,rt){if(ae){var Rt=Be(Q),gi=Pt(Q),Ni=ge*ae;Oe==null?(Oe=Q+ge*Ii,rt=Q-Ni/2):(Oe=xo(Rt,Oe),rt=xo(Rt,rt),(ge>0?Oe<rt:Oe>rt)&&(Oe+=ge*Ii));for(var qi,ii=Oe;ge>0?ii>rt:ii<rt;ii-=Ni)qi=un([Rt,-gi*Be(ii),-gi*Pt(ii)]),j.point(qi[0],qi[1])}}function xo(j,Q){Q=ys(Q),Q[0]-=j,Jr(Q);var ae=hr(-Q[1]);return((-Q[2]<0?-ae:ae)+Ii-$t)%Ii}function bs(){var j=constant([0,0]),Q=constant(90),ae=constant(6),ge,Oe,rt={point:Rt};function Rt(Ni,qi){ge.push(Ni=Oe(Ni,qi)),Ni[0]*=degrees,Ni[1]*=degrees}function gi(){var Ni=j.apply(this,arguments),qi=Q.apply(this,arguments)*radians,ii=ae.apply(this,arguments)*radians;return ge=[],Oe=rotateRadians(-Ni[0]*radians,-Ni[1]*radians,0).invert,Qs(rt,qi,ii,1),Ni={type:"Polygon",coordinates:[ge]},ge=Oe=null,Ni}return gi.center=function(Ni){return arguments.length?(j=typeof Ni=="function"?Ni:constant([+Ni[0],+Ni[1]]),gi):j},gi.radius=function(Ni){return arguments.length?(Q=typeof Ni=="function"?Ni:constant(+Ni),gi):Q},gi.precision=function(Ni){return arguments.length?(ae=typeof Ni=="function"?Ni:constant(+Ni),gi):ae},gi}function to(){var j=[],Q;return{point:function(ae,ge){Q.push([ae,ge])},lineStart:function(){j.push(Q=[])},lineEnd:Ot,rejoin:function(){j.length>1&&j.push(j.pop().concat(j.shift()))},result:function(){var ae=j;return j=[],Q=null,ae}}}function rs(j,Q,ae,ge,Oe,rt){var Rt=j[0],gi=j[1],Ni=Q[0],qi=Q[1],ii=0,Bi=1,xi=Ni-Rt,Ji=qi-gi,pn;if(pn=ae-Rt,!(!xi&&pn>0)){if(pn/=xi,xi<0){if(pn<ii)return;pn<Bi&&(Bi=pn)}else if(xi>0){if(pn>Bi)return;pn>ii&&(ii=pn)}if(pn=Oe-Rt,!(!xi&&pn<0)){if(pn/=xi,xi<0){if(pn>Bi)return;pn>ii&&(ii=pn)}else if(xi>0){if(pn<ii)return;pn<Bi&&(Bi=pn)}if(pn=ge-gi,!(!Ji&&pn>0)){if(pn/=Ji,Ji<0){if(pn<ii)return;pn<Bi&&(Bi=pn)}else if(Ji>0){if(pn>Bi)return;pn>ii&&(ii=pn)}if(pn=rt-gi,!(!Ji&&pn<0)){if(pn/=Ji,Ji<0){if(pn>Bi)return;pn>ii&&(ii=pn)}else if(Ji>0){if(pn<ii)return;pn<Bi&&(Bi=pn)}return ii>0&&(j[0]=Rt+ii*xi,j[1]=gi+ii*Ji),Bi<1&&(Q[0]=Rt+Bi*xi,Q[1]=gi+Bi*Ji),!0}}}}}function ws(j,Q){return ot(j[0]-Q[0])<$t&&ot(j[1]-Q[1])<$t}function Qr(j,Q,ae,ge){this.x=j,this.z=Q,this.o=ae,this.e=ge,this.v=!1,this.n=this.p=null}function Ho(j,Q,ae,ge,Oe){var rt=[],Rt=[],gi,Ni;if(j.forEach(function(pn){if(!((Zn=pn.length-1)<=0)){var Zn,vr=pn[0],Lr=pn[Zn],Ar;if(ws(vr,Lr)){for(Oe.lineStart(),gi=0;gi<Zn;++gi)Oe.point((vr=pn[gi])[0],vr[1]);Oe.lineEnd();return}rt.push(Ar=new Qr(vr,pn,null,!0)),Rt.push(Ar.o=new Qr(vr,null,Ar,!1)),rt.push(Ar=new Qr(Lr,pn,null,!1)),Rt.push(Ar.o=new Qr(Lr,null,Ar,!0))}}),!!rt.length){for(Rt.sort(Q),io(rt),io(Rt),gi=0,Ni=Rt.length;gi<Ni;++gi)Rt[gi].e=ae=!ae;for(var qi=rt[0],ii,Bi;;){for(var xi=qi,Ji=!0;xi.v;)if((xi=xi.n)===qi)return;ii=xi.z,Oe.lineStart();do{if(xi.v=xi.o.v=!0,xi.e){if(Ji)for(gi=0,Ni=ii.length;gi<Ni;++gi)Oe.point((Bi=ii[gi])[0],Bi[1]);else ge(xi.x,xi.n.x,1,Oe);xi=xi.n}else{if(Ji)for(ii=xi.p.z,gi=ii.length-1;gi>=0;--gi)Oe.point((Bi=ii[gi])[0],Bi[1]);else ge(xi.x,xi.p.x,-1,Oe);xi=xi.p}xi=xi.o,ii=xi.z,Ji=!Ji}while(!xi.v);Oe.lineEnd()}}}function io(j){if(Q=j.length){for(var Q,ae=0,ge=j[0],Oe;++ae<Q;)ge.n=Oe=j[ae],Oe.p=ge,ge=Oe;ge.n=Oe=j[0],Oe.p=ge}}function ao(j,Q){return j<Q?-1:j>Q?1:j>=Q?0:NaN}function Po(j){return j.length===1&&(j=Zo(j)),{left:function(Q,ae,ge,Oe){for(ge==null&&(ge=0),Oe==null&&(Oe=Q.length);ge<Oe;){var rt=ge+Oe>>>1;j(Q[rt],ae)<0?ge=rt+1:Oe=rt}return ge},right:function(Q,ae,ge,Oe){for(ge==null&&(ge=0),Oe==null&&(Oe=Q.length);ge<Oe;){var rt=ge+Oe>>>1;j(Q[rt],ae)>0?Oe=rt:ge=rt+1}return ge}}}function Zo(j){return function(Q,ae){return ao(j(Q),ae)}}var bo=Po(ao),Oo=bo.right,wo=bo.left,ma=null,Yo=Array.prototype,sa=Yo.slice,la=Yo.map,Is=Math.sqrt(50),D=Math.sqrt(10),W=Math.sqrt(2);function Ge(j,Q,ae){var ge,Oe=-1,rt,Rt,gi;if(Q=+Q,j=+j,ae=+ae,j===Q&&ae>0)return[j];if((ge=Q<j)&&(rt=j,j=Q,Q=rt),(gi=Ye(j,Q,ae))===0||!isFinite(gi))return[];if(gi>0)for(j=Math.ceil(j/gi),Q=Math.floor(Q/gi),Rt=new Array(rt=Math.ceil(Q-j+1));++Oe<rt;)Rt[Oe]=(j+Oe)*gi;else for(j=Math.floor(j*gi),Q=Math.ceil(Q*gi),Rt=new Array(rt=Math.ceil(j-Q+1));++Oe<rt;)Rt[Oe]=(j-Oe)/gi;return ge&&Rt.reverse(),Rt}function Ye(j,Q,ae){var ge=(Q-j)/Math.max(0,ae),Oe=Math.floor(Math.log(ge)/Math.LN10),rt=ge/Math.pow(10,Oe);return Oe>=0?(rt>=Is?10:rt>=D?5:rt>=W?2:1)*Math.pow(10,Oe):-Math.pow(10,-Oe)/(rt>=Is?10:rt>=D?5:rt>=W?2:1)}function Bt(j,Q,ae){var ge=Math.abs(Q-j)/Math.max(0,ae),Oe=Math.pow(10,Math.floor(Math.log(ge)/Math.LN10)),rt=ge/Oe;return rt>=Is?Oe*=10:rt>=D?Oe*=5:rt>=W&&(Oe*=2),Q<j?-Oe:Oe}function Ei(){var j=identity,Q=extent,ae=sturges;function ge(Oe){var rt,Rt=Oe.length,gi,Ni=new Array(Rt);for(rt=0;rt<Rt;++rt)Ni[rt]=j(Oe[rt],rt,Oe);var qi=Q(Ni),ii=qi[0],Bi=qi[1],xi=ae(Ni,ii,Bi);Array.isArray(xi)||(xi=tickStep(ii,Bi,xi),xi=range(Math.ceil(ii/xi)*xi,Bi,xi));for(var Ji=xi.length;xi[0]<=ii;)xi.shift(),--Ji;for(;xi[Ji-1]>Bi;)xi.pop(),--Ji;var pn=new Array(Ji+1),Zn;for(rt=0;rt<=Ji;++rt)Zn=pn[rt]=[],Zn.x0=rt>0?xi[rt-1]:ii,Zn.x1=rt<Ji?xi[rt]:Bi;for(rt=0;rt<Rt;++rt)gi=Ni[rt],ii<=gi&&gi<=Bi&&pn[bisect(xi,gi,0,Ji)].push(Oe[rt]);return pn}return ge.value=function(Oe){return arguments.length?(j=typeof Oe=="function"?Oe:constant(Oe),ge):j},ge.domain=function(Oe){return arguments.length?(Q=typeof Oe=="function"?Oe:constant([Oe[0],Oe[1]]),ge):Q},ge.thresholds=function(Oe){return arguments.length?(ae=typeof Oe=="function"?Oe:Array.isArray(Oe)?constant(slice.call(Oe)):constant(Oe),ge):ae},ge}function Pn(j,Q,ae){return j=map.call(j,number).sort(ascending),Math.ceil((ae-Q)/(2*(quantile(j,.75)-quantile(j,.25))*Math.pow(j.length,-1/3)))}function yn(j){for(var Q=j.length,ae,ge=-1,Oe=0,rt,Rt;++ge<Q;)Oe+=j[ge].length;for(rt=new Array(Oe);--Q>=0;)for(Rt=j[Q],ae=Rt.length;--ae>=0;)rt[--Oe]=Rt[ae];return rt}var pr=1e9,Er=-pr;function ft(j,Q,ae,ge){function Oe(qi,ii){return j<=qi&&qi<=ae&&Q<=ii&&ii<=ge}function rt(qi,ii,Bi,xi){var Ji=0,pn=0;if(qi==null||(Ji=Rt(qi,Bi))!==(pn=Rt(ii,Bi))||Ni(qi,ii)<0^Bi>0)do xi.point(Ji===0||Ji===3?j:ae,Ji>1?ge:Q);while((Ji=(Ji+Bi+4)%4)!==pn);else xi.point(ii[0],ii[1])}function Rt(qi,ii){return ot(qi[0]-j)<$t?ii>0?0:3:ot(qi[0]-ae)<$t?ii>0?2:1:ot(qi[1]-Q)<$t?ii>0?1:0:ii>0?3:2}function gi(qi,ii){return Ni(qi.x,ii.x)}function Ni(qi,ii){var Bi=Rt(qi,1),xi=Rt(ii,1);return Bi!==xi?Bi-xi:Bi===0?ii[1]-qi[1]:Bi===1?qi[0]-ii[0]:Bi===2?qi[1]-ii[1]:ii[0]-qi[0]}return function(qi){var ii=qi,Bi=to(),xi,Ji,pn,Zn,vr,Lr,Ar,er,es,Zs,Vr,fs={point:us,lineStart:Do,lineEnd:zo,polygonStart:To,polygonEnd:co};function us(on,no){Oe(on,no)&&ii.point(on,no)}function is(){for(var on=0,no=0,jo=Ji.length;no<jo;++no)for(var No=Ji[no],Ko=1,jn=No.length,Da=No[0],Rl,el,kl=Da[0],pl=Da[1];Ko<jn;++Ko)Rl=kl,el=pl,Da=No[Ko],kl=Da[0],pl=Da[1],el<=ge?pl>ge&&(kl-Rl)*(ge-el)>(pl-el)*(j-Rl)&&++on:pl<=ge&&(kl-Rl)*(ge-el)<(pl-el)*(j-Rl)&&--on;return on}function To(){ii=Bi,xi=[],Ji=[],Vr=!0}function co(){var on=is(),no=Vr&&on,jo=(xi=yn(xi)).length;(no||jo)&&(qi.polygonStart(),no&&(qi.lineStart(),rt(null,null,1,qi),qi.lineEnd()),jo&&Ho(xi,gi,on,rt,qi),qi.polygonEnd()),ii=qi,xi=Ji=pn=null}function Do(){fs.point=_r,Ji&&Ji.push(pn=[]),Zs=!0,es=!1,Ar=er=NaN}function zo(){xi&&(_r(Zn,vr),Lr&&es&&Bi.rejoin(),xi.push(Bi.result())),fs.point=us,es&&ii.lineEnd()}function _r(on,no){var jo=Oe(on,no);if(Ji&&pn.push([on,no]),Zs)Zn=on,vr=no,Lr=jo,Zs=!1,jo&&(ii.lineStart(),ii.point(on,no));else if(jo&&es)ii.point(on,no);else{var No=[Ar=Math.max(Er,Math.min(pr,Ar)),er=Math.max(Er,Math.min(pr,er))],Ko=[on=Math.max(Er,Math.min(pr,on)),no=Math.max(Er,Math.min(pr,no))];rs(No,Ko,j,Q,ae,ge)?(es||(ii.lineStart(),ii.point(No[0],No[1])),ii.point(Ko[0],Ko[1]),jo||ii.lineEnd(),Vr=!1):jo&&(ii.lineStart(),ii.point(on,no),Vr=!1)}Ar=on,er=no,es=jo}return fs}}function mi(){var j=0,Q=0,ae=960,ge=500,Oe,rt,Rt;return Rt={stream:function(gi){return Oe&&rt===gi?Oe:Oe=ft(j,Q,ae,ge)(rt=gi)},extent:function(gi){return arguments.length?(j=+gi[0][0],Q=+gi[0][1],ae=+gi[1][0],ge=+gi[1][1],Oe=rt=null,Rt):[[j,Q],[ae,ge]]}}}var nt=s();function jt(j,Q){var ae=Q[0],ge=Q[1],Oe=[Pt(ae),-Be(ae),0],rt=0,Rt=0;nt.reset();for(var gi=0,Ni=j.length;gi<Ni;++gi)if(ii=(qi=j[gi]).length)for(var qi,ii,Bi=qi[ii-1],xi=Bi[0],Ji=Bi[1]/2+Qt,pn=Pt(Ji),Zn=Be(Ji),vr=0;vr<ii;++vr,xi=Ar,pn=es,Zn=Zs,Bi=Lr){var Lr=qi[vr],Ar=Lr[0],er=Lr[1]/2+Qt,es=Pt(er),Zs=Be(er),Vr=Ar-xi,fs=Vr>=0?1:-1,us=fs*Vr,is=us>yi,To=pn*es;if(nt.add(vt(To*fs*Pt(us),Zn*Zs+To*Be(us))),rt+=is?Vr+fs*Ii:Vr,is^xi>=ae^Ar>=ae){var co=ls(ys(Bi),ys(Lr));Jr(co);var Do=ls(Oe,co);Jr(Do);var zo=(is^Vr>=0?-1:1)*Xn(Do[2]);(ge>zo||ge===zo&&(co[0]||co[1]))&&(Rt+=is^Vr>=0?1:-1)}}return(rt<-$t||rt<$t&&nt<-$t)^Rt&1}var Ti=s(),ni,wi,Mi,Li={sphere:Ot,point:Ot,lineStart:pt,lineEnd:Ot,polygonStart:Ot,polygonEnd:Ot};function pt(){Li.point=zt,Li.lineEnd=St}function St(){Li.point=Li.lineEnd=Ot}function zt(j,Q){j*=We,Q*=We,ni=j,wi=Pt(Q),Mi=Be(Q),Li.point=At}function At(j,Q){j*=We,Q*=We;var ae=Pt(Q),ge=Be(Q),Oe=ot(j-ni),rt=Be(Oe),Rt=Pt(Oe),gi=ge*Rt,Ni=Mi*ae-wi*ge*rt,qi=wi*ae+Mi*ge*rt;Ti.add(vt(bi(gi*gi+Ni*Ni),qi)),ni=j,wi=ae,Mi=ge}function kt(j){return Ti.reset(),gr(j,Li),+Ti}var Ci=[null,null],Ke={type:"LineString",coordinates:Ci};function It(j,Q){return Ci[0]=j,Ci[1]=Q,kt(Ke)}var Nt={Feature:function(j,Q){return oi(j.geometry,Q)},FeatureCollection:function(j,Q){for(var ae=j.features,ge=-1,Oe=ae.length;++ge<Oe;)if(oi(ae[ge].geometry,Q))return!0;return!1}},ci={Sphere:function(){return!0},Point:function(j,Q){return Ki(j.coordinates,Q)},MultiPoint:function(j,Q){for(var ae=j.coordinates,ge=-1,Oe=ae.length;++ge<Oe;)if(Ki(ae[ge],Q))return!0;return!1},LineString:function(j,Q){return si(j.coordinates,Q)},MultiLineString:function(j,Q){for(var ae=j.coordinates,ge=-1,Oe=ae.length;++ge<Oe;)if(si(ae[ge],Q))return!0;return!1},Polygon:function(j,Q){return Di(j.coordinates,Q)},MultiPolygon:function(j,Q){for(var ae=j.coordinates,ge=-1,Oe=ae.length;++ge<Oe;)if(Di(ae[ge],Q))return!0;return!1},GeometryCollection:function(j,Q){for(var ae=j.geometries,ge=-1,Oe=ae.length;++ge<Oe;)if(oi(ae[ge],Q))return!0;return!1}};function oi(j,Q){return j&&ci.hasOwnProperty(j.type)?ci[j.type](j,Q):!1}function Ki(j,Q){return It(j,Q)===0}function si(j,Q){var ae=It(j[0],j[1]),ge=It(j[0],Q),Oe=It(Q,j[1]);return ge+Oe<=ae+$t}function Di(j,Q){return!!jt(j.map(li),Oi(Q))}function li(j){return j=j.map(Oi),j.pop(),j}function Oi(j){return[j[0]*We,j[1]*We]}function Hi(j,Q){return(j&&Nt.hasOwnProperty(j.type)?Nt[j.type]:oi)(j,Q)}function Sn(j,Q,ae){var ge=range(j,Q-epsilon,ae).concat(Q);return function(Oe){return ge.map(function(rt){return[Oe,rt]})}}function On(j,Q,ae){var ge=range(j,Q-epsilon,ae).concat(Q);return function(Oe){return ge.map(function(rt){return[rt,Oe]})}}function An(){var j,Q,ae,ge,Oe,rt,Rt,gi,Ni=10,qi=Ni,ii=90,Bi=360,xi,Ji,pn,Zn,vr=2.5;function Lr(){return{type:"MultiLineString",coordinates:Ar()}}function Ar(){return range(ceil(ge/ii)*ii,ae,ii).map(pn).concat(range(ceil(gi/Bi)*Bi,Rt,Bi).map(Zn)).concat(range(ceil(Q/Ni)*Ni,j,Ni).filter(function(er){return abs(er%ii)>epsilon}).map(xi)).concat(range(ceil(rt/qi)*qi,Oe,qi).filter(function(er){return abs(er%Bi)>epsilon}).map(Ji))}return Lr.lines=function(){return Ar().map(function(er){return{type:"LineString",coordinates:er}})},Lr.outline=function(){return{type:"Polygon",coordinates:[pn(ge).concat(Zn(Rt).slice(1),pn(ae).reverse().slice(1),Zn(gi).reverse().slice(1))]}},Lr.extent=function(er){return arguments.length?Lr.extentMajor(er).extentMinor(er):Lr.extentMinor()},Lr.extentMajor=function(er){return arguments.length?(ge=+er[0][0],ae=+er[1][0],gi=+er[0][1],Rt=+er[1][1],ge>ae&&(er=ge,ge=ae,ae=er),gi>Rt&&(er=gi,gi=Rt,Rt=er),Lr.precision(vr)):[[ge,gi],[ae,Rt]]},Lr.extentMinor=function(er){return arguments.length?(Q=+er[0][0],j=+er[1][0],rt=+er[0][1],Oe=+er[1][1],Q>j&&(er=Q,Q=j,j=er),rt>Oe&&(er=rt,rt=Oe,Oe=er),Lr.precision(vr)):[[Q,rt],[j,Oe]]},Lr.step=function(er){return arguments.length?Lr.stepMajor(er).stepMinor(er):Lr.stepMinor()},Lr.stepMajor=function(er){return arguments.length?(ii=+er[0],Bi=+er[1],Lr):[ii,Bi]},Lr.stepMinor=function(er){return arguments.length?(Ni=+er[0],qi=+er[1],Lr):[Ni,qi]},Lr.precision=function(er){return arguments.length?(vr=+er,xi=Sn(rt,Oe,90),Ji=On(Q,j,vr),pn=Sn(gi,Rt,90),Zn=On(ge,ae,vr),Lr):vr},Lr.extentMajor([[-180,-90+epsilon],[180,90-epsilon]]).extentMinor([[-180,-80-epsilon],[180,80+epsilon]])}function fr(){return An()()}function mt(j,Q){var ae=j[0]*radians,ge=j[1]*radians,Oe=Q[0]*radians,rt=Q[1]*radians,Rt=cos(ge),gi=sin(ge),Ni=cos(rt),qi=sin(rt),ii=Rt*cos(ae),Bi=Rt*sin(ae),xi=Ni*cos(Oe),Ji=Ni*sin(Oe),pn=2*asin(sqrt(haversin(rt-ge)+Rt*Ni*haversin(Oe-ae))),Zn=sin(pn),vr=pn?function(Lr){var Ar=sin(Lr*=pn)/Zn,er=sin(pn-Lr)/Zn,es=er*ii+Ar*xi,Zs=er*Bi+Ar*Ji,Vr=er*gi+Ar*qi;return[atan2(Zs,es)*degrees,atan2(Vr,sqrt(es*es+Zs*Zs))*degrees]}:function(){return[ae*degrees,ge*degrees]};return vr.distance=pn,vr}var Wt=s(),hi=s(),ln,bt,qt,Lt,Ai={point:Ot,lineStart:Ot,lineEnd:Ot,polygonStart:function(){Ai.lineStart=Zi,Ai.lineEnd=gn},polygonEnd:function(){Ai.lineStart=Ai.lineEnd=Ai.point=Ot,Wt.add(ot(hi)),hi.reset()},result:function(){var j=Wt/2;return Wt.reset(),j}};function Zi(){Ai.point=Gi}function Gi(j,Q){Ai.point=Vi,ln=qt=j,bt=Lt=Q}function Vi(j,Q){hi.add(Lt*j-qt*Q),qt=j,Lt=Q}function gn(){Vi(ln,bt)}var Nn=null,sn=1/0,nr=sn,Fn=-sn,or=Fn,rr={point:tr,lineStart:Ot,lineEnd:Ot,polygonStart:Ot,polygonEnd:Ot,result:function(){var j=[[sn,nr],[Fn,or]];return Fn=or=-(nr=sn=1/0),j}};function tr(j,Q){j<sn&&(sn=j),j>Fn&&(Fn=j),Q<nr&&(nr=Q),Q>or&&(or=Q)}var yr=rr,Wr=0,ss=0,Br=0,Gr=0,Ms=0,Os=0,cr=0,Ln=0,$s=0,ar,po,lo,Qn,Lo={point:Go,lineStart:Aa,lineEnd:Eo,polygonStart:function(){Lo.lineStart=mn,Lo.lineEnd=ol},polygonEnd:function(){Lo.point=Go,Lo.lineStart=Aa,Lo.lineEnd=Eo},result:function(){var j=$s?[cr/$s,Ln/$s]:Os?[Gr/Os,Ms/Os]:Br?[Wr/Br,ss/Br]:[NaN,NaN];return Wr=ss=Br=Gr=Ms=Os=cr=Ln=$s=0,j}};function Go(j,Q){Wr+=j,ss+=Q,++Br}function Aa(){Lo.point=Ca}function Ca(j,Q){Lo.point=Ro,Go(lo=j,Qn=Q)}function Ro(j,Q){var ae=j-lo,ge=Q-Qn,Oe=bi(ae*ae+ge*ge);Gr+=Oe*(lo+j)/2,Ms+=Oe*(Qn+Q)/2,Os+=Oe,Go(lo=j,Qn=Q)}function Eo(){Lo.point=Go}function mn(){Lo.point=$a}function ol(){Pa(ar,po)}function $a(j,Q){Lo.point=Pa,Go(ar=lo=j,po=Qn=Q)}function Pa(j,Q){var ae=j-lo,ge=Q-Qn,Oe=bi(ae*ae+ge*ge);Gr+=Oe*(lo+j)/2,Ms+=Oe*(Qn+Q)/2,Os+=Oe,Oe=Qn*j-lo*Q,cr+=Oe*(lo+j),Ln+=Oe*(Qn+Q),$s+=Oe*3,Go(lo=j,Qn=Q)}var La=null;function _o(j){this._context=j}_o.prototype={_radius:4.5,pointRadius:function(j){return this._radius=j,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(j,Q){switch(this._point){case 0:{this._context.moveTo(j,Q),this._point=1;break}case 1:{this._context.lineTo(j,Q);break}default:{this._context.moveTo(j+this._radius,Q),this._context.arc(j,Q,this._radius,0,Ii);break}}},result:Ot};var Qo=s(),Wa,va,xa,ua,Ns,wa={point:Ot,lineStart:function(){wa.point=Il},lineEnd:function(){Wa&&Ml(va,xa),wa.point=Ot},polygonStart:function(){Wa=!0},polygonEnd:function(){Wa=null},result:function(){var j=+Qo;return Qo.reset(),j}};function Il(j,Q){wa.point=Ml,va=ua=j,xa=Ns=Q}function Ml(j,Q){ua-=j,Ns-=Q,Qo.add(bi(ua*ua+Ns*Ns)),ua=j,Ns=Q}var oa=null;function ea(){this._string=[]}ea.prototype={_radius:4.5,_circle:v(4.5),pointRadius:function(j){return(j=+j)!==this._radius&&(this._radius=j,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(j,Q){switch(this._point){case 0:{this._string.push("M",j,",",Q),this._point=1;break}case 1:{this._string.push("L",j,",",Q);break}default:{this._circle==null&&(this._circle=v(this._radius)),this._string.push("M",j,",",Q,this._circle);break}}},result:function(){if(this._string.length){var j=this._string.join("");return this._string=[],j}else return null}};function v(j){return"m0,"+j+"a"+j+","+j+" 0 1,1 0,"+-2*j+"a"+j+","+j+" 0 1,1 0,"+2*j+"z"}function c(j,Q){var ae=4.5,ge,Oe;function rt(Rt){return Rt&&(typeof ae=="function"&&Oe.pointRadius(+ae.apply(this,arguments)),stream(Rt,ge(Oe))),Oe.result()}return rt.area=function(Rt){return stream(Rt,ge(pathArea)),pathArea.result()},rt.measure=function(Rt){return stream(Rt,ge(pathMeasure)),pathMeasure.result()},rt.bounds=function(Rt){return stream(Rt,ge(pathBounds)),pathBounds.result()},rt.centroid=function(Rt){return stream(Rt,ge(pathCentroid)),pathCentroid.result()},rt.projection=function(Rt){return arguments.length?(ge=Rt==null?(j=null,identity):(j=Rt).stream,rt):j},rt.context=function(Rt){return arguments.length?(Oe=Rt==null?(Q=null,new PathString):new PathContext(Q=Rt),typeof ae!="function"&&Oe.pointRadius(ae),rt):Q},rt.pointRadius=function(Rt){return arguments.length?(ae=typeof Rt=="function"?Rt:(Oe.pointRadius(+Rt),+Rt),rt):ae},rt.projection(j).context(Q)}function f(j,Q,ae,ge){return function(Oe,rt){var Rt=Q(rt),gi=Oe.invert(ge[0],ge[1]),Ni=to(),qi=Q(Ni),ii=!1,Bi,xi,Ji,pn={point:Zn,lineStart:Lr,lineEnd:Ar,polygonStart:function(){pn.point=er,pn.lineStart=es,pn.lineEnd=Zs,xi=[],Bi=[]},polygonEnd:function(){pn.point=Zn,pn.lineStart=Lr,pn.lineEnd=Ar,xi=yn(xi);var Vr=jt(Bi,gi);xi.length?(ii||(rt.polygonStart(),ii=!0),Ho(xi,P,Vr,ae,rt)):Vr&&(ii||(rt.polygonStart(),ii=!0),rt.lineStart(),ae(null,null,1,rt),rt.lineEnd()),ii&&(rt.polygonEnd(),ii=!1),xi=Bi=null},sphere:function(){rt.polygonStart(),rt.lineStart(),ae(null,null,1,rt),rt.lineEnd(),rt.polygonEnd()}};function Zn(Vr,fs){var us=Oe(Vr,fs);j(Vr=us[0],fs=us[1])&&rt.point(Vr,fs)}function vr(Vr,fs){var us=Oe(Vr,fs);Rt.point(us[0],us[1])}function Lr(){pn.point=vr,Rt.lineStart()}function Ar(){pn.point=Zn,Rt.lineEnd()}function er(Vr,fs){Ji.push([Vr,fs]);var us=Oe(Vr,fs);qi.point(us[0],us[1])}function es(){qi.lineStart(),Ji=[]}function Zs(){er(Ji[0][0],Ji[0][1]),qi.lineEnd();var Vr=qi.clean(),fs=Ni.result(),us,is=fs.length,To,co,Do;if(Ji.pop(),Bi.push(Ji),Ji=null,!!is){if(Vr&1){if(co=fs[0],(To=co.length-1)>0){for(ii||(rt.polygonStart(),ii=!0),rt.lineStart(),us=0;us<To;++us)rt.point((Do=co[us])[0],Do[1]);rt.lineEnd()}return}is>1&&Vr&2&&fs.push(fs.pop().concat(fs.shift())),xi.push(fs.filter(y))}}return pn}}function y(j){return j.length>1}function P(j,Q){return((j=j.x)[0]<0?j[1]-ct-$t:ct-j[1])-((Q=Q.x)[0]<0?Q[1]-ct-$t:ct-Q[1])}var F=f(function(){return!0},Z,Te,[-yi,-ct]);function Z(j){var Q=NaN,ae=NaN,ge=NaN,Oe;return{lineStart:function(){j.lineStart(),Oe=1},point:function(rt,Rt){var gi=rt>0?yi:-yi,Ni=ot(rt-Q);ot(Ni-yi)<$t?(j.point(Q,ae=(ae+Rt)/2>0?ct:-ct),j.point(ge,ae),j.lineEnd(),j.lineStart(),j.point(gi,ae),j.point(rt,ae),Oe=0):ge!==gi&&Ni>=yi&&(ot(Q-ge)<$t&&(Q-=ge*$t),ot(rt-gi)<$t&&(rt-=gi*$t),ae=re(Q,ae,rt,Rt),j.point(ge,ae),j.lineEnd(),j.lineStart(),j.point(gi,ae),Oe=0),j.point(Q=rt,ae=Rt),ge=gi},lineEnd:function(){j.lineEnd(),Q=ae=NaN},clean:function(){return 2-Oe}}}function re(j,Q,ae,ge){var Oe,rt,Rt=Pt(j-ae);return ot(Rt)>$t?dt((Pt(Q)*(rt=Be(ge))*Pt(ae)-Pt(ge)*(Oe=Be(Q))*Pt(j))/(Oe*rt*Rt)):(Q+ge)/2}function Te(j,Q,ae,ge){var Oe;if(j==null)Oe=ae*ct,ge.point(-yi,Oe),ge.point(0,Oe),ge.point(yi,Oe),ge.point(yi,0),ge.point(yi,-Oe),ge.point(0,-Oe),ge.point(-yi,-Oe),ge.point(-yi,0),ge.point(-yi,Oe);else if(ot(j[0]-Q[0])>$t){var rt=j[0]<Q[0]?yi:-yi;Oe=ae*rt/2,ge.point(-rt,Oe),ge.point(0,Oe),ge.point(rt,Oe)}else ge.point(Q[0],Q[1])}function Xe(j,Q){var ae=Be(j),ge=ae>0,Oe=ot(ae)>$t;function rt(ii,Bi,xi,Ji){Qs(Ji,j,Q,xi,ii,Bi)}function Rt(ii,Bi){return Be(ii)*Be(Bi)>ae}function gi(ii){var Bi,xi,Ji,pn,Zn;return{lineStart:function(){pn=Ji=!1,Zn=1},point:function(vr,Lr){var Ar=[vr,Lr],er,es=Rt(vr,Lr),Zs=ge?es?0:qi(vr,Lr):es?qi(vr+(vr<0?yi:-yi),Lr):0;if(!Bi&&(pn=Ji=es)&&ii.lineStart(),es!==Ji&&(er=Ni(Bi,Ar),(!er||ws(Bi,er)||ws(Ar,er))&&(Ar[0]+=$t,Ar[1]+=$t,es=Rt(Ar[0],Ar[1]))),es!==Ji)Zn=0,es?(ii.lineStart(),er=Ni(Ar,Bi),ii.point(er[0],er[1])):(er=Ni(Bi,Ar),ii.point(er[0],er[1]),ii.lineEnd()),Bi=er;else if(Oe&&Bi&&ge^es){var Vr;!(Zs&xi)&&(Vr=Ni(Ar,Bi,!0))&&(Zn=0,ge?(ii.lineStart(),ii.point(Vr[0][0],Vr[0][1]),ii.point(Vr[1][0],Vr[1][1]),ii.lineEnd()):(ii.point(Vr[1][0],Vr[1][1]),ii.lineEnd(),ii.lineStart(),ii.point(Vr[0][0],Vr[0][1])))}es&&(!Bi||!ws(Bi,Ar))&&ii.point(Ar[0],Ar[1]),Bi=Ar,Ji=es,xi=Zs},lineEnd:function(){Ji&&ii.lineEnd(),Bi=null},clean:function(){return Zn|(pn&&Ji)<<1}}}function Ni(ii,Bi,xi){var Ji=ys(ii),pn=ys(Bi),Zn=[1,0,0],vr=ls(Ji,pn),Lr=Hs(vr,vr),Ar=vr[0],er=Lr-Ar*Ar;if(!er)return!xi&&ii;var es=ae*Lr/er,Zs=-ae*Ar/er,Vr=ls(Zn,vr),fs=cn(Zn,es),us=cn(vr,Zs);Rs(fs,us);var is=Vr,To=Hs(fs,is),co=Hs(is,is),Do=To*To-co*(Hs(fs,fs)-1);if(!(Do<0)){var zo=bi(Do),_r=cn(is,(-To-zo)/co);if(Rs(_r,fs),_r=un(_r),!xi)return _r;var on=ii[0],no=Bi[0],jo=ii[1],No=Bi[1],Ko;no<on&&(Ko=on,on=no,no=Ko);var jn=no-on,Da=ot(jn-yi)<$t,Rl=Da||jn<$t;if(!Da&&No<jo&&(Ko=jo,jo=No,No=Ko),Rl?Da?jo+No>0^_r[1]<(ot(_r[0]-on)<$t?jo:No):jo<=_r[1]&&_r[1]<=No:jn>yi^(on<=_r[0]&&_r[0]<=no)){var el=cn(is,(-To+zo)/co);return Rs(el,fs),[_r,un(el)]}}}function qi(ii,Bi){var xi=ge?j:yi-j,Ji=0;return ii<-xi?Ji|=1:ii>xi&&(Ji|=2),Bi<-xi?Ji|=4:Bi>xi&&(Ji|=8),Ji}return f(Rt,gi,rt,ge?[0,-j]:[-yi,j-yi])}function Yt(j){return j}function Si(j){return{stream:bn(j)}}function bn(j){return function(Q){var ae=new Jn;for(var ge in j)ae[ge]=j[ge];return ae.stream=Q,ae}}function Jn(){}Jn.prototype={constructor:Jn,point:function(j,Q){this.stream.point(j,Q)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function br(j,Q,ae){var ge=Q[1][0]-Q[0][0],Oe=Q[1][1]-Q[0][1],rt=j.clipExtent&&j.clipExtent();j.scale(150).translate([0,0]),rt!=null&&j.clipExtent(null),gr(ae,j.stream(yr));var Rt=yr.result(),gi=Math.min(ge/(Rt[1][0]-Rt[0][0]),Oe/(Rt[1][1]-Rt[0][1])),Ni=+Q[0][0]+(ge-gi*(Rt[1][0]+Rt[0][0]))/2,qi=+Q[0][1]+(Oe-gi*(Rt[1][1]+Rt[0][1]))/2;return rt!=null&&j.clipExtent(rt),j.scale(gi*150).translate([Ni,qi])}function Dr(j,Q,ae){return br(j,[[0,0],Q],ae)}var ts=16,os=Be(30*We);function Ds(j,Q){return+Q?uo(j,Q):mo(j)}function mo(j){return bn({point:function(Q,ae){Q=j(Q,ae),this.stream.point(Q[0],Q[1])}})}function uo(j,Q){function ae(ge,Oe,rt,Rt,gi,Ni,qi,ii,Bi,xi,Ji,pn,Zn,vr){var Lr=qi-ge,Ar=ii-Oe,er=Lr*Lr+Ar*Ar;if(er>4*Q&&Zn--){var es=Rt+xi,Zs=gi+Ji,Vr=Ni+pn,fs=bi(es*es+Zs*Zs+Vr*Vr),us=Xn(Vr/=fs),is=ot(ot(Vr)-1)<$t||ot(rt-Bi)<$t?(rt+Bi)/2:vt(Zs,es),To=j(is,us),co=To[0],Do=To[1],zo=co-ge,_r=Do-Oe,on=Ar*zo-Lr*_r;(on*on/er>Q||ot((Lr*zo+Ar*_r)/er-.5)>.3||Rt*xi+gi*Ji+Ni*pn<os)&&(ae(ge,Oe,rt,Rt,gi,Ni,co,Do,is,es/=fs,Zs/=fs,Vr,Zn,vr),vr.point(co,Do),ae(co,Do,is,es,Zs,Vr,qi,ii,Bi,xi,Ji,pn,Zn,vr))}}return function(ge){var Oe,rt,Rt,gi,Ni,qi,ii,Bi,xi,Ji,pn,Zn,vr={point:Lr,lineStart:Ar,lineEnd:es,polygonStart:function(){ge.polygonStart(),vr.lineStart=Zs},polygonEnd:function(){ge.polygonEnd(),vr.lineStart=Ar}};function Lr(us,is){us=j(us,is),ge.point(us[0],us[1])}function Ar(){Bi=NaN,vr.point=er,ge.lineStart()}function er(us,is){var To=ys([us,is]),co=j(us,is);ae(Bi,xi,ii,Ji,pn,Zn,Bi=co[0],xi=co[1],ii=us,Ji=To[0],pn=To[1],Zn=To[2],ts,ge),ge.point(Bi,xi)}function es(){vr.point=Lr,ge.lineEnd()}function Zs(){Ar(),vr.point=Vr,vr.lineEnd=fs}function Vr(us,is){er(Oe=us,is),rt=Bi,Rt=xi,gi=Ji,Ni=pn,qi=Zn,vr.point=er}function fs(){ae(Bi,xi,ii,Ji,pn,Zn,rt,Rt,Oe,gi,Ni,qi,ts,ge),vr.lineEnd=es,es()}return vr}}var ta=bn({point:function(j,Q){this.stream.point(j*We,Q*We)}});function ga(j){return ja(function(){return j})()}function ja(j){var Q,ae=150,ge=480,Oe=250,rt,Rt,gi=0,Ni=0,qi=0,ii=0,Bi=0,xi,Ji,pn=null,Zn=F,vr=null,Lr,Ar,er,es=Yt,Zs=.5,Vr=Ds(co,Zs),fs,us;function is(_r){return _r=Ji(_r[0]*We,_r[1]*We),[_r[0]*ae+rt,Rt-_r[1]*ae]}function To(_r){return _r=Ji.invert((_r[0]-rt)/ae,(Rt-_r[1])/ae),_r&&[_r[0]*Yi,_r[1]*Yi]}function co(_r,on){return _r=Q(_r,on),[_r[0]*ae+rt,Rt-_r[1]*ae]}is.stream=function(_r){return fs&&us===_r?fs:fs=ta(Zn(xi,Vr(es(us=_r))))},is.clipAngle=function(_r){return arguments.length?(Zn=+_r?Xe(pn=_r*We,6*We):(pn=null,F),zo()):pn*Yi},is.clipExtent=function(_r){return arguments.length?(es=_r==null?(vr=Lr=Ar=er=null,Yt):ft(vr=+_r[0][0],Lr=+_r[0][1],Ar=+_r[1][0],er=+_r[1][1]),zo()):vr==null?null:[[vr,Lr],[Ar,er]]},is.scale=function(_r){return arguments.length?(ae=+_r,Do()):ae},is.translate=function(_r){return arguments.length?(ge=+_r[0],Oe=+_r[1],Do()):[ge,Oe]},is.center=function(_r){return arguments.length?(gi=_r[0]%360*We,Ni=_r[1]%360*We,Do()):[gi*Yi,Ni*Yi]},is.rotate=function(_r){return arguments.length?(qi=_r[0]%360*We,ii=_r[1]%360*We,Bi=_r.length>2?_r[2]%360*We:0,Do()):[qi*Yi,ii*Yi,Bi*Yi]},is.precision=function(_r){return arguments.length?(Vr=Ds(co,Zs=_r*_r),zo()):bi(Zs)},is.fitExtent=function(_r,on){return br(is,_r,on)},is.fitSize=function(_r,on){return Dr(is,_r,on)};function Do(){Ji=Tn(xi=dr(qi,ii,Bi),Q);var _r=Q(gi,Ni);return rt=ge-_r[0]*ae,Rt=Oe+_r[1]*ae,zo()}function zo(){return fs=us=null,is}return function(){return Q=j.apply(this,arguments),is.invert=Q.invert&&To,Do()}}function al(j){var Q=0,ae=pi/3,ge=projectionMutator(j),Oe=ge(Q,ae);return Oe.parallels=function(rt){return arguments.length?ge(Q=rt[0]*radians,ae=rt[1]*radians):[Q*degrees,ae*degrees]},Oe}function Ya(j){var Q=cos(j);function ae(ge,Oe){return[ge*Q,sin(Oe)/Q]}return ae.invert=function(ge,Oe){return[ge/Q,asin(Oe*Q)]},ae}function Ra(j,Q){var ae=sin(j),ge=(ae+sin(Q))/2;if(abs(ge)<epsilon)return cylindricalEqualAreaRaw(j);var Oe=1+ae*(2*ge-ae),rt=sqrt(Oe)/ge;function Rt(gi,Ni){var qi=sqrt(Oe-2*ge*sin(Ni))/ge;return[qi*sin(gi*=ge),rt-qi*cos(gi)]}return Rt.invert=function(gi,Ni){var qi=rt-Ni;return[atan2(gi,abs(qi))/ge*sign(qi),asin((Oe-(gi*gi+qi*qi)*ge*ge)/(2*ge))]},Rt}function ka(){return conicProjection(Ra).scale(155.424).center([0,33.6442])}function jr(){return conicEqualArea().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function ll(j){var Q=j.length;return{point:function(ae,ge){for(var Oe=-1;++Oe<Q;)j[Oe].point(ae,ge)},sphere:function(){for(var ae=-1;++ae<Q;)j[ae].sphere()},lineStart:function(){for(var ae=-1;++ae<Q;)j[ae].lineStart()},lineEnd:function(){for(var ae=-1;++ae<Q;)j[ae].lineEnd()},polygonStart:function(){for(var ae=-1;++ae<Q;)j[ae].polygonStart()},polygonEnd:function(){for(var ae=-1;++ae<Q;)j[ae].polygonEnd()}}}function Oa(){var j,Q,ae=albers(),ge,Oe=conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),rt,Rt=conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),gi,Ni,qi={point:function(xi,Ji){Ni=[xi,Ji]}};function ii(xi){var Ji=xi[0],pn=xi[1];return Ni=null,ge.point(Ji,pn),Ni||(rt.point(Ji,pn),Ni)||(gi.point(Ji,pn),Ni)}ii.invert=function(xi){var Ji=ae.scale(),pn=ae.translate(),Zn=(xi[0]-pn[0])/Ji,vr=(xi[1]-pn[1])/Ji;return(vr>=.12&&vr<.234&&Zn>=-.425&&Zn<-.214?Oe:vr>=.166&&vr<.234&&Zn>=-.214&&Zn<-.115?Rt:ae).invert(xi)},ii.stream=function(xi){return j&&Q===xi?j:j=ll([ae.stream(Q=xi),Oe.stream(xi),Rt.stream(xi)])},ii.precision=function(xi){return arguments.length?(ae.precision(xi),Oe.precision(xi),Rt.precision(xi),Bi()):ae.precision()},ii.scale=function(xi){return arguments.length?(ae.scale(xi),Oe.scale(xi*.35),Rt.scale(xi),ii.translate(ae.translate())):ae.scale()},ii.translate=function(xi){if(!arguments.length)return ae.translate();var Ji=ae.scale(),pn=+xi[0],Zn=+xi[1];return ge=ae.translate(xi).clipExtent([[pn-.455*Ji,Zn-.238*Ji],[pn+.455*Ji,Zn+.238*Ji]]).stream(qi),rt=Oe.translate([pn-.307*Ji,Zn+.201*Ji]).clipExtent([[pn-.425*Ji+epsilon,Zn+.12*Ji+epsilon],[pn-.214*Ji-epsilon,Zn+.234*Ji-epsilon]]).stream(qi),gi=Rt.translate([pn-.205*Ji,Zn+.212*Ji]).clipExtent([[pn-.214*Ji+epsilon,Zn+.166*Ji+epsilon],[pn-.115*Ji-epsilon,Zn+.234*Ji-epsilon]]).stream(qi),Bi()},ii.fitExtent=function(xi,Ji){return fitExtent(ii,xi,Ji)},ii.fitSize=function(xi,Ji){return fitSize(ii,xi,Ji)};function Bi(){return j=Q=null,ii}return ii.scale(1070)}function iu(j){return function(Q,ae){var ge=Be(Q),Oe=Be(ae),rt=j(ge*Oe);return[rt*Oe*Pt(Q),rt*Pt(ae)]}}function ul(j){return function(Q,ae){var ge=bi(Q*Q+ae*ae),Oe=j(ge),rt=Pt(Oe),Rt=Be(Oe);return[vt(Q*rt,ge*Rt),Xn(ge&&ae*rt/ge)]}}var vu=iu(function(j){return bi(2/(1+j))});vu.invert=ul(function(j){return 2*Xn(j/2)});function Gs(){return projection(vu).scale(124.75).clipAngle(180-.001)}var cl=iu(function(j){return(j=hr(j))&&j/Pt(j)});cl.invert=ul(function(j){return j});function nu(){return ga(cl).scale(79.4188).clipAngle(180-.001)}function Ka(j,Q){return[j,De(ji((ct+Q)/2))]}Ka.invert=function(j,Q){return[j,2*dt(Ue(Q))-ct]};function xu(){return ql(Ka).scale(961/tau)}function ql(j){var Q=projection(j),ae=Q.center,ge=Q.scale,Oe=Q.translate,rt=Q.clipExtent,Rt=null,gi,Ni,qi;Q.scale=function(Bi){return arguments.length?(ge(Bi),ii()):ge()},Q.translate=function(Bi){return arguments.length?(Oe(Bi),ii()):Oe()},Q.center=function(Bi){return arguments.length?(ae(Bi),ii()):ae()},Q.clipExtent=function(Bi){return arguments.length?(Bi==null?Rt=gi=Ni=qi=null:(Rt=+Bi[0][0],gi=+Bi[0][1],Ni=+Bi[1][0],qi=+Bi[1][1]),ii()):Rt==null?null:[[Rt,gi],[Ni,qi]]};function ii(){var Bi=pi*ge(),xi=Q(rotation(Q.rotate()).invert([0,0]));return rt(Rt==null?[[xi[0]-Bi,xi[1]-Bi],[xi[0]+Bi,xi[1]+Bi]]:j===Ka?[[Math.max(xi[0]-Bi,Rt),gi],[Math.min(xi[0]+Bi,Ni),qi]]:[[Rt,Math.max(xi[1]-Bi,gi)],[Ni,Math.min(xi[1]+Bi,qi)]])}return ii()}function Al(j){return tan((halfPi+j)/2)}function ru(j,Q){var ae=cos(j),ge=j===Q?sin(j):log(ae/cos(Q))/log(Al(Q)/Al(j)),Oe=ae*pow(Al(j),ge)/ge;if(!ge)return mercatorRaw;function rt(Rt,gi){Oe>0?gi<-halfPi+epsilon&&(gi=-halfPi+epsilon):gi>halfPi-epsilon&&(gi=halfPi-epsilon);var Ni=Oe/pow(Al(gi),ge);return[Ni*sin(ge*Rt),Oe-Ni*cos(ge*Rt)]}return rt.invert=function(Rt,gi){var Ni=Oe-gi,qi=sign(ge)*sqrt(Rt*Rt+Ni*Ni);return[atan2(Rt,abs(Ni))/ge*sign(Ni),2*atan(pow(Oe/qi,1/ge))-halfPi]},rt}function Cl(){return conicProjection(ru).scale(109.5).parallels([30,30])}function Ja(j,Q){return[j,Q]}Ja.invert=Ja;function bu(){return projection(Ja).scale(152.63)}function ia(j,Q){var ae=cos(j),ge=j===Q?sin(j):(ae-cos(Q))/(Q-j),Oe=ae/ge+j;if(abs(ge)<epsilon)return equirectangularRaw;function rt(Rt,gi){var Ni=Oe-gi,qi=ge*Rt;return[Ni*sin(qi),Oe-Ni*cos(qi)]}return rt.invert=function(Rt,gi){var Ni=Oe-gi;return[atan2(Rt,abs(Ni))/ge*sign(Ni),Oe-sign(ge)*sqrt(Rt*Rt+Ni*Ni)]},rt}function su(){return conicProjection(ia).scale(131.154).center([0,13.9389])}function hl(j,Q){var ae=Be(Q),ge=Be(j)*ae;return[ae*Pt(j)/ge,Pt(Q)/ge]}hl.invert=ul(dt);function ou(){return projection(hl).scale(144.049).clipAngle(60)}function dl(j,Q,ae,ge){return j===1&&Q===1&&ae===0&&ge===0?identity:transformer({point:function(Oe,rt){this.stream.point(Oe*j+ae,rt*Q+ge)}})}function wu(){var j=1,Q=0,ae=0,ge=1,Oe=1,rt=identity,Rt=null,gi,Ni,qi,ii=identity,Bi,xi,Ji;function pn(){return Bi=xi=null,Ji}return Ji={stream:function(Zn){return Bi&&xi===Zn?Bi:Bi=rt(ii(xi=Zn))},clipExtent:function(Zn){return arguments.length?(ii=Zn==null?(Rt=gi=Ni=qi=null,identity):clipExtent(Rt=+Zn[0][0],gi=+Zn[0][1],Ni=+Zn[1][0],qi=+Zn[1][1]),pn()):Rt==null?null:[[Rt,gi],[Ni,qi]]},scale:function(Zn){return arguments.length?(rt=dl((j=+Zn)*ge,j*Oe,Q,ae),pn()):j},translate:function(Zn){return arguments.length?(rt=dl(j*ge,j*Oe,Q=+Zn[0],ae=+Zn[1]),pn()):[Q,ae]},reflectX:function(Zn){return arguments.length?(rt=dl(j*(ge=Zn?-1:1),j*Oe,Q,ae),pn()):ge<0},reflectY:function(Zn){return arguments.length?(rt=dl(j*ge,j*(Oe=Zn?-1:1),Q,ae),pn()):Oe<0},fitExtent:function(Zn,vr){return fitExtent(Ji,Zn,vr)},fitSize:function(Zn,vr){return fitSize(Ji,Zn,vr)}}}function Pl(j,Q){var ae=Q*Q,ge=ae*ae;return[j*(.8707-.131979*ae+ge*(-.013791+ge*(.003971*ae-.001529*ge))),Q*(1.007226+ae*(.015085+ge*(-.044475+.028874*ae-.005916*ge)))]}Pl.invert=function(j,Q){var ae=Q,ge=25,Oe;do{var rt=ae*ae,Rt=rt*rt;ae-=Oe=(ae*(1.007226+rt*(.015085+Rt*(-.044475+.028874*rt-.005916*Rt)))-Q)/(1.007226+rt*(.015085*3+Rt*(-.044475*7+.028874*9*rt-.005916*11*Rt)))}while(ot(Oe)>$t&&--ge>0);return[j/(.8707+(rt=ae*ae)*(-.131979+rt*(-.013791+rt*rt*rt*(.003971-.001529*rt)))),ae]};function Eu(){return projection(Pl).scale(175.295)}function Ea(j,Q){return[Be(Q)*Pt(j),Pt(Q)]}Ea.invert=ul(Xn);function Hl(){return projection(Ea).scale(249.5).clipAngle(90+epsilon)}function au(j,Q){var ae=Be(Q),ge=1+Be(j)*ae;return[ae*Pt(j)/ge,Pt(Q)/ge]}au.invert=ul(function(j){return 2*dt(j)});function Tu(){return projection(au).scale(250).clipAngle(142)}function qa(j,Q){return[De(ji((ct+Q)/2)),-j]}qa.invert=function(j,Q){return[-Q,2*dt(Ue(j))-ct]};function lu(){var j=mercatorProjection(qa),Q=j.center,ae=j.rotate;return j.center=function(ge){return arguments.length?Q([-ge[1],ge[0]]):(ge=Q(),[ge[1],-ge[0]])},j.rotate=function(ge){return arguments.length?ae([ge[0],ge[1],ge.length>2?ge[2]+90:90]):(ge=ae(),[ge[0],ge[1],ge[2]-90])},ae([0,0,90]).scale(159.155)}var Qa=Tt(61764),{BufferOp:Su,GeoJSONReader:Yu,GeoJSONWriter:Ku}=Pi;function Iu(j,Q,ae){ae=ae||{};var ge=ae.units||"kilometers",Oe=ae.steps||8;if(!j)throw new Error("geojson is required");if(typeof ae!="object")throw new Error("options must be an object");if(typeof Oe!="number")throw new Error("steps must be an number");if(Q===void 0)throw new Error("radius is required");if(Oe<=0)throw new Error("steps must be greater than 0");var rt=[];switch(j.type){case"GeometryCollection":return(0,hn.on)(j,function(Rt){var gi=fl(Rt,Q,ge,Oe);gi&&rt.push(gi)}),(0,Qa.uf)(rt);case"FeatureCollection":return(0,hn.By)(j,function(Rt){var gi=fl(Rt,Q,ge,Oe);gi&&(0,hn.By)(gi,function(Ni){Ni&&rt.push(Ni)})}),(0,Qa.uf)(rt)}return fl(j,Q,ge,Oe)}function fl(j,Q,ae,ge){var Oe=j.properties||{},rt=j.type==="Feature"?j.geometry:j;if(rt.type==="GeometryCollection"){var Rt=[];return(0,hn.on)(j,function(Zn){var vr=fl(Zn,Q,ae,ge);vr&&Rt.push(vr)}),(0,Qa.uf)(Rt)}var gi=ri(rt),Ni={type:rt.type,coordinates:Ll(rt.coordinates,gi)},qi=new Yu,ii=qi.read(Ni),Bi=(0,Qa.DL)((0,Qa.lF)(Q,ae),"meters"),xi=Su.bufferOp(ii,Bi,ge),Ji=new Ku;if(xi=Ji.write(xi),!Zl(xi.coordinates)){var pn={type:xi.type,coordinates:Je(xi.coordinates,gi)};return(0,Qa.zL)(pn,Oe)}}function Zl(j){return Array.isArray(j[0])?Zl(j[0]):isNaN(j[0])}function Ll(j,Q){return typeof j[0]!="object"?Q(j):j.map(function(ae){return Ll(ae,Q)})}function Je(j,Q){return typeof j[0]!="object"?Q.invert(j):j.map(function(ae){return Je(ae,Q)})}function ri(j){var Q=(0,xe.b)(j).geometry.coordinates,ae=[-Q[0],-Q[1]];return nu().rotate(ae).scale(Qa.rQ)}var In=null},64030:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{b:function(){return hn}});var xe=Tt(5073),Pi=Tt(61764);function hn(xn,tn={}){const ti=(0,xe.V)(xn),$t=(ti[0]+ti[2])/2,et=(ti[1]+ti[3])/2;return(0,Pi.xm)([$t,et],tn.properties,tn)}var s=null},32331:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{S:function(){return hn}});var xe=Tt(61764),Pi=Tt(59738);function hn(xn,tn={}){let ti=0,$t=0,et=0;return(0,Pi.pZ)(xn,function(yi){ti+=yi[0],$t+=yi[1],et++},!0),(0,xe.xm)([ti/et,$t/et],tn.properties)}var s=null},93886:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{e:function(){return s}});var xe=Tt(21108),Pi=Tt(61764),hn=Tt(59738);function s(tn){const ti=[];if((0,hn.on)(tn,yi=>{ti.push(yi.coordinates)}),ti.length<2)throw new Error("Must have at least two features");const $t=tn.features[0].properties||{},et=xe.e5(ti[0],...ti.slice(1));return et.length===0?null:et.length===1?(0,Pi.yu)(et[0],$t):(0,Pi.tw)(et,$t)}var xn=null},17269:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{T:function(){return hn}});var xe=Tt(55230),Pi=Tt(61764);function hn(xn,tn,ti={}){var $t=(0,xe.c9)(xn),et=(0,xe.c9)(tn),yi=(0,Pi.Ht)(et[1]-$t[1]),ct=(0,Pi.Ht)(et[0]-$t[0]),Qt=(0,Pi.Ht)($t[1]),Ii=(0,Pi.Ht)(et[1]),Yi=Math.pow(Math.sin(yi/2),2)+Math.pow(Math.sin(ct/2),2)*Math.cos(Qt)*Math.cos(Ii);return(0,Pi.DL)(2*Math.atan2(Math.sqrt(Yi),Math.sqrt(1-Yi)),ti.units)}var s=null},61764:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{DL:function(){return vt},Ht:function(){return je},Kn:function(){return ji},Tu:function(){return yi},_R:function(){return Ii},lF:function(){return Be},rQ:function(){return xe},tw:function(){return We},uf:function(){return Qt},vi:function(){return De},vs:function(){return Pt},xm:function(){return tn},yu:function(){return $t},zL:function(){return s}});var xe=63710088e-1,Pi={centimeters:xe*100,centimetres:xe*100,degrees:360/(2*Math.PI),feet:xe*3.28084,inches:xe*39.37,kilometers:xe/1e3,kilometres:xe/1e3,meters:xe,metres:xe,miles:xe/1609.344,millimeters:xe*1e3,millimetres:xe*1e3,nauticalmiles:xe/1852,radians:1,yards:xe*1.0936},hn={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function s(rn,Ot,at={}){const Ht={type:"Feature"};return(at.id===0||at.id)&&(Ht.id=at.id),at.bbox&&(Ht.bbox=at.bbox),Ht.properties=Ot||{},Ht.geometry=rn,Ht}function xn(rn,Ot,at={}){switch(rn){case"Point":return tn(Ot).geometry;case"LineString":return yi(Ot).geometry;case"Polygon":return $t(Ot).geometry;case"MultiPoint":return Yi(Ot).geometry;case"MultiLineString":return Ii(Ot).geometry;case"MultiPolygon":return We(Ot).geometry;default:throw new Error(rn+" is invalid")}}function tn(rn,Ot,at={}){if(!rn)throw new Error("coordinates is required");if(!Array.isArray(rn))throw new Error("coordinates must be an Array");if(rn.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!bi(rn[0])||!bi(rn[1]))throw new Error("coordinates must contain numbers");return s({type:"Point",coordinates:rn},Ot,at)}function ti(rn,Ot,at={}){return Qt(rn.map(Ht=>tn(Ht,Ot)),at)}function $t(rn,Ot,at={}){for(const Qi of rn){if(Qi.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(Qi[Qi.length-1].length!==Qi[0].length)throw new Error("First and last Position are not equivalent.");for(let vi=0;vi<Qi[Qi.length-1].length;vi++)if(Qi[Qi.length-1][vi]!==Qi[0][vi])throw new Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:rn},Ot,at)}function et(rn,Ot,at={}){return Qt(rn.map(Ht=>$t(Ht,Ot)),at)}function yi(rn,Ot,at={}){if(rn.length<2)throw new Error("coordinates must be an array of two or more positions");return s({type:"LineString",coordinates:rn},Ot,at)}function ct(rn,Ot,at={}){return Qt(rn.map(Ht=>yi(Ht,Ot)),at)}function Qt(rn,Ot={}){const at={type:"FeatureCollection"};return Ot.id&&(at.id=Ot.id),Ot.bbox&&(at.bbox=Ot.bbox),at.features=rn,at}function Ii(rn,Ot,at={}){return s({type:"MultiLineString",coordinates:rn},Ot,at)}function Yi(rn,Ot,at={}){return s({type:"MultiPoint",coordinates:rn},Ot,at)}function We(rn,Ot,at={}){return s({type:"MultiPolygon",coordinates:rn},Ot,at)}function ot(rn,Ot,at={}){return s({type:"GeometryCollection",geometries:rn},Ot,at)}function dt(rn,Ot=0){if(Ot&&!(Ot>=0))throw new Error("precision must be a positive number");const at=Math.pow(10,Ot||0);return Math.round(rn*at)/at}function vt(rn,Ot="kilometers"){const at=Pi[Ot];if(!at)throw new Error(Ot+" units is invalid");return rn*at}function Be(rn,Ot="kilometers"){const at=Pi[Ot];if(!at)throw new Error(Ot+" units is invalid");return rn/at}function Ie(rn,Ot){return De(Be(rn,Ot))}function Ue(rn){let Ot=rn%360;return Ot<0&&(Ot+=360),Ot}function qe(rn){return rn=rn%360,rn>180?rn-360:rn<-180?rn+360:rn}function De(rn){return rn%(2*Math.PI)*180/Math.PI}function je(rn){return rn%360*Math.PI/180}function Pt(rn,Ot="kilometers",at="kilometers"){if(!(rn>=0))throw new Error("length must be a positive number");return vt(Be(rn,Ot),at)}function ki(rn,Ot="meters",at="kilometers"){if(!(rn>=0))throw new Error("area must be a positive number");const Ht=hn[Ot];if(!Ht)throw new Error("invalid original units");const Qi=hn[at];if(!Qi)throw new Error("invalid final units");return rn/Ht*Qi}function bi(rn){return!isNaN(rn)&&rn!==null&&!Array.isArray(rn)}function ji(rn){return rn!==null&&typeof rn=="object"&&!Array.isArray(rn)}function hr(rn){if(!rn)throw new Error("bbox is required");if(!Array.isArray(rn))throw new Error("bbox must be an Array");if(rn.length!==4&&rn.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");rn.forEach(Ot=>{if(!bi(Ot))throw new Error("bbox must only contain numbers")})}function Xn(rn){if(!rn)throw new Error("id is required");if(["string","number"].indexOf(typeof rn)===-1)throw new Error("id must be a number or a string")}},61792:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{w:function(){return s}});var xe=Tt(61764),Pi=Tt(59738),hn=Tt(21108);function s(tn,ti={}){const $t=[];if((0,Pi.on)(tn,yi=>{$t.push(yi.coordinates)}),$t.length<2)throw new Error("Must specify at least 2 geometries");const et=hn.jV($t[0],...$t.slice(1));return et.length===0?null:et.length===1?(0,xe.yu)(et[0],ti.properties):(0,xe.tw)(et,ti.properties)}var xn=null},55230:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{c9:function(){return xe},nK:function(){return xn},r7:function(){return Pi},wA:function(){return ti}});function xe(et){if(!et)throw new Error("coord is required");if(!Array.isArray(et)){if(et.type==="Feature"&&et.geometry!==null&&et.geometry.type==="Point")return[...et.geometry.coordinates];if(et.type==="Point")return[...et.coordinates]}if(Array.isArray(et)&&et.length>=2&&!Array.isArray(et[0])&&!Array.isArray(et[1]))return[...et];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Pi(et){if(Array.isArray(et))return et;if(et.type==="Feature"){if(et.geometry!==null)return et.geometry.coordinates}else if(et.coordinates)return et.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function hn(et){if(et.length>1&&isNumber(et[0])&&isNumber(et[1]))return!0;if(Array.isArray(et[0])&&et[0].length)return hn(et[0]);throw new Error("coordinates must only contain numbers")}function s(et,yi,ct){if(!yi||!ct)throw new Error("type and name required");if(!et||et.type!==yi)throw new Error("Invalid input to "+ct+": must be a "+yi+", given "+et.type)}function xn(et,yi,ct){if(!et)throw new Error("No feature passed");if(!ct)throw new Error(".featureOf() requires a name");if(!et||et.type!=="Feature"||!et.geometry)throw new Error("Invalid input to "+ct+", Feature with geometry required");if(!et.geometry||et.geometry.type!==yi)throw new Error("Invalid input to "+ct+": must be a "+yi+", given "+et.geometry.type)}function tn(et,yi,ct){if(!et)throw new Error("No featureCollection passed");if(!ct)throw new Error(".collectionOf() requires a name");if(!et||et.type!=="FeatureCollection")throw new Error("Invalid input to "+ct+", FeatureCollection required");for(const Qt of et.features){if(!Qt||Qt.type!=="Feature"||!Qt.geometry)throw new Error("Invalid input to "+ct+", Feature with geometry required");if(!Qt.geometry||Qt.geometry.type!==yi)throw new Error("Invalid input to "+ct+": must be a "+yi+", given "+Qt.geometry.type)}}function ti(et){return et.type==="Feature"?et.geometry:et}function $t(et,yi){return et.type==="FeatureCollection"?"FeatureCollection":et.type==="GeometryCollection"?"GeometryCollection":et.type==="Feature"&&et.geometry!==null?et.geometry.type:et.type}},76258:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{k:function(){return hn}});var xe=Tt(17269),Pi=Tt(59738);function hn(xn,tn={}){return(0,Pi.hE)(xn,(ti,$t)=>{const et=$t.geometry.coordinates;return ti+(0,xe.T)(et[0],et[1],tn)},0)}var s=null},98562:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{H:function(){return vt}});var xe=Tt(61764);class Pi{constructor(Ue=[],qe=hn){if(this.data=Ue,this.length=this.data.length,this.compare=qe,this.length>0)for(let De=(this.length>>1)-1;De>=0;De--)this._down(De)}push(Ue){this.data.push(Ue),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const Ue=this.data[0],qe=this.data.pop();return this.length--,this.length>0&&(this.data[0]=qe,this._down(0)),Ue}peek(){return this.data[0]}_up(Ue){const{data:qe,compare:De}=this,je=qe[Ue];for(;Ue>0;){const Pt=Ue-1>>1,ki=qe[Pt];if(De(je,ki)>=0)break;qe[Ue]=ki,Ue=Pt}qe[Ue]=je}_down(Ue){const{data:qe,compare:De}=this,je=this.length>>1,Pt=qe[Ue];for(;Ue<je;){let ki=(Ue<<1)+1,bi=qe[ki];const ji=ki+1;if(ji<this.length&&De(qe[ji],bi)<0&&(ki=ji,bi=qe[ji]),De(bi,Pt)>=0)break;qe[Ue]=bi,Ue=ki}qe[Ue]=Pt}}function hn(Ie,Ue){return Ie<Ue?-1:Ie>Ue?1:0}function s(Ie,Ue){return Ie.p.x>Ue.p.x?1:Ie.p.x<Ue.p.x?-1:Ie.p.y!==Ue.p.y?Ie.p.y>Ue.p.y?1:-1:1}function xn(Ie,Ue){return Ie.rightSweepEvent.p.x>Ue.rightSweepEvent.p.x?1:Ie.rightSweepEvent.p.x<Ue.rightSweepEvent.p.x?-1:Ie.rightSweepEvent.p.y!==Ue.rightSweepEvent.p.y?Ie.rightSweepEvent.p.y<Ue.rightSweepEvent.p.y?1:-1:1}class tn{constructor(Ue,qe,De,je){this.p={x:Ue[0],y:Ue[1]},this.featureId=qe,this.ringId=De,this.eventId=je,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(Ue){return this.p.x===Ue.p.x&&this.p.y===Ue.p.y}}function ti(Ie,Ue){if(Ie.type==="FeatureCollection"){const qe=Ie.features;for(let De=0;De<qe.length;De++)ct(qe[De],Ue)}else ct(Ie,Ue)}let $t=0,et=0,yi=0;function ct(Ie,Ue){const qe=Ie.type==="Feature"?Ie.geometry:Ie;let De=qe.coordinates;(qe.type==="Polygon"||qe.type==="MultiLineString")&&(De=[De]),qe.type==="LineString"&&(De=[[De]]);for(let je=0;je<De.length;je++)for(let Pt=0;Pt<De[je].length;Pt++){let ki=De[je][Pt][0],bi=null;et=et+1;for(let ji=0;ji<De[je][Pt].length-1;ji++){bi=De[je][Pt][ji+1];const hr=new tn(ki,$t,et,yi),Xn=new tn(bi,$t,et,yi+1);hr.otherEvent=Xn,Xn.otherEvent=hr,s(hr,Xn)>0?(Xn.isLeftEndpoint=!0,hr.isLeftEndpoint=!1):(hr.isLeftEndpoint=!0,Xn.isLeftEndpoint=!1),Ue.push(hr),Ue.push(Xn),ki=bi,yi=yi+1}}$t=$t+1}class Qt{constructor(Ue){this.leftSweepEvent=Ue,this.rightSweepEvent=Ue.otherEvent}}function Ii(Ie,Ue){if(Ie===null||Ue===null||Ie.leftSweepEvent.ringId===Ue.leftSweepEvent.ringId&&(Ie.rightSweepEvent.isSamePoint(Ue.leftSweepEvent)||Ie.rightSweepEvent.isSamePoint(Ue.leftSweepEvent)||Ie.rightSweepEvent.isSamePoint(Ue.rightSweepEvent)||Ie.leftSweepEvent.isSamePoint(Ue.leftSweepEvent)||Ie.leftSweepEvent.isSamePoint(Ue.rightSweepEvent)))return!1;const qe=Ie.leftSweepEvent.p.x,De=Ie.leftSweepEvent.p.y,je=Ie.rightSweepEvent.p.x,Pt=Ie.rightSweepEvent.p.y,ki=Ue.leftSweepEvent.p.x,bi=Ue.leftSweepEvent.p.y,ji=Ue.rightSweepEvent.p.x,hr=Ue.rightSweepEvent.p.y,Xn=(hr-bi)*(je-qe)-(ji-ki)*(Pt-De),rn=(ji-ki)*(De-bi)-(hr-bi)*(qe-ki),Ot=(je-qe)*(De-bi)-(Pt-De)*(qe-ki);if(Xn===0)return!1;const at=rn/Xn,Ht=Ot/Xn;if(at>=0&&at<=1&&Ht>=0&&Ht<=1){const Qi=qe+at*(je-qe),vi=De+at*(Pt-De);return[Qi,vi]}return!1}function Yi(Ie,Ue){Ue=Ue||!1;const qe=[],De=new Pi([],xn);for(;Ie.length;){const je=Ie.pop();if(je.isLeftEndpoint){const Pt=new Qt(je);for(let ki=0;ki<De.data.length;ki++){const bi=De.data[ki];if(Ue&&bi.leftSweepEvent.featureId===je.featureId)continue;const ji=Ii(Pt,bi);ji!==!1&&qe.push(ji)}De.push(Pt)}else je.isLeftEndpoint===!1&&De.pop()}return qe}function We(Ie,Ue){const qe=new Pi([],s);return ti(Ie,qe),Yi(qe,Ue)}var ot=We,dt=ot;function vt(Ie,Ue,qe={}){const{removeDuplicates:De=!0,ignoreSelfIntersections:je=!0}=qe;let Pt=[];Ie.type==="FeatureCollection"?Pt=Pt.concat(Ie.features):Ie.type==="Feature"?Pt.push(Ie):(Ie.type==="LineString"||Ie.type==="Polygon"||Ie.type==="MultiLineString"||Ie.type==="MultiPolygon")&&Pt.push((0,xe.zL)(Ie)),Ue.type==="FeatureCollection"?Pt=Pt.concat(Ue.features):Ue.type==="Feature"?Pt.push(Ue):(Ue.type==="LineString"||Ue.type==="Polygon"||Ue.type==="MultiLineString"||Ue.type==="MultiPolygon")&&Pt.push((0,xe.zL)(Ue));const ki=dt((0,xe.uf)(Pt),je);let bi=[];if(De){const ji={};ki.forEach(hr=>{const Xn=hr.join(",");ji[Xn]||(ji[Xn]=!0,bi.push(hr))})}else bi=ki;return(0,xe.uf)(bi.map(ji=>(0,xe.xm)(ji)))}var Be=null},59738:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{By:function(){return tn},Vf:function(){return Ii},hE:function(){return Yi},mm:function(){return yi},nG:function(){return ct},on:function(){return et},pZ:function(){return Pi}});var xe=Tt(61764);function Pi(Be,Ie,Ue){if(Be!==null)for(var qe,De,je,Pt,ki,bi,ji,hr=0,Xn=0,rn,Ot=Be.type,at=Ot==="FeatureCollection",Ht=Ot==="Feature",Qi=at?Be.features.length:1,vi=0;vi<Qi;vi++){ji=at?Be.features[vi].geometry:Ht?Be.geometry:Be,rn=ji?ji.type==="GeometryCollection":!1,ki=rn?ji.geometries.length:1;for(var Mn=0;Mn<ki;Mn++){var gr=0,Hn=0;if(Pt=rn?ji.geometries[Mn]:ji,Pt!==null){bi=Pt.coordinates;var kr=Pt.type;switch(hr=Ue&&(kr==="Polygon"||kr==="MultiPolygon")?1:0,kr){case null:break;case"Point":if(Ie(bi,Xn,vi,gr,Hn)===!1)return!1;Xn++,gr++;break;case"LineString":case"MultiPoint":for(qe=0;qe<bi.length;qe++){if(Ie(bi[qe],Xn,vi,gr,Hn)===!1)return!1;Xn++,kr==="MultiPoint"&&gr++}kr==="LineString"&&gr++;break;case"Polygon":case"MultiLineString":for(qe=0;qe<bi.length;qe++){for(De=0;De<bi[qe].length-hr;De++){if(Ie(bi[qe][De],Xn,vi,gr,Hn)===!1)return!1;Xn++}kr==="MultiLineString"&&gr++,kr==="Polygon"&&Hn++}kr==="Polygon"&&gr++;break;case"MultiPolygon":for(qe=0;qe<bi.length;qe++){for(Hn=0,De=0;De<bi[qe].length;De++){for(je=0;je<bi[qe][De].length-hr;je++){if(Ie(bi[qe][De][je],Xn,vi,gr,Hn)===!1)return!1;Xn++}Hn++}gr++}break;case"GeometryCollection":for(qe=0;qe<Pt.geometries.length;qe++)if(Pi(Pt.geometries[qe],Ie,Ue)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function hn(Be,Ie,Ue,qe){var De=Ue;return Pi(Be,function(je,Pt,ki,bi,ji){Pt===0&&Ue===void 0?De=je:De=Ie(De,je,Pt,ki,bi,ji)},qe),De}function s(Be,Ie){var Ue;switch(Be.type){case"FeatureCollection":for(Ue=0;Ue<Be.features.length&&Ie(Be.features[Ue].properties,Ue)!==!1;Ue++);break;case"Feature":Ie(Be.properties,0);break}}function xn(Be,Ie,Ue){var qe=Ue;return s(Be,function(De,je){je===0&&Ue===void 0?qe=De:qe=Ie(qe,De,je)}),qe}function tn(Be,Ie){if(Be.type==="Feature")Ie(Be,0);else if(Be.type==="FeatureCollection")for(var Ue=0;Ue<Be.features.length&&Ie(Be.features[Ue],Ue)!==!1;Ue++);}function ti(Be,Ie,Ue){var qe=Ue;return tn(Be,function(De,je){je===0&&Ue===void 0?qe=De:qe=Ie(qe,De,je)}),qe}function $t(Be){var Ie=[];return Pi(Be,function(Ue){Ie.push(Ue)}),Ie}function et(Be,Ie){var Ue,qe,De,je,Pt,ki,bi,ji,hr,Xn,rn=0,Ot=Be.type==="FeatureCollection",at=Be.type==="Feature",Ht=Ot?Be.features.length:1;for(Ue=0;Ue<Ht;Ue++){for(ki=Ot?Be.features[Ue].geometry:at?Be.geometry:Be,ji=Ot?Be.features[Ue].properties:at?Be.properties:{},hr=Ot?Be.features[Ue].bbox:at?Be.bbox:void 0,Xn=Ot?Be.features[Ue].id:at?Be.id:void 0,bi=ki?ki.type==="GeometryCollection":!1,Pt=bi?ki.geometries.length:1,De=0;De<Pt;De++){if(je=bi?ki.geometries[De]:ki,je===null){if(Ie(null,rn,ji,hr,Xn)===!1)return!1;continue}switch(je.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(Ie(je,rn,ji,hr,Xn)===!1)return!1;break}case"GeometryCollection":{for(qe=0;qe<je.geometries.length;qe++)if(Ie(je.geometries[qe],rn,ji,hr,Xn)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}rn++}}function yi(Be,Ie,Ue){var qe=Ue;return et(Be,function(De,je,Pt,ki,bi){je===0&&Ue===void 0?qe=De:qe=Ie(qe,De,je,Pt,ki,bi)}),qe}function ct(Be,Ie){et(Be,function(Ue,qe,De,je,Pt){var ki=Ue===null?null:Ue.type;switch(ki){case null:case"Point":case"LineString":case"Polygon":return Ie((0,xe.zL)(Ue,De,{bbox:je,id:Pt}),qe,0)===!1?!1:void 0}var bi;switch(ki){case"MultiPoint":bi="Point";break;case"MultiLineString":bi="LineString";break;case"MultiPolygon":bi="Polygon";break}for(var ji=0;ji<Ue.coordinates.length;ji++){var hr=Ue.coordinates[ji],Xn={type:bi,coordinates:hr};if(Ie((0,xe.zL)(Xn,De),qe,ji)===!1)return!1}})}function Qt(Be,Ie,Ue){var qe=Ue;return ct(Be,function(De,je,Pt){je===0&&Pt===0&&Ue===void 0?qe=De:qe=Ie(qe,De,je,Pt)}),qe}function Ii(Be,Ie){ct(Be,function(Ue,qe,De){var je=0;if(Ue.geometry){var Pt=Ue.geometry.type;if(!(Pt==="Point"||Pt==="MultiPoint")){var ki,bi=0,ji=0,hr=0;if(Pi(Ue,function(Xn,rn,Ot,at,Ht){if(ki===void 0||qe>bi||at>ji||Ht>hr){ki=Xn,bi=qe,ji=at,hr=Ht,je=0;return}var Qi=(0,xe.Tu)([ki,Xn],Ue.properties);if(Ie(Qi,qe,De,Ht,je)===!1)return!1;je++,ki=Xn})===!1)return!1}}})}function Yi(Be,Ie,Ue){var qe=Ue,De=!1;return Ii(Be,function(je,Pt,ki,bi,ji){De===!1&&Ue===void 0?qe=je:qe=Ie(qe,je,Pt,ki,bi,ji),De=!0}),qe}function We(Be,Ie){if(!Be)throw new Error("geojson is required");ct(Be,function(Ue,qe,De){if(Ue.geometry!==null){var je=Ue.geometry.type,Pt=Ue.geometry.coordinates;switch(je){case"LineString":if(Ie(Ue,qe,De,0,0)===!1)return!1;break;case"Polygon":for(var ki=0;ki<Pt.length;ki++)if(Ie(lineString(Pt[ki],Ue.properties),qe,De,ki)===!1)return!1;break}}})}function ot(Be,Ie,Ue){var qe=Ue;return We(Be,function(De,je,Pt,ki){je===0&&Ue===void 0?qe=De:qe=Ie(qe,De,je,Pt,ki)}),qe}function dt(Be,Ie){if(Ie=Ie||{},!isObject(Ie))throw new Error("options is invalid");var Ue=Ie.featureIndex||0,qe=Ie.multiFeatureIndex||0,De=Ie.geometryIndex||0,je=Ie.segmentIndex||0,Pt=Ie.properties,ki;switch(Be.type){case"FeatureCollection":Ue<0&&(Ue=Be.features.length+Ue),Pt=Pt||Be.features[Ue].properties,ki=Be.features[Ue].geometry;break;case"Feature":Pt=Pt||Be.properties,ki=Be.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":ki=Be;break;default:throw new Error("geojson is invalid")}if(ki===null)return null;var bi=ki.coordinates;switch(ki.type){case"Point":case"MultiPoint":return null;case"LineString":return je<0&&(je=bi.length+je-1),lineString([bi[je],bi[je+1]],Pt,Ie);case"Polygon":return De<0&&(De=bi.length+De),je<0&&(je=bi[De].length+je-1),lineString([bi[De][je],bi[De][je+1]],Pt,Ie);case"MultiLineString":return qe<0&&(qe=bi.length+qe),je<0&&(je=bi[qe].length+je-1),lineString([bi[qe][je],bi[qe][je+1]],Pt,Ie);case"MultiPolygon":return qe<0&&(qe=bi.length+qe),De<0&&(De=bi[qe].length+De),je<0&&(je=bi[qe][De].length-je-1),lineString([bi[qe][De][je],bi[qe][De][je+1]],Pt,Ie)}throw new Error("geojson is invalid")}function vt(Be,Ie){if(Ie=Ie||{},!isObject(Ie))throw new Error("options is invalid");var Ue=Ie.featureIndex||0,qe=Ie.multiFeatureIndex||0,De=Ie.geometryIndex||0,je=Ie.coordIndex||0,Pt=Ie.properties,ki;switch(Be.type){case"FeatureCollection":Ue<0&&(Ue=Be.features.length+Ue),Pt=Pt||Be.features[Ue].properties,ki=Be.features[Ue].geometry;break;case"Feature":Pt=Pt||Be.properties,ki=Be.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":ki=Be;break;default:throw new Error("geojson is invalid")}if(ki===null)return null;var bi=ki.coordinates;switch(ki.type){case"Point":return point(bi,Pt,Ie);case"MultiPoint":return qe<0&&(qe=bi.length+qe),point(bi[qe],Pt,Ie);case"LineString":return je<0&&(je=bi.length+je),point(bi[je],Pt,Ie);case"Polygon":return De<0&&(De=bi.length+De),je<0&&(je=bi[De].length+je),point(bi[De][je],Pt,Ie);case"MultiLineString":return qe<0&&(qe=bi.length+qe),je<0&&(je=bi[qe].length+je),point(bi[qe][je],Pt,Ie);case"MultiPolygon":return qe<0&&(qe=bi.length+qe),De<0&&(De=bi[qe].length+De),je<0&&(je=bi[qe][De].length-je),point(bi[qe][De][je],Pt,Ie)}throw new Error("geojson is invalid")}},72735:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{J:function(){return Yi}});var xe=Tt(17269),Pi=Tt(59738),hn=Tt(61764),s=Tt(55230),xn=Object.defineProperty,tn=Object.defineProperties,ti=Object.getOwnPropertyDescriptors,$t=Object.getOwnPropertySymbols,et=Object.prototype.hasOwnProperty,yi=Object.prototype.propertyIsEnumerable,ct=(De,je,Pt)=>je in De?xn(De,je,{enumerable:!0,configurable:!0,writable:!0,value:Pt}):De[je]=Pt,Qt=(De,je)=>{for(var Pt in je||(je={}))et.call(je,Pt)&&ct(De,Pt,je[Pt]);if($t)for(var Pt of $t(je))yi.call(je,Pt)&&ct(De,Pt,je[Pt]);return De},Ii=(De,je)=>tn(De,ti(je));function Yi(De,je,Pt={}){if(!De||!je)throw new Error("lines and pt are required arguments");const ki=(0,s.c9)(je);let bi=(0,hn.xm)([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),ji=0;return(0,Pi.nG)(De,function(hr,Xn,rn){const Ot=(0,s.r7)(hr);for(let at=0;at<Ot.length-1;at++){const Ht=(0,hn.xm)(Ot[at]);Ht.properties.dist=(0,xe.T)(je,Ht,Pt);const Qi=(0,s.c9)(Ht),vi=(0,hn.xm)(Ot[at+1]);vi.properties.dist=(0,xe.T)(je,vi,Pt);const Mn=(0,s.c9)(vi),gr=(0,xe.T)(Ht,vi,Pt);let Hn,kr;Qi[0]===ki[0]&&Qi[1]===ki[1]?[Hn,,kr]=[Qi,void 0,!1]:Mn[0]===ki[0]&&Mn[1]===ki[1]?[Hn,,kr]=[Mn,void 0,!0]:[Hn,,kr]=Ue(Ht.geometry.coordinates,vi.geometry.coordinates,(0,s.c9)(je));let Dt;Hn&&(Dt=(0,hn.xm)(Hn,{dist:(0,xe.T)(je,Hn,Pt),multiFeatureIndex:rn,location:ji+(0,xe.T)(Ht,Hn,Pt)})),Dt&&Dt.properties.dist<bi.properties.dist&&(bi=Ii(Qt({},Dt),{properties:Ii(Qt({},Dt.properties),{index:kr?at+1:at})})),ji+=gr}}),bi}function We(De,je){const[Pt,ki,bi]=De,[ji,hr,Xn]=je;return Pt*ji+ki*hr+bi*Xn}function ot(De,je){const[Pt,ki,bi]=De,[ji,hr,Xn]=je;return[ki*Xn-bi*hr,bi*ji-Pt*Xn,Pt*hr-ki*ji]}function dt(De){return Math.sqrt(Math.pow(De[0],2)+Math.pow(De[1],2)+Math.pow(De[2],2))}function vt(De,je){const Pt=We(De,je)/(dt(De)*dt(je));return Math.acos(Math.min(Math.max(Pt,-1),1))}function Be(De){const je=(0,hn.Ht)(De[1]),Pt=(0,hn.Ht)(De[0]);return[Math.cos(je)*Math.cos(Pt),Math.cos(je)*Math.sin(Pt),Math.sin(je)]}function Ie(De){const[je,Pt,ki]=De,bi=(0,hn.vi)(Math.asin(ki));return[(0,hn.vi)(Math.atan2(Pt,je)),bi]}function Ue(De,je,Pt){const ki=Be(De),bi=Be(je),ji=Be(Pt),[hr,Xn,rn]=ji,[Ot,at,Ht]=ot(ki,bi),Qi=at*rn-Ht*Xn,vi=Ht*hr-Ot*rn,Mn=Ot*Xn-at*hr,gr=Mn*at-vi*Ht,Hn=Qi*Ht-Mn*Ot,kr=vi*Ot-Qi*at,Dt=1/Math.sqrt(Math.pow(gr,2)+Math.pow(Hn,2)+Math.pow(kr,2)),Ls=[gr*Dt,Hn*Dt,kr*Dt],Pe=[-1*gr*Dt,-1*Hn*Dt,-1*kr*Dt],$n=vt(ki,bi),lt=vt(ki,Ls),cs=vt(bi,Ls),Xi=vt(ki,Pe),vs=vt(bi,Pe);let Bs;return lt<Xi&&lt<vs||cs<Xi&&cs<vs?Bs=Ls:Bs=Pe,vt(ki,Bs)>$n||vt(bi,Bs)>$n?(0,xe.T)(Ie(Bs),Ie(ki))<=(0,xe.T)(Ie(Bs),Ie(bi))?[Ie(ki),!0,!1]:[Ie(bi),!1,!0]:[Ie(Bs),!1,!1]}var qe=null},68973:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{O:function(){return $t}});var xe=Tt(61764),Pi=Tt(72735),hn=Tt(55230),s=Tt(59738);function xn(Qt,Ii,Yi={}){const We=(0,hn.c9)(Qt),ot=(0,hn.c9)(Ii);ot[0]+=ot[0]-We[0]>180?-360:We[0]-ot[0]>180?360:0;const dt=tn(We,ot);return(0,xe.vs)(dt,"meters",Yi.units)}function tn(Qt,Ii,Yi){Yi=Yi===void 0?xe.rQ:Number(Yi);const We=Yi,ot=Qt[1]*Math.PI/180,dt=Ii[1]*Math.PI/180,vt=dt-ot;let Be=Math.abs(Ii[0]-Qt[0])*Math.PI/180;Be>Math.PI&&(Be-=2*Math.PI);const Ie=Math.log(Math.tan(dt/2+Math.PI/4)/Math.tan(ot/2+Math.PI/4)),Ue=Math.abs(Ie)>1e-11?vt/Ie:Math.cos(ot);return Math.sqrt(vt*vt+Ue*Ue*Be*Be)*We}var ti=null;function $t(Qt,Ii,Yi={}){var We,ot;const dt=(We=Yi.method)!=null?We:"geodesic",vt=(ot=Yi.units)!=null?ot:"kilometers";if(!Qt)throw new Error("pt is required");if(Array.isArray(Qt)?Qt=(0,xe.xm)(Qt):Qt.type==="Point"?Qt=(0,xe.zL)(Qt):(0,hn.nK)(Qt,"Point","point"),!Ii)throw new Error("line is required");Array.isArray(Ii)?Ii=(0,xe.Tu)(Ii):Ii.type==="LineString"?Ii=(0,xe.zL)(Ii):(0,hn.nK)(Ii,"LineString","line");let Be=1/0;const Ie=Qt.geometry.coordinates;return(0,s.Vf)(Ii,Ue=>{if(Ue){const qe=Ue.geometry.coordinates[0],De=Ue.geometry.coordinates[1],je=et(Ie,qe,De,{method:dt});je<Be&&(Be=je)}}),(0,xe.vs)(Be,"degrees",vt)}function et(Qt,Ii,Yi,We){if(We.method==="geodesic")return(0,Pi.J)((0,xe.Tu)([Ii,Yi]).geometry,Qt,{units:"degrees"}).properties.dist;const ot=[Yi[0]-Ii[0],Yi[1]-Ii[1]],dt=[Qt[0]-Ii[0],Qt[1]-Ii[1]],vt=yi(dt,ot);if(vt<=0)return xn(Qt,Ii,{units:"degrees"});const Be=yi(ot,ot);if(Be<=vt)return xn(Qt,Yi,{units:"degrees"});const Ie=vt/Be,Ue=[Ii[0]+Ie*ot[0],Ii[1]+Ie*ot[1]];return xn(Qt,Ue,{units:"degrees"})}function yi(Qt,Ii){return Qt[0]*Ii[0]+Qt[1]*Ii[1]}var ct=null},3393:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{G:function(){return s}});var xe=Tt(21108),Pi=Tt(61764),hn=Tt(59738);function s(tn,ti={}){const $t=[];if((0,hn.on)(tn,yi=>{$t.push(yi.coordinates)}),$t.length<2)throw new Error("Must have at least 2 geometries");const et=xe.G0($t[0],...$t.slice(1));return et.length===0?null:et.length===1?(0,Pi.yu)(et[0],ti.properties):(0,Pi.tw)(et,ti.properties)}var xn=null},69370:function(ir,Yn,Tt){"use strict";Tt.d(Yn,{Z:function(){return Ll}});function xe(){this.__data__=[],this.size=0}var Pi=xe;function hn(Je,ri){return Je===ri||Je!==Je&&ri!==ri}var s=hn;function xn(Je,ri){for(var In=Je.length;In--;)if(s(Je[In][0],ri))return In;return-1}var tn=xn,ti=Array.prototype,$t=ti.splice;function et(Je){var ri=this.__data__,In=tn(ri,Je);if(In<0)return!1;var j=ri.length-1;return In==j?ri.pop():$t.call(ri,In,1),--this.size,!0}var yi=et;function ct(Je){var ri=this.__data__,In=tn(ri,Je);return In<0?void 0:ri[In][1]}var Qt=ct;function Ii(Je){return tn(this.__data__,Je)>-1}var Yi=Ii;function We(Je,ri){var In=this.__data__,j=tn(In,Je);return j<0?(++this.size,In.push([Je,ri])):In[j][1]=ri,this}var ot=We;function dt(Je){var ri=-1,In=Je==null?0:Je.length;for(this.clear();++ri<In;){var j=Je[ri];this.set(j[0],j[1])}}dt.prototype.clear=Pi,dt.prototype.delete=yi,dt.prototype.get=Qt,dt.prototype.has=Yi,dt.prototype.set=ot;var vt=dt;function Be(){this.__data__=new vt,this.size=0}var Ie=Be;function Ue(Je){var ri=this.__data__,In=ri.delete(Je);return this.size=ri.size,In}var qe=Ue;function De(Je){return this.__data__.get(Je)}var je=De;function Pt(Je){return this.__data__.has(Je)}var ki=Pt,bi=typeof global=="object"&&global&&global.Object===Object&&global,ji=bi,hr=typeof self=="object"&&self&&self.Object===Object&&self,Xn=ji||hr||Function("return this")(),rn=Xn,Ot=rn.Symbol,at=Ot,Ht=Object.prototype,Qi=Ht.hasOwnProperty,vi=Ht.toString,Mn=at?at.toStringTag:void 0;function gr(Je){var ri=Qi.call(Je,Mn),In=Je[Mn];try{Je[Mn]=void 0;var j=!0}catch(ae){}var Q=vi.call(Je);return j&&(ri?Je[Mn]=In:delete Je[Mn]),Q}var Hn=gr,kr=Object.prototype,Dt=kr.toString;function Ls(Je){return Dt.call(Je)}var Pe=Ls,$n="[object Null]",lt="[object Undefined]",cs=at?at.toStringTag:void 0;function Xi(Je){return Je==null?Je===void 0?lt:$n:cs&&cs in Object(Je)?Hn(Je):Pe(Je)}var vs=Xi;function Bs(Je){var ri=typeof Je;return Je!=null&&(ri=="object"||ri=="function")}var Xs=Bs,Sr="[object AsyncFunction]",un="[object Function]",ys="[object GeneratorFunction]",Hs="[object Proxy]";function ls(Je){if(!Xs(Je))return!1;var ri=vs(Je);return ri==un||ri==ys||ri==Sr||ri==Hs}var Rs=ls,cn=rn["__core-js_shared__"],Jr=cn,Pr=function(){var Je=/[^.]+$/.exec(Jr&&Jr.keys&&Jr.keys.IE_PROTO||"");return Je?"Symbol(src)_1."+Je:""}();function Ts(Je){return!!Pr&&Pr in Je}var Dn=Ts,xs=Function.prototype,Gn=xs.toString;function Ir(Je){if(Je!=null){try{return Gn.call(Je)}catch(ri){}try{return Je+""}catch(ri){}}return""}var fo=Ir,ms=/[\\^$.*+?()[\]{}|]/g,Co=/^\[object .+?Constructor\]$/,mr=Function.prototype,Ss=Object.prototype,ks=mr.toString,ur=Ss.hasOwnProperty,_e=RegExp("^"+ks.call(ur).replace(ms,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function he(Je){if(!Xs(Je)||Dn(Je))return!1;var ri=Rs(Je)?_e:Co;return ri.test(fo(Je))}var pe=he;function Re(Je,ri){return Je==null?void 0:Je[ri]}var ke=Re;function ui(Je,ri){var In=ke(Je,ri);return pe(In)?In:void 0}var Vt=ui,fi=Vt(rn,"Map"),Zt=fi,en=Vt(Object,"create"),Un=en;function Bn(){this.__data__=Un?Un(null):{},this.size=0}var Or=Bn;function hs(Je){var ri=this.has(Je)&&delete this.__data__[Je];return this.size-=ri?1:0,ri}var Vs=hs,qr="__lodash_hash_undefined__",ds=Object.prototype,gt=ds.hasOwnProperty;function q(Je){var ri=this.__data__;if(Un){var In=ri[Je];return In===qr?void 0:In}return gt.call(ri,Je)?ri[Je]:void 0}var ee=q,oe=Object.prototype,Ee=oe.hasOwnProperty;function be(Je){var ri=this.__data__;return Un?ri[Je]!==void 0:Ee.call(ri,Je)}var Ce=be,Y="__lodash_hash_undefined__";function K(Je,ri){var In=this.__data__;return this.size+=this.has(Je)?0:1,In[Je]=Un&&ri===void 0?Y:ri,this}var se=K;function fe(Je){var ri=-1,In=Je==null?0:Je.length;for(this.clear();++ri<In;){var j=Je[ri];this.set(j[0],j[1])}}fe.prototype.clear=Or,fe.prototype.delete=Vs,fe.prototype.get=ee,fe.prototype.has=Ce,fe.prototype.set=se;var ce=fe;function Se(){this.size=0,this.__data__={hash:new ce,map:new(Zt||vt),string:new ce}}var it=Se;function Ne(Je){var ri=typeof Je;return ri=="string"||ri=="number"||ri=="symbol"||ri=="boolean"?Je!=="__proto__":Je===null}var ut=Ne;function Et(Je,ri){var In=Je.__data__;return ut(ri)?In[typeof ri=="string"?"string":"hash"]:In.map}var xt=Et;function Xt(Je){var ri=xt(this,Je).delete(Je);return this.size-=ri?1:0,ri}var vn=Xt;function nn(Je){return xt(this,Je).get(Je)}var Tn=nn;function Kn(Je){return xt(this,Je).has(Je)}var dr=Kn;function Vn(Je,ri){var In=xt(this,Je),j=In.size;return In.set(Je,ri),this.size+=In.size==j?0:1,this}var Hr=Vn;function Mr(Je){var ri=-1,In=Je==null?0:Je.length;for(this.clear();++ri<In;){var j=Je[ri];this.set(j[0],j[1])}}Mr.prototype.clear=it,Mr.prototype.delete=vn,Mr.prototype.get=Tn,Mr.prototype.has=dr,Mr.prototype.set=Hr;var zs=Mr,Qs=200;function xo(Je,ri){var In=this.__data__;if(In instanceof vt){var j=In.__data__;if(!Zt||j.length<Qs-1)return j.push([Je,ri]),this.size=++In.size,this;In=this.__data__=new zs(j)}return In.set(Je,ri),this.size=In.size,this}var bs=xo;function to(Je){var ri=this.__data__=new vt(Je);this.size=ri.size}to.prototype.clear=Ie,to.prototype.delete=qe,to.prototype.get=je,to.prototype.has=ki,to.prototype.set=bs;var rs=to,ws="__lodash_hash_undefined__";function Qr(Je){return this.__data__.set(Je,ws),this}var Ho=Qr;function io(Je){return this.__data__.has(Je)}var ao=io;function Po(Je){var ri=-1,In=Je==null?0:Je.length;for(this.__data__=new zs;++ri<In;)this.add(Je[ri])}Po.prototype.add=Po.prototype.push=Ho,Po.prototype.has=ao;var Zo=Po;function bo(Je,ri){for(var In=-1,j=Je==null?0:Je.length;++In<j;)if(ri(Je[In],In,Je))return!0;return!1}var Oo=bo;function wo(Je,ri){return Je.has(ri)}var ma=wo,Yo=1,sa=2;function la(Je,ri,In,j,Q,ae){var ge=In&Yo,Oe=Je.length,rt=ri.length;if(Oe!=rt&&!(ge&&rt>Oe))return!1;var Rt=ae.get(Je),gi=ae.get(ri);if(Rt&&gi)return Rt==ri&&gi==Je;var Ni=-1,qi=!0,ii=In&sa?new Zo:void 0;for(ae.set(Je,ri),ae.set(ri,Je);++Ni<Oe;){var Bi=Je[Ni],xi=ri[Ni];if(j)var Ji=ge?j(xi,Bi,Ni,ri,Je,ae):j(Bi,xi,Ni,Je,ri,ae);if(Ji!==void 0){if(Ji)continue;qi=!1;break}if(ii){if(!Oo(ri,function(pn,Zn){if(!ma(ii,Zn)&&(Bi===pn||Q(Bi,pn,In,j,ae)))return ii.push(Zn)})){qi=!1;break}}else if(!(Bi===xi||Q(Bi,xi,In,j,ae))){qi=!1;break}}return ae.delete(Je),ae.delete(ri),qi}var Is=la,D=rn.Uint8Array,W=D;function Ge(Je){var ri=-1,In=Array(Je.size);return Je.forEach(function(j,Q){In[++ri]=[Q,j]}),In}var Ye=Ge;function Bt(Je){var ri=-1,In=Array(Je.size);return Je.forEach(function(j){In[++ri]=j}),In}var Ei=Bt,Pn=1,yn=2,pr="[object Boolean]",Er="[object Date]",ft="[object Error]",mi="[object Map]",nt="[object Number]",jt="[object RegExp]",Ti="[object Set]",ni="[object String]",wi="[object Symbol]",Mi="[object ArrayBuffer]",Li="[object DataView]",pt=at?at.prototype:void 0,St=pt?pt.valueOf:void 0;function zt(Je,ri,In,j,Q,ae,ge){switch(In){case Li:if(Je.byteLength!=ri.byteLength||Je.byteOffset!=ri.byteOffset)return!1;Je=Je.buffer,ri=ri.buffer;case Mi:return!(Je.byteLength!=ri.byteLength||!ae(new W(Je),new W(ri)));case pr:case Er:case nt:return s(+Je,+ri);case ft:return Je.name==ri.name&&Je.message==ri.message;case jt:case ni:return Je==ri+"";case mi:var Oe=Ye;case Ti:var rt=j&Pn;if(Oe||(Oe=Ei),Je.size!=ri.size&&!rt)return!1;var Rt=ge.get(Je);if(Rt)return Rt==ri;j|=yn,ge.set(Je,ri);var gi=Is(Oe(Je),Oe(ri),j,Q,ae,ge);return ge.delete(Je),gi;case wi:if(St)return St.call(Je)==St.call(ri)}return!1}var At=zt;function kt(Je,ri){for(var In=-1,j=ri.length,Q=Je.length;++In<j;)Je[Q+In]=ri[In];return Je}var Ci=kt,Ke=Array.isArray,It=Ke;function Nt(Je,ri,In){var j=ri(Je);return It(Je)?j:Ci(j,In(Je))}var ci=Nt;function oi(Je,ri){for(var In=-1,j=Je==null?0:Je.length,Q=0,ae=[];++In<j;){var ge=Je[In];ri(ge,In,Je)&&(ae[Q++]=ge)}return ae}var Ki=oi;function si(){return[]}var Di=si,li=Object.prototype,Oi=li.propertyIsEnumerable,Hi=Object.getOwnPropertySymbols,Sn=Hi?function(Je){return Je==null?[]:(Je=Object(Je),Ki(Hi(Je),function(ri){return Oi.call(Je,ri)}))}:Di,On=Sn;function An(Je,ri){for(var In=-1,j=Array(Je);++In<Je;)j[In]=ri(In);return j}var fr=An;function mt(Je){return Je!=null&&typeof Je=="object"}var Wt=mt,hi="[object Arguments]";function ln(Je){return Wt(Je)&&vs(Je)==hi}var bt=ln,qt=Object.prototype,Lt=qt.hasOwnProperty,Ai=qt.propertyIsEnumerable,Zi=bt(function(){return arguments}())?bt:function(Je){return Wt(Je)&&Lt.call(Je,"callee")&&!Ai.call(Je,"callee")},Gi=Zi;function Vi(){return!1}var gn=Vi,Nn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,sn=Nn&&typeof module=="object"&&module&&!module.nodeType&&module,nr=sn&&sn.exports===Nn,Fn=nr?rn.Buffer:void 0,or=Fn?Fn.isBuffer:void 0,rr=or||gn,tr=rr,yr=9007199254740991,Wr=/^(?:0|[1-9]\d*)$/;function ss(Je,ri){var In=typeof Je;return ri=ri==null?yr:ri,!!ri&&(In=="number"||In!="symbol"&&Wr.test(Je))&&Je>-1&&Je%1==0&&Je<ri}var Br=ss,Gr=9007199254740991;function Ms(Je){return typeof Je=="number"&&Je>-1&&Je%1==0&&Je<=Gr}var Os=Ms,cr="[object Arguments]",Ln="[object Array]",$s="[object Boolean]",ar="[object Date]",po="[object Error]",lo="[object Function]",Qn="[object Map]",Lo="[object Number]",Go="[object Object]",Aa="[object RegExp]",Ca="[object Set]",Ro="[object String]",Eo="[object WeakMap]",mn="[object ArrayBuffer]",ol="[object DataView]",$a="[object Float32Array]",Pa="[object Float64Array]",La="[object Int8Array]",_o="[object Int16Array]",Qo="[object Int32Array]",Wa="[object Uint8Array]",va="[object Uint8ClampedArray]",xa="[object Uint16Array]",ua="[object Uint32Array]",Ns={};Ns[$a]=Ns[Pa]=Ns[La]=Ns[_o]=Ns[Qo]=Ns[Wa]=Ns[va]=Ns[xa]=Ns[ua]=!0,Ns[cr]=Ns[Ln]=Ns[mn]=Ns[$s]=Ns[ol]=Ns[ar]=Ns[po]=Ns[lo]=Ns[Qn]=Ns[Lo]=Ns[Go]=Ns[Aa]=Ns[Ca]=Ns[Ro]=Ns[Eo]=!1;function wa(Je){return Wt(Je)&&Os(Je.length)&&!!Ns[vs(Je)]}var Il=wa;function Ml(Je){return function(ri){return Je(ri)}}var oa=Ml,ea=typeof exports=="object"&&exports&&!exports.nodeType&&exports,v=ea&&typeof module=="object"&&module&&!module.nodeType&&module,c=v&&v.exports===ea,f=c&&ji.process,y=function(){try{var Je=v&&v.require&&v.require("util").types;return Je||f&&f.binding&&f.binding("util")}catch(ri){}}(),P=y,F=P&&P.isTypedArray,Z=F?oa(F):Il,re=Z,Te=Object.prototype,Xe=Te.hasOwnProperty;function Yt(Je,ri){var In=It(Je),j=!In&&Gi(Je),Q=!In&&!j&&tr(Je),ae=!In&&!j&&!Q&&re(Je),ge=In||j||Q||ae,Oe=ge?fr(Je.length,String):[],rt=Oe.length;for(var Rt in Je)(ri||Xe.call(Je,Rt))&&!(ge&&(Rt=="length"||Q&&(Rt=="offset"||Rt=="parent")||ae&&(Rt=="buffer"||Rt=="byteLength"||Rt=="byteOffset")||Br(Rt,rt)))&&Oe.push(Rt);return Oe}var Si=Yt,bn=Object.prototype;function Jn(Je){var ri=Je&&Je.constructor,In=typeof ri=="function"&&ri.prototype||bn;return Je===In}var br=Jn;function Dr(Je,ri){return function(In){return Je(ri(In))}}var ts=Dr,os=ts(Object.keys,Object),Ds=os,mo=Object.prototype,uo=mo.hasOwnProperty;function ta(Je){if(!br(Je))return Ds(Je);var ri=[];for(var In in Object(Je))uo.call(Je,In)&&In!="constructor"&&ri.push(In);return ri}var ga=ta;function ja(Je){return Je!=null&&Os(Je.length)&&!Rs(Je)}var al=ja;function Ya(Je){return al(Je)?Si(Je):ga(Je)}var Ra=Ya;function ka(Je){return ci(Je,Ra,On)}var jr=ka,ll=1,Oa=Object.prototype,iu=Oa.hasOwnProperty;function ul(Je,ri,In,j,Q,ae){var ge=In&ll,Oe=jr(Je),rt=Oe.length,Rt=jr(ri),gi=Rt.length;if(rt!=gi&&!ge)return!1;for(var Ni=rt;Ni--;){var qi=Oe[Ni];if(!(ge?qi in ri:iu.call(ri,qi)))return!1}var ii=ae.get(Je),Bi=ae.get(ri);if(ii&&Bi)return ii==ri&&Bi==Je;var xi=!0;ae.set(Je,ri),ae.set(ri,Je);for(var Ji=ge;++Ni<rt;){qi=Oe[Ni];var pn=Je[qi],Zn=ri[qi];if(j)var vr=ge?j(Zn,pn,qi,ri,Je,ae):j(pn,Zn,qi,Je,ri,ae);if(!(vr===void 0?pn===Zn||Q(pn,Zn,In,j,ae):vr)){xi=!1;break}Ji||(Ji=qi=="constructor")}if(xi&&!Ji){var Lr=Je.constructor,Ar=ri.constructor;Lr!=Ar&&"constructor"in Je&&"constructor"in ri&&!(typeof Lr=="function"&&Lr instanceof Lr&&typeof Ar=="function"&&Ar instanceof Ar)&&(xi=!1)}return ae.delete(Je),ae.delete(ri),xi}var vu=ul,Gs=Vt(rn,"DataView"),cl=Gs,nu=Vt(rn,"Promise"),Ka=nu,xu=Vt(rn,"Set"),ql=xu,Al=Vt(rn,"WeakMap"),ru=Al,Cl="[object Map]",Ja="[object Object]",bu="[object Promise]",ia="[object Set]",su="[object WeakMap]",hl="[object DataView]",ou=fo(cl),dl=fo(Zt),wu=fo(Ka),Pl=fo(ql),Eu=fo(ru),Ea=vs;(cl&&Ea(new cl(new ArrayBuffer(1)))!=hl||Zt&&Ea(new Zt)!=Cl||Ka&&Ea(Ka.resolve())!=bu||ql&&Ea(new ql)!=ia||ru&&Ea(new ru)!=su)&&(Ea=function(Je){var ri=vs(Je),In=ri==Ja?Je.constructor:void 0,j=In?fo(In):"";if(j)switch(j){case ou:return hl;case dl:return Cl;case wu:return bu;case Pl:return ia;case Eu:return su}return ri});var Hl=Ea,au=1,Tu="[object Arguments]",qa="[object Array]",lu="[object Object]",Qa=Object.prototype,Su=Qa.hasOwnProperty;function Yu(Je,ri,In,j,Q,ae){var ge=It(Je),Oe=It(ri),rt=ge?qa:Hl(Je),Rt=Oe?qa:Hl(ri);rt=rt==Tu?lu:rt,Rt=Rt==Tu?lu:Rt;var gi=rt==lu,Ni=Rt==lu,qi=rt==Rt;if(qi&&tr(Je)){if(!tr(ri))return!1;ge=!0,gi=!1}if(qi&&!gi)return ae||(ae=new rs),ge||re(Je)?Is(Je,ri,In,j,Q,ae):At(Je,ri,rt,In,j,Q,ae);if(!(In&au)){var ii=gi&&Su.call(Je,"__wrapped__"),Bi=Ni&&Su.call(ri,"__wrapped__");if(ii||Bi){var xi=ii?Je.value():Je,Ji=Bi?ri.value():ri;return ae||(ae=new rs),Q(xi,Ji,In,j,ae)}}return qi?(ae||(ae=new rs),vu(Je,ri,In,j,Q,ae)):!1}var Ku=Yu;function Iu(Je,ri,In,j,Q){return Je===ri?!0:Je==null||ri==null||!Wt(Je)&&!Wt(ri)?Je!==Je&&ri!==ri:Ku(Je,ri,In,j,Iu,Q)}var fl=Iu;function Zl(Je,ri){return fl(Je,ri)}var Ll=Zl},21108:function(ir,Yn,Tt){"use strict";var mr,Ss,ks,ur;Tt.d(Yn,{e5:function(){return ms},jV:function(){return Ir},G0:function(){return Gn}});var xe=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Pi=Math.ceil,hn=Math.floor,s="[BigNumber Error] ",xn=s+"Number primitive has more than 15 significant digits: ",tn=1e14,ti=14,$t=9007199254740991,et=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],yi=1e7,ct=1e9;function Qt(_e){var he,pe,Re,ke=q.prototype={constructor:q,toString:null,valueOf:null},ui=new q(1),Vt=20,fi=4,Zt=-7,en=21,Un=-1e7,Bn=1e7,Or=!1,hs=1,Vs=0,qr={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},ds="0123456789abcdefghijklmnopqrstuvwxyz",gt=!0;function q(Y,K){var se,fe,ce,Se,it,Ne,ut,Et,xt=this;if(!(xt instanceof q))return new q(Y,K);if(K==null){if(Y&&Y._isBigNumber===!0){xt.s=Y.s,!Y.c||Y.e>Bn?xt.c=xt.e=null:Y.e<Un?xt.c=[xt.e=0]:(xt.e=Y.e,xt.c=Y.c.slice());return}if((Ne=typeof Y=="number")&&Y*0==0){if(xt.s=1/Y<0?(Y=-Y,-1):1,Y===~~Y){for(Se=0,it=Y;it>=10;it/=10,Se++);Se>Bn?xt.c=xt.e=null:(xt.e=Se,xt.c=[Y]);return}Et=String(Y)}else{if(!xe.test(Et=String(Y)))return Re(xt,Et,Ne);xt.s=Et.charCodeAt(0)==45?(Et=Et.slice(1),-1):1}(Se=Et.indexOf("."))>-1&&(Et=Et.replace(".","")),(it=Et.search(/e/i))>0?(Se<0&&(Se=it),Se+=+Et.slice(it+1),Et=Et.substring(0,it)):Se<0&&(Se=Et.length)}else{if(ot(K,2,ds.length,"Base"),K==10&&gt)return xt=new q(Y),be(xt,Vt+xt.e+1,fi);if(Et=String(Y),Ne=typeof Y=="number"){if(Y*0!=0)return Re(xt,Et,Ne,K);if(xt.s=1/Y<0?(Et=Et.slice(1),-1):1,q.DEBUG&&Et.replace(/^0\.0*|\./,"").length>15)throw Error(xn+Y)}else xt.s=Et.charCodeAt(0)===45?(Et=Et.slice(1),-1):1;for(se=ds.slice(0,K),Se=it=0,ut=Et.length;it<ut;it++)if(se.indexOf(fe=Et.charAt(it))<0){if(fe=="."){if(it>Se){Se=ut;continue}}else if(!ce&&(Et==Et.toUpperCase()&&(Et=Et.toLowerCase())||Et==Et.toLowerCase()&&(Et=Et.toUpperCase()))){ce=!0,it=-1,Se=0;continue}return Re(xt,String(Y),Ne,K)}Ne=!1,Et=pe(Et,K,10,xt.s),(Se=Et.indexOf("."))>-1?Et=Et.replace(".",""):Se=Et.length}for(it=0;Et.charCodeAt(it)===48;it++);for(ut=Et.length;Et.charCodeAt(--ut)===48;);if(Et=Et.slice(it,++ut)){if(ut-=it,Ne&&q.DEBUG&&ut>15&&(Y>$t||Y!==hn(Y)))throw Error(xn+xt.s*Y);if((Se=Se-it-1)>Bn)xt.c=xt.e=null;else if(Se<Un)xt.c=[xt.e=0];else{if(xt.e=Se,xt.c=[],it=(Se+1)%ti,Se<0&&(it+=ti),it<ut){for(it&&xt.c.push(+Et.slice(0,it)),ut-=ti;it<ut;)xt.c.push(+Et.slice(it,it+=ti));it=ti-(Et=Et.slice(it)).length}else it-=ut;for(;it--;Et+="0");xt.c.push(+Et)}}else xt.c=[xt.e=0]}q.clone=Qt,q.ROUND_UP=0,q.ROUND_DOWN=1,q.ROUND_CEIL=2,q.ROUND_FLOOR=3,q.ROUND_HALF_UP=4,q.ROUND_HALF_DOWN=5,q.ROUND_HALF_EVEN=6,q.ROUND_HALF_CEIL=7,q.ROUND_HALF_FLOOR=8,q.EUCLID=9,q.config=q.set=function(Y){var K,se;if(Y!=null)if(typeof Y=="object"){if(Y.hasOwnProperty(K="DECIMAL_PLACES")&&(se=Y[K],ot(se,0,ct,K),Vt=se),Y.hasOwnProperty(K="ROUNDING_MODE")&&(se=Y[K],ot(se,0,8,K),fi=se),Y.hasOwnProperty(K="EXPONENTIAL_AT")&&(se=Y[K],se&&se.pop?(ot(se[0],-ct,0,K),ot(se[1],0,ct,K),Zt=se[0],en=se[1]):(ot(se,-ct,ct,K),Zt=-(en=se<0?-se:se))),Y.hasOwnProperty(K="RANGE"))if(se=Y[K],se&&se.pop)ot(se[0],-ct,-1,K),ot(se[1],1,ct,K),Un=se[0],Bn=se[1];else if(ot(se,-ct,ct,K),se)Un=-(Bn=se<0?-se:se);else throw Error(s+K+" cannot be zero: "+se);if(Y.hasOwnProperty(K="CRYPTO"))if(se=Y[K],se===!!se)if(se)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))Or=se;else throw Or=!se,Error(s+"crypto unavailable");else Or=se;else throw Error(s+K+" not true or false: "+se);if(Y.hasOwnProperty(K="MODULO_MODE")&&(se=Y[K],ot(se,0,9,K),hs=se),Y.hasOwnProperty(K="POW_PRECISION")&&(se=Y[K],ot(se,0,ct,K),Vs=se),Y.hasOwnProperty(K="FORMAT"))if(se=Y[K],typeof se=="object")qr=se;else throw Error(s+K+" not an object: "+se);if(Y.hasOwnProperty(K="ALPHABET"))if(se=Y[K],typeof se=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(se))gt=se.slice(0,10)=="0123456789",ds=se;else throw Error(s+K+" invalid: "+se)}else throw Error(s+"Object expected: "+Y);return{DECIMAL_PLACES:Vt,ROUNDING_MODE:fi,EXPONENTIAL_AT:[Zt,en],RANGE:[Un,Bn],CRYPTO:Or,MODULO_MODE:hs,POW_PRECISION:Vs,FORMAT:qr,ALPHABET:ds}},q.isBigNumber=function(Y){if(!Y||Y._isBigNumber!==!0)return!1;if(!q.DEBUG)return!0;var K,se,fe=Y.c,ce=Y.e,Se=Y.s;e:if({}.toString.call(fe)=="[object Array]"){if((Se===1||Se===-1)&&ce>=-ct&&ce<=ct&&ce===hn(ce)){if(fe[0]===0){if(ce===0&&fe.length===1)return!0;break e}if(K=(ce+1)%ti,K<1&&(K+=ti),String(fe[0]).length==K){for(K=0;K<fe.length;K++)if(se=fe[K],se<0||se>=tn||se!==hn(se))break e;if(se!==0)return!0}}}else if(fe===null&&ce===null&&(Se===null||Se===1||Se===-1))return!0;throw Error(s+"Invalid BigNumber: "+Y)},q.maximum=q.max=function(){return oe(arguments,-1)},q.minimum=q.min=function(){return oe(arguments,1)},q.random=function(){var Y=9007199254740992,K=Math.random()*Y&2097151?function(){return hn(Math.random()*Y)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(se){var fe,ce,Se,it,Ne,ut=0,Et=[],xt=new q(ui);if(se==null?se=Vt:ot(se,0,ct),it=Pi(se/ti),Or)if(crypto.getRandomValues){for(fe=crypto.getRandomValues(new Uint32Array(it*=2));ut<it;)Ne=fe[ut]*131072+(fe[ut+1]>>>11),Ne>=9e15?(ce=crypto.getRandomValues(new Uint32Array(2)),fe[ut]=ce[0],fe[ut+1]=ce[1]):(Et.push(Ne%1e14),ut+=2);ut=it/2}else if(crypto.randomBytes){for(fe=crypto.randomBytes(it*=7);ut<it;)Ne=(fe[ut]&31)*281474976710656+fe[ut+1]*1099511627776+fe[ut+2]*4294967296+fe[ut+3]*16777216+(fe[ut+4]<<16)+(fe[ut+5]<<8)+fe[ut+6],Ne>=9e15?crypto.randomBytes(7).copy(fe,ut):(Et.push(Ne%1e14),ut+=7);ut=it/7}else throw Or=!1,Error(s+"crypto unavailable");if(!Or)for(;ut<it;)Ne=K(),Ne<9e15&&(Et[ut++]=Ne%1e14);for(it=Et[--ut],se%=ti,it&&se&&(Ne=et[ti-se],Et[ut]=hn(it/Ne)*Ne);Et[ut]===0;Et.pop(),ut--);if(ut<0)Et=[Se=0];else{for(Se=-1;Et[0]===0;Et.splice(0,1),Se-=ti);for(ut=1,Ne=Et[0];Ne>=10;Ne/=10,ut++);ut<ti&&(Se-=ti-ut)}return xt.e=Se,xt.c=Et,xt}}(),q.sum=function(){for(var Y=1,K=arguments,se=new q(K[0]);Y<K.length;)se=se.plus(K[Y++]);return se},pe=function(){var Y="0123456789";function K(se,fe,ce,Se){for(var it,Ne=[0],ut,Et=0,xt=se.length;Et<xt;){for(ut=Ne.length;ut--;Ne[ut]*=fe);for(Ne[0]+=Se.indexOf(se.charAt(Et++)),it=0;it<Ne.length;it++)Ne[it]>ce-1&&(Ne[it+1]==null&&(Ne[it+1]=0),Ne[it+1]+=Ne[it]/ce|0,Ne[it]%=ce)}return Ne.reverse()}return function(se,fe,ce,Se,it){var Ne,ut,Et,xt,Xt,vn,nn,Tn,Kn=se.indexOf("."),dr=Vt,Vn=fi;for(Kn>=0&&(xt=Vs,Vs=0,se=se.replace(".",""),Tn=new q(fe),vn=Tn.pow(se.length-Kn),Vs=xt,Tn.c=K(Be(Yi(vn.c),vn.e,"0"),10,ce,Y),Tn.e=Tn.c.length),nn=K(se,fe,ce,it?(Ne=ds,Y):(Ne=Y,ds)),Et=xt=nn.length;nn[--xt]==0;nn.pop());if(!nn[0])return Ne.charAt(0);if(Kn<0?--Et:(vn.c=nn,vn.e=Et,vn.s=Se,vn=he(vn,Tn,dr,Vn,ce),nn=vn.c,Xt=vn.r,Et=vn.e),ut=Et+dr+1,Kn=nn[ut],xt=ce/2,Xt=Xt||ut<0||nn[ut+1]!=null,Xt=Vn<4?(Kn!=null||Xt)&&(Vn==0||Vn==(vn.s<0?3:2)):Kn>xt||Kn==xt&&(Vn==4||Xt||Vn==6&&nn[ut-1]&1||Vn==(vn.s<0?8:7)),ut<1||!nn[0])se=Xt?Be(Ne.charAt(1),-dr,Ne.charAt(0)):Ne.charAt(0);else{if(nn.length=ut,Xt)for(--ce;++nn[--ut]>ce;)nn[ut]=0,ut||(++Et,nn=[1].concat(nn));for(xt=nn.length;!nn[--xt];);for(Kn=0,se="";Kn<=xt;se+=Ne.charAt(nn[Kn++]));se=Be(se,Et,Ne.charAt(0))}return se}}(),he=function(){function Y(fe,ce,Se){var it,Ne,ut,Et,xt=0,Xt=fe.length,vn=ce%yi,nn=ce/yi|0;for(fe=fe.slice();Xt--;)ut=fe[Xt]%yi,Et=fe[Xt]/yi|0,it=nn*ut+Et*vn,Ne=vn*ut+it%yi*yi+xt,xt=(Ne/Se|0)+(it/yi|0)+nn*Et,fe[Xt]=Ne%Se;return xt&&(fe=[xt].concat(fe)),fe}function K(fe,ce,Se,it){var Ne,ut;if(Se!=it)ut=Se>it?1:-1;else for(Ne=ut=0;Ne<Se;Ne++)if(fe[Ne]!=ce[Ne]){ut=fe[Ne]>ce[Ne]?1:-1;break}return ut}function se(fe,ce,Se,it){for(var Ne=0;Se--;)fe[Se]-=Ne,Ne=fe[Se]<ce[Se]?1:0,fe[Se]=Ne*it+fe[Se]-ce[Se];for(;!fe[0]&&fe.length>1;fe.splice(0,1));}return function(fe,ce,Se,it,Ne){var ut,Et,xt,Xt,vn,nn,Tn,Kn,dr,Vn,Hr,Mr,zs,Qs,xo,bs,to,rs=fe.s==ce.s?1:-1,ws=fe.c,Qr=ce.c;if(!ws||!ws[0]||!Qr||!Qr[0])return new q(!fe.s||!ce.s||(ws?Qr&&ws[0]==Qr[0]:!Qr)?NaN:ws&&ws[0]==0||!Qr?rs*0:rs/0);for(Kn=new q(rs),dr=Kn.c=[],Et=fe.e-ce.e,rs=Se+Et+1,Ne||(Ne=tn,Et=Ii(fe.e/ti)-Ii(ce.e/ti),rs=rs/ti|0),xt=0;Qr[xt]==(ws[xt]||0);xt++);if(Qr[xt]>(ws[xt]||0)&&Et--,rs<0)dr.push(1),Xt=!0;else{for(Qs=ws.length,bs=Qr.length,xt=0,rs+=2,vn=hn(Ne/(Qr[0]+1)),vn>1&&(Qr=Y(Qr,vn,Ne),ws=Y(ws,vn,Ne),bs=Qr.length,Qs=ws.length),zs=bs,Vn=ws.slice(0,bs),Hr=Vn.length;Hr<bs;Vn[Hr++]=0);to=Qr.slice(),to=[0].concat(to),xo=Qr[0],Qr[1]>=Ne/2&&xo++;do{if(vn=0,ut=K(Qr,Vn,bs,Hr),ut<0){if(Mr=Vn[0],bs!=Hr&&(Mr=Mr*Ne+(Vn[1]||0)),vn=hn(Mr/xo),vn>1)for(vn>=Ne&&(vn=Ne-1),nn=Y(Qr,vn,Ne),Tn=nn.length,Hr=Vn.length;K(nn,Vn,Tn,Hr)==1;)vn--,se(nn,bs<Tn?to:Qr,Tn,Ne),Tn=nn.length,ut=1;else vn==0&&(ut=vn=1),nn=Qr.slice(),Tn=nn.length;if(Tn<Hr&&(nn=[0].concat(nn)),se(Vn,nn,Hr,Ne),Hr=Vn.length,ut==-1)for(;K(Qr,Vn,bs,Hr)<1;)vn++,se(Vn,bs<Hr?to:Qr,Hr,Ne),Hr=Vn.length}else ut===0&&(vn++,Vn=[0]);dr[xt++]=vn,Vn[0]?Vn[Hr++]=ws[zs]||0:(Vn=[ws[zs]],Hr=1)}while((zs++<Qs||Vn[0]!=null)&&rs--);Xt=Vn[0]!=null,dr[0]||dr.splice(0,1)}if(Ne==tn){for(xt=1,rs=dr[0];rs>=10;rs/=10,xt++);be(Kn,Se+(Kn.e=xt+Et*ti-1)+1,it,Xt)}else Kn.e=Et,Kn.r=+Xt;return Kn}}();function ee(Y,K,se,fe){var ce,Se,it,Ne,ut;if(se==null?se=fi:ot(se,0,8),!Y.c)return Y.toString();if(ce=Y.c[0],it=Y.e,K==null)ut=Yi(Y.c),ut=fe==1||fe==2&&(it<=Zt||it>=en)?vt(ut,it):Be(ut,it,"0");else if(Y=be(new q(Y),K,se),Se=Y.e,ut=Yi(Y.c),Ne=ut.length,fe==1||fe==2&&(K<=Se||Se<=Zt)){for(;Ne<K;ut+="0",Ne++);ut=vt(ut,Se)}else if(K-=it,ut=Be(ut,Se,"0"),Se+1>Ne){if(--K>0)for(ut+=".";K--;ut+="0");}else if(K+=Se-Ne,K>0)for(Se+1==Ne&&(ut+=".");K--;ut+="0");return Y.s<0&&ce?"-"+ut:ut}function oe(Y,K){for(var se,fe,ce=1,Se=new q(Y[0]);ce<Y.length;ce++)fe=new q(Y[ce]),(!fe.s||(se=We(Se,fe))===K||se===0&&Se.s===K)&&(Se=fe);return Se}function Ee(Y,K,se){for(var fe=1,ce=K.length;!K[--ce];K.pop());for(ce=K[0];ce>=10;ce/=10,fe++);return(se=fe+se*ti-1)>Bn?Y.c=Y.e=null:se<Un?Y.c=[Y.e=0]:(Y.e=se,Y.c=K),Y}Re=function(){var Y=/^(-?)0([xbo])(?=\w[\w.]*$)/i,K=/^([^.]+)\.$/,se=/^\.([^.]+)$/,fe=/^-?(Infinity|NaN)$/,ce=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Se,it,Ne,ut){var Et,xt=Ne?it:it.replace(ce,"");if(fe.test(xt))Se.s=isNaN(xt)?null:xt<0?-1:1;else{if(!Ne&&(xt=xt.replace(Y,function(Xt,vn,nn){return Et=(nn=nn.toLowerCase())=="x"?16:nn=="b"?2:8,!ut||ut==Et?vn:Xt}),ut&&(Et=ut,xt=xt.replace(K,"$1").replace(se,"0.$1")),it!=xt))return new q(xt,Et);if(q.DEBUG)throw Error(s+"Not a"+(ut?" base "+ut:"")+" number: "+it);Se.s=null}Se.c=Se.e=null}}();function be(Y,K,se,fe){var ce,Se,it,Ne,ut,Et,xt,Xt=Y.c,vn=et;if(Xt){e:{for(ce=1,Ne=Xt[0];Ne>=10;Ne/=10,ce++);if(Se=K-ce,Se<0)Se+=ti,it=K,ut=Xt[Et=0],xt=hn(ut/vn[ce-it-1]%10);else if(Et=Pi((Se+1)/ti),Et>=Xt.length)if(fe){for(;Xt.length<=Et;Xt.push(0));ut=xt=0,ce=1,Se%=ti,it=Se-ti+1}else break e;else{for(ut=Ne=Xt[Et],ce=1;Ne>=10;Ne/=10,ce++);Se%=ti,it=Se-ti+ce,xt=it<0?0:hn(ut/vn[ce-it-1]%10)}if(fe=fe||K<0||Xt[Et+1]!=null||(it<0?ut:ut%vn[ce-it-1]),fe=se<4?(xt||fe)&&(se==0||se==(Y.s<0?3:2)):xt>5||xt==5&&(se==4||fe||se==6&&(Se>0?it>0?ut/vn[ce-it]:0:Xt[Et-1])%10&1||se==(Y.s<0?8:7)),K<1||!Xt[0])return Xt.length=0,fe?(K-=Y.e+1,Xt[0]=vn[(ti-K%ti)%ti],Y.e=-K||0):Xt[0]=Y.e=0,Y;if(Se==0?(Xt.length=Et,Ne=1,Et--):(Xt.length=Et+1,Ne=vn[ti-Se],Xt[Et]=it>0?hn(ut/vn[ce-it]%vn[it])*Ne:0),fe)for(;;)if(Et==0){for(Se=1,it=Xt[0];it>=10;it/=10,Se++);for(it=Xt[0]+=Ne,Ne=1;it>=10;it/=10,Ne++);Se!=Ne&&(Y.e++,Xt[0]==tn&&(Xt[0]=1));break}else{if(Xt[Et]+=Ne,Xt[Et]!=tn)break;Xt[Et--]=0,Ne=1}for(Se=Xt.length;Xt[--Se]===0;Xt.pop());}Y.e>Bn?Y.c=Y.e=null:Y.e<Un&&(Y.c=[Y.e=0])}return Y}function Ce(Y){var K,se=Y.e;return se===null?Y.toString():(K=Yi(Y.c),K=se<=Zt||se>=en?vt(K,se):Be(K,se,"0"),Y.s<0?"-"+K:K)}return ke.absoluteValue=ke.abs=function(){var Y=new q(this);return Y.s<0&&(Y.s=1),Y},ke.comparedTo=function(Y,K){return We(this,new q(Y,K))},ke.decimalPlaces=ke.dp=function(Y,K){var se,fe,ce,Se=this;if(Y!=null)return ot(Y,0,ct),K==null?K=fi:ot(K,0,8),be(new q(Se),Y+Se.e+1,K);if(!(se=Se.c))return null;if(fe=((ce=se.length-1)-Ii(this.e/ti))*ti,ce=se[ce])for(;ce%10==0;ce/=10,fe--);return fe<0&&(fe=0),fe},ke.dividedBy=ke.div=function(Y,K){return he(this,new q(Y,K),Vt,fi)},ke.dividedToIntegerBy=ke.idiv=function(Y,K){return he(this,new q(Y,K),0,1)},ke.exponentiatedBy=ke.pow=function(Y,K){var se,fe,ce,Se,it,Ne,ut,Et,xt,Xt=this;if(Y=new q(Y),Y.c&&!Y.isInteger())throw Error(s+"Exponent not an integer: "+Ce(Y));if(K!=null&&(K=new q(K)),Ne=Y.e>14,!Xt.c||!Xt.c[0]||Xt.c[0]==1&&!Xt.e&&Xt.c.length==1||!Y.c||!Y.c[0])return xt=new q(Math.pow(+Ce(Xt),Ne?Y.s*(2-dt(Y)):+Ce(Y))),K?xt.mod(K):xt;if(ut=Y.s<0,K){if(K.c?!K.c[0]:!K.s)return new q(NaN);fe=!ut&&Xt.isInteger()&&K.isInteger(),fe&&(Xt=Xt.mod(K))}else{if(Y.e>9&&(Xt.e>0||Xt.e<-1||(Xt.e==0?Xt.c[0]>1||Ne&&Xt.c[1]>=24e7:Xt.c[0]<8e13||Ne&&Xt.c[0]<=9999975e7)))return Se=Xt.s<0&&dt(Y)?-0:0,Xt.e>-1&&(Se=1/Se),new q(ut?1/Se:Se);Vs&&(Se=Pi(Vs/ti+2))}for(Ne?(se=new q(.5),ut&&(Y.s=1),Et=dt(Y)):(ce=Math.abs(+Ce(Y)),Et=ce%2),xt=new q(ui);;){if(Et){if(xt=xt.times(Xt),!xt.c)break;Se?xt.c.length>Se&&(xt.c.length=Se):fe&&(xt=xt.mod(K))}if(ce){if(ce=hn(ce/2),ce===0)break;Et=ce%2}else if(Y=Y.times(se),be(Y,Y.e+1,1),Y.e>14)Et=dt(Y);else{if(ce=+Ce(Y),ce===0)break;Et=ce%2}Xt=Xt.times(Xt),Se?Xt.c&&Xt.c.length>Se&&(Xt.c.length=Se):fe&&(Xt=Xt.mod(K))}return fe?xt:(ut&&(xt=ui.div(xt)),K?xt.mod(K):Se?be(xt,Vs,fi,it):xt)},ke.integerValue=function(Y){var K=new q(this);return Y==null?Y=fi:ot(Y,0,8),be(K,K.e+1,Y)},ke.isEqualTo=ke.eq=function(Y,K){return We(this,new q(Y,K))===0},ke.isFinite=function(){return!!this.c},ke.isGreaterThan=ke.gt=function(Y,K){return We(this,new q(Y,K))>0},ke.isGreaterThanOrEqualTo=ke.gte=function(Y,K){return(K=We(this,new q(Y,K)))===1||K===0},ke.isInteger=function(){return!!this.c&&Ii(this.e/ti)>this.c.length-2},ke.isLessThan=ke.lt=function(Y,K){return We(this,new q(Y,K))<0},ke.isLessThanOrEqualTo=ke.lte=function(Y,K){return(K=We(this,new q(Y,K)))===-1||K===0},ke.isNaN=function(){return!this.s},ke.isNegative=function(){return this.s<0},ke.isPositive=function(){return this.s>0},ke.isZero=function(){return!!this.c&&this.c[0]==0},ke.minus=function(Y,K){var se,fe,ce,Se,it=this,Ne=it.s;if(Y=new q(Y,K),K=Y.s,!Ne||!K)return new q(NaN);if(Ne!=K)return Y.s=-K,it.plus(Y);var ut=it.e/ti,Et=Y.e/ti,xt=it.c,Xt=Y.c;if(!ut||!Et){if(!xt||!Xt)return xt?(Y.s=-K,Y):new q(Xt?it:NaN);if(!xt[0]||!Xt[0])return Xt[0]?(Y.s=-K,Y):new q(xt[0]?it:fi==3?-0:0)}if(ut=Ii(ut),Et=Ii(Et),xt=xt.slice(),Ne=ut-Et){for((Se=Ne<0)?(Ne=-Ne,ce=xt):(Et=ut,ce=Xt),ce.reverse(),K=Ne;K--;ce.push(0));ce.reverse()}else for(fe=(Se=(Ne=xt.length)<(K=Xt.length))?Ne:K,Ne=K=0;K<fe;K++)if(xt[K]!=Xt[K]){Se=xt[K]<Xt[K];break}if(Se&&(ce=xt,xt=Xt,Xt=ce,Y.s=-Y.s),K=(fe=Xt.length)-(se=xt.length),K>0)for(;K--;xt[se++]=0);for(K=tn-1;fe>Ne;){if(xt[--fe]<Xt[fe]){for(se=fe;se&&!xt[--se];xt[se]=K);--xt[se],xt[fe]+=tn}xt[fe]-=Xt[fe]}for(;xt[0]==0;xt.splice(0,1),--Et);return xt[0]?Ee(Y,xt,Et):(Y.s=fi==3?-1:1,Y.c=[Y.e=0],Y)},ke.modulo=ke.mod=function(Y,K){var se,fe,ce=this;return Y=new q(Y,K),!ce.c||!Y.s||Y.c&&!Y.c[0]?new q(NaN):!Y.c||ce.c&&!ce.c[0]?new q(ce):(hs==9?(fe=Y.s,Y.s=1,se=he(ce,Y,0,3),Y.s=fe,se.s*=fe):se=he(ce,Y,0,hs),Y=ce.minus(se.times(Y)),!Y.c[0]&&hs==1&&(Y.s=ce.s),Y)},ke.multipliedBy=ke.times=function(Y,K){var se,fe,ce,Se,it,Ne,ut,Et,xt,Xt,vn,nn,Tn,Kn,dr,Vn=this,Hr=Vn.c,Mr=(Y=new q(Y,K)).c;if(!Hr||!Mr||!Hr[0]||!Mr[0])return!Vn.s||!Y.s||Hr&&!Hr[0]&&!Mr||Mr&&!Mr[0]&&!Hr?Y.c=Y.e=Y.s=null:(Y.s*=Vn.s,!Hr||!Mr?Y.c=Y.e=null:(Y.c=[0],Y.e=0)),Y;for(fe=Ii(Vn.e/ti)+Ii(Y.e/ti),Y.s*=Vn.s,ut=Hr.length,Xt=Mr.length,ut<Xt&&(Tn=Hr,Hr=Mr,Mr=Tn,ce=ut,ut=Xt,Xt=ce),ce=ut+Xt,Tn=[];ce--;Tn.push(0));for(Kn=tn,dr=yi,ce=Xt;--ce>=0;){for(se=0,vn=Mr[ce]%dr,nn=Mr[ce]/dr|0,it=ut,Se=ce+it;Se>ce;)Et=Hr[--it]%dr,xt=Hr[it]/dr|0,Ne=nn*Et+xt*vn,Et=vn*Et+Ne%dr*dr+Tn[Se]+se,se=(Et/Kn|0)+(Ne/dr|0)+nn*xt,Tn[Se--]=Et%Kn;Tn[Se]=se}return se?++fe:Tn.splice(0,1),Ee(Y,Tn,fe)},ke.negated=function(){var Y=new q(this);return Y.s=-Y.s||null,Y},ke.plus=function(Y,K){var se,fe=this,ce=fe.s;if(Y=new q(Y,K),K=Y.s,!ce||!K)return new q(NaN);if(ce!=K)return Y.s=-K,fe.minus(Y);var Se=fe.e/ti,it=Y.e/ti,Ne=fe.c,ut=Y.c;if(!Se||!it){if(!Ne||!ut)return new q(ce/0);if(!Ne[0]||!ut[0])return ut[0]?Y:new q(Ne[0]?fe:ce*0)}if(Se=Ii(Se),it=Ii(it),Ne=Ne.slice(),ce=Se-it){for(ce>0?(it=Se,se=ut):(ce=-ce,se=Ne),se.reverse();ce--;se.push(0));se.reverse()}for(ce=Ne.length,K=ut.length,ce-K<0&&(se=ut,ut=Ne,Ne=se,K=ce),ce=0;K;)ce=(Ne[--K]=Ne[K]+ut[K]+ce)/tn|0,Ne[K]=tn===Ne[K]?0:Ne[K]%tn;return ce&&(Ne=[ce].concat(Ne),++it),Ee(Y,Ne,it)},ke.precision=ke.sd=function(Y,K){var se,fe,ce,Se=this;if(Y!=null&&Y!==!!Y)return ot(Y,1,ct),K==null?K=fi:ot(K,0,8),be(new q(Se),Y,K);if(!(se=Se.c))return null;if(ce=se.length-1,fe=ce*ti+1,ce=se[ce]){for(;ce%10==0;ce/=10,fe--);for(ce=se[0];ce>=10;ce/=10,fe++);}return Y&&Se.e+1>fe&&(fe=Se.e+1),fe},ke.shiftedBy=function(Y){return ot(Y,-$t,$t),this.times("1e"+Y)},ke.squareRoot=ke.sqrt=function(){var Y,K,se,fe,ce,Se=this,it=Se.c,Ne=Se.s,ut=Se.e,Et=Vt+4,xt=new q("0.5");if(Ne!==1||!it||!it[0])return new q(!Ne||Ne<0&&(!it||it[0])?NaN:it?Se:1/0);if(Ne=Math.sqrt(+Ce(Se)),Ne==0||Ne==1/0?(K=Yi(it),(K.length+ut)%2==0&&(K+="0"),Ne=Math.sqrt(+K),ut=Ii((ut+1)/2)-(ut<0||ut%2),Ne==1/0?K="5e"+ut:(K=Ne.toExponential(),K=K.slice(0,K.indexOf("e")+1)+ut),se=new q(K)):se=new q(Ne+""),se.c[0]){for(ut=se.e,Ne=ut+Et,Ne<3&&(Ne=0);;)if(ce=se,se=xt.times(ce.plus(he(Se,ce,Et,1))),Yi(ce.c).slice(0,Ne)===(K=Yi(se.c)).slice(0,Ne))if(se.e<ut&&--Ne,K=K.slice(Ne-3,Ne+1),K=="9999"||!fe&&K=="4999"){if(!fe&&(be(ce,ce.e+Vt+2,0),ce.times(ce).eq(Se))){se=ce;break}Et+=4,Ne+=4,fe=1}else{(!+K||!+K.slice(1)&&K.charAt(0)=="5")&&(be(se,se.e+Vt+2,1),Y=!se.times(se).eq(Se));break}}return be(se,se.e+Vt+1,fi,Y)},ke.toExponential=function(Y,K){return Y!=null&&(ot(Y,0,ct),Y++),ee(this,Y,K,1)},ke.toFixed=function(Y,K){return Y!=null&&(ot(Y,0,ct),Y=Y+this.e+1),ee(this,Y,K)},ke.toFormat=function(Y,K,se){var fe,ce=this;if(se==null)Y!=null&&K&&typeof K=="object"?(se=K,K=null):Y&&typeof Y=="object"?(se=Y,Y=K=null):se=qr;else if(typeof se!="object")throw Error(s+"Argument not an object: "+se);if(fe=ce.toFixed(Y,K),ce.c){var Se,it=fe.split("."),Ne=+se.groupSize,ut=+se.secondaryGroupSize,Et=se.groupSeparator||"",xt=it[0],Xt=it[1],vn=ce.s<0,nn=vn?xt.slice(1):xt,Tn=nn.length;if(ut&&(Se=Ne,Ne=ut,ut=Se,Tn-=Se),Ne>0&&Tn>0){for(Se=Tn%Ne||Ne,xt=nn.substr(0,Se);Se<Tn;Se+=Ne)xt+=Et+nn.substr(Se,Ne);ut>0&&(xt+=Et+nn.slice(Se)),vn&&(xt="-"+xt)}fe=Xt?xt+(se.decimalSeparator||"")+((ut=+se.fractionGroupSize)?Xt.replace(new RegExp("\\d{"+ut+"}\\B","g"),"$&"+(se.fractionGroupSeparator||"")):Xt):xt}return(se.prefix||"")+fe+(se.suffix||"")},ke.toFraction=function(Y){var K,se,fe,ce,Se,it,Ne,ut,Et,xt,Xt,vn,nn=this,Tn=nn.c;if(Y!=null&&(Ne=new q(Y),!Ne.isInteger()&&(Ne.c||Ne.s!==1)||Ne.lt(ui)))throw Error(s+"Argument "+(Ne.isInteger()?"out of range: ":"not an integer: ")+Ce(Ne));if(!Tn)return new q(nn);for(K=new q(ui),Et=se=new q(ui),fe=ut=new q(ui),vn=Yi(Tn),Se=K.e=vn.length-nn.e-1,K.c[0]=et[(it=Se%ti)<0?ti+it:it],Y=!Y||Ne.comparedTo(K)>0?Se>0?K:Et:Ne,it=Bn,Bn=1/0,Ne=new q(vn),ut.c[0]=0;xt=he(Ne,K,0,1),ce=se.plus(xt.times(fe)),ce.comparedTo(Y)!=1;)se=fe,fe=ce,Et=ut.plus(xt.times(ce=Et)),ut=ce,K=Ne.minus(xt.times(ce=K)),Ne=ce;return ce=he(Y.minus(se),fe,0,1),ut=ut.plus(ce.times(Et)),se=se.plus(ce.times(fe)),ut.s=Et.s=nn.s,Se=Se*2,Xt=he(Et,fe,Se,fi).minus(nn).abs().comparedTo(he(ut,se,Se,fi).minus(nn).abs())<1?[Et,fe]:[ut,se],Bn=it,Xt},ke.toNumber=function(){return+Ce(this)},ke.toPrecision=function(Y,K){return Y!=null&&ot(Y,1,ct),ee(this,Y,K,2)},ke.toString=function(Y){var K,se=this,fe=se.s,ce=se.e;return ce===null?fe?(K="Infinity",fe<0&&(K="-"+K)):K="NaN":(Y==null?K=ce<=Zt||ce>=en?vt(Yi(se.c),ce):Be(Yi(se.c),ce,"0"):Y===10&&gt?(se=be(new q(se),Vt+ce+1,fi),K=Be(Yi(se.c),se.e,"0")):(ot(Y,2,ds.length,"Base"),K=pe(Be(Yi(se.c),ce,"0"),10,Y,fe,!0)),fe<0&&se.c[0]&&(K="-"+K)),K},ke.valueOf=ke.toJSON=function(){return Ce(this)},ke._isBigNumber=!0,ke[Symbol.toStringTag]="BigNumber",ke[Symbol.for("nodejs.util.inspect.custom")]=ke.valueOf,_e!=null&&q.set(_e),q}function Ii(_e){var he=_e|0;return _e>0||_e===he?he:he-1}function Yi(_e){for(var he,pe,Re=1,ke=_e.length,ui=_e[0]+"";Re<ke;){for(he=_e[Re++]+"",pe=ti-he.length;pe--;he="0"+he);ui+=he}for(ke=ui.length;ui.charCodeAt(--ke)===48;);return ui.slice(0,ke+1||1)}function We(_e,he){var pe,Re,ke=_e.c,ui=he.c,Vt=_e.s,fi=he.s,Zt=_e.e,en=he.e;if(!Vt||!fi)return null;if(pe=ke&&!ke[0],Re=ui&&!ui[0],pe||Re)return pe?Re?0:-fi:Vt;if(Vt!=fi)return Vt;if(pe=Vt<0,Re=Zt==en,!ke||!ui)return Re?0:!ke^pe?1:-1;if(!Re)return Zt>en^pe?1:-1;for(fi=(Zt=ke.length)<(en=ui.length)?Zt:en,Vt=0;Vt<fi;Vt++)if(ke[Vt]!=ui[Vt])return ke[Vt]>ui[Vt]^pe?1:-1;return Zt==en?0:Zt>en^pe?1:-1}function ot(_e,he,pe,Re){if(_e<he||_e>pe||_e!==hn(_e))throw Error(s+(Re||"Argument")+(typeof _e=="number"?_e<he||_e>pe?" out of range: ":" not an integer: ":" not a primitive number: ")+String(_e))}function dt(_e){var he=_e.c.length-1;return Ii(_e.e/ti)==he&&_e.c[he]%2!=0}function vt(_e,he){return(_e.length>1?_e.charAt(0)+"."+_e.slice(1):_e)+(he<0?"e":"e+")+he}function Be(_e,he,pe){var Re,ke;if(he<0){for(ke=pe+".";++he;ke+=pe);_e=ke+_e}else if(Re=_e.length,++he>Re){for(ke=pe,he-=Re;--he;ke+=pe);_e+=ke}else he<Re&&(_e=_e.slice(0,he)+"."+_e.slice(he));return _e}var Ie=Qt(),Ue=Ie,qe=class{constructor(_e){Ur(this,"key");Ur(this,"left",null);Ur(this,"right",null);this.key=_e}},De=class extends qe{constructor(_e){super(_e)}},je=class Ry extends qe{constructor(pe,Re){super(pe);Ur(this,"value");this.value=Re}replaceValue(pe){const Re=new Ry(this.key,pe);return Re.left=this.left,Re.right=this.right,Re}},Pt=class{constructor(){Ur(this,"size",0);Ur(this,"modificationCount",0);Ur(this,"splayCount",0)}splay(_e){const he=this.root;if(he==null)return this.compare(_e,_e),-1;let pe=null,Re=null,ke=null,ui=null,Vt=he;const fi=this.compare;let Zt;for(;;)if(Zt=fi(Vt.key,_e),Zt>0){let en=Vt.left;if(en==null||(Zt=fi(en.key,_e),Zt>0&&(Vt.left=en.right,en.right=Vt,Vt=en,en=Vt.left,en==null)))break;pe==null?Re=Vt:pe.left=Vt,pe=Vt,Vt=en}else if(Zt<0){let en=Vt.right;if(en==null||(Zt=fi(en.key,_e),Zt<0&&(Vt.right=en.left,en.left=Vt,Vt=en,en=Vt.right,en==null)))break;ke==null?ui=Vt:ke.right=Vt,ke=Vt,Vt=en}else break;return ke!=null&&(ke.right=Vt.left,Vt.left=ui),pe!=null&&(pe.left=Vt.right,Vt.right=Re),this.root!==Vt&&(this.root=Vt,this.splayCount++),Zt}splayMin(_e){let he=_e,pe=he.left;for(;pe!=null;){const Re=pe;he.left=Re.right,Re.right=he,he=Re,pe=he.left}return he}splayMax(_e){let he=_e,pe=he.right;for(;pe!=null;){const Re=pe;he.right=Re.left,Re.left=he,he=Re,pe=he.right}return he}_delete(_e){if(this.root==null||this.splay(_e)!=0)return null;let pe=this.root;const Re=pe,ke=pe.left;if(this.size--,ke==null)this.root=pe.right;else{const ui=pe.right;pe=this.splayMax(ke),pe.right=ui,this.root=pe}return this.modificationCount++,Re}addNewRoot(_e,he){this.size++,this.modificationCount++;const pe=this.root;if(pe==null){this.root=_e;return}he<0?(_e.left=pe,_e.right=pe.right,pe.right=null):(_e.right=pe,_e.left=pe.left,pe.left=null),this.root=_e}_first(){const _e=this.root;return _e==null?null:(this.root=this.splayMin(_e),this.root)}_last(){const _e=this.root;return _e==null?null:(this.root=this.splayMax(_e),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(_e){return this.validKey(_e)&&this.splay(_e)==0}defaultCompare(){return(_e,he)=>_e<he?-1:_e>he?1:0}wrap(){return{getRoot:()=>this.root,setRoot:_e=>{this.root=_e},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:_e=>{this.splayCount=_e},splay:_e=>this.splay(_e),has:_e=>this.has(_e)}}},ki=class extends Pt{constructor(he,pe){super();Ur(this,"root",null);Ur(this,"compare");Ur(this,"validKey");Ur(this,mr,"[object Map]");this.compare=he!=null?he:this.defaultCompare(),this.validKey=pe!=null?pe:Re=>Re!=null&&Re!=null}delete(he){return this.validKey(he)?this._delete(he)!=null:!1}forEach(he){const pe=new Ot(this.wrap());let Re;for(;Re=pe.next(),!Re.done;)he(Re.value[1],Re.value[0],this)}get(he){if(this.validKey(he)&&this.root!=null&&this.splay(he)==0)return this.root.value}hasValue(he){const pe=this.splayCount,Re=ke=>{for(;ke!=null;){if(ke.value==he)return!0;if(pe!=this.splayCount)throw"Concurrent modification during iteration.";if(ke.right!=null&&Re(ke.right))return!0;ke=ke.left}return!1};return Re(this.root)}set(he,pe){const Re=this.splay(he);return Re==0?(this.root=this.root.replaceValue(pe),this.splayCount+=1,this):(this.addNewRoot(new je(he,pe),Re),this)}setAll(he){he.forEach((pe,Re)=>{this.set(Re,pe)})}setIfAbsent(he,pe){let Re=this.splay(he);if(Re==0)return this.root.value;const ke=this.modificationCount,ui=this.splayCount,Vt=pe();if(ke!=this.modificationCount)throw"Concurrent modification during iteration.";return ui!=this.splayCount&&(Re=this.splay(he)),this.addNewRoot(new je(he,Vt),Re),Vt}isEmpty(){return this.root==null}isNotEmpty(){return!this.isEmpty()}firstKey(){return this.root==null?null:this._first().key}lastKey(){return this.root==null?null:this._last().key}lastKeyBefore(he){if(he==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(he)<0)return this.root.key;let Re=this.root.left;if(Re==null)return null;let ke=Re.right;for(;ke!=null;)Re=ke,ke=Re.right;return Re.key}firstKeyAfter(he){if(he==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(he)>0)return this.root.key;let Re=this.root.right;if(Re==null)return null;let ke=Re.left;for(;ke!=null;)Re=ke,ke=Re.left;return Re.key}update(he,pe,Re){let ke=this.splay(he);if(ke==0){const ui=this.modificationCount,Vt=this.splayCount,fi=pe(this.root.value);if(ui!=this.modificationCount)throw"Concurrent modification during iteration.";return Vt!=this.splayCount&&this.splay(he),this.root=this.root.replaceValue(fi),this.splayCount+=1,fi}if(Re!=null){const ui=this.modificationCount,Vt=this.splayCount,fi=Re();if(ui!=this.modificationCount)throw"Concurrent modification during iteration.";return Vt!=this.splayCount&&(ke=this.splay(he)),this.addNewRoot(new je(he,fi),ke),fi}throw"Invalid argument (key): Key not in map."}updateAll(he){if(this.root==null)return;const Re=new Ot(this.wrap());let ke;for(;ke=Re.next(),!ke.done;){const ui=he(...ke.value);Re.replaceValue(ui)}}keys(){return new hr(this.wrap())}values(){return new rn(this.wrap())}entries(){return this[Symbol.iterator]()}[(Ss=Symbol.iterator,mr=Symbol.toStringTag,Ss)](){return new Ot(this.wrap())}},bi=class yd extends Pt{constructor(pe,Re){super();Ur(this,"root",null);Ur(this,"compare");Ur(this,"validKey");Ur(this,ks,"[object Set]");this.compare=pe!=null?pe:this.defaultCompare(),this.validKey=Re!=null?Re:ke=>ke!=null&&ke!=null}delete(pe){return this.validKey(pe)?this._delete(pe)!=null:!1}deleteAll(pe){for(const Re of pe)this.delete(Re)}forEach(pe){const Re=this[Symbol.iterator]();let ke;for(;ke=Re.next(),!ke.done;)pe(ke.value,ke.value,this)}add(pe){const Re=this.splay(pe);return Re!=0&&this.addNewRoot(new De(pe),Re),this}addAndReturn(pe){const Re=this.splay(pe);return Re!=0&&this.addNewRoot(new De(pe),Re),this.root.key}addAll(pe){for(const Re of pe)this.add(Re)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(pe){if(pe==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(pe)<0)return this.root.key;let ke=this.root.left;if(ke==null)return null;let ui=ke.right;for(;ui!=null;)ke=ui,ui=ke.right;return ke.key}firstAfter(pe){if(pe==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(pe)>0)return this.root.key;let ke=this.root.right;if(ke==null)return null;let ui=ke.left;for(;ui!=null;)ke=ui,ui=ke.left;return ke.key}retainAll(pe){const Re=new yd(this.compare,this.validKey),ke=this.modificationCount;for(const ui of pe){if(ke!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(ui)&&this.splay(ui)==0&&Re.add(this.root.key)}Re.size!=this.size&&(this.root=Re.root,this.size=Re.size,this.modificationCount++)}lookup(pe){return!this.validKey(pe)||this.splay(pe)!=0?null:this.root.key}intersection(pe){const Re=new yd(this.compare,this.validKey);for(const ke of this)pe.has(ke)&&Re.add(ke);return Re}difference(pe){const Re=new yd(this.compare,this.validKey);for(const ke of this)pe.has(ke)||Re.add(ke);return Re}union(pe){const Re=this.clone();return Re.addAll(pe),Re}clone(){const pe=new yd(this.compare,this.validKey);return pe.size=this.size,pe.root=this.copyNode(this.root),pe}copyNode(pe){if(pe==null)return null;function Re(ui,Vt){let fi,Zt;do{if(fi=ui.left,Zt=ui.right,fi!=null){const en=new De(fi.key);Vt.left=en,Re(fi,en)}if(Zt!=null){const en=new De(Zt.key);Vt.right=en,ui=Zt,Vt=en}}while(Zt!=null)}const ke=new De(pe.key);return Re(pe,ke),ke}toSet(){return this.clone()}entries(){return new Xn(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(ur=Symbol.iterator,ks=Symbol.toStringTag,ur)](){return new hr(this.wrap())}},ji=class{constructor(_e){Ur(this,"tree");Ur(this,"path",new Array);Ur(this,"modificationCount",null);Ur(this,"splayCount");this.tree=_e,this.splayCount=_e.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const _e=this.path[this.path.length-1];return this.getValue(_e)}rebuildPath(_e){this.path.splice(0,this.path.length),this.tree.splay(_e),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(_e){for(;_e!=null;)this.path.push(_e),_e=_e.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let pe=this.tree.getRoot();for(;pe!=null;)this.path.push(pe),pe=pe.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let _e=this.path[this.path.length-1],he=_e.right;if(he!=null){for(;he!=null;)this.path.push(he),he=he.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===_e;)_e=this.path.pop();return this.path.length>0}},hr=class extends ji{getValue(_e){return _e.key}},Xn=class extends ji{getValue(_e){return[_e.key,_e.key]}},rn=class extends ji{constructor(_e){super(_e)}getValue(_e){return _e.value}},Ot=class extends ji{constructor(_e){super(_e)}getValue(_e){return[_e.key,_e.value]}replaceValue(_e){if(this.modificationCount!=this.tree.getModificationCount())throw"Concurrent modification during iteration.";this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);const he=this.path.pop(),pe=he.replaceValue(_e);if(!this.path.length)this.tree.setRoot(pe);else{const ke=this.path[this.path.length-1];he===ke.left?ke.left=pe:ke.right=pe}this.path.push(pe);const Re=this.tree.getSplayCount()+1;this.tree.setSplayCount(Re),this.splayCount=Re}},at=_e=>()=>_e,Ht=_e=>{const he=_e?(pe,Re)=>Re.minus(pe).abs().isLessThanOrEqualTo(_e):at(!1);return(pe,Re)=>he(pe,Re)?0:pe.comparedTo(Re)};function Qi(_e){const he=_e?(pe,Re,ke,ui,Vt)=>pe.exponentiatedBy(2).isLessThanOrEqualTo(ui.minus(Re).exponentiatedBy(2).plus(Vt.minus(ke).exponentiatedBy(2)).times(_e)):at(!1);return(pe,Re,ke)=>{const ui=pe.x,Vt=pe.y,fi=ke.x,Zt=ke.y,en=Vt.minus(Zt).times(Re.x.minus(fi)).minus(ui.minus(fi).times(Re.y.minus(Zt)));return he(en,ui,Vt,fi,Zt)?0:en.comparedTo(0)}}var vi=_e=>_e,Mn=_e=>{if(_e){const he=new bi(Ht(_e)),pe=new bi(Ht(_e)),Re=(ui,Vt)=>Vt.addAndReturn(ui),ke=ui=>({x:Re(ui.x,he),y:Re(ui.y,pe)});return ke({x:new Ue(0),y:new Ue(0)}),ke}return vi},gr=_e=>({set:he=>{Hn=gr(he)},reset:()=>gr(_e),compare:Ht(_e),snap:Mn(_e),orient:Qi(_e)}),Hn=gr(),kr=(_e,he)=>_e.ll.x.isLessThanOrEqualTo(he.x)&&he.x.isLessThanOrEqualTo(_e.ur.x)&&_e.ll.y.isLessThanOrEqualTo(he.y)&&he.y.isLessThanOrEqualTo(_e.ur.y),Dt=(_e,he)=>{if(he.ur.x.isLessThan(_e.ll.x)||_e.ur.x.isLessThan(he.ll.x)||he.ur.y.isLessThan(_e.ll.y)||_e.ur.y.isLessThan(he.ll.y))return null;const pe=_e.ll.x.isLessThan(he.ll.x)?he.ll.x:_e.ll.x,Re=_e.ur.x.isLessThan(he.ur.x)?_e.ur.x:he.ur.x,ke=_e.ll.y.isLessThan(he.ll.y)?he.ll.y:_e.ll.y,ui=_e.ur.y.isLessThan(he.ur.y)?_e.ur.y:he.ur.y;return{ll:{x:pe,y:ke},ur:{x:Re,y:ui}}},Ls=(_e,he)=>_e.x.times(he.y).minus(_e.y.times(he.x)),Pe=(_e,he)=>_e.x.times(he.x).plus(_e.y.times(he.y)),$n=_e=>Pe(_e,_e).sqrt(),lt=(_e,he,pe)=>{const Re={x:he.x.minus(_e.x),y:he.y.minus(_e.y)},ke={x:pe.x.minus(_e.x),y:pe.y.minus(_e.y)};return Ls(ke,Re).div($n(ke)).div($n(Re))},cs=(_e,he,pe)=>{const Re={x:he.x.minus(_e.x),y:he.y.minus(_e.y)},ke={x:pe.x.minus(_e.x),y:pe.y.minus(_e.y)};return Pe(ke,Re).div($n(ke)).div($n(Re))},Xi=(_e,he,pe)=>he.y.isZero()?null:{x:_e.x.plus(he.x.div(he.y).times(pe.minus(_e.y))),y:pe},vs=(_e,he,pe)=>he.x.isZero()?null:{x:pe,y:_e.y.plus(he.y.div(he.x).times(pe.minus(_e.x)))},Bs=(_e,he,pe,Re)=>{if(he.x.isZero())return vs(pe,Re,_e.x);if(Re.x.isZero())return vs(_e,he,pe.x);if(he.y.isZero())return Xi(pe,Re,_e.y);if(Re.y.isZero())return Xi(_e,he,pe.y);const ke=Ls(he,Re);if(ke.isZero())return null;const ui={x:pe.x.minus(_e.x),y:pe.y.minus(_e.y)},Vt=Ls(ui,he).div(ke),fi=Ls(ui,Re).div(ke),Zt=_e.x.plus(fi.times(he.x)),en=pe.x.plus(Vt.times(Re.x)),Un=_e.y.plus(fi.times(he.y)),Bn=pe.y.plus(Vt.times(Re.y)),Or=Zt.plus(en).div(2),hs=Un.plus(Bn).div(2);return{x:Or,y:hs}},Xs=class ky{constructor(he,pe){Ur(this,"point");Ur(this,"isLeft");Ur(this,"segment");Ur(this,"otherSE");Ur(this,"consumedBy");he.events===void 0?he.events=[this]:he.events.push(this),this.point=he,this.isLeft=pe}static compare(he,pe){const Re=ky.comparePoints(he.point,pe.point);return Re!==0?Re:(he.point!==pe.point&&he.link(pe),he.isLeft!==pe.isLeft?he.isLeft?1:-1:Pr.compare(he.segment,pe.segment))}static comparePoints(he,pe){return he.x.isLessThan(pe.x)?-1:he.x.isGreaterThan(pe.x)?1:he.y.isLessThan(pe.y)?-1:he.y.isGreaterThan(pe.y)?1:0}link(he){if(he.point===this.point)throw new Error("Tried to link already linked events");const pe=he.point.events;for(let Re=0,ke=pe.length;Re<ke;Re++){const ui=pe[Re];this.point.events.push(ui),ui.point=this.point}this.checkForConsuming()}checkForConsuming(){const he=this.point.events.length;for(let pe=0;pe<he;pe++){const Re=this.point.events[pe];if(Re.segment.consumedBy===void 0)for(let ke=pe+1;ke<he;ke++){const ui=this.point.events[ke];ui.consumedBy===void 0&&Re.otherSE.point.events===ui.otherSE.point.events&&Re.segment.consume(ui.segment)}}}getAvailableLinkedEvents(){const he=[];for(let pe=0,Re=this.point.events.length;pe<Re;pe++){const ke=this.point.events[pe];ke!==this&&!ke.segment.ringOut&&ke.segment.isInResult()&&he.push(ke)}return he}getLeftmostComparator(he){const pe=new Map,Re=ke=>{const ui=ke.otherSE;pe.set(ke,{sine:lt(this.point,he.point,ui.point),cosine:cs(this.point,he.point,ui.point)})};return(ke,ui)=>{pe.has(ke)||Re(ke),pe.has(ui)||Re(ui);const{sine:Vt,cosine:fi}=pe.get(ke),{sine:Zt,cosine:en}=pe.get(ui);return Vt.isGreaterThanOrEqualTo(0)&&Zt.isGreaterThanOrEqualTo(0)?fi.isLessThan(en)?1:fi.isGreaterThan(en)?-1:0:Vt.isLessThan(0)&&Zt.isLessThan(0)?fi.isLessThan(en)?-1:fi.isGreaterThan(en)?1:0:Zt.isLessThan(Vt)?-1:Zt.isGreaterThan(Vt)?1:0}}},Sr=class sm{constructor(he){Ur(this,"events");Ur(this,"poly");Ur(this,"_isExteriorRing");Ur(this,"_enclosingRing");this.events=he;for(let pe=0,Re=he.length;pe<Re;pe++)he[pe].segment.ringOut=this;this.poly=null}static factory(he){const pe=[];for(let Re=0,ke=he.length;Re<ke;Re++){const ui=he[Re];if(!ui.isInResult()||ui.ringOut)continue;let Vt=null,fi=ui.leftSE,Zt=ui.rightSE;const en=[fi],Un=fi.point,Bn=[];for(;Vt=fi,fi=Zt,en.push(fi),fi.point!==Un;)for(;;){const Or=fi.getAvailableLinkedEvents();if(Or.length===0){const qr=en[0].point,ds=en[en.length-1].point;throw new Error(`Unable to complete output ring starting at [${qr.x}, ${qr.y}]. Last matching segment found ends at [${ds.x}, ${ds.y}].`)}if(Or.length===1){Zt=Or[0].otherSE;break}let hs=null;for(let qr=0,ds=Bn.length;qr<ds;qr++)if(Bn[qr].point===fi.point){hs=qr;break}if(hs!==null){const qr=Bn.splice(hs)[0],ds=en.splice(qr.index);ds.unshift(ds[0].otherSE),pe.push(new sm(ds.reverse()));continue}Bn.push({index:en.length,point:fi.point});const Vs=fi.getLeftmostComparator(Vt);Zt=Or.sort(Vs)[0].otherSE;break}pe.push(new sm(en))}return pe}getGeom(){let he=this.events[0].point;const pe=[he];for(let en=1,Un=this.events.length-1;en<Un;en++){const Bn=this.events[en].point,Or=this.events[en+1].point;Hn.orient(Bn,he,Or)!==0&&(pe.push(Bn),he=Bn)}if(pe.length===1)return null;const Re=pe[0],ke=pe[1];Hn.orient(Re,he,ke)===0&&pe.shift(),pe.push(pe[0]);const ui=this.isExteriorRing()?1:-1,Vt=this.isExteriorRing()?0:pe.length-1,fi=this.isExteriorRing()?pe.length:-1,Zt=[];for(let en=Vt;en!=fi;en+=ui)Zt.push([pe[en].x.toNumber(),pe[en].y.toNumber()]);return Zt}isExteriorRing(){if(this._isExteriorRing===void 0){const he=this.enclosingRing();this._isExteriorRing=he?!he.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var ke,ui;let he=this.events[0];for(let Vt=1,fi=this.events.length;Vt<fi;Vt++){const Zt=this.events[Vt];Xs.compare(he,Zt)>0&&(he=Zt)}let pe=he.segment.prevInResult(),Re=pe?pe.prevInResult():null;for(;;){if(!pe)return null;if(!Re)return pe.ringOut;if(Re.ringOut!==pe.ringOut)return((ke=Re.ringOut)==null?void 0:ke.enclosingRing())!==pe.ringOut?pe.ringOut:(ui=pe.ringOut)==null?void 0:ui.enclosingRing();pe=Re.prevInResult(),Re=pe?pe.prevInResult():null}}},un=class{constructor(_e){Ur(this,"exteriorRing");Ur(this,"interiorRings");this.exteriorRing=_e,_e.poly=this,this.interiorRings=[]}addInterior(_e){this.interiorRings.push(_e),_e.poly=this}getGeom(){const _e=this.exteriorRing.getGeom();if(_e===null)return null;const he=[_e];for(let pe=0,Re=this.interiorRings.length;pe<Re;pe++){const ke=this.interiorRings[pe].getGeom();ke!==null&&he.push(ke)}return he}},ys=class{constructor(_e){Ur(this,"rings");Ur(this,"polys");this.rings=_e,this.polys=this._composePolys(_e)}getGeom(){const _e=[];for(let he=0,pe=this.polys.length;he<pe;he++){const Re=this.polys[he].getGeom();Re!==null&&_e.push(Re)}return _e}_composePolys(_e){var pe;const he=[];for(let Re=0,ke=_e.length;Re<ke;Re++){const ui=_e[Re];if(!ui.poly)if(ui.isExteriorRing())he.push(new un(ui));else{const Vt=ui.enclosingRing();Vt!=null&&Vt.poly||he.push(new un(Vt)),(pe=Vt==null?void 0:Vt.poly)==null||pe.addInterior(ui)}}return he}},Hs=class{constructor(_e,he=Pr.compare){Ur(this,"queue");Ur(this,"tree");Ur(this,"segments");this.queue=_e,this.tree=new bi(he),this.segments=[]}process(_e){const he=_e.segment,pe=[];if(_e.consumedBy)return _e.isLeft?this.queue.delete(_e.otherSE):this.tree.delete(he),pe;_e.isLeft&&this.tree.add(he);let Re=he,ke=he;do Re=this.tree.lastBefore(Re);while(Re!=null&&Re.consumedBy!=null);do ke=this.tree.firstAfter(ke);while(ke!=null&&ke.consumedBy!=null);if(_e.isLeft){let ui=null;if(Re){const fi=Re.getIntersection(he);if(fi!==null&&(he.isAnEndpoint(fi)||(ui=fi),!Re.isAnEndpoint(fi))){const Zt=this._splitSafely(Re,fi);for(let en=0,Un=Zt.length;en<Un;en++)pe.push(Zt[en])}}let Vt=null;if(ke){const fi=ke.getIntersection(he);if(fi!==null&&(he.isAnEndpoint(fi)||(Vt=fi),!ke.isAnEndpoint(fi))){const Zt=this._splitSafely(ke,fi);for(let en=0,Un=Zt.length;en<Un;en++)pe.push(Zt[en])}}if(ui!==null||Vt!==null){let fi=null;ui===null?fi=Vt:Vt===null?fi=ui:fi=Xs.comparePoints(ui,Vt)<=0?ui:Vt,this.queue.delete(he.rightSE),pe.push(he.rightSE);const Zt=he.split(fi);for(let en=0,Un=Zt.length;en<Un;en++)pe.push(Zt[en])}pe.length>0?(this.tree.delete(he),pe.push(_e)):(this.segments.push(he),he.prev=Re)}else{if(Re&&ke){const ui=Re.getIntersection(ke);if(ui!==null){if(!Re.isAnEndpoint(ui)){const Vt=this._splitSafely(Re,ui);for(let fi=0,Zt=Vt.length;fi<Zt;fi++)pe.push(Vt[fi])}if(!ke.isAnEndpoint(ui)){const Vt=this._splitSafely(ke,ui);for(let fi=0,Zt=Vt.length;fi<Zt;fi++)pe.push(Vt[fi])}}}this.tree.delete(he)}return pe}_splitSafely(_e,he){this.tree.delete(_e);const pe=_e.rightSE;this.queue.delete(pe);const Re=_e.split(he);return Re.push(pe),_e.consumedBy===void 0&&this.tree.add(_e),Re}},ls=class{constructor(){Ur(this,"type");Ur(this,"numMultiPolys")}run(_e,he,pe){Rs.type=_e;const Re=[new xs(he,!0)];for(let en=0,Un=pe.length;en<Un;en++)Re.push(new xs(pe[en],!1));if(Rs.numMultiPolys=Re.length,Rs.type==="difference"){const en=Re[0];let Un=1;for(;Un<Re.length;)Dt(Re[Un].bbox,en.bbox)!==null?Un++:Re.splice(Un,1)}if(Rs.type==="intersection")for(let en=0,Un=Re.length;en<Un;en++){const Bn=Re[en];for(let Or=en+1,hs=Re.length;Or<hs;Or++)if(Dt(Bn.bbox,Re[Or].bbox)===null)return[]}const ke=new bi(Xs.compare);for(let en=0,Un=Re.length;en<Un;en++){const Bn=Re[en].getSweepEvents();for(let Or=0,hs=Bn.length;Or<hs;Or++)ke.add(Bn[Or])}const ui=new Hs(ke);let Vt=null;for(ke.size!=0&&(Vt=ke.first(),ke.delete(Vt));Vt;){const en=ui.process(Vt);for(let Un=0,Bn=en.length;Un<Bn;Un++){const Or=en[Un];Or.consumedBy===void 0&&ke.add(Or)}ke.size!=0?(Vt=ke.first(),ke.delete(Vt)):Vt=null}Hn.reset();const fi=Sr.factory(ui.segments);return new ys(fi).getGeom()}},Rs=new ls,cn=Rs,Jr=0,Pr=class Pf{constructor(he,pe,Re,ke){Ur(this,"id");Ur(this,"leftSE");Ur(this,"rightSE");Ur(this,"rings");Ur(this,"windings");Ur(this,"ringOut");Ur(this,"consumedBy");Ur(this,"prev");Ur(this,"_prevInResult");Ur(this,"_beforeState");Ur(this,"_afterState");Ur(this,"_isInResult");this.id=++Jr,this.leftSE=he,he.segment=this,he.otherSE=pe,this.rightSE=pe,pe.segment=this,pe.otherSE=he,this.rings=Re,this.windings=ke}static compare(he,pe){const Re=he.leftSE.point.x,ke=pe.leftSE.point.x,ui=he.rightSE.point.x,Vt=pe.rightSE.point.x;if(Vt.isLessThan(Re))return 1;if(ui.isLessThan(ke))return-1;const fi=he.leftSE.point.y,Zt=pe.leftSE.point.y,en=he.rightSE.point.y,Un=pe.rightSE.point.y;if(Re.isLessThan(ke)){if(Zt.isLessThan(fi)&&Zt.isLessThan(en))return 1;if(Zt.isGreaterThan(fi)&&Zt.isGreaterThan(en))return-1;const Bn=he.comparePoint(pe.leftSE.point);if(Bn<0)return 1;if(Bn>0)return-1;const Or=pe.comparePoint(he.rightSE.point);return Or!==0?Or:-1}if(Re.isGreaterThan(ke)){if(fi.isLessThan(Zt)&&fi.isLessThan(Un))return-1;if(fi.isGreaterThan(Zt)&&fi.isGreaterThan(Un))return 1;const Bn=pe.comparePoint(he.leftSE.point);if(Bn!==0)return Bn;const Or=he.comparePoint(pe.rightSE.point);return Or<0?1:Or>0?-1:1}if(fi.isLessThan(Zt))return-1;if(fi.isGreaterThan(Zt))return 1;if(ui.isLessThan(Vt)){const Bn=pe.comparePoint(he.rightSE.point);if(Bn!==0)return Bn}if(ui.isGreaterThan(Vt)){const Bn=he.comparePoint(pe.rightSE.point);if(Bn<0)return 1;if(Bn>0)return-1}if(!ui.eq(Vt)){const Bn=en.minus(fi),Or=ui.minus(Re),hs=Un.minus(Zt),Vs=Vt.minus(ke);if(Bn.isGreaterThan(Or)&&hs.isLessThan(Vs))return 1;if(Bn.isLessThan(Or)&&hs.isGreaterThan(Vs))return-1}return ui.isGreaterThan(Vt)?1:ui.isLessThan(Vt)||en.isLessThan(Un)?-1:en.isGreaterThan(Un)?1:he.id<pe.id?-1:he.id>pe.id?1:0}static fromRing(he,pe,Re){let ke,ui,Vt;const fi=Xs.comparePoints(he,pe);if(fi<0)ke=he,ui=pe,Vt=1;else if(fi>0)ke=pe,ui=he,Vt=-1;else throw new Error(`Tried to create degenerate segment at [${he.x}, ${he.y}]`);const Zt=new Xs(ke,!0),en=new Xs(ui,!1);return new Pf(Zt,en,[Re],[Vt])}replaceRightSE(he){this.rightSE=he,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const he=this.leftSE.point.y,pe=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:he.isLessThan(pe)?he:pe},ur:{x:this.rightSE.point.x,y:he.isGreaterThan(pe)?he:pe}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(he){return he.x.eq(this.leftSE.point.x)&&he.y.eq(this.leftSE.point.y)||he.x.eq(this.rightSE.point.x)&&he.y.eq(this.rightSE.point.y)}comparePoint(he){return Hn.orient(this.leftSE.point,he,this.rightSE.point)}getIntersection(he){const pe=this.bbox(),Re=he.bbox(),ke=Dt(pe,Re);if(ke===null)return null;const ui=this.leftSE.point,Vt=this.rightSE.point,fi=he.leftSE.point,Zt=he.rightSE.point,en=kr(pe,fi)&&this.comparePoint(fi)===0,Un=kr(Re,ui)&&he.comparePoint(ui)===0,Bn=kr(pe,Zt)&&this.comparePoint(Zt)===0,Or=kr(Re,Vt)&&he.comparePoint(Vt)===0;if(Un&&en)return Or&&!Bn?Vt:!Or&&Bn?Zt:null;if(Un)return Bn&&ui.x.eq(Zt.x)&&ui.y.eq(Zt.y)?null:ui;if(en)return Or&&Vt.x.eq(fi.x)&&Vt.y.eq(fi.y)?null:fi;if(Or&&Bn)return null;if(Or)return Vt;if(Bn)return Zt;const hs=Bs(ui,this.vector(),fi,he.vector());return hs===null||!kr(ke,hs)?null:Hn.snap(hs)}split(he){const pe=[],Re=he.events!==void 0,ke=new Xs(he,!0),ui=new Xs(he,!1),Vt=this.rightSE;this.replaceRightSE(ui),pe.push(ui),pe.push(ke);const fi=new Pf(ke,Vt,this.rings.slice(),this.windings.slice());return Xs.comparePoints(fi.leftSE.point,fi.rightSE.point)>0&&fi.swapEvents(),Xs.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Re&&(ke.checkForConsuming(),ui.checkForConsuming()),pe}swapEvents(){const he=this.rightSE;this.rightSE=this.leftSE,this.leftSE=he,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let pe=0,Re=this.windings.length;pe<Re;pe++)this.windings[pe]*=-1}consume(he){let pe=this,Re=he;for(;pe.consumedBy;)pe=pe.consumedBy;for(;Re.consumedBy;)Re=Re.consumedBy;const ke=Pf.compare(pe,Re);if(ke!==0){if(ke>0){const ui=pe;pe=Re,Re=ui}if(pe.prev===Re){const ui=pe;pe=Re,Re=ui}for(let ui=0,Vt=Re.rings.length;ui<Vt;ui++){const fi=Re.rings[ui],Zt=Re.windings[ui],en=pe.rings.indexOf(fi);en===-1?(pe.rings.push(fi),pe.windings.push(Zt)):pe.windings[en]+=Zt}Re.rings=null,Re.windings=null,Re.consumedBy=pe,Re.leftSE.consumedBy=pe.leftSE,Re.rightSE.consumedBy=pe.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const he=this.prev.consumedBy||this.prev;this._beforeState=he.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const he=this.beforeState();this._afterState={rings:he.rings.slice(0),windings:he.windings.slice(0),multiPolys:[]};const pe=this._afterState.rings,Re=this._afterState.windings,ke=this._afterState.multiPolys;for(let fi=0,Zt=this.rings.length;fi<Zt;fi++){const en=this.rings[fi],Un=this.windings[fi],Bn=pe.indexOf(en);Bn===-1?(pe.push(en),Re.push(Un)):Re[Bn]+=Un}const ui=[],Vt=[];for(let fi=0,Zt=pe.length;fi<Zt;fi++){if(Re[fi]===0)continue;const en=pe[fi],Un=en.poly;if(Vt.indexOf(Un)===-1)if(en.isExterior)ui.push(Un);else{Vt.indexOf(Un)===-1&&Vt.push(Un);const Bn=ui.indexOf(en.poly);Bn!==-1&&ui.splice(Bn,1)}}for(let fi=0,Zt=ui.length;fi<Zt;fi++){const en=ui[fi].multiPoly;ke.indexOf(en)===-1&&ke.push(en)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const he=this.beforeState().multiPolys,pe=this.afterState().multiPolys;switch(cn.type){case"union":{const Re=he.length===0,ke=pe.length===0;this._isInResult=Re!==ke;break}case"intersection":{let Re,ke;he.length<pe.length?(Re=he.length,ke=pe.length):(Re=pe.length,ke=he.length),this._isInResult=ke===cn.numMultiPolys&&Re<ke;break}case"xor":{const Re=Math.abs(he.length-pe.length);this._isInResult=Re%2===1;break}case"difference":{const Re=ke=>ke.length===1&&ke[0].isSubject;this._isInResult=Re(he)!==Re(pe);break}}return this._isInResult}},Ts=class{constructor(_e,he,pe){Ur(this,"poly");Ur(this,"isExterior");Ur(this,"segments");Ur(this,"bbox");if(!Array.isArray(_e)||_e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=he,this.isExterior=pe,this.segments=[],typeof _e[0][0]!="number"||typeof _e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const Re=Hn.snap({x:new Ue(_e[0][0]),y:new Ue(_e[0][1])});this.bbox={ll:{x:Re.x,y:Re.y},ur:{x:Re.x,y:Re.y}};let ke=Re;for(let ui=1,Vt=_e.length;ui<Vt;ui++){if(typeof _e[ui][0]!="number"||typeof _e[ui][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const fi=Hn.snap({x:new Ue(_e[ui][0]),y:new Ue(_e[ui][1])});fi.x.eq(ke.x)&&fi.y.eq(ke.y)||(this.segments.push(Pr.fromRing(ke,fi,this)),fi.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=fi.x),fi.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=fi.y),fi.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=fi.x),fi.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=fi.y),ke=fi)}(!Re.x.eq(ke.x)||!Re.y.eq(ke.y))&&this.segments.push(Pr.fromRing(ke,Re,this))}getSweepEvents(){const _e=[];for(let he=0,pe=this.segments.length;he<pe;he++){const Re=this.segments[he];_e.push(Re.leftSE),_e.push(Re.rightSE)}return _e}},Dn=class{constructor(_e,he){Ur(this,"multiPoly");Ur(this,"exteriorRing");Ur(this,"interiorRings");Ur(this,"bbox");if(!Array.isArray(_e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ts(_e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let pe=1,Re=_e.length;pe<Re;pe++){const ke=new Ts(_e[pe],this,!1);ke.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=ke.bbox.ll.x),ke.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=ke.bbox.ll.y),ke.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=ke.bbox.ur.x),ke.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=ke.bbox.ur.y),this.interiorRings.push(ke)}this.multiPoly=he}getSweepEvents(){const _e=this.exteriorRing.getSweepEvents();for(let he=0,pe=this.interiorRings.length;he<pe;he++){const Re=this.interiorRings[he].getSweepEvents();for(let ke=0,ui=Re.length;ke<ui;ke++)_e.push(Re[ke])}return _e}},xs=class{constructor(_e,he){Ur(this,"isSubject");Ur(this,"polys");Ur(this,"bbox");if(!Array.isArray(_e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof _e[0][0][0]=="number"&&(_e=[_e])}catch(pe){}this.polys=[],this.bbox={ll:{x:new Ue(Number.POSITIVE_INFINITY),y:new Ue(Number.POSITIVE_INFINITY)},ur:{x:new Ue(Number.NEGATIVE_INFINITY),y:new Ue(Number.NEGATIVE_INFINITY)}};for(let pe=0,Re=_e.length;pe<Re;pe++){const ke=new Dn(_e[pe],this);ke.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=ke.bbox.ll.x),ke.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=ke.bbox.ll.y),ke.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=ke.bbox.ur.x),ke.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=ke.bbox.ur.y),this.polys.push(ke)}this.isSubject=he}getSweepEvents(){const _e=[];for(let he=0,pe=this.polys.length;he<pe;he++){const Re=this.polys[he].getSweepEvents();for(let ke=0,ui=Re.length;ke<ui;ke++)_e.push(Re[ke])}return _e}},Gn=(_e,...he)=>cn.run("union",_e,he),Ir=(_e,...he)=>cn.run("intersection",_e,he),fo=(_e,...he)=>cn.run("xor",_e,he),ms=(_e,...he)=>cn.run("difference",_e,he),Co=Hn.set}}]);
}());